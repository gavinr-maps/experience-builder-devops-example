/* @preserve
* @esri/arcgis-rest-request - v3.0.5 - Apache-2.0
* Copyright (c) 2017-2021 Esri, Inc.
* Tue Apr 20 2021 08:10:08 GMT-0700 (Pacific Daylight Time)
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).arcgisRest=e.arcgisRest||{})}(this,function(e){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};var h=function(){return(h=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function p(r){return Object.keys(r).some(function(e){var t=r[e];if(!t)return!1;switch(t&&t.toParam&&(t=t.toParam()),t.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function a(s){var i={};return Object.keys(s).forEach(function(e){var t,r,n=s[e];if(n&&n.toParam&&(n=n.toParam()),n||0===n||"boolean"==typeof n||"string"==typeof n){switch(n.constructor.name){case"Array":var o=null===(r=null===(t=n[0])||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.name,a="Array"===o?n:"Object"===o?JSON.stringify(n):n.join(",");break;case"Object":a=JSON.stringify(n);break;case"Date":a=n.valueOf();break;case"Function":a=null;break;case"Boolean":a=n+"";break;default:a=n}(a||0===a||"string"==typeof a||Array.isArray(a))&&(i[e]=a)}}),i}function n(t,e){return Array.isArray(e)&&e[0]&&Array.isArray(e[0])?e.map(function(e){return n(t,e)}).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(e)}function d(e){var t=a(e);return Object.keys(t).map(function(e){return n(e,t[e])}).join("&")}function l(e,t){var r=p(e)||t,n=a(e);if(r){var o=new FormData;return Object.keys(n).forEach(function(e){var t;"undefined"!=typeof Blob&&n[e]instanceof Blob?(t=n.fileName||n[e].name||e,o.append(e,n[e],t)):o.append(e,n[e])}),o}return d(e)}var m=function(e,t,r,n,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=o};function o(e){console&&console.warn&&console.warn.apply(console,[e])}m.prototype=Object.create(Error.prototype),m.prototype.constructor=m;var y="@esri/arcgis-rest-js",O={httpMethod:"POST",params:{f:"json"}};var s,t,i,c,f=(r(t=v,i=s=m),t.prototype=null===i?Object.create(i):(u.prototype=i.prototype,new u),v.prototype.retry=function(e,n){var o=this;void 0===n&&(n=3);var a=0,s=function(t,r){e(o.url,o.options).then(function(e){var t=h(h({},o.options),{authentication:e});return a+=1,E(o.url,t)}).then(function(e){t(e)}).catch(function(e){"ArcGISAuthError"===e.name&&a<n?s(t,r):"ArcGISAuthError"===e.name&&n<=a?r(o):r(e)})};return new Promise(function(e,t){s(e,t)})},v);function u(){this.constructor=t}function v(e,t,r,n,o){void 0===e&&(e="AUTHENTICATION_ERROR"),void 0===t&&(t="AUTHENTICATION_ERROR_CODE");var a=s.call(this,e,t,r,n,o)||this;return a.name="ArcGISAuthError",a.message="AUTHENTICATION_ERROR_CODE"===t?e:t+": "+e,a}function g(t,e,r,n,o){if(400<=t.code){var a=t.message,s=t.code;throw new m(a,s,t,e,n)}if(t.error){var i=t.error,a=i.message,s=i.code,c=i.messageCode,u=c||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===c||400===s&&"Unable to generate token."===a)throw o||new f(a,u,t,e,n);throw new m(a,u,t,e,n)}if("failed"!==t.status&&"failure"!==t.status)return t;a=void 0,s="UNKNOWN_ERROR_CODE";try{a=JSON.parse(t.statusMessage).message,s=JSON.parse(t.statusMessage).code}catch(e){a=t.statusMessage||t.message}throw new m(a,s,t,e,n)}function E(o,e){void 0===e&&(e={params:{f:"json"}});var a=h(h(h({httpMethod:"POST"},O),e),{params:h(h({},O.params),e.params),headers:h(h({},O.headers),e.headers)}),t=[],r=[];if(a.fetch||"undefined"==typeof fetch?(t.push("`fetch`"),r.push("`node-fetch`")):a.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(t.push("`Promise`"),r.push("`es6-promise`")),"undefined"==typeof FormData&&(t.push("`FormData`"),r.push("`isomorphic-form-data`")),!a.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+t.join(", ")+". We recommend installing the "+r.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var n=a.httpMethod,s=a.authentication,i=a.rawResponse,c=h({f:"json"},a.params),u=null,f={method:n,credentials:"same-origin"};return a.headers&&a.headers["X-Esri-Auth-Client-Id"]&&-1<o.indexOf("/oauth2/platformSelf")&&(f.credentials="include"),(s?s.getToken(o,{fetch:a.fetch}).catch(function(e){return e.url=o,e.options=a,u=e,Promise.resolve("")}):Promise.resolve("")).then(function(e){e.length&&(c.token=e);var t,r={};"GET"===f.method&&(c.token&&a.hideToken&&"undefined"==typeof window&&(r["X-Esri-Authorization"]="Bearer "+c.token,delete c.token),t=""===d(c)?o:o+"?"+d(c),a.maxUrlLength&&t.length>a.maxUrlLength||c.token&&a.hideToken?(f.method="POST",e.length&&a.hideToken&&(c.token=e,delete r["X-Esri-Authorization"])):o=t);var n=new RegExp("/items/.+/updateResources").test(o);return"POST"===f.method&&(f.body=l(c,n)),f.headers=h(h({},r),a.headers),"undefined"!=typeof window||f.headers.referer||(f.headers.referer=y),p(c)||n||(f.headers["Content-Type"]="application/x-www-form-urlencoded"),a.fetch(o,f)}).then(function(e){if(!e.ok){var t=e.status,r=e.statusText;throw new m(r,"HTTP "+t,e,o,a)}if(i)return e;switch(c.f){case"json":case"geojson":return e.json();case"html":case"text":return e.text();default:return e.blob()}}).then(function(e){if("json"!==c.f&&"geojson"!==c.f||i)return e;var t,r=g(e,o,0,a,u);return u&&(t=o.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0],a.authentication.trustedServers[t]={token:[],expires:new Date(Date.now()+864e5)},u=null),r})}function R(e){var t=e.split("="),r=t[0],n=t[1];return{key:decodeURIComponent(r),value:decodeURIComponent(n)}}(c=e.ErrorTypes||(e.ErrorTypes={})).ArcGISRequestError="ArcGISRequestError",c.ArcGISAuthError="ArcGISAuthError",e.ArcGISAuthError=f,e.ArcGISRequestError=m,e.NODEJS_DEFAULT_REFERER_HEADER=y,e.appendCustomParams=function(r,e,t){var n=h(h({params:{}},t),r);return n.params=e.reduce(function(e,t){return!r[t]&&"boolean"!=typeof r[t]||(e[t]=r[t]),e},n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce(function(e,t){return n[t]&&(e[t]=n[t]),e},{})},e.checkForErrors=g,e.cleanUrl=function(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e},e.decodeParam=R,e.decodeQueryString=function(e){return e.replace(/^#/,"").split("&").reduce(function(e,t){var r=R(t),n=r.key,o=r.value;return e[n]=o,e},{})},e.encodeFormData=l,e.encodeParam=n,e.encodeQueryString=d,e.processParams=a,e.request=E,e.requiresFormData=p,e.setDefaultRequestOptions=function(e,t){e.authentication&&!t&&o("You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning."),O=e},e.warn=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=request.umd.min.js.map
