System.register(["jimu-core","jimu-core/emotion","jimu-data-source","jimu-for-builder","jimu-layouts/layout-runtime","jimu-theme","jimu-ui","jimu-ui/basic/item-selector"],function(e,t){var s={},a={},i={},o={},r={},l={},n={},d={};return{setters:[function(e){s.AllDataSourceTypes=e.AllDataSourceTypes,s.CONSTANTS=e.CONSTANTS,s.DataSourceComponent=e.DataSourceComponent,s.DataSourceManager=e.DataSourceManager,s.DataSourceStatus=e.DataSourceStatus,s.DataSourceTypes=e.DataSourceTypes,s.EsriFieldType=e.EsriFieldType,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.LayoutItemType=e.LayoutItemType,s.MultipleDataSourceComponent=e.MultipleDataSourceComponent,s.QueryScope=e.QueryScope,s.React=e.React,s.ReactRedux=e.ReactRedux,s.ServiceManager=e.ServiceManager,s.SessionManager=e.SessionManager,s.SignInErrorCode=e.SignInErrorCode,s.SqlExpressionMode=e.SqlExpressionMode,s.SupportedServerTypes=e.SupportedServerTypes,s.appConfigUtils=e.appConfigUtils,s.cancelablePromise=e.cancelablePromise,s.classNames=e.classNames,s.css=e.css,s.dataSourceUtils=e.dataSourceUtils,s.defaultMessages=e.defaultMessages,s.esri=e.esri,s.focusElementInKeyboardMode=e.focusElementInKeyboardMode,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.injectIntl=e.injectIntl,s.lodash=e.lodash,s.moduleLoader=e.moduleLoader,s.polished=e.polished,s.requestUtils=e.requestUtils,s.urlUtils=e.urlUtils,s.utils=e.utils},function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.arcadeDataSourceProfile=e.arcadeDataSourceProfile,i.execArcadeDataSourceScript=e.execArcadeDataSourceScript},function(e){o.getAppConfigAction=e.getAppConfigAction,o.helpUtils=e.helpUtils},function(e){r.searchUtils=e.searchUtils},function(e){l.registerStyles=e.registerStyles,l.styled=e.styled,l.withStyles=e.withStyles,l.withTheme=e.withTheme},function(e){n.AdvancedSelect=e.AdvancedSelect,n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.Collapse=e.Collapse,n.ConfirmDialog=e.ConfirmDialog,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.Label=e.Label,n.Link=e.Link,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.Message=e.Message,n.Modal=e.Modal,n.ModalBody=e.ModalBody,n.ModalFooter=e.ModalFooter,n.ModalHeader=e.ModalHeader,n.MultiSelect=e.MultiSelect,n.MultiSelectItem=e.MultiSelectItem,n.Nav=e.Nav,n.NavItem=e.NavItem,n.NavLink=e.NavLink,n.NumericInput=e.NumericInput,n.PanelHeader=e.PanelHeader,n.Select=e.Select,n.Switch=e.Switch,n.Tab=e.Tab,n.Tabs=e.Tabs,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){d.DataBadge=e.DataBadge,d.ItemSelector=e.ItemSelector,d.ItemTypes=e.ItemTypes}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},4108:e=>{"use strict";e.exports=o},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},7196:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m5.635 9.86 2.168-2.18L8 7.471q.102-.11.185-.233t.138-.258a.7.7 0 0 0 .055-.283.73.73 0 0 0-.244-.558.8.8 0 0 0-.256-.151.9.9 0 0 0-.312-.054.82.82 0 0 0-.583.214.92.92 0 0 0-.276.573l-.993-.082q.03-.401.185-.709.153-.307.398-.512.244-.205.568-.311A2.2 2.2 0 0 1 7.566 5q.38 0 .706.102.327.103.572.304.244.2.386.512.142.311.142.73 0 .549-.24.946-.24.398-.62.758l-1.726 1.664h2.586v.886H5.635zM3.6 6.23 2.55 7.238 2 6.558l1.687-1.46h.86v5.804H3.6zm8.23 1.204h-.244v.886h.229q.212 0 .434.032.22.033.398.128a.8.8 0 0 1 .292.27q.114.177.114.455 0 .204-.075.373a.9.9 0 0 1-.205.287.986.986 0 0 1-.658.25q-.379 0-.6-.197a1.05 1.05 0 0 1-.307-.557l-1.01.278q.096.36.277.62.18.257.43.421.247.164.555.242.307.078.655.078.37 0 .713-.11.343-.111.603-.328.261-.217.414-.537.154-.321.154-.738 0-.54-.276-.935-.276-.393-.812-.475v-.016q.45-.115.702-.48.252-.364.252-.832a1.41 1.41 0 0 0-.536-1.16 1.7 1.7 0 0 0-.568-.29A2.4 2.4 0 0 0 12.076 5q-.307 0-.591.074-.285.074-.52.225-.237.151-.41.39a1.8 1.8 0 0 0-.268.557l1 .279a.95.95 0 0 1 .328-.472.83.83 0 0 1 .508-.168q.355 0 .576.213a.73.73 0 0 1 .22.55.8.8 0 0 1-.094.418.64.64 0 0 1-.248.237 1 1 0 0 1-.347.107 3 3 0 0 1-.398.024" clip-rule="evenodd"></path></svg>'},7543:e=>{"use strict";e.exports=i},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},9869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5M5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 1v9h9V5z" clip-rule="evenodd"></path></svg>'},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},14321:e=>{"use strict";e.exports=n},17727:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="m8 0 8 6-8 6-8-6zM1.887 6 8 10.82 14.113 6 8 1.18zM.563 9 8 14.775 15.437 9l.563.81L8 16 0 9.81z"></path></svg>'},18348:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12.89 6.032q.214.113.442.452l.574-.58q-.31-.493-.67-.698A1.55 1.55 0 0 0 12.454 5q-.48 0-.882.214a2.05 2.05 0 0 0-.69.609 3 3 0 0 0-.454.955 4.4 4.4 0 0 0-.165 1.246q0 .669.165 1.218.164.549.453.94t.691.604.882.214q.456 0 .86-.242.405-.242.686-.774l-.61-.597q-.204.363-.441.528a.85.85 0 0 1-.49.166q-.321 0-.582-.162a1.5 1.5 0 0 1-.448-.443 2.2 2.2 0 0 1-.29-.67 3.3 3.3 0 0 1-.102-.846q0-.427.102-.799.102-.37.29-.649.187-.277.448-.435.26-.158.583-.158.216 0 .43.113m-8.448-.887h-.638L2 10.855h.826L3.2 9.548h1.798l.386 1.307h.843zm-.34 1.21.639 2.322H3.452zm2.59-1.21h1.615q.235 0 .463.077.228.076.407.25.18.173.29.447.111.275.111.662 0 .483-.199.798t-.521.452v.016a.9.9 0 0 1 .36.149q.167.117.284.298.117.182.185.42.067.237.067.512 0 .468-.135.778t-.354.5a1.3 1.3 0 0 1-.504.27 2.1 2.1 0 0 1-.577.08H6.691zm1.41 2.323H7.43V6.016h.61q.42 0 .611.182.19.18.19.552a.73.73 0 0 1-.184.52q-.185.198-.554.198M7.43 9.984h.68q.14 0 .301-.024a.675.675 0 0 0 .518-.367.96.96 0 0 0 .088-.448q0-.45-.214-.629-.213-.177-.664-.177h-.709z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},27416:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="m6 11.943 4 1.711V4.057L6 2.346zm-1 .17V2.494l-4 1.48v9.619zm6 1.393 4-1.48V2.407l-4 1.48zM0 15V3.307L5.75 1.18l4.528 1.937L16 1v11.693l-5.75 2.127-4.528-1.937z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},29282:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#C5C5C5" d="M2.56 12.801a7.284 7.284 0 0 0 11.48 0h.005v-.006a7.27 7.27 0 0 0 0-8.988v-.006h-.004a7.283 7.283 0 0 0-11.482 0h-.004v.006a7.27 7.27 0 0 0 0 8.988v.006zm1.95-8a11.5 11.5 0 0 0-.495 3h-1.99a6.26 6.26 0 0 1 1.04-3zm9.025 0a6.26 6.26 0 0 1 1.04 3h-1.99a11.5 11.5 0 0 0-.495-3zm-1.445 7c.297-.974.464-1.983.495-3h1.99a6.26 6.26 0 0 1-1.04 3zm-4.29 1v1.716a3.32 3.32 0 0 1-1.78-1.716zm-2.225-1a10.3 10.3 0 0 1-.56-3H7.8v3zM8.8 14.517v-1.716h1.78a3.32 3.32 0 0 1-1.78 1.716m0-2.716v-3h2.786a10.3 10.3 0 0 1-.56 3zm2.786-4H8.8v-3h2.225c.335.967.524 1.978.561 3m-2.786-4V2.085c.792.322 1.43.936 1.78 1.716zm-1-1.716v1.716H6.02c.351-.78.988-1.394 1.78-1.716m0 2.716v3H5.014c.038-1.022.227-2.033.561-3zm-3.785 4a11.5 11.5 0 0 0 .495 3H3.065a6.26 6.26 0 0 1-1.04-3zm.881 4q.275.614.662 1.163A6.3 6.3 0 0 1 3.9 12.801zm6.146 1.163q.388-.55.662-1.163h.996a6.3 6.3 0 0 1-1.658 1.163m.662-10.163a7 7 0 0 0-.662-1.163A6.3 6.3 0 0 1 12.7 3.801zM5.558 2.638q-.388.55-.662 1.163H3.9a6.3 6.3 0 0 1 1.66-1.163z"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},33208:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.629 9.143 16 10.286 8 16l-8-5.714 1.371-1.143L8 13.714zM8 0l8 5.714-8 5.715-8-5.715z" clip-rule="evenodd"></path></svg>'},39524:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.5a.5.5 0 0 1 1 0v2.8a.5.5 0 0 1-1 0zm6.028.874a.5.5 0 0 1 .062.705l-1.414 1.685a.5.5 0 1 1-.766-.643l1.414-1.685a.5.5 0 0 1 .704-.062m-10.352.062a.5.5 0 1 0-.766.643l1.414 1.685a.5.5 0 0 0 .766-.643zM6.244 10.6H5.43zM.961 9.8h4.88c.211 0 .359.19.359.4q0 .207.045.4a1.8 1.8 0 0 0 3.51 0h.814a2.6 2.6 0 0 1-5.139 0H.8v3.6h14.4v-3.6H9.755q.045-.194.045-.4c0-.21.148-.4.358-.4h4.881l-2.267-3.4H3.228zm11.81-4.2a.8.8 0 0 1 .666.356l2.429 3.642a.8.8 0 0 1 .134.444V14.2a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1-.8-.8v-4.158a.8.8 0 0 1 .134-.444l2.429-3.642a.8.8 0 0 1 .665-.356z" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=r},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},52030:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 1a2 2 0 0 1 2 2v6.5a.5.5 0 0 1-1 0V3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h6.5a.5.5 0 0 1 0 1H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zm-1.849 10.151a.517.517 0 0 1 .73 0l2.923 2.923a.517.517 0 0 1-.73.73l-2.923-2.922a.517.517 0 0 1 0-.73M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8m0-1a3 3 0 1 1 0-6 3 3 0 0 1 0 6" clip-rule="evenodd"></path></svg>'},54663:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5.5 1a.5.5 0 0 0-.5.5V2H2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1h-3v-.5a.5.5 0 0 0-1 0V2H6v-.5a.5.5 0 0 0-.5-.5M10 3.5V3H6v.5a.5.5 0 0 1-1 0V3H2v2h12V3h-3v.5a.5.5 0 0 1-1 0M14 6H2v8h12zM5 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},56340:e=>{"use strict";e.exports=d},59970:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="m6.262 6.972-.893-.893a.5.5 0 0 1 0-.707l.003-.003a.5.5 0 0 1 .707 0l.893.893.709-.709a1.003 1.003 0 0 0 0-1.419L4.844 1.297a1.003 1.003 0 0 0-1.419 0L1.297 3.425a1.003 1.003 0 0 0 0 1.419L4.134 7.68a1.003 1.003 0 0 0 1.419 0zm1.419 0 1.347 1.347.71-.71a2.006 2.006 0 0 1 2.837 0l2.837 2.838a2.006 2.006 0 0 1 0 2.837l-2.128 2.128a2.006 2.006 0 0 1-2.837 0L7.61 12.575a2.006 2.006 0 0 1 0-2.837l.709-.71-1.347-1.347-.71.71a2.006 2.006 0 0 1-2.837 0L.588 5.552a2.006 2.006 0 0 1 0-2.837L2.716.588a2.006 2.006 0 0 1 2.837 0L8.39 3.425a2.006 2.006 0 0 1 0 2.837zm2.057 2.056.599.6a.5.5 0 0 1 0 .707l-.002.002a.5.5 0 0 1-.707 0l-.6-.6-.709.71a1.003 1.003 0 0 0 0 1.419l2.837 2.837a1.003 1.003 0 0 0 1.419 0l2.128-2.128a1.003 1.003 0 0 0 0-1.419L11.866 8.32a1.003 1.003 0 0 0-1.419 0z"></path></svg>'},60659:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M10.5 1a.5.5 0 0 1 .5.5V2h3a1 1 0 0 1 1 1v5.672A4.5 4.5 0 0 1 8.673 15H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h3v-.5a.5.5 0 0 1 1 0V2h4v-.5a.5.5 0 0 1 .5-.5m1 7a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7M2 14h5.759a4.5 4.5 0 0 1 6.249-6.236L14 7.758V6H2zm0-9h12V3h-3v.5a.5.5 0 0 1-1 0V3H6v.5a.5.5 0 0 1-1 0V3H2z" clip-rule="evenodd"></path><path fill="#000" d="M11.5 9a.5.5 0 0 1 .5.5V11h1.5a.5.5 0 0 1 0 1H11V9.5a.5.5 0 0 1 .5-.5"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},64811:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M7.5 4.5a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3z" clip-rule="evenodd"></path></svg>'},65252:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4.512 12.496H3V4h1.512z"></path><path fill="#000" fill-rule="evenodd" d="M8.808 4a6.7 6.7 0 0 1 1.668.216q.84.216 1.512.72.672.492 1.092 1.308.42.804.42 2.004 0 1.116-.42 1.92t-1.092 1.32-1.512.768q-.84.24-1.668.24H5.796V4zm-1.5 7.176h1.26q.588 0 1.176-.132a3.2 3.2 0 0 0 1.056-.468q.48-.336.78-.9t.3-1.428q0-.912-.3-1.488t-.78-.9a2.8 2.8 0 0 0-1.056-.444 6 6 0 0 0-1.176-.12h-1.26z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M14 .5A1.5 1.5 0 0 1 15.5 2v12a1.5 1.5 0 0 1-1.5 1.5H2A1.5 1.5 0 0 1 .5 14V2A1.5 1.5 0 0 1 2 .5zm-12 1a.5.5 0 0 0-.5.5v12a.5.5 0 0 0 .5.5h12a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5z" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=a},72259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8" clip-rule="evenodd"></path></svg>'},72823:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 1C4.15 1 1 4.15 1 8s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7m1.167 11.667H6.834v-2.334h2.333zm-2.333-4.5V3.333h2.333v4.834z" clip-rule="evenodd"></path></svg>'},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},73549:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.667 4.667 11.333 0 16 4.667l-4.667 4.666zM0 1.333V8h6.667V1.333zM6.667 16H0V9.333h6.667zM8 16V9.333h6.667V16z" clip-rule="evenodd"></path></svg>'},74346:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 12"><path fill="#FFF" fill-rule="nonzero" d="m2 6 4-4H4L0 6l4 4h2zm10-4h-2l4 4-4 4h2l4-4zM8.5 0 6 12h1.5L10 0z"></path></svg>'},75560:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.3 15.6A7.3 7.3 0 1 0 8.3 1a7.3 7.3 0 0 0 0 14.6M8.3 2A6.3 6.3 0 1 1 2 8.3 6.307 6.307 0 0 1 8.3 2m3.5 6.8h-4v-5h1v4h3z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=s},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},95930:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M7.5 4V1.39Q5.854 2.484 4.985 4zm0 3.5V5H4.512a8.1 8.1 0 0 0-.5 2.5zm0 3.5V8.5H4.012a8.1 8.1 0 0 0 .5 2.5zm0 3.61V12H4.985q.869 1.515 2.515 2.61m2.543.087A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M11.015 12H8.5v2.61q1.646-1.095 2.515-2.61m1.974-3.5a9.3 9.3 0 0 1-.441 2.5h1.778c.365-.767.594-1.61.656-2.5zm-1.001 0H8.5V11h2.988a8.1 8.1 0 0 0 .5-2.5m.56-3.5q.381 1.163.441 2.5h1.993a7 7 0 0 0-.656-2.5zm-1.06 0H8.5v2.5h3.488a8.1 8.1 0 0 0-.5-2.5m-1.445-3.697Q11.408 2.473 12.145 4h1.6a7 7 0 0 0-3.702-2.697M8.5 4h2.515Q10.146 2.485 8.5 1.39zm-.527 12a8 8 0 1 1 .055-16 8 8 0 0 1-.055 16M5.957 1.302A7 7 0 0 0 2.255 4h1.6a8.3 8.3 0 0 1 2.102-2.697M3.011 7.5q.06-1.337.441-2.5H1.674a7 7 0 0 0-.656 2.5zm.441 3.5a9.3 9.3 0 0 1-.441-2.5H1.018c.062.89.291 1.733.656 2.5zm2.505 3.697A8.3 8.3 0 0 1 3.855 12h-1.6a7 7 0 0 0 3.702 2.697"></path></svg>'}},t={};function c(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var s in t)c.o(t,s)&&!c.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";c.r(p),c.d(p,{AddDefinitionStatus:()=>ra,AllDataSourceTypes:()=>s.AllDataSourceTypes,DEFAULT_DATA_VIEW_ID:()=>S,DataSourceErrorItem:()=>Bs,DataSourceIdCopyButton:()=>Ps,DataSourceItem:()=>$s,DataSourceList:()=>Nt,DataSourceRemoveWaringReason:()=>Tt,DataSourceRemoveWarningPopup:()=>Lt,DataSourceSelector:()=>Ss,DataSourceTree:()=>le,DataSourceUpdateWarningPopup:()=>ca,DataViewPriority:()=>Hs,DataViewSettingPopup:()=>is,EditAcradePopup:()=>ga,ExternalDataSourceSelector:()=>Je,FieldSelector:()=>ta,FieldSelectorWithFullTextIndex:()=>la,MainDataAndViewSelector:()=>Xs,_DataSourceSelector:()=>gs,dataComponentsUtils:()=>t});var e={};c.r(e),c.d(e,{DataSourceErrorItem:()=>n,DataSourceItem:()=>l,DataSourceList:()=>i,DataSourceRemoveWarningPopup:()=>g,DataSourceSelector:()=>a,DataSourceTree:()=>o,DataViewSettingPopup:()=>h,ExternalDataSourceSelector:()=>r,FieldSelector:()=>d,MainDataAndViewSelector:()=>u});var t={};c.r(t),c.d(t,{editDataSourceJson:()=>W,getAppConfig:()=>P,getDescendantDssAndViews:()=>E,getIconFromFieldType:()=>T,getOriginalDataUrl:()=>z,getOutputDssFromOriginDs:()=>U,getWhetherDataSourceIsInited:()=>_,getWidgetsUsingDescendantDss:()=>A,getWidgetsUsingDsOrItsDescendantDss:()=>V,getWidgetsUsingDsOrItsViews:()=>O,getWidgetsUsingOneDs:()=>L,getWidgetsUsingOutputDsFromOneWidget:()=>J,isFuzzyFromDsIds:()=>R,isFuzzySearch:()=>k,isMapWidget:()=>H});var s=c(79244);function a(e){const t=e.theme;return s.css`
    .component-data-source-selector{
      .font-dark-600{
        color: ${t.ref.palette.neutral[1e3]};
      }
      .font-weight-500{
        font-weight: 500;
      }
      .added-ds-item{
        position: relative;
        .loading-container{
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
        }
        .loading-placeholder{
          width: 100%;
          background-color: ${t.ref.palette.neutral[500]};
          padding: ${s.polished.rem(10)};
          .first-line{
            .first-line-left{
              width: ${s.polished.rem(18)};
              height: ${s.polished.rem(18)};
              background-color: ${t.ref.palette.neutral[600]};
            }
            .first-line-right{
              height: ${s.polished.rem(10)};
              background-color: ${t.ref.palette.neutral[600]};
            }
          }
          .second-line{
            height: ${s.polished.rem(26)};
            background-color: ${t.ref.palette.neutral[600]};
          }
        }
      }
      .data-view-dropdown-menu-button{
        background: ${t.sys.color.secondary.dark};
        text-align: left;
      }
      .dv-select-container{
        margin-top: ${s.polished.rem(12)};
        .jimu-dropdown-button{
          .settings-icon{
            display: none;
          }
        }
      }
      .create-view-button{
        position: relative;
        margin-top: 2px;
        padding-top: 8px;
        .create-view-button-border{
          width: 90%;
          border-top: 1px solid ${t.ref.palette.neutral[700]};
          position: absolute;
          top: 0;
          left: 50%;
          transform: translate(-50%, 0);
        }
      }
      .ds-selector-button{
        height: ${s.polished.rem(40)};
        line-height: ${s.polished.rem(40)};
        padding: 0;
        border: 1px dashed ${t.ref.palette.neutral[800]};
        border-radius: ${s.polished.rem(2)};
        cursor: pointer;
        color: ${t.sys.color.primary.light};
        font-size: ${s.polished.rem(14)};
        text-decoration: none;
        &:hover{
          border-color: ${t.ref.palette.neutral[900]};
          color: ${t.sys.color.primary.light};
        }
      }
      .ds-item.ds-error-item{
        background-color: ${t.sys.color.secondary.main};
        *{
          color: ${t.ref.palette.neutral[900]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.sys.color.secondary.dark};
        }
      }
      .ds-item{
        &:not(:first-of-type) {
          margin-top: ${s.polished.rem(8)};
        }

        padding: ${s.polished.rem(8)} ${s.polished.rem(10)} ${s.polished.rem(10)} ${s.polished.rem(10)};
        background-color: ${t.sys.color.secondary.main};
        cursor: pointer;

        &:hover{
          background-color: ${t.ref.palette.neutral[600]};
        }

        .mr-30{
          margin-right: ${s.polished.rem(30)};
        }

        &.disable-cursor{
          cursor: default;
        }

        .ds-item-close{
          height: 100%;
          cursor: pointer;
          margin-left: ${s.polished.rem(5)};
          margin-right: -5px;
        }

        .ds-item-filter{
          height: 100%;
          cursor: pointer;
        }

        .ds-item-sort{
          height: 100%;
          cursor: pointer;
          margin-left: ${s.polished.rem(5)};
        }

        .ds-thumbnail{
          width:  ${s.polished.rem(18)};
          height:  ${s.polished.rem(18)};
          background-color: ${t.sys.color.info.main};
        }
        .ds-type{
          font-size: ${s.polished.rem(14)};
          color: ${t.ref.palette.neutral[1100]};
        }
        .top-right-red-dot-container{
          position: relative;
        }
        .top-right-red-dot{
          position: absolute;
          top: 0;
          right: 0;
          display: inline-block;
          width: 8px;
          height: 8px;
          border-radius: 4px;
          background-color: ${t.sys.color.error.dark};
        }
      }
    }

  `}function i(e){const t=e.theme;return s.css`
    .component-data-source-list{
      font-size: ${t.ref.typeface.fontSize};
      overflow: hidden;

      .loading-container{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }
      .loading-container-for-label {
        margin-top: -5px;
      }
      .loading-container-for-item {
        margin-top: -2px;
      }

      .ds-item.ds-item-loading {
        overflow: visible;
        background-color: ${t.sys.color.secondary.main};
          *:not(.item-active-icon svg, .ds-close-icon){
            color: ${t.ref.palette.neutral[900]} !important;
          }
          .ds-thumbnail{
            background-color: ${t.ref.palette.neutral[700]};
          }
          .ds-close-icon{
            color: ${t.ref.palette.neutral[1e3]} !important;
          }
        }
      .remove-link-style {
        color: inherit !important;
        text-decoration: none !important;
        background-color: transparent !important;
      }
      .remove-link-style:hover {
          color: inherit !important;
          text-decoration: none !important;
      }

      .data-tabs .tab-content .tab-pane {
        padding-top: 16px;
      }

      .search{
        position: relative;
      }
      .search-input{
        height: 26px;
        border-radius: 2px;
      }
      .search-icon{
        color: ${t.ref.palette.neutral[1e3]};
      }

      .empty-placeholder{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        padding-left: 16px;
        padding-right: 16px;
        .empty-placeholder-text, .empty-placeholder-icon{
          display: table;
          margin: 0 auto;
        }
        .empty-placeholder-text{
          color: ${t.ref.palette.neutral[900]};
          font-size: ${s.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon{
          color: ${t.ref.palette.neutral[800]};
        }
      }

      .jimu-tabs{
        height: 100%;
        .tab-content{
          height: calc(100% - 40px);
        }
        .tab-pane{
          width: 100%;
        }
        .jimu-nav.nav-pills{
            margin: 0 ${s.polished.rem(16)} !important;
          }
      }

      .ds-list-container{
        height: calc(100% - 120px);
      }

      .ds-list{
        height: calc(100% - 20px);
        overflow: auto;
      }

      .ds-list-header{
        width: 100%;
      }

      .ds-add-data{
        position: absolute;
        bottom: 0;
        height: ${s.polished.rem(40)};
        width: 100%;
        color: ${t.sys.color.primary.light};
        font-size: ${s.polished.rem(14)};
        border-top: 1px solid ${t.sys.color.secondary.light};
        cursor: pointer;
        &:hover{
          .add-data-icon-container{
            background-color: ${s.polished.rgba(t.sys.color.primary.light,.8)};
          }
          color: ${s.polished.rgba(t.sys.color.primary.light,.8)};
        }
        .add-data-icon-container{
          width: ${s.polished.rem(20)};
          height: ${s.polished.rem(20)};
          background-color: ${t.sys.color.primary.light};
          border-radius: ${s.polished.rem(10)};
        }
        .add-data-icon{
          color: ${t.ref.palette.neutral[400]};
        }
      }

      .ds-list-close{
        width: ${s.polished.rem(30)};
        height: 100%;
        cursor: pointer;
      }

      .ds-widget-back{
        width: ${s.polished.rem(80)};
        height: ${s.polished.rem(30)};
        cursor: pointer;
      }

      .ds-types{
        color: ${t.ref.palette.black};
        font-size: ${t.ref.typeface.fontSize};
      }

      .ds-remove{
        width: 26px;
        margin-left: -6px;
        display: none;
      }

      .ds-link{
        width: 26px;
        margin-left: -12px;
        display: none;
      }

      .ds-widget-outputs{
        padding: 0;
      }

      .ds-added-data{
        padding: 0;
      }

      .to-use-types{
        color: ${t.ref.palette.black};
        .types-selected{
          max-width: ${s.polished.rem(150)};
        }
        .to-use-dp{
          width: ${s.polished.rem(120)};
          height: ${s.polished.rem(26)};
        }
      }

      .ds-thumbnail{
        width:  ${s.polished.rem(26)};
        height:  ${s.polished.rem(26)};
        background-color: ${t.sys.color.info.main};
      }
      .ds-type{
        font-size: ${s.polished.rem(14)};
        color: ${t.ref.palette.neutral[1100]};
      }
      .ds-item.ds-error-item{
        background-color: ${t.sys.color.secondary.main};
        *{
          color: ${t.ref.palette.neutral[900]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.sys.color.secondary.dark};
        }
      }
      .ds-item{
        border: 1px solid transparent;
        border-radius: 0;
        position: relative;
        left: -2px;
        cursor: pointer;
        .item{
          height: 26px;
          background-color: ${t.sys.color.secondary.main};
          padding-left: 0;
          padding-right: 0;
        }
        .item-active-icon{
          position: absolute;
          top: -1px;
          right: -1px;
          .item-active-icon-container{
            width: 0;
            height: 0;
            border-top: ${s.polished.rem(12)} ${t.sys.color.primary.light} solid;
            border-left: ${s.polished.rem(12)} transparent solid;
            background-color: transparent;
          }
        }
      }
      .ds-item.ds-item-selected{
        border: 1px solid ${t.sys.color.primary.light};
      }
      .ds-item:not(.ds-item-selected):hover{
        .ds-remove{
            display: flex !important;
          }
      }
      .ds-item:hover{
        .ds-link{
            display: flex !important;
          }
      }
    }

  `}function o(e){const t=e.theme;return s.css`
    *{
      margin: 0;
      padding: 0;
    }
    .bg{
      padding: ${s.polished.rem(16)} ${s.polished.rem(2)};
      background-color: ${t.ref.palette.neutral[300]};
      border-top: 2px solid ${t.sys.color.primary.light};
    }
    .tree-root{
      padding-left: ${s.polished.rem(20)};
      padding-right: ${s.polished.rem(5)};
    }
    .component-data-source-tree{
      position: relative;
      .collapse-button{
        position: absolute;
        left: 2px;
        z-index: 1;
      }
      .collapse-content{
        padding-left: ${s.polished.rem(20)};
        padding-top: ${s.polished.rem(16)};
        position: relative;
      }
      .collapse-button:not(.root):not(.leaf){
        left: ${s.polished.rem(-18)};
      }
      .collapse-button.leaf{
        left: 2px;
      }
      .z-index-1 {
        z-index: 1;
      }
      .collapse-button:not(.root):before{
        content: '';
        position: absolute;
        top: 50%;
        left: -2px;
        border-top: 1px solid ${t.ref.palette.neutral[900]};
        width: ${s.polished.rem(21)};
        transform: translateY(-50%);
      }
      .collapse-line{
        border-left: 1px solid ${t.ref.palette.neutral[900]};
        border-bottom: 1px solid ${t.ref.palette.neutral[900]};
        position: absolute;
        top: -2px;
        left: 0;
        z-index: 0;
        transform-origin: top;
        height: 1rem;
        transition: transform 0s;
      }
      .collapse-line:not(.root){
        top: -2px;
      }
    }

  `}function r(e){const t=e.theme;return s.css`
    .component-external-data-source-selector{
      height: 100%;
      overflow: hidden;
      position: relative;

      .selected-ds-loading {
        margin-left: ${s.polished.rem(-25)};
      }

      .added-ds-item{
        position: relative;
        cursor: pointer;
        margin: ${s.polished.rem(16)} ${s.polished.rem(8)} ${s.polished.rem(16)} ${s.polished.rem(10)};
        .ds-thumbnail{
          width:  ${s.polished.rem(26)};
          height:  ${s.polished.rem(26)};
          background-color: ${t.sys.color.info.main};
        }
        .ds-type{
          font-size: ${s.polished.rem(13)};
          color: ${t.ref.palette.neutral[1200]};
        }
        .item{
          height: ${s.polished.rem(26)};
        }
      }

      .added-ds-container{
        width: ${s.polished.rem(300)};
        background-color: ${t.ref.palette.neutral[600]};
        box-shadow: 0 0 10px 4px ${s.polished.rgba(t.ref.palette.white,.3)};
        position: absolute;
        right: 30px;
        bottom: 30px;
        .added-ds-items{
          max-height: ${s.polished.rem(500)};
          overflow-y: auto;
          overflow-x: hidden;
        }
        .small-done-btn{
          max-width: ${s.polished.rem(100)};
        }
      }

      .selector-left{
        @media only screen and (max-width: 1100px){
          &{
            width: ${s.polished.rem(160)};
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: ${s.polished.rem(200)};
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: ${s.polished.rem(260)};
          }
        }
        background-color: ${t.ref.palette.neutral[500]};
        border-right: 1px solid ${t.ref.palette.neutral[700]};
        .selector-left-title{
          padding: ${s.polished.rem(20)} ${s.polished.rem(20)} ${s.polished.rem(27)} ${s.polished.rem(20)};
          margin: 0;
          font-size: ${s.polished.rem(20)};
          color: ${t.ref.palette.neutral[1e3]};
        }
        .nav.nav-underline{
          border: 0;
          .nav-item{
            .nav-link{
              padding: 0;
              border: 0;
              .jimu-nav-link-wrapper{
                display: flex;
                justify-content: flex-start;
                align-items: center;
                padding: ${s.polished.rem(7)} ${s.polished.rem(20)};
                font-size: ${s.polished.rem(16)};
                color: ${t.ref.palette.neutral[1e3]};
              }
            }
          }

          .nav-item:hover{
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.ref.palette.black};
              }
            }
          }

          .nav-item.active-tab{
            background-color: ${t.ref.palette.neutral[500]};
            border-left: 4px solid ${t.sys.color.primary.light};
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.ref.palette.black};
                font-weight: 500;
                padding-left: ${s.polished.rem(16)};
              }
            }
          }
        }
      }

      .selector-right{
        @media only screen and (max-width: 1100px){
          &{
            width: calc(100% - ${s.polished.rem(160)});
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: calc(100% - ${s.polished.rem(200)});
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: calc(100% - ${s.polished.rem(260)});
          }
        }
        .selector-right-header{
          padding: ${s.polished.rem(23)} ${s.polished.rem(20)} ${s.polished.rem(12)} ${s.polished.rem(20)};
        }
        .selector-right-body{
          height: calc(100% - 70px);
          @media only screen and (max-width: 1100px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(25)};
            }
          }
          @media only screen and (min-width: 1100px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(45)};
            }
          }
          @media only screen and (min-width: 1300px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(65)};
            }
          }
        }
        .external-data-source-url-input{
          .url-type-select{
            width: ${s.polished.rem(250)};
          }
          .url-input{
            width: ${s.polished.rem(500)};
          }
          .url-input-add-btn{
            height: ${s.polished.rem(30)};
          }
          .url-input-label{
            font-size: ${s.polished.rem(13)};
            color: ${t.ref.palette.neutral[900]};
            margin-bottom: 12px;
            font-weight: 500;
          }
        }

      }

    }

  `}function l(e){const t=e.theme;return s.css`
    .component-data-source-item{
      background-color: ${t.ref.palette.neutral[500]};
      font-size: ${s.polished.rem(12)};
      border-radius: 2px;
      padding: 0;
      position: relative;
      &:hover{
        background-color: ${s.polished.rgba(t.ref.palette.neutral[600],.8)};
      }
      .font-dark-600{
        color: ${t.ref.palette.neutral[1e3]} !important;
      }
      .loading-container{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }
      .ds-item-header{
        width: 100%;
        height: ${s.polished.rem(38)};
        padding: 0 10px;
        background-color: ${t.ref.palette.neutral[600]};
      }
      .ds-item-body{
        width: 100%;
        height: 100%;
        padding: 14px 10px 6px 10px;
      }
      .two-line-truncate{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        word-break: break-word;
        word-wrap: break-word;
      }
      .ds-more{
        margin-right: ${s.polished.rem(-8)};
      }
      .ds-label{
        font-size: ${s.polished.rem(14)};
        color: ${t.ref.palette.neutral[1100]};
      }
      .ds-type{
        font-size: ${s.polished.rem(13)};
        color: ${t.ref.palette.neutral[1100]};
      }
      .ds-thumbnail{
        width:  ${s.polished.rem(18)};
        height:  ${s.polished.rem(18)};
        background-color: ${t.sys.color.info.main};
      }
      .ds-related-widgets, .ds-child-dss{
        font-size: ${s.polished.rem(13)};
      }
      .warning-icon, .warning-icon>*{
        color: ${t.sys.color.error.dark};
        fill: ${t.sys.color.error.dark};
      }
    }

    .component-data-source-item.component-data-source-item-selected-item{
      border: ${s.polished.rem(2)} solid ${t.sys.color.primary.main};
    }

    .cursor-pointer{
      cursor: pointer;
    }

  `}function n(e){const t=e.theme;return s.css`
    .component-data-source-error-item{
      .component-data-source-item{
        background-color: ${t.sys.color.secondary.main};
        *:not(.ds-badge svg, .ds-close-icon){
          color: ${t.ref.palette.neutral[900]} !important;
        }

        .ds-origin-label{
          max-width: 100%;
        }
        .ds-item-header{
          background-color: ${t.sys.color.secondary.main};
        }
        .ds-thumbnail{
          background-color: ${t.ref.palette.neutral[700]};
        }
        .ds-close-icon{
          color: ${t.ref.palette.neutral[1e3]} !important;
          width: ${s.polished.rem(14)};
          height: ${s.polished.rem(14)};
        }
      }

    }

  `}function d(e){const t=e.theme;return s.css`
    .component-field-selector{
      font-size: ${t.ref.typeface.fontSize};
      .ds-name{
        color: ${t.ref.palette.black};
      }
      .ds-name-label{
        font-size: ${s.polished.rem(14)};
        color: ${t.ref.palette.neutral[900]};
        font-weight: 400;
      }
      .field-data-selected{
        width: 70%;
      }

      .item-selector-search{
        height: ${s.polished.rem(26)};
        position: relative;
      }

      .field-list{
        height: calc(100% - 160px);
        overflow-y: auto;
        .field-item.field-item-selected{
          border: 2px solid ${t.sys.color.primary.main};
        }
        .field-item{
          border: 1px solid transparent;
          cursor: pointer;
          background-color: ${t.ref.palette.neutral[500]};
          user-select: none;
          text-align: left;
          border-radius: 0;
        }
        .field-item:hover{
          background-color: ${t.ref.palette.neutral[500]};
        }
        .field-item:active.field-item:hover{
          background-color: ${t.ref.palette.white};
        }
      }

      .search-input{
        height: ${s.polished.rem(26)};
        width: 100%;
      }

    }

  `}function u(e){const t=e.theme;return s.css`
    .component-main-data-and-view{
      .option-label{
        font-size: ${s.polished.rem(13)};
        font-weight: 500;
        color: ${t.ref.palette.neutral[900]};
      }
    }
  `}function h(e){const t=e.theme;return s.css`
    .data-view-container{
      width: ${s.polished.rem(960)};
      height: ${s.polished.rem(600)};
      border: 0;
    }
    .circle-button{
      width: ${s.polished.rem(32)};
      height: ${s.polished.rem(32)};
      border-radius: ${s.polished.rem(16)};
    }
    .domain-field-icon {
      color: ${t.ref.palette.neutral[1e3]};
      vertical-align: sub;
    }
    .w-38{
      width: 38%;
    }
    .w-62{
      width: 62%;
    }
    .pb-30{
      padding-bottom: ${s.polished.rem(30)};
    }
    .preview-table{
      position: relative;
      padding-left: ${s.polished.rem(30)};
    }
    .setting-table{
      padding-right: ${s.polished.rem(30)};
      border-right-width: 2px;
      border-right-style: solid;
      border-image: linear-gradient(180deg, transparent 0%, ${t.ref.palette.neutral[500]} 52.08%, transparent 100%) 1;
      border-left: 0;
    }
    .table-container{
      height : 100%;
      overflow-x: auto;
      .table-body{
        overflow-y: auto;
        overflow-x: hidden;
        width: fit-content;
      }
      .table-header{
        position: sticky;
        top: 0;
      }
      tr{
        border-top: 1px solid ${t.ref.palette.neutral[500]};
      }
      tr:last-child{
        border-bottom: 1px solid ${t.ref.palette.neutral[500]};
      }
      td, th{
        width: ${s.polished.rem(86)};
        height: ${s.polished.rem(32)};
        display: inline-block !important;
        border-left: 1px solid ${t.ref.palette.neutral[500]};
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 6px 4px;
      }
      td{
        background-color: ${t.ref.palette.neutral[300]};
      }
      th{
        background-color: ${t.ref.palette.neutral[500]};
      }
      td:last-child, th:last-child{
        border-right: 1px solid ${t.ref.palette.neutral[500]};
      }
    }
    .modal-body{
      height: calc(100% - ${s.polished.rem(150)});
      padding: ${s.polished.rem(30)};
      padding-bottom: ${s.polished.rem(14)};
    }
    &.modal-dialog{
      max-width: ${s.polished.rem(960)};
    }
    .modal-header{
      .close{
        display: none;
      }
      .modal-title{
        width: 100%;
        display: flex !important;
        align-items: center !important;
      }
    }

    .jimu-nav{
      margin-bottom: ${s.polished.rem(20)};
    }

    .label{
      font-size: ${s.polished.rem(13)};
      color: ${t.ref.palette.neutral[900]};
    }

    .header{
      height: ${s.polished.rem(54)};
      padding-left: ${s.polished.rem(30)};
      padding-right: ${s.polished.rem(30)};
    }

    .modal-footer{
      padding-left: ${s.polished.rem(30)};
      padding-right: ${s.polished.rem(30)};
    }

    .tab-content{
      height: ${s.polished.rem(426)};
      overflow-y: auto;
    }

    .sql-exp-warning{
      color: ${t.sys.color.error.main};
      font-size: ${t.sys.spacing(4)};
      max-width: ${s.polished.rem(600)};
      .sql-exp-warning-icon{
        color: ${t.sys.color.error.main};
      }
    }

  `}function g(e){const t=e.theme;return s.css`
    &.modal-dialog{
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 480px;
    }
    .modal-content{
      border: 0;
    }
    .modal-header, .modal-body{
      padding-left: 20px;
      padding-right: 20px;
    }
    .modal-footer{
      padding-top: 0;
      padding-bottom: 20px;
    }
    .font-16{
      font-size: ${s.polished.rem(16)};
    }
    .font-14{
      font-size: ${s.polished.rem(14)};
    }
    .font-13{
      font-size: ${s.polished.rem(13)};
    }
    .font-dark-800{
      color: ${t.ref.palette.neutral[1100]};
    }
    .font-dark-600{
      color: ${t.ref.palette.neutral[1e3]};
    }
    .related-widgets{
      width: 100%;
      height: ${s.polished.rem(160)};
      overflow: auto;
      background-color: ${t.ref.palette.neutral[300]};
    }
    .related-outputs{
      width: 100%;
      max-height: ${s.polished.rem(80)};
      overflow: auto;
      background-color: ${t.ref.palette.neutral[300]};
      div.output-ds-label+div.output-ds-label{
        margin-top: ${s.polished.rem(8)};
      }
    }
  `}var m=c(1888);const S="USE_MAIN_DATA_SOURCE";var f=c(14321),v=c(7196),D=c.n(v),b=c(18348),y=c.n(b),w=c(60659),x=c.n(w),I=c(54663),j=c.n(I),M=c(75560),C=c.n(M);const N="CLICK_ME_TO_CLEAR_SELECTION";function T(e,t,a){if(!e||!t)return null;const i=a&&{[s.JimuFieldType.Number]:a.formatMessage({id:"numberField",defaultMessage:f.defaultMessages.numberField}),[s.JimuFieldType.String]:a.formatMessage({id:"stringField",defaultMessage:f.defaultMessages.stringField}),[s.JimuFieldType.Date]:a.formatMessage({id:"dateField",defaultMessage:f.defaultMessages.dateField}),[s.JimuFieldType.DateOnly]:a.formatMessage({id:"dateOnlyField",defaultMessage:f.defaultMessages.dateOnlyField}),[s.JimuFieldType.TimeOnly]:a.formatMessage({id:"timeOnlyField",defaultMessage:f.defaultMessages.timeOnlyField})},o={[s.JimuFieldType.Number]:D(),[s.JimuFieldType.String]:y(),[s.JimuFieldType.Date]:x(),[s.JimuFieldType.DateOnly]:j(),[s.JimuFieldType.TimeOnly]:C()},r={[s.JimuFieldType.Number]:t.sys.color.info.main,[s.JimuFieldType.String]:t.sys.color.success.main,[s.JimuFieldType.Date]:t.sys.color.warning.main,[s.JimuFieldType.DateOnly]:t.sys.color.warning.main,[s.JimuFieldType.TimeOnly]:t.sys.color.warning.main};return{icon:o[e],color:r[e],title:null==i?void 0:i[e]}}function O(e,t,a=!0){if(!e||!t)return[];const i=L(e,t,a),o=s.DataSourceManager.getInstance().getDataSource(e);if(!o)return i;let r=[];return o.getDataViews().forEach(e=>{r=r.concat(L(e.id,t,a))}),Array.from(new Set(i.concat(r)))}function V(e,t,a=!0){if(!e||!t)return[];const i=O(e,t,a),o=s.DataSourceManager.getInstance().getDataSource(e);if(!o)return i;let r=[];return o.isDataSourceSet()&&o.getChildDataSources().forEach(e=>{r=r.concat(V(e.id,t,a))}),Array.from(new Set(i.concat(r)))}function A(e,t,a=!0){if(!e||!t)return[];const i=s.DataSourceManager.getInstance().getDataSource(e);if(!i)return[];let o=[];return i.isDataSourceSet()&&i.getChildDataSources().forEach(e=>{o=o.concat(V(e.id,t,a))}),Array.from(new Set(o))}function L(e,t,a=!1){if(!e||!t)return[];const i=function(e,t){if(!e||!t)return[];return function(e){if(!e)return[];const t=[];return Object.keys(e).forEach(s=>{t.push(e[s])}),t}(t).filter(t=>t&&!1!==t.useDataSourcesEnabled&&t.useDataSources&&t.useDataSources.some(t=>t.dataSourceId===e)).map(e=>e.id)}(e,t),o=a?function(e,t){if(!e||!t)return[];const a=s.DataSourceManager.getInstance().getDataSource(e),i=U(a);let o=[],r=[];return i.forEach(e=>{e&&e.id&&(r=O(e.id,t).map(e=>e.id),o=o.concat(r))}),Array.from(new Set(o))}(e,t):[];return Array.from(new Set(i.concat(o))).map(e=>t[e])}function E(e){var t,a;if(!e)return[];const i=s.DataSourceManager.getInstance().getDataSource(e);if(!i)return[e];let o=[e];return null===(t=i.getDataViews())||void 0===t||t.forEach(e=>{o=o.concat(e.id)}),i.isDataSourceSet()&&(null===(a=i.getChildDataSources())||void 0===a||a.forEach(e=>{o=o.concat(E(e.id))})),o}function k(e,t){return!!e&&(!t||e.toLocaleLowerCase().includes(t.toLocaleLowerCase()))}function R(e,t,s){return!(!e||!e.id)&&(!t&&!s||(t?s?t.includes(e.id)&&!s(e):t.includes(e.id):!s(e)))}function U(e){if(!e||!e.id)return[];const t=P(),a=t&&t.dataSources;let i=[];return a&&Object.keys(a).forEach(t=>{a[t]&&a[t].isOutputFromWidget&&a[t].originDataSources&&a[t].originDataSources.some(t=>t.dataSourceId===e.id)&&(i=i.concat(s.DataSourceManager.getInstance().getDataSource(t)))}),i}function P(){const e=window&&window.jimuConfig&&window.jimuConfig.isBuilder?(0,s.getAppStore)().getState().appStateInBuilder:(0,s.getAppStore)().getState();return e&&e.appConfig}function _(e,t){if(!e)return!!s.DataSourceManager.getInstance();if(t){const s=P();if(Object.keys(t).filter(e=>1===e.split("-").length).filter(e=>{var t;return null===(t=null==s?void 0:s.dataSources)||void 0===t?void 0:t[e]}).length>Object.keys(e).length)return!1}return Object.keys(e).every(e=>{var a,i;if((null===(a=t[e])||void 0===a?void 0:a.instanceStatus)===s.DataSourceStatus.CreateError)return!0;if((null===(i=t[e])||void 0===i?void 0:i.instanceStatus)===s.DataSourceStatus.Created){const t=s.DataSourceManager.getInstance().getDataSource(e);return!(null==t?void 0:t.isDataSourceSet())||t.areChildDataSourcesCreated()}return!1})}function W(e){const t=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);if(!t||!e)return null;let a=t,i=e;for(;a.parentDataSource&&a.jimuChildId;)i=a.parentDataSource.getDataSourceJson().setIn(["childDataSourceJsons",a.jimuChildId],i),a=a.parentDataSource;return function(e,t){return B(function(e,t){if(null==t?void 0:t.isHidden)return e;const a=s.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.id);if(!a||!t)return null;let i=a,o=t;for(;i.parentDataSource;){const t=!o.isHidden;i=i.parentDataSource,o=$(e,i.id),t&&(o=o.set("isHidden",!1),e=F(e,o))}return e}(e,t))}(i,e)}function $(e,t){if(!e)return null;if(e.id===t)return e;const s=Object.values(e.childDataSourceJsons||{});let a=null;for(const e of s){const s=$(e,t);if(s){a=s;break}}return a}function F(e,t){if(!e)return null;if(e.id===t.id)return e.merge(t);let s=e;return Object.keys(e.childDataSourceJsons||{}).forEach(a=>{s=s.setIn(["childDataSourceJsons",a],F(e.childDataSourceJsons[a],t))}),s}function B(e){var t;const a=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);if(!a||!e)return null;let i=e;const o=!!i.isHidden;return a.isDataSourceSet()&&(null===(t=a.getChildDataSources())||void 0===t?void 0:t.length)>0&&a.getChildDataSources().forEach(e=>{var t;let s=null===(t=e.getDataSourceJson())||void 0===t?void 0:t.merge(i.getIn(["childDataSourceJsons",e.jimuChildId])||{});s&&(o&&(s=s.set("isHidden",!0)),i=i.setIn(["childDataSourceJsons",e.jimuChildId],B(s)))}),i}function z(e){var t,a;if(!e)return null;if(e.itemId&&e.portalUrl)return`${e.portalUrl.replace(/\/$/,"")}/home/item.html?id=${e.itemId}`;if(e.url){if(!!(null===(t=s.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url))||void 0===t?void 0:t.owningSystemUrl)){const t=null===(a=s.SessionManager.getInstance().getSessionByUrl(e.url))||void 0===a?void 0:a.token;return t?`${e.url}?token=${t}`:e.url}return e.url}return null}function J(e){var t;let s=[];const a=P(),i=null==a?void 0:a.widgets;if(i){const a=null===(t=i[e])||void 0===t?void 0:t.outputDataSources;a&&a.length>0&&(s=s.concat(e),a.forEach(e=>{Object.keys(i).forEach(t=>{var a,o;(null===(o=null===(a=i[t])||void 0===a?void 0:a.useDataSources)||void 0===o?void 0:o.some(t=>t.mainDataSourceId===e))&&(s=s.concat(J(t)))})}))}return s}function H(e){var t,s,a,i;return e&&"arcgis-map"===(null===(i=null===(a=null===(s=null===(t=P())||void 0===t?void 0:t.widgets)||void 0===s?void 0:s[e])||void 0===a?void 0:a.manifest)||void 0===i?void 0:i.name)}var q=c(67386),G=c(56340);const K=s.dataSourceUtils.dataSourceJsonCreator;var Q;function X(e,t){switch(e){case Q.DataTypeIsNotSupported:return null==t?void 0:t.formatMessage({id:"addDataErrorNotSupported",defaultMessage:f.defaultMessages.addDataErrorNotSupported});case Q.SceneLayerWithoutAssociatedLayer:return null==t?void 0:t.formatMessage({id:"addDataErrorInvalidSceneLayer",defaultMessage:f.defaultMessages.addDataErrorInvalidSceneLayer});case Q.WebMapUnsupportedVersion:return null==t?void 0:t.formatMessage({id:"addDataErrorUnsupportedMap",defaultMessage:f.defaultMessages.addDataErrorUnsupportedMap});case Q.BuildingSceneLayerWithoutAssociatedLayer:return null==t?void 0:t.formatMessage({id:"addDataErrorInvalidBuildingSceneLayer",defaultMessage:f.defaultMessages.addDataErrorInvalidBuildingSceneLayer});default:return null==t?void 0:t.formatMessage({id:"invalidResourceItem",defaultMessage:s.defaultMessages.invalidResourceItem})}}function Y(e,t,a,i,o){return e&&t?(e=e.replace(/^http:/,"https:"),s.requestUtils.requestWrapper(e,o=>s.esri.restRequest.request(e,{authentication:o,httpMethod:"GET"}).then(o=>s.ServiceManager.getInstance().fetchServiceInfo(e).then(o=>{const r=o.definition;if(!r)return Promise.reject(new Error(Q.ItemInaccessible));let l=K.createDataSourceJsonByLayerDefinition(t,r,e);return l=function(e,t,s){if(!e)return null;t&&(e=e.set("portalUrl",t));s&&(e=e.set("itemId",s));return e}(l,a,i),{dsJson:l,label:r.name||s.dataSourceUtils.getLabelFromArcGISServiceUrl(e)}})),1,o)):Promise.reject(new Error(Q.ItemInaccessible))}!function(e){e.DataTypeIsNotSupported="DATA_TYPE_IS_NOT_SUPPORTED_YET",e.ItemInaccessible="ITEM_INACCESSIBLE",e.SceneLayerWithoutAssociatedLayer="SCENE_LAYER_WITHOUT_ASSOCIATED_LAYER",e.BuildingSceneLayerWithoutAssociatedLayer="BUILDING_SCENE_LAYER_WITHOUT_ASSOCIATED_LAYER",e.WebMapUnsupportedVersion="WEBMAP:UNSUPPORTED-VERSION"}(Q||(Q={}));let Z=null;const ee=class extends s.React.PureComponent{constructor(e){super(e),this.__unmounted=!1,this.dataSourceUrlTypes=[{label:this.props.intl.formatMessage({id:"anArcGISServerWebService",defaultMessage:f.defaultMessages.anArcGISServerWebService})}],this.onUrlTypesClicked=e=>{this.setState({selectedDataSourceUrlType:e.target.value})},this.onInputUrl=e=>{this.setState({url:e.target.value})},this.onAdded=()=>{if(this.state.url){const e=this.state.url.split("?")[0];if(!e)return;return this.props.toggleLoadedStatus(!1),Y(e,this.props.getDsId(),null,null,!0).then(e=>{this.props.onAdded(e.dsJson,e.label),this.props.toggleLoadedStatus(!0)},e=>{console.error(e);let t="";(null==e?void 0:e.code)!==s.SignInErrorCode.SignInCanceled&&(t=(null==e?void 0:e.isSignInError)?e.message2:X(e,this.props.intl)),t&&this.props.openToast(t),this.props.toggleLoadedStatus(!0)})}},this.checkServiceUrl=e=>{let t=!1;return(/^https:\/\//.test(e)||/^\/\//.test(e))&&s.dataSourceUtils.isSupportedArcGISService(e,[s.SupportedServerTypes.FeatureService,s.SupportedServerTypes.MapService,s.SupportedServerTypes.SceneService,s.SupportedServerTypes.ImageService])&&(t=!0),{valid:t}},this.state={selectedDataSourceUrlType:this.dataSourceUrlTypes[0],url:"",selectDataHelpUrl:null}}componentDidMount(){this.__unmounted=!1,Z||(Z=s.moduleLoader.loadModule("jimu-for-builder").then(e=>e.helpUtils).then(e=>e.getBuildAppsHelpLink("select-data"))),Z.then(e=>{this.__unmounted||this.setState({selectDataHelpUrl:e})})}componentWillUnmount(){this.__unmounted=!0}render(){const e=this.props.intl.formatMessage({id:"add",defaultMessage:f.defaultMessages.add});return(0,q.jsxs)("div",{className:"external-data-source-url-input",children:[(0,q.jsxs)("div",{className:"mt-4 ml-2",children:[(0,q.jsx)("h5",{className:"url-input-label",children:this.props.intl.formatMessage({id:"serviceType",defaultMessage:f.defaultMessages.serviceType})}),(0,q.jsx)(f.Select,{value:this.state.selectedDataSourceUrlType.label,title:this.state.selectedDataSourceUrlType.label,onChange:this.onUrlTypesClicked,className:"url-type-select",children:this.dataSourceUrlTypes.map(e=>(0,q.jsx)("option",{value:e.label,children:e.label},e.label))})]}),(0,q.jsxs)("div",{className:"mt-5 ml-2",children:[(0,q.jsx)("h5",{className:"url-input-label",children:this.props.intl.formatMessage({id:"url",defaultMessage:f.defaultMessages.url})}),(0,q.jsx)(f.TextInput,{checkValidityOnChange:this.checkServiceUrl,placeholder:"URL",onChange:this.onInputUrl,className:"url-input",value:this.state.url}),(0,q.jsxs)("div",{className:"d-flex",children:[(0,q.jsx)("p",{className:"mt-2 hint-label",children:this.props.intl.formatMessage({id:"addDataByUrlHint",defaultMessage:f.defaultMessages.addDataByUrlHint})}),this.state.selectDataHelpUrl&&(0,q.jsx)(f.Link,{to:this.state.selectDataHelpUrl,className:"ml-2 font-size-12",target:"_blank",children:this.props.intl.formatMessage({id:"details",defaultMessage:f.defaultMessages.details})})]})]}),(0,q.jsx)("div",{className:"mt-4 ml-2",children:(0,q.jsx)(f.Button,{onClick:this.onAdded,type:"primary",disabled:!this.checkServiceUrl(this.state.url).valid,className:"url-input-add-btn px-4",title:e,"aria-label":e,children:e})})]})}};var te=c(72259),se=c.n(te),ae=c(64811),ie=c.n(ae);const oe="first_node_in_collapse";class re extends s.React.PureComponent{constructor(e){var t,a;super(e),this.__unmounted=!1,this.baseFontSize=parseFloat(null===(a=null===(t=getComputedStyle(document.documentElement))||void 0===t?void 0:t.fontSize)||void 0===a?void 0:a.replace("px",""))||16,this.getNeedAutoOpen=e=>{if(!this.props.useDataSources||!e)return!1;if(this.props.useDataSources.some(t=>(null==t?void 0:t.mainDataSourceId)===e.id))return!0;return!!this.props.getChildDataSources(e).some(e=>this.getNeedAutoOpen(e))},this.toggleChildDss=()=>{"boolean"==typeof this.props.isOpen?this.props.toggle&&this.props.toggle():this.setState({isOpen:!this.state.isOpen})},this.drawCollapseLine=()=>{s.lodash.defer(()=>{var e,t;if(this.collapseRef&&this.lastNodeInCollapseRef){const s=this.lastNodeInCollapseRef.querySelector(`.${oe}`)||this.lastNodeInCollapseRef,a=window&&(null===(e=window.getComputedStyle(this.lastNodeInCollapseRef))||void 0===e?void 0:e.paddingTop),i=a?parseFloat(a)+2:0,o=window&&(null===(t=window.getComputedStyle(s))||void 0===t?void 0:t.paddingTop),r=o?parseFloat(o):0;this.__unmounted||this.setState({heightOfCollapseExceptForLastNode:this.collapseRef.offsetHeight-this.lastNodeInCollapseRef.offsetHeight+i,heightOfFirstNodeOfLastNodeInCollapse:s.offsetHeight-r})}this.props.drawCollapseLine&&this.props.drawCollapseLine()})},this.getSelectableChildNodes=e=>{if(!e)return[];return(this.props.getChildDataSources(e)||[]).filter(e=>this.props.isNodeSelectable(e))},this.getChildNodes=e=>{if(!e)return[];return(this.props.getChildDataSources(e)||[]).filter(e=>this.props.isNodeSelectable(e)||this.getChildNodes(e).length>0)},this.getLabel=()=>{const e=this.props.getLabel(this.props.dataSource)||this.props.dataSource.id;return this.props.label?`${this.props.label} / ${e}`:e},this.getHideLineStyle=()=>({transform:`scaleY(${(this.state.heightOfCollapseExceptForLastNode+this.state.heightOfFirstNodeOfLastNodeInCollapse/2)/this.baseFontSize})`}),this.getWhetherUnselectableParentAndChildNodeCanJoin=()=>{if(this.props.isNodeSelectable(this.props.dataSource))return!1;{const e=this.getChildNodes(this.props.dataSource);return!(this.getSelectableChildNodes(this.props.dataSource).length>0)&&1===e.length}},this.getIsOpen=()=>"boolean"==typeof this.props.isOpen?this.props.isOpen:this.state.isOpen,this.getRenderContent=(e,t)=>{var a;if(!this.props.dataSource)return null;const i=this.getChildNodes(this.props.dataSource),o=i.length>0,r=this.props.isNodeSelectable(this.props.dataSource);if(!r&&!o)return null;const l=this.getSelectableChildNodes(this.props.dataSource).length>0,n=this.getLabel(),d=this.getWhetherUnselectableParentAndChildNodeCanJoin(),c=i.map((e,a)=>{var o;return e&&e.id?(0,q.jsx)("div",{ref:e=>{a===i.length-1&&(this.lastNodeInCollapseRef=e)},className:(0,s.classNames)({"pt-4":0!==a}),children:this.props.getChildDataSources(e).length>0?(0,q.jsx)(le,Object.assign({},this.props,{dataSource:e,label:d?n:"",drawCollapseLine:this.drawCollapseLine,isChildTree:!t})):(0,q.jsxs)("div",{className:"d-flex align-items-center",children:[(0,q.jsx)("div",{className:(0,s.classNames)("collapse-button leaf")}),(0,q.jsx)("div",{className:(0,s.classNames)("d-flex align-items-center w-100 z-index-1"),role:"option","aria-selected":null===(o=this.props.useDataSources)||void 0===o?void 0:o.some(t=>(null==t?void 0:t.mainDataSourceId)===e.id),children:this.props.renderSelectableNode&&this.props.renderSelectableNode(e)})]})},e.id):null});return l||r||!d?(0,q.jsxs)("div",{role:"group",children:[(0,q.jsxs)("div",{className:"d-flex align-items-center",children:[(0,q.jsx)("div",{className:(0,s.classNames)("collapse-button",{root:!this.props.isChildTree}),children:o&&(0,q.jsx)(f.Button,{type:"tertiary",icon:!0,size:"sm",onClick:this.toggleChildDss,className:"w-10 px-0 d-flex align-items-center jimu-outline-inside",title:this.getIsOpen()?this.props.intl.formatMessage({id:"collapse",defaultMessage:f.defaultMessages.collapse}):this.props.intl.formatMessage({id:"expand",defaultMessage:f.defaultMessages.expand}),"aria-label":this.getIsOpen()?`${this.props.intl.formatMessage({id:"collapse",defaultMessage:f.defaultMessages.collapse})}. ${this.props.getLabel(this.props.dataSource)}`:`${this.props.intl.formatMessage({id:"expand",defaultMessage:f.defaultMessages.expand})}. ${this.props.getLabel(this.props.dataSource)}`,children:(0,q.jsx)(f.Icon,{icon:this.getIsOpen()?se():ie(),size:"12"})})}),(0,q.jsx)("div",{className:`d-flex align-items-center w-100 z-index-1 ${oe}`,role:r?"option":void 0,"aria-selected":r?null===(a=this.props.useDataSources)||void 0===a?void 0:a.some(e=>(null==e?void 0:e.mainDataSourceId)===this.props.dataSource.id):void 0,children:r?this.props.renderSelectableNode&&this.props.renderSelectableNode(this.props.dataSource):this.props.renderUnselectableNode&&this.props.renderUnselectableNode(n,this.props.dataSource,e)})]}),o&&(0,q.jsxs)(f.Collapse,{isOpen:this.getIsOpen(),className:"collapse-content",ref:e=>{this.collapseRef=e},onEntering:this.drawCollapseLine,onExiting:this.drawCollapseLine,timeout:200,onEntered:this.drawCollapseLine,onExited:this.drawCollapseLine,children:[c,(0,q.jsx)("div",{className:(0,s.classNames)("collapse-line",{root:!this.props.isChildTree}),style:this.getHideLineStyle()})]})]}):o?(0,q.jsx)("div",{role:"group",children:c}):null},this.getWhetherChildTreeIsTheRealRootTree=()=>{const e=this.getWhetherUnselectableParentAndChildNodeCanJoin();return!this.props.isChildTree&&e},this.state={isOpen:"boolean"==typeof this.props.defaultOpen?this.props.defaultOpen:this.getNeedAutoOpen(this.props.dataSource),heightOfFirstNodeOfLastNodeInCollapse:0,heightOfCollapseExceptForLastNode:0}}componentDidMount(){this.intersectionObserver=new IntersectionObserver(e=>{e[0].intersectionRatio>0&&this.drawCollapseLine()}),this.intersectionObserver.observe(this.rootRef)}componentDidUpdate(e){this.props.isNodeSelectable===e.isNodeSelectable&&this.props.getChildDataSources(this.props.dataSource).length===e.getChildDataSources(e.dataSource).length||this.drawCollapseLine()}componentWillUnmount(){this.__unmounted=!0,this.intersectionObserver.disconnect()}render(){const e=this.getWhetherChildTreeIsTheRealRootTree(),t=!this.props.isChildTree&&!e;return(0,q.jsx)("div",{className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className}),ref:e=>{this.rootRef=e},children:(0,q.jsx)("div",{className:(0,s.classNames)("component-data-source-tree",{bg:this.props.useDefaultBackground&&t&&this.getIsOpen()&&this.getChildNodes(this.props.dataSource).length>0,"tree-root":t}),children:this.getRenderContent(t,e)})})}}const le=(0,s.injectIntl)((0,m.withStyles)(re,"DataSourceTree"));var ne=c(62838),de=c.n(ne),ce=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const pe=e=>{const t=window.SVG,{className:a}=e,i=ce(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:de()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var ue=c(73529),he=c.n(ue),ge=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const me=e=>{const t=window.SVG,{className:a}=e,i=ge(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:he()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Se=c(26490),fe=c.n(Se),ve=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const De=e=>{const t=window.SVG,{className:a}=e,i=ve(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:fe()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var be=c(30655),ye=c.n(be),we=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const xe=e=>{const t=window.SVG,{className:a}=e,i=we(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:ye()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ie=c(94064),je=c.n(Ie),Me=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Ce=e=>{const t=window.SVG,{className:a}=e,i=Me(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:je()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ne=c(7543),Te=c(4108),Oe=c(28996),Ve=c.n(Oe),Ae=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Le=e=>{const t=window.SVG,{className:a}=e,i=Ae(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Ve()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ee=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};const ke=m.styled.div`
  position: 'relative';
  .label { font-size: 14px; }
  .editor {
    height: calc(100% - 160px);
  }
  .error-icon { width: 1rem; height: 1rem; }
  .error-msg { color: var(--sys-color-error); }
  .button-content {
    height: 32px;
    width: 80px;
    line-height: 32px;
    .jimu-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      .donut-loading {
        position: static;
        width: 16px;
        height: 16px;
        border: 2px solid var(--ref-palette-neutral-1200);
        border-left-color: var(--sys-color-primary-main);
      }
    }
  }
  .jimu-btn:hover {
    .donut-loading { border-left-color: var(--ref-palette-primary-600); }
  }
  .running-mask {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: transparent;
  }
  .footer {
    margin-top: 2rem;
  }
  arcgis-arcade-editor {
    --arcgis-coding-components-border: 1px solid var(--sys-color-divider-secondary, #585858);
    border-color: var(--sys-color-divider-secondary, #585858);

    calcite-action-bar.main-action-bar,
    arcgis-editor-variables.side-panel,
    arcgis-language-api-panel.side-panel,
    arcgis-arcade-suggestions.side-panel,
    calcite-action-bar.side-action-bar {
      border-color: var(--sys-color-divider-secondary, #585858);
    }

    --calcite-action-background-color-hover: #212121;
    --calcite-color-foreground-3: var(--sys-color-action-pressed);
    --calcite-list-background-color: var(--sys-color-surface-overlay);
    --calcite-list-background-color-hover: #212121;

    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    &.ready {
      opacity: 1;
    }
  }
`;function Re(e){const{onAddDataSource:t,script:a=""}=e,i=s.hooks.useTranslation(),o=s.React.useRef(null),r=s.React.useRef(null),[l,n]=s.React.useState("Arcade data"),[d,c]=s.React.useState(null),[p,u]=s.React.useState(!1),[h,g]=s.React.useState(!1),[m,S]=s.React.useState(a),v=s.hooks.useArcgisArcadeEditor(),D=s.React.useCallback(e=>{e&&(e.componentOnReady().then(()=>{g(!0)}).then(()=>Te.helpUtils.getBuildAppsHelpLink("select-data")).then(e=>function(e){return Ee(this,void 0,void 0,function*(){try{return yield s.urlUtils.createShortUrl(e)}catch(e){console.error("Error creating short URL:",e)}return e})}(e)).then(e=>{S(`// Documentation: ${e}#ESRI_SECTION3_1DD415493CD04EE185B069BED5CBF38C\n\n`)}).catch(e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)}),o.current=e,o.current.profile=Ne.arcadeDataSourceProfile,o.current.testData={profileVariableInstances:{}})},[]);return(0,q.jsxs)(ke,{className:"h-100 flex flex-column",children:[h&&(0,q.jsxs)("div",{role:"group","aria-label":i("name"),children:[(0,q.jsx)("div",{className:"label",children:i("name")}),(0,q.jsx)("div",{className:"d-flex mt-2",children:(0,q.jsx)(f.TextInput,{value:l,onChange:e=>{n(e.target.value)},css:s.css`width: 300px;`})})]}),(0,q.jsx)("div",{className:"mt-5 editor",children:v&&(0,q.jsx)("arcgis-arcade-editor",{ref:D,script:m,onarcgisScriptChange:e=>{const t=e.detail||"";c(null),S(t)},editorOptions:{theme:"vs-dark"},className:(0,s.classNames)({ready:h}),onKeyDown:e=>{p||"Esc"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),r.current.focus())}})}),(0,q.jsxs)("div",{className:"d-flex align-items-center footer",children:[h&&(0,q.jsx)(f.Button,{ref:r,className:"p-0",type:"primary","aria-label":i("add"),onClick:()=>{c(null),u(!0),(0,Ne.execArcadeDataSourceScript)(o.current.script).then(e=>{e.layer||"function"==typeof e.arcadeResult.schema?(t(l,o.current.script,e),o.current.script=""):c(i("unsupportedReturnType")),u(!1)}).catch(e=>{u(!1),c(i("invalidArcadeScript")),console.error(e)})},children:(0,q.jsx)("div",{className:"button-content",children:p?(0,q.jsx)(f.Loading,{type:f.LoadingType.Donut}):i("add")})}),d&&(0,q.jsxs)(s.React.Fragment,{children:[(0,q.jsx)(Le,{className:"ml-4 error-icon",size:"sm",color:"var(--sys-color-error)"}),(0,q.jsx)("div",{role:"alert","aria-live":"assertive",className:"ml-2 error-msg",children:d})]})]}),p&&(0,q.jsx)("div",{className:"running-mask"}),!h&&(0,q.jsx)(f.Loading,{type:f.LoadingType.Secondary})]})}var Ue=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};const Pe=s.dataSourceUtils.dataSourceJsonCreator;var _e;!function(e){e.WebMap="Web Map",e.WebScene="Web Scene",e.Layers="Layers",e.Url="URL",e.Arcade="Arcade"}(_e||(_e={}));const We={[_e.WebMap]:G.ItemTypes.WebMap,[_e.WebScene]:G.ItemTypes.WebScene,[_e.Layers]:[G.ItemTypes.FeatureService,G.ItemTypes.MapService,G.ItemTypes.SceneService,G.ItemTypes.FeatureCollection,G.ItemTypes.GroupLayer,G.ItemTypes.ImageService]},$e={[s.DataSourceTypes.WebMap]:G.ItemTypes.WebMap,[s.DataSourceTypes.WebScene]:G.ItemTypes.WebScene,[s.DataSourceTypes.FeatureLayer]:[G.ItemTypes.WebMap,G.ItemTypes.WebScene,G.ItemTypes.FeatureService,G.ItemTypes.MapService,G.ItemTypes.FeatureCollection],[s.DataSourceTypes.SceneLayer]:[G.ItemTypes.WebScene,G.ItemTypes.SceneService],[s.DataSourceTypes.GroupLayer]:[G.ItemTypes.WebMap,G.ItemTypes.WebScene,G.ItemTypes.MapService,G.ItemTypes.FeatureCollection,G.ItemTypes.GroupLayer],[s.DataSourceTypes.FeatureService]:G.ItemTypes.FeatureService,[s.DataSourceTypes.MapService]:G.ItemTypes.MapService,[s.DataSourceTypes.SceneService]:G.ItemTypes.SceneService,[s.DataSourceTypes.ImageryLayer]:G.ItemTypes.ImageService,[s.DataSourceTypes.ImageryTileLayer]:G.ItemTypes.ImageService,[s.DataSourceTypes.ElevationLayer]:G.ItemTypes.ImageService},Fe={[s.DataSourceTypes.WebMap]:_e.WebMap,[s.DataSourceTypes.WebScene]:_e.WebScene,[s.DataSourceTypes.FeatureLayer]:[_e.WebMap,_e.WebScene,_e.Layers,_e.Url],[s.DataSourceTypes.SceneLayer]:[_e.WebScene,_e.Layers,_e.Url],[s.DataSourceTypes.GroupLayer]:[_e.WebMap,_e.WebScene,_e.Layers,_e.Url],[s.DataSourceTypes.FeatureService]:[_e.Layers,_e.Url],[s.DataSourceTypes.MapService]:[_e.Layers,_e.Url],[s.DataSourceTypes.SceneService]:[_e.Layers,_e.Url],[s.DataSourceTypes.ImageryLayer]:[_e.Layers,_e.Url],[s.DataSourceTypes.ImageryTileLayer]:[_e.Layers,_e.Url],[s.DataSourceTypes.ElevationLayer]:[_e.Layers,_e.Url]},Be={[_e.WebMap]:c(27416),[_e.WebScene]:c(95930),[_e.Layers]:c(17727),[_e.Url]:c(59970),[_e.Arcade]:c(74346)};class ze extends s.React.PureComponent{constructor(e){super(e),this.loadingItemNumber=0,this.tabLabel={[_e.WebMap]:this.props.intl.formatMessage({id:"webMap",defaultMessage:s.defaultMessages.webMap}),[_e.WebScene]:this.props.intl.formatMessage({id:"webScene",defaultMessage:s.defaultMessages.webScene}),[_e.Layers]:this.props.intl.formatMessage({id:"layers",defaultMessage:f.defaultMessages.layers}),[_e.Url]:this.props.intl.formatMessage({id:"url",defaultMessage:f.defaultMessages.url}),[_e.Arcade]:this.props.intl.formatMessage({id:"arcade",defaultMessage:f.defaultMessages.arcade})},this.__unmount=!1,this.getTabTypeFromDsType=e=>e?Array.isArray(Fe[e])?Fe[e]:[Fe[e]]:[],this.getTabIcon=e=>e?Be[e]:null,this.getTabLabel=e=>e?this.tabLabel[e]:null,this.getElementPosition=e=>{if(!e)return null;let t=e.offsetLeft,s=e.offsetTop,a=e.offsetParent;for(;null!==a;)t+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent;return{x:t,y:s}},this.getNextDsId=()=>s.appConfigUtils.getUniqueId("dataSource"),this.onArcadeAdded=(e,t,a)=>{var i,o;const r=this.getNextDsId(),l=(null===(i=a.arcadeResult)||void 0===i?void 0:i.geometryType)||(null===(o=a.layer)||void 0===o?void 0:o.geometryType),n=s.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(l),d=(0,s.Immutable)({id:r,label:e,type:s.DataSourceTypes.FeatureLayer,geometryType:n,arcadeScript:t});this.onDsJsonAdded(d,e)},this.onItemAdded=(e,t)=>Ue(this,void 0,void 0,function*(){const a=this.getNextDsId();try{e=e||[],this.setState({selectedItems:(0,s.Immutable)(e.map(e=>e.id)),partSelectedItems:this.state.partSelectedItems.filter(t=>!e.some(e=>e.id===t))}),this.toggleLoadedStatus(!1);const i=yield this.getDsJsonFromItemOrService(a,t);this.toggleLoadedStatus(!0),this.onDsJsonAdded(i,t.title)}catch(e){this.__unmount||(this.toggleLoadedStatus(!0),this.openToast(X(Q.ItemInaccessible,this.props.intl)),this.setState({selectedItems:this.state.selectedItems.filter(e=>e!==t.id),partSelectedItems:this.state.partSelectedItems.filter(e=>e!==t.id)})),console.error("Failed to add data. ",t,e)}}),this.getDsJsonFromItemOrService=(e,t)=>Ue(this,void 0,void 0,function*(){return t.url&&s.dataSourceUtils.isSupportedSingleArcGISLayerService(t.url)?Y(t.url,e,t.portalUrl,t.id).then(e=>{var s;return t.title?null===(s=e.dsJson)||void 0===s?void 0:s.set("sourceLabel",t.title):e.dsJson}):Pe.createDataSourceJsonByItemInfo(e,t,t.portalUrl)}),this.onItemRemoved=(e,t)=>{this.setState({selectedItems:(0,s.Immutable)(e.map(e=>e.id)),partSelectedItems:this.state.partSelectedItems.filter(e=>e!==t.id)}),this.onDsJsonRemoved(t.id,null)},this.onDsJsonAdded=(e,t)=>Ue(this,void 0,void 0,function*(){var a,i;try{if(!e)throw new Error(X(Q.DataTypeIsNotSupported,this.props.intl));if(this.setState({selectedDss:this.state.selectedDss.concat(e),selectedDssLabels:this.state.selectedDssLabels.concat({id:e.id,label:t})}),yield this.checkSceneLayer(e),yield this.checkImageryLayer(e),yield this.checkBuildingSceneLayer(e),this.state.isSelectedDataCollapseOpen){const t=yield s.DataSourceManager.getInstance().createDataSource(e);t.isDataSourceSet()&&(yield t.childDataSourcesReady()),this.checkCreatedDss([t]),this.__unmount||this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1})}this.props.onSelect&&this.props.onSelect([e])}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||((null===(i=null===(a=null==t?void 0:t.message)||void 0===a?void 0:a.toUpperCase())||void 0===i?void 0:i.includes(Q.WebMapUnsupportedVersion))?this.openToast(X(Q.WebMapUnsupportedVersion,this.props.intl)):(null==t?void 0:t.code)!==s.SignInErrorCode.SignInCanceled&&((null==t?void 0:t.isSignInError)?this.openToast(t.message1):this.openToast(X(Q.ItemInaccessible,this.props.intl))),this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1,selectedDss:this.state.selectedDss.filter(t=>t.id!==(null==e?void 0:e.id)),selectedDssLabels:this.state.selectedDssLabels.filter(t=>t.id!==(null==e?void 0:e.id)),selectedItems:this.state.selectedItems.filter(t=>t!==(null==e?void 0:e.itemId)),partSelectedItems:this.state.partSelectedItems.filter(t=>t!==(null==e?void 0:e.itemId))})),console.error("Failed to create data source. ",e,t)}}),this.clearCacheOfErrorDs=e=>{s.DataSourceManager.getInstance().destroyDataSource(null==e?void 0:e.id),this.__unmount||this.onDsJsonRemoved(null==e?void 0:e.itemId,null==e?void 0:e.id)},this.checkSceneLayer=e=>Ue(this,void 0,void 0,function*(){const t=(null==e?void 0:e.type)===s.DataSourceTypes.SceneLayer;if(e&&t)try{this.toggleLoadedStatus(!1);const t=yield s.DataSourceManager.getInstance().createDataSource(e);this.checkCreatedDss([t]),this.toggleLoadedStatus(!0)}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||(this.toggleLoadedStatus(!0),this.openToast(X(Q.SceneLayerWithoutAssociatedLayer,this.props.intl)),this.setState({selectedDss:this.state.selectedDss.filter(t=>t.id!==e.id),selectedDssLabels:this.state.selectedDssLabels.filter(t=>t.id!==e.id),selectedItems:this.state.selectedItems.filter(t=>t!==e.itemId),partSelectedItems:this.state.partSelectedItems.filter(t=>t!==e.itemId)}))}}),this.checkImageryLayer=e=>Ue(this,void 0,void 0,function*(){const t=(null==e?void 0:e.type)===s.DataSourceTypes.ImageryLayer;if(e&&t)try{this.toggleLoadedStatus(!1);const t=yield s.DataSourceManager.getInstance().createDataSource(e);this.checkCreatedDss([t]),this.toggleLoadedStatus(!0)}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||(this.toggleLoadedStatus(!0),this.setState({selectedDss:this.state.selectedDss.filter(t=>t.id!==e.id),selectedDssLabels:this.state.selectedDssLabels.filter(t=>t.id!==e.id),selectedItems:this.state.selectedItems.filter(t=>t!==e.itemId),partSelectedItems:this.state.partSelectedItems.filter(t=>t!==e.itemId)}))}}),this.checkBuildingSceneLayer=e=>Ue(this,void 0,void 0,function*(){const t=(null==e?void 0:e.type)===s.DataSourceTypes.BuildingSceneLayer;if(e&&t)try{this.toggleLoadedStatus(!1);const t=s.dataSourceUtils.getFullArcGISServiceUrl(null==e?void 0:e.url,!1).replace("SceneServer","FeatureServer");yield s.requestUtils.requestWrapper(t,e=>Ue(this,void 0,void 0,function*(){return yield s.esri.restRequest.request(t,{authentication:e,httpMethod:"GET"})})),this.toggleLoadedStatus(!0)}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||(this.toggleLoadedStatus(!0),this.openToast(X(Q.BuildingSceneLayerWithoutAssociatedLayer,this.props.intl)),this.setState({selectedDss:this.state.selectedDss.filter(t=>t.id!==e.id),selectedDssLabels:this.state.selectedDssLabels.filter(t=>t.id!==e.id),selectedItems:this.state.selectedItems.filter(t=>t!==e.itemId),partSelectedItems:this.state.partSelectedItems.filter(t=>t!==e.itemId)}))}}),this.checkCreatedDss=e=>{null==e||e.forEach(e=>{e&&!this.state.selectedDss.some(t=>t.id===e.id&&(!e.getDataSourceJson().itemId||t.itemId===e.getDataSourceJson().itemId))&&s.DataSourceManager.getInstance().destroyDataSource(e.id)})},this.onDsJsonRemoved=(e,t)=>{if(!e&&!t)return;const a=e?this.state.selectedDss.filter(t=>t.itemId===e):[this.state.selectedDss.find(e=>e.id===t)].filter(e=>e);if(a.length>0){a.forEach(e=>{s.DataSourceManager.getInstance().destroyDataSource(e.id)});const i=this.state.selectedDss.filter(s=>e?s.itemId!==e:s.id!==t);this.setState({selectedDss:i,selectedDssLabels:this.state.selectedDssLabels.filter(e=>i.some(t=>t.id===e.id)),selectedItems:this.state.selectedItems.filter(t=>t!==e),partSelectedItems:this.state.partSelectedItems.filter(t=>t!==e),isSelectedDataCollapseOpen:0!==i.length&&this.state.isSelectedDataCollapseOpen}),this.props.onRemove&&this.props.onRemove(a)}},this.onDsJsonChange=e=>{const t=this.state.selectedDss.findIndex(t=>t.id===e.id),a=this.state.selectedDss.slice();a.splice(t,1,e);const i=s.DataSourceManager.getInstance().getDataSource(e.id);i&&s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(i,e);const o=this.state.selectedItems.concat(this.state.partSelectedItems).find(t=>t===(null==e?void 0:e.itemId));let r=this.state.selectedItems,l=this.state.partSelectedItems;if(o){this.getWhetherIsPartSelected(e)?(r=this.state.selectedItems.filter(t=>e.itemId&&t!==e.itemId),l=this.state.partSelectedItems.concat(o)):(r=this.state.selectedItems.concat(o),l=this.state.partSelectedItems.filter(t=>e.itemId&&t!==e.itemId))}this.setState({selectedDss:a,selectedItems:r,partSelectedItems:l})},this.getWhetherIsPartSelected=e=>{let t=!1;if(null==e?void 0:e.childDataSourceJsons){for(let s=0;s<Object.values(e.childDataSourceJsons).length;s++)if(this.getWhetherIsPartSelected(Object.values(e.childDataSourceJsons)[s])){t=!0;break}}else t=e.isHidden;return t},this.toggleSelectedDataCollapse=()=>{this.state.isSelectedDataCollapseOpen||this.createSelectedDss(),this.setState({isSelectedDataCollapseOpen:!this.state.isSelectedDataCollapseOpen})},this.createSelectedDss=()=>{const e=this.state.selectedDss.filter(e=>!s.DataSourceManager.getInstance().getDataSource(e.id));return e.length>0?Promise.allSettled(e.map(e=>s.DataSourceManager.getInstance().createDataSource(e).then(e=>e.isDataSourceSet()?e.childDataSourcesReady().then(()=>e):e).then(e=>(this.__unmount||this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1}),e)))).then(t=>{var a,i;const o=t.filter(e=>"fulfilled"===e.status).map(e=>e.value),r=t.filter(e=>"rejected"===e.status);if(r.length>0){e.filter(e=>!o.some(t=>t.id===e.id)).forEach(e=>{this.clearCacheOfErrorDs(e)}),r.some(e=>{var t,s,a;return null===(a=null===(s=null===(t=e.reason)||void 0===t?void 0:t.message)||void 0===s?void 0:s.toUpperCase())||void 0===a?void 0:a.includes(Q.WebMapUnsupportedVersion)})?this.openToast(X(Q.WebMapUnsupportedVersion,this.props.intl)):r.some(e=>{var t;return(null===(t=e.reason)||void 0===t?void 0:t.code)===s.SignInErrorCode.SignInCanceled})||(r.some(e=>{var t;return null===(t=e.reason)||void 0===t?void 0:t.isSignInError})?this.openToast(null===(i=null===(a=r.find(e=>{var t;return null===(t=e.reason)||void 0===t?void 0:t.isSignInError}))||void 0===a?void 0:a.reason)||void 0===i?void 0:i.message1):this.openToast(X(Q.ItemInaccessible,this.props.intl)))}return this.checkCreatedDss(o),s.lodash.defer(()=>{this.createSelectedDss()}),Promise.resolve()}):Promise.resolve()},this.onFinish=()=>{this.props.onFinish&&this.props.onFinish(this.state.selectedDss)},this.onCancel=()=>{this.state.selectedDss.forEach(e=>{s.DataSourceManager.getInstance().destroyDataSource(e.id)}),this.setState({selectedDss:[]},()=>{this.props.onCancel&&this.props.onCancel()})},this.onActiveTabChange=e=>{this.setState({activeTab:e})},this.toggleLoadedStatus=e=>{e?this.loadingItemNumber-=1:this.loadingItemNumber+=1,this.loadingItemNumber>0?this.setState({isLoaded:!1}):this.setState({isLoaded:!0})},this.openToast=e=>{this.setState({isToastOpen:!0,errorMsg:e})},this.closeToast=()=>{this.setState({isToastOpen:!1})},this.toggleHideData=(e,t)=>{e&&(t&&t.getDataSourceJson().isHidden?this.onDsJsonChange(function(e){if(!e)return null;let t=e.getDataSourceJson();return t=t.set("isHidden",!1),W(t)}(t)):t&&t.id!==e.id?this.onDsJsonChange(function(e){if(!e)return null;let t=e.getDataSourceJson();return t=t.set("isHidden",!0),W(t)}(t)):this.onDsJsonRemoved(e.itemId,e.id))},this.SelectedDataSourceItem=({rootDsJson:e,dsJson:t,rootDsLabel:a})=>{const i=s.DataSourceManager.getInstance().getDataSource(t.id);return(0,q.jsxs)("div",{className:"added-ds-item",children:[!i&&(0,q.jsx)(f.Loading,{type:f.LoadingType.Donut,width:16,height:16,className:"w-25 selected-ds-loading"}),(0,q.jsx)(le,{dataSource:i||t,isNodeSelectable:()=>!0,renderSelectableNode:t=>this.renderDataItem(t,e,a),getChildDataSources:this.getChildDataSources,getLabel:this.getDataSourceLabel})]})},this.getChildDataSources=e=>e&&e.isDataSourceSet&&e.isDataSourceSet()?e.getChildDataSources():[],this.getDataSourceLabel=e=>(null==e?void 0:e.getLabel)?e.getLabel()||e.id:null,this.getItemTypes=(e,t)=>{const a=We[t];if(e&&0!==e.length){const t=Array.from(new Set(e.asMutable().reduce((e,t)=>e.concat($e[t]),[])));let i=[];return t.forEach(e=>{(Array.isArray(a)?a.some(t=>t===e):e===a)&&(i=i.concat(e))}),(0,s.Immutable)(i)}return Array.isArray(a)?(0,s.Immutable)(a):a},this.getWhetherHideSingleLayer=(e,t)=>!(!e||t!==_e.Layers)&&!e.some(e=>e===s.DataSourceTypes.FeatureLayer||e===s.DataSourceTypes.SceneLayer),this.renderDataItem=(e,t,a)=>{if(!e)return null;const i=e.getDataSourceJson?e.getDataSourceJson():e,o=s.DataSourceManager.getInstance().getDataSource(e.id),r=e.id===(null==t?void 0:t.id)&&a?a:this.getDataSourceLabel(o)||e.id,l=i.isHidden?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:f.defaultMessages.clickToShow}):(null==o?void 0:o.parentDataSource)?this.props.intl.formatMessage({id:"clickToHide",defaultMessage:f.defaultMessages.clickToHide}):this.props.intl.formatMessage({id:"remove",defaultMessage:f.defaultMessages.remove});return(0,q.jsxs)("div",{className:"d-flex align-items-center justify-content-between w-100 item",children:[(0,q.jsxs)("div",{className:"d-flex align-items-center flex-grow-1 text-truncate",title:s.dataSourceUtils.getDsTypeString(null==i?void 0:i.type,this.props.intl),children:[(0,q.jsx)("div",{className:"d-flex justify-content-center align-items-center flex-shrink-0 ds-thumbnail",children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(i),className:"text-default",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",title:r,children:r})]}),(0,q.jsx)("div",{className:"d-flex align-items-center flex-shrink-0",children:(0,q.jsx)(f.Button,{type:"tertiary",size:"sm",icon:!0,onClick:()=>{this.toggleHideData(t,o)},title:l,"aria-label":l,children:i.isHidden?(0,q.jsx)(De,{size:"s"}):(null==o?void 0:o.parentDataSource)?(0,q.jsx)(me,{size:"s"}):(0,q.jsx)(pe,{size:"s"})})})]})},this.getRootDsLabel=e=>{var t;return(null===(t=this.state.selectedDssLabels.find(t=>t.id===(null==e?void 0:e.id)))||void 0===t?void 0:t.label)||(null==e?void 0:e.id)},this.setSearchValue=e=>{this.setState({searchValue:e})},this.onKeyDown=e=>{"Esc"!==e.key&&"Escape"!==e.key||(e.target!==this.closeBtnRef.current&&e.target!==this.doneBtnRef.current?this.doneBtnRef.current?(0,s.focusElementInKeyboardMode)(this.doneBtnRef.current):(0,s.focusElementInKeyboardMode)(this.closeBtnRef.current):e.target===this.doneBtnRef.current?(0,s.focusElementInKeyboardMode)(this.closeBtnRef.current):this.onCancel())},this.leftMenuRef=s.React.createRef(),this.closeBtnRef=s.React.createRef(),this.doneBtnRef=s.React.createRef(),this.state={searchValue:"",selectedDss:[],selectedItems:(0,s.Immutable)([]),partSelectedItems:(0,s.Immutable)([]),selectedDssLabels:[],activeTab:this.props.types&&this.getTabTypeFromDsType(this.props.types[0])?this.getTabTypeFromDsType(this.props.types[0])[0]:_e.WebMap,isLoaded:!0,isToastOpen:!1,isSelectedDataCollapseOpen:!1,loadedSelectedDssVersion:0,errorMsg:""}}componentDidMount(){setTimeout(()=>{(0,s.focusElementInKeyboardMode)(this.closeBtnRef.current)},500)}componentWillUnmount(){this.__unmount=!0}render(){const e=this.SelectedDataSourceItem;let t=[];if(this.props.types){const e=Array.from(new Set(Array.prototype.concat.apply([],this.props.types.map(e=>this.getTabTypeFromDsType(e)).filter(e=>!!e))));t=Object.values(_e).filter(t=>e.includes(t))}else t=Object.values(_e);if((null==t?void 0:t.length)<1)return null;const a=this.props.intl.formatMessage({id:"close",defaultMessage:s.defaultMessages.close}),i=this.state.isSelectedDataCollapseOpen?this.props.intl.formatMessage({id:"down",defaultMessage:f.defaultMessages.down}):this.props.intl.formatMessage({id:"up",defaultMessage:f.defaultMessages.up}),o=this.props.intl.formatMessage({id:"done",defaultMessage:f.defaultMessages.done});return(0,q.jsx)("div",{className:(0,s.classNames)("h-100",{[this.props.className]:!!this.props.className}),onKeyDown:this.onKeyDown,children:(0,q.jsxs)("div",{className:"w-100 component-external-data-source-selector",children:[(0,q.jsxs)("div",{className:"d-flex flex-wrap align-items-stretch w-100 h-100",children:[(0,q.jsxs)("div",{className:"selector-left",ref:this.leftMenuRef,children:[(0,q.jsx)("h3",{className:"selector-left-title",role:"heading",children:this.props.isMultiple?this.props.intl.formatMessage({id:"addData",defaultMessage:f.defaultMessages.addData}):this.props.intl.formatMessage({id:"selectData",defaultMessage:f.defaultMessages.selectData})}),(0,q.jsx)(f.Nav,{underline:!0,vertical:!0,right:!0,className:"selector-left-tabs",children:t.map(e=>(0,q.jsx)(f.NavItem,{className:(0,s.classNames)("w-100 mb-2",{"active-tab":this.state.activeTab===e}),children:(0,q.jsxs)(f.NavLink,{onClick:()=>{this.onActiveTabChange(e)},className:"d-flex",children:[(0,q.jsx)(f.Icon,{icon:this.getTabIcon(e),size:"16",className:"mr-2 flex-shrink-0"}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate text-left",title:this.getTabLabel(e),children:this.getTabLabel(e)})]})},e))})]}),(0,q.jsxs)("div",{className:"selector-right h-100",children:[(0,q.jsx)("div",{className:"selector-right-header w-100 d-flex justify-content-end",children:(0,q.jsx)(f.Button,{type:"tertiary",size:"sm",icon:!0,className:"close-icon",onClick:this.onCancel,title:a,"aria-label":a,ref:this.closeBtnRef,children:(0,q.jsx)(pe,{size:"l"})})}),(0,q.jsx)("div",{className:"selector-right-body w-100",children:t.map((e,t)=>(0,q.jsx)("div",{className:(0,s.classNames)("inner-item-selector-container h-100 w-100",{"d-none":e!==this.state.activeTab}),children:e===_e.Url?(0,q.jsx)(ee,{onAdded:this.onDsJsonAdded,getDsId:this.getNextDsId,intl:this.props.intl,toggleLoadedStatus:this.toggleLoadedStatus,openToast:this.openToast}):e!==_e.Arcade?(0,q.jsx)(G.ItemSelector,{itemType:this.getItemTypes(this.props.types,e),portalUrl:this.props.portalUrl,isMultiple:this.props.isMultiple,onSelect:this.onItemAdded,onRemove:this.onItemRemoved,detailReference:this.leftMenuRef,selectedItems:this.state.selectedItems,partSelectedItems:this.state.partSelectedItems,hideSingleLayer:this.getWhetherHideSingleLayer(this.props.types,e)}):(0,q.jsx)(Re,{onAddDataSource:this.onArcadeAdded})},t))})]})]}),(0,q.jsx)("div",{children:this.state.selectedDss&&this.state.selectedDss.length>0&&(0,q.jsxs)("div",{className:"added-ds-container py-4",children:[(0,q.jsxs)("div",{className:"d-flex justify-content-between align-items-center px-4",children:[(0,q.jsxs)("div",{className:"d-flex align-items-center",children:[(0,q.jsx)("span",{className:"mr-2",children:this.state.selectedDss.length}),(0,q.jsx)("span",{className:"mr-2",children:this.props.intl.formatMessage({id:"selected",defaultMessage:f.defaultMessages.selected})}),(0,q.jsx)(f.Button,{type:"tertiary",size:"sm",icon:!0,onClick:this.toggleSelectedDataCollapse,title:i,"aria-label":i,children:this.state.isSelectedDataCollapseOpen?(0,q.jsx)(xe,{size:"s"}):(0,q.jsx)(Ce,{size:"s"})})]}),(0,q.jsx)("div",{className:"small-done-btn",children:!this.state.isSelectedDataCollapseOpen&&(0,q.jsx)(f.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100",disabled:!this.state.isLoaded,title:o,"aria-label":o,ref:this.doneBtnRef,children:o})})]}),this.state.isSelectedDataCollapseOpen&&(0,q.jsx)("div",{className:"added-ds-items",children:(0,q.jsx)("div",{children:this.state.selectedDss.map((t,s)=>(0,q.jsx)(e,{rootDsJson:t,dsJson:t,rootDsLabel:this.getRootDsLabel(t)},s))})}),this.state.isSelectedDataCollapseOpen&&(0,q.jsx)("div",{className:"big-done-btn w-100 px-4",children:(0,q.jsx)(f.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100",disabled:!this.state.isLoaded,title:o,"aria-label":o,children:o})})]})}),(0,q.jsx)("div",{children:!this.state.isLoaded&&(0,q.jsx)(f.Loading,{type:f.LoadingType.Primary})}),(0,q.jsx)(f.Message,{open:this.state.isToastOpen,autoHideDuration:5e3,message:this.state.errorMsg,withIcon:!0,severity:"error",onClose:this.closeToast})]})})}}const Je=(0,s.injectIntl)((0,m.withStyles)(ze,"ExternalDataSourceSelector"));function He(e,t,s){e.isDataSourceSet()&&e.getChildDataSources().forEach(e=>{e&&e.getDataSourceJson()&&e.id&&(qe(e.getDataSourceJson(),s)&&t.push(e),He(e,t,s))})}function qe(e,t){return!!e&&t.some(t=>e.type&&t===e.type)}function Ge(e,t){const s={};return 0===t.length?Promise.resolve(s):Promise.all(e.filter(e=>e&&e.id&&!e.getDataSourceJson().isHidden&&e.isDataSourceSet()&&!e.isDataView&&!e.isLocal).map(e=>(s[e.id]||(s[e.id]=[]),He(e,s[e.id],t),s[e.id]))).then(()=>(Object.keys(s).forEach(e=>{0===s[e].length&&delete s[e]}),s))}function Ke(e,t){let a=e||[];return t&&Object.keys(t).forEach(e=>{if(!a.some(t=>t.id===e)){const t=s.DataSourceManager.getInstance().getDataSource(e);t&&(a=a.concat(t))}}),a}function Qe(e,t){let s=e||[];return t&&Object.values(t).forEach(e=>{e&&e.length>0&&(s=s.concat(e))}),s}var Xe;function Ye(e,t,a){var i;if(a){if((null==t?void 0:t.length)>0){const a=s.DataSourceManager.getInstance().getDataSource(null===(i=t[0])||void 0===i?void 0:i.dataSourceId),o=null==a?void 0:a.type;return o&&(null==e?void 0:e.includes(o))?(0,s.Immutable)([o]):(null==e?void 0:e[0])?(0,s.Immutable)([e[0]]):null}return(null==e?void 0:e[0])?(0,s.Immutable)([e[0]]):null}return null}function Ze(e){return!!(null==e?void 0:e.getDataSourceJson)}function et(e){var t,a;if(!e)return null;const i={dataSourceId:e.id,mainDataSourceId:e.id},o=Ze(e),r=o?null===(t=e.getRootDataSource())||void 0===t?void 0:t.id:Object.keys((null===(a=P())||void 0===a?void 0:a.dataSources)||{}).find(t=>e.id!==t&&e.id.split("-")[0]===t);r&&(i.rootDataSourceId=r);return(o?e.getDataSourceJson():e).isOutputFromWidget&&(i.mainDataSourceId=o?e.getMainDataSource().id:e.id,i.dataSourceId=s.DataSourceManager.getInstance().getDataViewDataSourceId(i.mainDataSourceId,s.CONSTANTS.OUTPUT_DATA_VIEW_ID),i.dataViewId=s.CONSTANTS.OUTPUT_DATA_VIEW_ID),i}!function(e){e.Added="ADDED",e.Output="OUTPUT"}(Xe||(Xe={}));var tt=c(52030),st=c.n(tt),at=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const it=e=>{const t=window.SVG,{className:a}=e,i=at(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:st()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};class ot extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some(e=>{const t=(null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId);return Ze(this.props.ds)?t===this.props.ds.getMainDataSource().id:t===this.props.ds.id}),this.getDsLabel=()=>{if(!this.props.ds)return"";return(Ze(this.props.ds)?this.props.ds.getLabel():this.props.ds.label||this.props.ds.sourceLabel)||this.props.ds.id},this.onItemClick=e=>{const t=et(this.props.ds);if(Ze(this.props.ds))if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(t)}else{if(this.props.disableSelection)return void(this.props.onClickDisabledDsItem&&this.props.onClickDisabledDsItem());this.onDsSelected(t)}else s.DataSourceManager.getInstance().createDataSourceAndItsDataViewsByUseDataSource(t)},this.onRemoveClick=e=>{var t;this.stopPropagation(e);const a=null===(t=this.props.ds)||void 0===t?void 0:t.id;a&&s.moduleLoader.loadModule("jimu-for-builder").then(e=>{const{getAppConfigAction:t}=e;t().removeDataSource(a).exec(),s.DataSourceManager.getInstance().destroyDataSource(a)})},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDsSelected=e=>{var t;if(!e)return;let a;if(this.props.isMultiple){let i=[e];if(this.props.isBatched){const t=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId);(null==t?void 0:t.isDataSourceSet())&&!this.props.isDataSourceSelectable(t)&&(i=t.getAllChildDataSources().filter(e=>{var t;return this.props.isDataSourceSelectable(e)&&!(null===(t=this.props.useDataSources)||void 0===t?void 0:t.some(t=>t.dataSourceId===e.id))}).map(e=>{var t;return{dataSourceId:e.id,mainDataSourceId:e.id,rootDataSourceId:null===(t=e.getRootDataSource())||void 0===t?void 0:t.id}}))}a=((null===(t=this.props.useDataSources)||void 0===t?void 0:t.asMutable({deep:!0}))||[]).concat(i)}else a=[e];this.props.onChange&&this.props.onChange(a)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;window.isExpressBuilder&&H(this.props.widgetId)&&s.moduleLoader.loadModule("jimu-for-builder").then(t=>{t.getAppConfigAction().removeUseDataSource(e.dataSourceId).exec()});const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)!==e.mainDataSourceId);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){var e,t,a;if(!this.props.ds)return null;const i=this.getWhetherSelected(),o=!Ze(this.props.ds),r=this.getDsLabel(),l=Ze(this.props.ds)?!this.props.ds.getRootDataSource():!!(null===(t=null===(e=P())||void 0===e?void 0:e.dataSources)||void 0===t?void 0:t[this.props.ds.id]),n=window.isExpressBuilder&&l&&H(this.props.widgetId);return(0,q.jsxs)(f.Button,{type:"tertiary",onClick:this.onItemClick,className:(0,s.classNames)("ds-item text-left",{"ds-item-selected":i,"ds-item-loading":o,[this.props.className]:!!this.props.className}),"aria-pressed":i,"aria-label":r,title:r,children:[o&&(0,q.jsx)("div",{className:"loading-container loading-container-for-item",children:(0,q.jsx)(f.Loading,{type:f.LoadingType.Bar})}),(0,q.jsx)("div",{className:(0,s.classNames)({"item-active-icon":i},{"d-none":!i}),children:(0,q.jsx)("div",{className:"text-center item-active-icon-container"})}),(0,q.jsxs)("div",{className:"d-flex align-items-center w-100 item",children:[(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:s.dataSourceUtils.getDsTypeString(null===(a=this.props.ds)||void 0===a?void 0:a.type,this.props.intl),children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(Ze(this.props.ds)?this.props.ds.getDataSourceJson():this.props.ds),className:"text-default m-0",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate px-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",children:r})}),n&&(0,q.jsx)(f.Button,{type:"tertiary",icon:!0,className:"align-items-center justify-content-center flex-shrink-0 remove-link-style ds-link",href:z(Ze(this.props.ds)?this.props.ds.getDataSourceJson():this.props.ds),target:"_blank",onClick:this.stopPropagation,title:this.props.intl.formatMessage({id:"source",defaultMessage:f.defaultMessages.source}),children:(0,q.jsx)(it,{className:"m-0",size:"m"})}),n&&(0,q.jsx)(f.Button,{tag:"div",type:"tertiary",icon:!0,onClick:this.onRemoveClick,className:"align-items-center justify-content-center flex-shrink-0 remove-link-style ds-remove",title:this.props.intl.formatMessage({id:"remove",defaultMessage:f.defaultMessages.remove}),children:(0,q.jsx)(pe,{className:"m-0",size:"s"})})]})]})}}class rt extends s.React.PureComponent{constructor(e){super(e),this.getIsNodeSelectable=()=>e=>{const t=s.DataSourceManager.getInstance().getDataSource(e.id),a=this.props.allToUseDss.some(t=>t.id===e.id);return this.props.isMultiple&&this.props.isBatched&&!a&&(null==t?void 0:t.isDataSourceSet())?t.getAllChildDataSources().some(e=>this.props.allToUseDss.some(t=>t.id===e.id)):a},this.getRootNode=e=>{var t;return(null===(t=e.manifest.properties)||void 0===t?void 0:t.canGenerateMultipleOutputDataSources)?e:this.getChildNodes(e)[0]},this.getChildNodes=e=>{if(e.manifest)return this.props.allToUseRootDss.map(e=>Ze(e)?e.getDataSourceJson():e);{const t=s.DataSourceManager.getInstance().getDataSource(e.id);return(null==t?void 0:t.isDataSourceSet())?t.getChildDataSources().map(e=>e.getDataSourceJson()):[]}},this.getLabel=e=>e.label,this.renderUnselectableNode=(e,t)=>{const s="string"==typeof t.icon?t.icon:t.icon&&t.icon.svg,a="string"==typeof t.icon?null:t.icon&&t.icon.properties&&t.icon.properties.color;return(0,q.jsxs)("div",{className:"d-flex w-100",title:e,children:[(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",children:(0,q.jsx)(f.Icon,{icon:s,color:a,size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",children:e})})]})},this.renderSelectableNode=e=>{if(!e)return null;let t=s.DataSourceManager.getInstance().getDataSource(e.id);return t?(t.getDataSourceJson().isOutputFromWidget&&(t=t.getMainDataSource().getDataView(s.CONSTANTS.OUTPUT_DATA_VIEW_ID)),(0,q.jsx)(ot,{useDataSources:this.props.useDataSources,ds:t,widgetId:this.props.widgetId,isBatched:this.props.isBatched,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,isDataSourceSelectable:e=>this.props.allToUseDss.some(t=>t.id===(null==e?void 0:e.id)),disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100"},t.id)):null},this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={isNodeSelectable:this.getIsNodeSelectable(),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss===this.props.allToUseDss&&e.isBatched===this.props.isBatched&&e.isMultiple===this.props.isMultiple||this.setState({isNodeSelectable:this.getIsNodeSelectable()}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.widgetJson&&this.props.allToUseRootDss?(0,q.jsx)("div",{className:"mb-4",children:(0,q.jsx)(le,{dataSource:this.getRootNode(this.props.widgetJson),useDataSources:this.props.useDataSources,isNodeSelectable:this.state.isNodeSelectable,renderSelectableNode:this.renderSelectableNode,renderUnselectableNode:this.renderUnselectableNode,useDefaultBackground:!0,getChildDataSources:this.getChildNodes,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})}):null}}var lt=c(39524),nt=c.n(lt),dt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const ct=e=>{const t=window.SVG,{className:a}=e,i=dt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:nt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var pt=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};class ut extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{var e;const t=this.props.enableToSelectOutputDsFromSelf?null:this.props.widgetId;this.setToUseDataSources((null===(e=this.props.selectedTypes)||void 0===e?void 0:e.length)?this.props.selectedTypes:this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,t)},this.setToUseDataSources=(e,t,s,a,i,o)=>{const r=this.getToUseRootDss(e,t,s,a,i,o);this.getToUseChildDss(e,t,s,a,i).then(e=>{const t=this.getToUseWidgets(r,e);this.__unmount||this.setState({toUseRootDss:r,toUseChildDss:e,toUseWidgets:t})})},this.getRootDss=()=>{const e=s.DataSourceManager.getInstance().getWidgetGeneratedDataSources();return Object.keys(e).forEach(t=>{e[t]=e[t].filter(e=>e&&e.id&&e.getDataSourceJson())}),e},this.getToUseWidgets=(e,t)=>s.appConfigUtils.getAllWidgets(P()).filter(s=>e[s.id]||this.getRootDss()[s.id]&&this.getRootDss()[s.id].some(e=>!!t[e.id])),this.getToUseRootDss=(e,t,a,i,o,r)=>{const l={};if(t)return l;{const t=this.getRootDss();Object.keys(t).forEach(s=>{const r=t[s].filter(t=>t&&!t.parentDataSource&&qe(t.getDataSourceJson(),e)&&this.isValid(t,a,i,o));r.length>0&&(l[s]||(l[s]=[]),l[s]=l[s].concat(r))});const r={},n=P();Object.keys(n.widgets).filter(e=>n.widgets[e].outputDataSources).forEach(e=>{r[e]=n.widgets[e].outputDataSources.asMutable().map(e=>{var t;return null===(t=null==n?void 0:n.dataSources)||void 0===t?void 0:t[e]}).filter(e=>{var t,a;if(e){const i=s.DataSourceManager.getInstance().getDataSource(e.id);return(null==i?void 0:i.isDataSourceSet())?!i.areChildDataSourcesCreated():!i&&(null===(a=null===(t=this.props.dataSourcesInfo)||void 0===t?void 0:t[e.id])||void 0===a?void 0:a.instanceStatus)!==s.DataSourceStatus.CreateError}return!1})}),Object.keys(r).forEach(e=>{r[e].length>0&&(l[e]||(l[e]=[]),l[e]=l[e].concat(r[e]))})}const n=J(r);return Object.keys(l).forEach(e=>{(0===l[e].length||n.some(t=>t===e))&&delete l[e]}),l},this.getToUseChildDss=(e,t,a,i,o)=>pt(this,void 0,void 0,function*(){let r=[];if(t)r=t.asMutable().map(e=>s.DataSourceManager.getInstance().getDataSource(e));else{const e=this.getRootDss();Object.keys(e).forEach(t=>{r=r.concat(e[t])})}return Ge(r,e).then(e=>{const t={};return Object.keys(e).forEach(s=>{e[s].some(e=>this.isValid(e,a,i,o))&&(t[s]=e[s].filter(e=>this.isValid(e,a,i,o)))}),t})}),this.getToUseChildDssByWidgetId=e=>{const t={};return this.getRootDss()[e].forEach(e=>{t[e.id]||(t[e.id]=[]),t[e.id]=this.state.toUseChildDss[e.id]?t[e.id].concat(this.state.toUseChildDss[e.id]):t[e.id]}),Object.keys(t).forEach(e=>{0===t[e].length&&delete t[e]}),t},this.isValid=(e,t,s,a)=>e&&e.getDataSourceJson()&&e.getDataSourceJson().isOutputFromWidget&&!e.isDataView&&!e.isLocal&&!e.getDataSourceJson().isHidden&&k(e.getLabel(),a)&&R(e.getDataSourceJson(),t,s),this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss(),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&Object.keys(this.state.toUseRootDss).length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={toUseRootDss:null,toUseChildDss:null,toUseWidgets:null}}componentDidMount(){this.__unmount=!1,this.initData()}componentDidUpdate(e,t){e.searchValue===this.props.searchValue&&e.showQueriableDataSourceWithoutFields===this.props.showQueriableDataSourceWithoutFields&&s.lodash.isDeepEqual(e.types,this.props.types)&&s.lodash.isDeepEqual(e.selectedTypes,this.props.selectedTypes)&&s.lodash.isDeepEqual(e.fromRootDsIds,this.props.fromRootDsIds)&&s.lodash.isDeepEqual(e.fromDsIds,this.props.fromDsIds)&&Object.keys(e.dataSourcesInfo||{}).length===Object.keys(this.props.dataSourcesInfo||{}).length||this.initData(),this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(Xe.Output):this.props.removeDataTab(Xe.Output))}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.state.toUseChildDss||!this.state.toUseRootDss||!this.state.toUseWidgets)return null;const a=function(e){return e?e.filter(e=>!!e):(0,s.Immutable)([])}(this.props.types);return(0,q.jsx)("div",{className:"ds-widget-outputs h-100 w-100",children:a&&a.length>0?(0,q.jsx)("div",{className:"h-100",children:this.getWhetherShowList()?(0,q.jsx)("div",{className:"ds-list px-4 pt-1",role:"listbox",children:this.state.toUseWidgets.map(e=>(0,q.jsx)(rt,{widgetJson:e,isBatched:this.props.isBatched,allToUseDss:Qe(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),allToUseRootDss:Ke(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),useDataSources:this.props.useDataSources,isMultiple:this.props.isMultiple,intl:this.props.intl,widgetId:this.props.widgetId,onChange:this.props.onChange,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,isSearching:!!this.props.searchValue},e.id))}):(0,q.jsx)("div",{children:(null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&(0,q.jsxs)("div",{className:"empty-placeholder w-100",children:[(0,q.jsx)("div",{className:"empty-placeholder-icon",children:(0,q.jsx)(ct,{size:48})}),(0,q.jsx)("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${this.props.intl.formatMessage({id:"noWidgetOutputCanBeUsed",defaultMessage:f.defaultMessages.noWidgetOutputCanBeUsed})}<br/>${this.props.intl.formatMessage({id:"pleaseAddData",defaultMessage:f.defaultMessages.pleaseAddData})}`}})]})})}):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:f.defaultMessages.noSelectedType})})}}class ht extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some(e=>((null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId))===this.props.dsId),this.getUseDs=()=>({dataSourceId:this.props.dsId,mainDataSourceId:this.props.dsId}),this.onItemClick=()=>{if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(this.getUseDs())}else{if(this.props.disableSelection)return;this.onDsSelected(this.getUseDs())}},this.onDsSelected=e=>{if(!e)return;let t;t=this.props.useDataSources&&this.props.isMultiple?this.props.useDataSources.asMutable({deep:!0}).concat(e):[e],this.props.onChange&&this.props.onChange(t)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.dataSourceId)!==e.dataSourceId);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){var e;if(!this.props.dsId)return null;const t=this.getWhetherSelected(),a=null===(e=P())||void 0===e?void 0:e.dataSources,i=a&&a[this.props.dsId];if(!i)return null;const o=i.label||i.sourceLabel||i.id||"";return(0,q.jsx)("div",{onClick:this.onItemClick,className:(0,s.classNames)("ds-item ds-error-item",{"ds-item-selected":t,[this.props.className]:!!this.props.className}),children:(0,q.jsxs)("div",{className:"d-flex align-items-center w-100 item",children:[(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(i),className:"text-default",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",title:o,children:o})})]})})}}class gt extends s.React.PureComponent{constructor(e){super(e),this.getIsNodeSelectable=()=>e=>{const t=this.props.allToUseDss.some(t=>t.id===e.id);return this.props.isMultiple&&this.props.isBatched&&!t&&e.isDataSourceSet()?e.getAllChildDataSources().some(e=>this.props.allToUseDss.some(t=>t.id===e.id)):t},this.renderDsItem=e=>(0,q.jsx)(ot,{useDataSources:this.props.useDataSources,ds:e,widgetId:this.props.widgetId,isBatched:this.props.isBatched,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100",onClickDisabledDsItem:this.props.onClickDisabledDsItem,isDataSourceSelectable:e=>this.props.allToUseDss.some(t=>t.id===(null==e?void 0:e.id))},e.id),this.renderDsLabel=(e,t,a)=>{const i=a?this.props.ds:t,o=Ze(i),r=o?i:s.DataSourceManager.getInstance().getDataSource(i.id),l=a&&(null==r?void 0:r.isDataSourceSet())&&!r.areChildDataSourcesCreated();return(0,q.jsxs)("div",{className:"d-flex w-100",title:e,children:[l&&(0,q.jsx)("div",{className:"loading-container loading-container-for-label",children:(0,q.jsx)(f.Loading,{type:f.LoadingType.Bar})}),(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:s.dataSourceUtils.getDsTypeString(null==i?void 0:i.type,this.props.intl),children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(o?i.getDataSourceJson():i),className:"text-default",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",children:e})})]})},this.getChildDataSources=e=>Ze(e)&&(null==e?void 0:e.isDataSourceSet())?e.getChildDataSources():[],this.getLabel=e=>Ze(e)?(null==e?void 0:e.getLabel())||(null==e?void 0:e.id):e.label||e.sourceLabel||e.id,this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={isNodeSelectable:this.getIsNodeSelectable(),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss===this.props.allToUseDss&&e.isBatched===this.props.isBatched&&e.isMultiple===this.props.isMultiple||this.setState({isNodeSelectable:this.getIsNodeSelectable()}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.ds?(0,q.jsx)("div",{className:"mb-4",children:(0,q.jsx)(le,{dataSource:this.props.ds,useDataSources:this.props.useDataSources,isNodeSelectable:this.state.isNodeSelectable,renderSelectableNode:this.renderDsItem,renderUnselectableNode:this.renderDsLabel,useDefaultBackground:!0,getChildDataSources:this.getChildDataSources,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})}):null}}class mt extends s.React.PureComponent{constructor(e){super(e),this.dsManager=s.DataSourceManager.getInstance(),this.getWhetherShowSingleDss=()=>this.props.rootDss&&this.props.rootDss.length>0,this.getSelectedErrorDss=()=>this.props.useDataSources?this.props.useDataSources.asMutable().filter(e=>!(this.dsManager&&this.dsManager.getDataSource(null==e?void 0:e.mainDataSourceId))).map(e=>e.mainDataSourceId):null,this.state={isTypeDropdownOpen:!1,selectedErrorDss:null}}componentDidMount(){if(this.props.showErrorDss){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}componentDidUpdate(e){if(this.props.showErrorDss&&(!this.state.selectedErrorDss||0===this.state.selectedErrorDss.length)&&(!e.useDataSources||0===e.useDataSources.length)&&this.props.useDataSources&&0!==this.props.useDataSources.length){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}render(){return(0,q.jsxs)("div",{className:"ds-list px-4 pt-1",role:"listbox",children:[this.props.showErrorDss&&this.state.selectedErrorDss&&this.state.selectedErrorDss.map(e=>(0,q.jsx)(ht,{useDataSources:this.props.useDataSources,dsId:e,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,className:"mb-4 ml-5",widgetId:this.props.widgetId},e)),this.getWhetherShowSingleDss()&&s.dataSourceUtils.getSortedArrayByLabel(this.props.rootDss).map(e=>e&&e.id?(0,q.jsx)(gt,{useDataSources:this.props.useDataSources,ds:e,isBatched:this.props.isBatched,onChange:this.props.onChange,isMultiple:this.props.isMultiple,allToUseDss:this.props.allToUseDss,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:this.props.isSearching,onClickDisabledDsItem:this.props.onClickDisabledDsItem},e.id):null)]})}}var St=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};class ft extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{var e;this.setToUseDataSources((null===(e=this.props.selectedTypes)||void 0===e?void 0:e.length)?this.props.selectedTypes:this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,this.props.showQueriableDataSourceWithoutFields)},this.setHasErrorDss=e=>{this.setState({hasErrorSelectedDss:e})},this.setToUseDataSources=(e,t,s,a,i,o)=>{const r=this.getToUseRootDss(e,t,s,a,i,o);this.getToUseChildDss(e,t,s,a,i,o).then(e=>{this.__unmount||this.setState({toUseRootDss:r,toUseChildDss:e})})},this.getRootDss=()=>s.DataSourceManager.getInstance().getConfiguredDataSources().filter(e=>e&&e.id&&e.getDataSourceJson()&&!e.parentDataSource),this.getToUseRootDss=(e,t,a,i,o,r)=>{var l;if(t)return[];{const t=s.DataSourceManager.getInstance().getConfiguredDataSources().filter(t=>t&&!t.parentDataSource&&t.id===t.getMainDataSource().id&&qe(t.getDataSourceJson(),e)&&this.isValidInProps(t.getDataSourceJson(),a,i,o,r)&&this.isValidInMode(t.getDataSourceJson())),n=Object.values((null===(l=P())||void 0===l?void 0:l.dataSources)||{}).filter(l=>{var n,d;if(!l||l.isOutputFromWidget||!this.isValidInMode(l)||t.some(e=>e.id===l.id))return!1;{const t=s.DataSourceManager.getInstance().getDataSource(l.id);return(null==t?void 0:t.isDataSourceSet())?!t.areChildDataSourcesCreated()&&!t.getAllChildDataSources().some(t=>qe(t.getDataSourceJson(),e)&&this.isValidInProps(t.getDataSourceJson(),a,i,o,r)):!t&&(null===(d=null===(n=this.props.dataSourcesInfo)||void 0===n?void 0:n[l.id])||void 0===d?void 0:d.instanceStatus)!==s.DataSourceStatus.CreateError}});return n.concat(t)}},this.getToUseChildDss=(e,t,a,i,o,r)=>St(this,void 0,void 0,function*(){let l;return l=t?t.asMutable().map(e=>s.DataSourceManager.getInstance().getDataSource(e)):this.getRootDss(),Ge(l,e).then(e=>{const t={};return Object.keys(e).forEach(l=>{var n;this.isValidInMode(null===(n=s.DataSourceManager.getInstance().getDataSource(l))||void 0===n?void 0:n.getDataSourceJson())&&e[l].some(e=>this.isValidInProps(null==e?void 0:e.getDataSourceJson(),a,i,o,r))&&(t[l]=e[l].filter(e=>this.isValidInProps(null==e?void 0:e.getDataSourceJson(),a,i,o,r)))}),t})}),this.isValidInProps=(e,t,a,i,o)=>{var r;if(!e)return!1;if(o)return!e.isOutputFromWidget&&!e.isHidden&&k(e.label||e.sourceLabel||e.id,i)&&R(e,t,a);{const o=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id),l=!!(null==o?void 0:o.query),n=Object.keys((null===(r=null==o?void 0:o.getSchema())||void 0===r?void 0:r.fields)||{}).length>0;return(!l||n)&&!e.isOutputFromWidget&&!e.isHidden&&k(e.label||e.sourceLabel||e.id,i)&&R(e,t,a)}},this.isValidInMode=e=>{var t,s;return!window.isExpressBuilder||(H(this.props.widgetId)||(null===(s=L(e.id,null===(t=P())||void 0===t?void 0:t.widgets))||void 0===s?void 0:s.some(e=>H(e.id))))},this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss()||!(!this.state.hasErrorSelectedDss||!this.props.useDataSources),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&this.state.toUseRootDss.length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={toUseRootDss:null,toUseChildDss:null,hasErrorSelectedDss:!0}}componentDidMount(){this.__unmount=!1,this.initData()}componentDidUpdate(e,t){e.searchValue===this.props.searchValue&&e.showQueriableDataSourceWithoutFields===this.props.showQueriableDataSourceWithoutFields&&s.lodash.isDeepEqual(e.types,this.props.types)&&s.lodash.isDeepEqual(e.selectedTypes,this.props.selectedTypes)&&s.lodash.isDeepEqual(e.fromRootDsIds,this.props.fromRootDsIds)&&s.lodash.isDeepEqual(e.fromDsIds,this.props.fromDsIds)&&Object.keys(e.dataSourcesInfo||{}).length===Object.keys(this.props.dataSourcesInfo||{}).length&&Object.keys(e.dataSourcesInfo||{}).filter(t=>[s.DataSourceStatus.Created,s.DataSourceStatus.CreateError].includes(e.dataSourcesInfo[t].instanceStatus)).length===Object.keys(this.props.dataSourcesInfo||{}).filter(e=>[s.DataSourceStatus.Created,s.DataSourceStatus.CreateError].includes(this.props.dataSourcesInfo[e].instanceStatus)).length||this.initData(),this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(Xe.Added):this.props.removeDataTab(Xe.Added))}componentWillUnmount(){this.__unmount=!0}render(){var e,t;const a=function(e){return e?e.filter(e=>!!e):(0,s.Immutable)([])}(this.props.types);return(0,q.jsx)("div",{className:"ds-added-data h-100 w-100",children:a&&a.length>0?(0,q.jsx)("div",{className:"h-100",children:this.getWhetherShowList()?(0,q.jsx)(mt,{rootDss:Ke(this.state.toUseRootDss,this.state.toUseChildDss),allToUseDss:Qe(this.state.toUseRootDss,this.state.toUseChildDss),onChange:this.props.onChange,isMultiple:this.props.isMultiple,changeHasErrorSelectedDss:this.setHasErrorDss,useDataSources:this.props.useDataSources,showErrorDss:this.props.isDataSourceInited,isBatched:this.props.isBatched,disableRemove:this.props.disableRemove,disableSelection:this.props.disableSelection,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:!!this.props.searchValue,onClickDisabledDsItem:this.props.onClickDisabledDsItem}):(0,q.jsx)("div",{children:(null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&(0,q.jsxs)("div",{className:"empty-placeholder w-100",children:[(0,q.jsx)("div",{className:"empty-placeholder-icon",children:(0,q.jsx)(ct,{size:48})}),(0,q.jsx)("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${window.isExpressBuilder?this.props.intl.formatMessage({id:"noDataCanBeUsedPleaseSelectDataForMap",defaultMessage:f.defaultMessages.noDataCanBeUsedPleaseSelectDataForMap}):this.props.intl.formatMessage({id:"noDataIsAvailableForWidgetPleaseEnsureCorrectData",defaultMessage:f.defaultMessages.noDataIsAvailableForWidgetPleaseEnsureCorrectData})}`}})]})})}):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:f.defaultMessages.noSelectedType})})}}class vt extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherDisableSelectionType=e=>e.length<=1,this.onTypeSelected=e=>{const t=e.target.value;let a;a="All"===t?null:(0,s.Immutable)([t]),this.props.onTypeSelected(a)}}render(){var e;const t=this.props.toUseTypes?(0,s.Immutable)(Array.from(new Set(this.props.toUseTypes.asMutable()))):(0,s.Immutable)([]),a=this.props.hideAllOptionOfTypeDropdown;return(0,q.jsxs)("div",{className:"d-flex justify-content-between align-items-center to-use-types",children:[(0,q.jsx)("div",{className:"mr-2 w-25 text-truncate",title:this.props.intl.formatMessage({id:"type",defaultMessage:f.defaultMessages.type}),children:this.props.intl.formatMessage({id:"type",defaultMessage:f.defaultMessages.type})}),this.getWhetherDisableSelectionType(t)?(0,q.jsx)("div",{className:"types-selected text-truncate mr-1",title:s.dataSourceUtils.getDsTypeString(t[0],this.props.intl),children:s.dataSourceUtils.getDsTypeString(t[0],this.props.intl)}):(0,q.jsxs)(f.Select,{size:"sm",value:(null===(e=this.props.selectedTypes)||void 0===e?void 0:e[0])||"All",onChange:this.onTypeSelected,className:"flex-shrink-0 to-use-dp",title:this.props.intl.formatMessage({id:"type",defaultMessage:f.defaultMessages.type}),children:[(i=t.asMutable(),i.sort((e,t)=>null==e?void 0:e.localeCompare(t))).map(e=>(0,q.jsx)("option",{value:e,children:s.dataSourceUtils.getDsTypeString(e,this.props.intl)},e)),!a&&t&&t.length>1&&(0,q.jsx)("option",{value:"All",children:this.props.intl.formatMessage({id:"all",defaultMessage:f.defaultMessages.all})})]})]});var i}}var Dt=c(23662),bt=c.n(Dt),yt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const wt=e=>{const t=window.SVG,{className:a}=e,i=yt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:bt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var xt=c(50170),It=c.n(xt),jt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Mt=e=>{const t=window.SVG,{className:a}=e,i=jt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:It()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};class Ct extends s.React.PureComponent{constructor(e){super(e),this.externalDsStyle={width:"100%",height:"100%",maxWidth:"5000px",margin:0},this.__unmount=!1,this.showExternalDs=()=>{this.setState({isExternalDsShown:!0})},this.addDataTab=e=>{this.props.hideTabs||this.state.dataTabs.some(t=>t===e)||this.setState({dataTabs:this.state.dataTabs.concat(e)})},this.removeDataTab=e=>{!this.props.hideTabs&&this.state.dataTabs.some(t=>t===e)&&this.setState({dataTabs:this.state.dataTabs.filter(t=>t!==e)})},this.onActiveTabChange=e=>{this.setState({activeTab:e})},this.onAddDataFinished=e=>{if(e&&0!==e.length)if(this.state.getAppConfigAction){(0,this.state.getAppConfigAction)().addDataSources(e).exec(),Promise.all(e.map(e=>s.DataSourceManager.getInstance().createDataSource(e))).then(e=>{var t,s;return null===(s=(t=this.props).onNewDataAdded)||void 0===s||s.call(t,e.map(e=>et(e))),Promise.allSettled(e.map(e=>e.isDataSourceSet()&&!e.getRootDataSource()?e.childDataSourcesReady().then(()=>e):e))}).catch(e=>{var t,a;(null===(a=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toUpperCase())||void 0===a?void 0:a.includes(Q.WebMapUnsupportedVersion))?this.setState({errorMsg:this.props.intl.formatMessage({id:"addDataErrorUnsupportedMap",defaultMessage:f.defaultMessages.addDataErrorUnsupportedMap})}):(null==e?void 0:e.code)!==s.SignInErrorCode.SignInCanceled&&((null==e?void 0:e.isSignInError)?this.setState({errorMsg:e.message1}):this.setState({errorMsg:this.props.intl.formatMessage({id:"invalidResourceItem",defaultMessage:s.defaultMessages.invalidResourceItem})})),setTimeout(()=>{this.setState({errorMsg:null})},5e3)}),this.props.changeInitStatus&&this.props.changeInitStatus(!1),this.__unmount||this.setState({isExternalDsShown:!1,activeTab:this.state.dataTabs.some(e=>e===Xe.Added)?Xe.Added:this.state.activeTab})}else console.error("Can not load jimu-for-builder");else this.setState({isExternalDsShown:!1})},this.onSelectDataCanceled=()=>{this.setState({isExternalDsShown:!1})},this.onToggleExternalDs=()=>{this.setState({isExternalDsShown:!this.state.isExternalDsShown})},this.onSearchValueChange=e=>{this.setState({searchValue:e.target.value})},this.setSelectedType=e=>{this.setState({selectedTypes:e})},this.ExternalDs=(0,q.jsx)(Je,{portalUrl:(0,s.getAppStore)().getState().portalUrl,onCancel:this.onSelectDataCanceled,onFinish:this.onAddDataFinished,isMultiple:!0,types:this.props.types}),this.allowAddNewData=()=>{const e=!this.props.disableAddData&&!this.props.hideAddDataButton,t=!window.isExpressBuilder,s=H(this.props.widgetId);return e&&(t||s)},this.isMapInExpressMode=()=>window.isExpressBuilder&&H(this.props.widgetId);const t=[Xe.Added,Xe.Output].filter(e=>{var t;return!(null===(t=this.props.hideTabs)||void 0===t?void 0:t.includes(e))});this.state={isExternalDsShown:!1,getAppConfigAction:null,searchValue:"",dataTabs:t,activeTab:t[0],selectedTypes:Ye(this.props.types,this.props.useDataSources,this.props.hideAllOptionOfTypeDropdown),errorMsg:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})})}componentDidUpdate(e){e.types!==this.props.types&&this.setSelectedType(Ye(this.props.types,this.props.useDataSources,this.props.hideAllOptionOfTypeDropdown))}componentWillUnmount(){this.__unmount=!0}render(){var e;if(!s.DataSourceManager.getInstance())return null;const t=1===this.state.dataTabs.length&&this.state.dataTabs[0]===Xe.Added,a=1===this.state.dataTabs.length&&this.state.dataTabs[0]===Xe.Output,i=(0,q.jsx)(ft,{types:this.props.types,selectedTypes:this.state.selectedTypes,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,widgetId:this.props.widgetId,searchValue:this.state.searchValue,fromDsIds:this.props.fromDsIds,dataSourcesInfo:this.props.dataSourcesInfo,hideDs:this.props.hideDs,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown,showQueriableDataSourceWithoutFields:this.props.showQueriableDataSourceWithoutFields,onClickDisabledDsItem:this.props.onClickDisabledDsItem,isBatched:this.props.isBatched}),o=(0,q.jsx)(ut,{types:this.props.types,selectedTypes:this.state.selectedTypes,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,searchValue:this.state.searchValue,dataSourcesInfo:this.props.dataSourcesInfo,widgetId:this.props.widgetId,fromDsIds:this.props.fromDsIds,isBatched:this.props.isBatched,hideDs:this.props.hideDs,enableToSelectOutputDsFromSelf:this.props.enableToSelectOutputDsFromSelf,showQueriableDataSourceWithoutFields:this.props.showQueriableDataSourceWithoutFields,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown}),r=(0,q.jsxs)(f.Tabs,{type:"pills",fill:!0,className:"data-tabs",value:this.state.activeTab,onChange:this.onActiveTabChange,children:[(0,q.jsx)(f.Tab,{id:Xe.Added,title:this.props.intl.formatMessage({id:"added",defaultMessage:f.defaultMessages.added}),children:i}),(0,q.jsx)(f.Tab,{id:Xe.Output,title:this.props.intl.formatMessage({id:"outputs",defaultMessage:f.defaultMessages.outputs}),children:o})]}),l=this.isMapInExpressMode()?this.props.intl.formatMessage({id:"addNewMapOrScene",defaultMessage:f.defaultMessages.addNewMapOrScene}):this.props.intl.formatMessage({id:"addNewData",defaultMessage:f.defaultMessages.addNewData});return(0,q.jsxs)("div",{className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className}),children:[(0,q.jsxs)("div",{className:"component-data-source-list h-100 w-100",children:[!this.props.hideHeader&&(0,q.jsx)("div",{className:"ds-list-header jimu-widget-setting--header d-flex px-4 py-0",title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:f.defaultMessages.setDataSource}),children:(0,q.jsx)(f.PanelHeader,{level:1,className:"px-0 py-4",showClose:!!this.props.onCloseClick,onClose:this.props.onCloseClick,title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:f.defaultMessages.setDataSource})})}),(0,q.jsx)("div",{className:"w-100 px-4 mb-4 search",children:(0,q.jsx)(f.TextInput,{prefix:(0,q.jsx)(Mt,{size:"m",className:"search-icon"}),value:this.state.searchValue,onChange:this.onSearchValueChange,className:"search-input",placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:s.defaultMessages.search}),size:"sm"})}),(0,q.jsx)("div",{className:"w-100 px-4",children:!this.props.hideTypeDropdown&&(null===(e=this.props.types)||void 0===e?void 0:e.length)>0&&(0,q.jsx)("div",{className:"ds-types my-4",children:(0,q.jsx)(vt,{toUseTypes:this.props.types,onTypeSelected:this.setSelectedType,selectedTypes:this.state.selectedTypes,intl:this.props.intl,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown})})}),(0,q.jsxs)("div",{className:"w-100 ds-list-container",children:[(0,q.jsx)("div",{className:"ds-list-tabs h-100",children:t||window.isExpressBuilder?(0,q.jsxs)("div",{className:"h-100",children:[i,(0,q.jsx)("div",{className:"d-none",children:o})]}):(0,q.jsx)("div",{className:"h-100",children:a?(0,q.jsxs)("div",{className:"h-100",children:[o,(0,q.jsx)("div",{className:"d-none",children:i})]}):r})}),this.allowAddNewData()&&(0,q.jsxs)(f.Button,{type:"tertiary",className:" d-flex align-items-center px-4 ds-add-data text-left jimu-outline-inside",onClick:this.showExternalDs,title:l,children:[(0,q.jsx)("div",{className:"add-data-icon-container d-flex align-items-center justify-content-center mr-2",children:(0,q.jsx)(wt,{size:"s",className:"add-data-icon m-0"})}),(0,q.jsx)("div",{className:"text-truncate flex-grow-1",children:l})]})]})]}),this.state.isExternalDsShown?(0,q.jsx)(f.Modal,{isOpen:this.state.isExternalDsShown,style:this.externalDsStyle,toggle:this.onToggleExternalDs,contentClassName:"h-100",className:"widget-ds-setting-add-data-popup",keyboard:!1,children:this.ExternalDs}):null,this.state.errorMsg&&(0,q.jsx)(f.Alert,{className:"w-100",css:s.css`position: absolute; bottom: 40px;`,closable:!0,form:"basic",onClose:()=>{this.setState({errorMsg:null})},open:!0,text:this.state.errorMsg,type:"warning",withIcon:!0})]})}}const Nt=(0,m.withStyles)(s.ReactRedux.connect(e=>{var t,s;return{dataSourcesInfo:(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(s=e.appStateInBuilder)||void 0===s?void 0:s.dataSourcesInfo:e.dataSourcesInfo}})((0,s.injectIntl)(Ct)),"DataSourceList");var Tt,Ot=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};!function(e){e.DataSourceRemoved="DATA_SOURCE_REMOVED",e.SourceWidgetRemoved="SOURCE_WIDGET_REMOVED",e.MapChanged="MAP_CHANGED"}(Tt||(Tt={}));class Vt extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.close=()=>{this.props.isOpen&&!this.__unmount&&this.props.toggle()},this.onCheckboxBtnClick=(e,t)=>{this.stopPropagation(t);const s=this.state.selectedWidgets.indexOf(e);s<0?this.state.selectedWidgets.push(e):this.state.selectedWidgets.splice(s,1),this.setState({selectedWidgets:[...this.state.selectedWidgets]})},this.onRemove=e=>Ot(this,void 0,void 0,function*(){var t,a,i;if(this.stopPropagation(e),this.state.getAppConfigAction){this.props.beforeRemove&&this.props.beforeRemove();const e=this.state.getAppConfigAction();if(this.state.selectedWidgets.length>0&&this.state.selectedWidgets.forEach((t,s)=>{e.removeWidget(t)}),this.props.dataSourceId){const o=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId);if(null==o?void 0:o.isDataView){const t=o.getDataSourceJson(),a=o.dataViewId;let i=t.dataViews||(0,s.Immutable)({});i=i.without(a);const r=W(t.setIn(["dataViews"],i));e.editDataSource(r)}else{const s=null===(t=P())||void 0===t?void 0:t.appProxies;let r={};const l=[],n=[];let d;r=(null===(a=this.state.proxySettingUtils)||void 0===a?void 0:a.traverseToGetNeedProxyDataSources)?yield this.state.proxySettingUtils.traverseToGetNeedProxyDataSources(o):{},Object.keys(r).forEach(e=>{var t;d=null===(t=this.state.proxySettingUtils)||void 0===t?void 0:t.getProxyJsonFromSourceUrl(e,s),d&&(n.push(d.id),l.push(d.proxyId))}),e.removeDataSource(this.props.dataSourceId).exec(),null===(i=this.state.proxySettingUtils)||void 0===i||i.deleteProxies(l,e).then(()=>{const e=this.state.getAppConfigAction();n.forEach(t=>{e.removeAppProxy(t)})})}}else this.props.widgetId&&e.removeWidget(this.props.widgetId);e.exec(),this.props.afterRemove&&this.props.afterRemove()}this.close()}),this.onCancel=e=>{this.stopPropagation(e),this.props.onCancel&&this.props.onCancel(),this.close()},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.state={selectedWidgets:[],getAppConfigAction:null,proxySettingUtils:null}}componentDidMount(){this.__unmount=!1,Promise.all([s.moduleLoader.loadModule("jimu-for-builder"),s.moduleLoader.loadModule("jimu-ui/advanced/setting-components")]).then(e=>{const[{getAppConfigAction:t},{proxySettingUtils:s}]=e;this.__unmount||this.setState({getAppConfigAction:t,proxySettingUtils:s})})}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.props.reason||!this.props.dataSourceId&&!this.props.widgetId)return null;const a=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId),i=null===(e=this.props.widgets)||void 0===e?void 0:e[this.props.widgetId],o=this.props.label||(this.props.dataSourceId?(null==a?void 0:a.getLabel())||this.props.dataSourceId:(null==i?void 0:i.label)||this.props.widgetId);let r,l,n,d,c,p=[];const u=this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel}),h=this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:f.defaultMessages.relatedWidgets});switch(this.props.reason){case Tt.DataSourceRemoved:p=V(this.props.dataSourceId,this.props.widgets),r=this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:f.defaultMessages.removeDataSource}),l=this.props.intl.formatMessage({id:"removeDataWarningTip",defaultMessage:f.defaultMessages.removeDataWarningTip}),n=this.props.intl.formatMessage({id:"removeDataAffectedWidgets",defaultMessage:f.defaultMessages.removeDataAffectedWidgets}),d=this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:f.defaultMessages.removeDataSource}),c=this.props.intl.formatMessage({id:"howToRemoveWidgetsTip",defaultMessage:f.defaultMessages.howToRemoveWidgetsTip});break;case Tt.SourceWidgetRemoved:const e=null==i?void 0:i.outputDataSources;(null==e?void 0:e.length)>0&&e.forEach(e=>{V(e,this.props.widgets).forEach(e=>{p.some(t=>e.id===t.id)||(p=p.concat(e))})}),r=this.props.intl.formatMessage({id:"outputDataWillBeRemovedTogether",defaultMessage:f.defaultMessages.outputDataWillBeRemovedTogether}),l=this.props.intl.formatMessage({id:"removeSourceWidgetWarningTip",defaultMessage:f.defaultMessages.removeSourceWidgetWarningTip},{widgetName:o}),n=this.props.intl.formatMessage({id:"removeSourceWidgetAffectedWidgets",defaultMessage:f.defaultMessages.removeSourceWidgetAffectedWidgets}),d=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),c=this.props.intl.formatMessage({id:"howToRemoveWidgetsTip",defaultMessage:f.defaultMessages.howToRemoveWidgetsTip});break;case Tt.MapChanged:p=A(this.props.dataSourceId,this.props.widgets),r=this.props.intl.formatMessage({id:"changeDataSource",defaultMessage:f.defaultMessages.changeDataSource}),l=null,n=this.props.intl.formatMessage({id:"changeDataAffectedWidgets",defaultMessage:f.defaultMessages.changeDataAffectedWidgets},{dataType:s.dataSourceUtils.getDsTypeString(null==a?void 0:a.type,this.props.intl)}),d=this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:f.defaultMessages.removeDataSource}),c=this.props.intl.formatMessage({id:"howToRemoveWidgetsTip2",defaultMessage:f.defaultMessages.howToRemoveWidgetsTip2})}const g=`${this.props.dataSourceId}-desc`;return(0,q.jsxs)(f.Modal,{isOpen:this.props.isOpen,className:(0,s.classNames)("bg-light-300 d-flex justify-content-between",{[this.props.className]:!!this.props.className}),onClick:this.stopPropagation,role:"dialog","aria-label":r,"aria-describedby":g,children:[(0,q.jsx)(f.ModalHeader,{className:"d-flex justify-content-between border-color-gray-300 py-4 font-16 font-dark-600",onClick:this.stopPropagation,toggle:this.props.toggle,title:r,children:r}),(0,q.jsx)(f.ModalBody,{onClick:this.stopPropagation,id:g,children:(0,q.jsxs)("div",{className:"px-2 py-0",children:[l&&(0,q.jsx)("p",{className:"font-13 font-dark-600","data-testid":"confirmDeleteMessage",children:l}),this.props.reason===Tt.DataSourceRemoved&&(0,q.jsx)("p",{className:"font-14 font-dark-800 mt-4",children:o}),this.props.reason===Tt.SourceWidgetRemoved&&(0,q.jsx)("div",{className:"related-outputs px-2 py-4",children:null===(t=null==i?void 0:i.outputDataSources)||void 0===t?void 0:t.map(e=>{var t;return(0,q.jsx)("div",{className:"font-13 font-dark-800 output-ds-label",children:(null===(t=s.DataSourceManager.getInstance().getDataSource(e))||void 0===t?void 0:t.getLabel())||e},e)})}),(0,q.jsx)("p",{className:"font-13 font-dark-600 mt-4",children:n}),(0,q.jsxs)("div",{role:"group","aria-label":h,children:[(0,q.jsx)("p",{className:"font-14 font-dark-400 mt-4",children:h}),(0,q.jsx)("div",{className:"related-widgets px-2 py-4",children:(0,q.jsx)("div",{children:p.map(e=>e&&e.id?(0,q.jsxs)(f.Label,{className:"d-flex",children:[(0,q.jsx)(f.Checkbox,{className:"mr-2 font-13",onClick:t=>{this.onCheckboxBtnClick(e.id,t)},checked:this.state.selectedWidgets.includes(e.id)}),(0,q.jsx)(f.Icon,{icon:e.icon,size:"16",className:"mr-1 font-dark-800"}),e.label]},e.id):null)})})]}),(0,q.jsx)("p",{className:"font-13 font-dark-600 mt-2 mb-0",children:c})]})}),(0,q.jsx)(f.ModalFooter,{children:(0,q.jsxs)("div",{className:"d-flex justify-content-end mt10",children:[(0,q.jsx)(f.Button,{type:"primary",className:"mr-2",onClick:this.onRemove,"aria-label":d,children:d}),(0,q.jsx)(f.Button,{type:"default",onClick:this.onCancel,"aria-label":u,children:u})]})})]})}}const At=s.ReactRedux.connect((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}})(Vt),Lt=(0,m.withStyles)((0,s.injectIntl)(At),"DataSourceRemoveWarningPopup");var Et=c(72823),kt=c.n(Et),Rt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Ut=e=>{const t=window.SVG,{className:a}=e,i=Rt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:kt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Pt=c(12046),_t=c.n(Pt),Wt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const $t=e=>{const t=window.SVG,{className:a}=e,i=Wt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:_t()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ft=c(9869),Bt=c.n(Ft),zt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Jt=e=>{const t=window.SVG,{className:a}=e,i=zt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Bt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ht=c(9044),qt=c.n(Ht),Gt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Kt=e=>{const t=window.SVG,{className:a}=e,i=Gt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:qt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Qt=c(29282),Xt=c.n(Qt),Yt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Zt=e=>{const t=window.SVG,{className:a}=e,i=Yt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Xt()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))},es="DATA_VIEW_SETTING_"+(new Date).getTime(),ts=15;class ss extends s.React.PureComponent{constructor(e){super(e),this.titleInput=s.React.createRef(),this.editButton=s.React.createRef(),this.__unmount=!1,this.lastScrollTop=0,this.lastTimeToggleTileInput=(new Date).getTime(),this.pendingLoadLocalDsPromise=null,this.previousLabel="",this.getLocalDataSource=()=>s.DataSourceManager.getInstance().getDataSource(this.getLocalDataSourceId()),this.setArcadeCache=(e,t)=>{if(!(null==e?void 0:e.getDataSourceJson().arcadeScript)||!(null==t?void 0:t.getDataSourceJson().arcadeScript))return;const s=e=>{var t;return e&&!!((null===(t=e.source)||void 0===t?void 0:t.length)||e.url||e.portalItem)};e.arcadeResult&&!t.arcadeResult&&(t.arcadeResult=e.arcadeResult),e.arcadeClientLayer&&!t.arcadeClientLayer&&(t.arcadeClientLayer=e.arcadeClientLayer),s(e.layer)&&!s(t.layer)&&(t.layer=e.layer)},this.initPagination=()=>{this.setState({pagination:{page:1,pageSize:"number"==typeof this.state.dataView.maximum?Math.min(this.state.dataView.maximum,ts):ts}})},this.setQueryParams=()=>{const e=this.state.dataView,t="number"==typeof(null==e?void 0:e.maximum)?e.maximum<=ts?1:Math.ceil(e.maximum/ts):null,s="number"==typeof(null==e?void 0:e.maximum)?Math.min(e.maximum,ts):ts;let a=this.state.pagination.page;t?a+1<=t&&(a+=1):a+=1,this.setState({pagination:{page:a,pageSize:s}})},this.setLocalDataSource=()=>{var e,t,a,i,o,r,l,n;let d=null===(e=this.state.dataView)||void 0===e?void 0:e.set("orderBy",null===(a=null===(t=this.state.dataView)||void 0===t?void 0:t.orderBy)||void 0===a?void 0:a.filter(e=>!!e.jimuFieldName));(!this.state.isSqlExpressionValid||this.state.isSqlExpressionValid(null==d?void 0:d.where))&&(null===(o=null===(i=d.where)||void 0===i?void 0:i.parts)||void 0===o?void 0:o.length)||(d=d.without("where")),(null===(r=d.orderBy)||void 0===r?void 0:r.length)&&!d.orderBy.some(e=>!e.jimuFieldName)||(d=d.without("orderBy"));const c=s.DataSourceManager.getInstance().getDataSource(this.getLocalDataSourceId()),p=null==c?void 0:c.getDataSourceJson().query;if(s.lodash.isDeepEqual(p,d))return;this.setState({isLocalDataSourceCreated:!1});const u=this.props.mainDataSource.getDataSourceJson().set("id",this.getLocalDataSourceId()).set("query",d).set("isHidden",!0).without("dataViews");c?(s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(c,u),s.lodash.defer(()=>{!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})})):s.DataSourceManager.getInstance().createDataSource({id:u.id,dataSourceJson:u,layer:null===(l=this.props.mainDataSource)||void 0===l?void 0:l.layer,parentDataSource:(null===(n=this.props.mainDataSource)||void 0===n?void 0:n.parentDataSource)&&s.DataSourceManager.getInstance().createLocalDataSource(this.props.mainDataSource.parentDataSource,es),belongToDataSource:this.props.mainDataSource}).then(e=>{var t;e.belongToDataSource=null,(null===(t=this.props.mainDataSource)||void 0===t?void 0:t.isDataSourceSet())&&this.props.mainDataSource.getChildDataSources().forEach(t=>{s.DataSourceManager.getInstance().createLocalDataSource(t,es).parentDataSource=e}),this.setArcadeCache(this.props.mainDataSource,this.getLocalDataSource()),!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})},e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})})},this.loadLocalDataSource=()=>{if(!this.getLocalDataSource())return;this.pendingLoadLocalDsPromise&&this.pendingLoadLocalDsPromise.cancel(),this.setState({isLocalDataSourceLoaded:!1});let e=Object.assign({page:1,pageSize:this.state.pagination.page*this.state.pagination.pageSize},{outFields:["*"]});if(!this.props.isSettingMainDataSource){const t=this.props.mainDataSource.getConfigQueryParams()||{};delete t.orderByFields,e=this.props.mainDataSource.mergeQueryParams(t,e)}this.pendingLoadLocalDsPromise=s.cancelablePromise.cancelable(this.getLocalDataSource().load(e,{widgetId:this.getLocalDataSourceId(),scope:s.QueryScope.InConfigView}).then(()=>{var e;!this.__unmount&&this.props.isOpen&&(this.setState({isLocalDataSourceLoaded:!0,previewTableRecords:null===(e=this.getLocalDataSource())||void 0===e?void 0:e.getRecordsByPage(1,this.state.pagination.pageSize*this.state.pagination.page)}),this.pendingLoadLocalDsPromise=null)},e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&(this.setState({isLocalDataSourceLoaded:!0,previewTableRecords:[]}),this.pendingLoadLocalDsPromise=null)}))},this.getUseDataSource=e=>{if(!e)return null;const t=e.getRootDataSource(),a=e.getMainDataSource();return(0,s.Immutable)({dataSourceId:e.id,rootDataSourceId:t&&t.id,mainDataSourceId:a&&a.id})},this.getNewDataView=e=>{if(!e)return(0,s.Immutable)({});const t=e.getDataSourceJson(),a=(null==t?void 0:t.dataViews)?Object.keys(t.dataViews):null,i=a&&a.map(e=>e.split("_")[1]).filter(e=>this.isNumeric(e)).length>0?Math.max.apply(null,a.map(e=>e.split("_")[1]).filter(e=>this.isNumeric(e)))+1:1;return(0,s.Immutable)({id:this.props.newDataViewId||`dataView_${i}`,label:this.props.newDataViewLabel||`${this.props.intl.formatMessage({id:"dataView",defaultMessage:f.defaultMessages.dataView})} ${i}`})},this.getPreviewTable=(e,t,a)=>{const i=null==e?void 0:e.getSchema(),o=null==i?void 0:i.fields;if(!t||!o)return null;const r=Object.values(o).sort((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)});return(0,q.jsxs)("div",{className:"table-container mr-2",onScroll:this.onScroll,children:[(0,q.jsx)("div",{className:"table-header",children:(0,q.jsxs)("table",{children:[(0,q.jsx)("caption",{className:"sr-only",children:a}),(0,q.jsx)("thead",{children:(0,q.jsx)("tr",{className:"d-flex",children:r.map((t,a)=>{const i=!(!e||!s.dataSourceUtils.getCodedValueListForCodedValueOrSubtypeField(e.getLayerDefinition(),t.jimuName));return(0,q.jsxs)("th",{children:[i&&(0,q.jsx)(Zt,{className:"mr-1 domain-field-icon",title:this.props.intl.formatMessage({id:"domainField",defaultMessage:f.defaultMessages.domainField})}),(0,q.jsx)("span",{title:t.alias||t.name,children:t.alias||t.name})]},a)})})})]})}),(0,q.jsx)("div",{className:"table-body",children:(0,q.jsx)("table",{children:(0,q.jsx)("tbody",{children:t.map((e,t)=>(0,q.jsx)("tr",{className:"d-flex",children:r.map((t,s)=>{const a=e.getFormattedFieldValue(t.jimuName,this.props.intl);return(0,q.jsx)("td",{title:a,children:a},s)})},t))})})})]})},this.isNumeric=e=>!isNaN(parseFloat(e))&&isFinite(e),this.onScroll=e=>{const t=e.target.clientHeight,s=e.target.scrollHeight,a=e.target.scrollTop,i=s-(t+a)<=10,o=a>this.lastScrollTop;this.lastScrollTop=a<=0?0:a,this.state.isLocalDataSourceCreated&&this.state.isLocalDataSourceLoaded&&i&&o&&this.setQueryParams()},this.onDuplicate=()=>{var e;if(!this.props.onDuplicate)return;let t=this.getNewDataView(this.props.mainDataSource);t=this.state.dataView?this.state.dataView.merge(t.asMutable({deep:!0})):t,(null===(e=this.state.dataView)||void 0===e?void 0:e.label)&&(t=t.set("label",this.getDuplicateLabel(this.state.dataView.label))),this.props.onDuplicate(t)},this.onRemove=e=>{var t,a,i;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const o=s.DataSourceManager.getInstance().getDataViewDataSourceId(null===(t=this.props.mainDataSource)||void 0===t?void 0:t.id,null===(a=this.props.dataView)||void 0===a?void 0:a.id);0===V(o,this.props.widgets).length?(this.state.getAppConfigAction&&(this.removeDataView(null===(i=this.props.dataView)||void 0===i?void 0:i.id),s.DataSourceManager.getInstance().destroyDataSource(o)),this.afterRemove(),this.props.toggle()):this.setState({isRemoveWarningOpen:!0},()=>{this.props.toggle()})},this.afterRemove=()=>{this.props.afterRemove&&this.props.afterRemove(this.props.dataView)},this.removeDataView=e=>{var t;if(!e||!this.state.getAppConfigAction)return;const a=null===(t=this.props.mainDataSource)||void 0===t?void 0:t.getDataSourceJson();let i=a.dataViews||(0,s.Immutable)({});i=i.without(e);const o=W(a.setIn(["dataViews"],i));this.state.getAppConfigAction().editDataSource(o).exec()},this.onLabelChange=e=>{this.changeLabel(e.target.value)},this.changeLabel=e=>{let t=this.state.dataView;t=t.set("label",e),this.setState({dataView:t})},this.checkLabelOnAccept=e=>{const t=this.checkLabel(e);return t.valid||this.changeLabel(this.previousLabel),t},this.checkLabelOnChange=e=>this.checkLabel(e),this.checkLabel=e=>{var t,s,a;return!(e!==(null===(t=this.props.dataView)||void 0===t?void 0:t.label))||e&&!(null===(a=null===(s=this.props.mainDataSource)||void 0===s?void 0:s.getDataViews())||void 0===a?void 0:a.some(t=>t.getLabel()===e))?{valid:!0}:{valid:!1,msg:e&&this.props.intl.formatMessage({id:"duplicatedLabel",defaultMessage:f.defaultMessages.duplicatedLabel})}},this.onSqlExprBuilderChange=e=>{let t=this.state.dataView;t=t.set("where",e),this.setState({dataView:t})},this.onSortChange=(e,t)=>{let s=this.state.dataView;s=s.set("orderBy",e),this.setState({dataView:s})},this.onPageSizeChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("pageSize",s):t.without("pageSize"),this.setState({dataView:t})},this.onToggleMaximum=(e,t)=>{let s=this.state.dataView;s=t?s.set("maximum",100):s.without("maximum"),this.setState({dataView:s})},this.onMaximumChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("maximum",s):t.set("maximum",100),this.setState({dataView:t})},this.onApply=()=>{var e;let t=this.state.dataView;t=null==t?void 0:t.set("orderBy",null===(e=null==t?void 0:t.orderBy)||void 0===e?void 0:e.filter(e=>!!e.jimuFieldName)),this.props.onApply(t)},this.toggleTitleInput=()=>{var e;const t=(new Date).getTime();t-this.lastTimeToggleTileInput>500&&(this.previousLabel=null===(e=this.state.dataView)||void 0===e?void 0:e.label,this.setState({isTitleInputShown:!this.state.isTitleInputShown}),this.lastTimeToggleTileInput=t)},this.toggleRemoveWarning=()=>{this.setState({isRemoveWarningOpen:!this.state.isRemoveWarningOpen})},ss.count++;const t=this.props.dataView||this.getNewDataView(this.props.mainDataSource);this.state={dataView:t,previewTableRecords:[],isTitleInputShown:!1,isRemoveWarningOpen:!1,isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,SqlExpressionBuilder:null,Sort:null,getAppConfigAction:null,isSqlExpressionValid:null,pagination:{page:1,pageSize:"number"==typeof(null==t?void 0:t.maximum)?Math.min(t.maximum,ts):ts}}}componentDidMount(){this.__unmount=!1,Promise.all([s.moduleLoader.loadModule("jimu-ui/advanced/sql-expression-builder"),s.moduleLoader.loadModule("jimu-ui/basic/sql-expression-runtime"),s.moduleLoader.loadModule("jimu-for-builder")]).then(e=>{const[t,{isSqlExpressionValid:s},{getAppConfigAction:a}]=e;this.__unmount||this.setState({SqlExpressionBuilder:t.SqlExpressionBuilder,Sort:t.Sort,getAppConfigAction:a,isSqlExpressionValid:s})}),this.props.isOpen&&this.setLocalDataSource()}componentDidUpdate(e,t){var a,i,o,r;!s.lodash.isDeepEqual(e.dataView,this.props.dataView)||!e.isOpen&&this.props.isOpen?(this.initPagination(),this.setState({dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)},()=>{var e;(0,s.focusElementInKeyboardMode)(null===(e=null===document||void 0===document?void 0:document.querySelector)||void 0===e?void 0:e.call(document,".modal.jimu-outline-inside.show"),!0)})):this.props.isOpen&&(this.getLocalDataSource()&&e.mainDataSource===this.props.mainDataSource&&s.lodash.isDeepEqual(null===(a=t.dataView)||void 0===a?void 0:a.without("label"),null===(i=this.state.dataView)||void 0===i?void 0:i.without("label"))||this.setLocalDataSource(),(!s.lodash.isDeepEqual(t.pagination,this.state.pagination)||!t.isLocalDataSourceCreated&&this.state.isLocalDataSourceCreated)&&this.loadLocalDataSource()),(null===(o=t.dataView)||void 0===o?void 0:o.maximum)!==(null===(r=this.state.dataView)||void 0===r?void 0:r.maximum)&&this.initPagination(),e.isOpen&&!this.props.isOpen&&this.destroyLocalDataSource(),t.isTitleInputShown!==this.state.isTitleInputShown&&(this.state.isTitleInputShown&&this.titleInput.current?((0,s.focusElementInKeyboardMode)(this.titleInput.current,!0),this.titleInput.current.select()):!this.state.isTitleInputShown&&this.editButton.current&&(0,s.focusElementInKeyboardMode)(this.editButton.current,!0))}componentWillUnmount(){var e;this.__unmount=!0,this.destroyLocalDataSource(),null===(e=this.pendingLoadLocalDsPromise)||void 0===e||e.cancel()}destroyLocalDataSource(){this.setArcadeCache(this.getLocalDataSource(),this.props.mainDataSource),s.DataSourceManager.getInstance().getDataSourcesAsArray().forEach(e=>{e.id.includes(es)&&s.DataSourceManager.getInstance().destroyDataSource(e.id)}),this.__unmount||(this.setState({isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,previewTableRecords:[],dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)}),this.initPagination())}getLocalDataSourceId(){return`${es}-${ss.count}`}getDuplicateLabel(e){var t;const s=null===(t=this.props.intl.formatMessage({id:"copy",defaultMessage:f.defaultMessages.copy}))||void 0===t?void 0:t.toLocaleLowerCase();let a=`${e} ${s}`,i=1;for(;this.props.mainDataSource.getDataSourceJson().dataViews&&Object.keys(this.props.mainDataSource.getDataSourceJson().dataViews).find(e=>{var t;return(null===(t=this.props.mainDataSource.getDataSourceJson().dataViews[e])||void 0===t?void 0:t.label)===a});)i++,a=`${e} ${s} ${i}`;return a}render(){var e,t,a,i;if(!this.props.mainDataSource.query)return null;const o=this.state.dataView,r=s.DataSourceManager.getInstance().getDataViewDataSourceId(null===(e=this.props.mainDataSource)||void 0===e?void 0:e.id,null===(t=this.props.dataView)||void 0===t?void 0:t.id),l=this.state.SqlExpressionBuilder,n=this.state.Sort,d=!this.state.isSqlExpressionValid||this.state.isSqlExpressionValid(null==o?void 0:o.where),c=this.props.intl.formatMessage({id:"edit",defaultMessage:f.defaultMessages.edit}),p=this.props.intl.formatMessage({id:"duplicate",defaultMessage:f.defaultMessages.duplicate}),u=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),h=this.props.intl.formatMessage({id:"applyChanges",defaultMessage:f.defaultMessages.applyChanges}),g=this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel});return(0,q.jsxs)("div",{children:[(0,q.jsxs)(f.Modal,{className:(0,s.classNames)({[this.props.className]:!!this.props.className}),isOpen:this.props.isOpen,centered:!0,toggle:this.props.toggle,returnfocusafterclose:"true",contentClassName:"data-view-container",backdrop:"static",keyboard:!1,"aria-label":null===(a=this.state.dataView)||void 0===a?void 0:a.label,children:[(0,q.jsxs)(f.ModalHeader,{className:"d-flex justify-content-between align-items-center header",children:[(0,q.jsx)("div",{className:"flex-grow-1 text-truncate",children:this.props.disableRename?(0,q.jsx)("div",{className:"flex-grow-1 text-truncate",title:null==o?void 0:o.label,children:null==o?void 0:o.label}):(0,q.jsxs)("div",{className:"d-flex align-items-center pr-4",children:[this.state.isTitleInputShown?(0,q.jsx)(f.TextInput,{className:"flex-grow-1",value:null==o?void 0:o.label,onChange:this.onLabelChange,ref:this.titleInput,onBlur:this.toggleTitleInput,onPressEnter:this.toggleTitleInput,checkValidityOnChange:this.checkLabelOnChange,checkValidityOnAccept:this.checkLabelOnAccept}):(0,q.jsx)("div",{className:"text-truncate",children:null==o?void 0:o.label}),(0,q.jsx)(f.Button,{className:"flex-shrink-0 ml-2 jimu-outline-inside",type:"tertiary",size:"sm",icon:!0,onClick:this.toggleTitleInput,title:c,"aria-label":c,ref:this.editButton,children:(0,q.jsx)($t,{size:"m"})})]})}),(0,q.jsxs)("div",{className:"flex-shrink-0",children:[!this.props.disableDuplicate&&this.props.dataView&&(0,q.jsx)(f.Button,{className:"flex-shrink-0 circle-button mr-4",type:"default",size:"sm",icon:!0,onClick:this.onDuplicate,title:p,"aria-label":p,disabled:!d,children:(0,q.jsx)(Jt,{size:"m"})}),!this.props.disableRemove&&this.props.dataView&&(0,q.jsx)(f.Button,{className:"flex-shrink-0 circle-button",type:"default",size:"sm",icon:!0,onClick:this.onRemove,title:u,"aria-label":u,children:(0,q.jsx)(Kt,{size:"m"})})]})]}),o?(0,q.jsxs)(f.ModalBody,{className:"d-flex",children:[(0,q.jsx)("div",{className:"w-38 h-100 flex-shrink-0 setting-table",children:(0,q.jsxs)(f.Tabs,{type:"underline",fill:!0,className:"h-100",defaultValue:"filter",children:[(0,q.jsx)(f.Tab,{id:"filter",className:"view-tab",title:this.props.intl.formatMessage({id:"filter",defaultMessage:f.defaultMessages.filter}),children:l&&(0,q.jsx)(l,{dataSource:this.props.mainDataSource,mode:s.SqlExpressionMode.Simple,expression:o.where,onChange:this.onSqlExprBuilderChange,queryScope:this.props.isSettingMainDataSource&&s.QueryScope.InRemoteConfigView})}),(0,q.jsx)(f.Tab,{id:"sort",className:"view-tab",title:this.props.intl.formatMessage({id:"sort",defaultMessage:f.defaultMessages.sort}),children:n&&(0,q.jsx)(n,{onChange:this.onSortChange,value:o.orderBy||(0,s.Immutable)([]),useDataSource:this.getUseDataSource(this.props.mainDataSource)})}),(0,q.jsx)(f.Tab,{id:"records",className:"view-tab",title:this.props.intl.formatMessage({id:"records",defaultMessage:f.defaultMessages.records}),children:(0,q.jsxs)("div",{css:{paddingRight:2,paddingTop:2},children:[(0,q.jsxs)("div",{className:"d-flex justify-content-between mb-4",children:[(0,q.jsx)(f.Label,{for:"data-view-setting-page-size-input",className:"label",children:this.props.intl.formatMessage({id:"pageSize",defaultMessage:f.defaultMessages.pageSize})}),(0,q.jsx)(f.NumericInput,{size:"sm",value:o.pageSize||s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,onAcceptValue:this.onPageSizeChange,showHandlers:!1,precision:0,min:1,id:"data-view-setting-page-size-input"})]}),(0,q.jsxs)("div",{className:"d-flex justify-content-between mb-2",children:[(0,q.jsx)(f.Label,{for:"data-view-setting-max-records",className:"label",children:this.props.intl.formatMessage({id:"maximum",defaultMessage:f.defaultMessages.maximum})}),(0,q.jsx)(f.Switch,{id:"data-view-setting-max-records",checked:"number"==typeof o.maximum,onChange:this.onToggleMaximum})]}),"number"==typeof o.maximum&&(0,q.jsxs)("div",{className:"d-flex justify-content-between mb-4",children:[(0,q.jsx)(f.Label,{for:"data-view-setting-max-records-hint",className:"label",children:this.props.intl.formatMessage({id:"maximumLimitationWarning",defaultMessage:f.defaultMessages.maximumLimitationWarning})}),(0,q.jsx)(f.Link,{to:"https://developers.arcgis.com/javascript/latest/api-reference/esri-views-layers-FeatureLayerView.html#maximumNumberOfFeatures",className:"ml-2 jimu-outline-inside",target:"_blank",id:"data-view-setting-max-records-hint",children:this.props.intl.formatMessage({id:"details",defaultMessage:f.defaultMessages.details})})]}),"number"==typeof o.maximum&&(0,q.jsxs)("div",{className:"d-flex justify-content-between mb-4",children:[(0,q.jsx)(f.Label,{for:"data-view-setting-max-records-num",className:"label",children:this.props.intl.formatMessage({id:"maximumRecordCount",defaultMessage:f.defaultMessages.maximumRecordCount})}),(0,q.jsx)(f.NumericInput,{size:"sm",value:o.maximum,onAcceptValue:this.onMaximumChange,precision:0,min:1,showHandlers:!1,id:"data-view-setting-max-records-num"})]})]})})]})}),(0,q.jsxs)("div",{className:"w-62 h-100 flex-grow-1 preview-table",children:[this.getPreviewTable(this.getLocalDataSource(),this.state.previewTableRecords,null===(i=this.props.dataView)||void 0===i?void 0:i.label),(!this.state.isLocalDataSourceCreated||!this.state.isLocalDataSourceLoaded)&&(0,q.jsx)(f.Loading,{type:f.LoadingType.Secondary})]})]}):null,(0,q.jsxs)(f.ModalFooter,{className:"d-flex justify-content-between pb-30",children:[(0,q.jsx)("div",{children:!d&&(0,q.jsxs)("div",{className:"sql-exp-warning text-truncate",title:this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:f.defaultMessages.sqlExprIncomplete}),children:[(0,q.jsx)(Ut,{size:"l",className:"sql-exp-warning-icon mr-2"}),this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:f.defaultMessages.sqlExprIncomplete})]})}),(0,q.jsxs)("div",{children:[(0,q.jsx)(f.Button,{className:"mr-2",type:"primary",onClick:this.onApply,disabled:!d,title:h,"aria-label":h,children:h}),(0,q.jsx)(f.Button,{type:"default",onClick:this.props.toggle,title:g,"aria-label":g,children:g})]})]})]}),(0,q.jsx)(Lt,{dataSourceId:r,isOpen:this.state.isRemoveWarningOpen,afterRemove:this.afterRemove,toggle:this.toggleRemoveWarning,reason:Tt.DataSourceRemoved})]})}}ss.count=-1;const as=s.ReactRedux.connect((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}})(ss),is=(0,m.withStyles)((0,s.injectIntl)(as),"DataViewSettingPopup");var os=c(93303),rs=c.n(os),ls=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const ns=e=>{const t=window.SVG,{className:a}=e,i=ls(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:rs()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))},ds="create_a_view";class cs extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.widthForDropdownItem={width:"calc(100% - 30px)"},this.widthForDropdownItemLabel={width:"calc(100% - 40px)"},this.widthForMultiDropdownItemLabel={width:"calc(100% - 60px)"},this.dropdownNode=s.React.createRef(),this.onRemove=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const t=this.props.mainDataSourceId;window.isExpressBuilder&&H(this.props.widgetId)&&s.moduleLoader.loadModule("jimu-for-builder").then(e=>{e.getAppConfigAction().removeUseDataSource(t).exec()});const{onRemove:a}=this.props;a&&a(t)},this.onDataViewChange=e=>{if(!e||e===ds)return;const t=this.getAllDataViews()[e],a=(0,s.Immutable)([t.asMutable({deep:!0})]);this.onChange(this.props.mainDataSourceId,a)},this.onDataViewKeyDown=(e,t)=>{t.target!==t.currentTarget||"Enter"!==t.key&&" "!==t.key||this.onDataViewChange(e)},this.onMultiDataViewChange=e=>{if(!e||e===ds)return;const t=this.getAllDataViews()[e],a=this.props.dataViews||(0,s.Immutable)([]),i=this.props.dataViews&&this.props.dataViews.find(e=>e.id===t.id)?a.filter(e=>e.id!==t.id):a.concat(t);this.onChange(this.props.mainDataSourceId,i)},this.onChange=(e,t)=>{this.props.hideRemove&&!(null==t?void 0:t.length)||this.props.onChange(e,t)},this.formatMessage=(e,t)=>{const s=Object.assign({},f.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.getDsLabel=e=>{const t=this.getDsObj(e);return t&&t.getLabel()||this.formatMessage("none")},this.getWhetherItemError=(e,t)=>{var a,i,o,r,l,n,d,c,p,u,h,g;const m=(null===(o=null===(i=null===(a=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===a?void 0:a.dataSourcesInfo)||void 0===i?void 0:i[t])||void 0===o?void 0:o.instanceStatus)===s.DataSourceStatus.Created&&!(null===(n=null===(l=null===(r=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===r?void 0:r.dataSourcesInfo)||void 0===l?void 0:l[e])||void 0===n?void 0:n.instanceStatus),S=(null===(p=null===(c=null===(d=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===d?void 0:d.dataSourcesInfo)||void 0===c?void 0:c[t])||void 0===p?void 0:p.instanceStatus)===s.DataSourceStatus.CreateError,f=!("string"==typeof e&&"undefined"!==e)||(null===(g=null===(h=null===(u=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===u?void 0:u.dataSourcesInfo)||void 0===h?void 0:h[e])||void 0===g?void 0:g.instanceStatus)===s.DataSourceStatus.CreateError;return m||S||f},this.getAllDataViews=()=>{if(!this.props.mainDataSourceId)return null;const e=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);if(!s.dataSourceUtils.doesDsSupportQuery(e))return null;const t=e.getDataSourceJson();let a=(null==t?void 0:t.dataViews)||(0,s.Immutable)({});a=a.set(this.props.DefaultDataView.id,(null==t?void 0:t.query)?t.query.merge(this.props.DefaultDataView.asMutable({deep:!0})):this.props.DefaultDataView);const i={id:s.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:f.defaultMessages.selectionDataView})};a=a.set(s.CONSTANTS.SELECTION_DATA_VIEW_ID,i),a=a.without(s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION),a=a.without(s.CONSTANTS.OUTPUT_DATA_VIEW_ID);const o="function"==typeof this.props.hideDataView?this.props.hideDataView:null;return o&&Object.values(a).forEach(e=>{o(e,this.props.mainDataSourceId)&&(a=a.without(e.id))}),a},this.getCreateViewButton=()=>(0,q.jsxs)(f.Button,{type:"tertiary",disableHoverEffect:!0,disableRipple:!0,block:!0,size:"sm",onClick:this.onCreateViewClick,className:"p-0 justify-content-start flex-shrink-1",children:[(0,q.jsx)(wt,{size:"s",className:"mr-1"}),(0,q.jsx)("span",{children:this.formatMessage("createAView")}),(0,q.jsx)("div",{className:"create-view-button-border"})]}),this.getSelectedValueForSingleSelect=()=>{var e;return this.props.dataViews&&this.props.dataViews.length>0?null===(e=this.props.dataViews[0])||void 0===e?void 0:e.id:this.props.DefaultDataView.id},this.getSelectedValueForMultiSelect=()=>this.props.dataViews&&this.props.dataViews.length>0?this.props.dataViews.map(e=>e.id):(0,s.Immutable)([this.props.DefaultDataView.id]),this.getMultiSelectSelectedString=e=>{if(e)return this.formatMessage("numSelected",{number:e.length})},this.onDataViewClick=(e,t)=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({settingDataView:t,isViewSelectOpen:!1}),this.toggleViewSetting()},this.onCreateViewClick=()=>{this.setState({settingDataView:null}),this.toggleViewSetting()},this.onCreateViewKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onCreateViewClick()},this.toggleViewSetting=()=>{this.setState({isViewSettingOpen:!this.state.isViewSettingOpen})},this.toggleViewSelect=()=>{this.setState({isViewSelectOpen:!this.state.isViewSelectOpen})},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDataViewSettingApply=e=>{e.id===this.props.DefaultDataView.id?this.editQuery(e):this.editDataView(e)},this.editQuery=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),i=a&&a.getDataSourceJson();if(!i)return;const o=W(i.setIn(["query"],(null==i?void 0:i.query)?i.query.merge(e.without("id").without("label").asMutable({deep:!0})):e.set("id","default").set("label",a.getLabel())));t().editDataSource(o).exec(),a.addSourceVersion(),this.toggleViewSetting()},this.editDataView=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),i=a&&a.getDataSourceJson();let o=i.dataViews||(0,s.Immutable)({});o=o.set(e.id,e);const r=W(i.setIn(["dataViews"],o));t().editDataSource(r).exec(),a.getDataView(null==e?void 0:e.id)?(this.setState({settingDataView:e}),a.addSourceVersion(),this.toggleViewSetting()):s.DataSourceManager.getInstance().createDataSource(i,e.id).then(()=>{this.__unmount||(this.setState({settingDataView:e}),this.toggleViewSetting())})},this.getWhetherAllowToCreateView=()=>{if(this.props.hideCreateViewButton)return!1;const e=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return s.dataSourceUtils.doesDsSupportQuery(e)&&!e.getDataSourceJson().isOutputFromWidget},this.getWhetherAllowToChangeViewSetting=e=>{var t;if(e===s.CONSTANTS.SELECTION_DATA_VIEW_ID)return!1;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return!(null===(t=null==a?void 0:a.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget)},this.onClick=()=>{this.props.onClick&&this.props.onClick(this.props.mainDataSourceId)},this.onKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onClick()},this.afterRemoveDataView=e=>{var t;(null===(t=this.props.dataViews)||void 0===t?void 0:t.some(t=>t.id===e.id))&&this.onDataViewChange(S)},this.getDsObj=e=>{var t;let a=s.DataSourceManager.getInstance().getDataSource(e);return(null===(t=null==a?void 0:a.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget)&&(a=a.getMainDataSource().getDataView(s.CONSTANTS.OUTPUT_DATA_VIEW_ID)),a},this.state={isViewSettingOpen:!1,isViewSelectOpen:!1,settingDataView:null,getAppConfigAction:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})})}componentDidUpdate(e,t){t.isViewSettingOpen&&!this.state.isViewSettingOpen&&setTimeout(()=>{var e;(0,s.focusElementInKeyboardMode)(null===(e=this.dropdownNode)||void 0===e?void 0:e.current)},200)}componentWillUnmount(){this.__unmount=!0}render(){var e,t,a,i,o,r,l;const n=this.props.mainDataSourceId;if(!n)return null;const d=this.getDsObj(n),c=null==d?void 0:d.getDataSourceJson(),p=this.props.rootDataSourceId||n,u=null===(t=null===(e=P())||void 0===e?void 0:e.dataSources)||void 0===t?void 0:t[p],h=this.getWhetherItemError(n,p),g=!d&&u&&!h,m=this.props.isMultiple&&"boolean"!=typeof this.props.isMultipleDataView||this.props.isMultipleDataView,S=(0,q.jsx)(f.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,title:this.formatMessage("remove"),onClick:this.onRemove,className:"ds-item-close",children:(0,q.jsx)(pe,{size:"s"})}),v=this.getWhetherAllowToCreateView(),D=!0!==this.props.hideDataView&&!window.isExpressBuilder,b=D&&this.getAllDataViews(),y=this.getDsLabel(n);return(0,q.jsxs)("div",{className:this.props.className?`w-100 added-ds-item ${this.props.className}`:"w-100 added-ds-item",children:[g&&(0,q.jsx)("div",{className:"loading-container",children:(0,q.jsx)(f.Loading,{type:f.LoadingType.Bar})}),g&&(0,q.jsxs)("div",{className:"loading-placeholder",onClick:this.onClick,onKeyDown:this.onKeyDown,role:"menuitem",tabIndex:0,ref:this.props.innerRef,"aria-label":y,children:[(0,q.jsxs)("div",{className:"first-line d-flex align-items-center justify-content-between mb-2 pb-1",children:[(0,q.jsx)("div",{className:"first-line-left mr-2"}),(0,q.jsx)("div",{className:"first-line-right flex-grow-1"})]}),(0,q.jsx)("div",{className:"second-line w-100"})]}),!g&&(0,q.jsxs)("div",{className:(0,s.classNames)("ds-item",{"ds-error-item":h,"disable-cursor":this.props.disableDataSourceList}),onClick:this.onClick,onKeyDown:this.onKeyDown,role:"menuitem",tabIndex:0,ref:this.props.innerRef,"aria-label":y,children:[(0,q.jsxs)("div",{className:"d-flex align-items-center w-100 item",children:[(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(c),className:"text-default",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",title:y,children:y})}),!this.props.hideRemove&&S]}),D&&b&&Object.keys(b).length>0&&(0,q.jsx)("div",{className:"dv-select-container",children:m?(0,q.jsxs)(f.MultiSelect,{size:"sm",buttonRef:this.dropdownNode,onClick:this.stopPropagation,onChange:this.onMultiDataViewChange,arrow:!this.props.disableDataView,values:this.getSelectedValueForMultiSelect(),disabled:this.props.disableDataView||h,"aria-label":this.formatMessage("selectADataView"),displayByValues:this.getMultiSelectSelectedString,children:[Object.keys(b).map(e=>(0,q.jsx)(f.MultiSelectItem,{value:e,label:b[e].label,children:({selected:t,label:s})=>(0,q.jsxs)("div",{className:"d-flex w-100 align-items-center justify-content-start w-100",children:[(0,q.jsx)(f.Checkbox,{checked:t}),(0,q.jsx)("div",{className:"jimu-multi-select-item-label",style:this.widthForMultiDropdownItemLabel,title:s,children:s}),this.getWhetherAllowToChangeViewSetting(e)&&(0,q.jsx)(f.Button,{type:"tertiary",icon:!0,disableHoverEffect:!0,disableRipple:!0,size:"sm",className:"px-2 py-0",onClick:t=>{this.onDataViewClick(t,b[e])},title:this.props.intl.formatMessage({id:"settings",defaultMessage:f.defaultMessages.settings}),children:(0,q.jsx)(ns,{size:"s"})})]})},e)),this.getWhetherAllowToCreateView()&&!s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId).isDataSourceSet()&&(0,q.jsx)(f.MultiSelectItem,{value:ds,label:this.formatMessage("createAView"),children:this.getCreateViewButton()})]}):(0,q.jsxs)(f.Dropdown,{fluid:!0,activeIcon:!0,autoWidth:!0,onClick:this.stopPropagation,isOpen:this.state.isViewSelectOpen,toggle:this.toggleViewSelect,disabled:this.props.disableDataView||h,"aria-label":this.formatMessage("selectADataView"),menuItemCheckMode:"singleCheck",supportInsideNodesAccessible:!0,children:[(0,q.jsx)(f.DropdownButton,{onClick:this.toggleViewSelect,type:"tertiary",className:"data-view-dropdown-menu-button",size:"sm",arrow:!this.props.disableDataView,innerRef:this.dropdownNode,children:null===(a=b[this.getSelectedValueForSingleSelect()])||void 0===a?void 0:a.label}),(0,q.jsxs)(f.DropdownMenu,{children:[Object.values(b).map((e,t)=>(0,q.jsx)(f.DropdownItem,{tag:"div",tabIndex:0,onClick:()=>{this.onDataViewChange(e.id)},onKeyDown:t=>{this.onDataViewKeyDown(e.id,t)},active:this.getSelectedValueForSingleSelect()===e.id,children:(0,q.jsxs)("div",{className:"d-flex justify-content-between align-items-center",style:this.widthForDropdownItem,children:[(0,q.jsx)("div",{className:"text-truncate",title:e.label,style:this.widthForDropdownItemLabel,children:e.label}),this.state.isViewSelectOpen&&this.getWhetherAllowToChangeViewSetting(e.id)&&(0,q.jsx)(f.Button,{type:"tertiary",disableHoverEffect:!0,disableRipple:!0,size:"sm",icon:!0,className:"px-2 settings-icon py-0",onClick:t=>{this.onDataViewClick(t,e)},title:this.props.intl.formatMessage({id:"settings",defaultMessage:f.defaultMessages.settings}),children:(0,q.jsx)(ns,{size:"s"})})]})},t)),v&&!s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId).isDataSourceSet()&&(0,q.jsx)(f.DropdownItem,{tag:"div",onKeyDown:this.onCreateViewKeyDown,className:"create-view-button",children:this.getCreateViewButton()})]})]})})]}),v&&(0,q.jsx)(is,{isOpen:this.state.isViewSettingOpen,toggle:this.toggleViewSetting,onApply:this.onDataViewSettingApply,onDuplicate:this.onDataViewSettingApply,afterRemove:this.afterRemoveDataView,mainDataSource:d,dataView:this.state.settingDataView,isSettingMainDataSource:(null===(i=this.state.settingDataView)||void 0===i?void 0:i.id)===this.props.DefaultDataView.id,disableDuplicate:!this.state.settingDataView||(null===(o=this.state.settingDataView)||void 0===o?void 0:o.id)===this.props.DefaultDataView.id,disableRemove:!this.state.settingDataView||(null===(r=this.state.settingDataView)||void 0===r?void 0:r.id)===this.props.DefaultDataView.id,disableRename:(null===(l=this.state.settingDataView)||void 0===l?void 0:l.id)===this.props.DefaultDataView.id})]})}}class ps extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.DefaultDataView=(0,s.Immutable)({id:S,label:this.props.intl.formatMessage({id:"default",defaultMessage:f.defaultMessages.default})}),this.sidePopperTrigger=s.React.createRef(),this.backToFocusNode=s.React.createRef(),this.changeInitStatus=e=>{this.setState({isDataSourceInited:e})},this.getIsLoading=e=>{var t;const a=null===(t=this.props.dataSourcesInfo)||void 0===t?void 0:t[e];if(!a)return!1;if(a.instanceStatus===s.DataSourceStatus.CreateError)return!1;if(a.instanceStatus===s.DataSourceStatus.Created){const t=s.DataSourceManager.getInstance().getDataSource(e);return!!(null==t?void 0:t.isDataSourceSet())&&!t.areChildDataSourcesCreated()}return!0},this.disableSelection=()=>{if(this.props.disableSelection){const e=this.props.useDataSources||(0,s.Immutable)([]);return this.props.disableSelection(e.asMutable({deep:!0}))}return!1},this.disableRemove=()=>{if(this.props.disableRemove){const e=this.props.useDataSources||(0,s.Immutable)([]);return this.props.disableRemove(e.asMutable({deep:!0}))}return!1},this.onModalClose=()=>{this.setState({modalType:"none"})},this.onMainDsChanged=e=>{e&&(this.props.onChange&&this.props.onChange(e),setTimeout(()=>{this.props.closeDataSourceListOnChange&&this.setState({modalType:"none"})},200))},this.onMainDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)+""!==e);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))},this.onDataViewChanged=(e,t)=>{if(!e||!this.props.useDataSources)return;const a=(0,s.Immutable)(this.props.useDataSources.find(t=>t.mainDataSourceId===e)||{dataSourceId:e,mainDataSourceId:e}).without("fields","useFieldsInPopupInfo","useFieldsInSymbol"),i=t.map(t=>{var i;if(t.id===S){const t=s.DataSourceManager.getInstance().getDataSource(e);if(null===(i=null==t?void 0:t.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget){const t=s.DataSourceManager.getInstance().getDataViewDataSourceId(e,s.CONSTANTS.OUTPUT_DATA_VIEW_ID),i=s.CONSTANTS.OUTPUT_DATA_VIEW_ID,o=this.props.useDataSources.find(e=>e.dataSourceId===t);return o||a.set("dataSourceId",t).set("dataViewId",i).asMutable({deep:!0})}{const t=this.props.useDataSources.find(t=>t.dataSourceId===e);return t||a.without("dataViewId").set("dataSourceId",e).asMutable({deep:!0})}}{const i=s.DataSourceManager.getInstance().getDataViewDataSourceId(e,t.id),o=this.props.useDataSources.find(e=>e.dataSourceId===i);return o||a.set("dataViewId",t.id).set("dataSourceId",i).asMutable({deep:!0})}}),o=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)!==e).concat(i);this.props.onChange&&this.props.onChange(o.asMutable({deep:!0}))},this.toggleDsList=()=>{this.props.disableDataSourceList||this.setState({modalType:"ds"===this.state.modalType?"none":"ds"})},this.getWhetherShowPlaceholder=()=>{var e;if(null===(e=this.props.useDataSources)||void 0===e?void 0:e.some(e=>!s.DataSourceManager.getInstance().getDataSource(e.dataSourceId)))return!0;if(this.props.disableSelection){const e=this.props.useDataSources||(0,s.Immutable)([]);return!this.props.disableSelection(e.asMutable({deep:!0}))}return this.props.isMultiple||!this.props.isMultiple&&(!this.props.useDataSources||0===this.props.useDataSources.filter(e=>!!e).length)},this.groupUseDssByMainDataSource=e=>{if(!e||0===e.length)return null;const t={};return e.forEach(e=>{if(t[e.mainDataSourceId]||(t[e.mainDataSourceId]=(0,s.Immutable)([])),e.dataViewId===s.CONSTANTS.SELECTION_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat({id:s.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:f.defaultMessages.selectionDataView})});else if(e.dataViewId===s.CONSTANTS.OUTPUT_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView);else if(e.dataViewId){const a=s.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId),i=a&&a.getDataSourceJson(),o=i&&i.dataViews;(null==o?void 0:o[e.dataViewId])&&(t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(o[e.dataViewId]))}else t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView)}),t},this.onDsItemClick=e=>{this.toggleDsList()},this.getIsDsListOpen=()=>"ds"===this.state.modalType&&!s.urlUtils.getAppIdPageIdFromUrl().pageId,this.onSelectDataKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.toggleDsList()},this.state={isDataSourceInited:_(this.props.dataSources,this.props.dataSourcesInfo),modalType:"none",SidePopper:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-ui/advanced/setting-components").then(e=>{this.__unmount||this.setState({SidePopper:e.SidePopper})})}componentWillUnmount(){this.__unmount=!0}componentDidUpdate(e){if(!s.lodash.isDeepEqual(this.props.dataSources,e.dataSources)||!s.lodash.isDeepEqual(this.props.dataSourcesInfo,e.dataSourcesInfo)){const e=_(this.props.dataSources,this.props.dataSourcesInfo);this.changeInitStatus(e),e||this.props.dataSourcesInfo&&Object.keys(this.props.dataSourcesInfo).forEach(e=>{this.getIsLoading(e)&&this.waitForChildDataSourcesReady(e).finally(()=>{this.changeInitStatus(_(this.props.dataSources,this.props.dataSourcesInfo))})})}}waitForChildDataSourcesReady(e){const t=s.DataSourceManager.getInstance().getDataSource(e);return(null==t?void 0:t.isDataSourceSet())&&!t.areChildDataSourcesCreated()?t.childDataSourcesReady().then(()=>t).catch(e=>t):Promise.resolve(t)}render(){const e=this.state.SidePopper,t=this.getWhetherShowPlaceholder(),s=this.groupUseDssByMainDataSource(this.props.useDataSources),a=this.props.buttonLabel||this.props.intl.formatMessage({id:"setDataSource",defaultMessage:f.defaultMessages.setDataSource}),i=s?Object.keys(s).length:0,o=[],r=this.props["aria-label"]||this.props.intl.formatMessage({id:"data",defaultMessage:f.defaultMessages.data});return this.sidePopperTrigger.current&&o.push(this.sidePopperTrigger.current),this.props.sidePopperTrigger&&(Array.isArray(this.props.sidePopperTrigger)?o.push(...this.props.sidePopperTrigger):o.push(this.props.sidePopperTrigger)),(0,q.jsxs)("div",{className:"w-100",ref:this.sidePopperTrigger,role:"menu","aria-label":r,children:[s&&Object.keys(s).sort((e,t)=>null==e?void 0:e.localeCompare(t)).map((e,a)=>{var o,r;return e?(0,q.jsx)(cs,{mainDataSourceId:e,onRemove:this.onMainDsRemoved,intl:this.props.intl,hideRemove:this.disableRemove(),theme:this.props.theme,disableDataSourceList:this.props.disableDataSourceList,onClick:this.onDsItemClick,className:(t||a!==i-1)&&"mb-4",onChange:this.onDataViewChanged,disableDataView:this.props.disableDataView,isMultiple:this.props.isMultiple,rootDataSourceId:null===(r=null===(o=this.props.useDataSources)||void 0===o?void 0:o.find(t=>t.mainDataSourceId===e))||void 0===r?void 0:r.rootDataSourceId,dataViews:s[e],DefaultDataView:this.DefaultDataView,hideDataView:this.props.hideDataView,isMultipleDataView:this.props.isMultipleDataView,hideCreateViewButton:this.props.hideCreateViewButton,widgetId:this.props.widgetId,innerRef:t||a!==i-1?null:this.backToFocusNode},a):null}),e&&(0,q.jsx)(e,{isOpen:this.getIsDsListOpen(),position:"right",trigger:o,toggle:this.toggleDsList,widgetId:this.props.widgetId,backToFocusNode:this.backToFocusNode.current,title:this.props.hideHeader?null:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:f.defaultMessages.setDataSource}),children:(0,q.jsx)("div",{className:"bg-default h-100 w-100",children:(0,q.jsx)(Nt,Object.assign({},this.props,{onChange:this.onMainDsChanged,changeInitStatus:this.changeInitStatus,onCloseClick:this.onModalClose,isDataSourceInited:this.state.isDataSourceInited,disableSelection:this.disableSelection(),disableRemove:this.disableRemove(),hideHeader:!0}))})}),t&&(0,q.jsx)(f.Link,{className:"ds-selector-button w-100 mt-0 d-flex justify-content-center align-items-center px-2",onClick:this.toggleDsList,title:a,"aria-label":a,onKeyDown:this.onSelectDataKeyDown,"aria-describedby":this.props["aria-describedby"],ref:this.backToFocusNode,children:(0,q.jsx)("div",{className:"text-truncate font-weight-500",children:a})})]})}}const us=(0,m.withTheme)(ps);var hs=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};class gs extends s.React.PureComponent{constructor(){super(...arguments),this.onToggleUseDataEnabled=()=>{this.props.onToggleUseDataEnabled&&this.props.onToggleUseDataEnabled(!this.props.useDataSourcesEnabled)},this.onChange=e=>{var t;if(this.props.onChange){if(!this.props.isMultiple&&(null===(t=this.props.useDataSources)||void 0===t?void 0:t.length)===(null==e?void 0:e.length)){const t=this.props.useDataSources[0],s=e[0];(null==s?void 0:s.mainDataSourceId)===(null==t?void 0:t.mainDataSourceId)&&Object.keys(t).forEach(e=>{"dataViewId"===e||s[e]||(s[e]=t[e])})}this.props.onChange(e)}}}render(){if(!s.DataSourceManager.getInstance())return null;const e=this.props,{onChange:t}=e,a=hs(e,["onChange"]);return(0,q.jsx)("div",{className:(0,s.classNames)("w-100",{[this.props.className]:!!this.props.className}),children:(0,q.jsxs)("div",{className:"component-data-source-selector",children:[!this.props.mustUseDataSource&&(0,q.jsxs)(f.Label,{className:(0,s.classNames)("d-flex justify-content-between w-100 align-items-center",{"mb-4":this.props.useDataSourcesEnabled}),children:[(0,q.jsx)("div",{className:"w-75 d-inline-block font-dark-600 title3 hint-default",children:this.props.intl.formatMessage({id:"connectToData",defaultMessage:f.defaultMessages.connectToData})}),(0,q.jsx)(f.Switch,{checked:!!this.props.useDataSourcesEnabled,onChange:this.onToggleUseDataEnabled})]}),(this.props.mustUseDataSource||this.props.useDataSourcesEnabled)&&(0,q.jsx)(us,Object.assign({},a,{onChange:this.onChange}))]})})}}const ms=(0,s.injectIntl)((0,m.withStyles)(gs,"DataSourceSelector")),Ss=s.ReactRedux.connect(e=>{var t,s,a,i,o,r;return{dataSources:(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===a?void 0:a.dataSources:null===(i=e.appConfig)||void 0===i?void 0:i.dataSources,dataSourcesInfo:(null===(o=null===window||void 0===window?void 0:window.jimuConfig)||void 0===o?void 0:o.isBuilder)?null===(r=e.appStateInBuilder)||void 0===r?void 0:r.dataSourcesInfo:e.dataSourcesInfo}})(ms);var fs=c(4651),vs=c.n(fs),Ds=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const bs=e=>{const t=window.SVG,{className:a}=e,i=Ds(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:vs()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var ys=c(33208),ws=c.n(ys),xs=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Is=e=>{const t=window.SVG,{className:a}=e,i=xs(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:ws()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var js=c(73549),Ms=c.n(js),Cs=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Ns=e=>{const t=window.SVG,{className:a}=e,i=Cs(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Ms()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ts=c(45508),Os=c.n(Ts),Vs=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const As=e=>{const t=window.SVG,{className:a}=e,i=Vs(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Os()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Ls=c(65252),Es=c.n(Ls),ks=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const Rs=e=>{const t=window.SVG,{className:a}=e,i=ks(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,q.jsx)(t,Object.assign({className:o,src:Es()},i)):(0,q.jsx)("svg",Object.assign({className:o},i))};var Us=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};class Ps extends s.React.PureComponent{constructor(e){super(e),this.copyDataId=e=>Us(this,void 0,void 0,function*(){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();try{yield navigator.clipboard.writeText(this.props.dataSourceId),this.setState({isTooltipOpen:!0})}catch(e){console.error("Failed to copy the data source ID",e)}finally{setTimeout(()=>{this.setState({isTooltipOpen:!1})},2e3)}}),this.state={isTooltipOpen:!1}}render(){if(!this.props.dataSourceId)return null;const e=this.props.intl.formatMessage({id:"copyDataId",defaultMessage:f.defaultMessages.copyDataId});return(0,q.jsx)(f.Tooltip,{open:this.state.isTooltipOpen,css:s.css`.popper-box{ max-width: 240px; padding: 8px; border: 1px solid var(--sys-color-divider-secondary); box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.20); }`,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,title:this.props.intl.formatMessage({id:"dataIdCopied",defaultMessage:f.defaultMessages.dataIdCopied},{dataId:this.props.dataSourceId,div:e=>(0,q.jsx)("div",{style:{fontSize:"12px",color:"var(--sys-color-surface-paper-hint)",wordBreak:"break-all"},children:e})}),children:(0,q.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.copyDataId,disableHoverEffect:!0,disableRipple:!0,title:e,"aria-label":e,className:"flex-shrink-0 data-source-id-copy-button",children:(0,q.jsx)(Rs,{className:"m-0",size:"m"})})})}}var _s=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};class Ws extends s.React.PureComponent{constructor(e){super(e),this.onLabelChange=e=>{this.setState({newLabel:e.target.value})},this.onMoreIconClick=e=>{this.stopPropagation(e),this.props.onMoreIconClick&&this.props.onMoreIconClick(this.props.dataSourceJson)},this.onCloseIconClick=e=>{this.stopPropagation(e),this.props.onCloseIconClick&&this.props.onCloseIconClick(this.props.dataSourceJson)},this.onRename=()=>{const e=this.state.newLabel.trim();this.props.onRename&&this.props.onRename(e)},this.onDataSourceItemClick=e=>{this.stopPropagation(e),this.props.onDataSourceItemClick&&this.props.onDataSourceItemClick(this.props.dataSourceJson)},this.onDataSourceItemKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onDataSourceItemClick(e)},this.onMappingIconClick=e=>{this.stopPropagation(e),this.props.onMappingIconClick&&this.props.onMappingIconClick(this.props.dataSourceJson)},this.onHideIconClick=e=>{this.stopPropagation(e),this.props.onToggleHidden&&this.props.onToggleHidden(this.props.dataSourceJson)},this.onChildDataIconClick=e=>{this.stopPropagation(e),this.props.onChildDataIconClick&&this.props.onChildDataIconClick(this.props.dataSourceJson)},this.onRelatedWidgetsIconClick=e=>{this.stopPropagation(e),this.props.onRelatedWidgetsIconClick&&this.props.onRelatedWidgetsIconClick(this.props.dataSourceJson)},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getWhetherIsSetDs=e=>{if(!e)return!1;const t=s.DataSourceManager.getInstance().getDataSource(e.id);return!!t&&t.isDataSourceSet()},this.getChildDssLength=e=>{if(!e)return null;const t=s.DataSourceManager.getInstance().getDataSource(e.id);return t&&t.isDataSourceSet()?t.getChildDataSources().length:null},this.getLabel=()=>{var e,t,a,i;const o=s.DataSourceManager.getInstance().getDataSource(null===(e=this.props.dataSourceJson)||void 0===e?void 0:e.id);return(null==o?void 0:o.getLabel())||(null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.label)||(null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.sourceLabel)||(null===(i=this.props.dataSourceJson)||void 0===i?void 0:i.id)||""},this.copyDataId=e=>_s(this,void 0,void 0,function*(){this.stopPropagation(e);try{yield navigator.clipboard.writeText(this.props.dataSourceJson.id),this.setState({isTooltipOpen:!0})}catch(e){console.error("Failed to copy the data source ID",e)}finally{setTimeout(()=>{this.setState({isTooltipOpen:!1})},2e3)}}),this.state={newLabel:this.getLabel(),isTooltipOpen:!1}}componentDidUpdate(e,t){e.isRenameInputShown!==this.props.isRenameInputShown&&this.props.isRenameInputShown&&this.renameInput&&setTimeout(()=>{(0,s.focusElementInKeyboardMode)(this.renameInput,!0)},200),e.dataSourceJson!==this.props.dataSourceJson&&this.setState({newLabel:this.getLabel()})}render(){var e,t,a,i,o,r;if(!this.props.dataSourceJson)return null;const l=O(this.props.dataSourceJson.id,this.props.widgets,!1),n=V(this.props.dataSourceJson.id,this.props.widgets,!1),d=z(this.props.dataSourceJson),c=this.getWhetherIsSetDs(this.props.dataSourceJson);let p;c&&(p=this.getChildDssLength(this.props.dataSourceJson));const u=s.dataSourceUtils.getDsTypeString(this.props.dataSourceJson.type,this.props.intl),h=this.props.isMoreIconShown&&this.props.intl.formatMessage({id:"more",defaultMessage:f.defaultMessages.more}),g=this.props.isCloseIconShown&&this.props.intl.formatMessage({id:"remove",defaultMessage:f.defaultMessages.remove}),m=this.getLabel(),S=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceJson.id),v=s.dataSourceUtils.isItemMixin(S)?S.getItemInfo():null;return(0,q.jsx)("div",{className:(0,s.classNames)({[this.props.className]:!!this.props.className}),children:(0,q.jsxs)("div",{className:(0,s.classNames)("component-data-source-item",{"component-data-source-item-selected-item":this.props.isSelected,"cursor-pointer":!!this.props.onDataSourceItemClick}),onClick:this.onDataSourceItemClick,tabIndex:0,onKeyDown:this.onDataSourceItemKeyDown,role:"option",children:[this.props.isLoadingShown&&(0,q.jsx)("div",{className:"loading-container",children:(0,q.jsx)(f.Loading,{type:f.LoadingType.Bar})}),(0,q.jsxs)("div",{className:"d-flex justify-content-between align-items-center ds-item-header",children:[(0,q.jsxs)("div",{className:"d-flex align-items-center flex-grow-1 text-truncate",title:u,children:[(0,q.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",children:(0,q.jsx)(f.Icon,{icon:s.dataSourceUtils.getDsIcon(this.props.dataSourceJson),className:"text-default",size:"12"})}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",children:(0,q.jsx)("div",{className:"text-truncate ds-type-name",children:u})})]}),(0,q.jsxs)("div",{className:"d-flex flex-shrink-0",children:[(0,q.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-badge",children:!this.props.isLoadingShown&&(0,q.jsx)(G.DataBadge,{item:v,itemId:null===(e=this.props.dataSourceJson)||void 0===e?void 0:e.itemId,portalUrl:null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.portalUrl,url:null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.url})}),this.props.isErrorIconShown?(0,q.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-more p-2",children:(0,q.jsx)("span",{className:"d-flex justify-content-center",title:null!==(i=this.props.errorTitle)&&void 0!==i?i:this.props.intl.formatMessage({id:"uploadImageError",defaultMessage:f.defaultMessages.uploadImageError}),children:(0,q.jsx)(As,{className:"align-baseline warning-icon",size:"m"})})}):null,this.props.isHideable?(0,q.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary",disableRipple:!0,className:"flex-shrink-0 ds-more p-2",onClick:this.onHideIconClick,children:(0,q.jsx)("span",{className:"d-flex justify-content-center",title:(null===(o=this.props.dataSourceJson)||void 0===o?void 0:o.isHidden)?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:f.defaultMessages.clickToShow}):this.props.intl.formatMessage({id:"clickToHide",defaultMessage:f.defaultMessages.clickToHide}),children:(null===(r=this.props.dataSourceJson)||void 0===r?void 0:r.isHidden)?(0,q.jsx)(De,{className:"align-baseline",size:"m"}):(0,q.jsx)(me,{className:"align-baseline",size:"m"})})}):null,this.props.isMoreIconShown?(0,q.jsx)(f.Button,{size:"sm",icon:!0,"aria-label":h,title:h,type:"tertiary",disableRipple:!0,className:"flex-shrink-0 ds-more data-source-item-more-button",onClick:this.onMoreIconClick,"aria-haspopup":!!this.props.onMoreIconClick,children:(0,q.jsx)("span",{className:"d-flex justify-content-center",children:(0,q.jsx)(bs,{className:"align-baseline",size:"m"})})}):null,this.props.isCloseIconShown?(0,q.jsx)(f.Button,{size:"sm",icon:!0,"aria-label":g,title:g,type:"tertiary",disableRipple:!0,className:"flex-shrink-0 ds-more p-2",onClick:this.onCloseIconClick,children:(0,q.jsx)("span",{className:"d-flex justify-content-center",children:(0,q.jsx)(pe,{className:"align-baseline ds-close-icon",size:"m"})})}):null]})]}),(0,q.jsxs)("div",{className:"ds-item-body",children:[this.props.isRenameInputShown?(0,q.jsx)(f.TextInput,{className:"flex-grow-1 text-truncate p-1 ds-label ds-label-input",ref:e=>{this.renameInput=e},onBlur:this.onRename,onPressEnter:this.onRename,onChange:this.onLabelChange,value:this.state.newLabel,onClick:this.stopPropagation}):(0,q.jsx)("div",{className:"flex-grow-1 two-line-truncate ds-label text-left",title:m,children:m}),(0,q.jsxs)("div",{className:(0,s.classNames)("d-flex justify-content-between",{"mt-4":d||this.props.isMappingIconShown||this.props.isRelatedWidgetsShown||c}),children:[(0,q.jsxs)("div",{className:"d-flex",children:[c?(0,q.jsx)(f.Button,{type:"tertiary",disableHoverEffect:!0,disableRipple:!0,className:"mr-6 p-0 ds-child-dss",onClick:this.onChildDataIconClick,title:this.props.intl.formatMessage({id:"containLayersWithNum",defaultMessage:f.defaultMessages.containLayersWithNum},{layerNum:p}),children:(0,q.jsxs)("span",{children:[(0,q.jsx)(Is,{size:"m",className:"mr-1"}),(0,q.jsx)("span",{className:"align-middle",children:p})]})}):null,this.props.isRelatedWidgetsShown?(0,q.jsx)(f.Button,{type:"tertiary",disableHoverEffect:!0,disableRipple:!0,className:"p-0 flex-grow-1 text-truncate flex-row ds-related-widgets",onClick:this.onRelatedWidgetsIconClick,title:this.props.intl.formatMessage({id:"relatedWidgetsWithNum",defaultMessage:f.defaultMessages.relatedWidgetsWithNum},{directlyNum:l.length,totalNum:n.length}),children:(0,q.jsxs)("span",{children:[(0,q.jsx)(Ns,{size:"m",className:"mr-1"}),(0,q.jsx)("span",{className:"align-middle",children:`${l.length} / ${n.length}`})]})}):null]}),(0,q.jsxs)("div",{className:"d-flex",children:[this.props.isCopyIdIconShown?(0,q.jsx)(Ps,{dataSourceId:this.props.dataSourceJson.id,intl:this.props.intl}):null,d?(0,q.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary",href:d,target:"_blank",onClick:this.stopPropagation,disableHoverEffect:!0,disableRipple:!0,title:this.props.intl.formatMessage({id:"source",defaultMessage:f.defaultMessages.source}),"aria-label":this.props.intl.formatMessage({id:"openInNewWindow",defaultMessage:f.defaultMessages.openInNewWindow}),children:(0,q.jsx)(it,{className:"m-0",size:"m"})}):null]})]})]})]})})}}const $s=s.ReactRedux.connect((e,t)=>{var s,a;const i=(null===(s=null===window||void 0===window?void 0:window.jimuConfig)||void 0===s?void 0:s.isBuilder)?e.appStateInBuilder:e;return t.isRelatedWidgetsShown?{widgets:null===(a=null==i?void 0:i.appConfig)||void 0===a?void 0:a.widgets}:null})((0,s.injectIntl)((0,m.withStyles)(Ws,"DataSourceItem")));class Fs extends s.React.PureComponent{render(){return this.props.dataSourceJson?(0,q.jsx)("div",{className:(0,s.classNames)({[this.props.className]:!!this.props.className}),children:(0,q.jsx)("div",{className:"component-data-source-error-item",children:(0,q.jsx)($s,Object.assign({},this.props))})}):null}}const Bs=(0,m.withStyles)(Fs,"DataSourceErrorItem");class zs extends s.React.PureComponent{constructor(e){super(e),this.state={isOpen:!1}}render(){const e=this.props.fields;if(!e||!this.props.ds)return null;const t=e[N]?[N]:[];return(0,q.jsx)("div",{className:"field-list px-4",role:"menu",children:e&&t.concat(Object.keys(e).filter(e=>e!==N)).map(t=>{const a=T(e[t].type,this.props.theme,this.props.intl),i=this.props.selectedFields&&(this.props.isMultiple?this.props.selectedFields.some(e=>e===t):t===this.props.selectedFields[0]),o=e[t].alias||e[t].name;return(0,q.jsxs)(f.Button,{role:"menuitem"+(this.props.isMultiple?"checkbox":"radio"),title:o,"aria-checked":i,"aria-label":`${null==a?void 0:a.title} ${o}`,onClick:()=>{this.props.onFieldClick([e[t]])},className:(0,s.classNames)("field-item mt-2 py-1 px-2 d-flex w-100 align-items-center",{"field-item-selected":i}),children:[a&&(0,q.jsx)(f.Icon,{icon:a.icon,color:a.color,className:"mr-2 flex-shrink-0",size:16}),(0,q.jsx)("div",{className:"flex-grow-1 text-truncate",children:o})]},t)})})}}class Js extends s.React.PureComponent{constructor(){super(...arguments),this.dropdownProps={autoWidth:!0},this.onChange=e=>{var t,a;const i=(null===(t=this.props.selectedFields)||void 0===t?void 0:t.asMutable().filter(e=>e!==N))||[],o=[],r=[];null===(a=this.props.disabledFields)||void 0===a||a.forEach(e=>{i.includes(e)?o.push(e):r.push(e)});const l=((null==e?void 0:e.map(e=>e.value))||[]).filter(e=>!r.includes(e)).concat(o),n=s.utils.diffArrays(!0,i,l),d=n.deleted.concat(n.added);d.length>0&&this.props.onFieldClick(d.map(e=>this.props.fields[e]))},this.getFields=()=>{if(this.props.fields){const e=[];return(this.props.fields[N]?[N]:[]).concat(Object.keys(this.props.fields).filter(e=>e!==N)).forEach(t=>{const s=this.getFieldItem(t);e.push(s)}),e}return[]},this.getSelectedFields=()=>{if(this.props.fields&&this.props.selectedFields){const e=[];return this.props.selectedFields.filter(e=>!!this.props.fields[e]).forEach(t=>{const s=this.getFieldItem(t);e.push(s)}),e}return[]},this.getFieldItem=e=>{var t,s,a,i;const o=(null===(t=this.props.fields[e])||void 0===t?void 0:t.alias)||(null===(s=this.props.fields[e])||void 0===s?void 0:s.name),r=T(null===(a=this.props.fields[e])||void 0===a?void 0:a.type,this.props.theme,this.props.intl);return{value:e,label:o,disabled:null===(i=this.props.disabledFields)||void 0===i?void 0:i.includes(e),render:()=>(0,q.jsxs)("div",{className:"d-flex justify-content-start align-items-center text-truncate","aria-label":`${null==r?void 0:r.title} ${o}`,children:[r&&(0,q.jsx)(f.Icon,{icon:r.icon,color:r.color,className:"d-inline-block mr-2",size:16}),(0,q.jsx)("div",{className:"text-truncate",title:o,children:o})]})}},this.toggleAdvancedSelect=e=>{this.props.toggle&&this.props.toggle(e)}}render(){if(!this.props.fields||!this.props.ds)return null;const e=this.props.dropdownProps?Object.assign(Object.assign({},this.props.dropdownProps),this.dropdownProps):this.dropdownProps;return(0,q.jsx)("div",{children:(0,q.jsx)(f.AdvancedSelect,Object.assign({size:"sm"},e,{staticValues:this.getFields(),sortList:!1,selectedValues:this.getSelectedFields(),onChange:this.onChange,placeholder:this.props.placeholder,isMultiple:this.props.isMultiple,hideSearchInput:this.props.isSearchInputHidden,hideBottomTools:!this.props.useMultiDropdownBottomTools,isEmptyOptionHidden:!0,title:this.getSelectedFields().map(e=>e.label).toString(),toggle:this.toggleAdvancedSelect}))})}}var Hs,qs=c(41496);!function(e){e.First="POPULATED_VIEW_SELECTION_DEFAULT",e.Second="VIEW_DEFAULT_SELECTION_POPULATED"}(Hs||(Hs={}));const Gs="USE_MAIN_DATA_SOURCE";class Ks extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherUseDsIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some((e,s)=>e.dataSourceId!==t[s].dataSourceId)),s},this.isPopulatedView=e=>(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID,this.isSelectionView=e=>(null==e?void 0:e.dataViewId)===s.CONSTANTS.SELECTION_DATA_VIEW_ID,this.isDefaultView=e=>(null==e?void 0:e.dataViewId)===Gs||(null==e?void 0:e.dataViewId)===s.CONSTANTS.OUTPUT_DATA_VIEW_ID,this.isCommonView=e=>(null==e?void 0:e.dataViewId)&&!this.isPopulatedView(e)&&!this.isSelectionView(e)&&!this.isDefaultView(e),this.getOneDefaultUseDs=(e,t,s)=>{const a=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,t,s);let i=[];i=this.props.defaultDataViewPriority===Hs.Second?[this.isCommonView,this.isDefaultView,this.isSelectionView,this.isPopulatedView]:[this.isPopulatedView,this.isCommonView,this.isSelectionView,this.isDefaultView];const o=Object.values(a).find(e=>e.some(e=>i[0](e)))||Object.values(a).find(e=>e.some(e=>i[1](e)))||Object.values(a).find(e=>e.some(e=>i[2](e)))||Object.values(a).find(e=>e.some(e=>i[3](e)))||Object.values(a)[0];return o?o.find(e=>i[0](e))||o.find(e=>i[1](e))||o.find(e=>i[2](e))||o.find(e=>i[3](e))||o[0]:null},this.getSelectedUseDsFromProps=(e,t,a,i,o)=>{var r,l;const n=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,a,o),d=this.getOneDefaultUseDs(e,a,o);return t?i?null===(r=n[t.mainDataSourceId])||void 0===r?void 0:r.find(e=>e.dataViewId===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID):t.dataViewId?t:null===(l=n[t.mainDataSourceId])||void 0===l?void 0:l.find(e=>e.dataViewId===Gs):d},this.getWhetherUseRepeatedDataSourceContext=(e,t,a,i)=>{var o,r,l,n;const d=P();if(!(d&&e&&t&&0!==t.length&&a&&i))return!1;if(null===(l=null===(r=null===(o=d.widgets[e])||void 0===o?void 0:o.manifest)||void 0===r?void 0:r.properties)||void 0===l?void 0:l.canProvideRepeatDataSource)return!0;const c=qs.searchUtils.getParentWidgetIdOfContent(d,e,s.LayoutItemType.Widget,i),p=d.widgets[c],u=p&&(null===(n=p.manifest.properties)||void 0===n?void 0:n.canProvideRepeatDataSource);if(!u)return!1;let h=!1;for(let e=0;e<t.length;e++){const s=this.getRealUseDataSources(t[e],a);if(h=(null==p?void 0:p.useDataSources)&&p.useDataSources.some(e=>(null==s?void 0:s.dataSourceId)===e.dataSourceId),h)break}return u&&h},this.groupUseDataSourcesByMainDsAndAddAutoViews=(e,t,a)=>{if(!a||!t||0===t.length)return{};const i={};return t.forEach(e=>{if(i[e.mainDataSourceId]||(i[e.mainDataSourceId]=[]),!i[e.mainDataSourceId].some(t=>t.dataSourceId===e.dataSourceId)){if(!e.dataViewId&&e.dataSourceId===e.mainDataSourceId){const t=e.set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(e.mainDataSourceId,Gs)).set("dataViewId",Gs);i[e.mainDataSourceId]=i[e.mainDataSourceId].concat(t)}else i[e.mainDataSourceId]=i[e.mainDataSourceId].concat(e)}}),Object.keys(i).forEach(s=>{i[s]=i[s].concat(this.getAutoAddedDataViews(e,i[s],t,a))}),i},this.getAutoAddedDataViews=(e,t,a,i)=>{if(!t||0===t.length||!i)return[];const o=s.DataSourceManager.getInstance().getDataSource(t[0].mainDataSourceId);if(!!!(null==o?void 0:o.query))return[];let r=[];if(this.props.useSelectionDataView&&!t.some(e=>e.dataViewId===s.CONSTANTS.SELECTION_DATA_VIEW_ID)){const e=t[0].set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,s.CONSTANTS.SELECTION_DATA_VIEW_ID)).set("dataViewId",s.CONSTANTS.SELECTION_DATA_VIEW_ID);r=r.concat(e)}if(this.props.usePopulatedDataView&&this.getWhetherUseRepeatedDataSourceContext(e,t,a,i)){const e=t[0].set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)).set("dataViewId",s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID);r=r.concat(e)}return r},this.getDsLabel=(e,t)=>{if(t&&t===s.CONSTANTS.SELECTION_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:f.defaultMessages.selectionDataView});if(t&&t===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"populatedDataView",defaultMessage:f.defaultMessages.populatedDataView});if(t&&(t===Gs||t===s.CONSTANTS.OUTPUT_DATA_VIEW_ID))return this.props.intl.formatMessage({id:"default",defaultMessage:f.defaultMessages.default});const a=s.DataSourceManager.getInstance().getDataSource(e);return a?a.getLabel()||a.id:e},this.getRealUseDataSources=(e,t)=>{if(!e)return null;if(e.dataViewId===Gs)return e.set("dataSourceId",e.mainDataSourceId).without("dataViewId");if(e.dataViewId===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID){const a=t.find(t=>t.mainDataSourceId===e.mainDataSourceId);return a&&(0,s.Immutable)(a)}return e},this.onMainDataChange=e=>{const t=e.target.value;if(t!==this.props.selectedUseDataSource.mainDataSourceId){const e=this.props.useDataSources.find(e=>e.mainDataSourceId===t)||{dataSourceId:t,mainDataSourceId:t},a=this.getOneDefaultUseDs(this.props.widgetId,(0,s.Immutable)([e]),this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(a,this.props.useDataSources),(null==a?void 0:a.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}},this.onDataViewChange=e=>{if(!this.props.selectedUseDataSource)return;const t=e.target.value,a=this.props.selectedUseDataSource.set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(this.props.selectedUseDataSource.mainDataSourceId,t)).set("dataViewId",t);this.props.onChange(this.getRealUseDataSources(a,this.props.useDataSources),(null==a?void 0:a.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidMount(){if(!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidUpdate(e){if(e.widgetId!==this.props.widgetId||!this.getWhetherUseDsIsShallowEqual(e.useDataSources,this.props.useDataSources)||e.browserSizeMode!==this.props.browserSizeMode||!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}render(){var e;if(!this.props.useDataSources)return null;const t=this.groupUseDataSourcesByMainDsAndAddAutoViews(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode),a=this.getSelectedUseDsFromProps(this.props.widgetId,this.props.selectedUseDataSource,this.props.useDataSources,this.props.isSelectedFromRepeatedDataSourceContext,this.props.browserSizeMode);return(0,q.jsx)("div",{className:(0,s.classNames)("main-data-and-view-selector w-100",{[this.props.className]:!!this.props.className}),children:(0,q.jsxs)("div",{className:"component-main-data-and-view",role:"group","aria-label":this.props.intl.formatMessage({id:"data",defaultMessage:f.defaultMessages.data}),children:[!this.props.hideMainDataSourceSelect&&(0,q.jsx)("div",{className:"w-100 text-truncate mb-3 option-label mb-2",children:this.props.intl.formatMessage({id:"data",defaultMessage:f.defaultMessages.data})}),!this.props.hideMainDataSourceSelect&&(0,q.jsx)("div",{className:"flex-grow-1",children:(0,q.jsx)(f.Select,{value:null==a?void 0:a.mainDataSourceId,className:"jimu-outline-inside",onChange:this.onMainDataChange,size:"sm",children:Object.keys(t).sort((e,t)=>null==e?void 0:e.localeCompare(t)).map((e,t)=>(0,q.jsx)("option",{value:e,title:this.getDsLabel(e),children:(0,q.jsx)("div",{className:"text-truncate",children:this.getDsLabel(e)})},t))})}),(0,q.jsx)("div",{className:(0,s.classNames)("flex-grow-1",{"mt-2":!this.props.hideMainDataSourceSelect}),children:(0,q.jsx)(f.Select,{value:null==a?void 0:a.dataViewId,className:"jimu-outline-inside",onChange:this.onDataViewChange,size:"sm",children:null===(e=t[null==a?void 0:a.mainDataSourceId])||void 0===e?void 0:e.sort((e,t)=>{var s;return null===(s=null==e?void 0:e.dataSourceId)||void 0===s?void 0:s.localeCompare(null==t?void 0:t.dataSourceId)}).map((e,t)=>(0,q.jsx)("option",{value:e.dataViewId,title:this.getDsLabel(e.dataSourceId,e.dataViewId),children:(0,q.jsx)("div",{className:"text-truncate",children:this.getDsLabel(e.dataSourceId,e.dataViewId)})},t))})})]})})}}const Qs=s.ReactRedux.connect((e,t)=>{var s,a;return{browserSizeMode:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.browserSizeMode:null==e?void 0:e.browserSizeMode}})(Ks),Xs=(0,s.injectIntl)((0,m.withStyles)(Qs,"MainDataAndViewSelector"));class Ys extends s.React.PureComponent{constructor(e){super(e),this.getWhetherArrayIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some((e,s)=>e!==t[s])),s},this.getDefaultSelectedDs=(e,t)=>this.hasSelectedFields()||this.props.isDataSourceDropDownHidden?this.getDsFromSelectedFieldsAndUseDss(e,t):null,this.hasSelectedFields=()=>!!this.props.selectedFields&&(Array.isArray(this.props.selectedFields)?this.props.selectedFields.length>0:"object"==typeof this.props.selectedFields&&Object.values(this.props.selectedFields).every(e=>e&&e.length>0)),this.getDsFromSelectedFieldsAndUseDss=(e,t)=>{let a;if(t&&e){if(this.getAreFromMultipleDss(e,t)){const e=Object.keys(this.props.selectedFields)[0];if(e.split("-").reverse()[0]===s.CONSTANTS.SELECTION_DATA_VIEW_ID){const t=s.DataSourceManager.getInstance().getDataSource(e),i=t&&t.getMainDataSource(),o=i&&i.id;a=this.props.dataSources.some(e=>e&&e.getMainDataSource().id===o)?t:null}else a=this.props.dataSources.find(t=>t&&t.id===e)}else a=e[0]}else e&&(a=e[0]);return a},this.getAreFromMultipleDss=(e,t)=>t?!Array.isArray(t):(null==e?void 0:e.length)>1,this.getDsLabel=e=>e&&e.getDataSourceJson()&&(e.getLabel()||e.id)||"",this.getFieldsJimuNameFromMultiDssFields=(e,t,a,i)=>{if(!e||!e.id||!a)return(0,s.Immutable)([]);const o=this.getAreFromMultipleDss(t,a)?(0,s.Immutable)(a[e.id]):a;return o?i?o:o.slice(0,1):(0,s.Immutable)([])},this.getSelectedUseDataSource=()=>this.state.selectedDs?this.getUseDataSources([this.state.selectedDs])[0]:null,this.getWhetherJimuNameIsInHiddenFields=e=>{var t;let a=!1;if(this.props.hiddenFields){const i=this.getAreFromMultipleDss(this.props.dataSources,this.props.selectedFields);let o=(0,s.Immutable)([]);o=i?this.props.hiddenFields[null===(t=this.state.selectedDs)||void 0===t?void 0:t.id]:this.props.hiddenFields,a=o.some(t=>t===e)}return a},this.getValidFields=e=>{const t=this.getAllFields(e);if(!t)return null;let a;if(this.props.types||this.props.hiddenFields||this.state.searchValue){let e,i,o=(0,s.Immutable)({});Object.keys(t).forEach(s=>{e=t[s].type,i=t[s].alias||t[s].name;const a=!this.props.types||e&&this.props.types&&this.props.types.some(t=>t===e),r=this.getWhetherJimuNameIsInHiddenFields(s),l=!this.state.searchValue||this.state.searchValue&&i&&i.toLowerCase().includes(this.state.searchValue.toLowerCase());a&&!r&&l&&(o=o.setIn([s],t[s]))}),a=o}else a=t;return a&&this.props.noSelectionItem&&(a=a.set(N,this.getNoSelectionItem())),a},this.getNoSelectionItem=()=>(0,s.Immutable)(Object.assign(Object.assign({},this.props.noSelectionItem),{jimuName:N})),this.getUseDataSources=e=>{if(!e)return null;let t=(0,s.Immutable)([]);return e.forEach(e=>{var s;e&&(t=t.concat({dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(s=e.getRootDataSource())||void 0===s?void 0:s.id}))}),t},this.onSelectedUseDsChange=(e,t)=>{const a=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(this.setState({selectedDs:a,isFromRepeatedDs:t}),this.hasSelectedFields()){const e=this.getFieldsJimuNameFromMultiDssFields(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple).map(e=>{var t;return a&&(null===(t=this.getAllFields(a))||void 0===t?void 0:t[e])}).filter(e=>!!e);this.props.onChange&&this.props.onChange(e.asMutable(),a,t)}},this.onSearchChange=e=>{this.setState({searchValue:e.target.value})},this.onSelectedFieldsChange=e=>{if(e.some(e=>(null==e?void 0:e.jimuName)===N))return void(this.props.onChange&&this.props.onChange([],this.state.selectedDs,this.state.isFromRepeatedDs));const t=this.getFieldsJimuNameFromMultiDssFields(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple).asMutable(),s=this.getAllFields(this.state.selectedDs);let a=t.map(e=>null==s?void 0:s[e]).filter(e=>e);e.forEach(e=>{e&&(a=t.some(t=>t===e.jimuName)?a.filter(t=>t.jimuName!==e.jimuName):a.concat(e))}),this.props.onChange&&this.props.onChange(this.props.isMultiple?a:[a.pop()],this.state.selectedDs,this.state.isFromRepeatedDs)},this.toggleDropdown=e=>{this.props.toggle&&this.props.toggle(e)},this.state={selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields),searchValue:"",isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext}}componentDidMount(){var e;if(this.props.useDefault&&!this.props.selectedFields){const t=Object.values(null!==(e=this.getValidFields(this.state.selectedDs))&&void 0!==e?e:{})[0];t&&this.props.onChange([t],this.state.selectedDs,this.state.isFromRepeatedDs)}}componentDidUpdate(e,t){var s;if(this.getWhetherArrayIsShallowEqual(this.props.dataSources,e.dataSources)&&this.props.selectedFields===e.selectedFields||this.setState({selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields)}),this.props.useDefault&&!this.props.selectedFields&&t.selectedDs!==this.state.selectedDs){const e=Object.values(null!==(s=this.getValidFields(this.state.selectedDs))&&void 0!==s?s:{})[0];e&&this.props.onChange([e],this.state.selectedDs,this.state.isFromRepeatedDs)}e.isSelectedFromRepeatedDataSourceContext!==this.props.isSelectedFromRepeatedDataSourceContext&&this.setState({isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext})}getAllFields(e){var t;const s=null==e?void 0:e.getSelectedFields(),a=null===(t=null==e?void 0:e.getSchema())||void 0===t?void 0:t.fields,i=a?Object.keys(a).filter(e=>!s.includes(e)):[];return null==a?void 0:a.without(...i)}render(){if(!this.props.dataSources||0===this.props.dataSources.filter(e=>!!e).length)return console.warn("No data sources"),null;const e=this.getValidFields(this.state.selectedDs),t=this.getFieldsJimuNameFromMultiDssFields(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple),a=this.getFieldsJimuNameFromMultiDssFields(this.state.selectedDs,this.props.dataSources,this.props.disabledFields,this.props.isMultiple),i=this.props.noSelectionItem&&0===t.length?(0,s.Immutable)([this.getNoSelectionItem().jimuName]):t,o=Object.assign(Object.assign({},this.props.dropdownProps),{useKeyUpEvent:this.props.useKeyUpEvent,"aria-label":this.props["aria-label"]||this.props.intl.formatMessage({id:"fieldSelector",defaultMessage:f.defaultMessages.fieldSelector})});return(0,q.jsx)("div",{style:this.props.style,className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className}),children:(0,q.jsxs)("div",{className:"component-field-selector w-100 h-100",children:[this.props.isDataSourceDropDownHidden?null:(0,q.jsx)("div",{className:"ds-name p-4 d-flex justify-content-between align-items-center",children:(0,q.jsx)(Xs,{widgetId:this.props.widgetId,useDataSources:this.getUseDataSources(this.props.dataSources),onChange:this.onSelectedUseDsChange,useSelectionDataView:this.props.useSelectionDataView,usePopulatedDataView:this.props.usePopulatedDataView,selectedUseDataSource:this.getSelectedUseDataSource(),isSelectedFromRepeatedDataSourceContext:this.state.isFromRepeatedDs})}),this.props.isSearchInputHidden||this.props.useDropdown?null:(0,q.jsx)("div",{className:"d-inline-block w-100 px-4 mb-2 item-selector-search",children:(0,q.jsx)(f.TextInput,{placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:s.defaultMessages.search}),onChange:this.onSearchChange,className:"d-inline-block search-input",value:this.state.searchValue,prefix:(0,q.jsx)(Mt,{color:this.props.theme.ref.palette.neutral[1200]})})}),this.props.useDropdown?(0,q.jsx)(Js,{placeholder:this.props.placeholder,ds:this.state.selectedDs,fields:e,selectedFields:i,isMultiple:this.props.isMultiple,isSearchInputHidden:this.props.isSearchInputHidden,onFieldClick:this.onSelectedFieldsChange,theme:this.props.theme,dropdownProps:o,useMultiDropdownBottomTools:this.props.useMultiDropdownBottomTools,intl:this.props.intl,toggle:this.props.toggle,disabledFields:a}):(0,q.jsx)(zs,{ds:this.state.selectedDs,fields:e,selectedFields:i,intl:this.props.intl,isMultiple:this.props.isMultiple,onFieldClick:this.onSelectedFieldsChange,theme:this.props.theme})]})})}}const Zs=(0,m.withStyles)((0,m.withTheme)((0,s.injectIntl)(Ys)),"FieldSelector");var ea=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};class ta extends s.React.PureComponent{render(){const e=this.props,{useDataSources:t,dataSources:a}=e,i=ea(e,["useDataSources","dataSources"]);return a?(0,q.jsx)(Zs,Object.assign({},this.props)):1===(null==t?void 0:t.length)?(0,q.jsx)(s.DataSourceComponent,{useDataSource:t[0],children:(e,t)=>(0,q.jsx)(Zs,Object.assign({},i,{dataSources:[e]}))}):(0,q.jsx)(s.MultipleDataSourceComponent,{useDataSources:t,children:(e,t)=>(0,q.jsx)(Zs,Object.assign({},i,{dataSources:e&&Object.values(e)}))})}}var sa=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};const{useState:aa,useEffect:ia,useRef:oa}=s.React;var ra;!function(e){e.Success="SUCCESS",e.Error="ERROR"}(ra||(ra={}));const la=e=>{const t=oa(!1),a=s.hooks.useTranslation(f.defaultMessages),{useDataSources:i,selectedFields:o,addDefinitionStatusChange:r,onChange:l}=e,[n,d]=aa(!1),[c,p]=aa(null);ia(()=>{if(!t.current&&o){const e=u(o);p(e),t.current=!0,D(e)}},[o]),ia(()=>()=>{D()},[]);const u=e=>{var t;const a=v();if(!a||!e)return[];const i=(null===(t=null==a?void 0:a.getSchema())||void 0===t?void 0:t.fields)||{},o=[];for(const t in i)e.includes(i[t].name)&&o.push((0,s.Immutable)(i[t]));return o},h=s.hooks.useEventCallback((e,t,s)=>{p(e),l&&l(e,t,s)}),g=(e=[])=>{const t=v(),s=t.getLayerDefinition();let a=(null==s?void 0:s.indexes)||[];a=a.concat(e);const i=Object.assign(Object.assign({},s),{indexes:a});t.setLayerDefinition(i)},m=()=>sa(void 0,void 0,void 0,function*(){let e=[];return sa(void 0,void 0,void 0,function*(){const e=v().getDataSourceJson().url;return s.requestUtils.requestWrapper(e,t=>sa(void 0,void 0,void 0,function*(){return s.esri.restRequest.request(e,{params:{f:"json"},authentication:t,httpMethod:"GET"}).then(e=>{const t=(null==e?void 0:e.indexes)||[];return Promise.resolve(t)})}))}).then(t=>(null==t||t.forEach(t=>{var s;if(t.fields&&"FullText"===(null==t?void 0:t.indexType)){const a=(null===(s=t.fields)||void 0===s?void 0:s.split(", "))||[];e=e.concat(a)}}),Promise.resolve(e)))}),S=e=>{var t,a;const i=[];e.forEach(e=>{e.esriType!==s.EsriFieldType.GlobalID&&e.type===s.JimuFieldType.String&&i.push({name:`exb_${e.name}`,fields:e.name})});const o={name:`exb_${null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.name}_total`,fields:null===(a=null==e?void 0:e.map(e=>e.name))||void 0===a?void 0:a.join(", "),indexType:"FullText"};return i.push(o),i},v=()=>{var e;const t=null===(e=i[0])||void 0===e?void 0:e.dataSourceId;return s.DataSourceManager.getInstance().getDataSource(t)},D=e=>sa(void 0,void 0,void 0,function*(){var t,a;const i=v();if(null===(a=null===(t=null==i?void 0:i.getLayerDefinition())||void 0===t?void 0:t.advancedQueryCapabilities)||void 0===a?void 0:a.supportsFullTextSearch){const t=e||c;((e,t)=>{sa(void 0,void 0,void 0,function*(){if(!e||0===(null==e?void 0:e.length))return!1;const a=t.getDataSourceJson().url,i=S(e);if(!i||0===(null==i?void 0:i.length))return!1;d(!0),yield s.requestUtils.requestWrapper(a,e=>sa(void 0,void 0,void 0,function*(){if(!e)return void d(!1);let t=`${a}/addToDefinition`;t=t.replace(/rest\/services/g,"rest/admin/services"),yield s.esri.restRequest.request(t,{params:{f:"json",async:!0,addToDefinition:{indexes:i}},authentication:e,httpMethod:"POST"}).then(e=>{(null==e?void 0:e.error)?r&&r(ra.Error):(r&&r(ra.Success),g(i)),d(!1)}).catch(e=>{r&&r(ra.Error),d(!1)})}))})})(yield(e=>sa(void 0,void 0,void 0,function*(){return e?m().then(t=>{const s=e.filter(e=>!(null==t?void 0:t.includes(e.name)));return Promise.resolve(s)}):[]}))(t),i)}}),b=s.css`
    .loading {
      margin-top: ${s.polished.rem(6)};
      color: var(--ref-palette-neutral-900);
      align
    }
    .loading-msg {
      margin-left: ${s.polished.rem(10)};
    }
    .loading-icon-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${s.polished.rem(16)};
      height: ${s.polished.rem(16)};
      min-width: ${s.polished.rem(16)};
      border: 2px solid var(--ref-palette-neutral-900);
      border-radius: 50%;
      border-top: 2px solid var(--sys-color-primary-main);
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
  `;return(0,q.jsxs)("div",{className:"field-selector-with-full-text-index-con w-100",css:b,children:[(0,q.jsx)(ta,Object.assign({},e,{onChange:h,toggle:e=>{if(e)return!1;D()}})),n&&(0,q.jsxs)("div",{className:"loading d-flex align-items-center",children:[(0,q.jsx)("div",{className:"loading-icon-con"}),(0,q.jsx)("div",{className:"loading-msg",children:a("creatingIndexes")})]})]})};class na extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.close=()=>{this.props.isOpen&&!this.__unmount&&this.props.toggle()},this.onCheckboxBtnClick=(e,t)=>{this.stopPropagation(t);const s=this.state.selectedWidgets.indexOf(e);s<0?this.state.selectedWidgets.push(e):this.state.selectedWidgets.splice(s,1),this.setState({selectedWidgets:[...this.state.selectedWidgets]})},this.onRemove=e=>{if(this.stopPropagation(e),this.state.getAppConfigAction){if(this.state.selectedWidgets.length>0){const e=this.state.getAppConfigAction();this.state.selectedWidgets.forEach((t,s)=>{e.removeWidget(t)}),e.exec()}this.props.afterRemove&&this.props.afterRemove()}this.close()},this.onCancel=e=>{this.stopPropagation(e),this.props.onCancel&&this.props.onCancel(),this.close()},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.state={selectedWidgets:[],getAppConfigAction:null,proxySettingUtils:null}}componentDidMount(){this.__unmount=!1,Promise.all([s.moduleLoader.loadModule("jimu-for-builder"),s.moduleLoader.loadModule("jimu-ui/advanced/setting-components")]).then(e=>{const[{getAppConfigAction:t},{proxySettingUtils:s}]=e;this.__unmount||this.setState({getAppConfigAction:t,proxySettingUtils:s})})}componentWillUnmount(){this.__unmount=!0}render(){const e=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId),t=this.props.label||(null==e?void 0:e.getLabel())||this.props.dataSourceId,a=this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel}),i=this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:f.defaultMessages.relatedWidgets}),o=V(this.props.dataSourceId,this.props.widgets),r=this.props.intl.formatMessage({id:"updateDataStructure",defaultMessage:f.defaultMessages.updateDataStructure}),l=this.props.intl.formatMessage({id:"updateDataStructureTip",defaultMessage:f.defaultMessages.updateDataStructureTip}),n=this.props.intl.formatMessage({id:"updateDataStructureAffectedWidgets",defaultMessage:f.defaultMessages.updateDataStructureAffectedWidgets}),d=r,c=this.props.intl.formatMessage({id:"updateDataStructureTip2",defaultMessage:f.defaultMessages.updateDataStructureTip2}),p=`${this.props.dataSourceId}-desc`;return(0,q.jsxs)(f.Modal,{isOpen:this.props.isOpen,className:(0,s.classNames)("bg-light-300 d-flex justify-content-between",{[this.props.className]:!!this.props.className}),onClick:this.stopPropagation,role:"dialog","aria-label":r,"aria-describedby":p,children:[(0,q.jsx)(f.ModalHeader,{className:"d-flex justify-content-between border-color-gray-300 py-4 font-16 font-dark-600",onClick:this.stopPropagation,toggle:this.props.toggle,title:r,children:r}),(0,q.jsx)(f.ModalBody,{onClick:this.stopPropagation,id:p,children:(0,q.jsxs)("div",{className:"px-2 py-0",children:[(0,q.jsx)("p",{className:"font-13 font-dark-600","data-testid":"confirmDeleteMessage",children:l}),(0,q.jsx)("p",{className:"font-14 font-dark-800 mt-4",children:t}),(0,q.jsx)("p",{className:"font-13 font-dark-600 mt-4",children:n}),(0,q.jsxs)("div",{role:"group","aria-label":i,children:[(0,q.jsx)("p",{className:"font-14 font-dark-400 mt-4",children:i}),(0,q.jsx)("div",{className:"related-widgets px-2 py-4",children:(0,q.jsx)("div",{children:o.map(e=>e&&e.id?(0,q.jsxs)(f.Label,{className:"d-flex",children:[(0,q.jsx)(f.Checkbox,{className:"mr-2 font-13",onClick:t=>{this.onCheckboxBtnClick(e.id,t)},checked:this.state.selectedWidgets.includes(e.id)}),(0,q.jsx)(f.Icon,{icon:e.icon,size:"16",className:"mr-1 font-dark-800"}),e.label]},e.id):null)})})]}),(0,q.jsx)("p",{className:"font-13 font-dark-600 mt-2 mb-0",children:c})]})}),(0,q.jsx)(f.ModalFooter,{children:(0,q.jsxs)("div",{className:"d-flex justify-content-end mt10",children:[(0,q.jsx)(f.Button,{type:"primary",className:"mr-2",onClick:this.onRemove,"aria-label":d,children:d}),(0,q.jsx)(f.Button,{type:"default",onClick:this.onCancel,"aria-label":a,children:a})]})})]})}}const da=s.ReactRedux.connect((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}})(na),ca=(0,m.withStyles)((0,s.injectIntl)(da),"DataSourceRemoveWarningPopup");var pa=function(e,t,s,a){return new(s||(s=Promise))(function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,l)}n((a=a.apply(e,t||[])).next())})};const ua=s.css`
  display: flex;
  .error-icon { width: 1rem; height: 1rem; }
  .error-msg { color: var(--sys-color-error); }
`,ha=s.css`
  arcgis-arcade-editor {
    --arcgis-coding-components-border: 1px solid var(--sys-color-divider-secondary, #585858);
    border-color: var(--sys-color-divider-secondary, #585858);

    calcite-action-bar.main-action-bar,
    arcgis-editor-variables.side-panel,
    arcgis-language-api-panel.side-panel,
    arcgis-arcade-suggestions.side-panel,
    calcite-action-bar.side-action-bar {
      border-color: var(--sys-color-divider-secondary, #585858);
    }

    --calcite-action-background-color-hover: #212121;
    --calcite-color-foreground-3: var(--sys-color-action-pressed);
    --calcite-list-background-color: var(--sys-color-surface-overlay);
    --calcite-list-background-color-hover: #212121;

    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    &.ready {
      opacity: 1;
    }
  }
`;function ga(e){var t;const a=s.React.useRef(null),i=s.React.useRef(null),o=s.React.useRef(null),[r,l]=s.React.useState(!1),[n,d]=s.React.useState(null),c=s.hooks.useTranslation(f.defaultMessages),p=s.hooks.useCancelablePromiseMaker(),[u,h]=s.React.useState(!1),g=s.hooks.useArcgisArcadeEditor(),m=c("setDataExpression"),S=c("apply"),v=c("cancel"),D=e.mainDataSource.getDataSourceJson(),[b,y]=s.React.useState(!1),[w,x]=s.React.useState(!1),[I,j]=s.React.useState(!1),[M,C]=s.React.useState(null!==(t=D.arcadeScript)&&void 0!==t?t:""),N=s.React.useRef(null),T=s.React.useCallback(e=>{e&&(e.componentOnReady().then(()=>{h(!0)}).catch(e=>{console.error("ArcgisArcadeEditor componentOnReady error",e)}),a.current=e,a.current.profile=Ne.arcadeDataSourceProfile,a.current.testData={profileVariableInstances:{}})},[]),O=()=>{var e,t;const i=N.current;s.DataSourceManager.getInstance().destroyDataSource(D.id);const o=(null===(e=i.arcadeResult)||void 0===e?void 0:e.geometryType)||(null===(t=i.layer)||void 0===t?void 0:t.geometryType);let r;o&&(r=s.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(o));const l=D.merge({geometryType:r,label:D.label,sourceLabel:D.label,arcadeScript:a.current.script}).without("url","portalUrl","itemId");(0,Te.getAppConfigAction)().editDataSource(l).exec(),s.DataSourceManager.getInstance().createDataSourceAndItsDataViewsByUseDataSource({dataSourceId:D.id,mainDataSourceId:D.id}),a.current.script=""},V=()=>{b?x(!0):e.toggle()},A=()=>{j(!1)};return(0,q.jsxs)(f.Modal,{isOpen:e.isOpen,centered:!0,style:{maxWidth:1024},returnfocusafterclose:"true",contentClassName:"arcade-editor-container",backdrop:"static",keyboard:!1,"aria-label":m,children:[(0,q.jsx)(f.ModalHeader,{className:"d-flex justify-content-between align-items-center header",toggle:V,children:(0,q.jsx)("div",{className:"flex-grow-1 text-truncate",children:(0,q.jsx)("div",{className:"flex-grow-1 text-truncate",title:m,children:m})})}),(0,q.jsxs)(f.ModalBody,{className:"w-auto",children:[(0,q.jsxs)("div",{css:s.css`${ha};height: 600px; display: flex;`,children:[g&&(0,q.jsx)("arcgis-arcade-editor",{ref:T,script:M,onarcgisScriptChange:e=>{const t=e.detail||"";d(null),C(t),y(!0)},editorOptions:{theme:"vs-dark"},className:(0,s.classNames)("align-items-stretch w-100",{ready:u}),onKeyDown:e=>{r||"Esc"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),b&&u?i.current.focus():o.current.focus())}}),r&&(0,q.jsx)(f.Loading,{}),!u&&(0,q.jsx)(f.Loading,{type:f.LoadingType.Secondary})]}),w&&(0,q.jsx)(f.ConfirmDialog,{level:"warning",title:c("closeArcadeEditorWarning"),hasNotShowAgainOption:!1,content:c("loseUnsavedScript"),onConfirm:e.toggle,onClose:()=>{x(!1)}}),I&&(0,q.jsx)(ca,{dataSourceId:e.mainDataSource.id,isOpen:!0,onCancel:A,toggle:A,afterRemove:O})]}),(0,q.jsxs)(f.ModalFooter,{className:"d-flex justify-content-start pb-30",children:[n&&(0,q.jsxs)("div",{css:ua,children:[(0,q.jsx)("div",{className:"error-icon",children:(0,q.jsx)(Le,{size:"sm",color:"var(--sys-color-error)"})}),(0,q.jsx)("div",{role:"alert","aria-live":"assertive",className:"ml-2 error-msg",children:n})]}),(0,q.jsx)(f.Button,{ref:i,className:"mr-2 ml-auto",type:"primary",onClick:()=>pa(this,void 0,void 0,function*(){var t;try{l(!0);const i=yield p((0,Ne.execArcadeDataSourceScript)(a.current.script));if(i.layer||"function"==typeof i.arcadeResult.schema){if(d(null),N.current=i,"function"==typeof i.arcadeResult.schema){const a=i.arcadeResult.schema(),o=a.fields.map(e=>s.dataSourceUtils.convertFieldToJimuField(e,null)).filter(e=>null!=e),r={};o.forEach(e=>{r[e.jimuName]=e});const l=e.mainDataSource.getGeometryType(),n=null!==(t=e.mainDataSource.getSchema().fields)&&void 0!==t?t:{};a.geometryType!==l||Object.keys(r).length!==Object.keys(n).length||!Object.keys(r).every(e=>{const t=n[e];if(!t)return!1;const s=r[e];return s.name===t.name&&s.type===t.type})?j(!0):O()}}else d(c("unsupportedReturnType"))}catch(e){d(c("invalidArcadeScript")),console.error(e)}finally{l(!1)}}),title:S,"aria-label":S,disabled:!b||!u||r,children:S}),(0,q.jsx)(f.Button,{ref:o,type:"default",onClick:V,title:v,"aria-label":v,disabled:r,children:v})]})]})}(0,m.registerStyles)("jimu-ui/advanced/data-source-selector/",e)})(),p})())}}});