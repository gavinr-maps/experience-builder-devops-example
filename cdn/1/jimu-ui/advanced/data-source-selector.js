System.register(["jimu-arcgis","jimu-core","jimu-layouts/layout-runtime","jimu-theme","jimu-ui","jimu-ui/basic/item-selector"],(function(e,t){var s={},a={},i={},o={},r={},l={};return{setters:[function(e){s.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes},function(e){a.CONSTANTS=e.CONSTANTS,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.LayoutItemType=e.LayoutItemType,a.MultipleDataSourceComponent=e.MultipleDataSourceComponent,a.QueryScope=e.QueryScope,a.React=e.React,a.ReactRedux=e.ReactRedux,a.ServiceManager=e.ServiceManager,a.SessionManager=e.SessionManager,a.SqlExpressionMode=e.SqlExpressionMode,a.SupportedItemTypes=e.SupportedItemTypes,a.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,a.appConfigUtils=e.appConfigUtils,a.cancelablePromise=e.cancelablePromise,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.esri=e.esri,a.getAppStore=e.getAppStore,a.injectIntl=e.injectIntl,a.jsx=e.jsx,a.lodash=e.lodash,a.moduleLoader=e.moduleLoader,a.polished=e.polished,a.requestUtils=e.requestUtils,a.urlUtils=e.urlUtils,a.uuidv1=e.uuidv1},function(e){i.searchUtils=e.searchUtils},function(e){o.registerStyles=e.registerStyles,o.withStyles=e.withStyles,o.withTheme=e.withTheme},function(e){r.AdvancedSelect=e.AdvancedSelect,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Collapse=e.Collapse,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.Icon=e.Icon,r.Label=e.Label,r.Link=e.Link,r.Loading=e.Loading,r.LoadingType=e.LoadingType,r.Modal=e.Modal,r.ModalBody=e.ModalBody,r.ModalFooter=e.ModalFooter,r.ModalHeader=e.ModalHeader,r.MultiSelect=e.MultiSelect,r.Nav=e.Nav,r.NavItem=e.NavItem,r.NavLink=e.NavLink,r.NumericInput=e.NumericInput,r.PanelHeader=e.PanelHeader,r.SVG=e.SVG,r.Select=e.Select,r.Switch=e.Switch,r.Tab=e.Tab,r.Tabs=e.Tabs,r.TextInput=e.TextInput,r.Toast=e.Toast,r.ToastType=e.ToastType,r.defaultMessages=e.defaultMessages},function(e){l.DataBadge=e.DataBadge,l.ItemSelector=e.ItemSelector,l.ItemTypes=e.ItemTypes}],execute:function(){e((()=>{var e={63980:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.629 9.143 16 10.286 8 16l-8-5.714 1.371-1.143L8 13.714l6.629-4.571ZM8 0l8 5.714-8 5.715-8-5.715L8 0Z" fill="#000"></path></svg>'},50687:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.667 4.667 11.333 0 16 4.667l-4.667 4.666-4.666-4.666ZM0 1.333V8h6.667V1.333H0ZM6.667 16H0V9.333h6.667V16ZM8 16V9.333h6.667V16H8Z" fill="#000"></path></svg>'},28455:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1C4.15 1 1 4.15 1 8s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7Zm1.167 11.667H6.834v-2.334h2.333v2.334Zm-2.333-4.5V3.333h2.333v4.834H6.834Z" fill="#000"></path></svg>'},73982:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.5 1.5a.5.5 0 0 1 1 0v2.8a.5.5 0 0 1-1 0V1.5Zm6.028.874a.5.5 0 0 1 .062.705l-1.414 1.685a.5.5 0 1 1-.766-.643l1.414-1.685a.5.5 0 0 1 .704-.062Zm-10.352.062a.5.5 0 1 0-.766.643l1.414 1.685a.5.5 0 0 0 .766-.643L3.176 2.436ZM6.244 10.6H5.43h.814ZM.961 9.8h4.88c.211 0 .359.19.359.4a1.8 1.8 0 0 0 3.555.4h.814a2.6 2.6 0 0 1-5.139 0H.8v3.6h14.4v-3.6H9.755c.03-.129.045-.263.045-.4 0-.21.148-.4.358-.4h4.881l-2.267-3.4H3.228L.961 9.8Zm11.81-4.2a.8.8 0 0 1 .666.356l2.429 3.642a.8.8 0 0 1 .134.444V14.2a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1-.8-.8v-4.158a.8.8 0 0 1 .134-.444l2.429-3.642a.8.8 0 0 1 .665-.356h9.544Z" fill="#000"></path></svg>'},79775:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.618 8.618 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.617 8.617 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746Zm1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.66 8.66 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644L4.852 5.598Zm6.296 4.805C12.275 9.912 13.218 9.118 14 8c-1.422-2.033-3.382-3-6-3-.726 0-1.402.074-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456l1.046 1.047ZM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8Zm.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987Z" fill="#000"></path></svg>'},95369:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Z" fill="#000"></path></svg>'},41553:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" fill="#000"></path></svg>'},15467:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4Zm0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3Zm0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Zm0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" fill="#000"></path></svg>'},2534:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C1 1.567 4.134 0 8 0s7 1.567 7 3.5ZM2 5.304V6.5C2 7.692 4.615 9 8 9s6-1.308 6-2.5V5.304C12.775 6.32 10.546 7 8 7s-4.775-.68-6-1.696ZM8 10c2.546 0 4.775-.68 6-1.696V9.5c0 1.192-2.615 2.5-6 2.5s-6-1.308-6-2.5V8.304C3.225 9.32 5.454 10 8 10Zm6 1.304C12.775 12.32 10.546 13 8 13s-4.775-.68-6-1.696V12.5C2 13.692 4.615 15 8 15s6-1.308 6-2.5v-1.196ZM14 3.5C14 4.692 11.385 6 8 6S2 4.692 2 3.5 4.615 1 8 1s6 1.308 6 2.5Z" fill="#000"></path></svg>'},129:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 2h14v12H1V2Zm13 1H2v4h12V3Zm0 5h-3v2h3V8Zm0 3h-3v2h3v-2Zm-4 2v-2H6v2h4Zm-5 0v-2H2v2h3Zm-3-3h3V8H2v2Zm8-2v2H6V8h4Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},50970:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5ZM5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Zm0 1v9h9V5H5Z" fill="#000"></path></svg>'},59216:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" fill="#000"></path><path d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5Z" fill="#000"></path></svg>'},38450:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 1a2 2 0 0 1 2 2v6.5a.5.5 0 0 1-1 0V3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h6.5a.5.5 0 0 1 0 1H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h10Zm-1.849 10.151a.517.517 0 0 1 .73 0l2.923 2.923a.517.517 0 0 1-.73.73l-2.923-2.922a.517.517 0 0 1 0-.73ZM8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm0-1a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" fill="#000"></path></svg>'},25124:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m8 0 8 6-8 6-8-6 8-6ZM1.887 6 8 10.82 14.113 6 8 1.18 1.887 6ZM0 9.81.563 9 8 14.775 15.437 9l.563.81L8 16 0 9.81Z" fill="#000"></path></svg>'},68103:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 1.5a1.5 1.5 0 0 1-2.147 1.354l-11 11a1.5 1.5 0 1 1-.707-.707l11-11A1.5 1.5 0 1 1 16 1.5Z" fill="#000"></path></svg>'},3185:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18 0 3.307Zm1 10.286V3.974l4-1.48v9.619l-4 1.48Zm5-1.65 4 1.711V4.057L6 2.346v9.597Zm5 1.563V3.887l4-1.48v9.619l-4 1.48Z" fill="#000"></path></svg>'},19487:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm-2 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM15 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" fill="#000"></path></svg>'},46992:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.915 1A1.5 1.5 0 1 0 1 2.915v10.17A1.5 1.5 0 1 0 2.915 15h10.17a1.5 1.5 0 1 0 1.276-1.994l-2.272-3.975c.255-.269.411-.632.411-1.031 0-.4-.156-.762-.41-1.031l2.27-3.975A1.5 1.5 0 1 0 13.086 1H2.915Zm0 13h10.17c.05-.14.12-.271.207-.389l-2.204-4.114a1.5 1.5 0 1 1 0-2.995l2.204-4.113A1.496 1.496 0 0 1 13.085 2H2.915c-.151.426-.489.764-.915.915v10.17c.426.151.764.489.915.915Z" fill="#000"></path></svg>'},69013:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8Zm-2.07 1.303A7.014 7.014 0 0 0 2.256 4h1.6a8.278 8.278 0 0 1 2.103-2.697ZM3.453 5H1.674a6.958 6.958 0 0 0-.656 2.5H3.01c.04-.89.187-1.725.441-2.5Zm.56 2.5a8.13 8.13 0 0 1 .5-2.5H7.5v2.5H4.012Zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.329 9.329 0 0 1-.441-2.5ZM4.512 11a8.131 8.131 0 0 1-.5-2.5H7.5V11H4.512Zm-.657 1h-1.6a7.014 7.014 0 0 0 3.702 2.697A8.279 8.279 0 0 1 3.855 12ZM7.5 14.61V12H4.985c.58 1.011 1.417 1.88 2.515 2.61ZM7.5 4V1.39C6.402 2.12 5.565 2.99 4.985 4H7.5Zm2.543 10.697A7.014 7.014 0 0 0 13.745 12h-1.6a8.28 8.28 0 0 1-2.102 2.697ZM12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.33 9.33 0 0 1-.441 2.5Zm-.56-2.5a8.132 8.132 0 0 1-.5 2.5H8.5V8.5h3.488Zm1.001-1h1.993a6.958 6.958 0 0 0-.656-2.5h-1.778c.254.775.401 1.61.441 2.5ZM11.487 5c.29.764.457 1.597.5 2.5H8.5V5h2.988Zm.658-1h1.6a7.014 7.014 0 0 0-3.703-2.697c.91.78 1.612 1.68 2.103 2.697ZM8.5 1.39c1.098.73 1.935 1.6 2.515 2.61H8.5V1.39ZM8.5 12h2.515c-.58 1.011-1.417 1.88-2.515 2.61V12Z" fill="#000"></path></svg>'},38309:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m14 11-2-9H4l-2 9 .36.087c2.18.507 3.893.547 5.14.121V13H4v1h8v-1H8.5v-2.208c1.315-.45 3.148-.38 5.5.208ZM4.802 3h6.395l1.489 6.701-.227-.037c-2.03-.316-3.662-.18-4.906.442l-.159.073c-.926.394-2.309.433-4.14.077l-.062-.013L4.802 3ZM8 4H7v3H5v1h2v1h1V6h3V5H8V4Z" fill="#000"></path></svg>'},62491:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 2v12H2V2h12Zm-1 1H3v10h10V3Zm-5 7.5L6 9l-2 1.5L6 12l2-1.5Zm2-3.833 2 1.5-2 1.5-2-1.5 2-1.5ZM8 5.5 6 4 4 5.5 6 7l2-1.5Z" fill="#000"></path></svg>'},48302:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m12 2 2 9c-2.352-.588-4.185-.657-5.5-.208V13H12v1H4v-1h3.5v-1.792c-1.247.426-2.96.386-5.14-.121L2 11l2-9h8Zm-1.63 1H5.005c.084.58.207 1.325.61 1.991.294.486.75.95 1.503 1.253.257-.828.9-1.543 1.56-2.098C9.22 3.69 9.823 3.302 10.37 3Zm.966.625 1.144 5.15a5.006 5.006 0 0 0-.988-.9c-.868-.614-2.063-1.143-3.408-1.368.177-.53.62-1.077 1.238-1.596a10.146 10.146 0 0 1 2.014-1.286ZM4.76 5.51a4.578 4.578 0 0 1-.354-.727l-1.214 5.461.062.013c1.831.356 3.214.317 4.14-.077l.159-.073c1.113-.557 2.538-.724 4.28-.527a1.968 1.968 0 0 0-.077-.108 3.855 3.855 0 0 0-.842-.78c-.746-.528-1.8-.998-2.996-1.198C6.276 7.22 5.315 6.427 4.76 5.51Z" fill="#000"></path></svg>'},61402:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 3H3v10h5V3ZM3 2H2v12h7V2H3Zm1.833 2.833h2.75v.917h-2.75v-.917Zm2.75 1.833h-2.75v.917h2.75v-.917Zm2.75 2.75h1.833v.917h-1.833v-.916Zm1.833 1.834h-1.833v.917h1.833v-.917ZM4.833 8.5h2.75v.917h-2.75V8.5ZM14 7.583H9.416V8.5h3.667v4.583H9.416V14H14V7.583Z" fill="#000"></path></svg>'},88310:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="m14 11-2-9H4l-2 9 .36.087c2.18.507 3.893.547 5.14.121V13H4v1h8v-1H8.5v-2.208c1.315-.45 3.148-.38 5.5.208ZM4.802 3h6.395l1.489 6.701-.227-.037c-2.03-.316-3.662-.18-4.906.442l-.159.073c-.926.394-2.309.433-4.14.077l-.062-.013L4.802 3ZM6 5.78V8h2V5.28l-2 .5ZM8 9h3V6H9V4l-1 .25L5 5v4h3Zm1-1h1V7H9v1Z" fill="#000"></path></svg>'},88866:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" fill="#000"></path></svg>'},41385:e=>{e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 1 1 0 12A6 6 0 0 1 6 0Zm0 1a5 5 0 1 0 0 10A5 5 0 0 0 6 1Zm.5 1v3.5H10v1H6.5V10h-1V6.5H2v-1h3.5V2h1Z" fill="#000" fill-rule="nonzero"></path></svg>'},38589:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m8 0 8 6-8 6-8-6 8-6ZM1.887 6 8 10.82 14.113 6 8 1.18 1.887 6ZM.563 9 8 14.775 15.437 9l.563.81L8 16 0 9.81.563 9Z" fill="#000" fill-rule="nonzero"></path></svg>'},46771:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m6 11.943 4 1.711V4.057L6 2.346v9.597Zm-1 .17V2.494l-4 1.48v9.619l4-1.48Zm6 1.393 4-1.48V2.407l-4 1.48v9.619ZM0 15V3.307L5.75 1.18l4.528 1.937L16 1v11.693l-5.75 2.127-4.528-1.937L0 15Z" fill="#000" fill-rule="nonzero"></path></svg>'},91915:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 4V1.39C6.402 2.12 5.565 2.99 4.985 4H7.5Zm0 3.5V5H4.512a8.13 8.13 0 0 0-.5 2.5H7.5Zm0 3.5V8.5H4.012a8.13 8.13 0 0 0 .5 2.5H7.5Zm0 3.61V12H4.985c.58 1.01 1.417 1.88 2.515 2.61Zm2.543.087A7.014 7.014 0 0 0 13.745 12h-1.6a8.278 8.278 0 0 1-2.102 2.697ZM11.015 12H8.5v2.61c1.098-.73 1.935-1.6 2.515-2.61Zm1.974-3.5a9.328 9.328 0 0 1-.441 2.5h1.778c.365-.767.594-1.61.656-2.5H12.99Zm-1.001 0H8.5V11h2.988a8.13 8.13 0 0 0 .5-2.5Zm.56-3.5c.254.775.401 1.609.441 2.5h1.993a6.957 6.957 0 0 0-.656-2.5h-1.778Zm-1.06 0H8.5v2.5h3.488a8.13 8.13 0 0 0-.5-2.5Zm-1.445-3.697c.91.78 1.611 1.68 2.102 2.697h1.6a7.014 7.014 0 0 0-3.702-2.697ZM8.5 4h2.515c-.58-1.01-1.417-1.88-2.515-2.61V4Zm-.527 12a8 8 0 1 1 .055-16 8 8 0 0 1-.055 16ZM5.957 1.302A7.014 7.014 0 0 0 2.255 4h1.6a8.278 8.278 0 0 1 2.102-2.697ZM3.011 7.5c.04-.891.187-1.725.441-2.5H1.674a6.957 6.957 0 0 0-.656 2.5H3.01Zm.441 3.5a9.328 9.328 0 0 1-.441-2.5H1.018c.062.89.291 1.733.656 2.5h1.778Zm2.505 3.697A8.278 8.278 0 0 1 3.855 12h-1.6a7.014 7.014 0 0 0 3.702 2.697Z" fill="#000" fill-rule="nonzero"></path></svg>'},84543:e=>{e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 0a.5.5 0 0 1 .5.5V1h2a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h2V.5a.5.5 0 0 1 1 0V1h4V.5a.5.5 0 0 1 .5-.5ZM11 5H1v6h10V5ZM8.5 8.5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h5Zm0-2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h5ZM3 2H1v2h10V2H9v.5a.5.5 0 0 1-1 0V2H4v.5a.5.5 0 0 1-1 0V2Z" fill="#000" fill-rule="nonzero"></path></svg>'},52274:e=>{e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 1 1 0 12A6 6 0 0 1 6 0Zm0 1a5 5 0 1 0 0 10A5 5 0 0 0 6 1Zm4 4.5v1H2v-1h8Z" fill="#000" fill-rule="nonzero"></path></svg>'},71997:e=>{e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M1.6 4.23.553 5.238 0 4.558l1.687-1.46h.86v5.804H1.6V4.23Zm2.035 3.63 2.168-2.18L6 5.471c.068-.073.13-.151.185-.233.055-.082.101-.168.138-.258a.741.741 0 0 0 .055-.283.729.729 0 0 0-.244-.558.786.786 0 0 0-.256-.151.9.9 0 0 0-.312-.054.822.822 0 0 0-.583.214.918.918 0 0 0-.276.573l-.993-.082c.02-.267.082-.504.185-.709.102-.205.235-.375.398-.512.163-.137.352-.24.568-.311A2.23 2.23 0 0 1 5.566 3c.253 0 .488.034.706.102.218.069.409.17.572.304.163.134.291.304.386.512.095.208.142.45.142.73 0 .366-.08.681-.24.946-.16.265-.367.518-.62.758L4.786 8.016h2.586v.886H3.635V7.86Zm5.952-2.426h.245c.136 0 .27-.008.398-.024a.999.999 0 0 0 .347-.107.64.64 0 0 0 .248-.237.8.8 0 0 0 .095-.418.73.73 0 0 0-.22-.55.794.794 0 0 0-.576-.213.828.828 0 0 0-.509.168.948.948 0 0 0-.327.472l-1.002-.28c.064-.212.153-.398.269-.556.115-.159.252-.289.41-.39.157-.1.33-.176.52-.225.19-.05.386-.074.591-.074.242 0 .47.033.686.098.216.066.405.163.568.291a1.412 1.412 0 0 1 .536 1.16c0 .312-.084.589-.252.832a1.177 1.177 0 0 1-.702.48v.016c.357.055.628.213.812.475.184.263.276.574.276.935 0 .279-.051.524-.154.738-.102.213-.24.392-.414.536a1.786 1.786 0 0 1-.603.328 2.31 2.31 0 0 1-.713.111c-.232 0-.45-.026-.655-.078a1.805 1.805 0 0 1-.556-.242 1.602 1.602 0 0 1-.43-.422A1.91 1.91 0 0 1 8.2 7.64l1.009-.278c.058.24.16.426.307.557.148.131.347.197.6.197a.986.986 0 0 0 .658-.25.855.855 0 0 0 .205-.287.906.906 0 0 0 .075-.373.822.822 0 0 0-.114-.455.781.781 0 0 0-.292-.27 1.225 1.225 0 0 0-.398-.128 2.95 2.95 0 0 0-.434-.032h-.229v-.886Z" fill="#000" fill-rule="nonzero"></path></svg>'},12545:e=>{e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M1.804 3.145h.638l1.786 5.71h-.843L3 7.548H1.2L.826 8.855H0l1.804-5.71Zm.937 3.532-.639-2.322-.65 2.322h1.289Zm1.95-3.532h1.616c.157 0 .31.026.463.077.152.05.288.134.407.25.12.115.216.265.29.447.074.183.111.404.111.662 0 .322-.066.588-.199.798-.133.21-.306.36-.521.452v.016a.871.871 0 0 1 .36.149c.111.078.206.177.284.298.078.121.14.261.185.42.045.158.067.329.067.512 0 .312-.045.571-.135.778-.09.207-.208.374-.354.5a1.308 1.308 0 0 1-.504.27c-.189.054-.381.08-.577.08H4.691V3.146Zm.738 2.323h.673c.246 0 .43-.066.554-.198a.731.731 0 0 0 .184-.52c0-.247-.063-.431-.19-.552-.127-.121-.33-.182-.612-.182H5.43v1.452Zm0 2.516h.68c.093 0 .194-.008.301-.024a.675.675 0 0 0 .518-.367.96.96 0 0 0 .088-.448c0-.3-.071-.51-.214-.629-.142-.118-.364-.177-.664-.177h-.709v1.645Zm5.903-3.5c-.152-.226-.3-.376-.442-.452a.914.914 0 0 0-.43-.113c-.215 0-.41.053-.583.158-.174.104-.323.25-.448.435a2.203 2.203 0 0 0-.29.65 2.988 2.988 0 0 0-.102.798c0 .306.034.588.102.846.068.259.165.482.29.67.125.188.274.336.448.443.174.108.368.162.583.162.168 0 .33-.055.489-.166.158-.11.305-.286.442-.528l.609.597c-.187.355-.416.613-.685.774-.27.161-.557.242-.861.242-.32 0-.614-.071-.882-.214a2.064 2.064 0 0 1-.69-.605 3.012 3.012 0 0 1-.454-.94 4.241 4.241 0 0 1-.164-1.217c0-.457.054-.872.164-1.246.109-.373.26-.692.453-.955.194-.264.424-.467.691-.61.268-.142.562-.213.882-.213.281 0 .542.069.782.206.24.137.463.37.67.697l-.574.58Z" fill="#000" fill-rule="nonzero"></path></svg>'},38421:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m6.262 6.972-.893-.893a.5.5 0 0 1 0-.707l.003-.003a.5.5 0 0 1 .707 0l.893.893.709-.709a1.003 1.003 0 0 0 0-1.419L4.844 1.297a1.003 1.003 0 0 0-1.419 0L1.297 3.425a1.003 1.003 0 0 0 0 1.419L4.134 7.68a1.003 1.003 0 0 0 1.419 0l.71-.71Zm1.419 0 1.347 1.347.71-.71a2.006 2.006 0 0 1 2.837 0l2.837 2.838a2.006 2.006 0 0 1 0 2.837l-2.128 2.128a2.006 2.006 0 0 1-2.837 0L7.61 12.575a2.006 2.006 0 0 1 0-2.837l.709-.71-1.347-1.347-.71.71a2.006 2.006 0 0 1-2.837 0L.588 5.552a2.006 2.006 0 0 1 0-2.837L2.716.588a2.006 2.006 0 0 1 2.837 0L8.39 3.425a2.006 2.006 0 0 1 0 2.837l-.709.71Zm2.057 2.056.599.6a.5.5 0 0 1 0 .707l-.002.002a.5.5 0 0 1-.707 0l-.6-.6-.709.71a1.003 1.003 0 0 0 0 1.419l2.837 2.837a1.003 1.003 0 0 0 1.419 0l2.128-2.128a1.003 1.003 0 0 0 0-1.419L11.866 8.32a1.003 1.003 0 0 0-1.419 0l-.71.71Z" fill="#000" fill-rule="nonzero"></path></svg>'},26826:e=>{"use strict";e.exports=s},48891:e=>{"use strict";e.exports=a},74758:e=>{"use strict";e.exports=i},34796:e=>{"use strict";e.exports=o},30726:e=>{"use strict";e.exports=r},20878:e=>{"use strict";e.exports=l}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{"use strict";n.r(d),n.d(d,{AllDataSourceTypes:()=>f,DEFAULT_DATA_VIEW_ID:()=>v,DataSourceErrorItem:()=>Jt,DataSourceItem:()=>Ht,DataSourceList:()=>Qe,DataSourceRemoveWaringReason:()=>Xe,DataSourceRemoveWarningPopup:()=>tt,DataSourceSelector:()=>Ct,DataSourceTree:()=>ee,DataViewPriority:()=>Gt,DataViewSettingPopup:()=>ft,ExternalDataSourceSelector:()=>xe,FieldSelector:()=>ss,MainDataAndViewSelector:()=>Yt,_DataSourceSelector:()=>Mt,dataComponentsUtils:()=>t});var e={};n.r(e),n.d(e,{DataSourceErrorItem:()=>c,DataSourceItem:()=>l,DataSourceList:()=>i,DataSourceRemoveWarningPopup:()=>m,DataSourceSelector:()=>a,DataSourceTree:()=>o,DataViewSettingPopup:()=>h,ExternalDataSourceSelector:()=>r,FieldSelector:()=>p,MainDataAndViewSelector:()=>u});var t={};n.r(t),n.d(t,{editDataSourceJson:()=>$,getAppConfig:()=>L,getDescendantDssAndViews:()=>j,getDsIcon:()=>R,getDsJsonFromItem:()=>H,getDsTypeString:()=>A,getIconFromFieldType:()=>I,getOriginalDataUrl:()=>F,getOutputDssFromOriginDs:()=>E,getWhetherDataSourceIsInited:()=>U,getWhetherIsTable:()=>k,getWidgetsUsingDsOrItsDescendantDss:()=>C,getWidgetsUsingDsOrItsViews:()=>N,getWidgetsUsingOutputDsFromOneWidget:()=>B,isFuzzyFromDsIds:()=>V,isFuzzySearch:()=>O});var s=n(48891);function a(e){const t=e.theme;return s.css`
    .component-data-source-selector{
      .font-dark-600{
        color: ${t.colors.palette.dark[600]};
      }
      .font-weight-500{
        font-weight: 500;
      }
      .data-view-dropdown-menu-button{
        background: ${t.colors.palette.secondary[200]};
        text-align: left;
      }
      .dv-select-container{
        margin-top: ${s.polished.rem(12)};
        .jimu-dropdown-button{
          .settings-icon{
            display: none;
          }
        }
      }
      .create-view-button{
        position: relative;
        margin-top: 2px;
        padding-top: 8px;
        .create-view-button-border{
          width: 90%;
          border-top: 1px solid ${t.colors.palette.light[800]};
          position: absolute;
          top: 0;
          left: 50%;
          transform: translate(-50%, 0);
        }
      }
      .ds-selector-button{
        height: ${s.polished.rem(40)};
        line-height: ${s.polished.rem(40)};
        padding: 0;
        border: 1px dashed ${t.colors.palette.dark[100]};
        border-radius: ${s.polished.rem(2)};
        cursor: pointer;
        color: ${t.colors.palette.primary[700]};
        font-size: ${s.polished.rem(14)};
        text-decoration: none;
        &:hover{
          border-color: ${t.colors.palette.dark[400]};
          color: ${t.colors.palette.primary[800]};
        }
      }
      .ds-item.ds-error-item{
        background-color: ${t.colors.palette.secondary[400]};
        *{
          color: ${t.colors.palette.dark[400]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.secondary[800]};
        }
      }
      .ds-item{
        &:not(:first-of-type) {
          margin-top: ${s.polished.rem(8)};
        }

        padding: ${s.polished.rem(8)} ${s.polished.rem(10)} ${s.polished.rem(10)} ${s.polished.rem(10)};
        background-color: ${t.colors.palette.secondary[500]};
        cursor: pointer;

        &:hover{
          background-color: ${t.colors.palette.light[600]};
        }

        .mr-30{
          margin-right: ${s.polished.rem(30)};
        }

        &.disable-cursor{
          cursor: default;
        }

        .ds-item-close{
          height: 100%;
          cursor: pointer;
          margin-left: ${s.polished.rem(5)};
          margin-right: -5px;
        }

        .ds-item-filter{
          height: 100%;
          cursor: pointer;
        }

        .ds-item-sort{
          height: 100%;
          cursor: pointer;
          margin-left: ${s.polished.rem(5)};
        }

        .ds-thumbnail{
          width:  ${s.polished.rem(18)};
          height:  ${s.polished.rem(18)};
          background-color: ${t.colors.palette.info[400]};
        }
        .ds-type{
          font-size: ${s.polished.rem(14)};
          color: ${t.colors.palette.dark[800]};
        }
        .top-right-red-dot-container{
          position: relative;
        }
        .top-right-red-dot{
          position: absolute;
          top: 0;
          right: 0;
          display: inline-block;
          width: 8px;
          height: 8px;
          border-radius: 4px;
          background-color: ${t.colors.palette.danger[700]};
        }
      }
    }

  `}function i(e){const t=e.theme;return s.css`
    .component-data-source-list{
      font-size: ${t.typography.fontSizeBase};
      overflow: hidden;

      .data-tabs .tab-content .tab-pane {
        padding-top: 16px;
      }

      .search{
        position: relative;
      }
      .search-input{
        height: 26px;
        border-radius: 2px;
      }
      .search-icon{
        color: ${t.colors.palette.dark[600]};
      }

      .empty-placeholder{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        .empty-placeholder-text, .empty-placeholder-icon{
          display: table;
          margin: 0 auto;
        }
        .empty-placeholder-text{
          color: ${t.colors.palette.dark[400]};
          font-size: ${s.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon{
          color: ${t.colors.palette.secondary[800]};
        }
      }

      .jimu-tab{
        height: 100%;
        .tab-content{
          height: calc(100% - 40px);
        }
        .tab-pane{
          width: 100%;
        }
        .jimu-nav.nav-pills{
            margin: 0 ${s.polished.rem(16)} !important;
          }
      }

      .ds-list-container{
        height: calc(100% - 120px);
      }

      .ds-list{
        height: calc(100% - 20px);
        overflow: auto;
      }

      .ds-list-header{
        width: 100%;
      }

      .ds-add-data{
        position: absolute;
        bottom: 0;
        height: ${s.polished.rem(40)};
        width: 100%;
        color: ${t.colors.palette.primary[700]};
        font-size: ${s.polished.rem(14)};
        border-top: 1px solid ${t.colors.palette.secondary[800]};
        cursor: pointer;
        &:hover{
          .add-data-icon-container{
            background-color: ${t.colors.palette.primary[800]};
          }
          color: ${t.colors.palette.primary[800]};
        }
        .add-data-icon-container{
          width: ${s.polished.rem(20)};
          height: ${s.polished.rem(20)};
          background-color: ${t.colors.palette.primary[700]};
          border-radius: ${s.polished.rem(10)};
        }
        .add-data-icon{
          color: ${t.colors.palette.light[300]};
        }
      }

      .ds-list-close{
        width: ${s.polished.rem(30)};
        height: 100%;
        cursor: pointer;
      }

      .ds-widget-back{
        width: ${s.polished.rem(80)};
        height: ${s.polished.rem(30)};
        cursor: pointer;
      }

      .ds-types{
        color: ${t.colors.black};
        font-size: ${t.typography.fontSizeBase};
      }

      .ds-widget-outputs{
        padding: 0;
      }

      .ds-added-data{
        padding: 0;
      }

      .to-use-types{
        color: ${t.colors.black};
        .types-selected{
          max-width: ${s.polished.rem(150)};
        }
        .to-use-dp{
          width: ${s.polished.rem(120)};
          height: ${s.polished.rem(26)};
        }
      }

      .ds-thumbnail{
        width:  ${s.polished.rem(26)};
        height:  ${s.polished.rem(26)};
        background-color: ${t.colors.palette.info[400]};
      }
      .ds-type{
        font-size: ${s.polished.rem(14)};
        color: ${t.colors.palette.dark[800]};
      }
      .ds-item.ds-error-item{
        background-color: ${t.colors.palette.secondary[400]};
        *{
          color: ${t.colors.palette.dark[400]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.secondary[800]};
        }
      }
      .ds-item{
        border: 1px solid transparent;
        border-radius: 0;
        position: relative;
        left: -2px;
        cursor: pointer;
        .item{
          height: ${s.polished.rem(26)};
          background-color: ${t.colors.palette.secondary[500]};
          padding-left: 0;
          padding-right: ${s.polished.rem(10)};
        }
        .item-active-icon{
          position: absolute;
          top: -1px;
          right: -1px;
          .item-active-icon-container{
            width: 0;
            height: 0;
            border-top: ${s.polished.rem(12)} ${t.colors.palette.primary[700]} solid;
            border-left: ${s.polished.rem(12)} transparent solid;
            background-color: transparent;
          }
        }
      }
      .ds-item.ds-item-selected{
        border: 1px solid ${t.colors.palette.primary[700]};
      }
    }

  `}function o(e){const t=e.theme;return s.css`
    *{
      margin: 0;
      padding: 0;
    }
    .bg{
      padding: ${s.polished.rem(16)} ${s.polished.rem(2)};
      background-color: ${t.colors.palette.light[200]};
      border-top: 2px solid ${t.colors.palette.primary[600]};
    }
    .tree-root{
      padding-left: ${s.polished.rem(20)};
      padding-right: ${s.polished.rem(5)};
    }
    .component-data-source-tree{
      position: relative;
      .collapse-button{
        position: absolute;
        left: 2px;
        z-index: 1;
      }
      .collapse-content{
        padding-left: ${s.polished.rem(20)};
        padding-top: ${s.polished.rem(16)};
        position: relative;
      }
      .collapse-button:not(.root):not(.leaf){
        left: ${s.polished.rem(-18)};
      }
      .collapse-button.leaf{
        left: 2px;
      }
      .z-index-1 {
        z-index: 1;
      }
      .collapse-button:not(.root):before{
        content: '';
        position: absolute;
        top: 50%;
        left: -2px;
        border-top: 1px solid ${t.colors.palette.dark[400]};
        width: ${s.polished.rem(21)};
        transform: translateY(-50%);
      }
      .collapse-line{
        border-left: 1px solid ${t.colors.palette.dark[400]};
        border-bottom: 1px solid ${t.colors.palette.dark[400]};
        width: ${s.polished.rem(22)};
        position: absolute;
        top: -1px;
        left: 0;
        z-index: 0;
      }
      .collapse-line:not(.root){
        width: ${s.polished.rem(20)};
        top: -2px;
      }
    }

  `}function r(e){const t=e.theme;return s.css`
    .component-external-data-source-selector{
      height: 100%;
      overflow: hidden;
      position: relative;

      .selected-ds-loading {
        margin-left: ${s.polished.rem(-25)};
      }

      .added-ds-item{
        position: relative;
        cursor: pointer;
        margin: ${s.polished.rem(16)} ${s.polished.rem(8)} ${s.polished.rem(16)} ${s.polished.rem(10)};
        .ds-thumbnail{
          width:  ${s.polished.rem(26)};
          height:  ${s.polished.rem(26)};
          background-color: ${t.colors.palette.info[400]};
        }
        .ds-type{
          font-size: ${s.polished.rem(13)};
          color: ${t.colors.dark};
        }
        .item{
          height: ${s.polished.rem(26)};
        }
      }

      .added-ds-container{
        width: ${s.polished.rem(300)};
        background-color: ${t.colors.palette.light[600]};
        box-shadow: 0 0 10px 4px ${s.polished.rgba(t.colors.white,.3)};
        position: absolute;
        right: 30px;
        bottom: 30px;
        .added-ds-items{
          max-height: ${s.polished.rem(500)};
          overflow-y: auto;
          overflow-x: hidden;
        }
        .small-done-btn{
          max-width: ${s.polished.rem(100)};
        }
      }

      .selector-left{
        @media only screen and (max-width: 1100px){
          &{
            width: ${s.polished.rem(160)};
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: ${s.polished.rem(200)};
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: ${s.polished.rem(260)};
          }
        }
        background-color: ${t.colors.palette.light[400]};
        border-right: 1px solid ${t.colors.palette.light[800]};
        .selector-left-title{
          padding: ${s.polished.rem(20)} ${s.polished.rem(20)} ${s.polished.rem(27)} ${s.polished.rem(20)};
          margin: 0;
          font-size: ${s.polished.rem(20)};
          color: ${t.colors.palette.dark[600]};
        }
        .nav.nav-underline{
          border: 0;
          .nav-item{
            .nav-link{
              padding: 0;
              border: 0;
              .jimu-nav-link-wrapper{
                display: flex;
                justify-content: flex-start;
                align-items: center;
                padding: ${s.polished.rem(7)} ${s.polished.rem(20)};
                font-size: ${s.polished.rem(16)};
                color: ${t.colors.palette.dark[600]};
              }
            }
          }

          .nav-item:hover{
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.colors.black};
              }
            }
          }

          .nav-item.active-tab{
            background-color: ${t.colors.palette.light[500]};
            border-left: 4px solid ${t.colors.palette.primary[600]};
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.colors.black};
                font-weight: 500;
                padding-left: ${s.polished.rem(16)};
              }
            }
          }
        }
      }

      .selector-right{
        @media only screen and (max-width: 1100px){
          &{
            width: calc(100% - ${s.polished.rem(160)});
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: calc(100% - ${s.polished.rem(200)});
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: calc(100% - ${s.polished.rem(260)});
          }
        }
        .selector-right-header{
          padding: ${s.polished.rem(23)} ${s.polished.rem(20)} ${s.polished.rem(12)} ${s.polished.rem(20)};
        }
        .selector-right-body{
          height: calc(100% - 70px);
          @media only screen and (max-width: 1100px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(25)};
            }
          }
          @media only screen and (min-width: 1100px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(45)};
            }
          }
          @media only screen and (min-width: 1300px){
            &{
              padding: ${s.polished.rem(10)} ${s.polished.rem(65)};
            }
          }
        }
        .external-data-source-url-input{
          .url-type-select{
            width: ${s.polished.rem(250)};
          }
          .url-input{
            width: ${s.polished.rem(500)};
          }
          .url-input-add-btn{
            height: ${s.polished.rem(30)};
          }
          .url-input-label{
            font-size: ${s.polished.rem(13)};
            color: ${t.colors.palette.dark[400]};
            margin-bottom: 12px;
            font-weight: 500;
          }
        }

      }

    }

  `}function l(e){const t=e.theme;return s.css`
    .component-data-source-item{
      background-color: ${t.colors.palette.light[500]};
      font-size: ${s.polished.rem(12)};
      border-radius: 2px;
      padding: 0;
      position: relative;
      &:hover{
        background-color: ${t.colors.palette.light[600]};
      }
      .font-dark-600{
        color: ${t.colors.palette.dark[600]} !important;
      }
      .loading-container{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }
      .ds-item-header{
        width: 100%;
        height: ${s.polished.rem(38)};
        padding: 0 10px;
        background-color: ${t.colors.palette.light[700]};
      }
      .ds-item-body{
        width: 100%;
        height: 100%;
        padding: 14px 10px 6px 10px;
      }
      .two-line-truncate{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        word-break: break-word;
        word-wrap: break-word;
      }
      .ds-more{
        margin-right: ${s.polished.rem(-8)};
      }
      .ds-label{
        font-size: ${s.polished.rem(14)};
        color: ${t.colors.palette.dark[800]};
      }
      .ds-type{
        font-size: ${s.polished.rem(13)};
        color: ${t.colors.palette.dark[800]};
        max-width: ${s.polished.rem(100)};
      }
      .ds-thumbnail{
        width:  ${s.polished.rem(18)};
        height:  ${s.polished.rem(18)};
        background-color: ${t.colors.palette.info[400]};
      }
      .ds-related-widgets, .ds-child-dss{
        font-size: ${s.polished.rem(13)};
      }
      .warning-icon, .warning-icon>*{
        color: ${t.colors.palette.danger[700]};
        fill: ${t.colors.palette.danger[700]};
      }
    }

    .component-data-source-item.component-data-source-item-selected-item{
      border: ${s.polished.rem(2)} solid ${t.colors.primary};
    }

    .cursor-pointer{
      cursor: pointer;
    }

  `}function c(e){const t=e.theme;return s.css`
    .component-data-source-error-item{
      .component-data-source-item{
        background-color: ${t.colors.palette.secondary[400]};
        *:not(.ds-badge svg, .ds-close-icon){
          color: ${t.colors.palette.dark[400]} !important;
        }

        .ds-origin-label{
          max-width: 100%;
        }
        .ds-item-header{
          background-color: ${t.colors.palette.secondary[500]};
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.light[800]};
        }
        .ds-close-icon{
          color: ${t.colors.palette.dark[600]} !important;
          width: ${s.polished.rem(14)};
          height: ${s.polished.rem(14)};
        }
      }

    }

  `}function p(e){const t=e.theme;return s.css`
    .component-field-selector{
      font-size: ${t.typography.fontSizeBase};
      .ds-name{
        color: ${t.colors.black};
      }
      .ds-name-label{
        font-size: ${s.polished.rem(14)};
        color: ${t.colors.palette.dark[400]};
        font-weight: 400;
      }
      .field-data-selected{
        width: 70%;
      }

      .item-selector-search{
        height: ${s.polished.rem(26)};
        position: relative;
      }

      .field-list{
        height: calc(100% - 160px);
        overflow-y: auto;
        .field-item.field-item-selected{
          border: 2px solid ${t.colors.palette.primary[600]};
        }
        .field-item{
          border: 1px solid transparent;
          cursor: pointer;
          background-color: ${t.colors.palette.light[400]};
          user-select: none;
          text-align: left;
          border-radius: 0;
        }
        .field-item:hover{
          background-color: ${t.colors.palette.light[500]};
        }
        .field-item:active.field-item:hover{
          background-color: ${t.colors.white};
        }
      }

      .search-input{
        height: ${s.polished.rem(26)};
        width: 100%;
      }

    }

  `}function u(e){const t=e.theme;return s.css`
    .component-main-data-and-view{
      .option-label{
        font-size: ${s.polished.rem(13)};
        font-weight: 500;
        color: ${t.colors.palette.dark[400]};
      }
      .select-max-width{
        overflow: visible;
      }
    }
  `}function h(e){const t=e.theme;return s.css`
    .data-view-container{
      width: ${s.polished.rem(960)};
      height: ${s.polished.rem(600)};
      border: 0;
    }
    .cicle-button{
      width: ${s.polished.rem(32)};
      height: ${s.polished.rem(32)};
      border-radius: ${s.polished.rem(16)};
    }
    .w-38{
      width: 38%;
    }
    .w-62{
      width: 62%;
    }
    .mr-10{
      margin-right: ${s.polished.rem(10)};
    }
    .pb-30{
      padding-bottom: ${s.polished.rem(30)};
    }
    .preview-table{
      position: relative;
      padding-left: ${s.polished.rem(30)};
    }
    .setting-table{
      padding-right: ${s.polished.rem(30)};
      border-right-width: 2px;
      border-right-style: solid;
      border-image: linear-gradient(180deg, transparent 0%, ${t.colors.palette.light[500]} 52.08%, transparent 100%) 1;
      border-left: 0;
    }
    .table-container{
      height : 100%;
      overflow-x: auto;
      .table-body{
        overflow-y: auto;
        overflow-x: hidden;
        width: fit-content;
      }
      .table-header{
        position: sticky;
        top: 0;
      }
      tr{
        border-top: 1px solid ${t.colors.palette.light[400]};
      }
      tr:last-child{
        border-bottom: 1px solid ${t.colors.palette.light[400]};
      }
      td, th{
        width: ${s.polished.rem(86)};
        height: ${s.polished.rem(32)};
        display: inline-block !important;
        border-left: 1px solid ${t.colors.palette.light[400]};
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 6px 4px;
      }
      td{
        background-color: ${t.colors.palette.light[200]};
      }
      th{
        background-color: ${t.colors.palette.light[400]};
      }
      td:last-child, th:last-child{
        border-right: 1px solid ${t.colors.palette.light[400]};
      }
    }
    .modal-body{
      height: calc(100% - ${s.polished.rem(150)});
      padding: ${s.polished.rem(30)};
      padding-bottom: ${s.polished.rem(14)};
    }
    &.modal-dialog{
      max-width: ${s.polished.rem(960)};
    }
    .modal-header{
      .close{
        display: none;
      }
      .modal-title{
        width: 100%;
        display: flex !important;
        align-items: center !important;
      }
    }

    .jimu-nav{
      margin-bottom: ${s.polished.rem(20)};
    }

    .label{
      font-size: ${s.polished.rem(13)};
      color: ${t.colors.palette.dark[400]};
    }

    .header{
      height: ${s.polished.rem(54)};
      padding-left: ${s.polished.rem(30)};
      padding-right: ${s.polished.rem(30)};
    }

    .modal-footer{
      padding-left: ${s.polished.rem(30)};
      padding-right: ${s.polished.rem(30)};
    }

    .tab-content{
      height: ${s.polished.rem(426)};
      overflow-y: auto;
    }

    .sql-exp-warning{
      color: ${t.colors.palette.danger[700]};
      font-size: ${t.sizes[3]};
      max-width: ${s.polished.rem(600)};
      .sql-exp-warning-icon{
        color: ${t.colors.palette.danger[700]};
      }
    }

  `}function m(e){const t=e.theme;return s.css`
    &.modal-dialog{
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 480px;
    }
    .modal-content{
      border: 0;
    }
    .modal-header, .modal-body{
      padding-left: 20px;
      padding-right: 20px;
    }
    .modal-footer{
      padding-top: 0;
      padding-bottom: 20px;
    }
    .font-16{
      font-size: ${s.polished.rem(16)};
    }
    .font-14{
      font-size: ${s.polished.rem(14)};
    }
    .font-13{
      font-size: ${s.polished.rem(13)};
    }
    .font-dark-800{
      color: ${t.colors.palette.dark[800]};
    }
    .font-dark-600{
      color: ${t.colors.palette.dark[600]};
    }
    .related-widgets{
      width: 100%;
      height: ${s.polished.rem(160)};
      overflow: auto;
      background-color: ${t.colors.palette.light[200]};
    }
    .related-outputs{
      width: 100%;
      max-height: ${s.polished.rem(80)};
      overflow: auto;
      background-color: ${t.colors.palette.light[200]};
      div.output-ds-label+div.output-ds-label{
        margin-top: ${s.polished.rem(8)};
      }
    }
  `}var g=n(34796),S=n(26826);const f=Object.assign(Object.assign({},s.DataSourceTypes),S.ArcGISDataSourceTypes),v="USE_MAIN_DATA_SOURCE";var D=n(30726);const w=n(71997),b=n(12545),y=n(84543),x="CLICK_ME_TO_CLEAR_SELECTION";function I(e,t,a){if(!e||!t)return null;const i=a&&{[s.JimuFieldType.Number]:a.formatMessage({id:"numberField",defaultMessage:D.defaultMessages.numberField}),[s.JimuFieldType.String]:a.formatMessage({id:"stringField",defaultMessage:D.defaultMessages.stringField}),[s.JimuFieldType.Date]:a.formatMessage({id:"dateField",defaultMessage:D.defaultMessages.dateField})},o={[s.JimuFieldType.Number]:w,[s.JimuFieldType.String]:b,[s.JimuFieldType.Date]:y},r={[s.JimuFieldType.Number]:t.colors.info,[s.JimuFieldType.String]:t.colors.success,[s.JimuFieldType.Date]:t.colors.warning};return{icon:o[e],color:r[e],title:null==i?void 0:i[e]}}var M;function N(e,t,a=!0){if(!e||!t)return[];const i=T(e,t,a),o=s.DataSourceManager.getInstance().getDataSource(e);if(!o)return i;let r=[];return o.getDataViews().forEach((e=>{r=r.concat(T(e.id,t,a))})),Array.from(new Set(i.concat(r)))}function C(e,t){if(!e||!t)return[];const a=N(e,t),i=s.DataSourceManager.getInstance().getDataSource(e);if(!i)return a;let o=[];return i.isDataSourceSet&&i.getChildDataSources().forEach((e=>{o=o.concat(C(e.id,t))})),Array.from(new Set(a.concat(o)))}function T(e,t,a=!1){if(!e||!t)return[];const i=function(e,t){return e&&t?function(e){if(!e)return[];const t=[];return Object.keys(e).forEach((s=>{t.push(e[s])})),t}(t).filter((t=>t&&!1!==t.useDataSourcesEnabled&&t.useDataSources&&t.useDataSources.some((t=>t.dataSourceId===e)))).map((e=>e.id)):[]}(e,t),o=a?function(e,t){if(!e||!t)return[];const a=E(s.DataSourceManager.getInstance().getDataSource(e));let i=[],o=[];return a.forEach((e=>{e&&e.id&&(o=N(e.id,t).map((e=>e.id)),i=i.concat(o))})),Array.from(new Set(i))}(e,t):[];return Array.from(new Set(i.concat(o))).map((e=>t[e]))}function j(e){var t,a;if(!e)return[];const i=s.DataSourceManager.getInstance().getDataSource(e);if(!i)return[e];let o=[e];return null===(t=i.getDataViews())||void 0===t||t.forEach((e=>{o=o.concat(e.id)})),i.isDataSourceSet&&(null===(a=i.getChildDataSources())||void 0===a||a.forEach((e=>{o=o.concat(j(e.id))}))),o}function O(e,t){return!!e&&(!t||e.toLocaleLowerCase().includes(t.toLocaleLowerCase()))}function V(e,t,s){return!(!e||!e.id)&&(!t&&!s||(t?s?t.includes(e.id)&&!s(e):t.includes(e.id):!s(e)))}function E(e){if(!e||!e.id)return[];const t=L(),a=t&&t.dataSources;let i=[];return a&&Object.keys(a).forEach((t=>{a[t]&&a[t].isOutputFromWidget&&a[t].originDataSources&&a[t].originDataSources.some((t=>t.dataSourceId===e.id))&&(i=i.concat(s.DataSourceManager.getInstance().getDataSource(t)))})),i}function L(){const e=window&&window.jimuConfig&&window.jimuConfig.isBuilder?(0,s.getAppStore)().getState().appStateInBuilder:(0,s.getAppStore)().getState();return e&&e.appConfig}function R(e){const t=e&&e.type,a=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id),i=function(e,t,a){switch(e){case f.WebMap:case f.WebScene:case f.MapService:case f.FeatureService:case f.GroupLayer:case f.SceneService:case f.SceneLayer:return e;case f.FeatureLayer:return a?`${e}_${s.SupportedLayerServiceTypes.Table}`:t?`${e}_${t}`:e;default:return"UNKNOWN"}}(t,function(e){if(e){if(e.toLowerCase().includes(M.Point.toLowerCase()))return M.Point;if(e.toLowerCase().includes(M.Polyline.toLowerCase()))return M.Polyline;if(e.toLowerCase().includes(M.Polygon.toLowerCase()))return M.Polygon}return null}(a?a.getGeometryType():null==e?void 0:e.geometryType),k(e));switch(i){case f.WebMap:return n(3185);case f.WebScene:return n(69013);case`${f.FeatureLayer}_${M.Point}`:return n(19487);case`${f.FeatureLayer}_${M.Polyline}`:return n(68103);case`${f.FeatureLayer}_${M.Polygon}`:return n(46992);case`${f.FeatureLayer}_${s.SupportedLayerServiceTypes.Table}`:return n(129);case`${f.FeatureLayer}`:return n(25124);case`${f.FeatureService}`:return n(38309);case`${f.MapService}`:return n(48302);case`${f.GroupLayer}`:return n(62491);case f.SceneService:return n(88310);case f.SceneLayer:return n(61402);default:return n(2534)}}function A(e,t){if(!e||!t)return"";switch(e){case f.FeatureLayer:return t.formatMessage({id:"featureLayer",defaultMessage:D.defaultMessages.featureLayer});case f.FeatureService:return t.formatMessage({id:"featureService",defaultMessage:D.defaultMessages.featureService});case f.MapService:return t.formatMessage({id:"mapService",defaultMessage:D.defaultMessages.mapService});case f.GroupLayer:return t.formatMessage({id:"groupLayer",defaultMessage:D.defaultMessages.groupLayer});case f.Map:return t.formatMessage({id:"map",defaultMessage:D.defaultMessages.map});case f.SimpleLocal:return t.formatMessage({id:"simpleLocal",defaultMessage:D.defaultMessages.simpleLocal});case f.WebMap:return t.formatMessage({id:"webMap",defaultMessage:D.defaultMessages.webMap});case f.WebScene:return t.formatMessage({id:"webScene",defaultMessage:D.defaultMessages.webScene});case f.CSV:return t.formatMessage({id:"csv",defaultMessage:D.defaultMessages.csv});case f.SceneService:return t.formatMessage({id:"sceneService",defaultMessage:D.defaultMessages.sceneService});case f.SceneLayer:return t.formatMessage({id:"sceneLayer",defaultMessage:D.defaultMessages.sceneLayer});default:return""}}function k(e){var t;if(!e)return!1;const a=s.DataSourceManager.getInstance().getDataSource(e.id);return a&&a.getLayerDefinition&&(null===(t=a.getLayerDefinition())||void 0===t?void 0:t.type)===s.SupportedLayerServiceTypes.Table}function U(e,t){return e?!(t&&Object.keys(t).filter((e=>1===e.split("-").length)).length>Object.keys(e).length)&&Object.keys(e).every((e=>{var a,i;return(null===(a=t[e])||void 0===a?void 0:a.instanceStatus)===s.DataSourceStatus.Created||(null===(i=t[e])||void 0===i?void 0:i.instanceStatus)===s.DataSourceStatus.CreateError})):!!s.DataSourceManager.getInstance()}function $(e){const t=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);if(!t||!e)return null;let a=t,i=e;for(;a.parentDataSource;)i=a.parentDataSource.getDataSourceJson().setIn(["childDataSourceJsons",a.jimuChildId],i),a=a.parentDataSource;return function(e,t){return W(function(e,t){if(null==t?void 0:t.isHidden)return e;const a=s.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.id);if(!a||!t)return null;let i=a,o=t;for(;i.parentDataSource;){const t=!o.isHidden;i=i.parentDataSource,o=_(e,i.id),t&&(o=o.set("isHidden",!1),e=P(e,o))}return e}(e,t))}(i,e)}function _(e,t){if(!e)return null;if(e.id===t)return e;const s=Object.values(e.childDataSourceJsons||{});let a=null;for(const e of s){const s=_(e,t);if(s){a=s;break}}return a}function P(e,t){if(!e)return null;if(e.id===t.id)return e.merge(t);let s=e;return Object.keys(e.childDataSourceJsons||{}).forEach((a=>{s=s.setIn(["childDataSourceJsons",a],P(e.childDataSourceJsons[a],t))})),s}function W(e){var t;const a=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);if(!a||!e)return null;let i=e;const o=!!i.isHidden;return a.isDataSourceSet&&(null===(t=a.getChildDataSources())||void 0===t?void 0:t.length)>0&&a.getChildDataSources().forEach((e=>{var t;let s=null===(t=e.getDataSourceJson())||void 0===t?void 0:t.merge(i.getIn(["childDataSourceJsons",e.jimuChildId])||{});s&&(o&&(s=s.set("isHidden",!0)),i=i.setIn(["childDataSourceJsons",e.jimuChildId],W(s)))})),i}function F(e){var t,a;if(!e)return null;if(e.itemId&&e.portalUrl)return`${e.portalUrl.replace(/\/$/,"")}/home/item.html?id=${e.itemId}`;if(e.url){if(null===(t=s.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url))||void 0===t?void 0:t.owningSystemUrl){const t=null===(a=s.SessionManager.getInstance().getSessionByUrl(e.url))||void 0===a?void 0:a.token;return t?`${e.url}?token=${t}`:`${e.url}`}return`${e.url}`}return null}function B(e){var t;let s=[];const a=L(),i=null==a?void 0:a.widgets;if(i){const a=null===(t=i[e])||void 0===t?void 0:t.outputDataSources;a&&a.length>0&&(s=s.concat(e),a.forEach((e=>{Object.keys(i).forEach((t=>{var a,o;(null===(o=null===(a=i[t])||void 0===a?void 0:a.useDataSources)||void 0===o?void 0:o.some((t=>t.mainDataSourceId===e)))&&(s=s.concat(B(t)))}))})))}return s}function H(e,t,a){var i;if(!t||!e)return null;let o;if(t.type===s.SupportedItemTypes.WebMap)o=(0,s.Immutable)({id:e,type:null==f?void 0:f.WebMap,sourceLabel:t.title});else if(t.type===s.SupportedItemTypes.WebScene)o=(0,s.Immutable)({id:e,type:null==f?void 0:f.WebScene,sourceLabel:t.title});else if(t.type===s.SupportedItemTypes.FeatureCollection)o=(null===(i=t.typeKeywords)||void 0===i?void 0:i.includes("Singlelayer"))?(0,s.Immutable)({id:e,type:f.FeatureLayer,layerId:"0",sourceLabel:t.title}):(0,s.Immutable)({id:e,type:f.GroupLayer,sourceLabel:t.title});else{const a=t.url;if(a)if(s.dataSourceUtils.isSupportedWholeService(a)){const i=s.dataSourceUtils.getDsTypeFromWholeServiceUrl(a);o=(0,s.Immutable)({id:e,type:i,sourceLabel:t.title})}else if(s.dataSourceUtils.isSupportedSingleLayerService(a)){const i=s.dataSourceUtils.getFullServiceUrl(a,!1);let r;switch(s.dataSourceUtils.getDsTypeFromWholeServiceUrl(i)){case f.FeatureService:case f.MapService:r=f.FeatureLayer;break;case f.SceneService:r=f.SceneLayer}if(r){const i=a.replace(/\/$/,"").split("/").reverse()[0];o=(0,s.Immutable)({id:e,type:r,sourceLabel:t.title}),/^\d+$/.test(i)&&(o=o.set("layerId",i))}}}if(o&&a&&(o=o.set("itemId",t.id).set("portalUrl",a)),o&&t.url){const e=t.url.split("?")[0].replace(/^http:/,"https:").replace(/\/$/,"");o=o.set("url",e)}return o}!function(e){e.Point="POINT",e.Polyline="POLYLINE",e.Polygon="POLYGON"}(M||(M={}));var Z,J=n(20878);function z(e,t){switch(e){case Z.DataTypeIsNotSupported:return null==t?void 0:t.formatMessage({id:"addDataErrorNotSupported",defaultMessage:D.defaultMessages.addDataErrorNotSupported});case Z.SceneLayerWithoutAssociatedLayer:return null==t?void 0:t.formatMessage({id:"addDataErrorInvalidSceneLayer",defaultMessage:D.defaultMessages.addDataErrorInvalidSceneLayer});default:return null==t?void 0:t.formatMessage({id:"invalidResourceItem",defaultMessage:s.defaultMessages.invalidResourceItem})}}function q(e,t,a,i){return e&&t?(e=e.replace(/^http:/,"https:"),s.requestUtils.requestWrapper(e,(o=>s.esri.restRequest.request(e,{authentication:o,httpMethod:"GET"}).then((o=>s.ServiceManager.getInstance().fetchServiceInfo(e).then((o=>{const r=o.definition;if(!r)return Promise.reject(Z.ItemInaccessible);let l=function(e,t,a){if(!e||!a)return null;let i;return(t||a.type!==s.SupportedLayerServiceTypes.GroupLayer)&&(t||a.type!==s.SupportedLayerServiceTypes.FeatureLayer&&a.type!==s.SupportedLayerServiceTypes.Table)?s.dataSourceUtils.isSupportedSingleLayerService(t)?i=s.dataSourceUtils.getSingleDsJsonFromLayerDefinition(e,t,a):s.dataSourceUtils.isSupportedWholeService(t)&&(i=s.dataSourceUtils.getSingleDsJsonFromWholeServiceDefinition(e,t,a)):i=s.dataSourceUtils.getSingleDsJsonFromLayerDefinition(e,t,a),i}(t,e,r);return l=function(e,t,s){return e?(t&&(e=e.set("portalUrl",t)),s&&(e=e.set("itemId",s)),e):null}(l,a,i),{dsJson:l,label:r.name||s.dataSourceUtils.getServiceLabelFromUrl(e)}}))))),1)):Promise.reject(Z.ItemInaccessible)}!function(e){e.DataTypeIsNotSupported="DATA_TYPE_IS_NOT_SUPPORTED_YET",e.ItemInaccessible="ITEM_INACCESSIBLE",e.SceneLayerWithoutAssociatedLayer="SCENE_LAYER_WITHOUT_ASSOCIATED_LAYER"}(Z||(Z={}));let G=null;const K=class extends s.React.PureComponent{constructor(e){super(e),this.__unmounted=!1,this.dataSourceUrlTypes=[{label:this.props.intl.formatMessage({id:"anArcGISServerWebService",defaultMessage:D.defaultMessages.anArcGISServerWebService})}],this.onUrlTypesClicked=e=>{this.setState({selectedDataSourceUrlType:e.target.value})},this.onInputUrl=e=>{this.setState({url:e.target.value})},this.onAdded=()=>{return e=this,t=void 0,a=function*(){if(this.state.url){const e=this.state.url.split("?")[0];if(!e)return;return this.props.toggleLoadStatus(!1),yield q(e,this.props.getDsId()).then((e=>{this.props.onAdded(e.dsJson,e.label),this.props.toggleLoadStatus(!0)}),(e=>{console.error(e),this.props.toggleToastStatus(!0,e),this.props.toggleLoadStatus(!0)}))}},new((s=void 0)||(s=Promise))((function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,l)}n((a=a.apply(e,t||[])).next())}));var e,t,s,a},this.checkServiceUrl=e=>{let t=!1;return(/^https:\/\//.test(e)||/^\/\//.test(e))&&s.dataSourceUtils.isSupportedService(e)&&(t=!0),{valid:t}},this.state={selectedDataSourceUrlType:this.dataSourceUrlTypes[0],url:"",selectDataHelpUrl:null}}componentDidMount(){this.__unmounted=!1,G||(G=s.moduleLoader.loadModule("jimu-for-builder").then((e=>e.helpUtils)).then((e=>e.getBuildAppsHelpLink("select-data")))),G.then((e=>{this.__unmounted||this.setState({selectDataHelpUrl:e})}))}componentWillUnmount(){this.__unmounted=!0}render(){const e=this.props.intl.formatMessage({id:"add",defaultMessage:D.defaultMessages.add});return s.React.createElement("div",{className:"external-data-source-url-input"},s.React.createElement("div",{className:"mt-3 ml-2"},s.React.createElement("h5",{className:"url-input-label"},this.props.intl.formatMessage({id:"serviceType",defaultMessage:D.defaultMessages.serviceType})),s.React.createElement(D.Select,{value:this.state.selectedDataSourceUrlType.label,title:this.state.selectedDataSourceUrlType.label,onChange:this.onUrlTypesClicked,className:"url-type-select",buttonProps:{className:"text-truncate"}},this.dataSourceUrlTypes.map((e=>s.React.createElement("option",{key:e.label,value:e.label},e.label))))),s.React.createElement("div",{className:"mt-4 ml-2"},s.React.createElement("h5",{className:"url-input-label"},this.props.intl.formatMessage({id:"url",defaultMessage:D.defaultMessages.url})),s.React.createElement(D.TextInput,{checkValidityOnChange:this.checkServiceUrl,placeholder:"URL",onChange:this.onInputUrl,className:"url-input",value:this.state.url}),s.React.createElement("div",{className:"d-flex"},s.React.createElement("p",{className:"mt-2 hint-label"},this.props.intl.formatMessage({id:"addDataByUrlHint",defaultMessage:D.defaultMessages.addDataByUrlHint})),this.state.selectDataHelpUrl&&s.React.createElement(D.Link,{to:this.state.selectDataHelpUrl,className:"ml-2 font-size-12",target:"_blank"},this.props.intl.formatMessage({id:"details",defaultMessage:D.defaultMessages.details})))),s.React.createElement("div",{className:"mt-3 ml-2"},s.React.createElement(D.Button,{onClick:this.onAdded,type:"primary",disabled:!this.checkServiceUrl(this.state.url).valid,className:"url-input-add-btn px-3",title:e,"aria-label":e},e)))}},Q=n(52274),X=n(41385);class Y extends s.React.PureComponent{constructor(e){super(e),this.__unmounted=!1,this.getNeedAutoOpen=e=>!(!this.props.useDataSources||!e)&&(!!this.props.useDataSources.some((t=>(null==t?void 0:t.mainDataSourceId)===e.id))||!!this.props.getChildDataSources(e).some((e=>this.getNeedAutoOpen(e)))),this.toggleChildDss=()=>{"boolean"==typeof this.props.isOpen?this.props.toggle&&this.props.toggle():this.setState({isOpen:!this.state.isOpen})},this.drawCollapseLine=()=>{s.lodash.defer((()=>{var e,t;if(this.collapseRef&&this.lastNodeInCollapseRef){const s=this.lastNodeInCollapseRef.querySelector(`#${this.getUniqueId()}`)||this.lastNodeInCollapseRef,a=window&&(null===(e=window.getComputedStyle(this.lastNodeInCollapseRef))||void 0===e?void 0:e.paddingTop),i=a?parseFloat(a)+2:0,o=window&&(null===(t=window.getComputedStyle(s))||void 0===t?void 0:t.paddingTop),r=o?parseFloat(o):0;this.__unmounted||this.setState({heightOfCollapseExceptForLastNode:this.collapseRef.offsetHeight-this.lastNodeInCollapseRef.offsetHeight+i,heightOfFirstNodeOfLastNodeInCollapse:s.offsetHeight-r})}this.props.drawCollapseLine&&this.props.drawCollapseLine()}))},this.getUniqueId=()=>`first_node_in_collapse-${Y.count}`,this.getSelectableChildNodes=e=>e?(this.props.getChildDataSources(e)||[]).filter((e=>this.props.isNodeSelectable(e))):[],this.getChildNodes=e=>e?(this.props.getChildDataSources(e)||[]).filter((e=>this.props.isNodeSelectable(e)||this.getChildNodes(e).length>0)):[],this.getLabel=()=>{const e=this.props.getLabel(this.props.dataSource)||this.props.dataSource.id;return this.props.label?`${this.props.label} / ${e}`:e},this.getHideLineStyle=()=>({height:`${this.state.heightOfCollapseExceptForLastNode+this.state.heightOfFirstNodeOfLastNodeInCollapse/2}px`}),this.getWhetherUnselectableParentAndChildNodeCanJoin=()=>{if(this.props.isNodeSelectable(this.props.dataSource))return!1;{const e=this.getChildNodes(this.props.dataSource);return!(this.getSelectableChildNodes(this.props.dataSource).length>0)&&1===e.length}},this.getIsOpen=()=>"boolean"==typeof this.props.isOpen?this.props.isOpen:this.state.isOpen,this.getRenderContent=(e,t)=>{var a;if(!this.props.dataSource)return null;const i=this.getChildNodes(this.props.dataSource),o=i.length>0,r=this.props.isNodeSelectable(this.props.dataSource);if(!r&&!o)return null;const l=this.getSelectableChildNodes(this.props.dataSource).length>0,n=this.getLabel(),d=this.getWhetherUnselectableParentAndChildNodeCanJoin(),c=i.map(((e,a)=>{var o;return e&&e.id?s.React.createElement("div",{key:e.id,ref:e=>{a===i.length-1&&(this.lastNodeInCollapseRef=e)},className:(0,s.classNames)({"pt-3":0!==a})},this.props.getChildDataSources(e).length>0?s.React.createElement(ee,Object.assign({},this.props,{dataSource:e,label:d?n:"",drawCollapseLine:this.drawCollapseLine,isChildTree:!t})):s.React.createElement("div",{className:"d-flex align-items-center"},s.React.createElement("div",{className:(0,s.classNames)("collapse-button leaf")}),s.React.createElement("div",{className:(0,s.classNames)("d-flex align-items-center w-100 z-index-1"),role:"option","aria-selected":null===(o=this.props.useDataSources)||void 0===o?void 0:o.some((t=>(null==t?void 0:t.mainDataSourceId)===e.id))},this.props.renderSelectableNode&&this.props.renderSelectableNode(e)))):null}));return l||r||!d?s.React.createElement("div",{role:"group"},s.React.createElement("div",{className:"d-flex align-items-center"},s.React.createElement("div",{className:(0,s.classNames)("collapse-button",{root:!this.props.isChildTree})},o&&s.React.createElement(D.Button,{type:"tertiary",icon:!0,size:"sm",onClick:this.toggleChildDss,className:"w-10 px-0 d-flex align-items-center jimu-outline-inside",title:this.getIsOpen()?this.props.intl.formatMessage({id:"collapse",defaultMessage:D.defaultMessages.collapse}):this.props.intl.formatMessage({id:"expand",defaultMessage:D.defaultMessages.expand}),"aria-label":this.getIsOpen()?`${this.props.intl.formatMessage({id:"collapse",defaultMessage:D.defaultMessages.collapse})}. ${this.props.getLabel(this.props.dataSource)}`:`${this.props.intl.formatMessage({id:"expand",defaultMessage:D.defaultMessages.expand})}. ${this.props.getLabel(this.props.dataSource)}`},s.React.createElement(D.Icon,{icon:this.getIsOpen()?Q:X,size:"12"}))),s.React.createElement("div",{className:(0,s.classNames)("d-flex align-items-center w-100 z-index-1"),id:this.getUniqueId(),role:r?"option":void 0,"aria-selected":r?null===(a=this.props.useDataSources)||void 0===a?void 0:a.some((e=>(null==e?void 0:e.mainDataSourceId)===this.props.dataSource.id)):void 0},r?this.props.renderSelectableNode&&this.props.renderSelectableNode(this.props.dataSource):this.props.renderUnselectableNode&&this.props.renderUnselectableNode(n,this.props.dataSource,e))),o&&s.React.createElement(D.Collapse,{isOpen:this.getIsOpen(),className:"collapse-content",innerRef:e=>{this.collapseRef=e},onEntering:this.drawCollapseLine,onExiting:this.drawCollapseLine,onEntered:this.drawCollapseLine,onExited:this.drawCollapseLine},c,s.React.createElement("div",{className:(0,s.classNames)("collapse-line",{root:!this.props.isChildTree}),style:this.getHideLineStyle()}))):o?s.React.createElement("div",{role:"group"},c):null},this.getWhetherChildTreeIsTheRealRootTree=()=>{const e=this.getWhetherUnselectableParentAndChildNodeCanJoin();return!this.props.isChildTree&&e},Y.count++,this.state={isOpen:"boolean"==typeof this.props.defaultOpen?this.props.defaultOpen:this.getNeedAutoOpen(this.props.dataSource),heightOfFirstNodeOfLastNodeInCollapse:0,heightOfCollapseExceptForLastNode:0}}componentDidMount(){this.intersectionObserver=new IntersectionObserver((e=>{e[0].intersectionRatio>0&&this.drawCollapseLine()})),this.intersectionObserver.observe(this.rootRef)}componentDidUpdate(e){this.props.isNodeSelectable===e.isNodeSelectable&&this.props.getChildDataSources(this.props.dataSource).length===e.getChildDataSources(e.dataSource).length||this.drawCollapseLine()}componentWillUnmount(){this.__unmounted=!0,this.intersectionObserver.disconnect()}render(){const e=this.getWhetherChildTreeIsTheRealRootTree(),t=!this.props.isChildTree&&!e;return s.React.createElement("div",{className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className}),ref:e=>{this.rootRef=e}},s.React.createElement("div",{className:(0,s.classNames)("component-data-source-tree",{bg:this.props.useDefaultBackground&&t&&this.getIsOpen()&&this.getChildNodes(this.props.dataSource).length>0,"tree-root":t})},this.getRenderContent(t,e)))}}Y.count=-1;const ee=(0,s.injectIntl)((0,g.withStyles)(Y,"DataSourceTree"));var te=n(55339),se=n.n(te);const ae=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:se()},a))};var ie=n(15467),oe=n.n(ie);const re=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:oe()},a))};var le=n(79775),ne=n.n(le);const de=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:ne()},a))};var ce=n(59788),pe=n.n(ce);const ue=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:pe()},a))};var he=n(96009),me=n.n(he);const ge=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:me()},a))};var Se,fe=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{n(a.next(e))}catch(e){o(e)}}function l(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,l)}n((a=a.apply(e,t||[])).next())}))};!function(e){e.WebMap="Web Map",e.WebScene="Web Scene",e.Layers="Layers",e.Url="URL"}(Se||(Se={}));const ve={[Se.WebMap]:J.ItemTypes.WebMap,[Se.WebScene]:J.ItemTypes.WebScene,[Se.Layers]:[J.ItemTypes.FeatureService,J.ItemTypes.MapService,J.ItemTypes.SceneService,J.ItemTypes.FeatureCollection]},De={[f.WebMap]:J.ItemTypes.WebMap,[f.WebScene]:J.ItemTypes.WebScene,[f.FeatureLayer]:[J.ItemTypes.WebMap,J.ItemTypes.WebScene,J.ItemTypes.FeatureService,J.ItemTypes.MapService,J.ItemTypes.FeatureCollection],[f.SceneLayer]:[J.ItemTypes.WebScene,J.ItemTypes.SceneService],[f.GroupLayer]:[J.ItemTypes.WebMap,J.ItemTypes.WebScene,J.ItemTypes.MapService,J.ItemTypes.FeatureCollection],[f.FeatureService]:J.ItemTypes.FeatureService,[f.MapService]:J.ItemTypes.MapService,[f.SceneService]:J.ItemTypes.SceneService},we={[f.WebMap]:Se.WebMap,[f.WebScene]:Se.WebScene,[f.FeatureLayer]:[Se.WebMap,Se.WebScene,Se.Layers,Se.Url],[f.SceneLayer]:[Se.WebScene,Se.Layers,Se.Url],[f.GroupLayer]:[Se.WebMap,Se.WebScene,Se.Layers,Se.Url],[f.FeatureService]:[Se.Layers,Se.Url],[f.MapService]:[Se.Layers,Se.Url],[f.SceneService]:[Se.Layers,Se.Url]},be={[Se.WebMap]:n(46771),[Se.WebScene]:n(91915),[Se.Layers]:n(38589),[Se.Url]:n(38421)};class ye extends s.React.PureComponent{constructor(e){super(e),this.loadingItemNumber=0,this.tabLabel={[Se.WebMap]:this.props.intl.formatMessage({id:"webMap",defaultMessage:D.defaultMessages.webMap}),[Se.WebScene]:this.props.intl.formatMessage({id:"webScene",defaultMessage:D.defaultMessages.webScene}),[Se.Layers]:this.props.intl.formatMessage({id:"layers",defaultMessage:D.defaultMessages.layers}),[Se.Url]:this.props.intl.formatMessage({id:"url",defaultMessage:D.defaultMessages.url})},this.__unmount=!1,this.getTabTypeFromDsType=e=>e?Array.isArray(we[e])?we[e]:[we[e]]:[],this.getTabIcon=e=>e?be[e]:null,this.getTabLabel=e=>e?this.tabLabel[e]:null,this.getElementPosition=e=>{if(!e)return null;let t=e.offsetLeft,s=e.offsetTop,a=e.offsetParent;for(;null!==a;)t+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent;return{x:t,y:s}},this.getConfigDsId=()=>{const e=(0,s.getAppStore)().getState(),t=e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig;return s.appConfigUtils.getUniqueId(t,"dataSource")},this.getNextDsId=()=>{if(!this.dataSourceId)return this.dataSourceId=this.getConfigDsId(),this.dataSourceId;const e=this.dataSourceId.split("_"),t=e[1]?parseInt(e[1])+1:(0,s.uuidv1)(),a=e[0]||"dataSource";return this.dataSourceId=`${a}_${t}`,this.dataSourceId},this.onItemAdded=(e,t)=>fe(this,void 0,void 0,(function*(){const a=this.getNextDsId();try{e=e||[],this.setState({selectedItems:(0,s.Immutable)(e.map((e=>e.id))),partSelectedItems:this.state.partSelectedItems.filter((t=>!e.some((e=>e.id===t))))}),this.toggleLoadStatus(!1);const i=yield this.getDsJsonFromItemOrService(a,t);this.toggleLoadStatus(!0),this.onDsJsonAdded(i,t.title)}catch(e){this.__unmount||(this.toggleLoadStatus(!0),this.toggleToastStatus(!0,Z.ItemInaccessible),this.setState({selectedItems:this.state.selectedItems.filter((e=>e!==t.id)),partSelectedItems:this.state.partSelectedItems.filter((e=>e!==t.id))})),console.error("Failed to add data. ",t,e)}})),this.getDsJsonFromItemOrService=(e,t)=>fe(this,void 0,void 0,(function*(){return t.url&&s.dataSourceUtils.isSupportedSingleLayerService(t.url)?q(t.url,e,t.portalUrl,t.id).then((e=>{var s;return t.title?null===(s=e.dsJson)||void 0===s?void 0:s.set("sourceLabel",t.title):e.dsJson})):H(e,t,t.portalUrl)})),this.onItemRemoved=(e,t)=>{this.setState({selectedItems:(0,s.Immutable)(e.map((e=>e.id))),partSelectedItems:this.state.partSelectedItems.filter((e=>e!==t.id))}),this.onDsJsonRemoved(t.id,null)},this.onDsJsonAdded=(e,t)=>fe(this,void 0,void 0,(function*(){try{if(!e)throw new Error(Z.DataTypeIsNotSupported);if(this.setState({selectedDss:this.state.selectedDss.concat(e),selectedDssLabels:this.state.selectedDssLabels.concat({id:e.id,label:t})}),yield this.checkSceneLayer(e),this.state.isSelectedDataCollapseOpen){const t=yield s.DataSourceManager.getInstance().createDataSource(e);this.checkCreatedDss([t]),this.__unmount||this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1})}this.props.onSelect&&this.props.onSelect([e])}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||(this.toggleToastStatus(!0,null==t?void 0:t.message),this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1,selectedDss:this.state.selectedDss.filter((t=>t.id!==(null==e?void 0:e.id))),selectedDssLabels:this.state.selectedDssLabels.filter((t=>t.id!==(null==e?void 0:e.id))),selectedItems:this.state.selectedItems.filter((t=>t!==(null==e?void 0:e.itemId))),partSelectedItems:this.state.partSelectedItems.filter((t=>t!==(null==e?void 0:e.itemId)))})),console.error("Failed to create data source. ",e,t)}})),this.clearCacheOfErrorDs=e=>{s.DataSourceManager.getInstance().destroyDataSource(null==e?void 0:e.id),this.__unmount||this.onDsJsonRemoved(null==e?void 0:e.itemId,null==e?void 0:e.id)},this.checkSceneLayer=e=>fe(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.type)===f.SceneLayer;if(e&&t)try{this.toggleLoadStatus(!1);const t=yield s.DataSourceManager.getInstance().createDataSource(e);this.checkCreatedDss([t]),this.toggleLoadStatus(!0)}catch(t){this.clearCacheOfErrorDs(e),this.__unmount||(this.toggleLoadStatus(!0),this.toggleToastStatus(!0,Z.SceneLayerWithoutAssociatedLayer),this.setState({selectedDss:this.state.selectedDss.filter((t=>t.id!==e.id)),selectedDssLabels:this.state.selectedDssLabels.filter((t=>t.id!==e.id)),selectedItems:this.state.selectedItems.filter((t=>t!==e.itemId)),partSelectedItems:this.state.partSelectedItems.filter((t=>t!==e.itemId))}))}})),this.checkCreatedDss=e=>{null==e||e.forEach((e=>{e&&!this.state.selectedDss.some((t=>t.id===e.id&&(!e.getDataSourceJson().itemId||t.itemId===e.getDataSourceJson().itemId)))&&s.DataSourceManager.getInstance().destroyDataSource(e.id)}))},this.onDsJsonRemoved=(e,t)=>{if(!e&&!t)return;const a=e?this.state.selectedDss.filter((t=>t.itemId===e)):[this.state.selectedDss.find((e=>e.id===t))].filter((e=>e));if(a.length>0){a.forEach((e=>{s.DataSourceManager.getInstance().destroyDataSource(e.id)}));const i=this.state.selectedDss.filter((s=>e?s.itemId!==e:s.id!==t));this.setState({selectedDss:i,selectedDssLabels:this.state.selectedDssLabels.filter((e=>i.some((t=>t.id===e.id)))),selectedItems:this.state.selectedItems.filter((t=>t!==e)),partSelectedItems:this.state.partSelectedItems.filter((t=>t!==e)),isSelectedDataCollapseOpen:0!==i.length&&this.state.isSelectedDataCollapseOpen}),this.props.onRemove&&this.props.onRemove(a)}},this.onDsJsonChange=e=>{const t=this.state.selectedDss.findIndex((t=>t.id===e.id)),a=this.state.selectedDss.slice();a.splice(t,1,e);const i=s.DataSourceManager.getInstance().getDataSource(e.id);i&&s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(i,e);const o=this.state.selectedItems.concat(this.state.partSelectedItems).find((t=>t===(null==e?void 0:e.itemId)));let r=this.state.selectedItems,l=this.state.partSelectedItems;o&&(this.getWhetherIsPartSelected(e)?(r=this.state.selectedItems.filter((t=>e.itemId&&t!==e.itemId)),l=this.state.partSelectedItems.concat(o)):(r=this.state.selectedItems.concat(o),l=this.state.partSelectedItems.filter((t=>e.itemId&&t!==e.itemId)))),this.setState({selectedDss:a,selectedItems:r,partSelectedItems:l})},this.getWhetherIsPartSelected=e=>{let t=!1;if(null==e?void 0:e.childDataSourceJsons){for(let s=0;s<Object.values(e.childDataSourceJsons).length;s++)if(this.getWhetherIsPartSelected(Object.values(e.childDataSourceJsons)[s])){t=!0;break}}else t=e.isHidden;return t},this.toggleSelectedDataCollapse=()=>{this.state.isSelectedDataCollapseOpen||this.createSelectedDss(),this.setState({isSelectedDataCollapseOpen:!this.state.isSelectedDataCollapseOpen})},this.createSelectedDss=()=>{const e=this.state.selectedDss.filter((e=>!s.DataSourceManager.getInstance().getDataSource(e.id)));return e.length>0?Promise.allSettled(e.map((e=>s.DataSourceManager.getInstance().createDataSource(e).then((e=>(this.__unmount||this.setState({loadedSelectedDssVersion:this.state.loadedSelectedDssVersion+1}),e)))))).then((t=>{const s=t.filter((e=>"fulfilled"===e.status)).map((e=>e.value));return t.filter((e=>"rejected"===e.status)).length>0&&e.filter((e=>!s.some((t=>t.id===e.id)))).forEach((e=>{this.clearCacheOfErrorDs(e)})),this.checkCreatedDss(s),this.createSelectedDss()})):Promise.resolve()},this.onFinish=()=>{this.props.onFinish&&this.props.onFinish(this.state.selectedDss)},this.onCancel=()=>{this.state.selectedDss.forEach((e=>{s.DataSourceManager.getInstance().destroyDataSource(e.id)})),this.setState({selectedDss:[]},(()=>[this.props.onCancel&&this.props.onCancel()]))},this.onActiveTabChange=e=>{this.setState({activeTab:e})},this.toggleLoadStatus=e=>{e?this.loadingItemNumber-=1:this.loadingItemNumber+=1,this.loadingItemNumber>0?this.setState({isLoaded:!1}):this.setState({isLoaded:!0})},this.toggleToastStatus=(e,t)=>{e?this.setState({isToastOpen:e,addDataErrorCode:t},(()=>{setTimeout((()=>{this.__unmount||this.setState({isToastOpen:!1,addDataErrorCode:null})}),5e3)})):this.setState({isToastOpen:e,addDataErrorCode:t})},this.toggleHideData=(e,t)=>{e&&(t&&t.getDataSourceJson().isHidden?this.onDsJsonChange(function(e){if(!e)return null;let t=e.getDataSourceJson();return t=t.set("isHidden",!1),$(t)}(t)):t&&t.id!==e.id?this.onDsJsonChange(function(e){if(!e)return null;let t=e.getDataSourceJson();return t=t.set("isHidden",!0),$(t)}(t)):this.onDsJsonRemoved(e.itemId,e.id))},this.SelectedDataSourceItem=({rootDsJson:e,dsJson:t,rootDsLabel:a})=>{const i=s.DataSourceManager.getInstance().getDataSource(t.id);return(0,s.jsx)("div",{className:"added-ds-item"},!i&&(0,s.jsx)(D.Loading,{type:D.LoadingType.Donut,width:16,height:16,className:"w-25 selected-ds-loading"}),(0,s.jsx)(ee,{dataSource:i||t,isNodeSelectable:()=>!0,renderSelectableNode:t=>this.renderDataItem(t,e,a),getChildDataSources:this.getChildDataSources,getLabel:this.getDataSourceLabel}))},this.getChildDataSources=e=>e&&e.isDataSourceSet?e.getChildDataSources():[],this.getDataSourceLabel=e=>(null==e?void 0:e.getLabel)?e.getLabel()||e.id:null,this.getItemTypes=(e,t)=>{const a=ve[t];if(e&&0!==e.length){const t=Array.from(new Set(e.asMutable().reduce(((e,t)=>e.concat(De[t])),[])));let i=[];return t.forEach((e=>{(Array.isArray(a)?a.some((t=>t===e)):e===a)&&(i=i.concat(e))})),(0,s.Immutable)(i)}return Array.isArray(a)?(0,s.Immutable)(a):a},this.getWhetherHideSingleLayer=(e,t)=>!(!e||t!==Se.Layers||e.some((e=>e===f.FeatureLayer||e===f.SceneLayer))),this.renderDataItem=(e,t,a)=>{if(!e)return null;const i=e.getDataSourceJson?e.getDataSourceJson():e,o=s.DataSourceManager.getInstance().getDataSource(e.id),r=e.id===(null==t?void 0:t.id)&&a?a:this.getDataSourceLabel(o)||e.id,l=i.isHidden?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:D.defaultMessages.clickToShow}):(null==o?void 0:o.parentDataSource)?this.props.intl.formatMessage({id:"clickToHide",defaultMessage:D.defaultMessages.clickToHide}):this.props.intl.formatMessage({id:"remove",defaultMessage:D.defaultMessages.remove});return(0,s.jsx)("div",{className:"d-flex align-items-center justify-content-between w-100 item"},(0,s.jsx)("div",{className:"d-flex align-items-center flex-grow-1 text-truncate",title:A(null==i?void 0:i.type,this.props.intl)},(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center flex-shrink-0 ds-thumbnail"},(0,s.jsx)(D.Icon,{icon:R(i),className:"text-dark",size:"12"})),(0,s.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",title:r},r)),(0,s.jsx)("div",{className:"d-flex align-items-center flex-shrink-0"},(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",icon:!0,onClick:()=>this.toggleHideData(t,o),title:l,"aria-label":l},i.isHidden?(0,s.jsx)(de,{size:"s"}):(null==o?void 0:o.parentDataSource)?(0,s.jsx)(re,{size:"s"}):(0,s.jsx)(ae,{size:"s"}))))},this.getRootDsLabel=e=>{var t;return(null===(t=this.state.selectedDssLabels.find((t=>t.id===(null==e?void 0:e.id))))||void 0===t?void 0:t.label)||(null==e?void 0:e.id)},this.setSearchValue=e=>{this.setState({searchValue:e})},this.onKeyDown=e=>{var t,s;"Esc"!==e.key&&"Escape"!==e.key||(e.target!==this.closeBtnRef.current&&e.target!==this.doneBtnRef.current?null===(t=this.doneBtnRef.current)||void 0===t||t.focus():e.target===this.doneBtnRef.current?null===(s=this.closeBtnRef.current)||void 0===s||s.focus():this.onCancel())},this.leftMenuRef=s.React.createRef(),this.closeBtnRef=s.React.createRef(),this.doneBtnRef=s.React.createRef(),this.state={searchValue:"",selectedDss:[],selectedItems:(0,s.Immutable)([]),partSelectedItems:(0,s.Immutable)([]),selectedDssLabels:[],activeTab:this.props.types&&this.getTabTypeFromDsType(this.props.types[0])?this.getTabTypeFromDsType(this.props.types[0])[0]:Se.WebMap,isLoaded:!0,isToastOpen:!1,isSelectedDataCollapseOpen:!1,loadedSelectedDssVersion:0,addDataErrorCode:null}}componentWillUnmount(){this.__unmount=!0}render(){const e=this.SelectedDataSourceItem;let t=[];if(this.props.types){const e=Array.from(new Set(Array.prototype.concat.apply([],this.props.types.map((e=>this.getTabTypeFromDsType(e))).filter((e=>!!e)))));t=Object.values(Se).filter((t=>e.includes(t)))}else t=Object.values(Se);if((null==t?void 0:t.length)<1)return null;const a=this.props.intl.formatMessage({id:"close",defaultMessage:s.defaultMessages.close}),i=this.state.isSelectedDataCollapseOpen?this.props.intl.formatMessage({id:"down",defaultMessage:D.defaultMessages.down}):this.props.intl.formatMessage({id:"up",defaultMessage:D.defaultMessages.up}),o=this.props.intl.formatMessage({id:"done",defaultMessage:D.defaultMessages.done});return(0,s.jsx)("div",{className:(0,s.classNames)("h-100",{[this.props.className]:!!this.props.className}),onKeyDown:this.onKeyDown},(0,s.jsx)("div",{className:"w-100 component-external-data-source-selector"},(0,s.jsx)("div",{className:"d-flex flex-wrap align-items-stretch w-100 h-100"},(0,s.jsx)("div",{className:"selector-left",ref:this.leftMenuRef},(0,s.jsx)("h3",{className:"selector-left-title",role:"heading"},this.props.isMultiple?this.props.intl.formatMessage({id:"addData",defaultMessage:D.defaultMessages.addData}):this.props.intl.formatMessage({id:"selectData",defaultMessage:D.defaultMessages.selectData})),(0,s.jsx)(D.Nav,{underline:!0,vertical:!0,right:!0,className:"selector-left-tabs"},t.map((e=>(0,s.jsx)(D.NavItem,{key:e,className:(0,s.classNames)("w-100 mb-2",{"active-tab":this.state.activeTab===e})},(0,s.jsx)(D.NavLink,{onClick:()=>{this.onActiveTabChange(e)},className:"d-flex"},(0,s.jsx)(D.Icon,{icon:this.getTabIcon(e),size:"16",className:"mr-2 flex-shrink-0"}),(0,s.jsx)("div",{className:"flex-grow-1 text-truncate text-left",title:this.getTabLabel(e)},this.getTabLabel(e)))))))),(0,s.jsx)("div",{className:"selector-right h-100"},(0,s.jsx)("div",{className:"selector-right-header w-100 d-flex justify-content-end"},(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",icon:!0,className:"close-icon",onClick:this.onCancel,title:a,"aria-label":a,ref:this.closeBtnRef},(0,s.jsx)(ae,{size:"l"}))),(0,s.jsx)("div",{className:"selector-right-body w-100"},t.map(((e,t)=>(0,s.jsx)("div",{className:(0,s.classNames)("inner-item-selector-container h-100 w-100",{"d-none":e!==this.state.activeTab}),key:t},e===Se.Url?(0,s.jsx)(K,{onAdded:this.onDsJsonAdded,getDsId:this.getNextDsId,intl:this.props.intl,toggleLoadStatus:this.toggleLoadStatus,toggleToastStatus:this.toggleToastStatus}):(0,s.jsx)(J.ItemSelector,{itemType:this.getItemTypes(this.props.types,e),portalUrl:this.props.portalUrl,isMultiple:this.props.isMultiple,onSelect:this.onItemAdded,onRemove:this.onItemRemoved,detailReference:this.leftMenuRef,selectedItems:this.state.selectedItems,partSelectedItems:this.state.partSelectedItems,hideSingleLayer:this.getWhetherHideSingleLayer(this.props.types,e)}))))))),(0,s.jsx)("div",null,this.state.selectedDss&&this.state.selectedDss.length>0&&(0,s.jsx)("div",{className:"added-ds-container py-3"},(0,s.jsx)("div",{className:"d-flex justify-content-between align-items-center px-3"},(0,s.jsx)("div",{className:"d-flex align-items-center"},(0,s.jsx)("span",{className:"mr-2"},this.state.selectedDss.length),(0,s.jsx)("span",{className:"mr-2"},this.props.intl.formatMessage({id:"selected",defaultMessage:D.defaultMessages.selected})),(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",icon:!0,onClick:this.toggleSelectedDataCollapse,title:i,"aria-label":i},this.state.isSelectedDataCollapseOpen?(0,s.jsx)(ue,{size:"s"}):(0,s.jsx)(ge,{size:"s"}))),(0,s.jsx)("div",{className:"small-done-btn"},!this.state.isSelectedDataCollapseOpen&&(0,s.jsx)(D.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100",disabled:!this.state.isLoaded,title:o,"aria-label":o,ref:this.doneBtnRef},o))),this.state.isSelectedDataCollapseOpen&&(0,s.jsx)("div",{className:"added-ds-items"},(0,s.jsx)("div",null,this.state.selectedDss.map(((t,a)=>(0,s.jsx)(e,{key:a,rootDsJson:t,dsJson:t,rootDsLabel:this.getRootDsLabel(t)}))))),this.state.isSelectedDataCollapseOpen&&(0,s.jsx)("div",{className:"big-done-btn w-100 px-3"},(0,s.jsx)(D.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100",disabled:!this.state.isLoaded,title:o,"aria-label":o},o)))),(0,s.jsx)("div",null,!this.state.isLoaded&&(0,s.jsx)(D.Loading,{type:D.LoadingType.Primary})),(0,s.jsx)(D.Toast,{text:z(this.state.addDataErrorCode,this.props.intl),type:D.ToastType.Error,open:this.state.isToastOpen})))}}const xe=(0,s.injectIntl)((0,g.withStyles)(ye,"ExternalDataSourceSelector"));var Ie;function Me(e,t,s){e.isDataSourceSet&&e.getChildDataSources().forEach((e=>{e&&e.getDataSourceJson()&&e.id&&(Ne(e.getDataSourceJson(),s)&&t.push(e),Me(e,t,s))}))}function Ne(e,t){return!!e&&t.some((t=>e.type&&t===e.type))}function Ce(e,t){return s=this,a=void 0,o=function*(){const s={};return 0===t.length?yield Promise.resolve(s):yield Promise.all(e.filter((e=>e&&e.id&&!e.getDataSourceJson().isHidden&&e.isDataSourceSet&&!e.isDataView&&!e.isLocal)).map((e=>(s[e.id]||(s[e.id]=[]),Me(e,s[e.id],t))))).then((()=>(Object.keys(s).forEach((e=>{0===s[e].length&&delete s[e]})),s)))},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{n(o.next(e))}catch(e){t(e)}}function l(e){try{n(o.throw(e))}catch(e){t(e)}}function n(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,l)}n((o=o.apply(s,a||[])).next())}));var s,a,i,o}function Te(e,t){let a=e||[];return t&&Object.keys(t).forEach((e=>{if(!a.some((t=>t.id===e))){const t=s.DataSourceManager.getInstance().getDataSource(e);t&&(a=a.concat(t))}})),a}function je(e,t){let s=e||[];return t&&Object.values(t).forEach((e=>{e&&e.length>0&&(s=s.concat(e))})),s}function Oe(e,t,a){var i;if(a){if((null==t?void 0:t.length)>0){const a=s.DataSourceManager.getInstance().getDataSource(null===(i=t[0])||void 0===i?void 0:i.dataSourceId),o=null==a?void 0:a.type;return o&&(null==e?void 0:e.includes(o))?(0,s.Immutable)([o]):(null==e?void 0:e[0])?(0,s.Immutable)([e[0]]):null}return(null==e?void 0:e[0])?(0,s.Immutable)([e[0]]):null}return null}!function(e){e.Added="ADDED",e.Output="OUTPUT"}(Ie||(Ie={}));var Ve=n(74758);class Ee extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some((e=>((null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId))===this.props.ds.id)),this.getParentWidget=e=>{var t,a,i;const o=null===(a=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig;if(!o||!e)return null;const r=null!==(i=o.widgets)&&void 0!==i?i:(0,s.Immutable)({}),l=Object.values(r).filter((e=>{var t;return e.useDataSources&&e.layouts&&(null===(t=e.manifest.properties)||void 0===t?void 0:t.passDataSourceToChildren)}));if(0===l.length)return null;let n=[];return l.find((t=>(n=Ve.searchUtils.getChildrenContents(o,t.id,s.LayoutItemType.Widget,!0),n&&n.some((t=>t.id===e)))))||null},this.getUseDsWithoutFields=e=>{if(!e)return null;const t={};Object.keys(e).forEach((s=>{"fields"!==s&&(t[s]=e[s])}))},this.getUseDs=()=>{let e={dataSourceId:this.props.ds.id,mainDataSourceId:this.props.ds.id};const t=this.getParentWidget(this.props.widgetId),a=((null==t?void 0:t.useDataSources)||[]).find((t=>{const a=s.DataSourceManager.getInstance().getDataSource(t.dataSourceId),i=a&&a.getMainDataSource();return i&&i.id===e.mainDataSourceId}));if(a)e=this.getUseDsWithoutFields(a);else{const t=this.props.ds.getRootDataSource&&this.props.ds.getRootDataSource();t&&(e.rootDataSourceId=t.id)}return this.props.ds.getDataSourceJson().isOutputFromWidget&&(e.dataSourceId=s.DataSourceManager.getInstance().getDataViewDataSourceId(this.props.ds.id,s.CONSTANTS.OUTPUT_DATA_VIEW_ID),e.dataViewId=s.CONSTANTS.OUTPUT_DATA_VIEW_ID),e},this.getDsLabel=e=>e?e.getLabel()||e.id:"",this.onItemClick=e=>{if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(this.getUseDs())}else{if(this.props.disableSelection)return;this.onDsSelected(this.getUseDs())}},this.onDsSelected=e=>{if(!e)return;let t;t=this.props.useDataSources&&this.props.isMultiple?this.props.useDataSources.asMutable({deep:!0}).concat(e):[e],this.props.onChange&&this.props.onChange(t)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter((t=>(null==t?void 0:t.mainDataSourceId)!==e.mainDataSourceId));this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){var e;if(!this.props.ds||!this.props.ds.getDataSourceJson())return null;const t=this.getWhetherSelected(),a=this.getDsLabel(this.props.ds);return s.React.createElement(D.Button,{type:"tertiary",onClick:this.onItemClick,className:(0,s.classNames)("ds-item text-left",{"ds-item-selected":t,[this.props.className]:!!this.props.className}),"aria-checked":t,"aria-label":a,title:a},s.React.createElement("div",{className:(0,s.classNames)({"item-active-icon":t},{"d-none":!t})},s.React.createElement("div",{className:"text-center item-active-icon-container"})),s.React.createElement("div",{className:"d-flex align-items-center w-100 item"},s.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:A(null===(e=this.props.ds)||void 0===e?void 0:e.type,this.props.intl)},s.React.createElement(D.Icon,{icon:R(this.props.ds.getDataSourceJson()),className:"text-dark m-0",size:"12"})),s.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},s.React.createElement("div",{className:"text-truncate ds-type-name"},a))))}}const Le=["widgets/arcgis/query/","widgets/common/search/","widgets/arcgis/directions/"];class Re extends s.React.PureComponent{constructor(e){super(e),this.getRootNode=e=>Le.some((t=>(null==e?void 0:e.uri)===t))?e:this.getChildNodes(e)[0],this.getChildNodes=e=>{if(e.manifest)return this.props.allToUseRootDss.map((e=>e.getDataSourceJson()));{const t=s.DataSourceManager.getInstance().getDataSource(e.id);return(null==t?void 0:t.isDataSourceSet)?t.getChildDataSources().map((e=>e.getDataSourceJson())):[]}},this.getLabel=e=>e.label,this.renderUnselectableNode=(e,t)=>{const a="string"==typeof t.icon?t.icon:t.icon&&t.icon.svg,i="string"==typeof t.icon?null:t.icon&&t.icon.properties&&t.icon.properties.color;return s.React.createElement("div",{className:"d-flex w-100",title:e},s.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},s.React.createElement(D.Icon,{icon:a,color:i,size:"12"})),s.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},s.React.createElement("div",{className:"text-truncate ds-type-name"},e)))},this.renderSelectableNode=e=>{if(!e)return null;const t=s.DataSourceManager.getInstance().getDataSource(e.id);return s.React.createElement(Ee,{useDataSources:this.props.useDataSources,ds:t,widgetId:this.props.widgetId,key:t.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100"})},this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={isNodeSelectable:e=>this.props.allToUseDss.some((t=>t.id===e.id)),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss!==this.props.allToUseDss&&this.setState({isNodeSelectable:e=>this.props.allToUseDss.some((t=>t.id===e.id))}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.widgetJson&&this.props.allToUseRootDss?s.React.createElement("div",{className:"mb-3"},s.React.createElement(ee,{dataSource:this.getRootNode(this.props.widgetJson),useDataSources:this.props.useDataSources,isNodeSelectable:this.state.isNodeSelectable,renderSelectableNode:this.renderSelectableNode,renderUnselectableNode:this.renderUnselectableNode,useDefaultBackground:!0,getChildDataSources:this.getChildNodes,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})):null}}var Ae=n(73982),ke=n.n(Ae);const Ue=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:ke()},a))};class $e extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{const e=this.props.enableToSelectOutputDsFromSelf?null:this.props.widgetId;this.setToUseDataSources(this.props.selectedTypes||this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,e)},this.setToUseDataSources=(e,t,s,a,i,o)=>{const r=this.getToUseRootDss(e,t,s,a,i,o);this.getToUseChildDss(e,t,s,a,i).then((e=>{const t=this.getToUseWidgets(r,e);this.__unmount||this.setState({toUseRootDss:r,toUseChildDss:e,toUseWidgets:t})}))},this.getRootDss=()=>{const e=s.DataSourceManager.getInstance().getWidgetGeneratedDataSources();return Object.keys(e).forEach((t=>{e[t]=e[t].filter((e=>e&&e.id&&e.getDataSourceJson()))})),e},this.getToUseWidgets=(e,t)=>{var a,i;return s.appConfigUtils.getAllWidgets(null===(i=null===(a=(0,s.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===i?void 0:i.appConfig).filter((s=>e[s.id]||this.getRootDss()[s.id]&&this.getRootDss()[s.id].some((e=>!!t[e.id]))))},this.getToUseRootDss=(e,t,s,a,i,o)=>{const r={};if(t)return r;const l=this.getRootDss();Object.keys(l).forEach((t=>{const o=l[t].filter((t=>t&&!t.parentDataSource&&this.props.dataSources&&this.props.dataSources[t.id]&&Ne(t.getDataSourceJson(),e)&&this.isValid(t,s,a,i)));o&&o.length>0&&(r[t]||(r[t]=[]),r[t]=r[t].concat(o))}));const n=B(o);return Object.keys(r).forEach((e=>{(0===r[e].length||n.some((t=>t===e)))&&delete r[e]})),r},this.getToUseChildDss=(e,t,a,i,o)=>{return r=this,l=void 0,d=function*(){let r=[];if(t)r=t.asMutable().map((e=>s.DataSourceManager.getInstance().getDataSource(e)));else{const e=this.getRootDss();Object.keys(e).forEach((t=>{r=r.concat(e[t])}))}return Ce(r,e).then((e=>{const t={};return Object.keys(e).forEach((s=>{e[s].some((e=>this.isValid(e,a,i,o)))&&(t[s]=e[s].filter((e=>this.isValid(e,a,i,o))))})),t}))},new((n=void 0)||(n=Promise))((function(e,t){function s(e){try{i(d.next(e))}catch(e){t(e)}}function a(e){try{i(d.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}i((d=d.apply(r,l||[])).next())}));var r,l,n,d},this.getToUseChildDssByWidgetId=e=>{const t={};return this.getRootDss()[e].forEach((e=>{t[e.id]||(t[e.id]=[]),t[e.id]=this.state.toUseChildDss[e.id]?t[e.id].concat(this.state.toUseChildDss[e.id]):t[e.id]})),Object.keys(t).forEach((e=>{0===t[e].length&&delete t[e]})),t},this.isValid=(e,t,s,a)=>e&&e.getDataSourceJson()&&e.getDataSourceJson().isOutputFromWidget&&!e.isDataView&&!e.isLocal&&!e.getDataSourceJson().isHidden&&O(e.getLabel(),a)&&V(e.getDataSourceJson(),t,s),this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss(),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&Object.keys(this.state.toUseRootDss).length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={toUseRootDss:null,toUseChildDss:null,toUseWidgets:null}}componentDidMount(){this.__unmount=!1,this.props.isDataSourceInited&&this.initData()}componentDidUpdate(e,t){if(this.props.isDataSourceInited){if(e.selectedTypes!==this.props.selectedTypes||e.fromRootDsIds!==this.props.fromRootDsIds||e.fromDsIds!==this.props.fromDsIds||e.searchValue!==this.props.searchValue||e.dataSources!==this.props.dataSources){const e=this.props.enableToSelectOutputDsFromSelf?null:this.props.widgetId,t=this.props.selectedTypes||this.props.types;this.setToUseDataSources(t,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,e)}e.types===this.props.types&&e.isDataSourceInited&&e.dataSources===this.props.dataSources||this.initData(),this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(Ie.Output):this.props.removeDataTab(Ie.Output))}}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.state.toUseChildDss||!this.state.toUseRootDss||!this.state.toUseWidgets)return null;const a=function(e){return e?e.filter((e=>!!e)):(0,s.Immutable)([])}(this.props.types);return s.React.createElement("div",{className:"ds-widget-outputs h-100 w-100"},a&&a.length>0?s.React.createElement("div",{className:"h-100"},this.getWhetherShowList()?s.React.createElement("div",{className:"ds-list px-3",role:"listbox"},this.state.toUseWidgets.map((e=>s.React.createElement(Re,{key:e.id,widgetJson:e,allToUseDss:je(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),allToUseRootDss:Te(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),useDataSources:this.props.useDataSources,isMultiple:this.props.isMultiple,intl:this.props.intl,widgetId:this.props.widgetId,onChange:this.props.onChange,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,isSearching:!!this.props.searchValue})))):s.React.createElement("div",null,(null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&s.React.createElement("div",{className:"empty-placeholder w-100"},s.React.createElement("div",{className:"empty-placeholder-icon"},s.React.createElement(Ue,{size:48})),s.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${this.props.intl.formatMessage({id:"noWidgetOutputCanBeUsed",defaultMessage:D.defaultMessages.noWidgetOutputCanBeUsed})}<br/>${this.props.intl.formatMessage({id:"pleaseAddData",defaultMessage:D.defaultMessages.pleaseAddData})}`}})))):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:D.defaultMessages.noSelectedType}))}}class _e extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some((e=>((null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId))===this.props.dsId)),this.getUseDs=()=>({dataSourceId:this.props.dsId,mainDataSourceId:this.props.dsId}),this.onItemClick=()=>{if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(this.getUseDs())}else{if(this.props.disableSelection)return;this.onDsSelected(this.getUseDs())}},this.onDsSelected=e=>{if(!e)return;let t;t=this.props.useDataSources&&this.props.isMultiple?this.props.useDataSources.asMutable({deep:!0}).concat(e):[e],this.props.onChange&&this.props.onChange(t)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter((t=>(null==t?void 0:t.dataSourceId)!==e.dataSourceId));this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){if(!this.props.dsId)return null;const e=this.getWhetherSelected(),t=(0,s.getAppStore)()&&(0,s.getAppStore)().getState(),a=t&&t.appStateInBuilder&&t.appStateInBuilder.appConfig&&t.appStateInBuilder.appConfig.dataSources,i=a&&a[this.props.dsId];if(!i)return null;const o=i.label||i.sourceLabel||i.id||"";return s.React.createElement("div",{onClick:this.onItemClick,className:(0,s.classNames)("ds-item ds-error-item",{"ds-item-selected":e,[this.props.className]:!!this.props.className})},s.React.createElement("div",{className:"d-flex align-items-center w-100 item"},s.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},s.React.createElement(D.Icon,{icon:R(i),className:"text-dark",size:"12"})),s.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},s.React.createElement("div",{className:"text-truncate ds-type-name",title:o},o))))}}class Pe extends s.React.PureComponent{constructor(e){super(e),this.renderDsItem=e=>s.React.createElement(Ee,{useDataSources:this.props.useDataSources,ds:e,widgetId:this.props.widgetId,key:e.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100"}),this.renderDsLabel=(e,t,a)=>{const i=a?this.props.ds:t;return s.React.createElement("div",{className:"d-flex w-100",title:e},s.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:A(null==i?void 0:i.type,this.props.intl)},s.React.createElement(D.Icon,{icon:R(null==i?void 0:i.getDataSourceJson()),className:"text-dark",size:"12"})),s.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},s.React.createElement("div",{className:"text-truncate ds-type-name"},e)))},this.getChildDataSources=e=>(null==e?void 0:e.isDataSourceSet)?e.getChildDataSources():[],this.getLabel=e=>(null==e?void 0:e.getLabel())||(null==e?void 0:e.id),this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={inAllToUseDss:e=>this.props.allToUseDss.some((t=>t.id===e.id)),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss!==this.props.allToUseDss&&this.setState({inAllToUseDss:e=>this.props.allToUseDss.some((t=>t.id===e.id))}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.ds?s.React.createElement("div",{className:"mb-3"},s.React.createElement(ee,{dataSource:this.props.ds,useDataSources:this.props.useDataSources,isNodeSelectable:this.state.inAllToUseDss,renderSelectableNode:this.renderDsItem,renderUnselectableNode:this.renderDsLabel,useDefaultBackground:!0,getChildDataSources:this.getChildDataSources,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})):null}}class We extends s.React.PureComponent{constructor(e){super(e),this.dsManager=s.DataSourceManager.getInstance(),this.getWhetherShowSingleDss=()=>this.props.rootDss&&this.props.rootDss.length>0,this.getSelectedErrorDss=()=>this.props.useDataSources?this.props.useDataSources.asMutable().filter((e=>!(this.dsManager&&this.dsManager.getDataSource(null==e?void 0:e.mainDataSourceId)))).map((e=>e.mainDataSourceId)):null,this.state={isTypeDropdownOpen:!1,selectedErrorDss:null}}componentDidMount(){if(this.props.showErrorDss){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}componentDidUpdate(e){if(this.props.showErrorDss&&(!this.state.selectedErrorDss||0===this.state.selectedErrorDss.length)&&(!e.useDataSources||0===e.useDataSources.length)&&this.props.useDataSources&&0!==this.props.useDataSources.length){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}render(){return s.React.createElement("div",{className:"ds-list px-3",role:"listbox"},this.props.showErrorDss&&this.state.selectedErrorDss&&this.state.selectedErrorDss.map((e=>s.React.createElement(_e,{useDataSources:this.props.useDataSources,dsId:e,key:e,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,className:"mb-3 ml-4",widgetId:this.props.widgetId}))),this.getWhetherShowSingleDss()&&s.dataSourceUtils.getSortedArrayByLabel(this.props.rootDss).map((e=>e&&e.id?s.React.createElement(Pe,{useDataSources:this.props.useDataSources,ds:e,key:e.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,allToUseDss:this.props.allToUseDss,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:this.props.isSearching}):null)))}}class Fe extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{this.setToUseDataSources(this.props.selectedTypes||this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue)},this.setHasErrorDss=e=>this.setState({hasErrorSelectedDss:e}),this.setToUseDataSources=(e,t,s,a,i)=>{const o=this.getToUseRootDss(e,t,s,a,i);this.getToUseChildDss(e,t,s,a,i).then((e=>{this.__unmount||this.setState({toUseRootDss:o,toUseChildDss:e})}))},this.getRootDss=()=>s.DataSourceManager.getInstance().getConfiguredDataSources().filter((e=>e&&e.id&&e.getDataSourceJson()&&!e.parentDataSource)),this.getToUseRootDss=(e,t,a,i,o)=>t?[]:s.DataSourceManager.getInstance().getConfiguredDataSources().filter((t=>t&&!t.parentDataSource&&this.props.dataSources&&this.props.dataSources[t.id]&&Ne(t.getDataSourceJson(),e)&&this.isValid(t,a,i,o))),this.getToUseChildDss=(e,t,a,i,o)=>{return r=this,l=void 0,d=function*(){let r;return r=t?t.asMutable().map((e=>s.DataSourceManager.getInstance().getDataSource(e))):this.getRootDss(),Ce(r,e).then((e=>{const t={};return Object.keys(e).forEach((s=>{e[s].some((e=>this.isValid(e,a,i,o)))&&(t[s]=e[s].filter((e=>this.isValid(e,a,i,o))))})),t}))},new((n=void 0)||(n=Promise))((function(e,t){function s(e){try{i(d.next(e))}catch(e){t(e)}}function a(e){try{i(d.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}i((d=d.apply(r,l||[])).next())}));var r,l,n,d},this.isValid=(e,t,s,a)=>e&&e.getDataSourceJson()&&!e.getDataSourceJson().isOutputFromWidget&&!e.isDataView&&!e.isLocal&&!e.getDataSourceJson().isHidden&&O(e.getLabel(),a)&&V(e.getDataSourceJson(),t,s),this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss()||!(!this.state.hasErrorSelectedDss||!this.props.useDataSources),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&this.state.toUseRootDss.length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={toUseRootDss:null,toUseChildDss:null,hasErrorSelectedDss:!0}}componentDidMount(){this.__unmount=!1,this.props.isDataSourceInited&&this.initData()}componentDidUpdate(e,t){this.props.isDataSourceInited&&(e.selectedTypes===this.props.selectedTypes&&e.fromRootDsIds===this.props.fromRootDsIds&&e.fromDsIds===this.props.fromDsIds&&e.searchValue===this.props.searchValue&&e.dataSources===this.props.dataSources||(this.props.selectedTypes?this.setToUseDataSources(this.props.selectedTypes,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue):this.setToUseDataSources(this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue)),e.types===this.props.types&&e.isDataSourceInited&&e.dataSources===this.props.dataSources||this.initData(),this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(Ie.Added):this.props.removeDataTab(Ie.Added)))}componentWillUnmount(){this.__unmount=!0}render(){var e,t;const a=function(e){return e?e.filter((e=>!!e)):(0,s.Immutable)([])}(this.props.types);return s.React.createElement("div",{className:"ds-added-data h-100 w-100"},a&&a.length>0?s.React.createElement("div",{className:"h-100"},this.getWhetherShowList()?s.React.createElement(We,{rootDss:Te(this.state.toUseRootDss,this.state.toUseChildDss),allToUseDss:je(this.state.toUseRootDss,this.state.toUseChildDss),onChange:this.props.onChange,isMultiple:this.props.isMultiple,changeHasErrorSelectedDss:this.setHasErrorDss,useDataSources:this.props.useDataSources,showErrorDss:!0,disableRemove:this.props.disableRemove,disableSelection:this.props.disableSelection,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:!!this.props.searchValue}):s.React.createElement("div",null,(null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&s.React.createElement("div",{className:"empty-placeholder w-100"},s.React.createElement("div",{className:"empty-placeholder-icon"},s.React.createElement(Ue,{size:48})),s.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${this.props.intl.formatMessage({id:"noAddedDataSourceCanBeUsed",defaultMessage:D.defaultMessages.noAddedDataSourceCanBeUsed})}<br/>${this.props.intl.formatMessage({id:"pleaseAddData",defaultMessage:D.defaultMessages.pleaseAddData})}`}})))):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:D.defaultMessages.noSelectedType}))}}class Be extends s.React.PureComponent{constructor(){super(...arguments),this.__unmount=!1,this.getWhetherDisableSelectionType=e=>e.length<=1,this.onTypeSelected=e=>{const t=e.target.value;let a;a="All"===t?null:(0,s.Immutable)([t]),this.props.onTypeSelected(a)}}render(){var e;const t=this.props.toUseTypes?(0,s.Immutable)(Array.from(new Set(this.props.toUseTypes.asMutable()))):(0,s.Immutable)([]),a=this.props.hideAllOptionOfTypeDropdown;return s.React.createElement("div",{className:"d-flex justify-content-between align-items-center to-use-types"},s.React.createElement("div",{className:"mr-2 w-25 text-truncate",title:this.props.intl.formatMessage({id:"type",defaultMessage:D.defaultMessages.type})},this.props.intl.formatMessage({id:"type",defaultMessage:D.defaultMessages.type})),this.getWhetherDisableSelectionType(t)?s.React.createElement("div",{className:"types-selected text-truncate mr-1",title:A(t[0],this.props.intl)},A(t[0],this.props.intl)):s.React.createElement(D.Select,{value:(null===(e=this.props.selectedTypes)||void 0===e?void 0:e[0])||"All",onChange:this.onTypeSelected,className:"flex-shrink-0 to-use-dp",buttonProps:{className:"text-truncate h-100"}},(i=t.asMutable(),i.sort(((e,t)=>null==e?void 0:e.localeCompare(t)))).map((e=>s.React.createElement("option",{value:e,key:e},A(e,this.props.intl)))),!a&&t&&t.length>1&&s.React.createElement("option",{value:"All"},this.props.intl.formatMessage({id:"all",defaultMessage:D.defaultMessages.all}))));var i}}var He=n(34750),Ze=n.n(He);const Je=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:Ze()},a))};var ze=n(30224),qe=n.n(ze);const Ge=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:qe()},a))};class Ke extends s.React.PureComponent{constructor(e){super(e),this.externalDsStyle={width:"100%",height:"100%",maxWidth:"5000px",margin:0},this.__unmount=!1,this.showExternalDs=()=>{this.setState({isExternalDsShown:!0})},this.addDataTab=e=>{this.props.hideTabs||this.state.dataTabs.some((t=>t===e))||this.setState({dataTabs:this.state.dataTabs.concat(e)})},this.removeDataTab=e=>{!this.props.hideTabs&&this.state.dataTabs.some((t=>t===e))&&this.setState({dataTabs:this.state.dataTabs.filter((t=>t!==e))})},this.onActiveTabChange=e=>{this.setState({activeTab:e})},this.onSelectDataFinished=e=>{e?this.state.getAppConfigAction?((0,this.state.getAppConfigAction)().addDataSources(e).exec(),e.map((e=>{return t=this,a=void 0,o=function*(){return yield s.DataSourceManager.getInstance().createDataSource(e)},new((i=void 0)||(i=Promise))((function(e,s){function r(e){try{n(o.next(e))}catch(e){s(e)}}function l(e){try{n(o.throw(e))}catch(e){s(e)}}function n(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,l)}n((o=o.apply(t,a||[])).next())}));var t,a,i,o})),this.props.changeInitStatus&&this.props.changeInitStatus(!1),this.__unmount||this.setState({isExternalDsShown:!1,activeTab:this.state.dataTabs.some((e=>e===Ie.Added))?Ie.Added:this.state.activeTab})):console.error("Can not load jimu-for-builder"):this.setState({isExternalDsShown:!1})},this.onSelectDataCanceled=()=>{this.setState({isExternalDsShown:!1})},this.onToggleExternalDs=()=>{this.setState({isExternalDsShown:!this.state.isExternalDsShown})},this.onSearchValueChange=e=>{this.setState({searchValue:e.target.value})},this.setSelectedType=e=>{this.setState({selectedTypes:e})},this.ExternalDs=(0,s.jsx)(xe,{portalUrl:(0,s.getAppStore)().getState().portalUrl,onCancel:this.onSelectDataCanceled,onFinish:this.onSelectDataFinished,isMultiple:!0,types:this.props.types});const t=[Ie.Added,Ie.Output].filter((e=>{var t;return!(null===(t=this.props.hideTabs)||void 0===t?void 0:t.includes(e))}));this.state={isExternalDsShown:!1,getAppConfigAction:null,searchValue:"",dataTabs:t,activeTab:t[0],selectedTypes:Oe(this.props.types,this.props.useDataSources,this.props.hideAllOptionOfTypeDropdown)}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-for-builder").then((e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})}))}componentDidUpdate(e){e.types!==this.props.types&&this.setSelectedType(Oe(this.props.types,this.props.useDataSources,this.props.hideAllOptionOfTypeDropdown))}componentWillUnmount(){this.__unmount=!0}render(){var e;if(!s.DataSourceManager.getInstance())return null;const t=1===this.state.dataTabs.length&&this.state.dataTabs[0]===Ie.Added,a=1===this.state.dataTabs.length&&this.state.dataTabs[0]===Ie.Output,i=(0,s.jsx)(Fe,{types:this.props.types,selectedTypes:this.state.selectedTypes,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,widgetId:this.props.widgetId,searchValue:this.state.searchValue,fromDsIds:this.props.fromDsIds,dataSources:this.props.dataSources,hideDs:this.props.hideDs,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown}),o=(0,s.jsx)($e,{types:this.props.types,selectedTypes:this.state.selectedTypes,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,searchValue:this.state.searchValue,dataSources:this.props.dataSources,widgetId:this.props.widgetId,fromDsIds:this.props.fromDsIds,hideDs:this.props.hideDs,enableToSelectOutputDsFromSelf:this.props.enableToSelectOutputDsFromSelf,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown}),r=(0,s.jsx)(D.Tabs,{type:"pills",fill:!0,className:"data-tabs",value:this.state.activeTab,onChange:this.onActiveTabChange},(0,s.jsx)(D.Tab,{id:Ie.Added,title:this.props.intl.formatMessage({id:"added",defaultMessage:D.defaultMessages.added})},i),(0,s.jsx)(D.Tab,{id:Ie.Output,title:this.props.intl.formatMessage({id:"outputs",defaultMessage:D.defaultMessages.outputs})},o));return(0,s.jsx)("div",{className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:"component-data-source-list h-100 w-100"},!this.props.hideHeader&&(0,s.jsx)("div",{className:"ds-list-header jimu-widget-setting--header d-flex px-3 py-0",title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:D.defaultMessages.setDataSource})},(0,s.jsx)(D.PanelHeader,{level:1,className:"py-3",showClose:!!this.props.onCloseClick,onClose:this.props.onCloseClick,title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:D.defaultMessages.setDataSource})})),(0,s.jsx)("div",{className:"w-100 px-3 mb-3 search"},(0,s.jsx)(D.TextInput,{prefix:(0,s.jsx)(Ge,{size:"m",className:"search-icon"}),value:this.state.searchValue,onChange:this.onSearchValueChange,className:"search-input",placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:s.defaultMessages.search}),size:"sm"})),(0,s.jsx)("div",{className:"w-100 px-3"},!this.props.hideTypeDropdown&&(null===(e=this.props.types)||void 0===e?void 0:e.length)>0&&(0,s.jsx)("div",{className:"ds-types my-3"},(0,s.jsx)(Be,{toUseTypes:this.props.types,onTypeSelected:this.setSelectedType,selectedTypes:this.state.selectedTypes,intl:this.props.intl,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown}))),(0,s.jsx)("div",{className:"w-100 ds-list-container"},(0,s.jsx)("div",{className:"ds-list-tabs h-100"},t?(0,s.jsx)("div",{className:"h-100"},i,(0,s.jsx)("div",{className:"d-none"},o)):(0,s.jsx)("div",{className:"h-100"},a?(0,s.jsx)("div",{className:"h-100"},o,(0,s.jsx)("div",{className:"d-none"},i)):r)),!this.props.disableAddData&&!this.props.hideAddDataButton&&(0,s.jsx)(D.Button,{type:"tertiary",className:" d-flex align-items-center px-3 ds-add-data text-left jimu-outline-inside",onClick:this.showExternalDs,title:this.props.intl.formatMessage({id:"addNewData",defaultMessage:D.defaultMessages.addNewData})},(0,s.jsx)("div",{className:"add-data-icon-container d-flex align-items-center justify-content-center mr-2"},(0,s.jsx)(Je,{size:"s",className:"add-data-icon m-0"})),(0,s.jsx)("div",{className:"text-truncate flex-grow-1"},this.props.intl.formatMessage({id:"addNewData",defaultMessage:D.defaultMessages.addNewData})))),this.props.isDataSourceInited?null:(0,s.jsx)("div",{className:"jimu-secondary-loading"})),this.state.isExternalDsShown?(0,s.jsx)(D.Modal,{isOpen:this.state.isExternalDsShown,style:this.externalDsStyle,toggle:this.onToggleExternalDs,contentClassName:"h-100",className:"widget-ds-setting-add-data-popup",keyboard:!1},this.ExternalDs):null)}}const Qe=(0,g.withStyles)(s.ReactRedux.connect((e=>{var t,s,a,i;return{dataSources:(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===a?void 0:a.dataSources:null===(i=e.appConfig)||void 0===i?void 0:i.dataSources}}))((0,s.injectIntl)(Ke)),"DataSourceList");var Xe;!function(e){e.DataSourceRemoved="DATA_SOURCE_REMOVED",e.SourceWidgetRemoved="SOURCE_WIDGET_REMOVED"}(Xe||(Xe={}));class Ye extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.close=()=>{this.props.isOpen&&!this.__unmount&&this.props.toggle()},this.onCheckboxBtnClick=(e,t)=>{this.stopPropagation(t);const s=this.state.selectedWidgets.indexOf(e);s<0?this.state.selectedWidgets.push(e):this.state.selectedWidgets.splice(s,1),this.setState({selectedWidgets:[...this.state.selectedWidgets]})},this.onRemove=e=>{return t=this,a=void 0,o=function*(){var t,a,i;if(this.stopPropagation(e),this.state.getAppConfigAction){this.props.beforeRemove&&this.props.beforeRemove();const e=this.state.getAppConfigAction();if(this.state.selectedWidgets.length>0&&this.state.selectedWidgets.forEach(((t,s)=>{e.removeWidget(t)})),this.props.dataSourceId){const o=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId);if(null==o?void 0:o.isDataView){const t=o.getDataSourceJson(),a=o.dataViewId;let i=t.dataViews||(0,s.Immutable)({});i=i.without(a);const r=$(t.setIn(["dataViews"],i));e.editDataSource(r).exec()}else{const r=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig.appProxies;let l={};const n=[],d=[];let c;l=(null===(a=this.state.proxySettingUtils)||void 0===a?void 0:a.traverseToGetNeedProxyDataSources)?yield this.state.proxySettingUtils.traverseToGetNeedProxyDataSources(o):{},Object.keys(l).forEach((e=>{var t;c=null===(t=this.state.proxySettingUtils)||void 0===t?void 0:t.getProxyJsonFromSourceUrl(e,r),c&&(d.push(c.id),n.push(c.proxyId))})),e.removeDataSource(this.props.dataSourceId).exec(),null===(i=this.state.proxySettingUtils)||void 0===i||i.deleteProxies(n,e).then((()=>{d.forEach((t=>{e.removeAppProxy(t)})),e.exec()}))}}else e.removeWidget(this.props.widgetId),e.exec();this.props.afterRemove&&this.props.afterRemove()}this.close()},new((i=void 0)||(i=Promise))((function(e,s){function r(e){try{n(o.next(e))}catch(e){s(e)}}function l(e){try{n(o.throw(e))}catch(e){s(e)}}function n(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,l)}n((o=o.apply(t,a||[])).next())}));var t,a,i,o},this.onCancel=e=>{this.stopPropagation(e),this.props.onCancel&&this.props.onCancel(),this.close()},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.state={selectedWidgets:[],getAppConfigAction:null,proxySettingUtils:null}}componentDidMount(){this.__unmount=!1,Promise.all([s.moduleLoader.loadModule("jimu-for-builder"),s.moduleLoader.loadModule("jimu-ui/advanced/setting-components")]).then((e=>{const[{getAppConfigAction:t},{proxySettingUtils:s}]=e;this.__unmount||this.setState({getAppConfigAction:t,proxySettingUtils:s})}))}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.props.reason||!this.props.dataSourceId&&!this.props.widgetId)return null;const a=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId),i=null===(e=this.props.widgets)||void 0===e?void 0:e[this.props.widgetId],o=this.props.label||(this.props.dataSourceId?(null==a?void 0:a.getLabel())||this.props.dataSourceId:(null==i?void 0:i.label)||this.props.widgetId);let r=[];if(this.props.dataSourceId)r=C(this.props.dataSourceId,this.props.widgets);else{const e=null==i?void 0:i.outputDataSources;(null==e?void 0:e.length)>0&&e.forEach((e=>{C(e,this.props.widgets).forEach((e=>{r.some((t=>e.id===t.id))||(r=r.concat(e))}))}))}const l=this.props.reason===Xe.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:D.defaultMessages.removeDataSource}):this.props.intl.formatMessage({id:"outputDataWillBeRemovedTogether",defaultMessage:D.defaultMessages.outputDataWillBeRemovedTogether}),n=this.props.reason===Xe.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataWarningTip",defaultMessage:D.defaultMessages.removeDataWarningTip}):this.props.intl.formatMessage({id:"removeSourceWidgetWarningTip",defaultMessage:D.defaultMessages.removeSourceWidgetWarningTip},{widgetName:o}),d=this.props.reason===Xe.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataAffectedWidgets",defaultMessage:D.defaultMessages.removeDataAffectedWidgets}):this.props.intl.formatMessage({id:"removeSourceWidgetAffectedWidgets",defaultMessage:D.defaultMessages.removeSourceWidgetAffectedWidgets}),c=this.props.reason===Xe.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:D.defaultMessages.removeDataSource}):this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),p=this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel}),u=this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:D.defaultMessages.relatedWidgets}),h=`${this.props.dataSourceId}-desc`;return(0,s.jsx)(D.Modal,{isOpen:this.props.isOpen,className:(0,s.classNames)("bg-light-300 d-flex justify-content-between",{[this.props.className]:!!this.props.className}),onClick:this.stopPropagation,role:"dialog","aria-label":l,"aria-describedby":h},(0,s.jsx)(D.ModalHeader,{className:"d-flex justify-content-between border-color-gray-300 py-3 font-16 font-dark-600",onClick:this.stopPropagation,toggle:this.props.toggle,title:l},l),(0,s.jsx)(D.ModalBody,{onClick:this.stopPropagation,id:h},(0,s.jsx)("div",{className:"px-2 py-0"},(0,s.jsx)("p",{className:"font-13 font-dark-600","data-testid":"confirmDeleteMessage"},n),this.props.reason===Xe.DataSourceRemoved?(0,s.jsx)("p",{className:"font-14 font-dark-800 mt-3"},o):(0,s.jsx)("div",{className:"related-outputs px-2 py-3"},null===(t=null==i?void 0:i.outputDataSources)||void 0===t?void 0:t.map((e=>{var t;return(0,s.jsx)("div",{className:"font-13 font-dark-800 output-ds-label",key:e},(null===(t=s.DataSourceManager.getInstance().getDataSource(e))||void 0===t?void 0:t.getLabel())||e)}))),(0,s.jsx)("p",{className:"font-13 font-dark-600 mt-3"},d),(0,s.jsx)("div",{role:"group","aria-label":u},(0,s.jsx)("p",{className:"font-14 font-dark-400 mt-3"},u),(0,s.jsx)("div",{className:"related-widgets px-2 py-3"},(0,s.jsx)("div",null,r.map((e=>e&&e.id?(0,s.jsx)(D.Label,{key:e.id,className:"d-flex"},(0,s.jsx)(D.Checkbox,{className:"mr-2 font-13",onClick:t=>this.onCheckboxBtnClick(e.id,t),checked:this.state.selectedWidgets.includes(e.id)}),(0,s.jsx)(D.Icon,{icon:e.icon,size:"16",className:"mr-1 font-dark-800"}),e.label):null))))),(0,s.jsx)("p",{className:"font-13 font-dark-600 mt-2 mb-0"},this.props.intl.formatMessage({id:"howToRemoveWidgetsTip",defaultMessage:D.defaultMessages.howToRemoveWidgetsTip})))),(0,s.jsx)(D.ModalFooter,null,(0,s.jsx)("div",{className:"d-flex justify-content-end mt-10"},(0,s.jsx)(D.Button,{type:"primary",className:"mr-2",onClick:this.onRemove,"aria-label":c},c),(0,s.jsx)(D.Button,{type:"default",onClick:this.onCancel,"aria-label":p},p))))}}const et=s.ReactRedux.connect(((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}}))(Ye),tt=(0,g.withStyles)((0,s.injectIntl)(et),"DataSourceRemoveWarningPopup");var st=n(28455),at=n.n(st);const it=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:at()},a))};var ot=n(59216),rt=n.n(ot);const lt=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:rt()},a))};var nt=n(50970),dt=n.n(nt);const ct=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:dt()},a))};var pt=n(54357),ut=n.n(pt);const ht=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:ut()},a))},mt=15;class gt extends s.React.PureComponent{constructor(e){super(e),this.titleInput=s.React.createRef(),this.editButton=s.React.createRef(),this.__unmount=!1,this.lastScrollTop=0,this.lastTimeToggleTileInput=(new Date).getTime(),this.pendingLoadLocalDsPromise=null,this.getLocalDataSource=()=>s.DataSourceManager.getInstance().getDataSource(this.getLocalDataSourceId()),this.initPagination=()=>{this.setState({pagination:{page:1,pageSize:"number"==typeof this.state.dataView.maximum?Math.min(this.state.dataView.maximum,mt):mt}})},this.setQueryParams=()=>{const e=this.state.dataView,t="number"==typeof(null==e?void 0:e.maximum)?e.maximum<=mt?1:Math.ceil(e.maximum/mt):null,s="number"==typeof(null==e?void 0:e.maximum)?Math.min(e.maximum,mt):mt;let a=this.state.pagination.page;t?a+1<=t&&(a+=1):a+=1,this.setState({pagination:{page:a,pageSize:s}})},this.setLocalDataSource=()=>{var e,t,a,i;this.setState({isLocalDataSourceCreated:!1});const o=null===(e=this.state.dataView)||void 0===e?void 0:e.set("orderBy",null===(a=null===(t=this.state.dataView)||void 0===t?void 0:t.orderBy)||void 0===a?void 0:a.filter((e=>!!e.jimuFieldName))),r=this.props.mainDataSource.getDataSourceJson().set("id",this.getLocalDataSourceId()).set("query",o).set("isHidden",!0).without("dataViews"),l=s.DataSourceManager.getInstance().getDataSource(this.getLocalDataSourceId());l?(s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(l,r),s.lodash.defer((()=>{!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})}))):s.DataSourceManager.getInstance().createDataSource({id:r.id,dataSourceJson:r,layer:null===(i=this.props.mainDataSource)||void 0===i?void 0:i.layer}).then((()=>{!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})}),(e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})}))},this.loadLocalDataSource=()=>{if(!this.getLocalDataSource())return;this.pendingLoadLocalDsPromise&&this.pendingLoadLocalDsPromise.cancel(),this.setState({isLocalDataSourceLoaded:!1});let e=Object.assign({page:1,pageSize:this.state.pagination.page*this.state.pagination.pageSize},{outFields:["*"]});if(!this.props.isSettingMainDataSource){const t=this.props.mainDataSource.getConfigQueryParams()||{};delete t.orderByFields,e=this.props.mainDataSource.mergeQueryParams(t,e)}this.pendingLoadLocalDsPromise=s.cancelablePromise.cancelable(this.getLocalDataSource().load(e,{widgetId:this.getLocalDataSourceId(),scope:s.QueryScope.InConfigView}).then((()=>{var e;!this.__unmount&&this.props.isOpen&&(this.setState({isLocalDataSourceLoaded:!0,previewTableRecords:null===(e=this.getLocalDataSource())||void 0===e?void 0:e.getRecordsByPage(1,this.state.pagination.pageSize*this.state.pagination.page)}),this.pendingLoadLocalDsPromise=null)}),(e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&(this.setState({isLocalDataSourceLoaded:!0,previewTableRecords:[]}),this.pendingLoadLocalDsPromise=null)})))},this.getUseDataSource=e=>{if(!e)return null;const t=e.getRootDataSource(),a=e.getMainDataSource();return(0,s.Immutable)({dataSourceId:e.id,rootDataSourceId:t&&t.id,mainDataSourceId:a&&a.id})},this.getNewDataView=e=>{if(!e)return(0,s.Immutable)({});const t=e.getDataSourceJson(),a=(null==t?void 0:t.dataViews)?Object.keys(t.dataViews):null,i=a&&a.map((e=>e.split("_")[1])).filter((e=>this.isNumeric(e))).length>0?Math.max.apply(null,a.map((e=>e.split("_")[1])).filter((e=>this.isNumeric(e))))+1:1;return(0,s.Immutable)({id:this.props.newDataViewId||`dataView_${i}`,label:this.props.newDataViewLabel||`${this.props.intl.formatMessage({id:"dataView",defaultMessage:D.defaultMessages.dataView})} ${i}`})},this.getPreviewTable=(e,t,a)=>{const i=null==e?void 0:e.fields;if(!t||!i)return null;const o=Object.values(i).sort(((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)}));return(0,s.jsx)("div",{className:"table-container mr-2",onScroll:this.onScroll},(0,s.jsx)("div",{className:"table-header"},(0,s.jsx)("table",null,(0,s.jsx)("caption",{className:"sr-only"},a),(0,s.jsx)("thead",null,(0,s.jsx)("tr",{className:"d-flex"},o.map(((e,t)=>(0,s.jsx)("th",{key:t,title:e.alias||e.name},e.alias||e.name))))))),(0,s.jsx)("div",{className:"table-body"},(0,s.jsx)("table",null,(0,s.jsx)("tbody",null,t.map(((e,t)=>(0,s.jsx)("tr",{className:"d-flex",key:t},o.map(((t,a)=>{const i=e.getFormattedFieldValue(t.jimuName,this.props.intl);return(0,s.jsx)("td",{key:a,title:i},i)})))))))))},this.isNumeric=e=>!isNaN(parseFloat(e))&&isFinite(e),this.onScroll=e=>{const t=e.target.clientHeight,s=e.target.scrollHeight,a=e.target.scrollTop,i=s-(t+a)<=10,o=a>this.lastScrollTop;this.lastScrollTop=a<=0?0:a,this.state.isLocalDataSourceCreated&&this.state.isLocalDataSourceLoaded&&i&&o&&this.setQueryParams()},this.onDuplicate=()=>{var e;if(!this.props.onDuplicate)return;let t=this.getNewDataView(this.props.mainDataSource);t=this.props.dataView?this.props.dataView.merge(t.asMutable({deep:!0})):t,(null===(e=this.props.dataView)||void 0===e?void 0:e.label)&&(t=t.set("label",this.getDuplicateLabel(this.props.dataView.label))),this.props.onDuplicate(t)},this.onRemove=e=>{var t,a,i;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const o=s.DataSourceManager.getInstance().getDataViewDataSourceId(null===(t=this.props.mainDataSource)||void 0===t?void 0:t.id,null===(a=this.props.dataView)||void 0===a?void 0:a.id);0===C(o,this.props.widgets).length?(this.state.getAppConfigAction&&(this.removeDataView(null===(i=this.props.dataView)||void 0===i?void 0:i.id),s.DataSourceManager.getInstance().destroyDataSource(o)),this.afterRemove(),this.props.toggle()):this.setState({isRemoveWarningOpen:!0},(()=>this.props.toggle()))},this.afterRemove=()=>{this.props.afterRemove&&this.props.afterRemove(this.props.dataView)},this.removeDataView=e=>{var t;if(!e||!this.state.getAppConfigAction)return;const a=null===(t=this.props.mainDataSource)||void 0===t?void 0:t.getDataSourceJson();let i=a.dataViews||(0,s.Immutable)({});i=i.without(e);const o=$(a.setIn(["dataViews"],i));this.state.getAppConfigAction().editDataSource(o).exec()},this.onLabelChange=e=>{let t=this.state.dataView;t=t.set("label",e.target.value),this.setState({dataView:t})},this.onSqlExprBuilderChange=e=>{let t=this.state.dataView;t=t.set("where",e),this.setState({dataView:t})},this.onSortChange=(e,t)=>{let s=this.state.dataView;s=s.set("orderBy",e),this.setState({dataView:s})},this.onPageSizeChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("pageSize",s):t.without("pageSize"),this.setState({dataView:t})},this.onToggleMaximum=(e,t)=>{let s=this.state.dataView;s=t?s.set("maximum",100):s.without("maximum"),this.setState({dataView:s})},this.onMaximumChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("maximum",s):t.set("maximum",100),this.setState({dataView:t})},this.onApply=()=>{var e;let t=this.state.dataView;t=null==t?void 0:t.set("orderBy",null===(e=null==t?void 0:t.orderBy)||void 0===e?void 0:e.filter((e=>!!e.jimuFieldName))),this.props.onApply(t)},this.toggleTitleInput=()=>{const e=(new Date).getTime();e-this.lastTimeToggleTileInput>500&&(this.setState({isTitleInputShown:!this.state.isTitleInputShown}),this.lastTimeToggleTileInput=e)},this.toggleRemoveWarning=()=>{this.setState({isRemoveWarningOpen:!this.state.isRemoveWarningOpen})},gt.count++;const t=this.props.dataView||this.getNewDataView(this.props.mainDataSource);this.state={dataView:t,previewTableRecords:[],isTitleInputShown:!1,isRemoveWarningOpen:!1,isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,SqlExpressionBuilder:null,Sort:null,getAppConfigAction:null,isSqlExpressionValid:null,pagination:{page:1,pageSize:"number"==typeof(null==t?void 0:t.maximum)?Math.min(t.maximum,mt):mt}}}componentDidMount(){this.__unmount=!1,Promise.all([s.moduleLoader.loadModule("jimu-ui/advanced/sql-expression-builder"),s.moduleLoader.loadModule("jimu-ui/basic/sql-expression-runtime"),s.moduleLoader.loadModule("jimu-for-builder")]).then((e=>{const[t,{isSqlExpressionValid:s},{getAppConfigAction:a}]=e;this.__unmount||this.setState({SqlExpressionBuilder:t.SqlExpressionBuilder,Sort:t.Sort,getAppConfigAction:a,isSqlExpressionValid:s})})),this.props.isOpen&&this.setLocalDataSource()}componentDidUpdate(e,t){var a,i,o,r;s.lodash.isDeepEqual(e.dataView,this.props.dataView)?this.props.isOpen&&(this.getLocalDataSource()&&e.mainDataSource===this.props.mainDataSource&&s.lodash.isDeepEqual(null===(a=t.dataView)||void 0===a?void 0:a.without("label"),null===(i=this.state.dataView)||void 0===i?void 0:i.without("label"))||this.setLocalDataSource(),(!s.lodash.isDeepEqual(t.pagination,this.state.pagination)||!t.isLocalDataSourceCreated&&this.state.isLocalDataSourceCreated)&&this.loadLocalDataSource()):(this.initPagination(),this.setState({dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)},(()=>{var e,t;null===(t=null===(e=null===document||void 0===document?void 0:document.querySelector)||void 0===e?void 0:e.call(document,".modal.jimu-outline-inside.show"))||void 0===t||t.focus()}))),(null===(o=t.dataView)||void 0===o?void 0:o.maximum)!==(null===(r=this.state.dataView)||void 0===r?void 0:r.maximum)&&this.initPagination(),e.isOpen&&!this.props.isOpen&&this.destroyLocalDataSource(),t.isTitleInputShown!==this.state.isTitleInputShown&&(this.state.isTitleInputShown&&this.titleInput.current?(this.titleInput.current.focus(),this.titleInput.current.select()):!this.state.isTitleInputShown&&this.editButton.current&&this.editButton.current.focus())}componentWillUnmount(){var e;this.__unmount=!0,this.destroyLocalDataSource(),null===(e=this.pendingLoadLocalDsPromise)||void 0===e||e.cancel()}destroyLocalDataSource(){this.getLocalDataSource()&&s.DataSourceManager.getInstance().destroyDataSource(this.getLocalDataSource().id),this.__unmount||(this.setState({isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,previewTableRecords:[],dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)}),this.initPagination())}getLocalDataSourceId(){return`DATA_VIEW_SETTING-${gt.count}`}getDuplicateLabel(e){var t;const s=null===(t=this.props.intl.formatMessage({id:"copy",defaultMessage:D.defaultMessages.copy}))||void 0===t?void 0:t.toLocaleLowerCase();let a=`${e} ${s}`,i=1;for(;this.props.mainDataSource.getDataSourceJson().dataViews&&Object.keys(this.props.mainDataSource.getDataSourceJson().dataViews).find((e=>{var t;return(null===(t=this.props.mainDataSource.getDataSourceJson().dataViews[e])||void 0===t?void 0:t.label)===a}));)i++,a=`${e} ${s} ${i}`;return a}render(){var e,t,a,i,o,r,l;if(!this.props.mainDataSource.query)return null;const n=this.state.dataView,d=s.DataSourceManager.getInstance().getDataViewDataSourceId(null===(e=this.props.mainDataSource)||void 0===e?void 0:e.id,null===(t=this.props.dataView)||void 0===t?void 0:t.id),c=this.state.SqlExpressionBuilder,p=this.state.Sort,u=this.props.intl.formatMessage({id:"edit",defaultMessage:D.defaultMessages.edit}),h=this.props.intl.formatMessage({id:"duplicate",defaultMessage:D.defaultMessages.duplicate}),m=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),g=this.props.intl.formatMessage({id:"applyChanges",defaultMessage:D.defaultMessages.applyChanges}),S=this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel});return(0,s.jsx)("div",null,(0,s.jsx)(D.Modal,{className:(0,s.classNames)({[this.props.className]:!!this.props.className}),isOpen:this.props.isOpen,centered:!0,toggle:this.props.toggle,returnfocusafterclose:"true",contentClassName:"data-view-container",backdrop:"static",keyboard:!1,"aria-label":null===(a=this.state.dataView)||void 0===a?void 0:a.label},(0,s.jsx)(D.ModalHeader,{className:"d-flex justify-content-between align-items-center header"},(0,s.jsx)("div",{className:"flex-grow-1 text-truncate"},this.props.disableRename?(0,s.jsx)("div",{className:"flex-grow-1 text-truncate",title:null==n?void 0:n.label},null==n?void 0:n.label):(0,s.jsx)("div",{className:"d-flex align-items-center pr-3"},this.state.isTitleInputShown?(0,s.jsx)(D.TextInput,{className:"flex-grow-1",value:null==n?void 0:n.label,onChange:this.onLabelChange,ref:this.titleInput,onBlur:this.toggleTitleInput,onKeyUp:this.toggleTitleInput}):(0,s.jsx)("div",{className:"text-truncate"},null==n?void 0:n.label),(0,s.jsx)(D.Button,{className:"flex-shrink-0 ml-2 jimu-outline-inside",type:"tertiary",size:"sm",icon:!0,onClick:this.toggleTitleInput,title:u,"aria-label":u,ref:this.editButton},(0,s.jsx)(lt,{size:"m"})))),(0,s.jsx)("div",{className:"flex-shrink-0"},!this.props.disableDuplicate&&this.props.dataView&&(0,s.jsx)(D.Button,{className:"flex-shrink-0 cicle-button mr-3",type:"default",size:"sm",icon:!0,onClick:this.onDuplicate,title:h,"aria-label":h},(0,s.jsx)(ct,{size:"m"})),!this.props.disableRemove&&this.props.dataView&&(0,s.jsx)(D.Button,{className:"flex-shrink-0 cicle-button",type:"default",size:"sm",icon:!0,onClick:this.onRemove,title:m,"aria-label":m},(0,s.jsx)(ht,{size:"m"})))),n?(0,s.jsx)(D.ModalBody,{className:"d-flex"},(0,s.jsx)("div",{className:"w-38 h-100 flex-shrink-0 setting-table"},(0,s.jsx)(D.Tabs,{type:"underline",fill:!0,className:"h-100",defaultValue:"filter"},(0,s.jsx)(D.Tab,{id:"filter",className:"view-tab",title:this.props.intl.formatMessage({id:"filter",defaultMessage:D.defaultMessages.filter})},c&&(0,s.jsx)(c,{dataSource:this.props.mainDataSource,mode:s.SqlExpressionMode.Simple,expression:n.where,onChange:this.onSqlExprBuilderChange,queryScope:this.props.isSettingMainDataSource&&s.QueryScope.InRemoteConfigView,forceUpdateExpression:!0})),(0,s.jsx)(D.Tab,{id:"sort",className:"view-tab",title:this.props.intl.formatMessage({id:"sort",defaultMessage:D.defaultMessages.sort})},p&&(0,s.jsx)(p,{onChange:this.onSortChange,value:n.orderBy||(0,s.Immutable)([]),useDataSource:this.getUseDataSource(this.props.mainDataSource)})),(0,s.jsx)(D.Tab,{id:"records",className:"view-tab",title:this.props.intl.formatMessage({id:"records",defaultMessage:D.defaultMessages.records})},(0,s.jsx)("div",{css:{paddingRight:2,paddingTop:2}},(0,s.jsx)("div",{className:"d-flex justify-content-between mb-3"},(0,s.jsx)(D.Label,{for:"data-view-setting-page-size-input",className:"label"},this.props.intl.formatMessage({id:"pageSize",defaultMessage:D.defaultMessages.pageSize})),(0,s.jsx)(D.NumericInput,{size:"sm",value:n.pageSize||s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,onAcceptValue:this.onPageSizeChange,showHandlers:!1,precision:0,min:1,id:"data-view-setting-page-size-input"})),(0,s.jsx)("div",{className:"d-flex justify-content-between mb-2"},(0,s.jsx)(D.Label,{for:"data-view-setting-max-records",className:"label"},this.props.intl.formatMessage({id:"maximum",defaultMessage:D.defaultMessages.maximum})),(0,s.jsx)(D.Switch,{id:"data-view-setting-max-records",checked:"number"==typeof n.maximum,onChange:this.onToggleMaximum})),"number"==typeof n.maximum&&(0,s.jsx)("div",{className:"d-flex justify-content-between mb-3"},(0,s.jsx)(D.Label,{for:"data-view-setting-max-records-hint",className:"label"},this.props.intl.formatMessage({id:"maximumLimitationWarning",defaultMessage:D.defaultMessages.maximumLimitationWarning})),(0,s.jsx)(D.Link,{to:"https://developers.arcgis.com/javascript/latest/api-reference/esri-views-layers-FeatureLayerView.html#maximumNumberOfFeatures",className:"ml-2 jimu-outline-inside",target:"_blank",id:"data-view-setting-max-records-hint"},this.props.intl.formatMessage({id:"details",defaultMessage:D.defaultMessages.details}))),"number"==typeof n.maximum&&(0,s.jsx)("div",{className:"d-flex justify-content-between mb-3"},(0,s.jsx)(D.Label,{for:"data-view-setting-max-records-num",className:"label"},this.props.intl.formatMessage({id:"maximumRecordCount",defaultMessage:D.defaultMessages.maximumRecordCount})),(0,s.jsx)(D.NumericInput,{size:"sm",value:n.maximum,onAcceptValue:this.onMaximumChange,precision:0,min:1,showHandlers:!1,id:"data-view-setting-max-records-num"})))))),(0,s.jsx)("div",{className:"w-62 h-100 flex-grow-1 preview-table"},this.getPreviewTable(null===(i=this.getLocalDataSource())||void 0===i?void 0:i.getSchema(),this.state.previewTableRecords,null===(o=this.props.dataView)||void 0===o?void 0:o.label),(!this.state.isLocalDataSourceCreated||!this.state.isLocalDataSourceLoaded)&&(0,s.jsx)(D.Loading,{type:D.LoadingType.Primary}))):null,(0,s.jsx)(D.ModalFooter,{className:"d-flex justify-content-between pb-30"},(0,s.jsx)("div",null,this.state.isSqlExpressionValid&&!this.state.isSqlExpressionValid(null===(r=this.state.dataView)||void 0===r?void 0:r.where)&&(0,s.jsx)("div",{className:"sql-exp-warning text-truncate",title:this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:D.defaultMessages.sqlExprIncomplete})},(0,s.jsx)(it,{size:"l",className:"sql-exp-warning-icon mr-2"}),this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:D.defaultMessages.sqlExprIncomplete}))),(0,s.jsx)("div",null,(0,s.jsx)(D.Button,{className:"mr-10",type:"primary",onClick:this.onApply,disabled:!this.state.isSqlExpressionValid||!this.state.isSqlExpressionValid(null===(l=this.state.dataView)||void 0===l?void 0:l.where),title:g,"aria-label":g},g),(0,s.jsx)(D.Button,{type:"default",onClick:this.props.toggle,title:S,"aria-label":S},S)))),(0,s.jsx)(tt,{dataSourceId:d,isOpen:this.state.isRemoveWarningOpen,afterRemove:this.afterRemove,toggle:this.toggleRemoveWarning,reason:Xe.DataSourceRemoved}))}}gt.count=-1;const St=s.ReactRedux.connect(((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}}))(gt),ft=(0,g.withStyles)((0,s.injectIntl)(St),"DataViewSettingPopup");var vt=n(41553),Dt=n.n(vt);const wt=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:Dt()},a))},bt="create_a_view";class yt extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.tagDiv={tag:"div"},this.widthForDropdownItem={width:"calc(100% - 30px)"},this.widthForDropdownItemLabel={width:"calc(100% - 40px)"},this.widthForMultiDropdownItemLabel={width:"calc(100% - 60px)"},this.onRemove=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const{onRemove:t}=this.props;t&&t(this.props.mainDataSourceId)},this.onDataViewChange=e=>{if(!e||e===bt)return;const t=this.getAllDataViews()[e],a=(0,s.Immutable)([t.asMutable({deep:!0})]);this.props.onChange(this.props.mainDataSourceId,a)},this.onDataViewKeyDown=(e,t)=>{t.target!==t.currentTarget||"Enter"!==t.key&&" "!==t.key||this.onDataViewChange(e)},this.onMultiDataViewChange=(e,t)=>{if(!t||t===bt)return;const a=this.getAllDataViews()[t],i=this.props.dataViews||(0,s.Immutable)([]),o=this.props.dataViews&&this.props.dataViews.find((e=>e.id===a.id))?i.filter((e=>e.id!==a.id)):i.concat(a);this.props.onChange(this.props.mainDataSourceId,o)},this.formatMessage=(e,t)=>{const s=Object.assign({},D.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.getDsLabel=e=>{const t=s.DataSourceManager.getInstance(),a=e&&t.getDataSource(e);return a&&a.getLabel()||this.formatMessage("none")},this.getWhetherItemError=e=>{const t=s.DataSourceManager.getInstance();return!(e&&t.getDataSource(e))},this.getAllDataViews=()=>{if(!this.props.mainDataSourceId)return null;const e=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);if(null==e?void 0:e.isDataSourceSet)return null;const t=e&&e.getDataSourceJson();let a=(null==t?void 0:t.dataViews)||(0,s.Immutable)({});a=a.set(this.props.DefaultDataView.id,(null==t?void 0:t.query)?t.query.merge(this.props.DefaultDataView.asMutable({deep:!0})):this.props.DefaultDataView);const i={id:s.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:D.defaultMessages.selectionDataView})};a=a.set(s.CONSTANTS.SELECTION_DATA_VIEW_ID,i),a=a.without(s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION),a=a.without(s.CONSTANTS.OUTPUT_DATA_VIEW_ID);const o="function"==typeof this.props.hideDataView?this.props.hideDataView:null;return o&&Object.values(a).forEach((e=>{o(e,this.props.mainDataSourceId)&&(a=a.without(e.id))})),a},this.getMultiSelectItems=e=>{if(!this.props.mainDataSourceId)return(0,s.Immutable)([]);const t=[];return e&&Object.keys(e).forEach((a=>{t.push({value:a,label:e[a].label,render:(t,i)=>(0,s.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-start w-100"},(0,s.jsx)(D.Checkbox,{checked:this.getSelectedValueForMutiSelect().includes(t.value)}),(0,s.jsx)("div",{className:"ml-2 text-truncate",style:this.widthForMultiDropdownItemLabel,title:e[a].label},e[a].label),this.getWhetherAllowToChangeViewSetting(a)&&(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",className:"px-2 py-0",onClick:t=>this.onDataViewClick(t,e[a]),title:this.props.intl.formatMessage({id:"settings",defaultMessage:D.defaultMessages.settings})},(0,s.jsx)(wt,{size:"s"})))})})),this.getWhetherAllowToCreateView()&&t.push({value:bt,render:()=>this.getCreateViewButton()}),(0,s.Immutable)(t)},this.getCreateViewButton=()=>(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",onClick:this.onCreateViewClick,className:"p-0 mb-1 w-100 text-left"},(0,s.jsx)(Je,{size:"s",className:"mr-1"}),(0,s.jsx)("span",null,this.formatMessage("createAView")),(0,s.jsx)("div",{className:"create-view-button-border"})),this.getSelectedValueForSingleSelect=()=>{var e;return this.props.dataViews&&this.props.dataViews.length>0?null===(e=this.props.dataViews[0])||void 0===e?void 0:e.id:this.props.DefaultDataView.id},this.getSelectedValueForMutiSelect=()=>this.props.dataViews&&this.props.dataViews.length>0?this.props.dataViews.map((e=>e.id)):(0,s.Immutable)([this.props.DefaultDataView.id]),this.getMultiSelectSelectedString=e=>{if(e)return this.formatMessage("numSelected",{number:e.length})},this.onDataViewClick=(e,t)=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({settingDataView:t}),this.toggleViewSetting()},this.onCreateViewClick=()=>{this.setState({settingDataView:null}),this.toggleViewSetting()},this.onCreateViewKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onCreateViewClick()},this.toggleViewSetting=()=>this.setState({isViewSettingOpen:!this.state.isViewSettingOpen}),this.toggleViewSelect=()=>this.setState({isViewSelectOpen:!this.state.isViewSelectOpen}),this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDataViewSettingApply=e=>{e.id===this.props.DefaultDataView.id?this.editQuery(e):this.editDataView(e)},this.editQuery=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),i=a&&a.getDataSourceJson();if(!i)return;const o=$(i.setIn(["query"],(null==i?void 0:i.query)?i.query.merge(e.without("id").without("label").asMutable({deep:!0})):e.set("id","default").set("label",a.getLabel())));t().editDataSource(o).exec(),a.addSourceVersion(),this.toggleViewSetting()},this.editDataView=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),i=a&&a.getDataSourceJson();let o=i.dataViews||(0,s.Immutable)({});o=o.set(e.id,e);const r=$(i.setIn(["dataViews"],o));t().editDataSource(r).exec(),a.getDataView(null==e?void 0:e.id)?(this.setState({settingDataView:e}),a.addSourceVersion(),this.toggleViewSetting()):s.DataSourceManager.getInstance().createDataSource(i,e.id).then((()=>{this.__unmount||(this.setState({settingDataView:e}),this.toggleViewSetting())}))},this.getWhetherAllowToCreateView=()=>{if(this.props.hideCreateViewButton)return!1;const e=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return e&&!e.isDataSourceSet&&!e.getDataSourceJson().isOutputFromWidget},this.getWhetherAllowToChangeViewSetting=e=>{var t;if(e===s.CONSTANTS.SELECTION_DATA_VIEW_ID)return!1;const a=s.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return!(null===(t=null==a?void 0:a.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget)},this.onClick=()=>{this.props.onClick&&this.props.onClick(this.props.mainDataSourceId)},this.onKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onClick()},this.afterRemoveDataView=e=>{var t;(null===(t=this.props.dataViews)||void 0===t?void 0:t.some((t=>t.id===e.id)))&&this.onDataViewChange(v)},this.state={isViewSettingOpen:!1,isViewSelectOpen:!1,settingDataView:null,getAppConfigAction:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-for-builder").then((e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})}))}componentWillUnmount(){this.__unmount=!0}render(){var e,t,a,i;const o=this.props.mainDataSourceId;if(!o)return null;const r=s.DataSourceManager.getInstance().getDataSource(o),l=r&&r.getDataSourceJson(),n=this.getAllDataViews(),d=this.props.isMultiple&&"boolean"!=typeof this.props.isMultipleDataView||this.props.isMultipleDataView,c=(0,s.jsx)(D.Button,{icon:!0,size:"sm",type:"tertiary",title:this.formatMessage("remove"),onClick:this.onRemove,className:"ds-item-close"},(0,s.jsx)(ae,{size:"s"})),p=this.getWhetherAllowToCreateView(),u=!0!==this.props.hideDataView;return(0,s.jsx)("div",{className:this.props.className?`w-100 ${this.props.className}`:"w-100"},l&&(0,s.jsx)("div",{className:(0,s.classNames)("ds-item",{"ds-error-item":this.getWhetherItemError(o),"disable-cursor":this.props.disableDataSourceList}),onClick:this.onClick,onKeyDown:this.onKeyDown,role:"menuitem",tabIndex:0},(0,s.jsx)("div",{className:"d-flex align-items-center w-100 item"},(0,s.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},(0,s.jsx)(D.Icon,{icon:R(l),className:"text-dark",size:"12"})),(0,s.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},(0,s.jsx)("div",{className:"text-truncate ds-type-name",title:this.getDsLabel(o)},this.getDsLabel(o))),!this.props.hideRemove&&c),u&&n&&Object.keys(n).length>0&&(0,s.jsx)("div",{className:"dv-select-container"},d?(0,s.jsx)(D.MultiSelect,{fluid:!0,items:this.getMultiSelectItems(n),onClickItem:this.onMultiDataViewChange,values:this.getSelectedValueForMutiSelect(),"aria-label":this.formatMessage("selectADataView"),buttonProps:Object.assign(Object.assign({},this.tagDiv),{disabled:this.props.disableDataView,arrow:!this.props.disableDataView}),displayByValues:this.getMultiSelectSelectedString,menuItemProps:this.tagDiv,size:"sm",autoWidth:!0}):(0,s.jsx)(D.Dropdown,{fluid:!0,activeIcon:!0,autoWidth:!0,onClick:this.stopPropagation,isOpen:this.state.isViewSelectOpen,toggle:this.toggleViewSelect,disabled:this.props.disableDataView,"aria-label":this.formatMessage("selectADataView"),menuItemCheckMode:"singleCheck",supportInsideNodesAccessible:!0},(0,s.jsx)(D.DropdownButton,{onClick:this.toggleViewSelect,type:"tertiary",className:"data-view-dropdown-menu-button",size:"sm",arrow:!this.props.disableDataView},null===(e=n[this.getSelectedValueForSingleSelect()])||void 0===e?void 0:e.label),(0,s.jsx)(D.DropdownMenu,null,Object.values(n).map(((e,t)=>(0,s.jsx)(D.DropdownItem,{key:t,tag:"div",tabIndex:0,onClick:()=>this.onDataViewChange(e.id),onKeyDown:t=>this.onDataViewKeyDown(e.id,t),active:this.getSelectedValueForSingleSelect()===e.id},(0,s.jsx)("div",{className:"d-flex justify-content-between align-items-center",style:this.widthForDropdownItem},(0,s.jsx)("div",{className:"text-truncate",title:e.label,style:this.widthForDropdownItemLabel},e.label),this.state.isViewSelectOpen&&this.getWhetherAllowToChangeViewSetting(e.id)&&(0,s.jsx)(D.Button,{type:"tertiary",size:"sm",icon:!0,className:"px-2 settings-icon py-0",onClick:t=>this.onDataViewClick(t,e),title:this.props.intl.formatMessage({id:"settings",defaultMessage:D.defaultMessages.settings})},(0,s.jsx)(wt,{size:"s"})))))),p&&(0,s.jsx)(D.DropdownItem,{tag:"div",onKeyDown:this.onCreateViewKeyDown,className:"create-view-button"},this.getCreateViewButton()))))),p&&(0,s.jsx)(ft,{isOpen:this.state.isViewSettingOpen,toggle:this.toggleViewSetting,onApply:this.onDataViewSettingApply,onDuplicate:this.onDataViewSettingApply,afterRemove:this.afterRemoveDataView,mainDataSource:r,dataView:this.state.settingDataView,disableDuplicate:!this.state.settingDataView||(null===(t=this.state.settingDataView)||void 0===t?void 0:t.id)===this.props.DefaultDataView.id,disableRemove:!this.state.settingDataView||(null===(a=this.state.settingDataView)||void 0===a?void 0:a.id)===this.props.DefaultDataView.id,disableRename:(null===(i=this.state.settingDataView)||void 0===i?void 0:i.id)===this.props.DefaultDataView.id}))}}class xt extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.DefaultDataView=(0,s.Immutable)({id:v,label:this.props.intl.formatMessage({id:"default",defaultMessage:D.defaultMessages.default})}),this.sidePopperTrigger=s.React.createRef(),this.backToFocusNode=null,this.changeInitStatus=e=>{this.setState({isDataSourceInited:e})},this.disableSelection=()=>{if(this.props.disableSelection){const e=this.props.useDataSources||(0,s.Immutable)([]);return this.props.disableSelection(e.asMutable({deep:!0}))}return!1},this.disableRemove=()=>{if(this.props.disableRemove){const e=this.props.useDataSources||(0,s.Immutable)([]);return this.props.disableRemove(e.asMutable({deep:!0}))}return!1},this.onModalClose=()=>{this.setState({modalType:"none"})},this.onMainDsChanged=e=>{e&&(this.props.onChange&&this.props.onChange(e),this.props.closeDataSourceListOnChange&&this.setState({modalType:"none"}))},this.onMainDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter((t=>(null==t?void 0:t.mainDataSourceId)!==e));this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))},this.onDataViewChanged=(e,t)=>{if(!e||!this.props.useDataSources)return;const a=(0,s.Immutable)(this.props.useDataSources.find((t=>t.mainDataSourceId===e))||{dataSourceId:e,mainDataSourceId:e}),i=t.map((t=>{var i;if(t.id===v){const t=s.DataSourceManager.getInstance().getDataSource(e);if(null===(i=null==t?void 0:t.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget){const t=s.DataSourceManager.getInstance().getDataViewDataSourceId(e,s.CONSTANTS.OUTPUT_DATA_VIEW_ID),i=s.CONSTANTS.OUTPUT_DATA_VIEW_ID;return a.set("dataSourceId",t).set("dataViewId",i).asMutable({deep:!0})}return a.without("dataViewId").set("dataSourceId",e).asMutable({deep:!0})}return a.set("dataViewId",t.id).set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(e,t.id)).asMutable({deep:!0})})),o=this.props.useDataSources.filter((t=>(null==t?void 0:t.mainDataSourceId)!==e)).concat(i);this.props.onChange&&this.props.onChange(o.asMutable({deep:!0}))},this.toggleDsList=()=>{this.props.disableDataSourceList||this.setState({modalType:"ds"===this.state.modalType?"none":"ds"})},this.getWhetherShowPlaceholder=()=>{var e;if(null===(e=this.props.useDataSources)||void 0===e?void 0:e.some((e=>!s.DataSourceManager.getInstance().getDataSource(e.dataSourceId))))return!0;if(this.props.disableSelection){const e=this.props.useDataSources||(0,s.Immutable)([]);return!this.props.disableSelection(e.asMutable({deep:!0}))}return this.props.isMultiple||!this.props.isMultiple&&(!this.props.useDataSources||0===this.props.useDataSources.filter((e=>!!e)).length)},this.groupUseDssByMainDataSource=e=>{if(!e||0===e.length)return null;const t={};return e.forEach((e=>{if(t[e.mainDataSourceId]||(t[e.mainDataSourceId]=(0,s.Immutable)([])),e.dataViewId===s.CONSTANTS.SELECTION_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat({id:s.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:D.defaultMessages.selectionDataView})});else if(e.dataViewId===s.CONSTANTS.OUTPUT_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView);else if(e.dataViewId){const a=s.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId),i=a&&a.getDataSourceJson(),o=i&&i.dataViews;(null==o?void 0:o[e.dataViewId])&&(t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(o[e.dataViewId]))}else t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView)})),t},this.onDsItemClick=e=>{this.toggleDsList()},this.getIsDsListOpen=()=>"ds"===this.state.modalType&&!s.urlUtils.getAppIdPageIdFromUrl().pageId,this.onSelectDataKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.toggleDsList()},this.rootNodeKeyDown=e=>{var t;e.target.tabIndex>-1&&(null===(t=this.sidePopperTrigger.current)||void 0===t?void 0:t.contains(e.target))&&("Enter"===e.key||" "===e.key)&&(this.backToFocusNode=e.target)},this.state={isDataSourceInited:U(this.props.dataSources,this.props.dataSourcesInfo),modalType:"none",SidePopper:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-ui/advanced/setting-components").then((e=>{this.__unmount||this.setState({SidePopper:e.SidePopper})}))}componentWillUnmount(){this.__unmount=!0}componentDidUpdate(e){s.lodash.isDeepEqual(this.props.dataSources,e.dataSources)&&s.lodash.isDeepEqual(this.props.dataSourcesInfo,e.dataSourcesInfo)||this.changeInitStatus(U(this.props.dataSources,this.props.dataSourcesInfo))}render(){const e=this.state.SidePopper,t=this.getWhetherShowPlaceholder(),a=this.groupUseDssByMainDataSource(this.props.useDataSources),i=this.props.buttonLabel||this.props.intl.formatMessage({id:"setDataSource",defaultMessage:D.defaultMessages.setDataSource}),o=a?Object.keys(a).length:0;return(0,s.jsx)("div",{className:"w-100",ref:this.sidePopperTrigger,role:"menu",onKeyDown:this.rootNodeKeyDown},a&&Object.keys(a).sort(((e,t)=>null==e?void 0:e.localeCompare(t))).map(((e,i)=>e?(0,s.jsx)(yt,{key:i,mainDataSourceId:e,onRemove:this.onMainDsRemoved,intl:this.props.intl,hideRemove:this.disableRemove(),theme:this.props.theme,disableDataSourceList:this.props.disableDataSourceList,onClick:this.onDsItemClick,className:(t||i!==o-1)&&"mb-3",onChange:this.onDataViewChanged,disableDataView:this.props.disableDataView,isMultiple:this.props.isMultiple,dataViews:a[e],DefaultDataView:this.DefaultDataView,hideDataView:this.props.hideDataView,isMultipleDataView:this.props.isMultipleDataView,hideCreateViewButton:this.props.hideCreateViewButton}):null)),e&&(0,s.jsx)(e,{isOpen:this.getIsDsListOpen(),position:"right",trigger:this.sidePopperTrigger.current,toggle:this.toggleDsList,widgetId:this.props.widgetId,backToFocusNode:this.backToFocusNode,title:this.props.hideHeader?null:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:D.defaultMessages.setDataSource})},(0,s.jsx)("div",{className:"bg-light-300 h-100 w-100"},(0,s.jsx)(Qe,{types:this.props.types,onChange:this.onMainDsChanged,changeInitStatus:this.changeInitStatus,hideDs:this.props.hideDs,onCloseClick:this.onModalClose,isMultiple:this.props.isMultiple,fromDsIds:this.props.fromDsIds,useDataSources:this.props.useDataSources,isDataSourceInited:this.state.isDataSourceInited,widgetId:this.props.widgetId,disableSelection:this.disableSelection(),disableRemove:this.disableRemove(),fromRootDsIds:this.props.fromRootDsIds,hideHeader:!0,hideTypeDropdown:this.props.hideTypeDropdown,hideAllOptionOfTypeDropdown:this.props.hideAllOptionOfTypeDropdown,disableAddData:this.props.disableAddData,hideAddDataButton:this.props.hideAddDataButton,enableToSelectOutputDsFromSelf:this.props.enableToSelectOutputDsFromSelf,hideTabs:this.props.hideTabs}))),t&&(0,s.jsx)(D.Link,{className:"ds-selector-button w-100 mt-0 d-flex justify-content-center align-items-center px-2",onClick:this.toggleDsList,title:i,"aria-label":i,onKeyDown:this.onSelectDataKeyDown,"aria-describedby":this.props["aria-describedby"]},(0,s.jsx)("div",{className:"text-truncate font-weight-500"},i)))}}const It=(0,g.withTheme)(xt);class Mt extends s.React.PureComponent{constructor(){super(...arguments),this.onToggleUseDataEnabled=()=>{this.props.onToggleUseDataEnabled&&this.props.onToggleUseDataEnabled(!this.props.useDataSourcesEnabled)},this.onChange=e=>{this.props.onChange&&this.props.onChange(e)}}render(){if(!s.DataSourceManager.getInstance())return null;const e=this.props,{onChange:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["onChange"]);return(0,s.jsx)("div",{className:(0,s.classNames)("w-100",{[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:"component-data-source-selector"},!this.props.mustUseDataSource&&(0,s.jsx)("div",{className:(0,s.classNames)("d-flex justify-content-between w-100 align-items-center",{"mb-3":this.props.useDataSourcesEnabled})},(0,s.jsx)(D.Label,{className:"w-75 d-inline-block font-dark-600 setting-text-level-3",for:"data-source-selector-connect-to-data-switch"},this.props.intl.formatMessage({id:"connectToData",defaultMessage:D.defaultMessages.connectToData})),(0,s.jsx)(D.Switch,{checked:!!this.props.useDataSourcesEnabled,onChange:this.onToggleUseDataEnabled,id:"data-source-selector-connect-to-data-switch"})),(this.props.mustUseDataSource||this.props.useDataSourcesEnabled)&&(0,s.jsx)(It,Object.assign({types:this.props.types},a,{onChange:this.onChange,intl:this.props.intl,closeDataSourceListOnChange:this.props.closeDataSourceListOnChange,fromDsIds:this.props.fromDsIds,widgetId:this.props.widgetId,isMultipleDataView:this.props.isMultipleDataView}))))}}const Nt=(0,s.injectIntl)((0,g.withStyles)(Mt,"DataSourceSelector")),Ct=s.ReactRedux.connect((e=>{var t,s,a,i,o,r;return{dataSources:(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===a?void 0:a.dataSources:null===(i=e.appConfig)||void 0===i?void 0:i.dataSources,dataSourcesInfo:(null===(o=null===window||void 0===window?void 0:window.jimuConfig)||void 0===o?void 0:o.isBuilder)?null===(r=e.appStateInBuilder)||void 0===r?void 0:r.dataSourcesInfo:e.dataSourcesInfo}}))(Nt);var Tt=n(95369),jt=n.n(Tt);const Ot=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:jt()},a))};var Vt=n(63980),Et=n.n(Vt);const Lt=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:Et()},a))};var Rt=n(50687),At=n.n(Rt);const kt=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:At()},a))};var Ut=n(38450),$t=n.n(Ut);const _t=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:$t()},a))};var Pt=n(88866),Wt=n.n(Pt);const Ft=e=>{const{className:t}=e,a=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["className"]),i=(0,s.classNames)("jimu-icon jimu-icon-component",t);return s.React.createElement(D.SVG,Object.assign({className:i,src:Wt()},a))};class Bt extends s.React.PureComponent{constructor(e){super(e),this.onLabelChange=e=>{this.setState({newLabel:e.target.value})},this.onMoreIconClick=e=>{this.stopPropagation(e),this.props.onMoreIconClick&&this.props.onMoreIconClick(this.props.dataSourceJson)},this.onCloseIconClick=e=>{this.stopPropagation(e),this.props.onCloseIconClick&&this.props.onCloseIconClick(this.props.dataSourceJson)},this.onRename=()=>{const e=this.state.newLabel.trim();this.props.onRename&&this.props.onRename(e)},this.onDataSourceItemClick=e=>{this.stopPropagation(e),this.props.onDataSourceItemClick&&this.props.onDataSourceItemClick(this.props.dataSourceJson)},this.onDataSourceItemKeyDown=e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||this.onDataSourceItemClick(e)},this.onMappingIconClick=e=>{this.stopPropagation(e),this.props.onMappingIconClick&&this.props.onMappingIconClick(this.props.dataSourceJson)},this.onHideIconClick=e=>{this.stopPropagation(e),this.props.onToggleHidden&&this.props.onToggleHidden(this.props.dataSourceJson)},this.onChildDataIconClick=e=>{this.stopPropagation(e),this.props.onChildDataIconClick&&this.props.onChildDataIconClick(this.props.dataSourceJson)},this.onRelatedWidgetsIconClick=e=>{this.stopPropagation(e),this.props.onRelatedWidgetsIconClick&&this.props.onRelatedWidgetsIconClick(this.props.dataSourceJson)},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getWhetherIsSetDs=e=>{if(!e)return!1;const t=s.DataSourceManager.getInstance().getDataSource(e.id);return!!t&&t.isDataSourceSet},this.getChildDssLength=e=>{if(!e)return null;const t=s.DataSourceManager.getInstance().getDataSource(e.id);return t&&t.isDataSourceSet?t.getChildDataSources().length:null},this.getLabel=()=>{var e,t,a,i;const o=s.DataSourceManager.getInstance().getDataSource(null===(e=this.props.dataSourceJson)||void 0===e?void 0:e.id);return o?o.getLabel():(null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.label)||(null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.sourceLabel)||(null===(i=this.props.dataSourceJson)||void 0===i?void 0:i.id)||""},this.state={newLabel:this.getLabel()}}componentDidUpdate(e,t){e.isRenameInputShown!==this.props.isRenameInputShown&&this.props.isRenameInputShown&&this.renameInput&&(this.renameInput.focus(),this.renameInput.select()),e.dataSourceJson!==this.props.dataSourceJson&&this.setState({newLabel:this.getLabel()})}render(){var e,t,a,i,o;if(!this.props.dataSourceJson)return null;const r=N(this.props.dataSourceJson.id,this.props.widgets,!1),l=C(this.props.dataSourceJson.id,this.props.widgets),n=F(this.props.dataSourceJson),d=this.getWhetherIsSetDs(this.props.dataSourceJson);let c;d&&(c=this.getChildDssLength(this.props.dataSourceJson));const p=A(this.props.dataSourceJson.type,this.props.intl),u=this.getLabel(),h=s.DataSourceManager.getInstance().getDataSource(this.props.dataSourceJson.id),m=s.dataSourceUtils.isItemMixin(h)?h.getItemInfo():null;return(0,s.jsx)("div",{className:(0,s.classNames)({[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:(0,s.classNames)("component-data-source-item",{"component-data-source-item-selected-item":this.props.isSelected,"cursor-pointer":!!this.props.onDataSourceItemClick}),onClick:this.onDataSourceItemClick,tabIndex:0,onKeyDown:this.onDataSourceItemKeyDown,role:"option"},this.props.isLoadingShown&&(0,s.jsx)("div",{className:"loading-container"},(0,s.jsx)(D.Loading,{type:D.LoadingType.Bar})),(0,s.jsx)("div",{className:"d-flex justify-content-between align-items-center ds-item-header"},(0,s.jsx)("div",{className:"d-flex align-items-center w-100",title:p},(0,s.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},(0,s.jsx)(D.Icon,{icon:R(this.props.dataSourceJson),className:"text-dark",size:"12"})),(0,s.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},(0,s.jsx)("div",{className:"text-truncate ds-type-name"},p))),(0,s.jsx)("div",{className:"d-flex"},(0,s.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-badge"},!this.props.isLoadingShown&&(0,s.jsx)(J.DataBadge,{item:m,itemId:null===(e=this.props.dataSourceJson)||void 0===e?void 0:e.itemId,portalUrl:null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.portalUrl,url:null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.url})),this.props.isErrorIconShown?(0,s.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-more p-2"},(0,s.jsx)("span",{className:"d-flex justify-content-center",title:this.props.intl.formatMessage({id:"uploadImageError",defaultMessage:D.defaultMessages.uploadImageError})},(0,s.jsx)(Ft,{className:"align-baseline warning-icon",size:"m"}))):null,this.props.isHideable?(0,s.jsx)(D.Button,{size:"sm",icon:!0,type:"tertiary",className:"flex-shrink-0 ds-more p-2",onClick:this.onHideIconClick},(0,s.jsx)("span",{className:"d-flex justify-content-center",title:(null===(i=this.props.dataSourceJson)||void 0===i?void 0:i.isHidden)?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:D.defaultMessages.clickToShow}):this.props.intl.formatMessage({id:"clickToHide",defaultMessage:D.defaultMessages.clickToHide})},(null===(o=this.props.dataSourceJson)||void 0===o?void 0:o.isHidden)?(0,s.jsx)(de,{className:"align-baseline",size:"m"}):(0,s.jsx)(re,{className:"align-baseline",size:"m"}))):null,this.props.isMoreIconShown?(0,s.jsx)(D.Button,{size:"sm",icon:!0,type:"tertiary",className:"flex-shrink-0 ds-more p-2",onClick:this.onMoreIconClick},(0,s.jsx)("span",{className:"d-flex justify-content-center",title:this.props.intl.formatMessage({id:"more",defaultMessage:D.defaultMessages.more})},(0,s.jsx)(Ot,{className:"align-baseline",size:"m"}))):null,this.props.isCloseIconShown?(0,s.jsx)(D.Button,{size:"sm",icon:!0,type:"tertiary",className:"flex-shrink-0 ds-more p-2",onClick:this.onCloseIconClick},(0,s.jsx)("span",{className:"d-flex justify-content-center",title:this.props.intl.formatMessage({id:"remove",defaultMessage:D.defaultMessages.remove})},(0,s.jsx)(ae,{className:"align-baseline ds-close-icon",size:"m"}))):null)),(0,s.jsx)("div",{className:"ds-item-body"},this.props.isRenameInputShown?(0,s.jsx)(D.TextInput,{className:"flex-grow-1 text-truncate p-1 ds-label ds-label-input",ref:e=>{this.renameInput=e},onBlur:this.onRename,onKeyUp:this.onRename,onChange:this.onLabelChange,value:this.state.newLabel,onClick:this.stopPropagation}):(0,s.jsx)("div",{className:"flex-grow-1 two-line-truncate ds-label text-left",title:u},u),(0,s.jsx)("div",{className:(0,s.classNames)("d-flex justify-content-between",{"mt-3":n||this.props.isMappingIconShown})},(0,s.jsx)("div",{className:"d-flex"},d?(0,s.jsx)(D.Button,{type:"tertiary",className:"mr-5 p-0 ds-child-dss",onClick:this.onChildDataIconClick,title:`${this.props.intl.formatMessage({id:"containLayersWithNum",defaultMessage:D.defaultMessages.containLayersWithNum},{layerNum:c})}`},(0,s.jsx)("span",null,(0,s.jsx)(Lt,{size:"m",className:"mr-1"}),(0,s.jsx)("span",{className:"align-middle"},c))):null,this.props.isRelatedWidgetsShown?(0,s.jsx)(D.Button,{type:"tertiary",className:"p-0 flex-grow-1 text-truncate flex-row ds-related-widgets",onClick:this.onRelatedWidgetsIconClick,title:this.props.intl.formatMessage({id:"relatedWidgetsWithNum",defaultMessage:D.defaultMessages.relatedWidgetsWithNum},{directlyNum:r.length,totalNum:l.length})},(0,s.jsx)("span",null,(0,s.jsx)(kt,{size:"m",className:"mr-1"}),(0,s.jsx)("span",{className:"align-middle"},`${r.length} / ${l.length}`))):null),n?(0,s.jsx)(D.Button,{size:"sm",icon:!0,type:"tertiary",className:"ds-origin-label",href:n,target:"_blank",onClick:this.stopPropagation,title:this.props.intl.formatMessage({id:"source",defaultMessage:D.defaultMessages.source},{directlyNum:r.length,totalNum:l.length})},(0,s.jsx)(_t,{className:"m-0",size:"m"})):null))))}}const Ht=s.ReactRedux.connect(((e,t)=>{var s,a;const i=(null===(s=null===window||void 0===window?void 0:window.jimuConfig)||void 0===s?void 0:s.isBuilder)?e.appStateInBuilder:e;return t.isRelatedWidgetsShown?{widgets:null===(a=null==i?void 0:i.appConfig)||void 0===a?void 0:a.widgets}:null}))((0,s.injectIntl)((0,g.withStyles)(Bt,"DataSourceItem")));class Zt extends s.React.PureComponent{render(){return this.props.dataSourceJson?(0,s.jsx)("div",{className:(0,s.classNames)({[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:"component-data-source-error-item"},(0,s.jsx)(Ht,Object.assign({},this.props)))):null}}const Jt=(0,g.withStyles)(Zt,"DataSourceErrorItem");class zt extends s.React.PureComponent{constructor(e){super(e),this.state={isOpen:!1}}render(){const e=this.props.fields;if(!e||!this.props.ds)return null;const t=e[x]?[x]:[];return s.React.createElement("div",{className:"field-list px-3",role:"menu"},e&&t.concat(Object.keys(e).filter((e=>e!==x))).map((t=>{const a=I(e[t].type,this.props.theme,this.props.intl),i=this.props.selectedFields&&(this.props.isMultiple?this.props.selectedFields.some((e=>e===t)):t===this.props.selectedFields[0]),o=e[t].alias||e[t].name;return s.React.createElement(D.Button,{role:"menuitem"+(this.props.isMultiple?"checkbox":"radio"),title:o,"aria-checked":i,"aria-label":null==a?void 0:a.title,key:t,onClick:()=>{this.props.onFieldClick([e[t]])},className:(0,s.classNames)("field-item mt-2 py-1 px-2 d-flex w-100 align-items-center",{"field-item-selected":i})},a&&s.React.createElement(D.Icon,{icon:a.icon,color:a.color,className:"mr-2 flex-shrink-0",size:16}),s.React.createElement("div",{className:"flex-grow-1 text-truncate"},o))})))}}class qt extends s.React.PureComponent{constructor(){super(...arguments),this.dropdownProps={autoWidth:!0},this.widthForDropdownItem={width:"calc(100% - 20px)"},this.widthForDropdownItemLabel={width:"calc(100% - 10px)"},this.onChange=e=>{var t;const s=(null===(t=this.props.selectedFields)||void 0===t?void 0:t.asMutable())||[],a=(null==e?void 0:e.map((e=>e.value)))||[];let i=a,o=s;s.length>a.length&&(i=s,o=a);const r=i.filter((e=>!o.some((t=>t===e))));this.props.onFieldClick(r.map((e=>this.props.fields[e])))},this.getFields=()=>{if(this.props.fields){const e=[];return(this.props.fields[x]?[x]:[]).concat(Object.keys(this.props.fields).filter((e=>e!==x))).forEach((t=>{const s=this.getFieldItem(t);e.push(s)})),e}return[]},this.getSelectedFields=()=>{if(this.props.fields&&this.props.selectedFields){const e=[];return this.props.selectedFields.filter((e=>!!this.props.fields[e])).forEach((t=>{const s=this.getFieldItem(t);e.push(s)})),e}return[]},this.getFieldItem=e=>{var t,a,i;const o=(null===(t=this.props.fields[e])||void 0===t?void 0:t.alias)||(null===(a=this.props.fields[e])||void 0===a?void 0:a.name),r=I(null===(i=this.props.fields[e])||void 0===i?void 0:i.type,this.props.theme,this.props.intl);return{value:e,label:o,render:()=>s.React.createElement("div",{className:"d-flex justify-content-start align-items-center",style:this.widthForDropdownItem,"aria-label":null==r?void 0:r.title},r&&s.React.createElement(D.Icon,{icon:r.icon,color:r.color,className:"d-inline-block mr-2",size:16}),s.React.createElement("div",{className:"text-truncate",style:this.widthForDropdownItemLabel,title:o},o))}}}render(){if(!this.props.fields||!this.props.ds)return null;const e=this.props.dropdownProps?Object.assign(Object.assign({},this.props.dropdownProps),this.dropdownProps):this.dropdownProps;return s.React.createElement("div",null,s.React.createElement(D.AdvancedSelect,Object.assign({},e,{fluid:!0,size:"sm",staticValues:this.getFields(),sortValuesByLabel:!1,selectedValues:this.getSelectedFields(),onChange:this.onChange,placeholder:this.props.placeholder,isMultiple:this.props.isMultiple,hideSearchInput:this.props.isSearchInputHidden,hideBottomTools:!this.props.useMultiDropdownBottomTools,isEmptyOptionHidden:!0})))}}var Gt;!function(e){e.First="POPULATED_VIEW_SELECTION_DEFAULT",e.Second="VIEW_DEFAULT_SELECTION_POPULATED"}(Gt||(Gt={}));const Kt="USE_MAIN_DATA_SOURCE";class Qt extends s.React.PureComponent{constructor(){super(...arguments),this.getWhetherUseDsIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some(((e,s)=>e.dataSourceId!==t[s].dataSourceId))),s},this.isPopulatedView=e=>(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID,this.isSelectionView=e=>(null==e?void 0:e.dataViewId)===s.CONSTANTS.SELECTION_DATA_VIEW_ID,this.isDefaultView=e=>(null==e?void 0:e.dataViewId)===Kt||(null==e?void 0:e.dataViewId)===s.CONSTANTS.OUTPUT_DATA_VIEW_ID,this.isCommonView=e=>(null==e?void 0:e.dataViewId)&&!this.isPopulatedView(e)&&!this.isSelectionView(e)&&!this.isDefaultView(e),this.getOneDefaultUseDs=(e,t,s)=>{const a=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,t,s);let i=[];i=this.props.defaultDataViewPriority===Gt.Second?[this.isCommonView,this.isDefaultView,this.isSelectionView,this.isPopulatedView]:[this.isPopulatedView,this.isCommonView,this.isSelectionView,this.isDefaultView];const o=Object.values(a).find((e=>e.some((e=>i[0](e)))))||Object.values(a).find((e=>e.some((e=>i[1](e)))))||Object.values(a).find((e=>e.some((e=>i[2](e)))))||Object.values(a).find((e=>e.some((e=>i[3](e)))))||Object.values(a)[0];return o?o.find((e=>i[0](e)))||o.find((e=>i[1](e)))||o.find((e=>i[2](e)))||o.find((e=>i[3](e)))||o[0]:null},this.getSelectedUseDsFromProps=(e,t,a,i,o)=>{var r,l;const n=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,a,o),d=this.getOneDefaultUseDs(e,a,o);return t?i?null===(r=n[t.mainDataSourceId])||void 0===r?void 0:r.find((e=>e.dataViewId===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)):t.dataViewId?t:null===(l=n[t.mainDataSourceId])||void 0===l?void 0:l.find((e=>e.dataViewId===Kt)):d},this.getWhetherUseRepeatedDataSourceContext=(e,t,a,i)=>{var o,r,l,n,d;const c=(null===(o=null===window||void 0===window?void 0:window.jimuConfig)||void 0===o?void 0:o.isBuilder)?null===(l=null===(r=(0,s.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder)||void 0===l?void 0:l.appConfig:null===(n=(0,s.getAppStore)().getState())||void 0===n?void 0:n.appConfig;if(!(c&&e&&t&&0!==t.length&&a&&i))return!1;const p=Ve.searchUtils.getParentWidgetIdOfContent(c,e,s.LayoutItemType.Widget,i),u=c.widgets[p],h=u&&(null===(d=u.manifest.properties)||void 0===d?void 0:d.canProvideRepeatDataSource);let m=!1;for(let e=0;e<t.length;e++){const s=this.getRealUseDataSources(t[e],a);if(m=(null==u?void 0:u.useDataSources)&&u.useDataSources.some((e=>(null==s?void 0:s.dataSourceId)===e.dataSourceId)),m)break}return h&&m},this.groupUseDataSourcesByMainDsAndAddAutoViews=(e,t,a)=>{if(!a||!t||0===t.length)return{};const i={};return t.forEach((e=>{if(i[e.mainDataSourceId]||(i[e.mainDataSourceId]=[]),!i[e.mainDataSourceId].some((t=>t.dataSourceId===e.dataSourceId)))if(e.dataViewId||e.dataSourceId!==e.mainDataSourceId)i[e.mainDataSourceId]=i[e.mainDataSourceId].concat(e);else{const t=e.set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(e.mainDataSourceId,Kt)).set("dataViewId",Kt);i[e.mainDataSourceId]=i[e.mainDataSourceId].concat(t)}})),Object.keys(i).forEach((s=>{i[s]=i[s].concat(this.getAutoAddedDataViews(e,i[s],t,a))})),i},this.getAutoAddedDataViews=(e,t,a,i)=>{if(!t||0===t.length||!i)return[];const o=s.DataSourceManager.getInstance().getDataSource(t[0].mainDataSourceId);if(!o||o.isDataSourceSet)return[];let r=[];if(this.props.useSelectionDataView&&!t.some((e=>e.dataViewId===s.CONSTANTS.SELECTION_DATA_VIEW_ID))){const e=t[0].set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,s.CONSTANTS.SELECTION_DATA_VIEW_ID)).set("dataViewId",s.CONSTANTS.SELECTION_DATA_VIEW_ID);r=r.concat(e)}if(this.props.usePopulatedDataView&&this.getWhetherUseRepeatedDataSourceContext(e,t,a,i)){const e=t[0].set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)).set("dataViewId",s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID);r=r.concat(e)}return r},this.getDsLabel=(e,t)=>{if(t&&t===s.CONSTANTS.SELECTION_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:D.defaultMessages.selectionDataView});if(t&&t===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"populatedDataView",defaultMessage:D.defaultMessages.populatedDataView});if(t&&(t===Kt||t===s.CONSTANTS.OUTPUT_DATA_VIEW_ID))return this.props.intl.formatMessage({id:"default",defaultMessage:D.defaultMessages.default});const a=s.DataSourceManager.getInstance().getDataSource(e);return a?a.getLabel()||a.id:e},this.getRealUseDataSources=(e,t)=>{if(!e)return null;if(e.dataViewId===Kt)return e.set("dataSourceId",e.mainDataSourceId).without("dataViewId");if(e.dataViewId===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID){const a=t.find((t=>t.mainDataSourceId===e.mainDataSourceId));return a&&(0,s.Immutable)(a)}return e},this.onMainDataChange=e=>{const t=e.target.value;if(t!==this.props.selectedUseDataSource.mainDataSourceId){const e=(0,s.Immutable)(this.props.useDataSources.find((e=>e.mainDataSourceId===t))||{dataSourceId:t,mainDataSourceId:t});this.props.onChange(e,this.props.isSelectedFromRepeatedDataSourceContext)}},this.onDataViewChange=e=>{if(!this.props.selectedUseDataSource)return;const t=e.target.value,a=this.props.selectedUseDataSource.set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(this.props.selectedUseDataSource.mainDataSourceId,t)).set("dataViewId",t);this.props.onChange(this.getRealUseDataSources(a,this.props.useDataSources),(null==a?void 0:a.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidMount(){if(!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidUpdate(e){if(e.widgetId!==this.props.widgetId||!this.getWhetherUseDsIsShallowEqual(e.useDataSources,this.props.useDataSources)||e.browserSizeMode!==this.props.browserSizeMode||!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===s.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}render(){var e;if(!this.props.useDataSources)return null;const t=this.groupUseDataSourcesByMainDsAndAddAutoViews(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode),a=this.getSelectedUseDsFromProps(this.props.widgetId,this.props.selectedUseDataSource,this.props.useDataSources,this.props.isSelectedFromRepeatedDataSourceContext,this.props.browserSizeMode);return(0,s.jsx)("div",{className:(0,s.classNames)("w-100",{[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:"component-main-data-and-view"},!this.props.hideMainDataSourceSelect&&(0,s.jsx)("div",{className:"w-100 text-truncate mb-12 option-label mb-2"},this.props.intl.formatMessage({id:"data",defaultMessage:D.defaultMessages.data})),!this.props.hideMainDataSourceSelect&&(0,s.jsx)("div",{className:"flex-grow-1"},(0,s.jsx)(D.Select,{value:null==a?void 0:a.mainDataSourceId,className:"select-max-width text-truncate jimu-outline-inside",onChange:this.onMainDataChange,size:"sm"},Object.keys(t).sort(((e,t)=>null==e?void 0:e.localeCompare(t))).map(((e,t)=>(0,s.jsx)("option",{value:e,key:t,className:"select-max-width text-truncate"},this.getDsLabel(e)))))),(0,s.jsx)("div",{className:(0,s.classNames)("flex-grow-1",{"mt-2":!this.props.hideMainDataSourceSelect})},(0,s.jsx)(D.Select,{value:null==a?void 0:a.dataViewId,className:"select-max-width text-truncate jimu-outline-inside",onChange:this.onDataViewChange,size:"sm"},null===(e=t[null==a?void 0:a.mainDataSourceId])||void 0===e?void 0:e.sort(((e,t)=>{var s;return null===(s=null==e?void 0:e.dataSourceId)||void 0===s?void 0:s.localeCompare(null==t?void 0:t.dataSourceId)})).map(((e,t)=>(0,s.jsx)("option",{value:e.dataViewId,key:t,className:"select-max-width text-truncate"},this.getDsLabel(e.dataSourceId,e.dataViewId))))))))}}const Xt=s.ReactRedux.connect(((e,t)=>{var s,a;return{browserSizeMode:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.browserSizeMode:null==e?void 0:e.browserSizeMode}}))(Qt),Yt=(0,s.injectIntl)((0,g.withStyles)(Xt,"MainDataAndViewSelector"));class es extends s.React.PureComponent{constructor(e){super(e),this.getWhetherArrayIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some(((e,s)=>e!==t[s]))),s},this.getDefaultSelectedDs=(e,t)=>this.hasSelectedFields()||this.props.isDataSourceDropDownHidden?this.getDsFromSelectedFieldsAndUseDss(e,t):null,this.hasSelectedFields=()=>!!this.props.selectedFields&&(Array.isArray(this.props.selectedFields)?this.props.selectedFields.length>0:"object"==typeof this.props.selectedFields&&Object.values(this.props.selectedFields).every((e=>e&&e.length>0))),this.getDsFromSelectedFieldsAndUseDss=(e,t)=>{let a;if(t&&e)if(this.getAreFromMultipleDss(e,t)){const e=Object.keys(this.props.selectedFields)[0];if(e.split("-").reverse()[0]===s.CONSTANTS.SELECTION_DATA_VIEW_ID){const t=s.DataSourceManager.getInstance().getDataSource(e),i=t&&t.getMainDataSource(),o=i&&i.id;a=this.props.dataSources.some((e=>e&&e.getMainDataSource().id===o))?t:null}else a=this.props.dataSources.find((t=>t&&t.id===e))}else a=e[0];else e&&(a=e[0]);return a},this.getAreFromMultipleDss=(e,t)=>t?!Array.isArray(t):(null==e?void 0:e.length)>1,this.getDsLabel=e=>e&&e.getDataSourceJson()&&(e.getLabel()||e.id)||"",this.getSelectedFieldsJimuName=(e,t,a,i)=>{if(!e||!e.id||!a)return(0,s.Immutable)([]);const o=this.getAreFromMultipleDss(t,a)?(0,s.Immutable)(a[e.id]):a;return o?i?o:o.slice(0,1):(0,s.Immutable)([])},this.getSelectedUseDataSource=()=>this.state.selectedDs?this.getUseDataSources([this.state.selectedDs])[0]:null,this.getWhetherJimuNameIsInHiddenFields=e=>{var t;let a=!1;if(this.props.hiddenFields){const i=this.getAreFromMultipleDss(this.props.dataSources,this.props.selectedFields);let o=(0,s.Immutable)([]);o=i?this.props.hiddenFields[null===(t=this.state.selectedDs)||void 0===t?void 0:t.id]:this.props.hiddenFields,a=o.some((t=>t===e))}return a},this.getValidFields=e=>{const t=this.getAllFields(e);if(!t)return null;let a;if(this.props.types||this.props.hiddenFields||this.state.searchValue){let e,i,o=(0,s.Immutable)({});Object.keys(t).forEach((s=>{e=t[s].type,i=t[s].alias||t[s].name;const a=!this.props.types||e&&this.props.types&&this.props.types.some((t=>t===e)),r=this.getWhetherJimuNameIsInHiddenFields(s),l=!this.state.searchValue||this.state.searchValue&&i&&i.toLowerCase().includes(this.state.searchValue.toLowerCase());a&&!r&&l&&(o=o.setIn([s],t[s]))})),a=o}else a=t;return a&&this.props.noSelectionItem&&(a=a.set(x,this.getNoSelectionItem())),a},this.getNoSelectionItem=()=>(0,s.Immutable)(Object.assign(Object.assign({},this.props.noSelectionItem),{jimuName:x})),this.getUseDataSources=e=>{if(!e)return null;let t=(0,s.Immutable)([]);return e.forEach((e=>{var s;e&&(t=t.concat({dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(s=e.getRootDataSource())||void 0===s?void 0:s.id}))})),t},this.onSelectedUseDsChange=(e,t)=>{const a=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(this.setState({selectedDs:a,isFromRepeatedDs:t}),this.hasSelectedFields()){const e=this.getSelectedFieldsJimuName(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple).map((e=>{var t;return a&&(null===(t=this.getAllFields(a))||void 0===t?void 0:t[e])})).filter((e=>!!e));this.props.onChange&&this.props.onChange(e.asMutable(),a,t)}},this.onSearchChange=e=>{this.setState({searchValue:e.target.value})},this.onSelectedFieldsChange=e=>{if(e.some((e=>(null==e?void 0:e.jimuName)===x)))return void(this.props.onChange&&this.props.onChange([],this.state.selectedDs,this.state.isFromRepeatedDs));const t=this.getSelectedFieldsJimuName(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple).asMutable(),s=this.getAllFields(this.state.selectedDs);let a=t.map((e=>null==s?void 0:s[e])).filter((e=>e));e.forEach((e=>{e&&(a=t.some((t=>t===e.jimuName))?this.props.isMultiple?a.filter((t=>t.jimuName!==e.jimuName)):[]:this.props.isMultiple?a.concat(e):[e])})),this.props.onChange&&this.props.onChange(a,this.state.selectedDs,this.state.isFromRepeatedDs)},this.state={selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields),searchValue:"",isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext}}componentDidMount(){var e;if(this.props.useDefault&&!this.props.selectedFields){const t=Object.values(null!==(e=this.getValidFields(this.state.selectedDs))&&void 0!==e?e:{})[0];t&&this.props.onChange([t],this.state.selectedDs,this.state.isFromRepeatedDs)}}componentDidUpdate(e,t){var s;if(this.getWhetherArrayIsShallowEqual(this.props.dataSources,e.dataSources)&&this.props.selectedFields===e.selectedFields||this.setState({selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields)}),this.props.useDefault&&!this.props.selectedFields&&t.selectedDs!==this.state.selectedDs){const e=Object.values(null!==(s=this.getValidFields(this.state.selectedDs))&&void 0!==s?s:{})[0];e&&this.props.onChange([e],this.state.selectedDs,this.state.isFromRepeatedDs)}e.isSelectedFromRepeatedDataSourceContext!==this.props.isSelectedFromRepeatedDataSourceContext&&this.setState({isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext})}getAllFields(e){var t;const s=null==e?void 0:e.getSelectedFields(),a=null===(t=null==e?void 0:e.getSchema())||void 0===t?void 0:t.fields,i=a?Object.keys(a).filter((e=>!s.includes(e))):[];return null==a?void 0:a.without(...i)}render(){if(!this.props.dataSources||0===this.props.dataSources.filter((e=>!!e)).length)return console.warn("No data sources"),null;const e=this.getValidFields(this.state.selectedDs),t=this.getSelectedFieldsJimuName(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple),a=this.props.noSelectionItem&&0===t.length?(0,s.Immutable)([this.getNoSelectionItem().jimuName]):t;return(0,s.jsx)("div",{style:this.props.style,className:(0,s.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className})},(0,s.jsx)("div",{className:"component-field-selector w-100 h-100"},this.props.isDataSourceDropDownHidden?null:(0,s.jsx)("div",{className:"ds-name p-3 d-flex justify-content-between align-items-center"},(0,s.jsx)(Yt,{widgetId:this.props.widgetId,useDataSources:this.getUseDataSources(this.props.dataSources),onChange:this.onSelectedUseDsChange,useSelectionDataView:this.props.useSelectionDataView,usePopulatedDataView:this.props.usePopulatedDataView,selectedUseDataSource:this.getSelectedUseDataSource(),isSelectedFromRepeatedDataSourceContext:this.state.isFromRepeatedDs})),this.props.isSearchInputHidden||this.props.useDropdown?null:(0,s.jsx)("div",{className:"d-inline-block w-100 px-3 mb-2 item-selector-search"},(0,s.jsx)(D.TextInput,{placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:s.defaultMessages.search}),onChange:this.onSearchChange,className:"d-inline-block search-input",value:this.state.searchValue,prefix:(0,s.jsx)(Ge,{color:this.props.theme.colors.dark})})),this.props.useDropdown?(0,s.jsx)(qt,{placeholder:this.props.placeholder,ds:this.state.selectedDs,fields:e,selectedFields:a,isMultiple:this.props.isMultiple,isSearchInputHidden:this.props.isSearchInputHidden,onFieldClick:this.onSelectedFieldsChange,theme:this.props.theme,dropdownProps:this.props.dropdownProps,useMultiDropdownBottomTools:this.props.useMultiDropdownBottomTools,intl:this.props.intl}):(0,s.jsx)(zt,{ds:this.state.selectedDs,fields:e,selectedFields:a,intl:this.props.intl,isMultiple:this.props.isMultiple,onFieldClick:this.onSelectedFieldsChange,theme:this.props.theme})))}}const ts=(0,g.withStyles)((0,g.withTheme)((0,s.injectIntl)(es)),"FieldSelector");class ss extends s.React.PureComponent{render(){const e=this.props,{useDataSources:t,dataSources:a}=e,i=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(e,["useDataSources","dataSources"]);return a?s.React.createElement(ts,Object.assign({},this.props)):1===(null==t?void 0:t.length)?s.React.createElement(s.DataSourceComponent,{useDataSource:t[0]},((e,t)=>s.React.createElement(ts,Object.assign({},i,{dataSources:[e]})))):s.React.createElement(s.MultipleDataSourceComponent,{useDataSources:t},((e,t)=>s.React.createElement(ts,Object.assign({},i,{dataSources:e&&Object.values(e)}))))}}(0,g.registerStyles)("jimu-ui/advanced/data-source-selector/",e)})(),d})())}}}));