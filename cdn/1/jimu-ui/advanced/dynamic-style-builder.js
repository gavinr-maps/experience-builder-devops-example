System.register(["jimu-core","jimu-core/emotion","jimu-for-builder","jimu-theme","jimu-ui","jimu-ui/advanced/arcade-content-builder","jimu-ui/basic/color-picker","jimu-ui/basic/list-tree","jimu-ui/basic/sql-expression-runtime"],function(e,t){var n={},o={},i={},s={},l={},a={},r={},c={},u={};return{setters:[function(e){n.AdvancedExpressionPartType=e.AdvancedExpressionPartType,n.ArcadeContentCapability=e.ArcadeContentCapability,n.DataSourceManager=e.DataSourceManager,n.DynamicIconPosition=e.DynamicIconPosition,n.DynamicStyleConditionOperator=e.DynamicStyleConditionOperator,n.DynamicStyleConditionSourceType=e.DynamicStyleConditionSourceType,n.DynamicStyleCustomExpressionSourceType=e.DynamicStyleCustomExpressionSourceType,n.DynamicStyleReferenceValueSourceType=e.DynamicStyleReferenceValueSourceType,n.DynamicStyleSourceType=e.DynamicStyleSourceType,n.DynamicStyleType=e.DynamicStyleType,n.EsriFieldType=e.EsriFieldType,n.ExpressionPartType=e.ExpressionPartType,n.Immutable=e.Immutable,n.JimuFieldType=e.JimuFieldType,n.React=e.React,n.classNames=e.classNames,n.css=e.css,n.dynamicStyleUtils=e.dynamicStyleUtils,n.hooks=e.hooks,n.injectIntl=e.injectIntl,n.lodash=e.lodash,n.utils=e.utils},function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){i.builderAppSync=e.builderAppSync},function(e){s.Global=e.Global,s.useTheme=e.useTheme,s.useTheme2=e.useTheme2,s.withTheme=e.withTheme},function(e){l.Alert=e.Alert,l.AlertPopup=e.AlertPopup,l.Button=e.Button,l.DistanceUnits=e.DistanceUnits,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Label=e.Label,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.Option=e.Option,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.Tab=e.Tab,l.Tabs=e.Tabs,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){a.ArcadeContentBuilder=e.ArcadeContentBuilder},function(e){r.ThemeColorPicker=e.ThemeColorPicker},function(e){c.List=e.List,c.TreeStyle=e.TreeStyle},function(e){u.ClauseInputEditor=e.ClauseInputEditor}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=s},4108:e=>{"use strict";e.exports=i},5286:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 14"><path fill="#FFF" fill-rule="nonzero" d="M10.056 3.165V2.063H2.892l4.215 4.534A.73.73 0 0 1 7.1 7.602L2.93 11.937h7.125v-.666a.732.732 0 0 1 1.463 0v1.397a.733.733 0 0 1-.732.732H1.213a.73.73 0 0 1-.528-1.239l4.88-5.074L.677 1.83A.732.732 0 0 1 1.213.6h9.574c.404 0 .732.328.732.732v1.833a.733.733 0 0 1-1.463 0"></path></svg>'},9869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5M5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 1v9h9V5z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=l},16428:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 2H1v5h14zm-1 1v3H2V3zM5 4H3v1h2zM1 9h14v5H1zm13 4v-3H2v3zm-9-2H3v1h2z" clip-rule="evenodd"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},34963:e=>{"use strict";e.exports=a},54337:e=>{"use strict";e.exports=r},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=o},76117:e=>{"use strict";e.exports=u},79244:e=>{"use strict";e.exports=n},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},93689:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12"><path fill="#FFF" fill-rule="nonzero" d="M3.333 0C2.597 0 2 .597 2 1.333V4c0 .736-.597 1.333-1.333 1.333H0v1.334h.667A1.333 1.333 0 0 1 2 8v2.667C2 11.403 2.597 12 3.333 12h1.334v-1.333H3.333V7.333C3.333 6.597 2.736 6 2 6c.736 0 1.333-.597 1.333-1.333V1.333h1.334V0m4 0C9.403 0 10 .597 10 1.333V4a1.333 1.333 0 0 0 1.333 1.333H12v1.334h-.667A1.333 1.333 0 0 0 10 8v2.667C10 11.403 9.403 12 8.667 12H7.333v-1.333h1.334V7.333C8.667 6.597 9.264 6 10 6a1.333 1.333 0 0 1-1.333-1.333V1.333H7.333V0z"></path></svg>'},98640:e=>{"use strict";e.exports=c}},t={};function d(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,d),i.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";d.r(p),d.d(p,{DynamicStyleBuilder:()=>Me,DynamicStyleBuilderSwitch:()=>Fe});var e=d(67386),t=d(79244),n=d(14321),o=d(1888),i=d(4108),s=d(98640),l=d(23662),a=d.n(l),r=d(62838),c=d.n(r),u=d(9869),m=d.n(u),y=d(93303),b=d.n(y),g=d(28996),h=d.n(g);function f(e){let t=e;return e&&e.asMutable&&(t=e.asMutable({deep:!0})),t}function S(e){return f(e)}function x(e){return null==e||""===e}function C(e){if(!e)return!0;const t=Object.keys(e);return!(t.length>0&&t.some(t=>!x(e[t])))}function v(){const e={refValueInfo:void 0,items:[]};return(0,t.Immutable)(e)}var w=d(21935),j=d.n(w),T=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const I=n=>{const o=window.SVG,{className:i}=n,s=T(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:l,src:j()},s)):(0,e.jsx)("svg",Object.assign({className:l},s))};function D(e,n){let o=!1;const i=R(e),s=R(n);return i&&s&&(o=t.utils.isDeepEqual(i,s)),o}function R(e){let t=null;return e&&(t=e.asMutable?e.asMutable({deep:!0}):e),t}function O(e){let n="";if(e)if(t.dynamicStyleUtils.isArcadeExpression(e))n=e.name;else{const t=e.parts;if((null==t?void 0:t.length)>0){n=t.map(e=>(null==e?void 0:e.exp)||"").join("")}}return n||(n=""),n}const N=t.css`
  .expression-detail {
    position: relative;
    background: var(--sys-color-action-disabled-disabled, #4B4B4B);
    padding: 8px;

    .expression-detail-text {
      color: var(--sys-color-surface-paper-hint, #BDBDBD);
    }

    .refresh-icon {
      position: absolute;
      right: 8px;
      bottom: 8px;
      cursor: pointer;
    }
  }

  .expression-detail.show-refresh-icon {
    .expression-detail-text {
      width: calc(100% - 20px);
    }
  }
`;const k=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.onChange,s=o.widgetDynamicContentCapability,l=o.expressions,a=o.selectedExpression||null,r=t.React.useMemo(()=>{const e=(null==l?void 0:l.length)>=0?S(l):[],t=a?f(a):null,n={finalExpressions:e,selectedIndex:-1,expressionRemoved:!1};if(t)if(e.length>0){const o=e.findIndex(e=>D(e,t));if(o>=0){const i=e.slice();i[o]=t,n.finalExpressions=i,n.selectedIndex=o,n.expressionRemoved=!1}else n.finalExpressions=[t,...e],n.selectedIndex=0,n.expressionRemoved=!0}else n.finalExpressions=[t],n.selectedIndex=0,n.expressionRemoved=!0;else n.finalExpressions=e,n.selectedIndex=-1,n.expressionRemoved=!1;return n},[l,a]),c=t.React.useCallback(e=>{if(i){let t=null;const n=e.target.value;if("string"==typeof n||"number"==typeof n){const e=parseInt(n,10);e>=0&&(t=r.finalExpressions[e])}i(t)}},[r.finalExpressions,i]),u=t.React.useMemo(()=>O(a),[a]),d=t.React.useMemo(()=>{if("single"===s){const e=a||null,n=(null==l?void 0:l.length)>0&&l[0]||null;if(n){if(t.dynamicStyleUtils.getExpressionReturnType(n)){return!D(e,n)}}}return!1},[l,a,s]),p=t.React.useCallback(()=>{const e=(null==l?void 0:l.length)>0&&l[0]||null;if(i){const t=f(e);i(t)}},[l,i]),m=t.hooks.useTranslation(n.defaultMessages),y=m("useLatestExpression"),b=t.React.useMemo(()=>{let e="";return"single"===s?e=m("expressionChangedWarning"):"multiple"===s&&(e=m("expressionRemovedWarning")),e},[m,s]);return(0,e.jsxs)("div",{className:"expression-selector w-100",css:N,children:["multiple"===s&&(0,e.jsx)(n.Select,{className:"expression-list-select mb-2",size:"sm",value:r.selectedIndex,onChange:c,children:r.finalExpressions.map((t,o)=>{const i=t.name||O(t);return(0,e.jsx)(n.Option,{value:o,children:i},o)})}),a&&(0,e.jsxs)("div",{className:(0,t.classNames)(["expression-detail",{"show-refresh-icon":d}]),children:[(0,e.jsx)("div",{className:"expression-detail-text",children:u}),d&&(0,e.jsx)(n.Tooltip,{title:y,children:(0,e.jsx)(n.Button,{className:"refresh-icon",size:"sm",icon:!0,type:"tertiary",target:"_blank",disableHoverEffect:!0,disableRipple:!0,onClick:p,children:(0,e.jsx)(I,{size:16})})})]}),r.expressionRemoved&&(0,e.jsx)(n.Alert,{className:"w-100 mt-2",form:"basic",text:b,type:"warning",withIcon:!0})]})}));var M=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const E=t.css`
  .jimu-dropdown-button {
    background-color: var(--ref-palette-neutral-300, #181818) !important;
    border-color: transparent;
  }

  .jimu-dropdown-button:hover:not([aria-expanded="true"]) {
    border-color: transparent;
  }
`,V=t.css`
  .expression-builder-tab.attribute-tab.hide-ds-view-selector {
    .ds-name {
      padding-bottom: 0 !important;
    }

    .main-data-and-view-selector {
      display: none !important;
    }
  }
`;function F(e){let n=null;const o=null==e?void 0:e.parts;if(1===(null==o?void 0:o.length)){const e=o[0];e&&e.type===t.ExpressionPartType.Field&&(n=e.jimuFieldName)}return n||(n=null),n}const A=(0,o.withTheme)((0,t.injectIntl)(function(i){const s=i.onChange,l=i.expression,a=i.hideDsViewSelector,[r,c]=t.React.useState(!1),u=t.React.useCallback(()=>{c(e=>!e)},[c]),[d,p]=t.hooks.useLoadedModuleComponent("jimu-ui/advanced/expression-builder","AttributeTab"),m=i.expression,y=(null==m?void 0:m.name)||"",b=t.React.useCallback(e=>{const t=F(l)||null;(F(e)||null)!==t&&c(!1),s&&s(e)},[l,s]),{className:g}=i,h=M(i,["className"]);return(0,e.jsxs)(n.Dropdown,{className:(0,t.classNames)(["attribute-dropdown",g]),css:E,activeIcon:!0,size:"sm",menuRole:"dialog",isOpen:r,toggle:u,children:[(0,e.jsx)(o.Global,{styles:V}),(0,e.jsx)(n.DropdownButton,{children:y}),(0,e.jsx)(n.DropdownMenu,{alignment:"start",offsetOptions:[0,4],children:d&&(0,e.jsx)(p,Object.assign({},h,{className:(0,t.classNames)({"hide-ds-view-selector":a}),onChange:b}))})]})}));var B=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const L=t.css`
  .jimu-dropdown-button {
    background-color: var(--ref-palette-neutral-300, #181818) !important;
    border-color: transparent;
  }

  .jimu-dropdown-button:hover:not([aria-expanded="true"]) {
    border-color: transparent;
  }
`,P=t.css`
  .dynamic-style-builder-statistics-dropdown-menu {
    .statistics-tab {
      .main-data-and-view-selector {
        padding-left: 0 !important;
        padding-right: 0 !important;
        padding-top: 0 !important;
      }

      .expression-name {
        display: none;
      }
    }
  }
`;const U=(0,o.withTheme)((0,t.injectIntl)(function(i){const s=i.onChange,[l,a]=t.React.useState(!1),r=t.React.useCallback(()=>{a(e=>!e)},[a]),[c,u]=t.hooks.useLoadedModuleComponent("jimu-ui/advanced/expression-builder","StatisticsTab"),d=i.expression,p=(null==d?void 0:d.name)||"",m=t.React.useCallback(e=>{a(!1),s&&s(e)},[s]),{className:y}=i,b=B(i,["className"]);return(0,e.jsxs)(n.Dropdown,{className:(0,t.classNames)("statistics-dropdown",y),css:L,activeIcon:!0,size:"sm",menuRole:"dialog",isOpen:l,toggle:r,children:[(0,e.jsx)(o.Global,{styles:P}),(0,e.jsx)(n.DropdownButton,{children:p}),(0,e.jsx)(n.DropdownMenu,{alignment:"start",offsetOptions:[0,4],className:"p-4 dynamic-style-builder-statistics-dropdown-menu",style:{width:"205px"},children:c&&(0,e.jsx)(u,Object.assign({},b,{onChange:m}))})]})}));var z=d(93689),q=d.n(z),J=d(5286),_=d.n(J);const H=(0,t.Immutable)([t.JimuFieldType.String,t.JimuFieldType.Number]),G=t.css`
  .expression-icon-dropdown-btn {
    border-right: none !important;
    border-color: none !important;
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
  }

  .attribute-dropdown .jimu-dropdown-button,
  .statistics-dropdown .jimu-dropdown-button {
    border-top-left-radius: 0 !important;
    border-bottom-left-radius: 0 !important;
  }

  .jimu-dropdown-button.expression-icon-dropdown-btn {
    padding-left: 3px !important;
    padding-right: 4px !important;
  }

  .custom-expression-type-dropdown {
    height: 26px;
  }
`;const W=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.onChange,s=o.widgetId,l=o.useDataSources,a=o.hideConditionIndicatorCustomAttributeDsViewSelector,r=o.hideConditionIndicatorCustomStatistics,c=o.expression,u=o.sourceType,d=t.hooks.useTranslation(n.defaultMessages),p=t.React.useMemo(()=>{let e=u;return u?e=u:c&&(t.dynamicStyleUtils.isAttributeExpression(c)?e=t.DynamicStyleCustomExpressionSourceType.CustomAttribute:t.dynamicStyleUtils.isStatisticsExpression(c)&&(e=t.DynamicStyleCustomExpressionSourceType.CustomStatistics)),e||(e=t.DynamicStyleCustomExpressionSourceType.CustomAttribute),e},[c,u]),m=p===t.DynamicStyleCustomExpressionSourceType.CustomAttribute,y=p===t.DynamicStyleCustomExpressionSourceType.CustomStatistics,b=t.React.useMemo(()=>({[t.DynamicStyleCustomExpressionSourceType.CustomAttribute]:{svg:q(),label:d("attribute")},[t.DynamicStyleCustomExpressionSourceType.CustomStatistics]:{svg:_(),label:d("statistics")}}),[d]),g=p&&b[p],h=null==g?void 0:g.svg,[f,S]=t.React.useState(!1),x=t.React.useCallback(()=>{S(e=>!e)},[S]),C=t.React.useCallback((e,t)=>{i&&i(e,t)},[i]),v=t.React.useCallback(e=>{if(e!==p){C(e,null)}},[C,p]),w=t.React.useCallback(e=>{C(p,e)},[C,p]),j=t.React.useCallback(e=>{C(p,e)},[C,p]),T=r?[t.DynamicStyleCustomExpressionSourceType.CustomAttribute]:[t.DynamicStyleCustomExpressionSourceType.CustomAttribute,t.DynamicStyleCustomExpressionSourceType.CustomStatistics];return(0,e.jsxs)("div",{className:"custom-expression d-flex align-items-center w-100",css:G,children:[(0,e.jsxs)(n.Dropdown,{isOpen:f,toggle:x,className:"custom-expression-type-dropdown",children:[(0,e.jsx)(n.DropdownButton,{size:"sm",arrow:!1,dot:!0,icon:!0,className:"expression-icon-dropdown-btn text-truncate d-flex justify-content-center align-items-center trigger-dropdown-toggle p-0 jimu-outline-inside",children:h&&(0,e.jsx)(n.Icon,{icon:h,className:"m-0 p-0",size:13})}),(0,e.jsx)(n.DropdownMenu,{appendToBody:!1,strategy:"fixed",children:T.map(t=>{const o=b[t],i=o.svg,s=o.label;return(0,e.jsxs)(n.DropdownItem,{className:"text-default",a11yFocusBack:!1,onClick:()=>{v(t)},children:[(0,e.jsx)(n.Icon,{icon:i,className:"mr-2",size:13}),(0,e.jsx)("span",{children:s})]},t)})})]}),(0,e.jsxs)("div",{className:"attribute-statistics-dropdown-container w-100",children:[m&&(0,e.jsx)(A,{className:"w-100",useDataSources:l,expression:c,widgetId:s,types:H,hideDsViewSelector:a,onChange:w}),y&&(0,e.jsx)(U,{className:"w-100",useDataSources:l,expression:c,widgetId:s,onChange:j})]})]})})),K=t.css`

`;function $(e,n,o){const i={refValueSourceType:e,expression:n,expressionReturnType:o};return(0,t.Immutable)(i)}const X=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.onChange,s=o.widgetId,l=o.useDataSources,a=o.widgetDynamicContentCapability,r=o.hideConditionIndicatorCustomAttributeDsViewSelector,c=o.hideConditionIndicatorCustomStatistics,u=o.configuredExpressionsLabel,d=o.expressions,p=o.refValueInfo,m=p||$(t.DynamicStyleReferenceValueSourceType.CustomAttribute,null,null),y=m.refValueSourceType,b=m.expression,[g,h]=t.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),f=g&&h?h.SettingSection:null,S=g&&h?h.SettingRow:null,x=f&&S,C=t.hooks.useTranslation(n.defaultMessages),v=C("selectConditionIndicator"),w=C("useAttributeStatistics"),j=u||C("useDynamicContentConfigured"),T=y===t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,I=y===t.DynamicStyleReferenceValueSourceType.CustomAttribute,D=y===t.DynamicStyleReferenceValueSourceType.CustomStatistics,R=a&&T,O=I||D,N=!((null==d?void 0:d.length)>0||R&&b),M=t.React.useCallback(e=>{i&&i(e)},[i]);t.React.useEffect(()=>{if(void 0===p){let e=null;if((null==d?void 0:d.length)>0)if("single"===a){const n=d[0];if(n){const o=t.dynamicStyleUtils.getExpressionReturnType(n);o!==t.JimuFieldType.String&&o!==t.JimuFieldType.Number||(e=$(t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,n,o))}}else"multiple"===a&&(e=$(t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,null,null));M(e)}},[d,M,p,a]);const E=t.React.useCallback(()=>{let e=null;if("single"===a&&(null==d?void 0:d.length)>0){const n=d[0];if(n){const o=t.dynamicStyleUtils.getExpressionReturnType(n);o!==t.JimuFieldType.String&&o!==t.JimuFieldType.Number||(e=$(t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,n,o))}}e||(e=$(t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,null,null)),M(e)},[d,M,a]),V=t.React.useCallback(()=>{const e=$(t.DynamicStyleReferenceValueSourceType.CustomAttribute,null,null);M(e)},[M]),F=t.React.useCallback((e,n)=>{const o=n?(0,t.Immutable)(n):null,i=n&&t.dynamicStyleUtils.getExpressionReturnType(n)||null;if(i===t.JimuFieldType.String||i===t.JimuFieldType.Number||!n){const t=m.set("refValueSourceType",e).set("expression",o).set("expressionReturnType",i);M(t)}},[M,m]),A=t.React.useCallback(e=>{F(t.DynamicStyleReferenceValueSourceType.ImportFromDynamicContent,e)},[F]),B=t.React.useCallback((e,t)=>{F(e,t)},[F]);return x&&(0,e.jsxs)(f,{title:v,className:"select-reference-value",css:K,children:[("single"===a||"multiple"===a)&&(0,e.jsx)(S,{children:(0,e.jsxs)("div",{className:"select-reference-value-radios",children:[(0,e.jsxs)("div",{className:"select-reference-value-radio d-flex",children:[(0,e.jsx)(n.Radio,{id:"select-reference-value-dynamic-content-radio",name:"select-reference-value",disabled:N,checked:R,className:"dynamic-content-radio",onChange:E}),(0,e.jsx)(n.Label,{for:"select-reference-value-dynamic-content-radio",className:"ml-1 dynamic-content-label","aria-label":j,children:j})]}),(0,e.jsxs)("div",{className:"select-reference-value-radio d-flex mt-3",children:[(0,e.jsx)(n.Radio,{id:"select-reference-value-custom-radio",name:"select-reference-value",checked:O,className:"custom-radio",onChange:V}),(0,e.jsx)(n.Label,{for:"select-reference-value-custom-radio",className:"ml-1 custom-label","aria-label":w,children:w})]})]})}),R&&(0,e.jsx)(S,{className:"mt-2",children:(0,e.jsx)(k,{widgetDynamicContentCapability:a,expressions:d,selectedExpression:b,onChange:A})}),O&&(0,e.jsx)(S,{className:"mt-2",children:(0,e.jsx)(W,{widgetId:s,useDataSources:l,sourceType:y,hideConditionIndicatorCustomAttributeDsViewSelector:r,hideConditionIndicatorCustomStatistics:c,expression:b,onChange:B})})]})}));var Z=d(16428),Q=d.n(Z),Y=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const ee=n=>{const o=window.SVG,{className:i}=n,s=Y(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:l,src:Q()},s)):(0,e.jsx)("svg",Object.assign({className:l},s))};const te=(0,o.withTheme)((0,t.injectIntl)(function(o){var i;const s=o.supportedConditionSourceTypes||[],l=null===(i=o.conditionInfo)||void 0===i?void 0:i.sourceType,a=o.onChange,[r,c]=t.React.useState(!1),u=t.React.useCallback(()=>{c(e=>!e)},[c]),d=t.React.useCallback(e=>{e!==l&&a&&a(e)},[a,l]),p=t.hooks.useTranslation(n.defaultMessages),m=p("sourceType"),y=t.React.useMemo(()=>({[t.DynamicStyleConditionSourceType.UserInput]:p("userInput"),[t.DynamicStyleConditionSourceType.Field]:p("field"),[t.DynamicStyleConditionSourceType.Unique]:p("unique"),[t.DynamicStyleConditionSourceType.Statistics]:p("statistics")}),[p]);return(0,e.jsx)("div",{className:"condition-source-type-selector mr-2",children:(0,e.jsxs)(n.Dropdown,{menuRole:"listbox",activeIcon:!0,isOpen:r,toggle:u,"aria-label":m,children:[(0,e.jsx)(n.DropdownButton,{icon:!0,arrow:!1,dot:!0,size:"sm",type:"primary","data-toggle":"dropdown",title:m,children:(0,e.jsx)(ee,{className:"text-default dropdown-icon"})}),(0,e.jsxs)(n.DropdownMenu,{showArrow:!0,strategy:"fixed",alignment:"start",appendToBody:!0,children:[(0,e.jsx)(n.DropdownItem,{header:!0,children:m}),s.map(t=>{const o=y[t]||t;return(0,e.jsx)(n.DropdownItem,{onClick:()=>{d(t)},active:t===l,children:o},t)})]})]})})}));var ne=d(76117);const oe=t.css`
  /* override css of InputEditorRender */
  .input-editor > * {
    width: 100% !important;
  }
`,ie=(0,t.Immutable)([t.JimuFieldType.String]),se=(0,t.Immutable)([t.JimuFieldType.Number]);(0,t.Immutable)([t.JimuFieldType.String,t.JimuFieldType.Number]);const le=(0,o.withTheme)((0,t.injectIntl)(function(n){const o=n.onChange,i=n.widgetId,s=n.useDataSources,l=n.expressionReturnType,a=n.refValueSchemaInfo,r=n.conditionInfo,c=r.sourceType,u=r.valueOptions||((d=null)||(d=null),(p=null)||(p=null),(0,t.Immutable)({value:d,expression:p}));var d,p;const m=(null==u?void 0:u.value)||null,y=(null==u?void 0:u.expression)||null,b=t.React.useMemo(()=>{let e=null;return m&&(e=S(m)),e},[m]),g=t.React.useMemo(()=>{let e=null;return l===t.JimuFieldType.String?e=ie:l===t.JimuFieldType.Number&&(e=se),e||(e=(0,t.Immutable)([])),e},[l]),h=c===t.DynamicStyleConditionSourceType.UserInput||c===t.DynamicStyleConditionSourceType.Unique,f=c===t.DynamicStyleConditionSourceType.Field,x=c===t.DynamicStyleConditionSourceType.Statistics,C=t.React.useCallback(e=>{o&&o(e)},[o]),v=t.React.useCallback(e=>{const n=(null==e?void 0:e.value)||null,o=u.value;if(!t.utils.isDeepEqual(o,n)){const e=u.set("value",n);C(e)}},[u,C]),w=t.React.useMemo(()=>{let e=null;if(h&&a){const n=a.jimuFieldName,o=a.dataSourceForSqlInputEditorRender,i=a.fieldSchema,s=a.codedValues,u=!!n&&(null==s?void 0:s.length)>0,d=function(e,n,o){if(!e||!n)return null;let i=null;return e===t.DynamicStyleConditionOperator.StringOperatorIs||e===t.DynamicStyleConditionOperator.StringOperatorIsNot||e===t.DynamicStyleConditionOperator.NumberOperatorIs||e===t.DynamicStyleConditionOperator.NumberOperatorIsNot||e===t.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan||e===t.DynamicStyleConditionOperator.NumberOperatorIsLessThan?n===t.DynamicStyleConditionSourceType.UserInput?i=o?ne.ClauseInputEditor.SimpleSelect:ne.ClauseInputEditor.TextInput:n===t.DynamicStyleConditionSourceType.Unique&&(i=ne.ClauseInputEditor.SimpleSelect):e===t.DynamicStyleConditionOperator.StringOperatorContains?n===t.DynamicStyleConditionSourceType.UserInput&&(i=o?ne.ClauseInputEditor.SimpleSelect:ne.ClauseInputEditor.TextInput):e===t.DynamicStyleConditionOperator.StringOperatorIsBlank||e===t.DynamicStyleConditionOperator.StringOperatorIsNotBlank?i=ne.ClauseInputEditor.BlankSelector:e===t.DynamicStyleConditionOperator.NumberOperatorIsBetween&&(i=ne.ClauseInputEditor.DoubleNumberSelector),i}(r.operator,r.sourceType,u);if(d){const a={sourceType:c,inputEditor:d,value:b},r={isEmptyOptionHidden:!0};if(n)o&&i&&(e={runtime:!1,fieldObj:i,dataSource:o,codedValues:s,valueOptions:a,customProps:r,onChange:v});else if(d===ne.ClauseInputEditor.TextInput||d===ne.ClauseInputEditor.DoubleNumberSelector){const n=function(e){let n=null;const o="test_field";e===t.JimuFieldType.String?n={jimuName:o,name:o,alias:o,type:e,esriType:t.EsriFieldType.String}:e===t.JimuFieldType.Number&&(n={jimuName:o,name:o,alias:o,type:e,esriType:t.EsriFieldType.String,format:null});let i=null;return n&&(i=(0,t.Immutable)(n)),i}(l);n&&(e={runtime:!1,fieldObj:n,dataSource:null,codedValues:null,valueOptions:a,customProps:r,onChange:v})}}}return e},[r.operator,r.sourceType,c,l,b,v,a,h]),[j,T]=t.hooks.useLoadedModuleComponent("jimu-ui/basic/sql-expression-runtime","InputEditorRender"),I=t.React.useCallback(e=>{const t=u.set("expression",e);C(t)},[u,C]),D=t.React.useCallback(e=>{const t=u.set("expression",e);C(t)},[u,C]);return(0,e.jsxs)("div",{className:"condition-value-editor",css:oe,children:[h&&j&&T&&w&&(0,e.jsx)(T,Object.assign({},w)),f&&(0,e.jsx)(A,{className:"w-100",useDataSources:s,expression:y,widgetId:i,types:g,onChange:I}),x&&(0,e.jsx)(U,{className:"w-100",useDataSources:s,expression:y,widgetId:i,onChange:D})]})})),ae=t.css`
  position: relative;

  .condition-editor-first-row {
    .if-value-label {
      min-width: 30%;
      max-width: 50%;
      white-space: break-spaces;
      word-break: break-word;
    }

    .condition-editor-operators {
      min-width: 50%;
    }
  }

  .condition-editor-second-row {
    /* When the scroll bar appears, the right side of the condition style builder is cut off. Thew following css is used to fix this issue. */
    .condition-value-editor {
      width: calc(100% - 34px);
    }
  }
`;function re(e){if(e){if(!t.dynamicStyleUtils.validateConditionValueOptions(e.operator,e.sourceType,e.valueOptions)){const t=ce(null,null);e=e.set("valueOptions",t)}}return e}function ce(e,n){return e||(e=null),n||(n=null),(0,t.Immutable)({value:e,expression:n})}const ue=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.onChange,s=o.widgetId,l=o.className,a=o.useDataSources,r=o.refValueInfo,c=o.refValueSchemaInfo,u=null==r?void 0:r.expression,d=(null==r?void 0:r.expressionReturnType)||null,p=o.conditionInfo,m=t.React.useMemo(()=>{let e=null;return e=p?(0,t.Immutable)(p):(0,t.Immutable)({operator:null,sourceType:null,valueOptions:null}),e},[p]),y=t.React.useMemo(()=>{let e=[];return d===t.JimuFieldType.String?e=[t.DynamicStyleConditionOperator.StringOperatorIs,t.DynamicStyleConditionOperator.StringOperatorIsNot,t.DynamicStyleConditionOperator.StringOperatorContains,t.DynamicStyleConditionOperator.StringOperatorIsBlank,t.DynamicStyleConditionOperator.StringOperatorIsNotBlank]:d===t.JimuFieldType.Number&&(e=[t.DynamicStyleConditionOperator.NumberOperatorIs,t.DynamicStyleConditionOperator.NumberOperatorIsNot,t.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan,t.DynamicStyleConditionOperator.NumberOperatorIsLessThan,t.DynamicStyleConditionOperator.NumberOperatorIsBetween]),e},[d]),b=m.operator,g=t.React.useMemo(()=>t.dynamicStyleUtils.getSupportedConditionSourceTypesByRefValueExpressionAndOperator(u,b),[u,b]),h=t.hooks.useTranslation(n.defaultMessages),f=h("ifValue"),S=t.React.useMemo(()=>({[t.DynamicStyleConditionOperator.StringOperatorIs]:h("stringOperatorIs"),[t.DynamicStyleConditionOperator.StringOperatorIsNot]:h("stringOperatorIsNot"),[t.DynamicStyleConditionOperator.StringOperatorContains]:h("stringOperatorContains"),[t.DynamicStyleConditionOperator.StringOperatorIsBlank]:h("stringOperatorIsBlank"),[t.DynamicStyleConditionOperator.StringOperatorIsNotBlank]:h("stringOperatorIsNotBlank"),[t.DynamicStyleConditionOperator.NumberOperatorIs]:h("numberOperatorIs"),[t.DynamicStyleConditionOperator.NumberOperatorIsNot]:h("numberOperatorIsNot"),[t.DynamicStyleConditionOperator.NumberOperatorIsGreaterThan]:h("numberOperatorIsGreaterThan"),[t.DynamicStyleConditionOperator.NumberOperatorIsLessThan]:h("numberOperatorIsLessThan"),[t.DynamicStyleConditionOperator.NumberOperatorIsBetween]:h("numberOperatorIsBetween")}),[h]),x=t.React.useCallback(e=>{i&&i(e)},[i]),C=t.React.useCallback(e=>{const n=e.target.value;let o=m.set("operator",n);o=function(e,n){if(n){let{operator:o,sourceType:i}=n;i=i||null;let s=i;const l=t.dynamicStyleUtils.getSupportedConditionSourceTypesByRefValueExpressionAndOperator(e,o);l.includes(i)||(s=l.length>0?l[0]:null),s!==i&&(n=n.set("sourceType",s))}return n}(u,o),o=re(o),x(o)},[m,u,x]),v=t.React.useCallback(e=>{const n=m.sourceType===t.DynamicStyleConditionSourceType.UserInput&&e===t.DynamicStyleConditionSourceType.Unique;let o=m.set("sourceType",e);if(o=re(o),n){const e=ce(null,null);o=o.set("valueOptions",e)}x(o)},[m,x]),w=t.React.useCallback(e=>{const t=m.set("valueOptions",e);x(t)},[m,x]);return(0,e.jsxs)("div",{className:(0,t.classNames)(["condition-editor",l]),css:ae,children:[(0,e.jsxs)("div",{className:"condition-editor-first-row d-flex align-items-center",children:[(0,e.jsx)(n.Label,{className:"if-value-label mr-2 mb-0",children:f}),(0,e.jsx)(n.Select,{className:"condition-editor-operators",size:"sm",value:b,onChange:C,children:y.map(t=>{const o=S[t]||t;return(0,e.jsx)(n.Option,{value:t,children:o},t)})})]}),g.length>0&&(0,e.jsxs)("div",{className:"condition-editor-second-row d-flex align-items-center mt-2",children:[(0,e.jsx)(te,{supportedConditionSourceTypes:g,conditionInfo:m,onChange:v}),(0,e.jsx)(le,{widgetId:s,useDataSources:a,expressionReturnType:d,refValueSchemaInfo:c,conditionInfo:m,onChange:w})]})]})})),de=t.css`
  .background-image, .background-image-fill-type {
    display: none !important;
  }
`;function pe(e){if(!e)return!0;return x(e.color)&&C(e.image)}const me=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.SettingComponentsModule,s=o.StyleSettingComponentsModule,l=o.config,a=l||(0,t.Immutable)({}),r=o.onChange,c=i?i.CollapsableResetPanel:null,u=s?s.BackgroundSetting:null,d=c&&u,p=t.React.useCallback(e=>{r&&r(e)},[r]),m=t.React.useCallback(()=>{p(null)},[p]),y=t.React.useCallback(e=>{if(!e)return;let t=a;for(const n in e)switch(n){case"fillType":t.fillType!==e[n]&&(t=t.set("fillType",e[n]));break;case"color":t=t.set("color",e[n]);break;case"image":t=t.set("image",e[n])}p(t)},[a,p]),b=t.hooks.useTranslation(n.defaultMessages);return(0,e.jsx)("div",{className:"background-editor w-100",css:de,children:d&&(0,e.jsx)(c,{label:b("background"),isEmpty:pe(l),bottomLine:!0,keepMount:!0,onReset:m,children:(0,e.jsx)(u,{background:l,applyDefaultValue:!1,onChange:y})})})})),ye=t.css`
`;const be=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.SettingComponentsModule,s=o.StyleSettingComponentsModule,l=o.config,a=o.config||(0,t.Immutable)({}),r=o.onChange,c=i?i.CollapsableResetPanel:null,u=s?s.TextStyle:null,d=c&&u,p=t.React.useCallback(e=>{r&&r(e)},[r]),m=t.React.useCallback(()=>{p(null)},[p]),y=t.React.useCallback((e,t)=>{const n=a.set(e,t);p(n)},[a,p]),b=t.hooks.useTranslation(n.defaultMessages);return(0,e.jsx)("div",{className:"simple-text-style-editor w-100",css:ye,children:d&&(0,e.jsx)(c,{label:b("textFormat"),isEmpty:C(l),bottomLine:!0,keepMount:!0,onReset:m,children:(0,e.jsx)(u,Object.assign({},l,{applyDefaultValue:!1,onChange:y}))})})}));var ge=d(54337);const he=t.css`
.icon-position-select {
  width: 40%;
  flex-shrink: 1;
}
`;function fe(e){if(!e)return!0;return x(e.data)&&x(e.position)}const Se=(0,o.withTheme)((0,t.injectIntl)(function(i){const s=i.SettingComponentsModule,l=i.StyleSettingComponentsModule,a=(0,o.useTheme)(),r=(0,o.useTheme2)(),c=i.config,u=c||(0,t.Immutable)({}),d=(null==c?void 0:c.data)||null,p=(null==c?void 0:c.position)||null,m=null==c?void 0:c.size,y=isNaN(m)?void 0:m+"px",b=null==c?void 0:c.color,g=i.onChange,h=s?s.CollapsableResetPanel:null,f=s?s.SettingRow:null,S=l?l.InputUnit:null,[x,C]=t.hooks.useLoadedModule("jimu-ui/advanced/resource-selector"),v=C?C.IconPicker:null,w=h&&f&&x&&v,j=t.React.useCallback(e=>{g&&g(e)},[g]),T=t.React.useCallback(()=>{j(null)},[j]),I=t.React.useCallback(e=>{const t=u.set("data",e);j(t)},[u,j]),D=t.React.useCallback(e=>{const t=e.target.value,n=u.set("position",t);j(n)},[u,j]),R=t.React.useCallback(e=>{const t=null==e?void 0:e.distance,n=u.set("size",t);j(n)},[u,j]),O=t.React.useCallback(e=>{const t=u.set("color",e);j(t)},[u,j]),N=t.hooks.useTranslation(n.defaultMessages),k=N("icon"),M=N("position");return(0,e.jsx)("div",{className:"icon-editor w-100",css:he,children:w&&(0,e.jsxs)(h,{label:k,isEmpty:fe(c),bottomLine:!0,keepMount:!0,onReset:T,children:[(0,e.jsx)(f,{label:k,children:(0,e.jsx)(v,{icon:d,configurableOption:"none",onChange:I,"aria-label":k,setButtonUseColor:!1})}),(0,e.jsx)(f,{label:M,children:(0,e.jsx)(n.Select,{className:"icon-position-select","aria-label":M,size:"sm",value:p,onChange:D,children:[t.DynamicIconPosition.Left,t.DynamicIconPosition.Right].map(t=>(0,e.jsx)(n.Option,{value:t,children:N(t.toLowerCase())},t))})}),(0,e.jsxs)(f,{children:[(0,e.jsx)(S,{className:"pr-1",units:[n.DistanceUnits.PIXEL],value:y,applyDefaultValue:!1,placeholder:"##",onChange:R}),(0,e.jsx)(ge.ThemeColorPicker,{specificTheme:r||a,value:b,onChange:O})]})]})})})),xe=t.css`
.style-setting--border-setting {
  > .sides {
    width: 46px;
    height: 46px;
    margin-right: 4px !important;

    .jimu-btn.top, .jimu-btn.bottom {
      width: auto;
      left: 11px;
      right: 11px;
    }

    .jimu-btn.left, .jimu-btn.right {
      height: auto;
      top: 11px;
      bottom: 11px;
    }
  }
}
`;function Ce(e){return!e||C(e.border)&&C(e.borderTop)&&C(e.borderLeft)&&C(e.borderRight)&&C(e.borderBottom)}const ve=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.SettingComponentsModule,s=o.StyleSettingComponentsModule,l=o.config,a=l||(0,t.Immutable)({}),r=o.onChange,c=i?i.CollapsableResetPanel:null,u=s?s.BorderSetting:null,d=c&&u,p=t.React.useCallback(e=>{r&&r(e)},[r]),m=t.React.useCallback(()=>{p(null)},[p]),y=t.React.useCallback(e=>{const t=a.set("border",e).without("borderLeft").without("borderRight").without("borderTop").without("borderBottom");p(t)},[a,p]),b=t.React.useCallback((e,n)=>{const o=a.set(t.lodash.camelCase(`border-${e}`),n).without("border");p(o)},[a,p]),g=t.hooks.useTranslation(n.defaultMessages);return(0,e.jsx)("div",{className:"border-editor w-100",css:xe,children:d&&(0,e.jsx)(c,{label:g("border"),isEmpty:Ce(l),bottomLine:!0,keepMount:!0,onReset:m,children:(0,e.jsx)(u,{applyDefaultValue:!1,value:null==l?void 0:l.border,left:null==l?void 0:l.borderLeft,right:null==l?void 0:l.borderRight,top:null==l?void 0:l.borderTop,bottom:null==l?void 0:l.borderBottom,onChange:y,onSideChange:b})})})})),we=t.css`
.style-editor-setting-row:last-child .dividing-line {
  display: none;
}
`;const je=(0,o.withTheme)((0,t.injectIntl)(function(n){const o=n.onChange,i=n.className,s=n.dynamicStyleTypes,l=t.React.useMemo(()=>{const e=Object.values(t.DynamicStyleType),n=[];return(null==s?void 0:s.length)>0&&s.forEach(t=>{t&&e.includes(t)&&!n.includes(t)&&n.push(t)}),(0,t.Immutable)(n)},[s]),a=n.dynamicStyle||(0,t.Immutable)({}),[r,c]=t.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),u=r&&c?c.SettingRow:null,[d,p]=t.hooks.useLoadedModule("jimu-ui/advanced/style-setting-components"),m=r&&c&&d&&p,y=t.React.useCallback((e,t)=>{let n=a;n=t?n.set(e,t):n.without(e),o&&o(n)},[a,o]),b=t.React.useCallback(e=>{y("background",e)},[y]),g=t.React.useCallback(e=>{y("text",e)},[y]),h=t.React.useCallback(e=>{y("icon",e)},[y]),f=t.React.useCallback(e=>{y("border",e)},[y]);return(0,e.jsx)("div",{className:(0,t.classNames)(["style-editor",i]),css:we,children:m&&(null==l?void 0:l.length)>0&&l.map(n=>{let o=null;return n===t.DynamicStyleType.Background?o=(0,e.jsx)(me,{SettingComponentsModule:c,StyleSettingComponentsModule:p,config:a.background,onChange:b}):n===t.DynamicStyleType.Text?o=(0,e.jsx)(be,{SettingComponentsModule:c,StyleSettingComponentsModule:p,config:a.text,onChange:g}):n===t.DynamicStyleType.Icon?o=(0,e.jsx)(Se,{SettingComponentsModule:c,StyleSettingComponentsModule:p,config:a.icon,onChange:h}):n===t.DynamicStyleType.Border&&(o=(0,e.jsx)(ve,{SettingComponentsModule:c,StyleSettingComponentsModule:p,config:a.border,onChange:f})),(0,e.jsx)(u,{className:"style-editor-setting-row",children:o},n)})})}));var Te=function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function l(e){try{r(o.next(e))}catch(e){s(e)}}function a(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,a)}r((o=o.apply(e,t||[])).next())})};function Ie(){return(0,t.Immutable)({styleSettingsVisible:!1})}function De(e,t){const n=[],o=function(e){const t=e.map(e=>e.id);return t.length>0?Math.max(...t):null}(e);"number"==typeof o&&n.push(o),"number"==typeof t&&n.push(t);let i=null;return i=n.length>0?Math.max(...n)+1:1,Re(i)||(i=null),i}function Re(e){return"number"==typeof e&&e>0&&isFinite(e)&&!isNaN(e)&&Number.isInteger(e)}const Oe=(0,o.withTheme)((0,t.injectIntl)(function(o){var l,r,u,d;const p=o.onChange,y=o.widgetId,g=o.config||v(),f=o.useDataSources,S=o.widgetDynamicContentCapability,C=o.hideConditionIndicatorCustomAttributeDsViewSelector,w=o.hideConditionIndicatorCustomStatistics,j=o.configuredExpressionsLabel,T=o.expressions,I=o.dynamicStyleTypes,D=g.refValueInfo,R=null==D?void 0:D.expression,O=(null==D?void 0:D.expressionReturnType)||null,N=g.items,k=t.React.useMemo(()=>N||(0,t.Immutable)([]),[N]),M=t.React.useRef(null),[E,V]=t.React.useState(!1),F=t.React.useRef(null);F.current=f,t.React.useEffect(()=>{const e=F.current;(null==e?void 0:e.length)>0&&function(e){return Te(this,void 0,void 0,function*(){if((null==e?void 0:e.length)>0){const n=t.DataSourceManager.getInstance(),o=e.map(e=>Te(this,void 0,void 0,function*(){try{yield n.createDataSourceByUseDataSource(e)}catch(t){console.error("dsManager.createDataSourceByUseDataSource() error",e,t)}}));yield Promise.all(o)}})}(e).then(()=>{V(!0)})},[]);const A=t.React.useMemo(()=>"single"===S||"multiple"===S?S:"none",[S]),B=t.React.useMemo(()=>{let e=null;return(null==T?void 0:T.length)>0&&(e=T.filter(e=>{if(e&&function(e){const n=null==e?void 0:e.parts;if((null==n?void 0:n.length)>0)return n.some(e=>{if(e){const n=e.type;if(n===t.ExpressionPartType.Field||n===t.ExpressionPartType.Function||n===t.AdvancedExpressionPartType.Arcade)return!0}return!1});return!1}(e)){const n=t.dynamicStyleUtils.getExpressionReturnType(e);if(n===t.JimuFieldType.String||n===t.JimuFieldType.Number)return!0}return!1})),e||(e=[]),e},[T]),[L,P]=t.hooks.useLoadedModule("jimu-ui/advanced/setting-components"),U=L&&P?P.SettingSection:null,z=L&&P?P.SettingRow:null,q=U&&z,J=t.hooks.useTranslation(n.defaultMessages),_=J("changeIndicatorTypeTitle"),H=J("changeIndicatorTypeDescription"),G=J("styleConditions"),W=t.React.useCallback(e=>{p&&p(e)},[p]),K=t.React.useMemo(()=>function(e){const n={dataSource:null,dataSourceForSqlInputEditorRender:null,jimuFieldName:null,fieldSchema:null,codedValues:null};if(e&&t.dynamicStyleUtils.isAttributeExpression(e)){const o=e.parts||[];if(1===(null==o?void 0:o.length)){const e=o[0];if(e){const o=e.dataSourceId,i=e.jimuFieldName||null;if(n.jimuFieldName=i,i&&o){const e=t.DataSourceManager.getInstance().getDataSource(o);if(e){if(n.dataSource=e,n.dataSourceForSqlInputEditorRender=e,e.isSelectionView&&e.isSelectionView()){const t=e.getMainDataSource();t&&(n.dataSourceForSqlInputEditorRender=t)}if(n.dataSourceForSqlInputEditorRender||(n.dataSourceForSqlInputEditorRender=e),i){const t=e.getSchema();if(t&&t.fields){const e=t.fields,o=(null==e?void 0:e[i])||null;n.fieldSchema=o}const o=n.dataSourceForSqlInputEditorRender;o.getFieldCodedValueList&&(n.codedValues=o.getFieldCodedValueList(i)||null)}}}}}}return n}(R),[R]),$=t.React.useMemo(()=>{let e=null;return(null==I?void 0:I.length)>0&&(e=I),e||(e=(0,t.Immutable)([])),e},[I]),[Z,Q]=t.React.useState(null),Y=t.React.useCallback((e,t)=>{let n=g.set("refValueInfo",e);t&&(n=n.set("items",[])),W(n)},[g,W]),ee=t.React.useCallback(e=>{const t=(null==e?void 0:e.expressionReturnType)||null;if(O&&O!==t&&k.length>0)Q(e);else{Y(e,!1)}},[O,k.length,Y]),te=t.React.useCallback(()=>{if(Z){Y(Z,!0),Q(null)}},[Z,Y]),ne=t.React.useCallback(()=>{Q(null)},[]),oe=t.React.useRef(null),[ie,se]=t.React.useState(null);t.React.useEffect(()=>{y&&i.builderAppSync.publishChangeDynamicStyleStateToApp(y,{conditionId:ie})},[y,ie]),t.hooks.useUnmount(()=>{y&&i.builderAppSync.publishChangeDynamicStyleStateToApp(y,null)});const[le,ae]=t.React.useState((0,t.Immutable)({})),re=t.React.useCallback((e,t)=>{const n=le.set(e,t);ae(n)},[le]),ce=t.React.useCallback((e,t)=>{if("number"==typeof e){const n=k.map(n=>n.id===e?t:n),o=g.set("items",n);W(o)}},[g,k,W]),de=t.React.useMemo(()=>function(e){let n=null;return e===t.JimuFieldType.String?n={operator:t.DynamicStyleConditionOperator.StringOperatorIs,sourceType:t.DynamicStyleConditionSourceType.UserInput,valueOptions:{value:null,expression:null}}:e===t.JimuFieldType.Number&&(n={operator:t.DynamicStyleConditionOperator.NumberOperatorIs,sourceType:t.DynamicStyleConditionSourceType.UserInput,valueOptions:{value:null,expression:null}}),n?(0,t.Immutable)(n):null}(O),[O]),pe=t.React.useCallback((e,n)=>{if(e){const o=De(k,M.current);if(Re(o)){if(M.current=o,e=e.set("id",o),"number"==typeof n&&n>=0&&n<=k.length){const o=k.asMutable({deep:!0}),i=e.asMutable({deep:!0});o.splice(n,0,i);const s=(0,t.Immutable)(o),l=g.set("items",s);W(l)}else{const t=k.concat(e),n=g.set("items",t);W(n)}se(e.id);if(t.dynamicStyleUtils.validateConditionInfo(R,null==e?void 0:e.condition)){const t=Ie().set("styleSettingsVisible",!0);re(e.id,t)}}}},[g,k,R,W,re]),me=t.React.useCallback(()=>{if(de){const e=function(e,n){n||(n=null);const o={id:e,condition:n,style:null};return(0,t.Immutable)(o)}(null,de);e&&pe(e,null)}},[pe,de]),ye=t.React.useCallback(e=>{if("number"==typeof e){if(e===ie&&se(null),e in le){const t=le.without(e);ae(t)}const t=k.filter(t=>t.id!==e),n=g.set("items",t);W(n)}},[le,g,k,ie,W]),be=t.React.useCallback((e,n)=>{var o;const i=null===(o=null==n?void 0:n.props)||void 0===o?void 0:o.itemJsons,s=(null==i?void 0:i.length)>0?i[0]:null;if(s){const o=s.itemKey;if("string"==typeof o){const i=Number(o),s=null==k?void 0:k.find(e=>"number"==typeof e.id&&e.id===i),l=null==s?void 0:s.condition,a=!!l&&t.dynamicStyleUtils.validateConditionInfo(R,l),r=le[i]||Ie();let c=null;if(i!==ie)se(i),a&&(c=r.set("styleSettingsVisible",!0));else{const t=function(e,t,n){var o,i;const s=null===(o=null==t?void 0:t.event)||void 0===o?void 0:o.target,l=null===(i=null==n?void 0:n.dropZoneInteractable)||void 0===i?void 0:i.target;if(!e||!s||!l)return!1;if(!e.contains(s))return!1;const a=l.querySelector(".jimu-tree-item__draggable"),r=l.querySelector(".style-editor"),c=l.querySelector(".condition-editor");if(a&&(a===s||a.contains(s)))return s.classList.contains("jimu-tree-item__title");if(c&&(c===s||c.contains(s))){const e=c.querySelector(".condition-editor-operators"),t=c.querySelector(".condition-editor-second-row");return(!e||e!==s&&!e.contains(s))&&(!t||t!==s&&!t.contains(s))}if(r&&(r===s||r.contains(s)))return!1;return!0}(null==oe?void 0:oe.current,e,n);t&&(r.styleSettingsVisible?(se(null),c=r.set("styleSettingsVisible",!1)):a?c=r.set("styleSettingsVisible",!0):(se(null),c=r.set("styleSettingsVisible",!1)))}c&&c!==r&&re(i,c)}}},[le,k,R,ie,re]),ge=t.React.useCallback((e,n)=>{var o;const i=null===(o=null==n?void 0:n.props)||void 0===o?void 0:o.itemJsons;if((null==i?void 0:i.length)>=2){const e=i[1];if((null==e?void 0:e.length)>0){const n=[];k.forEach(e=>{var t;const o=null===(t=null==e?void 0:e.id)||void 0===t?void 0:t.toString();x(o)||n.push(o)});const o=n.join(","),i=[];e.forEach(e=>{const t=null==e?void 0:e.itemKey;x(t)||i.push(t)});if(i.join(",")!==o){const e={};k.forEach(t=>{const n=null==t?void 0:t.id;x(n)||(e[n]=t)});const n=[];i.forEach(t=>{const o=e[t];o&&n.push(o)});const o=(0,t.Immutable)(n),s=g.set("items",o);W(s)}}}},[g,k,W]),he=t.React.useMemo(()=>{const n=[];return k.forEach(o=>{const{id:i,condition:s,style:l}=o,a=le[i]||Ie(),r=a.styleSettingsVisible,u=t.dynamicStyleUtils.validateConditionInfo(R,null==o?void 0:o.condition),d=(0,e.jsxs)("div",{className:"condition-style-builder-list-item-content w-100",children:[(0,e.jsx)(ue,{widgetId:y,className:(0,t.classNames)(["p-2",{"condition-editor-show-bottom-border":r}]),useDataSources:f,refValueInfo:D,refValueSchemaInfo:K,expressionReturnType:O,conditionInfo:s,onChange:e=>{const n=o.set("condition",e);ce(i,n);const s=t.dynamicStyleUtils.validateConditionInfo(R,e);if(!u&&s){const e=a.set("styleSettingsVisible",!0);re(i,e)}}}),r&&(0,e.jsx)(je,{className:"p-2",dynamicStyleTypes:$,dynamicStyle:l,onChange:e=>{const t=o.set("style",e);ce(i,t)}})]}),p=r?"pressed-setting-icon":"",g={label:J("settings"),iconProps:()=>({icon:b(),size:16,className:p}),action:()=>{const e=a.set("styleSettingsVisible",!a.styleSettingsVisible);re(i,e)}},S={label:J("duplicate"),iconProps:()=>({icon:m(),size:16}),action:()=>{const e=(0,t.Immutable)(o.asMutable({deep:!0})).set("id",null),n=k.findIndex(e=>"number"==typeof e.id&&e.id===i);pe(e,n>=0?n+1:null)}},x={label:J("incompleteCondition"),iconProps:()=>({icon:h(),size:16,color:"var(--sys-color-warning-main)"})},C={label:J("remove"),iconProps:()=>({icon:c(),size:16}),action:()=>{ye(i)}},v=[];u?v.push(g,S,C):v.push(x,g,C);const w="number"==typeof i&&i===ie,j={itemKey:null==i?void 0:i.toString(),isItemSelectable:!0,itemStateChecked:w,itemStateTitle:"",itemStateCommands:v,itemStateExpanded:!0,itemStateDetailVisible:!0,itemStateDetailContent:d};n.push(j)}),n},[pe,le,$,O,k,R,D,K,ye,ie,J,ce,re,f,y]),fe=(null===(d=null===(u=null===(r=null===(l=o.theme)||void 0===l?void 0:l.sys)||void 0===r?void 0:r.color)||void 0===u?void 0:u.primary)||void 0===d?void 0:d.light)||"#00aabb",Se=t.css`
    /* Loading uses absolute position. */
    position: relative;

    .condition-style-list {
      /* When the scroll bar appears, the right side of the condition style builder is cut off. Thew following 4 width:100% is used to fix this issue. */
      .jimu-tree-item__droppable {
        width: 100%;

        .jimu-tree-item__content {
          width: 100%;

          .jimu-tree-item__body {
            width: 100%;

            .jimu-tree-item__detail-line {
              width: 100%;
            }
          }
        }
      }

      .jimu-tree-command-list > button {
        margin: 0 !important;
        padding: 4px;
      }

      .jimu-tree-command-list > button:has(svg.pressed-setting-icon) {
        background: var(--sys-color-action-select-default, #007F94);
      }

      .jimu-tree-item_focused-true .jimu-tree-item__body:after {
        height: 40px;
        bottom: auto;
      }

      .jimu-tree-item_focused-true .condition-editor:after {
        border-left: .125rem solid ${fe};
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
      }

      .jimu-tree-item__body {
        background: transparent !important;

        .jimu-tree-item__main-line, .condition-editor {
          /* TODO: need to replace the color with variable */
          background: #444 !important;
        }

        .style-editor {
          /* TODO: need to replace the color with variable */
          border: 1px solid #444;
          border-top: none;
        }
      }
    }
    `;return(0,e.jsxs)("div",{className:"condition-style-builder h-100",css:Se,children:[E&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(X,{widgetId:y,useDataSources:f,widgetDynamicContentCapability:A,hideConditionIndicatorCustomAttributeDsViewSelector:C,hideConditionIndicatorCustomStatistics:w,configuredExpressionsLabel:j,expressions:B,refValueInfo:D,onChange:ee}),q&&de&&(0,e.jsxs)(U,{title:G,children:[(0,e.jsx)(n.Button,{className:"w-100 text-default set-link-btn",onClick:me,type:"primary",title:J("addStyleCondition"),disabled:!de,children:(0,e.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,e.jsx)(n.Icon,{icon:a(),className:"mr-1",size:14}),J("addStyleCondition")]})}),(0,e.jsx)(s.List,{forwardRef:e=>{oe&&(oe.current=e)},className:"condition-style-list mt-2",treeStyle:s.TreeStyle.Card,dndEnabled:!0,showCheckbox:!1,itemsJson:he,renderOverrideItemDetailToggle:()=>null,onClickItemBody:be,onDidDrop:ge})]}),Z&&(0,e.jsx)(n.AlertPopup,{withIcon:!0,severity:"warning",closable:!1,isOpen:!0,title:_,description:H,onClickOk:te,onClickClose:ne})]}),!E&&(0,e.jsx)(n.Loading,{type:n.LoadingType.Secondary})]})}));var Ne=d(34963);const ke=(0,o.withTheme)((0,t.injectIntl)(function(n){const o=n.onChange,i=n.widgetId,s=n.config,l=n.useDataSources,a=n.dynamicStyleTypes,r=n.useIcons,c=t.React.useCallback(e=>{o&&o(e)},[o]);return(0,e.jsx)(Ne.ArcadeContentBuilder,{className:"arcade-style-builder",capabilities:[t.ArcadeContentCapability.Style],useTitle:!1,widgetId:i,useDataSources:l,dynamicStyleTypes:a,useIcons:r,config:s,onChange:c})}));const Me=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.onChange,s=o.widgetId,l=o.useDataSources,a=o.widgetDynamicContentCapability,r=o.hideConditionIndicatorCustomAttributeDsViewSelector,c=o.hideConditionIndicatorCustomStatistics,u=o.configuredExpressionsLabel,d=o.expressions,p=o.conditionStyleTypes,m=o.arcacdeStyleTypes,y=o.useIconsForArcade,b=o.config||function(){const e={sourceType:t.DynamicStyleSourceType.Condition,conditionConfig:v(),arcadeConfig:null};return(0,t.Immutable)(e)}(),g=b.conditionConfig,h=b.arcadeConfig,f=t.hooks.useTranslation(n.defaultMessages),S=t.React.useCallback(e=>{if(i){const t=b.set("sourceType",e);i(t)}},[b,i]),x=t.React.useCallback(e=>{if(i){const t=b.set("conditionConfig",e);i(t)}},[b,i]),C=t.React.useCallback(e=>{if(i){const t=b.set("arcadeConfig",e);i(t)}},[b,i]),w=b.sourceType===t.DynamicStyleSourceType.Arcade?t.DynamicStyleSourceType.Arcade:t.DynamicStyleSourceType.Condition,j=t.css`
   > .jimu-tabs-nav {
    margin-left: 16px !important;
    margin-right: 16px !important;
   }
  `;return(0,e.jsxs)(n.Tabs,{className:(0,t.classNames)("dynamic-style-builder h-100",o.className),fill:!0,type:"pills",css:j,value:w,onChange:S,children:[(0,e.jsx)(n.Tab,{id:t.DynamicStyleSourceType.Condition,title:f("condition"),children:(0,e.jsx)(Oe,{widgetId:s,useDataSources:l,widgetDynamicContentCapability:a,hideConditionIndicatorCustomAttributeDsViewSelector:r,hideConditionIndicatorCustomStatistics:c,configuredExpressionsLabel:u,expressions:d,dynamicStyleTypes:p,config:g,onChange:x})}),(0,e.jsx)(n.Tab,{id:t.DynamicStyleSourceType.Arcade,title:f("script"),children:(0,e.jsx)(ke,{widgetId:s,useDataSources:l,dynamicStyleTypes:m,useIcons:y,config:h,onChange:C})})]})}));var Ee=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const Ve=n=>{const o=window.SVG,{className:i}=n,s=Ee(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:l,src:b()},s)):(0,e.jsx)("svg",Object.assign({className:l},s))};const Fe=(0,o.withTheme)((0,t.injectIntl)(function(o){const i=o.switchChecked,s=!!o.disabled,l=o.onSwitchChange,[a,r]=t.React.useState(!1),c=t.React.useCallback(()=>{r(!0)},[]),u=t.React.useCallback(()=>{r(!1)},[]),d=t.React.useRef(null),p=[];d.current&&p.push(d.current);const[m,y]=t.hooks.useLoadedModuleComponent("jimu-ui/advanced/setting-components","SidePopper"),b=t.hooks.useTranslation(n.defaultMessages)("dynamicStyle"),g=Object.assign(Object.assign({},o),{className:""});return(0,e.jsxs)("div",{className:(0,t.classNames)("dynamic-style-builder-switch w-100 d-flex align-items-center",o.className),children:[(0,e.jsx)("div",{className:"w-100 text-break text-wrap d-inline","aria-label":b,children:b}),(0,e.jsxs)("div",{className:"d-flex align-items-center ml-auto",children:[i&&(0,e.jsx)(n.Button,{ref:d,className:"p-0",type:"tertiary",size:"sm",disabled:s,disableHoverEffect:!0,disableRipple:!0,onClick:c,children:(0,e.jsx)(Ve,{size:16})}),(0,e.jsx)(n.Switch,{disabled:s,checked:i,onChange:l})]}),!s&&a&&m&&y&&(0,e.jsx)(y,{isOpen:!0,position:"right",toggle:u,trigger:p,title:b,children:(0,e.jsx)(Me,Object.assign({},g))})]})}))})(),p})())}}});