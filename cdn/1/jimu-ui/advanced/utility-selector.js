System.register(["jimu-core","jimu-core/emotion","jimu-for-builder","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/setting-components","jimu-ui/basic/item-selector","jimu-ui/basic/list-tree"],function(e,t){var i={},s={},l={},n={},r={},a={},o={},c={};return{setters:[function(e){i.Immutable=e.Immutable,i.React=e.React,i.ReactRedux=e.ReactRedux,i.SupportedItemTypes=e.SupportedItemTypes,i.SupportedUtilityType=e.SupportedUtilityType,i.UtilityManager=e.UtilityManager,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks},function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){l.getAppConfigAction=e.getAppConfigAction},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Collapse=e.Collapse,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.MultiSelect=e.MultiSelect,n.MultiSelectItem=e.MultiSelectItem,n.Tab=e.Tab,n.Tabs=e.Tabs,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.UrlInput=e.UrlInput,n.defaultMessages=e.defaultMessages},function(e){r.DataSourceTree=e.DataSourceTree},function(e){a.SidePopper=e.SidePopper},function(e){o.ItemSelector=e.ItemSelector,o.ItemSelectorMode=e.ItemSelectorMode},function(e){c.List=e.List,c.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={2077:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M13.714 5.823v4.97c0 .914-.36 1.789-1.004 2.434a3.42 3.42 0 0 1-4.848 0 3.45 3.45 0 0 1-1.004-2.433V5.44c0-.507-.201-.993-.558-1.352a1.9 1.9 0 0 0-2.694 0 1.92 1.92 0 0 0-.558 1.352v5.1a2.302 2.302 0 0 1 .712 3.918 2.282 2.282 0 0 1-3.727-1.366 2.3 2.3 0 0 1 .281-1.55 2.3 2.3 0 0 1 1.21-1.001v-5.1c0-.914.362-1.789 1.005-2.434a3.42 3.42 0 0 1 4.848 0A3.45 3.45 0 0 1 8.381 5.44v5.353c0 .507.201.993.558 1.352a1.9 1.9 0 0 0 2.694 0c.357-.359.558-.845.558-1.352v-4.97H9.905L12.953 2 16 5.823z"></path></svg>'},4108:e=>{"use strict";e.exports=l},8461:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M10 5a2 2 0 1 0 0-4 2 2 0 0 0 0 4M2 15a2 2 0 1 0 0-4 2 2 0 0 0 0 4M16 13a2 2 0 1 1-4 0 2 2 0 0 1 4 0M3.2 9.638 7.006 5l1.546 1.269-3.806 4.638zM13.594 9.222 12.2 6l-1.835.794 1.393 3.222zM10.5 12h-5v2h5z"></path></svg>'},13089:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=n},22185:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2V4a2 2 0 0 1 2-2h8a2 2 0 0 0-2-2z"></path><path fill="#000" fill-rule="evenodd" d="M6 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm5.489 2.938Q10.31 5.759 8.66 6.062a.402.402 0 0 0-.212.68l1.619 1.618a.4.4 0 0 1 0 .569l-1.138 1.138a.4.4 0 0 1-.569 0L6.742 8.448a.402.402 0 0 0-.68.212q-.303 1.65.876 2.829a3.22 3.22 0 0 0 3.532.688l1.588 1.587a.805.805 0 0 0 1.137 0l.57-.569a.805.805 0 0 0 0-1.137l-1.588-1.588a3.22 3.22 0 0 0-.688-3.532" clip-rule="evenodd"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},56074:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.6 6.188V1.824h-2.4v2.14L8 1 0 8.412h2.4V13H1v2h14v-2h-1.4V8.412H16zM10 9v3H6V9z" clip-rule="evenodd"></path></svg>'},56340:e=>{"use strict";e.exports=o},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},64811:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M7.5 4.5a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3z" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=s},70751:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5.736 1c.424 0 .832.184 1.136.516L8 2.75h6.4c.88 0 1.6.788 1.6 1.75v8.75c0 .963-.72 1.75-1.6 1.75H1.6C.72 15 0 14.213 0 13.25l.008-10.5C.008 1.788.72 1 1.6 1zm.144 4.922A2.94 2.94 0 0 1 8 5a2.94 2.94 0 0 1 2.12.922c.563.589.88 1.388.88 2.22 0 .681-.211 1.344-.604 1.886l-.095.128L8 13l-2.3-2.842c-.014-.017-.096-.13-.096-.13A3.2 3.2 0 0 1 5 8.144c0-.833.317-1.632.88-2.221m1.514 3.171c.18.126.39.193.606.193.29 0 .566-.121.771-.335a1.182 1.182 0 0 0 .136-1.443 1.1 1.1 0 0 0-.49-.421C8.218 7 8 6.977 7.787 7.022a1.08 1.08 0 0 0-.558.313 1.16 1.16 0 0 0-.299.585c-.042.222-.02.451.062.66.083.209.223.388.402.513" clip-rule="evenodd"></path></svg>'},72259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0m1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8" clip-rule="evenodd"></path></svg>'},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=a},82334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M5.6 11.2h4.8v1.6H5.6zm10.4 0h-2.4v3.2A1.6 1.6 0 0 1 12 16H4a1.6 1.6 0 0 1-1.6-1.6v-3.2H0V5.6A1.6 1.6 0 0 1 1.6 4h.8V1.6A1.6 1.6 0 0 1 4 0h8a1.6 1.6 0 0 1 1.6 1.6V4h.8A1.6 1.6 0 0 1 16 5.6zM4 4h8V1.6H4zm8 5.6H4v4.8h8zm2.4-2.8a1.203 1.203 0 0 0-1.2-1.2 1.2 1.2 0 1 0 1.2 1.2"></path></svg>'},84209:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M7.2 4a.8.8 0 1 1 1.6 0v3.2H12a.8.8 0 0 1 0 1.6H8.8V12a.8.8 0 0 1-1.6 0V8.8H4a.8.8 0 1 1 0-1.6h3.2z" clip-rule="evenodd"></path></svg>'},85007:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4.751a2 2 0 0 0-.495-1.317L12.098.683A2 2 0 0 0 10.592 0zm3.325 3.077Q8.388 2.7 9.861 4.172a4.02 4.02 0 0 1 .86 4.416l1.985 1.984c.392.393.392 1.03 0 1.422l-.712.712a1.006 1.006 0 0 1-1.422 0L8.588 10.72a4.02 4.02 0 0 1-4.416-.86Q2.7 8.388 3.077 6.325a.503.503 0 0 1 .85-.265L5.95 8.083a.503.503 0 0 0 .711 0l1.422-1.422a.503.503 0 0 0 0-.71L6.06 3.926a.503.503 0 0 1 .265-.85" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=c}},t={};function u(i){var s=t[i];if(void 0!==s)return s.exports;var l=t[i]={exports:{}};return e[i](l,l.exports,u),l.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";u.r(p),u.d(p,{AddUtilityTabs:()=>qe,UtilityIcon:()=>F,UtilitySelector:()=>rt,addNewUtility:()=>K,extractService:()=>b,selectUtilitySVG:()=>Q});var e=u(67386),t=u(79244),i=u(4108),s=u(98640),l=u(14321),n=u(79298),r=u(13089),a=u(22185),o=u.n(a),c=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const d=i=>{const s=window.SVG,{className:l}=i,n=c(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:o()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var m=u(45508),v=u.n(m),y=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const g=i=>{const s=window.SVG,{className:l}=i,n=y(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:v()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var f=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const h=[{name:"printTask",type:t.SupportedUtilityType.Printing},{name:"geometry",type:t.SupportedUtilityType.Geometry},{name:"geoenrichment",type:t.SupportedUtilityType.GeoEnrichment},{name:"route",type:t.SupportedUtilityType.Routing},{name:"geocode",dynamic:!0,type:t.SupportedUtilityType.GeoCoding}];function b(e,t,i,s,l){const n=[];return h.forEach(r=>{const a=e[r.name],o=l(r.name);if(r.dynamic){if(Array.isArray(a))n.push({id:r.name,name:r.name,label:o,type:r.type,children:a.map((e,t)=>{var i;const s=x(r.name,e);return{id:`${r.name}_${t}`,name:r.name,type:r.type,index:t,label:null!==(i=e.name)&&void 0!==i?i:e.id,url:e.url,setting:s}}).filter(e=>j(e,t,i,s))});else if(a){const e=x(r.name,a);n.push({id:r.name,name:r.name,label:o,type:r.type,url:a.url,setting:e})}}else if(a){const e=x(r.name,a);n.push({id:r.name,name:r.name,label:o,type:r.type,url:a.url,setting:e})}}),n.filter(e=>e.children?e.children.length>0:j(e,t,i,s))}function x(e,t){if(/rest\/services\/.*\/GeocodeServer/.test(t.url)){const{url:e}=t;return f(t,["url"])}return"printTask"===e?{templates:t.templates}:null}function j(e,t,i,s){const{url:l,label:n}=e,r=null===t||t.includes(e.type),a=!i||n.toLowerCase().includes(i.toLowerCase()),o=!s||s.test(l);return r&&a&&o}var w=u(85007),O=u.n(w),S=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const N=i=>{const s=window.SVG,{className:l}=i,n=S(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:O()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var k=u(70751),I=u.n(k),U=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const T=i=>{const s=window.SVG,{className:l}=i,n=U(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:I()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var C=u(56074),P=u.n(C),R=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const M=i=>{const s=window.SVG,{className:l}=i,n=R(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:P()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var A=u(8461),E=u.n(A),G=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const B=i=>{const s=window.SVG,{className:l}=i,n=G(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:E()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var L=u(82334),z=u.n(L),V=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const H=i=>{const s=window.SVG,{className:l}=i,n=V(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:z()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var D=u(2077),$=u.n(D),_=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const J=i=>{const s=window.SVG,{className:l}=i,n=_(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:$()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var q=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};function F(i){const{type:s}=i,l=q(i,["type"]);switch(s){case t.SupportedUtilityType.GeoEnrichment:return(0,e.jsx)(T,Object.assign({},l));case t.SupportedUtilityType.GeoCoding:return(0,e.jsx)(M,Object.assign({},l));case t.SupportedUtilityType.Geometry:return(0,e.jsx)(B,Object.assign({},l));case t.SupportedUtilityType.Printing:return(0,e.jsx)(H,Object.assign({},l));case t.SupportedUtilityType.Routing:return(0,e.jsx)(J,Object.assign({},l))}return(0,e.jsx)(N,Object.assign({},l))}function Q(e){switch(e){case t.SupportedUtilityType.GeoEnrichment:return I();case t.SupportedUtilityType.GeoCoding:return P();case t.SupportedUtilityType.Geometry:return E();case t.SupportedUtilityType.Printing:return z();case t.SupportedUtilityType.Routing:return $();default:return O()}}function K(e){const s=t.UtilityManager.getInstance().getIdOfOrgUtility(e.name,e.url,e.index,e.label);if(s)return s;const l=(0,i.getAppConfigAction)(),n=t.appConfigUtils.getUniqueId("utility"),r={id:n,type:e.type,name:e.name,label:e.label,url:e.url,source:"org"};return e.setting&&(r.orgSetting=e.setting),e.index>=0&&(r.taskName=e.label,r.index=e.index),l.addUtility(r).exec(),n}function W(e,i){const s=i.map(e=>t.UtilityManager.getInstance().getUtilityJson(e.utilityId)).filter(t=>{if("org"===(null==t?void 0:t.source)){const{name:i,url:s,index:l,taskName:n}=t;return!function(e,t,i,s,l){var n;if(s>=0){const s=e[t];return!!Array.isArray(s)&&s.some(e=>(e.name===l||e.id===l)&&e.url===i)}return(null===(n=e[t])||void 0===n?void 0:n.url)===i}(e,i,s,l,n)}return!1});return s}const X=t.css`
  .utility-item.utility-item-selected {
    border: 1px solid var(--sys-color-primary-light);
    border-radius: 0;
    position: relative;
    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      & > div {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--sys-color-primary-light) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }

  .utility-item-not-matched.utility-item-selected {
    border: 1px solid var(--sys-color-primary-dark);
    border-radius: 0;
  }

  .utility-item-not-matched {
    position: relative;

    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      .icon-container {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--sys-color-primary-dark) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }

  .org-tree {
    height: auto !important;
  }
  .tree-root {
    padding: 0.5rem 0;

  }
`;function Y(s){var n;const{keyword:a,pattern:o,serviceTypes:c,useUtilities:u,isMultiple:p,onChange:m}=s,v=null===(n=(0,t.getAppStore)().getState().portalSelf)||void 0===n?void 0:n.helperServices,[y,f]=t.React.useState([]),[h,x]=t.React.useState(null),j=t.hooks.useTranslation(l.defaultMessages);t.React.useEffect(()=>{f(b(v,c,a,o,j))},[v,c,a,o,j]),t.hooks.useEffectOnce(()=>{const e=W(v,null!=u?u:(0,t.Immutable)([]));x(e)});const w=t.hooks.useEventCallback(e=>{const{children:t}=e;return null!=t?t:[]}),O=t.hooks.useEventCallback(e=>e.label),S=t.hooks.useEventCallback(e=>"root"!==e.id&&!e.children),N=t.hooks.useEventCallback((i,s,l=!1)=>(0,e.jsxs)("div",{className:"w-100 d-flex align-items-center",css:t.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: ${l?"var(--ref-palette-neutral-500)":"transparent"};
          color: var(--ref-palette-neutral-1100);
        `,children:[(0,e.jsx)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100",css:t.css`width: 1.625rem; background-color: var(--sys-color-info-main);`,children:(null==s?void 0:s.children)||"root"===(null==s?void 0:s.id)?(0,e.jsx)(d,{color:"var(--ref-palette-black)",className:"mr-0"}):(0,e.jsx)(F,{type:null==s?void 0:s.type,color:"var(--ref-palette-black)",className:"mr-0"})}),(0,e.jsx)("div",{className:"text-truncate px-1",children:i})]})),k=t.React.useCallback(e=>{const{label:i,index:s,name:l,url:n}=e;let r=-1;return null==u||u.some((e,a)=>{const o=t.UtilityManager.getInstance().getUtilityJson(e.utilityId);if("org"===(null==o?void 0:o.source))if(s>=0){if(o.index>=0&&o.name===l&&o.taskName===i)return r=a,!0}else if(o.name===l&&o.url===n)return r=a,!0;return!1}),r},[u]),I=t.React.useCallback(e=>{if("function"==typeof m){const s=k(e),l=t.UtilityManager.getInstance().getIdOfOrgUtility(e.name,e.url,e.index,e.label),n=null!=u?u:(0,t.Immutable)([]);if(s>=0){if(p&&(m(n.filter((e,t)=>t!==s)),!t.UtilityManager.getInstance().isUtilityUsed(l))){const e=(0,i.getAppConfigAction)(),t=e.appConfig.utilities.without(l);e.updateUtilities(t).exec()}}else if(null!=l)m(p?t.Immutable.set(n,n.length,{utilityId:l}):(0,t.Immutable)([{utilityId:l}]));else{const i=K(e);m(p?t.Immutable.set(n,n.length,{utilityId:i}):(0,t.Immutable)([{utilityId:i}]))}}},[k,u,p,m]),U=t.React.useCallback(i=>{const s=k(i)>=0;return(0,e.jsxs)(l.Button,{type:"tertiary",className:(0,t.classNames)("utility-item text-left w-100",{"utility-item-selected":s}),"aria-checked":s,"aria-label":i.label,title:i.label,onClick:()=>{I(i)},children:[N(i.label,i,!0),s&&(0,e.jsx)("div",{className:"item-active-icon",children:(0,e.jsx)("div",{className:"text-center"})})]})},[k,N,I]);return(0,e.jsxs)("div",{className:"utility-tree w-100 my-4",css:X,children:[(null==h?void 0:h.length)>0&&(0,e.jsxs)("div",{className:"p-2 mb-2",children:[(0,e.jsxs)("div",{className:"d-flex mb-2 justify-content-between align-items-center",children:[(0,e.jsx)("span",{className:"font-13",children:"Expired"}),(0,e.jsx)(l.Tooltip,{title:j("orgUtilityNotAvailable"),children:(0,e.jsx)(l.Button,{type:"tertiary",size:"sm",icon:!0,children:(0,e.jsx)(g,{size:"s"})})})]}),h.map(i=>{var s,n,r,a,o,c;const p=null==u?void 0:u.some(e=>e.utilityId===i.id);return(0,e.jsx)("div",{className:"w-100",children:(0,e.jsxs)(l.Button,{type:"tertiary",className:(0,t.classNames)("utility-item-not-matched jimu-outline-inside text-left p-0 w-100",{"utility-item-selected":p}),"aria-checked":p,"aria-label":null!==(n=null!==(s=i.taskName)&&void 0!==s?s:i.label)&&void 0!==n?n:i.name,title:null!==(a=null!==(r=i.taskName)&&void 0!==r?r:i.label)&&void 0!==a?a:i.name,onClick:()=>{I({name:i.name,url:i.url,index:i.index,label:i.taskName})},children:[N(null!==(c=null!==(o=i.taskName)&&void 0!==o?o:i.label)&&void 0!==c?c:i.name,{type:i.type},!0),p&&(0,e.jsx)("div",{className:"item-active-icon",children:(0,e.jsx)("div",{className:"icon-container"})})]})},i.id)})]}),y.map(t=>(0,e.jsx)("div",{children:(0,e.jsx)(r.DataSourceTree,{className:"org-tree",dataSource:t,getChildDataSources:w,getLabel:O,isNodeSelectable:S,renderSelectableNode:U,renderUnselectableNode:(e,t)=>N(e,t),defaultOpen:!0})},t.id))]})}var Z=function(e,t,i,s){return new(i||(i=Promise))(function(l,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function a(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}o((s=s.apply(e,t||[])).next())})};const ee=t.css`
  .utility-item.utility-item-selected {
    border: 1px solid var(--sys-color-primary-light);
    position: relative;
    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      & > div {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--sys-color-primary-light) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }
  .tree-root {
    padding: 0.5rem 0;
  }
`;function te(i){const{keyword:s,pattern:n,serviceTypes:a,utilities:o,useUtilities:c,isMultiple:u,onUtilitiesChange:p,className:m}=i,[v,y]=t.React.useState([]),g=t.hooks.useCancelablePromiseMaker();t.React.useEffect(()=>{g(function(e,i,s,l){return Z(this,void 0,void 0,function*(){var n,r;const a=[],o=Object.keys(null!=e?e:{}),c=null!==(n=(0,t.getAppStore)().getState().appStateInBuilder.appRuntimeInfo.utilityStates)&&void 0!==n?n:{};for(let n=0;n<o.length;n++){const u=e[o[n]];if("org"===u.source||o[n]in c&&!1===c[o[n]].success)continue;const p=yield t.UtilityManager.getInstance().getUtility(u.id);let d;d=u.portalUrl&&u.itemId?{id:u.id,label:null!==(r=u.label)&&void 0!==r?r:u.sourceLabel,type:u.type,url:p.itemInfo.url}:{id:u.id,label:u.label,type:u.type,url:u.url},p.tasks&&(d.children=p.tasks.filter(e=>e.visible||null==e.visible).map((e,i)=>{var s;return{rootId:u.id,id:`${u.id}_${i}`,task:e.name,type:e.isPrintingTask?t.SupportedUtilityType.Printing:t.SupportedUtilityType.GPTask,label:null!==(s=e.label)&&void 0!==s?s:e.name,url:`${d.url}/${e.name}`}}).filter(e=>j(e,i,s,l))),a.push(d)}return a.filter(e=>e.children?e.children.length>0:j(e,i,s,l))})}(o,a,s,n)).then(e=>{y(e)})},[o,g,a,s,n]);const f=t.hooks.useEventCallback(e=>{const{children:t}=e;return null!=t?t:[]}),h=t.hooks.useEventCallback(e=>e.label),b=t.hooks.useEventCallback(e=>"root"!==e.id&&!e.children),x=t.hooks.useEventCallback((i,s,l=!1)=>(0,e.jsxs)("div",{className:"w-100 d-flex align-items-center",css:t.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: ${l?"var(--ref-palette-neutral-500)":"transparent"};
          color: var(--ref-palette-neutral-1100);
        `,children:[(0,e.jsx)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100",css:t.css`width: 1.625rem; background-color: var(--sys-color-info-main);`,children:(null==s?void 0:s.children)||"root"===s.id?(0,e.jsx)(d,{color:"var(--ref-palette-black)",className:"mr-0"}):(0,e.jsx)(F,{type:null==s?void 0:s.type,color:"var(--ref-palette-black)",className:"mr-0"})}),(0,e.jsx)("div",{className:"text-truncate px-1",children:i})]})),w=t.React.useCallback(e=>{const{id:t,rootId:i,task:s}=e;let l=-1;return null==c||c.some((e,n)=>(e.utilityId===t||e.utilityId===i&&e.task===s)&&(l=n,!0)),l},[c]),O=t.React.useCallback(e=>{var i,s;if("function"==typeof p){const l=w(e),n=null!=c?c:(0,t.Immutable)([]);l>=0?u&&p(n.filter((e,t)=>t!==l)):p(u?t.Immutable.set(n,n.length,{utilityId:null!==(i=e.rootId)&&void 0!==i?i:e.id,task:e.task}):(0,t.Immutable)([{utilityId:null!==(s=e.rootId)&&void 0!==s?s:e.id,task:e.task}]))}},[w,c,u,p]),S=t.React.useCallback(i=>{const s=w(i)>=0;return(0,e.jsxs)(l.Button,{type:"tertiary",className:(0,t.classNames)("utility-item text-left w-100",{"utility-item-selected":s}),"aria-checked":s,"aria-label":i.label,title:i.label,onClick:()=>{O(i)},children:[x(i.label,i,!0),s&&(0,e.jsx)("div",{className:"item-active-icon",children:(0,e.jsx)("div",{className:"text-center"})})]})},[w,x,O]);return(0,e.jsx)("div",{className:(0,t.classNames)("utility-tree w-100",m,{"my-4":!(null==m?void 0:m.includes("my-"))}),css:ee,children:v.map(t=>(0,e.jsx)("div",{children:(0,e.jsx)(r.DataSourceTree,{className:"added-tree",dataSource:t,getChildDataSources:f,getLabel:h,isNodeSelectable:b,renderSelectableNode:S,renderUnselectableNode:(e,t)=>x(e,t),defaultOpen:!0})},t.id))})}var ie=u(56340),se=function(e,t,i,s){return new(i||(i=Promise))(function(l,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function a(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}o((s=s.apply(e,t||[])).next())})};const le={gp:/\/rest\/services\/.*\/GPServer\/?$/,geometry:/\/rest\/services\/.*\/GeometryServer\/?/,geocode:/\/rest\/services\/.*\/GeocodeServer\/?/,geoenrich:/\/rest\/services\/.*\/GeoenrichmentServer\/?/,na:/\/rest\/services\/.*\/NAServer\/?/,gptask:/\/rest\/services\/.*\/GPServer\/.+/};function ne(e){var t;const i=e.match(/\/([\w\s%]*)\/(?:GP|NA|Geoenrichment|Geometry|Geocode)Server\/?([\w\s%]*)?\/?/);return 3===(null==i?void 0:i.length)?decodeURI(null!==(t=i[2])&&void 0!==t?t:i[1]):""}function re(e){return Object.values(le).some(t=>t.test(e))}function ae(e,i){return se(this,void 0,void 0,function*(){var s,l;if(le.gp.test(e))return t.UtilityManager.getGPServerInfo(e,i);const n=yield t.UtilityManager.getServiceInfo(e,i);if(!n)return null;if(le.geometry.test(e))return{type:t.SupportedUtilityType.Geometry,info:n};if(le.geocode.test(e))return{type:t.SupportedUtilityType.GeoCoding,info:n};if(le.geoenrich.test(e))return{type:t.SupportedUtilityType.GeoEnrichment,info:n};if(le.na.test(e)){return{type:"esriNAServerRouteLayer"===n.layerType&&(null===(s=n.supportedTravelModes)||void 0===s?void 0:s.length)>0&&(null===(l=n.networkClasses)||void 0===l?void 0:l.length)>0?t.SupportedUtilityType.Routing:null,info:n}}if(le.gptask.test(e)){return{type:t.UtilityManager.isPrintingTask(n)?t.SupportedUtilityType.Printing:t.SupportedUtilityType.GPTask,info:n}}return{type:null,info:n}})}var oe=u(94064),ce=u.n(oe),ue=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const pe=i=>{const s=window.SVG,{className:l}=i,n=ue(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:ce()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var de=u(30655),me=u.n(de),ve=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const ye=i=>{const s=window.SVG,{className:l}=i,n=ve(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:me()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var ge=u(62838),fe=u.n(ge),he=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const be=i=>{const s=window.SVG,{className:l}=i,n=he(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:fe()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var xe=u(64811),je=u.n(xe),we=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const Oe=i=>{const s=window.SVG,{className:l}=i,n=we(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:je()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var Se=u(72259),Ne=u.n(Se),ke=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const Ie=i=>{const s=window.SVG,{className:l}=i,n=ke(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:Ne()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var Ue=u(73529),Te=u.n(Ue),Ce=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const Pe=i=>{const s=window.SVG,{className:l}=i,n=Ce(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:Te()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var Re=u(26490),Me=u.n(Re),Ae=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const Ee=i=>{const s=window.SVG,{className:l}=i,n=Ae(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:Me()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))},Ge=t.css`
  border-left: 1px solid var(--ref-palette-neutral-700);
  border-bottom: 1px solid var(--ref-palette-neutral-700);
  width: 1.5rem;
  height: 2.1rem;
  position: absolute;
  top: -16px;
  left: 8px;
`;function Be(i){var s,n;const{utility:r,onRemove:a,onChange:o}=i,[c,u]=t.React.useState(!1),[p,m]=t.React.useState(null),[v,y]=t.React.useState(!1),g=t.hooks.useTranslation();t.hooks.useEffectOnce(()=>{t.UtilityManager.getInstance().getUtilityFromJson(r).then(e=>{var t;(null===(t=e.tasks)||void 0===t?void 0:t.length)>0&&m(e.tasks)}).finally(()=>{y(!0)})});const f=t.React.useCallback(()=>{u(!c)},[c]),h=t.React.useCallback(()=>{a(r)},[a,r]),b=t.React.useCallback(e=>{const t=[];p.forEach(i=>{i.name===e.name?t.push(Object.assign(Object.assign({},i),{visible:null!=i.visible&&!i.visible})):t.push(i)}),m(t);const i=r.set("tasks",t);o(i)},[p,r,o]);return v?(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)("div",{className:"w-100 d-flex align-items-center mb-2 pl-4",css:t.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: var(--ref-palette-neutral-500);
          color: var(--ref-palette-neutral-1100);
          position: relative;
        `,children:[(0,e.jsxs)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100",children:[(null==p?void 0:p.length)>0&&(0,e.jsx)(l.Button,{className:"px-0",type:"tertiary",icon:!0,size:"sm",onClick:f,css:t.css`
                position: absolute;
                left: 0;
              `,children:c?(0,e.jsx)(Ie,{size:"s"}):(0,e.jsx)(Oe,{size:"s"})}),(0,e.jsx)("div",{className:"utility-icon-container",children:(null==p?void 0:p.length)>0?(0,e.jsx)(d,{color:"var(--ref-palette-black)"}):(0,e.jsx)(N,{color:"var(--ref-palette-black)"})})]}),(0,e.jsx)("div",{className:"text-truncate px-2",title:null!==(s=r.label)&&void 0!==s?s:r.sourceLabel,children:null!==(n=r.label)&&void 0!==n?n:r.sourceLabel}),(0,e.jsx)(l.Button,{className:"ml-auto",type:"tertiary",icon:!0,size:"sm",onClick:h,children:(0,e.jsx)(be,{})})]}),(null==p?void 0:p.length)>0&&(0,e.jsx)(l.Collapse,{isOpen:c,children:p.map(i=>(0,e.jsxs)("div",{className:"d-flex align-items-center mb-2",css:t.css`padding-left: 2rem; position: relative;`,children:[(0,e.jsx)("div",{className:"utility-icon-container mr-2",children:(0,e.jsx)(N,{color:"var(--ref-palette-black)"})}),(0,e.jsx)("div",{className:"text-truncate",title:i.name,children:i.name}),(0,e.jsx)(l.Button,{type:"tertiary",title:null==i.visible||i.visible?g("invisible"):g("visible"),"aria-label":null==i.visible||i.visible?g("invisible"):g("visible"),className:"p-0 ml-auto utility-tasks align-items-center",onClick:()=>{b(i)},children:null==i.visible||i.visible?(0,e.jsx)(Pe,{}):(0,e.jsx)(Ee,{})}),(0,e.jsx)("div",{className:"collapse-line",css:Ge})]},i.name))})]}):(0,e.jsx)("div",{className:"loading-container",children:(0,e.jsx)(l.Loading,{type:l.LoadingType.Bar})})}const Le=t.css`
  max-height: 300px;
  background-color: var(--ref-palette-neutral-500);

  .item-list {
    max-height: 180px;
    overflow: auto;
  }

  .utility-icon-container {
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;
    background-color: var(--sys-color-info-main);
    width: 1.625rem;
    height: 1.625rem;
    margin-right: 8px;
    svg {
      margin-right: 0 !important;
    }
  }
`;function ze(i){const{utilities:s,onDoneClick:n,onChange:r}=i,a=t.hooks.useTranslation(l.defaultMessages),[o,c]=t.React.useState(!1),u=t.React.useCallback(()=>{c(!o)},[o]),p=t.React.useCallback(e=>{r(s.filter(t=>t.id!==e.id))},[r,s]),d=t.React.useCallback(e=>{const i=s.findIndex(t=>t.id===e.id);r(t.Immutable.set(s,i,e))},[r,s]);return s?(0,e.jsxs)("div",{className:"w-100 p-4 shadow-3",css:Le,children:[(0,e.jsxs)("div",{className:"new_utility_header d-flex align-items-center",children:[(0,e.jsxs)("div",{className:"font-13",children:[(0,e.jsx)("span",{children:s.length}),(0,e.jsx)("span",{className:"ml-1",children:a("selected")})]}),(0,e.jsx)(l.Button,{className:"ml-2",type:"tertiary",icon:!0,size:"sm",onClick:u,children:o?(0,e.jsx)(pe,{}):(0,e.jsx)(ye,{})}),!o&&(0,e.jsx)(l.Button,{className:"ml-auto",type:"primary","aria-label":a("done"),onClick:n,children:a("done")})]}),(0,e.jsx)(l.Collapse,{isOpen:o,children:(0,e.jsx)("div",{className:"my-4 item-list",children:s.map((t,i)=>(0,e.jsx)(Be,{utility:t,onChange:d,onRemove:p},i))})}),o&&(0,e.jsx)(l.Button,{className:"w-100",type:"primary","aria-label":a("done"),onClick:n,children:a("done")})]}):null}var Ve=function(e,t,i,s){return new(i||(i=Promise))(function(l,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function a(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?l(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}o((s=s.apply(e,t||[])).next())})};const He=(0,t.Immutable)([t.SupportedItemTypes.GeocodingService,t.SupportedItemTypes.GeometryService,t.SupportedItemTypes.GeoprocessingService,t.SupportedItemTypes.NetworkAnalysisService]);function De(){return t.appConfigUtils.getUniqueId("utility")}const $e=new Map,_e=new Map,Je=(0,t.Immutable)({});function qe(i){const{utilities:s=Je,onChange:n,batchUtilityJsons:r,onBatchUpdate:a,onBatchDone:o,isMultiple:c=!0,immediate:u=!0}=i,[p,d]=t.React.useState(""),[m,v]=t.React.useState(!1),[y,g]=t.React.useState({show:!1,msg:null}),[f,h]=t.React.useState(!1),b=t.hooks.useTranslation(l.defaultMessages),x=t.ReactRedux.useSelector(e=>e.portalUrl),j=t.React.useMemo(()=>{const e=[];return Object.keys(s).forEach(t=>{const i=s[t];i.portalUrl&&e.push(i.itemId)}),null==r||r.forEach(t=>{t.portalUrl&&e.push(t.itemId)}),(0,t.Immutable)(e)},[s,r]),w=t.hooks.useEventCallback(e=>{if(/^https:\/\//.test(e)){if(re(e)){return t.UtilityManager.getInstance().urlExist(e)?(v(!1),{valid:!1,msg:b("duplicatedService")}):(v(!0),{valid:!0})}}return v(!1),{valid:!1,msg:b("serviceNotSupported")}}),O=t.hooks.useEventCallback(e=>{d(e.value)}),S=t.React.useCallback(e=>Ve(this,void 0,void 0,function*(){let i=_e.get(e.id),s=!1;return i||(i=yield t.UtilityManager.getInstance().getUrlOfItem(e.portalUrl,e.id),i&&_e.set(e.id,i)),i&&($e.has(i)?$e.get(i).valid&&(s=!0):s=re(i)),s?(g({show:!1,msg:null}),!0):(g({show:!0,msg:b("serviceNotSupported")}),setTimeout(()=>{g({show:!1,msg:null})},3e3),!1)}),[b]),N=t.React.useCallback((e,i)=>Ve(this,void 0,void 0,function*(){var e;const l=_e.get(i.id);if(l&&!$e.has(l))try{const{type:e,info:t}=yield ae(l);if(null==e)throw $e.set(l,{valid:!1}),new Error(`service not supported ${l}`);$e.set(l,{valid:!0,type:e,info:t}),g({show:!1,msg:null})}catch(e){return g({show:!0,msg:b("invalidResourceItem")}),void setTimeout(()=>{g({show:!1,msg:null})},3e3)}if(l&&(null===(e=$e.get(l))||void 0===e?void 0:e.valid)){const{type:e,info:o}=$e.get(l),c={id:De(),sourceLabel:i.title,type:e,source:"custom",itemId:i.id,portalUrl:i.portalUrl,url:l};if(e===t.SupportedUtilityType.GPServer&&(c.tasks=null==o?void 0:o.tasks),u){const e=s.set(c.id,c);n(e)}else c.id=`${Date.now()}`,a(t.Immutable.set(r,r.length,c))}}),[n,a,r,s,u,b]),k=t.React.useCallback((e,t)=>{if(u){const e=Object.keys(s).find(e=>s[e].itemId===t.id&&s[e].portalUrl===t.portalUrl),i=s.without(e);n(i)}else a(r.filter(e=>e.itemId!==t.id))},[n,a,s,r,u]),I=t.React.useCallback(()=>Ve(this,void 0,void 0,function*(){var e,i,l;const o=t.UtilityManager.getInstance().urlExist(p);if(!$e.has(p)){h(!0);try{const{type:e,info:t}=yield ae(p,!0);if(null==e)throw $e.set(p,{valid:!1}),new Error(`service not supported ${p}`);$e.set(p,{valid:!0,type:e,info:t})}catch(e){return g({show:!0,msg:b("invalidResourceItem")}),void setTimeout(()=>{g({show:!1,msg:null})},3e3)}finally{h(!1)}}const c=$e.get(p);if(!o&&(null==c?void 0:c.valid)){const o={id:De(),type:c.type,source:"custom",url:p,label:null!==(i=null===(e=c.info)||void 0===e?void 0:e.displayName)&&void 0!==i?i:ne(p)};if(c.type===t.SupportedUtilityType.GPServer&&(o.tasks=null===(l=c.info)||void 0===l?void 0:l.tasks),u){const e=s.set(o.id,o);n(e)}else o.id=`${Date.now()}`,a(t.Immutable.set(r,r.length,o));d(""),v(!1)}}),[n,a,s,r,u,p,b]);return(0,e.jsxs)("div",{className:"w-100 h-100",css:t.css`position: relative;`,children:[(0,e.jsxs)(l.Tabs,{css:t.css`
          height: ${u?"100%":"calc(100% - 64px)"};
          overflow: hidden;
          .tab-content {
            max-height: calc(100% - 2rem);
          }
        `,type:"underline",fill:!0,children:[(0,e.jsxs)(l.Tab,{id:"layers",title:b("url"),children:[(0,e.jsx)("div",{className:"w-100 pt-4 px-4",css:t.css`
              position: relative;
            `,children:(0,e.jsx)(l.UrlInput,{schemes:["https"],height:80,value:p,placeholder:b("websitePlaceholder"),checkValidityOnChange:w,onChange:O})}),(0,e.jsx)("div",{className:"d-flex px-4 pt-4 flex-column align-items-end",children:(0,e.jsx)(l.Button,{className:"w-100",type:"primary",disabled:!m||f,onClick:I,css:t.css`position: relative;min-height:2rem;`,children:f?(0,e.jsx)(l.Loading,{type:l.LoadingType.DotsSecondary}):b("add")})}),(0,e.jsx)("div",{className:"d-flex px-4 pt-2 flex-column",children:(0,e.jsx)("div",{css:t.css`
              color: var(--ref-palette-neutral-900);
              font-weight: 400;
              font-size: 13px;
              line-height: 18px;
            `,children:b("supportedServices")})})]}),(0,e.jsx)(l.Tab,{id:"widgets",title:b("items"),children:(0,e.jsx)(ie.ItemSelector,{mode:ie.ItemSelectorMode.Simple,itemType:He,portalUrl:x,isMultiple:c,isSelectable:S,onSelect:N,onRemove:k,selectedItems:j,disableRemoveItemsSelectedOnMount:!0})})]}),(0,e.jsxs)("div",{css:t.css`
        position: absolute;
        bottom: 0;
        width: 100%;
      `,children:[y.show&&(0,e.jsx)(l.Alert,{closable:!0,form:"basic",onClose:()=>{g({show:!1,msg:null})},open:!0,text:y.msg,type:"warning",withIcon:!0,className:"w-100"}),(0,e.jsx)(ze,{utilities:r,onChange:a,onDoneClick:o})]})]})}var Fe=u(50170),Qe=u.n(Fe),Ke=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const We=i=>{const s=window.SVG,{className:l}=i,n=Ke(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:Qe()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var Xe=u(28996),Ye=u.n(Xe),Ze=u(84209),et=u.n(Ze),tt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]])}return i};const it=i=>{const s=window.SVG,{className:l}=i,n=tt(i,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",l);return s?(0,e.jsx)(s,Object.assign({className:r,src:et()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))},st={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:s.TreeItemActionType.RenderOverrideItem,children:[{name:s.TreeItemActionType.RenderOverrideItemBody,children:[{name:s.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:s.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:s.TreeItemActionType.RenderOverrideItemTitle},{name:s.TreeItemActionType.RenderOverrideItemCommands}]}]}]})},lt={[t.SupportedUtilityType.GeoCoding]:"geocodingService",[t.SupportedUtilityType.GeoEnrichment]:"geoenrichmentService",[t.SupportedUtilityType.Geometry]:"geometryService",[t.SupportedUtilityType.Printing]:"printingService",[t.SupportedUtilityType.Routing]:"routingService",[t.SupportedUtilityType.GPServer]:"geoprocessingService",[t.SupportedUtilityType.GPTask]:"geoprocessingTask"},nt=Object.keys(lt);function rt(r){const{useUtilities:a,onChange:o,pattern:c,types:u=nt,isMultiple:p=!1,showRemove:d=!0,showOrgUtility:m=!0,closePopupOnSelect:v=!0}=r,y=t.hooks.useTranslation(l.defaultMessages),g=t.ReactRedux.useSelector(e=>{var t,i,s;return window.jimuConfig.isBuilder?null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.utilities:null===(s=e.appConfig)||void 0===s?void 0:s.utilities}),f=t.ReactRedux.useSelector(e=>{var t,i,s;return window.jimuConfig.isBuilder?null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.utilityStates:null===(s=e.appRuntimeInfo)||void 0===s?void 0:s.utilityStates}),h=t.React.useRef(g),b=t.React.useRef(u),[x,j]=t.React.useState(!1),[w,O]=t.React.useState(0),[S,N]=t.React.useState(u),[k,I]=t.React.useState(""),[U,T]=t.React.useState((0,t.Immutable)([])),C=t.React.useRef(void 0),P=t.React.useRef(void 0),R=t.React.useRef(void 0),M=t.React.useCallback((e,t)=>{N(t)},[]);t.React.useEffect(()=>{if(g!==h.current&&(h.current=g,(null==a?void 0:a.length)>0)){const e=[];a.forEach(t=>{g[t.utilityId]&&e.push(t)}),a.length!==e.length&&o((0,t.Immutable)(e))}},[g,a,o]),t.React.useEffect(()=>{let e=!1;e=u.length!==b.current.length||u.some(e=>!b.current.includes(e)),e&&(b.current=u,N(u))},[u]);const A=t.React.useCallback(()=>{j(!x)},[x]),E=t.hooks.useEventCallback(()=>{O(1)}),G=t.hooks.useEventCallback(()=>{O(0)}),B=t.React.useCallback(e=>{o(e),!p&&v&&j(!1)},[o,p,v]),L=t.hooks.useEventCallback(e=>{(0,i.getAppConfigAction)().updateUtilities(e).exec()}),z=t.hooks.useEventCallback(e=>{T(e)}),V=t.React.useCallback(()=>{const e=(0,i.getAppConfigAction)(),s=t.UtilityManager.getInstance();let l=e.appConfig;U.forEach(e=>{if(!e.itemId&&!s.urlExist(e.url)||e.itemId&&!s.itemExist(e.portalUrl,e.itemId)){const i=e.set("id",t.appConfigUtils.getUniqueId("utility"));l=l.setIn(["utilities",i.id],i)}}),e.updateUtilities(l.utilities).exec(),T((0,t.Immutable)([])),G()},[U,G]),H=t.hooks.useEventCallback(e=>{I(e.target.value)}),D=t.React.useCallback(e=>{o(a.filter((t,i)=>i!==e))},[a,o]);return(0,e.jsxs)("div",{className:"px- pb-2 w-100",ref:C,"aria-label":y("selectUtility"),tabIndex:-1,css:t.css`
      .jimu-tree, .jimu-tree-main {
        overflow: visible !important;
      }
      .jimu-tree-item__icon {
        background-color: var(--sys-color-info-main);
        width: 18px;
        height: 18px;
        margin-right: 8px;
        svg {
          margin-right: 0 !important;
        }
      }
    `,children:[(null==a?void 0:a.length)>0&&(0,e.jsx)(s.List,Object.assign({className:"utility-list mb-2",itemsJson:a.map((e,i)=>{var s,l;const n=t.UtilityManager.getInstance().getUtilityJson(e.utilityId),r=[];if(!(null===(l=null===(s=null==f?void 0:f[e.utilityId])||void 0===s?void 0:s.success)||void 0===l||l)){const i=t.UtilityManager.getInstance().utilityHasSignInError(e.utilityId);r.push({label:y(i?"signInErrorDefault":"utilityNotAvailable"),iconProps:()=>({icon:Ye(),size:16,color:"var(--sys-color-warning-dark)"})})}return(p||d)&&r.push({label:y("remove"),iconProps:()=>({icon:fe(),size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;D(+t.itemKey)}}),{itemStateDetailContent:e,itemKey:`${i}`,itemStateIcon:{icon:Q(n.type),color:"var(--ref-palette-black)"},itemStateTitle:null!=n?t.UtilityManager.getInstance().getLabelOfUseUtility(e):e.utilityId,itemStateCommands:r}}),onClickItemBody:A},st)),(p||null==a||0===a.length)&&(0,e.jsx)(l.Button,{className:"w-100",type:"tertiary",onClick:A,disableRipple:!0,css:t.css`
            border: 1px dashed var(--ref-palette-neutral-800);
            &.jimu-btn, &.jimu-btn:hover { color: var(--sys-color-primary-light); background: transparent; }
            &:hover { border: 1px dashed var(--ref-palette-neutral-900); }
          `,ref:P,children:(0,e.jsx)("div",{className:"text-truncate font-weight-500",children:y("selectUtility")})}),(0,e.jsx)(n.SidePopper,{title:y("selectUtility"),position:"right",isOpen:x,toggle:A,trigger:C.current,backToFocusNode:p?P.current:C.current,children:(0,e.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,e.jsx)("div",{className:"px-4 pb-2",css:t.css`height: 50px;`,children:(0,e.jsx)(l.TextInput,{type:"search",prefix:(0,e.jsx)(We,{size:"s"}),value:k,onChange:H,placeholder:y("SearchLabel")})}),u!==nt&&u.length>1&&(0,e.jsxs)("div",{className:"d-flex justify-content-between align-items-center px-4 mb-4",children:[(0,e.jsx)("span",{children:y("type")}),(0,e.jsx)(l.MultiSelect,{"aria-label":y("type"),size:"sm",css:t.css`width: 120px !important; .jimu-dropdown { width: 100%; }`,values:(0,t.Immutable)(S),onChange:M,displayByValues:e=>y("numSelected",{number:e.length}),children:u.map(t=>(0,e.jsx)(l.MultiSelectItem,{value:t,label:y(lt[t])},t))})]}),(0,e.jsxs)("div",{className:"d-flex flex-column",css:t.css`flex: 1 1 auto; .tab-content {overflow: auto;}`,children:[(0,e.jsxs)("div",{css:t.css`flex: 1 1 0; overflow: auto;`,children:[m&&(0,e.jsxs)(l.Tabs,{className:"px-4",type:"pills",fill:!0,children:[(0,e.jsx)(l.Tab,{id:"org_utility",title:y("organization"),children:(0,e.jsx)(Y,{isMultiple:p,keyword:k.trim(),pattern:c,serviceTypes:S,useUtilities:a,onChange:B})}),(0,e.jsx)(l.Tab,{id:"added_utility",title:y("added"),children:(0,e.jsx)(te,{isMultiple:p,keyword:k.trim(),pattern:c,serviceTypes:S,utilities:g,useUtilities:a,onUtilitiesChange:B})})]}),!m&&(0,e.jsx)(te,{isMultiple:p,keyword:k.trim(),pattern:c,serviceTypes:S,utilities:g,useUtilities:a,onUtilitiesChange:B,className:"px-4 my-0"})]}),(0,e.jsx)("div",{css:t.css`height: 40px;border-top: 1px solid var(--ref-palette-neutral-700);`,children:(0,e.jsx)(l.Button,{ref:R,className:"w-100 h-100 jimu-outline-inside",type:"tertiary","aria-label":y("add"),onClick:E,children:(0,e.jsxs)("div",{className:"d-flex align-items-center px-2 w-100",children:[(0,e.jsx)(it,{size:"l",color:"var(--sys-color-primary-light)",className:"mr-2"}),(0,e.jsx)("span",{css:t.css`color: var(--sys-color-primary-light)`,children:y("addUtility")})]})})})]})]})}),(0,e.jsx)(n.SidePopper,{title:y("addUtility"),position:"right",isOpen:x&&1===w,toggle:G,trigger:p?P.current:C.current,backToFocusNode:R.current,children:(0,e.jsx)("div",{className:"h-100",css:t.css`position: relative;`,children:(0,e.jsx)("div",{css:t.css`height: 100%; .tab-content {overflow: auto;}`,children:(0,e.jsx)(qe,{utilities:g,batchUtilityJsons:U,isMultiple:!0,immediate:!1,onBatchUpdate:z,onBatchDone:V,onChange:L})})})})]})}})(),p})())}}});