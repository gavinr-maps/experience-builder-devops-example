System.register(["jimu-core","jimu-for-builder","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/setting-components","jimu-ui/basic/item-selector","jimu-ui/basic/list-tree"],(function(e,t){var l={},n={},i={},a={},s={},r={},o={};return{setters:[function(e){l.Immutable=e.Immutable,l.React=e.React,l.ReactRedux=e.ReactRedux,l.SupportedItemTypes=e.SupportedItemTypes,l.SupportedUtilityType=e.SupportedUtilityType,l.UtilityManager=e.UtilityManager,l.appConfigUtils=e.appConfigUtils,l.classNames=e.classNames,l.css=e.css,l.esri=e.esri,l.getAppStore=e.getAppStore,l.jsx=e.jsx,l.requestUtils=e.requestUtils},function(e){n.getAppConfigAction=e.getAppConfigAction},function(e){i.Alert=e.Alert,i.Button=e.Button,i.Collapse=e.Collapse,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.SVG=e.SVG,i.Select=e.Select,i.Tab=e.Tab,i.Tabs=e.Tabs,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.hooks=e.hooks},function(e){a.DataSourceTree=e.DataSourceTree},function(e){s.SidePopper=e.SidePopper},function(e){r.ItemSelector=e.ItemSelector,r.ItemSelectorMode=e.ItemSelectorMode},function(e){o.List=e.List,o.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={90075:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.6 6.188V1.824h-2.4v2.14L8 1 0 8.412h2.4V13H1v2h14v-2h-1.4V8.412H16l-2.4-2.224ZM10 9v3H6V9h4Z" fill="#000"></path></svg>'},69359:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.736 1c.424 0 .832.184 1.136.516L8 2.75h6.4c.88 0 1.6.788 1.6 1.75v8.75c0 .963-.72 1.75-1.6 1.75H1.6C.72 15 0 14.213 0 13.25l.008-10.5C.008 1.788.72 1 1.6 1h4.136Zm.144 4.922A2.936 2.936 0 0 1 8 5a2.936 2.936 0 0 1 2.12.922c.563.589.88 1.388.88 2.22 0 .681-.211 1.344-.604 1.886l-.095.128L8 13l-2.3-2.842c-.014-.017-.096-.13-.096-.13A3.21 3.21 0 0 1 5 8.144c0-.833.317-1.632.88-2.221Zm1.514 3.171c.18.126.39.193.606.193.29 0 .566-.121.771-.335a1.182 1.182 0 0 0 .136-1.443 1.104 1.104 0 0 0-.49-.421C8.218 7 8 6.977 7.787 7.022a1.076 1.076 0 0 0-.558.313 1.16 1.16 0 0 0-.299.585c-.042.222-.02.451.062.66.083.209.223.388.402.513Z" fill="#000"></path></svg>'},10433:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM2 15a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM16 13a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM3.2 9.638 7.006 5l1.546 1.269-3.806 4.638L3.2 9.638ZM13.594 9.222 12.2 6l-1.835.794 1.393 3.222 1.836-.794ZM10.5 12h-5v2h5v-2Z" fill="#000"></path></svg>'},14407:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.6 11.2h4.8v1.6H5.6v-1.6Zm10.4 0h-2.4v3.2A1.6 1.6 0 0 1 12 16H4a1.6 1.6 0 0 1-1.6-1.6v-3.2H0V5.6A1.6 1.6 0 0 1 1.6 4h.8V1.6A1.6 1.6 0 0 1 4 0h8a1.6 1.6 0 0 1 1.6 1.6V4h.8A1.6 1.6 0 0 1 16 5.6v5.6ZM4 4h8V1.6H4V4Zm8 5.6H4v4.8h8V9.6Zm2.4-2.8a1.203 1.203 0 0 0-1.2-1.2 1.2 1.2 0 1 0 1.2 1.2Z" fill="#000"></path></svg>'},17826:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.714 5.823v4.97c0 .914-.36 1.789-1.004 2.434a3.422 3.422 0 0 1-4.848 0 3.448 3.448 0 0 1-1.004-2.433V5.44c0-.507-.201-.993-.558-1.352a1.901 1.901 0 0 0-2.694 0 1.915 1.915 0 0 0-.558 1.352v5.1a2.302 2.302 0 0 1 .712 3.918 2.282 2.282 0 0 1-3.727-1.366 2.302 2.302 0 0 1 .281-1.55 2.288 2.288 0 0 1 1.21-1.002v-5.1c0-.913.362-1.788 1.005-2.433a3.422 3.422 0 0 1 4.848 0A3.448 3.448 0 0 1 8.381 5.44v5.353c0 .507.201.993.558 1.352a1.9 1.9 0 0 0 2.694 0c.357-.359.558-.845.558-1.352v-4.97H9.905L12.953 2 16 5.823h-2.286Z" fill="#000"></path></svg>'},11167:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2V4a2 2 0 0 1 2-2h8a2 2 0 0 0-2-2H2Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6Zm5.489 2.938c-.786-.786-1.728-1.078-2.829-.876a.402.402 0 0 0-.212.68l1.619 1.618a.402.402 0 0 1 0 .569l-1.138 1.138a.402.402 0 0 1-.569 0L6.742 8.448a.402.402 0 0 0-.68.212c-.202 1.1.09 2.043.876 2.829a3.22 3.22 0 0 0 3.532.688l1.588 1.587a.805.805 0 0 0 1.137 0l.57-.569a.805.805 0 0 0 0-1.137l-1.588-1.588a3.22 3.22 0 0 0-.688-3.532Z" fill="#000"></path></svg>'},13372:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4.751a2 2 0 0 0-.495-1.317L12.098.683A2 2 0 0 0 10.592 0H3Zm3.325 3.077c1.376-.252 2.554.114 3.536 1.095a4.024 4.024 0 0 1 .86 4.416l1.985 1.984c.392.393.392 1.03 0 1.422l-.712.712a1.006 1.006 0 0 1-1.422 0L8.588 10.72a4.024 4.024 0 0 1-4.416-.86c-.981-.982-1.347-2.16-1.095-3.536a.503.503 0 0 1 .85-.265L5.95 8.083a.503.503 0 0 0 .711 0l1.422-1.422a.503.503 0 0 0 0-.71L6.06 3.926a.503.503 0 0 1 .265-.85Z" fill="#000"></path></svg>'},41074:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0ZM7.2 4a.8.8 0 1 1 1.6 0v3.2H12a.8.8 0 0 1 0 1.6H8.8V12a.8.8 0 0 1-1.6 0V8.8H4a.8.8 0 1 1 0-1.6h3.2V4Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},59455:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0Zm1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8Z" fill="#000"></path></svg>'},80272:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0Zm1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM7.5 4.5a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},88866:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},48891:e=>{"use strict";e.exports=l},23137:e=>{"use strict";e.exports=n},30726:e=>{"use strict";e.exports=i},338:e=>{"use strict";e.exports=a},77756:e=>{"use strict";e.exports=s},20878:e=>{"use strict";e.exports=r},59587:e=>{"use strict";e.exports=o}},t={};function c(l){var n=t[l];if(void 0!==n)return n.exports;var i=t[l]={exports:{}};return e[l](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var l in t)c.o(t,l)&&!c.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";c.r(u),c.d(u,{AddUtilityTabs:()=>ye,UtilityIcon:()=>B,UtilitySelector:()=>Oe});var e=c(48891),t=c(23137),l=c(59587),n=c(30726),i=c(77756),a=c(338);const s=[{name:"printTask",label:"Printing",type:e.SupportedUtilityType.Printing},{name:"geometry",label:"Geometry",type:e.SupportedUtilityType.Geometry},{name:"geoenrichment",label:"GeoEnrichment",type:e.SupportedUtilityType.GeoEnrichment},{name:"route",label:"Route",type:e.SupportedUtilityType.Routing},{name:"geocode",label:"Geocoding",dynamic:!0,type:e.SupportedUtilityType.GeoCoding}];var r=c(11167),o=c.n(r);const p=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:o()},i))};var m=c(88866),d=c.n(m);const v=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:d()},i))};var y=function(e,t,l,n){return new(l||(l=Promise))((function(i,a){function s(e){try{o(n.next(e))}catch(e){a(e)}}function r(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(s,r)}o((n=n.apply(e,t||[])).next())}))};function f(e){var t;const l=e.match(/\/([\w\s%]*)\/(?:GP|NA|Geoenrichment|Geometry|Geocode)Server\/?([\w\s%]*)?\/?/);return 3===(null==l?void 0:l.length)?decodeURI(null!==(t=l[2])&&void 0!==t?t:l[1]):""}function g(e,t,l,n){const{url:i,label:a}=e,s=null===t||e.type===t,r=!l||a.toLowerCase().includes(l.toLowerCase()),o=!n||n.test(i);return s&&r&&o}function h(t){var l,n,i;return y(this,void 0,void 0,(function*(){let a;try{a=yield function(t){return y(this,void 0,void 0,(function*(){return yield e.requestUtils.requestWrapper(t,(l=>y(this,void 0,void 0,(function*(){return yield e.esri.restRequest.request(t,{params:{f:"json"},authentication:l,httpMethod:"GET"})}))),1)}))}(t)}catch(e){console.warn("service request error",e)}if(!a)return null;if(/\/rest\/services\/.*\/GeometryServer\/?/.test(t))return e.SupportedUtilityType.Geometry;if(/\/rest\/services\/.*\/GeocodeServer\/?/.test(t))return e.SupportedUtilityType.GeoCoding;if(/\/rest\/services\/.*\/GeoenrichmentServer\/?/.test(t))return e.SupportedUtilityType.GeoEnrichment;if(/\/rest\/services\/.*\/NAServer\/?/.test(t))return"esriNAServerRouteLayer"===a.layerType&&(null===(l=a.supportedTravelModes)||void 0===l?void 0:l.length)>0&&(null===(n=a.networkClasses)||void 0===n?void 0:n.length)>0?e.SupportedUtilityType.Routing:null;if(/\/rest\/services\/.*\/GPServer\/?/.test(t)){const t="web_map_as_json",l="output_file";let n=!1,s=!1;return null===(i=a.parameters)||void 0===i||i.forEach((e=>{t===e.name.toLowerCase()&&"esriGPParameterDirectionInput"===e.direction&&(n=!0),l===e.name.toLowerCase()&&"GPDataFile"===e.dataType&&"esriGPParameterDirectionOutput"===e.direction&&(s=!0)})),n&&s?e.SupportedUtilityType.Printing:null}return null}))}var b=c(13372),x=c.n(b);const j=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:x()},i))};var w=c(69359),O=c.n(w);const S=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:O()},i))};var N=c(90075),k=c.n(N);const I=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:k()},i))};var C=c(10433),U=c.n(C);const T=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:U()},i))};var R=c(14407),P=c.n(R);const E=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:P()},i))};var M=c(17826),A=c.n(M);const G=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:A()},i))};function B(t){const{type:l}=t,n=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["type"]);switch(l){case e.SupportedUtilityType.GeoEnrichment:return(0,e.jsx)(S,Object.assign({},n));case e.SupportedUtilityType.GeoCoding:return(0,e.jsx)(I,Object.assign({},n));case e.SupportedUtilityType.Geometry:return(0,e.jsx)(T,Object.assign({},n));case e.SupportedUtilityType.Printing:return(0,e.jsx)(E,Object.assign({},n));case e.SupportedUtilityType.Routing:return(0,e.jsx)(G,Object.assign({},n))}return(0,e.jsx)(j,Object.assign({},n))}function Z(e,t){var l,n;return/rest\/services\/.*\/GeocodeServer/.test(t.url)?{name:t.name,placeholder:t.placeholder,placefinding:null!==(l=t.placefinding)&&void 0!==l&&l,batch:null!==(n=t.batch)&&void 0!==n&&n}:"printTask"===e?{templates:t.templates}:null}const L=e.css`
  .utility-item.utility-item-selected {
    outline: 1px solid var(--primary-700);
    border-radius: 0;
    position: relative;
    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      & > div {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--primary-700) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }

  .utility-item-not-matched.utility-item-selected {
    outline: 1px solid var(--primary-700);
    border-radius: 0;
  }

  .utility-item-not-matched {
    position: relative;

    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      .icon-container {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--primary-700) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }

  .org-tree {
    height: auto !important;
  }
  .tree-root {
    padding: 0.5rem 0;

  }
`;function V(l){var i;const{keyword:r,pattern:o,serviceType:c,useUtilities:u,isMultiple:m,onChange:d}=l,y=null===(i=(0,e.getAppStore)().getState().portalSelf)||void 0===i?void 0:i.helperServices,[f,h]=e.React.useState([]),[b,x]=e.React.useState(null);e.React.useEffect((()=>{h(function(e,t,l,n){const i=[];return s.forEach((a=>{const s=e[a.name];if(a.dynamic){if(Array.isArray(s))i.push({id:a.name,name:a.name,label:a.label,type:a.type,children:s.map(((e,t)=>{var l;const n=Z(a.name,e);return{id:`${a.name}_${t}`,name:a.name,type:a.type,index:t,label:null!==(l=e.name)&&void 0!==l?l:e.id,url:e.url,setting:n}})).filter((e=>g(e,t,l,n)))});else if(s){const e=Z(a.name,s);i.push({id:a.name,name:a.name,label:a.label,type:a.type,url:s.url,setting:e})}}else if(s){const e=Z(a.name,s);i.push({id:a.name,name:a.name,label:a.label,type:a.type,url:s.url,setting:e})}})),i.filter((e=>e.children?e.children.length>0:g(e,t,l,n)))}(y,c,r,o))}),[y,c,r,o]),n.hooks.useEffectOnce((()=>{const t=function(t,l){const n=l.map((t=>e.UtilityManager.getInstance().getUtilityJson(t.utilityId))).filter((e=>{if("org"===(null==e?void 0:e.source)){const{name:l,url:n,index:i,taskName:a}=e;return!function(e,t,l,n,i){var a;if(n>=0){const n=e[t];return!!Array.isArray(n)&&n.some((e=>(e.name===i||e.id===i)&&e.url===l))}return(null===(a=e[t])||void 0===a?void 0:a.url)===l}(t,l,n,i,a)}return!1}));return n}(y,null!=u?u:(0,e.Immutable)([]));x(t)}));const j=n.hooks.useEventCallback((e=>{const{children:t}=e;return null!=t?t:[]})),w=n.hooks.useEventCallback((e=>e.label)),O=n.hooks.useEventCallback((e=>"root"!==e.id&&!e.children)),S=n.hooks.useEventCallback(((t,l,n=!1)=>(0,e.jsx)("div",{className:"w-100 d-flex align-items-center",css:e.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: ${n?"var(--light-500)":"transparent"};
          color: var(--dark-800);
        `},(0,e.jsx)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100",css:e.css`width: 1.625rem; background-color: var(--info-400);`},(null==l?void 0:l.children)||"root"===(null==l?void 0:l.id)?(0,e.jsx)(p,{color:"var(--black)",className:"mr-0"}):(0,e.jsx)(B,{type:null==l?void 0:l.type,color:"var(--black)",className:"mr-0"})),(0,e.jsx)("div",{className:"text-truncate px-1"},t)))),N=e.React.useCallback((t=>{const{label:l,index:n,name:i,url:a}=t;let s=-1;return null==u||u.some(((t,r)=>{const o=e.UtilityManager.getInstance().getUtilityJson(t.utilityId);if("org"===(null==o?void 0:o.source))if(n>=0){if(o.index>=0&&o.name===i&&o.taskName===l)return s=r,!0}else if(o.name===i&&o.url===a)return s=r,!0;return!1})),s}),[u]),k=e.React.useCallback((l=>{if("function"==typeof d){const n=N(l),i=e.UtilityManager.getInstance().getIdOfOrgUtility(l.name,l.url,l.index,l.label),a=null!=u?u:(0,e.Immutable)([]);if(n>=0){if(d(m?a.filter(((e,t)=>t!==n)):(0,e.Immutable)([])),!e.UtilityManager.getInstance().isUtilityUsed(i)){const e=(0,t.getAppConfigAction)(),l=e.appConfig.utilities.without(i);e.updateUtilities(l).exec()}}else if(null!=i)d(m?e.Immutable.set(a,a.length,{utilityId:i}):(0,e.Immutable)([{utilityId:i}]));else{const n=(0,t.getAppConfigAction)(),i=n.appConfig,s=e.appConfigUtils.getUniqueId(i,"utility"),r={id:s,type:null,name:l.name,url:l.url,source:"org"};l.setting&&(r.orgSetting=l.setting),l.index>=0&&(r.taskName=l.label,r.index=l.index),n.addUtility(r).exec(),d(m?e.Immutable.set(a,a.length,{utilityId:s}):(0,e.Immutable)([{utilityId:s}]))}}}),[N,u,m,d]),I=e.React.useCallback((t=>{const l=N(t)>=0;return(0,e.jsx)(n.Button,{type:"tertiary",className:(0,e.classNames)("utility-item jimu-outline-inside text-left w-100",{"utility-item-selected":l}),"aria-checked":l,"aria-label":t.label,title:t.label,onClick:()=>k(t)},S(t.label,t,!0),l&&(0,e.jsx)("div",{className:"item-active-icon"},(0,e.jsx)("div",{className:"text-center"})))}),[N,S,k]);return(0,e.jsx)("div",{className:"utility-tree w-100 my-3",css:L},(null==b?void 0:b.length)>0&&(0,e.jsx)("div",{className:"p-2 mb-2"},(0,e.jsx)("div",{className:"d-flex mb-2 justify-content-between align-items-center"},(0,e.jsx)("span",{className:"font-13"},"Expired"),(0,e.jsx)(n.Tooltip,{title:"The service you selected is no longer configured in the utility service settings of your organization."},(0,e.jsx)(n.Button,{type:"tertiary",size:"sm",icon:!0},(0,e.jsx)(v,{size:"s"})))),b.map((t=>{var l,i,a,s,r,o;const c=null==u?void 0:u.some((e=>e.utilityId===t.id));return(0,e.jsx)("div",{className:"w-100",key:t.id},(0,e.jsx)(n.Button,{type:"tertiary",className:(0,e.classNames)("utility-item-not-matched jimu-outline-inside text-left p-0 w-100",{"utility-item-selected":c}),"aria-checked":c,"aria-label":null!==(i=null!==(l=t.taskName)&&void 0!==l?l:t.label)&&void 0!==i?i:t.name,title:null!==(s=null!==(a=t.taskName)&&void 0!==a?a:t.label)&&void 0!==s?s:t.name,onClick:()=>k({name:t.name,url:t.url,index:t.index,label:t.taskName})},S(null!==(o=null!==(r=t.taskName)&&void 0!==r?r:t.label)&&void 0!==o?o:t.name,{type:t.type},!0),c&&(0,e.jsx)("div",{className:"item-active-icon"},(0,e.jsx)("div",{className:"icon-container"}))))}))),f.map((t=>(0,e.jsx)("div",{key:t.id},(0,e.jsx)(a.DataSourceTree,{className:"org-tree",dataSource:t,getChildDataSources:j,getLabel:w,isNodeSelectable:O,renderSelectableNode:I,renderUnselectableNode:(e,t)=>S(e,t),defaultOpen:!0})))))}const H=e.css`
  .utility-item.utility-item-selected {
    outline: 1px solid var(--primary-700);
    position: relative;
    .item-active-icon {
      position: absolute;
      top: -1px;
      right: -1px;
      & > div {
        width: 0;
        height: 0;
        border-top: 0.75rem var(--primary-700) solid;
        border-left: 0.75rem transparent solid;
        background-color: transparent;
      }
    }
  }
  .tree-root {
    padding: 0.5rem 0;
  }
`;function D(t){const{keyword:l,pattern:i,serviceType:s,utilities:r,useUtilities:o,isMultiple:c,onChange:u}=t,[m,d]=e.React.useState([]),v=n.hooks.useCancelablePromiseMaker();e.React.useEffect((()=>{v(function(t,l,n,i){var a,s,r,o,c,u;return r=this,o=void 0,u=function*(){const r=[],o=Object.keys(null!=t?t:{});for(let c=0;c<o.length;c++){const u=t[o[c]];if("org"===u.source)continue;const p=yield e.UtilityManager.getInstance().getUtility(u.id);let m;m=u.portalUrl&&u.itemId?{id:u.id,label:null!==(a=u.label)&&void 0!==a?a:u.sourceLabel,type:u.type,url:p.itemInfo.url}:{id:u.id,label:u.label,type:u.type,url:u.url},p.tasks&&(m.children=p.tasks.map(((e,t)=>({rootId:u.id,id:`${u.id}_${t}`,task:e,type:u.type,label:e,url:`${m.url}/${e}`}))).filter((e=>g(e,l,n,i)))),1===(null===(s=m.children)||void 0===s?void 0:s.length)?r.push(m.children[0]):r.push(m)}return r.filter((e=>e.children?e.children.length>0:g(e,l,n,i)))},new((c=void 0)||(c=Promise))((function(e,t){function l(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof c?i:new c((function(e){e(i)}))).then(l,n)}i((u=u.apply(r,o||[])).next())}))}(r,s,l,i)).then((e=>{d(e)}))}),[r,v,s,l,i]);const y=n.hooks.useEventCallback((e=>{const{children:t}=e;return null!=t?t:[]})),f=n.hooks.useEventCallback((e=>e.label)),h=n.hooks.useEventCallback((e=>"root"!==e.id&&!e.children)),b=n.hooks.useEventCallback(((t,l,n=!1)=>(0,e.jsx)("div",{className:"w-100 d-flex align-items-center",css:e.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: ${n?"var(--light-500)":"transparent"};
          color: var(--dark-800);
        `},(0,e.jsx)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100",css:e.css`width: 1.625rem; background-color: var(--info-400);`},(null==l?void 0:l.children)||"root"===l.id?(0,e.jsx)(p,{color:"var(--black)",className:"mr-0"}):(0,e.jsx)(B,{type:null==l?void 0:l.type,color:"var(--black)",className:"mr-0"})),(0,e.jsx)("div",{className:"text-truncate px-1"},t)))),x=e.React.useCallback((e=>{const{id:t,rootId:l,task:n}=e;let i=-1;return null==o||o.some(((e,a)=>(e.utilityId===t||e.utilityId===l&&e.task===n)&&(i=a,!0))),i}),[o]),j=e.React.useCallback((t=>{var l,n;if("function"==typeof u){const i=x(t),a=null!=o?o:(0,e.Immutable)([]);u(i>=0?c?a.filter(((e,t)=>t!==i)):(0,e.Immutable)([]):c?e.Immutable.set(a,a.length,{utilityId:null!==(l=t.rootId)&&void 0!==l?l:t.id,task:t.task}):(0,e.Immutable)([{utilityId:null!==(n=t.rootId)&&void 0!==n?n:t.id,task:t.task}]))}}),[x,o,c,u]),w=e.React.useCallback((t=>{const l=x(t)>=0;return(0,e.jsx)(n.Button,{type:"tertiary",className:(0,e.classNames)("utility-item jimu-outline-inside text-left w-100",{"utility-item-selected":l}),"aria-checked":l,"aria-label":t.label,title:t.label,onClick:()=>j(t)},b(t.label,t,!0),l&&(0,e.jsx)("div",{className:"item-active-icon"},(0,e.jsx)("div",{className:"text-center"})))}),[x,b,j]);return(0,e.jsx)("div",{className:"utility-tree w-100 my-3",css:H},m.map((t=>(0,e.jsx)("div",{key:t.id},(0,e.jsx)(a.DataSourceTree,{className:"added-tree",dataSource:t,getChildDataSources:y,getLabel:f,isNodeSelectable:h,renderSelectableNode:w,renderUnselectableNode:(e,t)=>b(e,t),defaultOpen:!0})))))}var _=c(79964),z=c.n(_);const $=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:z()},i))};var q=c(20878),J=c(96009),F=c.n(J);const K=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:F()},i))};var W=c(59788),Q=c.n(W);const X=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:Q()},i))};var Y=c(55339),ee=c.n(Y);const te=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:ee()},i))};var le=c(80272),ne=c.n(le);const ie=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:ne()},i))};var ae=c(59455),se=c.n(ae);const re=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:se()},i))};function oe(t){var l,i;const{utility:a,onRemove:s}=t,[r,o]=e.React.useState(!1),[c,u]=e.React.useState(null),[m,d]=e.React.useState(!1);n.hooks.useEffectOnce((()=>{e.UtilityManager.getInstance().getUtilityFromJson(a).then((e=>{var t;(null===(t=e.tasks)||void 0===t?void 0:t.length)>0&&u(e.tasks)})).finally((()=>{d(!0)}))}));const v=e.React.useCallback((()=>{o(!r)}),[r]),y=e.React.useCallback((()=>{s(a)}),[s,a]);return m?(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"w-100 d-flex align-items-center mb-2 pl-3",css:e.css`
          height: 1.625rem;
          line-height: 1.625rem;
          background-color: var(--light-500);
          color: var(--dark-800);
          position: relative;
        `},(0,e.jsx)("div",{className:"d-flex flex-shrink-0 justify-content-center align-items-center h-100"},(null==c?void 0:c.length)>0&&(0,e.jsx)(n.Button,{className:"px-0",type:"tertiary",icon:!0,size:"sm",onClick:v,css:e.css`
                position: absolute;
                left: 0;
              `},r?(0,e.jsx)(re,{size:"s"}):(0,e.jsx)(ie,{size:"s"})),(0,e.jsx)("div",{className:"utility-icon-container"},(null==c?void 0:c.length)>0?(0,e.jsx)(p,{color:"var(--black)"}):(0,e.jsx)(j,{color:"var(--black)"}))),(0,e.jsx)("div",{className:"text-truncate px-2",title:null!==(l=a.label)&&void 0!==l?l:a.sourceLabel},null!==(i=a.label)&&void 0!==i?i:a.sourceLabel),(0,e.jsx)(n.Button,{className:"ml-auto",type:"tertiary",icon:!0,size:"sm",onClick:y},(0,e.jsx)(te,null))),(null==c?void 0:c.length)>0&&(0,e.jsx)(n.Collapse,{isOpen:r},c.map((t=>(0,e.jsx)("div",{key:t,className:"d-flex align-items-center mb-2",css:e.css`margin-left: 2rem;`},(0,e.jsx)("div",{className:"utility-icon-container mr-2"},(0,e.jsx)(j,{color:"var(--black)"})),(0,e.jsx)("div",{className:"text-truncate",title:t},t)))))):(0,e.jsx)("div",{className:"loading-container"},(0,e.jsx)(n.Loading,{type:n.LoadingType.Bar}))}const ce=e.css`
  max-height: 300px;
  background-color: var(--light-500);

  .item-list {
    max-height: 180px;
    overflow: auto;
  }

  .utility-icon-container {
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;
    background-color: var(--info-400);
    width: 1.625rem;
    height: 1.625rem;
    margin-right: 8px;
    svg {
      margin-right: 0 !important;
    }
  }
`;function ue(t){const{utilities:l,onDoneClick:i,onChange:a}=t,s=n.hooks.useTranslate(),[r,o]=e.React.useState(!1),c=e.React.useCallback((()=>{o(!r)}),[r]),u=e.React.useCallback((e=>{a(l.filter((t=>t.id!==e.id)))}),[a,l]);return l?(0,e.jsx)("div",{className:"w-100 p-3 shadow-lg",css:ce},(0,e.jsx)("div",{className:"new_utility_header d-flex align-items-center"},(0,e.jsx)("div",{className:"font-13"},(0,e.jsx)("span",null,l.length),(0,e.jsx)("span",{className:"ml-1"},s("selected"))),(0,e.jsx)(n.Button,{className:"ml-2",type:"tertiary",icon:!0,size:"sm",onClick:c},r?(0,e.jsx)(K,null):(0,e.jsx)(X,null)),!r&&(0,e.jsx)(n.Button,{className:"ml-auto",type:"primary","aria-label":s("done"),onClick:i},s("done"))),(0,e.jsx)(n.Collapse,{isOpen:r},(0,e.jsx)("div",{className:"my-3 item-list"},l.map(((t,l)=>(0,e.jsx)(oe,{key:l,utility:t,onRemove:u}))))),r&&(0,e.jsx)(n.Button,{className:"w-100",type:"primary","aria-label":s("done"),onClick:i},s("done"))):null}var pe=function(e,t,l,n){return new(l||(l=Promise))((function(i,a){function s(e){try{o(n.next(e))}catch(e){a(e)}}function r(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(s,r)}o((n=n.apply(e,t||[])).next())}))};const me=(0,e.Immutable)([e.SupportedItemTypes.GeocodingService,e.SupportedItemTypes.GeometryService,e.SupportedItemTypes.GeoprocessingService,e.SupportedItemTypes.NetworkAnalysisService]);function de(){var t;const l=(0,e.getAppStore)().getState();let n;return n=window.jimuConfig.isBuilder?null===(t=l.appStateInBuilder)||void 0===t?void 0:t.appConfig:l.appConfig,e.appConfigUtils.getUniqueId(n,"utility")}function ve(t){return(0,e.jsx)("div",{className:"d-flex align-items-center mt-2"},(0,e.jsx)($,{color:"var(--danger)",size:"s"}),(0,e.jsx)("span",{className:"ml-2",css:e.css`color: var(--danger)`},t.message))}function ye(t){const{utilities:l,onChange:i,batchUtilityJsons:a,onBatchUpdate:s,onBatchDone:r,isMultiple:o=!0,immediate:c=!0}=t,[u,p]=e.React.useState(""),[m,d]=e.React.useState(!1),[v,y]=e.React.useState(!1),[g,b]=e.React.useState(!0),[x,j]=e.React.useState(!1),[w,O]=e.React.useState((0,e.Immutable)({})),[S,N]=e.React.useState(null),k=n.hooks.useTranslate(),I=e.ReactRedux.useSelector((e=>e.portalUrl)),C=e.React.useMemo((()=>{const t=[];return Object.keys(null!=l?l:{}).forEach((e=>{const n=l[e];n.portalUrl&&t.push(n.itemId)})),null==a||a.forEach((e=>{e.portalUrl&&t.push(e.itemId)})),(0,e.Immutable)(t)}),[l,a]),U=e.React.useCallback((e=>pe(this,void 0,void 0,(function*(){if(null==w[e]){if(/^https:\/\//.test(e)){d(!0);try{const t=yield h(e);if(null==t)throw new Error(`service not supported ${e}`);O(w.set(e,{valid:!0,type:t})),N(t)}catch(t){console.error(t),O(w.set(e,{valid:!1,type:null})),N(null)}finally{d(!1)}}}else N(w[e].type)}))),[w]),T=n.hooks.useEventCallback((t=>{p(t.target.value),""===t.target.value||/^https:\/\//.test(t.target.value)?b(!0):b(!1),y(e.UtilityManager.getInstance().urlExist(t.target.value))})),R=e.React.useCallback(((t,n)=>pe(this,void 0,void 0,(function*(){const t=yield e.UtilityManager.getInstance().getUrlOfItem(n.portalUrl,n.id);if(t){let r;try{r=yield h(t)}catch(e){console.warn("get service type error",e)}if(null!=r){const o={id:de(),sourceLabel:n.title,type:r,source:"custom",itemId:n.id,portalUrl:n.portalUrl,url:t};if(c){const e=l.set(o.id,o);i(e)}else o.id=`${Date.now()}`,s(e.Immutable.set(a,a.length,o));j(!1)}else j(!0),setTimeout((()=>{j(!1)}),3e3)}}))),[i,s,a,l,c]),P=e.React.useCallback(((e,t)=>{if(c){const e=Object.keys(l).find((e=>l[e].itemId===t.id&&l[e].portalUrl===t.portalUrl)),n=l.without(e);i(n)}else s(a.filter((e=>e.itemId!==t.id)))}),[i,s,l,a,c]),E=e.React.useCallback((()=>{if(!e.UtilityManager.getInstance().urlExist(u)&&null!=S){const t={id:de(),type:S,source:"custom",url:u,label:f(u)};if(c){const e=l.set(t.id,t);i(e)}else t.id=`${Date.now()}`,s(e.Immutable.set(a,a.length,t));p(""),b(!0),N(null)}}),[i,s,l,a,c,S,u]);return(0,e.jsx)("div",{className:"w-100 h-100",css:e.css`position: relative;`},(0,e.jsx)(n.Tabs,{css:e.css`
          height: ${c?"100%":"calc(100% - 64px)"};
          overflow: hidden;
          .tab-content {
            max-height: calc(100% - 2rem);
          }
        `,type:"underline",fill:!0},(0,e.jsx)(n.Tab,{id:"layers",title:k("url")},(0,e.jsx)("div",{className:"w-100 pt-3 px-3",css:e.css`
              position: relative;
            `},(0,e.jsx)(n.TextArea,{"aria-label":k("url"),css:e.css`
                height: 80px;
              `,value:u,placeholder:k("websitePlaceholder"),onChange:T,onAcceptValue:U}),!g&&(0,e.jsx)(ve,{message:k("httpsUrlMessage")}),v&&(0,e.jsx)(ve,{message:k("duplicatedService")}),""!==u&&g&&!m&&null!=w[u]&&!w[u].valid&&(0,e.jsx)(ve,{message:k("serviceNotSupported")})),(0,e.jsx)("div",{className:"d-flex px-3 pt-3 flex-column align-items-end"},(0,e.jsx)(n.Button,{className:"w-100",type:"primary",disabled:!w[u]||v,onClick:E},k("add"))),(0,e.jsx)("div",{className:"d-flex px-3 pt-2 flex-column"},(0,e.jsx)("div",{css:e.css`
              color: var(--dark-400);
              font-weight: 400;
              font-size: 13px;
              line-height: 18px;
            `},k("supportedServices")))),(0,e.jsx)(n.Tab,{id:"widgets",title:k("items")},(0,e.jsx)(q.ItemSelector,{mode:q.ItemSelectorMode.Simple,itemType:me,portalUrl:I,isMultiple:o,onSelect:R,onRemove:P,selectedItems:C,disableRemoveItemsSelectedOnMount:!0}))),(0,e.jsx)("div",{css:e.css`
        position: absolute;
        bottom: 0;
        width: 100%;
      `},x&&(0,e.jsx)(n.Alert,{closable:!0,form:"basic",onClose:()=>j(!1),open:!0,text:k("serviceNotSupported"),type:"warning",withIcon:!0,className:"w-100"}),(0,e.jsx)(ue,{utilities:a,onChange:s,onDoneClick:r})))}var fe=c(30224),ge=c.n(fe);const he=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:ge()},i))};var be=c(41074),xe=c.n(be);const je=t=>{const{className:l}=t,i=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(l[n[i]]=e[n[i]])}return l}(t,["className"]),a=(0,e.classNames)("jimu-icon jimu-icon-component",l);return e.React.createElement(n.SVG,Object.assign({className:a,src:xe()},i))},we={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:l.TreeItemActionType.RenderOverrideItem,children:[{name:l.TreeItemActionType.RenderOverrideItemBody,children:[{name:l.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:l.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:l.TreeItemActionType.RenderOverrideItemTitle},{name:l.TreeItemActionType.RenderOverrideItemCommands}]}]}]})};function Oe(a){const{useUtilities:s,onChange:r,pattern:o,type:c=null,isMultiple:u=!1,showRemove:p=!0,closePopupOnSelect:m=!0}=a,d=n.hooks.useTranslate(),v=e.ReactRedux.useSelector((e=>{var t,l,n;return window.jimuConfig.isBuilder?null===(l=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===l?void 0:l.utilities:null===(n=e.appConfig)||void 0===n?void 0:n.utilities})),[y,f]=e.React.useState(!1),[g,h]=e.React.useState(0),[b,j]=e.React.useState(""),[w,O]=e.React.useState(""),[S,N]=e.React.useState((0,e.Immutable)([])),k=e.React.useRef();e.React.useEffect((()=>{null!=c&&j(c)}),[c]);const I=e.React.useCallback((()=>{f(!y)}),[y]),C=n.hooks.useEventCallback((()=>{h(1)})),U=n.hooks.useEventCallback((()=>{h(0)})),T=e.React.useCallback((e=>{r(e),!u&&m&&f(!1)}),[r,u,m]),R=n.hooks.useEventCallback((e=>{(0,t.getAppConfigAction)().updateUtilities(e).exec()})),P=n.hooks.useEventCallback((e=>{N(e)})),E=e.React.useCallback((()=>{const l=(0,t.getAppConfigAction)(),n=e.UtilityManager.getInstance();let i=l.appConfig;S.forEach((t=>{if(!t.itemId&&!n.urlExist(t.url)||t.itemId&&!n.itemExist(t.portalUrl,t.itemId)){const l=t.set("id",e.appConfigUtils.getUniqueId(i,"utility"));i=i.setIn(["utilities",l.id],l)}})),l.updateUtilities(i.utilities).exec(),N((0,e.Immutable)([])),U()}),[S,U]),M=n.hooks.useEventCallback((e=>{O(e.target.value)})),A=n.hooks.useEventCallback((e=>{j(e.target.value)})),G=e.React.useCallback((e=>{r(s.filter(((t,l)=>l!==e)))}),[s,r]);return(0,e.jsx)("div",{className:"px- pb-2 w-100",ref:k,css:e.css`
      .jimu-tree-item__icon {
        background-color: var(--info-400);
        width: 18px;
        height: 18px;
        margin-right: 8px;
        svg {
          margin-right: 0 !important;
        }
      }
    `},(null==s?void 0:s.length)>0&&(0,e.jsx)(l.List,Object.assign({className:"utility-list mb-2",itemsJson:s.map(((t,l)=>{const n=e.UtilityManager.getInstance().getUtilityJson(t.utilityId);return{itemStateDetailContent:t,itemKey:`${l}`,itemStateIcon:{icon:x(),color:"var(--black)"},itemStateTitle:null!=n?e.UtilityManager.getInstance().getLabelOfUseUtility(t):t.utilityId,itemStateCommands:u||p?[{label:d("remove"),iconProps:()=>({icon:ee(),size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;G(+t.itemKey)}}]:[]}})),onClickItemBody:I,isItemFocused:()=>!1},we)),(u||null==s||0===s.length)&&(0,e.jsx)(n.Button,{className:"w-100",type:"tertiary",onClick:I,css:e.css`
            border: 1px dashed var(--dark-100);
            &, &:hover { color: var(--primary-700); }
            &:hover { border: 1px dashed var(--dark-400); }
          `},d("selectUtility")),(0,e.jsx)(i.SidePopper,{title:d("selectUtility"),position:"right",isOpen:y&&0===g,toggle:I,trigger:k.current},(0,e.jsx)("div",{className:"h-100 d-flex flex-column"},(0,e.jsx)("div",{className:"px-3 pb-2",css:e.css`height: 50px;`},(0,e.jsx)(n.TextInput,{type:"search",prefix:(0,e.jsx)(he,{size:"s"}),value:w,onChange:M,placeholder:d("SearchLabel")})),null==c&&(0,e.jsx)("div",{className:"d-flex justify-content-between align-items-center px-2 mb-2"},(0,e.jsx)("span",null,d("type")),(0,e.jsx)(n.Select,{"aria-label":d("type"),size:"sm",css:e.css`width: 120px`,value:b,onChange:A},(0,e.jsx)("option",{value:""},d("allTag")),(0,e.jsx)("option",{value:e.SupportedUtilityType.GeoCoding},d("geocodingService")),(0,e.jsx)("option",{value:e.SupportedUtilityType.GeoEnrichment},d("geoenrichmentService")),(0,e.jsx)("option",{value:e.SupportedUtilityType.Geometry},d("geometryService")),(0,e.jsx)("option",{value:e.SupportedUtilityType.Printing},d("printingService")),(0,e.jsx)("option",{value:e.SupportedUtilityType.Routing},d("routingService")))),(0,e.jsx)("div",{className:"d-flex flex-column",css:e.css`flex: 1 1 auto; .tab-content {overflow: auto;}`},(0,e.jsx)("div",{css:e.css`flex: 1 1 0; overflow: auto;`},(0,e.jsx)(n.Tabs,{className:"px-3",type:"pills",fill:!0},(0,e.jsx)(n.Tab,{id:"org_utility",title:d("organization")},(0,e.jsx)(V,{isMultiple:u,keyword:w.trim(),pattern:o,serviceType:""===b?null:b,useUtilities:s,onChange:T})),(0,e.jsx)(n.Tab,{id:"added_utility",title:d("added")},(0,e.jsx)(D,{isMultiple:u,keyword:w.trim(),pattern:o,serviceType:""===b?null:b,utilities:v,useUtilities:s,onChange:T})))),(0,e.jsx)("div",{css:e.css`height: 40px;border-top: 1px solid var(--light-800);`},(0,e.jsx)(n.Button,{className:"w-100 h-100",type:"tertiary","aria-label":d("add"),onClick:C},(0,e.jsx)("div",{className:"d-flex align-items-center px-2"},(0,e.jsx)(je,{size:"l",color:"var(--primary-700)"}),(0,e.jsx)("span",{css:e.css`color: var(--primary-700)`},d("addUtility")))))))),(0,e.jsx)(i.SidePopper,{title:d("addUtility"),position:"right",isOpen:y&&1===g,toggle:U,trigger:k.current},(0,e.jsx)("div",{className:"h-100",css:e.css`position: relative;`},(0,e.jsx)("div",{css:e.css`height: 100%; .tab-content {overflow: auto;}`},(0,e.jsx)(ye,{utilities:v,batchUtilityJsons:S,isMultiple:!0,immediate:!1,onBatchUpdate:P,onBatchDone:E,onChange:R})))))}})(),u})())}}}));