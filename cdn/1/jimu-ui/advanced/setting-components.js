System.register(["jimu-arcgis","jimu-core","jimu-core/emotion","jimu-core/react","jimu-for-builder","jimu-for-builder/templates","jimu-layouts/layout-runtime","jimu-theme","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder","jimu-ui/advanced/resource-selector","jimu-ui/advanced/utility-selector","jimu-ui/basic/list-tree"],function(e,t){var i={},s={},o={},n={},a={},r={},l={},c={},d={},p={},u={},h={},m={},g={};return{setters:[function(e){i.MapViewManager=e.MapViewManager},function(e){s.AllDataSourceTypes=e.AllDataSourceTypes,s.CONSTANTS=e.CONSTANTS,s.ContainerType=e.ContainerType,s.DataSourceComponent=e.DataSourceComponent,s.DataSourceManager=e.DataSourceManager,s.DataSourceStatus=e.DataSourceStatus,s.DataSourceTypes=e.DataSourceTypes,s.DialogMode=e.DialogMode,s.EsriFieldType=e.EsriFieldType,s.ExpressionPartType=e.ExpressionPartType,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.LayoutItemType=e.LayoutItemType,s.LayoutParentType=e.LayoutParentType,s.LayoutType=e.LayoutType,s.LinkType=e.LinkType,s.MessageCarryData=e.MessageCarryData,s.MultipleDataSourceComponent=e.MultipleDataSourceComponent,s.OpenTypes=e.OpenTypes,s.OrderRule=e.OrderRule,s.PagePart=e.PagePart,s.PageType=e.PageType,s.React=e.React,s.ReactRedux=e.ReactRedux,s.ReactResizeDetector=e.ReactResizeDetector,s.ServiceManager=e.ServiceManager,s.SessionManager=e.SessionManager,s.SupportedUtilityType=e.SupportedUtilityType,s.UtilityManager=e.UtilityManager,s.appConfigUtils=e.appConfigUtils,s.cancelablePromise=e.cancelablePromise,s.classNames=e.classNames,s.css=e.css,s.dataSourceUtils=e.dataSourceUtils,s.defaultMessages=e.defaultMessages,s.esri=e.esri,s.focusElementInKeyboardMode=e.focusElementInKeyboardMode,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.i18n=e.i18n,s.injectIntl=e.injectIntl,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,s.lodash=e.lodash,s.moduleLoader=e.moduleLoader,s.polished=e.polished,s.proxyUtils=e.proxyUtils,s.urlUtils=e.urlUtils,s.useIntl=e.useIntl},function(e){o.Fragment=e.Fragment,o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){n.cloneElement=e.cloneElement,n.createElement=e.createElement,n.default=e.default,n.isValidElement=e.isValidElement,n.useCallback=e.useCallback,n.useEffect=e.useEffect,n.useReducer=e.useReducer,n.useRef=e.useRef,n.useState=e.useState},function(e){a.builderAppSync=e.builderAppSync,a.getAppConfigAction=e.getAppConfigAction},function(e){r.TemplateType=e.TemplateType,r.getAnchoredWindowTemplates=e.getAnchoredWindowTemplates,r.getFixedModalWindowTemplates=e.getFixedModalWindowTemplates,r.getFixedNonModalWindowTemplates=e.getFixedNonModalWindowTemplates,r.getFullScreenGridPageTemplates=e.getFullScreenGridPageTemplates,r.getFullScreenPageTemplates=e.getFullScreenPageTemplates,r.getScrollingPageTemplates=e.getScrollingPageTemplates,r.getTemplateCapabilitiesOnlyInCurrentLocale=e.getTemplateCapabilitiesOnlyInCurrentLocale,r.getTemplatesByCapabilityTags=e.getTemplatesByCapabilityTags,r.getWindowTemplates=e.getWindowTemplates},function(e){l.searchUtils=e.searchUtils,l.utils=e.utils},function(e){c.Theme2GlobalStyleClassName=e.Theme2GlobalStyleClassName,c.ThemeGlobalStyleClassName=e.ThemeGlobalStyleClassName,c.ThemeSwitchComponent=e.ThemeSwitchComponent,c.UseTheme2Context=e.UseTheme2Context,c.getBoxStyles=e.getBoxStyles,c.getBuilderThemeVariables=e.getBuilderThemeVariables,c.getTheme=e.getTheme,c.getTheme2=e.getTheme2,c.popperPointer=e.popperPointer,c.registerStyles=e.registerStyles,c.styled=e.styled,c.useTheme=e.useTheme,c.utils=e.utils,c.withStyles=e.withStyles,c.withTheme=e.withTheme},function(e){d.AdvancedButtonGroup=e.AdvancedButtonGroup,d.AdvancedSelect=e.AdvancedSelect,d.Alert=e.Alert,d.Badge=e.Badge,d.Button=e.Button,d.Checkbox=e.Checkbox,d.CollapsableCheckbox=e.CollapsableCheckbox,d.CollapsablePanel=e.CollapsablePanel,d.CollapsableRadio=e.CollapsableRadio,d.CollapsableToggle=e.CollapsableToggle,d.Collapse=e.Collapse,d.ConfirmDialog=e.ConfirmDialog,d.Container=e.Container,d.Dropdown=e.Dropdown,d.DropdownButton=e.DropdownButton,d.DropdownItem=e.DropdownItem,d.DropdownMenu=e.DropdownMenu,d.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,d.FloatingPanel=e.FloatingPanel,d.FormGroup=e.FormGroup,d.Icon=e.Icon,d.Input=e.Input,d.Label=e.Label,d.Link=e.Link,d.Loading=e.Loading,d.LoadingType=e.LoadingType,d.Message=e.Message,d.Modal=e.Modal,d.ModalBody=e.ModalBody,d.ModalFooter=e.ModalFooter,d.ModalHeader=e.ModalHeader,d.NumericInput=e.NumericInput,d.Option=e.Option,d.PanelHeader=e.PanelHeader,d.Popper=e.Popper,d.Radio=e.Radio,d.Row=e.Row,d.Select=e.Select,d.Switch=e.Switch,d.Tab=e.Tab,d.Tabs=e.Tabs,d.TextInput=e.TextInput,d.Tooltip=e.Tooltip,d.UrlInput=e.UrlInput,d.defaultMessages=e.defaultMessages,d.isOutBoundary=e.isOutBoundary},function(e){p.DataSourceSelector=e.DataSourceSelector,p.FieldSelector=e.FieldSelector,p.FieldSelectorWithFullTextIndex=e.FieldSelectorWithFullTextIndex,p.dataComponentsUtils=e.dataComponentsUtils},function(e){u.ExpressionInput=e.ExpressionInput,u.ExpressionInputType=e.ExpressionInputType},function(e){h.IconPicker=e.IconPicker},function(e){m.UtilitySelector=e.UtilitySelector,m.addNewUtility=e.addNewUtility},function(e){g.List=e.List,g.Tree=e.Tree,g.TreeAlignmentType=e.TreeAlignmentType,g.TreeCollapseStyle=e.TreeCollapseStyle,g.TreeItemActionType=e.TreeItemActionType,g.TreeStyle=e.TreeStyle}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},2918:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 32 32"><path fill="#000" d="M2.15 24 19.3 13.974h8.896c.274 0 .52.207.52.489 0 .23-.108.334-.245.411l-8.426 4.744c-.549.31-.739.927-.739 1.388l-.009 2.99H30V6.618a.6.6 0 0 0-.052-.242.6.6 0 0 0-.149-.204.69.69 0 0 0-.482-.17h-10.21L2 15.979v8.019h.15z"></path></svg>'},4108:e=>{"use strict";e.exports=a},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},13089:e=>{"use strict";e.exports=p},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},14321:e=>{"use strict";e.exports=d},14962:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 3a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zM1 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M1.5 9a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zM1.5 12a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},16435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M3.646 10.354a.5.5 0 0 0 .708-.708L2.707 8h10.586l-1.647 1.646a.5.5 0 0 0 .708.708l2.5-2.5a.5.5 0 0 0 0-.708l-2.5-2.5a.5.5 0 0 0-.708.708L13.293 7H2.707l1.647-1.646a.5.5 0 1 0-.708-.708l-2.5 2.5a.5.5 0 0 0 0 .708z"></path></svg>'},16884:e=>{"use strict";e.exports=r},18249:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h14v12H1zm13 1H2v4h12zm0 5h-3v2h3zm0 3h-3v2h3zm-4 2v-2H6v2zm-5 0v-2H2v2zm-3-3h3V8H2zm8-2v2H6V8z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},32881:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 14a1 1 0 1 0 2 0 1 1 0 0 0-2 0m1-5a1 1 0 1 1 0-2 1 1 0 0 1 0 2m0-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2" clip-rule="evenodd"></path></svg>'},35809:e=>{"use strict";e.exports=h},39524:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.5a.5.5 0 0 1 1 0v2.8a.5.5 0 0 1-1 0zm6.028.874a.5.5 0 0 1 .062.705l-1.414 1.685a.5.5 0 1 1-.766-.643l1.414-1.685a.5.5 0 0 1 .704-.062m-10.352.062a.5.5 0 1 0-.766.643l1.414 1.685a.5.5 0 0 0 .766-.643zM6.244 10.6H5.43zM.961 9.8h4.88c.211 0 .359.19.359.4q0 .207.045.4a1.8 1.8 0 0 0 3.51 0h.814a2.6 2.6 0 0 1-5.139 0H.8v3.6h14.4v-3.6H9.755q.045-.194.045-.4c0-.21.148-.4.358-.4h4.881l-2.267-3.4H3.228zm11.81-4.2a.8.8 0 0 1 .666.356l2.429 3.642a.8.8 0 0 1 .134.444V14.2a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1-.8-.8v-4.158a.8.8 0 0 1 .134-.444l2.429-3.642a.8.8 0 0 1 .665-.356z" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=l},48799:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" d="M1.998 8.5V16h1V8.5h1v-1h-1V0h-1v7.5h-1v1zM7.998 0v3.5h-1v1h1V16h1V4.5h1v-1h-1V0zM13.998 11.5V0h1v11.5h1v1h-1V16h-1v-3.5h-1v-1z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},54578:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 13a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1zM1 9.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5M1.5 7a.5.5 0 0 1 0-1h10a.5.5 0 0 1 0 1zM1.5 4a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1z"></path></svg>'},56499:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707z"></path></svg>'},57993:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M10.354 12.354a.5.5 0 0 0-.708-.708L8 13.293V2.707l1.646 1.647a.5.5 0 0 0 .708-.708l-2.5-2.5a.5.5 0 0 0-.708 0l-2.5 2.5a.5.5 0 1 0 .708.708L7 2.707v10.586l-1.646-1.647a.5.5 0 0 0-.708.708l2.5 2.5a.5.5 0 0 0 .708 0z"></path></svg>'},62686:e=>{"use strict";e.exports=i},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=n},71245:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 32 32"><path fill="#000" fill-rule="evenodd" d="M2.596 6.357c.39-.59.944-1.055 1.595-1.337L15.544.094a1.14 1.14 0 0 1 .91 0L30 5.97V23.66a3.6 3.6 0 0 1-.596 1.983 3.65 3.65 0 0 1-1.595 1.337l-11.353 4.927a1.14 1.14 0 0 1-.91 0L2 26.029V8.34a3.6 3.6 0 0 1 .596-1.984m3.419 15.162q.014.024.037.038l9.594 5.351a.72.72 0 0 0 .705 0l9.144-5.103a1 1 0 0 0 .37-.356.95.95 0 0 0 .135-.488v-9.89a.85.85 0 0 0-.122-.438.9.9 0 0 0-.331-.32l-9.497-5.3a.1.1 0 0 0-.104 0l-2.415 1.348a.1.1 0 0 0-.026.025.066.066 0 0 0 .026.092l8.947 4.992c.39.218.716.532.941.91.226.378.345.807.345 1.243v5.514q0 .121-.062.226a.46.46 0 0 1-.172.165l-5.633 3.145a3.9 3.9 0 0 1-1.899.49c-.666 0-1.32-.169-1.898-.49L8.972 19.81a1.46 1.46 0 0 1-.542-.524 1.4 1.4 0 0 1-.198-.715V11.76a.07.07 0 0 1 .07-.068q.018 0 .035.009l7.651 4.268q.076.043.121.117a.3.3 0 0 1 .045.16v2.526q0 .019.009.034a.07.07 0 0 0 .06.033.1.1 0 0 0 .035-.009l1.972-1.1c.28-.156.511-.38.673-.651.161-.27.247-.577.247-.89v-.964c0-.278-.076-.55-.22-.79-.144-.241-.35-.44-.598-.58L9.65 9.011a.89.89 0 0 0-.86 0L6.052 10.54a.104.104 0 0 0-.052.088v10.842q0 .027.015.05" clip-rule="evenodd"></path></svg>'},71371:e=>{"use strict";e.exports=m},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},76490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m1.373 8 2.07-2.071.83.828L2.2 8.828a3.515 3.515 0 0 0 4.97 4.971l2.072-2.071.828.828L8 14.627A4.686 4.686 0 1 1 1.373 8M13.799 7.172l-2.071 2.07.828.83L14.627 8A4.686 4.686 0 1 0 8 1.373l-2.071 2.07.828.83L8.828 2.2a3.515 3.515 0 0 1 4.971 4.97"></path><path fill="#000" d="M5.515 9.657a.586.586 0 0 0 .828.828l4.142-4.142a.586.586 0 0 0-.828-.828z"></path></svg>'},79244:e=>{"use strict";e.exports=s},84845:e=>{"use strict";e.exports=u},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},96745:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0m1 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-7.676 2.228H7.34c-.213-1.138.621-2.13 1.375-3.025C9.28 6.532 9.8 5.914 9.8 5.328 9.8 4.5 9.2 3.9 7.976 3.9c-.816 0-1.572.36-2.268 1.092l-.648-.6C5.852 3.552 6.788 3 8.096 3c1.692 0 2.772.864 2.772 2.244 0 .864-.652 1.628-1.3 2.387-.71.831-1.413 1.655-1.244 2.597m.3 2.172c0 .48-.348.792-.768.792-.432 0-.78-.312-.78-.792s.348-.804.78-.804c.42 0 .768.324.768.804" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=g}},t={};function v(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,v),o.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return(()=>{"use strict";v.r(f),v.d(f,{ByFieldSeriesX:()=>Bs,ByFieldSeriesY:()=>Us,CardLayout:()=>ha,CardLayoutSetting:()=>wa,CollapsableCheckbox:()=>ve,CollapsableRadio:()=>ge,CollapsableResetPanel:()=>Si,CollapsableToggle:()=>me,DEFAULT_GEOCODE_KEY:()=>As,DEFAULT_MAX_SUGGESTION:()=>Ms,DefaultAddress:()=>_s,DefaultAddressAlias:()=>Js,DefaultGeocodeLabel:()=>qs,DefaultGeocodeURL:()=>Ks,DirectionSelector:()=>Ss,JimuLayerViewSelector:()=>te,JimuLayerViewSelectorComponent:()=>ee,JimuLayerViewSelectorDeprecated:()=>z,JimuLayerViewSelectorDropdown:()=>se,JimuLayerViewSelectorDropdownComponent:()=>ie,JimuMapViewSelector:()=>ae,JimuMapViewSelectorComponent:()=>ne,LabelReset:()=>xi,LayerSetting:()=>ja,LinkSelector:()=>rt,LinkSelectorContent:()=>_e,LinkSelectorSidePopper:()=>Ze,LinkSetting:()=>Je,LinkSettingPopup:()=>et,MAX_RECENT_SEARCHES:()=>Ds,MAX_SUGGESTION:()=>Ls,MIN_SCALE:()=>Rs,MapWidgetSelector:()=>R,MapWidgetSelectorComponent:()=>A,MaxCategories:()=>zs,MaxPieces:()=>$s,MaxSeries:()=>Vs,MessageActionDataSelector:()=>Pa,MultipleJimuMapConfig:()=>ua,ObjectIdSchema:()=>vo,OutStatisticFieldNameSplit:()=>Ws,OutputDsAddress:()=>Hs,OutputDsObjectField:()=>Gs,PageTemplatePopper:()=>Ei,ProxySetting:()=>Nt,ProxySettingPopup:()=>Et,QuickStylePopper:()=>Ns,RadioGroup:()=>pe,SearchDataSetting:()=>Sn,SearchDataType:()=>Es,SearchGeneralSetting:()=>Cn,SearchServiceType:()=>Fs,SearchSuggestionSetting:()=>wn,SettingCollapse:()=>ue,SettingLayout:()=>t,SettingRow:()=>k,SettingSection:()=>j,SidePopper:()=>Ye,SizeMode:()=>xs,SizeModeSelector:()=>Cs,SortSetting:()=>ds,SortTree:()=>ci,SortTreePopper:()=>ui,Status:()=>ma,StylePicker:()=>le,TemplateList:()=>Pi,TemplateSelector:()=>Vi,UnControlledSettingCollapse:()=>he,WidgetList:()=>ti,WidgetListPopper:()=>ai,WindowTemplatePopper:()=>Ui,_LinkSelector:()=>at,_LinkSelectorContent:()=>He,_LinkSelectorSidePopper:()=>Qe,_SidePopper:()=>Xe,changeCurrentDialog:()=>Da,changeCurrentPage:()=>La,checkIsTableDs:()=>Uo,checkIsUseDsChanged:()=>jo,checkIsWidgetJsonDsChanged:()=>Io,getAddressFieldsSchemaAndDefaultFieldName:()=>bo,getAllDataSourceBySearchDataConfig:()=>Eo,getAllDsByDataConfigWithMapCentric:()=>Ro,getAllItemsInMapView:()=>Ia,getConfigIdList:()=>ko,getDefaultField:()=>Do,getDefaultGeocodeConfig:()=>Wo,getDsInWidgetJson:()=>Fo,getDsJsonOfOriginDs:()=>Ao,getInitOutDataSource:()=>So,getInitSchema:()=>fo,getNameOfDefaultAddressField:()=>yo,getNewConfigId:()=>Oo,getNewDataSourceConfig:()=>Lo,getNewDsConfigItem:()=>No,getOutputDataSourceId:()=>Po,getOutputDsJson:()=>Bo,getOutputJsonOriginDs:()=>xo,getWhetherDsInUseDataSources:()=>wo,handelDialogInfos:()=>Na,initNewDatasourceConfigByField:()=>Mo,isDsInDataSources:()=>Co,proxySettingUtils:()=>i,setLayoutAuto:()=>fa,setLayoutCustom:()=>ya});var e={};v.r(e),v.d(e,{JimuLayerViewSelector:()=>b,JimuLayerViewSelectorDeprecated:()=>h,JimuLayerViewSelectorDropdown:()=>y,LinkSelectorContent:()=>l,ProxySetting:()=>c,ProxySettingPopup:()=>d,RadioGroup:()=>p,SettingCollapse:()=>r,SidePopper:()=>u,SortSetting:()=>n,StylePicker:()=>a,WidgetSelector:()=>o});var t={};v.r(t),v.d(t,{SettingRow:()=>k,SettingSection:()=>j});var i={};v.r(i),v.d(i,{deleteProxies:()=>yt,getCreateProxyUrl:()=>xt,getDeleteProxyUrl:()=>wt,getNeedProxyDataSources:()=>pt,getNeedProxyItems:()=>dt,getNeedProxyUtilities:()=>ut,getProxyJsonFromSourceUrl:()=>mt,getProxyRootUrl:()=>St,isRegisteredApp:()=>vt,isSameProxy:()=>gt,needToConfigProxy:()=>ft,traverseToGetNeedProxyDataSources:()=>ht});var s=v(79244);const o=e=>{const t=e.theme;return s.css`
    .component-choose-widget-popup{
      .widget-card-active-btn{
        outline: none;
      }
    }
    div.component-choose-widget-popup-modal{
      width: 850px;
      max-width: 850px;
      height: 600px;
      background: ${t.ref.palette.white};
      border-radius: 4px;
      position: absolute;
      margin: auto;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      .component-choose-widget-clear-border{
        border: 0;
        padding: 0;
      }
      .modal-content{
        border: 0;
        padding: 20px 10px 20px 40px;
        position: static;
      }
      .component-choose-widget-modal-header{
        .choose-widget-popup-close{
          width: 50px;
          height: 50px;
          display: inline-block;
          right: 28px;
          position: absolute;
          top: 10px;
          &:hover{
            cursor: pointer;
          }
        }
        .choose-widget-popup-close:after{
          content: '';
          display: inline-block;
          width: 16px;
          height: 16px;
          background-image: url(${"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAsElEQVQ4jaWSLQ7EIBhEv2LxnAzP1cBzAU6DhKCpZneaQHYpP2k6omreCzA9yjf0IgyfGCMZY+g8zy2ADrpgmsA5R977raTC6IJpAiklCSEopTSVVBgddME0AeeclFJTSQ+jCwY5fh9xVERm8E0wkiAzeCjoJcgMbm/wJjdBf4XdOmwF49irdf4Es6l2E7MVXLOSXAJr7XKqkQTMFcwYQiha65JzLruggy4YZPgfPMkHXzQME+F7oHYAAAAASUVORK5CYII="});
          position: relative;
          left: 18px;
          top: 12px;
        }
      }
      .component-choose-widget-modal-body{
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -webkit-box-pack: start;
        -ms-flex-pack: start;
        justify-content: flex-start;
        margin: 40px 0 10px 0;
        .widget-card-item{
          width: 70px;
          height: 120px;
          border: 0;
          margin: 0 30px 0 0;
          &:hover{
            cursor: pointer;
          }
          .widget-card-image{
            width: 70px;
            height: 70px;
            border: 1px solid #ccc;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            >div{
              width: 30px;
              height: 30px;
              position: relative;
              &:after{
                display: none;
              }
            }
          }
          .widget-card-content{
            font-size: 12px;
            color: #000;
            letter-spacing: 0.33px;
            padding: 2px;
            text-align: center;
            line-height: 14px;
          }
        }
        .widget-card-selected{
          .widget-card-image{
            border: 2px solid #0C5CB6;
            >div:after{
              content: '';
              display: block;
              width: 16px;
              height: 16px;
              position: absolute;
              top: -20px;
              right: -20px;
              background-image: url(${"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA20lEQVQ4jWPkidn2n4ECwESJ5iFgABsLI8PBRiuGS732DKJ8bKQbwMHKzKAqyc0gK8zBIMDNilUNI6FYkBBgBxrExPDg9Xes8iy4NIZYSDJ4GYkx/Pj1j6F25Q2cFuD0wo2nXxi42ZkZYu1lGMItpUg34Mrjzwx//0HYT9//IN0AFiZGBjstIaAh/xkOXntLugHGyvwM/FysDBcefGT48PUP6QaI8ELinZ2FicFGQ4iBnRW7UmY2vegGbBIPXn1j+P//P8OXn38ZPn77zXDxwSesBhBMB4QAxXkBAMaDOywJrob4AAAAAElFTkSuQmCC"});
            }
          }
        }
      }
      .component-choose-widget-modal-footer{
        position: absolute;
        bottom: 20px;
        right: 40px;
        >button{
          font-size: 14px;
          letter-spacing: 0.39px;
          text-align: center;
          vertical-align: middle;
        }
        button:first-of-type {
          background-color: #0075D0;
          border: 1px solid  #0075D0;
          border-radius: 3px;
          color: #ffffff;
        }
        button:last-of-type{
          background-color: #ffffff;
          border: 1px solid #CCCCCC;
          border-radius: 3px;
          color: #000000;
        }
      }
    }
  `},n=e=>{const t=e.theme;return s.css`
    width:100%;
    &.single-row-item {
        .select-con {
            padding: ${s.polished.rem(10)} ${s.polished.rem(0)};
            .option-name-con {
                margin-bottom: 0;
                .close-con>span {
                    margin-left: ${s.polished.rem(10)};
                }
            }
        }
    }
    .padding-0 {
        padding: 0;
    }
    .jimu-tree-item {
        margin-bottom:${s.polished.rem(10)};
    }
    .jimu-tree-item__draggable {
        box-shadow: 0 0 0 2px ${s.polished.rgba(t.ref.palette.white,.3)};
    }
    .add-option-btn {
        & {
            color:${t.sys.color.primary.light};
            margin-top:${s.polished.rem(10)};
            margin-bottom: ${s.polished.rem(17)};
            cursor: pointer;
            font-size:13px;
            overflow: hidden;
            padding: 0;
        }
        .add-option-icon{
            margin-right: 4px;
        }
    }
    .no-sort-remind {
        margin: 70px auto 0;
        color: ${t.ref.palette.neutral[700]};
        font-size: 13px;
        text-align: center;
    }
    .select-con {
        & {
            box-sizing:border-box;
            padding-right: ${s.polished.rem(10)};
            padding: ${s.polished.rem(8)} ${s.polished.rem(10)} ${s.polished.rem(10)} ${s.polished.rem(6)};
        }
        .option-name-con {
            & {
              display: flex;
              align-items: center;
              margin-bottom:${s.polished.rem(5)};
              width: 100%;
            }
            .option-name {
              font-size: 13px;
              line-height: 13px;
              color: ${t.ref.palette.neutral[1100]};
              height: ${s.polished.rem(30)};
              line-height: ${s.polished.rem(25)};
              cursor: pointer;
              overflow: hidden;
              width: 0;
              padding-right: ${s.polished.rem(4)};
              .edit-input {
                max-width: 88%;
                input {
                    width: 80px;
                }
                input:placeholder-shown {
                    text-overflow: ellipsis;
                }
              }
            }
            .option-name input {
                display:inline-block;
                width: auto;
                height: 100%;
            }
            .jimu-input {
                line-height: ${s.polished.rem(30)};
                vertical-align: middle;
            }
            .input-wrapper {
                vertical-align: middle;
            }
            .option-name-icon-con {
                margin-left: ${s.polished.rem(5)};
                svg {
                    margin-top:  ${s.polished.rem(5)};
                }
            }
            .option-name-icon {
                color: ${t.ref.palette.neutral[900]};
                cursor: pointer;
            }
            .option-name span {
                display: inline-block;
                text-overflow: ellipsis;
                overflow:hidden;
            }
            .close-con {
                svg {
                    margin: 0;
                    margin-top:  ${s.polished.rem(2)};
                }
            }
            .close-con>span {
                margin-right: ${s.polished.rem(10)};
                color: ${t.ref.palette.black};
                cursor: pointer;
            }
        }

        .select-down-con {
            & {
                display: flex;
                align-items: center;
                height: ${s.polished.rem(34)};
            }
            .sort-arrow-down-icon {
                margin-right: 0;
            }
            .select-input {
                flex-grow:1;
                color: ${t.ref.palette.neutral[1200]};
            }
            .sort-button {
                margin-left: 5px;
                cursor: pointer;
                border:none;
            }
            .sort-field-selector {
                & {
                    background:${t.sys.color.secondary.light};
                    border-radius: 2px;
                    flex-grow: 1;
                    width: 0;
                }
            }
        }
    }


  `},a=e=>{const t=e.theme;return s.css`
    .widget-setting--stylepicker {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 10px;
    }

    .widget-setting--stylepicker-item {
      height: 93px;
      border: 1px solid ${t.ref.palette.neutral[500]};
      background-color: ${t.ref.palette.white};
      background-repeat: no-repeat;
      background-position: center;
      &:hover {
        border-color: ${t.sys.color.primary.main};
      }
      &.active {
        border: 2px solid ${t.sys.color.primary.main};
      }
      &.full-width {
        grid-column-start: 1;
        grid-column-end: 3;
      }
    }
  `},r=e=>{var t,i,o,n,a,r;const l=null==e?void 0:e.isOpen,c=null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"default",d=e.theme,p=null===(o=null===(i=null==d?void 0:d.ref.palette)||void 0===i?void 0:i.neutral)||void 0===o?void 0:o[500],u=null===(a=null===(n=null==d?void 0:d.ref.palette)||void 0===n?void 0:n.neutral)||void 0===a?void 0:a[700],h=null===(r=null==d?void 0:d.sys.color)||void 0===r?void 0:r.primary.main;return"primary"!==c?s.css`
    .dividing-line {
      background-color: ${u};
    }
    `:s.css`
    .handle {
      border-top: 2px solid ${l?h:p};
      background-color: ${p};
      .title {
        padding-left: 8px;
        padding-right: 8px;
      }
    }
    .dividing-line {
      background-color: ${u};
    }
    `};function l(e){var t,i,o,n,a;const r=e.theme,l=null!==(o=null===(i=null===(t=null==r?void 0:r.ref)||void 0===t?void 0:t.palette)||void 0===i?void 0:i.neutral[500])&&void 0!==o?o:"#ccc",c=null!==(a=null===(n=null==r?void 0:r.sys)||void 0===n?void 0:n.color.primary.main)&&void 0!==a?a:"blue",d=s.polished.rgba(l,.5);return window.jimuConfig.isInBuilder?s.css`
    .widget-builder-link-selector {
      .collapse-btn{
        margin-right: ${s.polished.rem(-16)};
      }
      .option-name{
        font-size: ${s.polished.rem(13)};
        color: ${r.ref.palette.neutral[900]};
      }
      .link-selector-list {
        .view-border{
          border-width: 1px;
          border-style: solid;
        }
        .link-selector-list-item {
          height: ${s.polished.rem(30)};
          cursor: pointer;

          &:hover {
            background-color: ${d};
          }
        }

        .link-selector-list-select {
          background-color: ${d};
        }
      }

      select {
        padding-top: ${s.polished.rem(2)} !important;
      }

      .item-selected {
        background-color: ${c} !important;
      }

      .form-check-input {
        span {
          background: #00A6B6 !important;
        }
      }

      .form-check-input:hover {
        border-color: gray;
      }

      input[type='radio'].form-check-input {
        -webkit-appearance: none;
        -moz-appearance: none;
        background: transparent;
        border: 1px solid #000;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        transition: all 0.2s ease;
        &:before {
        content: '';
        display: block;
        position: absolute;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: #00A6B6 !important;
        margin: 8px;
        transition: all 0.2s ease-out;
        }
        &:hover {
        border-color: #00A6B6 !important;
        }
        &:checked {
        &:before {
            width: 8px;
            height: 8px;
            margin: 3px;
        }
        }
      }
      .link-setting-cursor-pointer{
        cursor: pointer;
      }
      .open-type-label{
        width: 100%;
        display: block;
      }
    }
    .url-error-container{
      *{
        color: ${r.sys.color.error.main};
      }
      div{
        width: calc(100% - 20px);
        margin-left: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
  `:s.css`
    .widget-builder-link-selector {
      .collapse-btn{
        position: absolute;
        right: ${s.polished.rem(-4)};
      }
      .option-name{
        font-size: ${s.polished.rem(13)};
        color: ${r.ref.palette.neutral[900]};
        font-weight: 500;
      }
      .item-common{
        background: ${r.ref.palette.white};
      }
      .view-border{
        border: 1px solid ${r.ref.palette.neutral[500]};
      }
      .link-selector-list {

        .link-selector-list-item {
          height: ${s.polished.rem(30)};
          cursor: pointer;

          &:hover {
            background-color: ${d};
          }
        }

        .link-selector-list-select {
          background-color: ${d};
        }
      }

      select {
        padding-top: ${s.polished.rem(2)} !important;
      }

      .item-selected {
        background-color: ${c} !important;
      }
      .link-setting-cursor-pointer{
        cursor: pointer;
      }
      .open-type-label{
        width: 100%;
        display: block;
      }
      .url-error-container{
        *{
          color: ${r.sys.color.error.main};
        }
        div{
          width: calc(100% - 20px);
          margin-left: 4px;
          overflow: hidden;
          text-overflow: ellipsis;
        }
      }
    }
  `}function c(e){const t=e.theme;return s.css`
    color: ${t.ref.palette.neutral[1e3]};
    .font-size-13{
      font-size: ${s.polished.rem(13)} !important;
    }
    .subscriber-warning{
      font-size: ${s.polished.rem(13)};
    }
    .secondary-title{
      font-size: ${s.polished.rem(14)};
    }
    .content-table{
      font-size: ${s.polished.rem(13)};
      color: ${t.ref.palette.neutral[1100]};
    }
    .content-table-header{
      height: ${s.polished.rem(32)};
      background-color: ${t.ref.palette.neutral[500]};
      display: block;
      line-height: ${s.polished.rem(30)};
    }
    .content-table-tr{
      height: ${s.polished.rem(39)};
      line-height: ${s.polished.rem(39)};
      border-bottom: 1px solid ${t.ref.palette.neutral[500]};
    }
    .col-4, .col-2{
      height: 100%;
    }
    .request-limit{
      margin-top: ${s.polished.rem(6)};
    }
    .request-interval{
      display: block;
      margin-top: ${s.polished.rem(-3)};
    }
  `}function d(e){const t=e.theme;return s.css`
    max-width: ${s.polished.rem(960)} !important;
    .header{
      font-size: ${s.polished.rem(16)};
      color: ${t.ref.palette.neutral[1e3]};
    }
    .proxy-setting-container{
      width: ${s.polished.rem(960)};
      height: ${s.polished.rem(640)};
      border: 0;
      color: ${t.ref.palette.neutral[1e3]};
    }
    .px-30{
      padding-right: ${s.polished.rem(30)};
      padding-left: ${s.polished.rem(30)};
    }
  `}const p=e=>{const t=e.theme,i=e.gutter;return s.css`
    margin-bottom: 0;
    label {
      display: inline-flex;
      align-items: center;
      margin-right: ${i||t.sys.spacing(4)};
      .jimu-radio {
        margin-right: 8px;
      }
    }
  `};function u(e){const t=e.theme;return s.css`
    width: ${s.polished.rem(260)};
    height: calc(100vh - 70px);
    padding: 0;
    overflow: hidden;
    border-radius: 0;
    box-shadow: 0 0 0;
    border-left: 1px solid ${t.ref.palette.neutral[700]};
    border-right: 1px solid ${t.ref.palette.neutral[700]};
    border-top: 0;
    border-bottom: 0;
    margin: 0 !important;
  `}const h=e=>{const t=e.theme;return s.css`
    .dropdown-menu--inner {
      background-color: ${t.sys.color.secondary.light};
      padding: 0;
    }

    .dropdown-toggle-content {
      width: 100%;
    }

    .layerviewselector-input {
      width: 100%;
      height: 30px !important;
      background-color: ${t.sys.color.secondary.light};
      &:hover {
        background-color: ${t.sys.color.secondary.light};
      }
      flex-direction: unset !important;
    }

    .layerviewselector-input-text {
      max-width: calc(100% - 13px);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .layerviewselector-bg {
      max-height: 270px;
      overflow-y: auto;
      background-color: ${t.sys.color.secondary.light};
    }

    .layerviewselector-item-bg {
      cursor: pointer;
    }

    .layerviewselector-item-bg:hover {
      background-color: ${t.sys.color.primary.main};
    }

    .layerviewselector-ds-item {
      cursor: pointer;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      width: 100%;
    }

    .layerviewselector-ds-item:hover {
      background-color: ${t.sys.color.primary.main};
    }

    .layerviewselector-ds-item-selected {
      background-color: ${t.sys.color.primary.main};
    }
  `};var m=v(1888);function g(e,t){const i=e.sizes[t];return`\n    height: ${"auto"!==i.height?i.height:function(e,t){const i=s.polished.math(`\n    ${e.fontSize} * ${e.lineHeight} +\n    ${e.paddingY} * 2`);return"0"===t.toString()?i:`calc(${i} + ${t} * 2)`}(i,e.border.width)};\n    padding: ${i.paddingY} ${i.paddingX};\n    font-size: ${i.fontSize};\n    line-height: ${i.lineHeight};\n    border-radius: ${i.borderRadius};\n  `}const y=e=>{var t;const i=e.theme,o=null==e?void 0:e.buttonProps;let n={bg:i.ref.palette.white,color:i.ref.palette.black,border:{color:i.ref.palette.neutral[500],width:"1px"},boxShadow:null,transition:"border-color .15s ease-in-out, box-shadow .15s ease-in-out",focus:{borderColor:i.sys.color.primary.main,boxShadow:null,bg:void 0},sizes:{default:{fontSize:i.sys.typography.inputField.fontSize,lineHeight:1.5,paddingX:i.sys.spacing(2),paddingY:i.sys.spacing(1),borderRadius:i.sys.shape.shape1,height:"32px"},sm:{fontSize:i.sys.typography.body.fontSize,lineHeight:1,paddingX:i.sys.spacing(2),paddingY:i.sys.spacing(1),borderRadius:i.sys.shape.shape1,height:"26px"},lg:{fontSize:i.sys.typography.h5.fontSize,lineHeight:1.5,paddingX:i.sys.spacing(2),paddingY:i.sys.spacing(2),borderRadius:i.sys.shape.shape1,height:"40px"}}};return"builder/themes/dark/"===i.uri?n=s.lodash.merge(n,{bg:"#181818",border:{color:"#181818",width:"1px"},sizes:{default:{fontSize:"0.875rem",lineHeight:1.5,paddingX:"0.375rem",paddingY:"0.25rem"},sm:{fontSize:"0.8125rem",lineHeight:1.5,paddingX:"0.375rem",paddingY:0,height:"1.625rem"},lg:{fontSize:"1rem",lineHeight:1.5,paddingX:"0.5rem",paddingY:"0.5rem"}}}):"themes/ink/"===i.uri?n=s.lodash.merge(n,{border:{color:"var(--ref-palette-neutral-700)",width:"1px"},focus:{borderColor:"var(--sys-color-primary-dark)"}}):"themes/morandi/"===i.uri&&(n=s.lodash.merge(n,{bg:"var(--ref-palette-neutral-300)",border:{color:"var(--ref-palette-neutral-300)",width:"1px"}})),s.css`
    width: 100%;
      > .dropdown{
        > .dropdown-button {
          text-align: start;
        }
      }
      ${null!==(t=null==o?void 0:o.type)&&void 0!==t?t:s.css`
      /* Button override */
        > .dropdown{
          > .dropdown-button {
            &,
            &:hover {
              color: ${n.color};
              background-color: ${n.bg};
              background-clip: padding-box;
              box-shadow: ${n.boxShadow};
              transition: ${n.transition};
              text-decoration: none;
              ${g(n,"sm")}
              ${(0,m.getBoxStyles)(n)}
            }
            &[aria-expanded="true"] {
              color: ${n.color};
              background-color: ${n.focus.bg};
              border-color: ${n.focus.borderColor};
              text-decoration: none;
              box-shadow: ${n.boxShadow}, ${n.focus.boxShadow};
            }
          }
        }
      `}

  `},b=e=>{const t=e.isInDropdown?"366px":"calc(100% - 34px)";return s.css`
    .button-container {
      display: flex;
      justify-content: space-between;
      .search-input {
        width: calc(100% - 32px);
      }
      .layer-label {
        font-size: 14px;
        color: ${e.theme.sys.color.surface.paperHint};
        font-weight: 600;
        margin-left: 2px;
      }
      .right-buttons {
        display: flex;
        gap: var(--sys-spacing-1);
      }
    }
    .tree-container{
      margin-top: 16px;
      ${e.autoHeight?"":`height: ${t};`}
      ${e.autoHeight?"min-height: 164px;":""}
    }
    `};var S=v(4108),x=v(67386),w=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const C=(0,m.styled)("div")(({theme:e})=>({padding:e.sys.spacing(4),borderBottom:`1px solid ${e.sys.color.divider.secondary}`,"&:last-child":{borderBottom:"none"},"&:nth-of-type(1):nth-last-of-type(1)":{borderBottom:"none"},".jimu-widget-setting--section-header":{"> h6":{color:e.sys.color.surface.paperText,marginBottom:0},"+ *":{marginTop:e.sys.spacing(4)},"&.row":{marginLeft:0,marginRight:0}}})),j=s.React.forwardRef((e,t)=>{const{className:i,title:o,children:n}=e,a=w(e,["className","title","children"]),r=(0,s.classNames)(i,"jimu-widget-setting--section");return(0,x.jsxs)(C,Object.assign({styleState:e,className:r,ref:t},a,{children:[o&&(0,x.jsx)("div",{className:"jimu-widget-setting--section-header",children:"string"==typeof o?(0,x.jsx)("h6",{className:"w-100 title2 hint-paper",children:o}):(0,x.jsx)("div",{className:"w-100 text-truncate title2 hint-paper",children:o})}),n]}))}),I=(0,m.styled)("div")(({theme:e,styleState:t})=>{const i=t.flow,s=t.level,o=1===s?e.sys.typography.title2:e.sys.typography.title3;return{margin:0,"+ .jimu-widget-setting--row":{marginTop:e.sys.spacing(4)},"&.bottom-line":{paddingBottom:e.sys.spacing(4),borderBottom:`1px solid ${e.sys.color.divider.secondary}`},"> .jimu-widget-setting--row-label":{display:"inline-block",marginBottom:"wrap"===i?e.sys.spacing(2):0,marginRight:e.sys.spacing(5),fontFamily:o.fontFamily,fontSize:o.fontSize,fontWeight:o.fontWeight,lineHeight:o.lineHeight,color:1===s?e.sys.color.surface.paperHint:2===s?e.sys.color.surface.backgroundText:e.sys.color.surface.backgroundHint},"> input":{'[type="number"]':{width:"50px",flexShrink:0,"&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:0}}},"&.form-inline":{flexWrap:"nowrap",".jimu-widget-setting--row-label":{maxWidth:"80%","+ *":{flexShrink:0}}}}}),k=s.React.forwardRef((e,t)=>{const{flow:i,truncateLabel:o=!1,label:n,role:a,indented:r,className:l,level:c=3,"aria-label":d,bottomLine:p=!1,tag:u="div",children:h}=e,m=Object.assign({level:c,truncateLabel:o},e),g="string"==typeof n?n:"",v=(0,s.classNames)(l,"jimu-widget-setting--row row form-group align-items-center",{"form-inline":"wrap"!==i,"bottom-line":p,"pl-5":r}),f="div"===u?"label":"span";return(0,x.jsxs)(I,{ref:t,styleState:m,as:u,className:v,role:a,"aria-label":d,children:[n&&(0,x.jsx)(f,{title:g,className:(0,s.classNames)("jimu-widget-setting--row-label justify-content-start flex-grow-1 text-break",{"w-100 mr-0":"wrap"===i,"text-truncate":o}),children:n}),h]})});var O=v(14321),T=v(41496);const P={label:"divider",divider:!0},N=(e,t)=>{var i,s;let o=[],n=[];for(let i=1;i<t.length;i++)if("dialogs"===t[i].type){e=i;break}return 1===e&&"dialogs"===(null===(i=t[1])||void 0===i?void 0:i.type)?n=t.slice(1):1===e&&"pages"===(null===(s=t[1])||void 0===s?void 0:s.type)?o=t.slice(1):(o=t.slice(1,e),n=t.slice(e)),{pageList:o,dialogList:n}};var M;!function(e){e.Page="pages",e.Dialog="dialogs",e.Widget="widgets"}(M||(M={}));const L=(e,t,i)=>e.sort((e,s)=>{const o=i===M.Widget?t[i][e].label:t[i][e.id].label,n=i===M.Widget?t[i][s].label:t[i][s.id].label;return o.localeCompare(n,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})}),{useState:D}=s.React,A=e=>{var t;const{autoSelect:i=!0,onSelect:o,showLabel:n=!1,warningMessage:a="",isNeedConfirmBeforeChange:r}=e,l=s.hooks.useTranslation(O.defaultMessages),[c,d]=D(!1),[p,u]=D(null),h={id:"none",label:l("none")},m=s.ReactRedux.useSelector(e=>{var t,i;return(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig:e.appConfig}),g=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.browserSizeMode}),v=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo.currentPageId}),f=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo.currentDialogId}),y=f?s.ContainerType.Dialog:s.ContainerType.Page,b=f||v,S=s.React.useMemo(()=>((e,t,i,o)=>{const n=[];if(e[0].maps.length>0){n.push(P);const a={header:!0,label:i===s.ContainerType.Dialog?o("currentWindow"):o("currentPage")};n.push(a),L(e[0].maps,t,M.Widget).forEach(e=>{const a={id:e,label:t.widgets[e].label,headerLabel:i===s.ContainerType.Dialog?o("currentWindow"):o("currentPage")};n.push(a)})}const a=N(1,e);let r=!1;const l=L(a.pageList,t,M.Page);for(let e=0;e<a.pageList.length;e++)if(a.pageList[e].maps.length>0){r||(n.push(P),r=!0);const i={header:!0,label:t.pages[l[e].id].label};n.push(i),L(l[e].maps,t,M.Widget).forEach(i=>{const s={id:i,label:t.widgets[i].label,headerLabel:t.pages[l[e].id].label};n.push(s)})}if(a.dialogList){let e=!1;const i=L(a.dialogList,t,M.Dialog);for(let s=0;s<a.dialogList.length;s++)if(a.dialogList[s].maps.length>0){e||(n.push(P),e=!0);const o={header:!0,label:t.dialogs[i[s].id].label};n.push(o),L(i[s].maps,t,M.Widget).forEach(e=>{const o={id:e,label:t.widgets[e].label,headerLabel:t.dialogs[i[s].id].label};n.push(o)})}}return n})(T.searchUtils.getMapWidgets(m,g,y,b),m,y,l),[m,g,y,b,l]),[w,C]=D((null===(t=e.useMapWidgetIds)||void 0===t?void 0:t[0])||null),j=s.React.useRef(w);s.hooks.useUpdateEffect(()=>{var t,i;C((null===(t=e.useMapWidgetIds)||void 0===t?void 0:t[0])||null),j.current=(null===(i=e.useMapWidgetIds)||void 0===i?void 0:i[0])||null},[e.useMapWidgetIds]),s.React.useEffect(()=>{if(i&&!e.useMapWidgetIds){const e=T.searchUtils.getMapWidgets(m,g,y,b),t=1===e[0].maps.length?e[0].maps[0]:null;t&&(null==o||o([t]))}},[]);const I=e=>{const t=e.target.value;if(t===w)return;const i=t===h.id?[]:[t];r?null===j.current?(null==o||o(i),C(t)):d(!0):(null==o||o(i),C(t)),u(t)},k=(()=>{var t;if(!e.useMapWidgetIds||0===(null===(t=e.useMapWidgetIds)||void 0===t?void 0:t.length))return null;const i=e.useMapWidgetIds[0];return S.find(e=>e.id===i)||null})();return(0,x.jsxs)("div",{className:"w-100 component-map-selector",children:[n&&(0,x.jsx)(O.Label,{title:l("selectMapWidget"),className:"jimu-widget-setting--row-label justify-content-start flex-grow-1 text-break title3 hint-default w-100 mr-0",children:l("selectMapWidget")}),(0,x.jsx)(O.Select,{size:"sm",value:k?k.id:h.id,"aria-label":e["aria-label"]||l("selectMapWidget"),"aria-describedby":e["aria-describedby"],"ally-description":e["ally-description"],children:[h].concat(S).map((e,t)=>(0,x.jsxs)(O.Option,{header:e.header,divider:e.divider,value:e.id,onClick:I,children:[!e.header&&(0,x.jsx)("div",{className:"sr-only",children:e.headerLabel}),e.label]},t))}),a&&(0,x.jsx)(O.Alert,{tabIndex:0,className:"w-100 mt-2",open:!0,text:a,type:"warning"}),c&&(0,x.jsx)(O.ConfirmDialog,{level:"info",title:l("confirmTitle"),hasNotShowAgainOption:!1,content:e.confirmMessage,onConfirm:()=>{d(!1);const e=p,t=e===h.id?[]:[e];null==o||o(t),C(p)},onClose:()=>{d(!1)}})]})},R=A;class E extends s.React.PureComponent{constructor(e){super(e),this.getIsLoading=()=>!!this.props.fromRootDsIds&&this.props.fromRootDsIds.some(e=>this.getIsSingleDsLoading(e)),this.getIsSingleDsLoading=e=>{const t=s.DataSourceManager.getInstance().getDataSource(e),i=null==t?void 0:t.getInfo();return!!i&&(i.instanceStatus!==s.DataSourceStatus.CreateError&&(i.instanceStatus!==s.DataSourceStatus.Created||!!t.isDataSourceSet()&&!t.areChildDataSourcesCreated()))},this.formatMessage=(e,t)=>{const i=Object.assign({},O.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.state={isLoading:this.getIsLoading()}}componentDidMount(){this.state.isLoading&&this.waitChildDssReady().finally(()=>{this.setState({isLoading:!1})})}componentDidUpdate(e){e.fromRootDsIds!==this.props.fromRootDsIds&&this.setState({isLoading:this.getIsLoading()}),this.state.isLoading&&this.waitChildDssReady().finally(()=>{this.setState({isLoading:!1})})}waitChildDssReady(){return this.props.fromRootDsIds?Promise.all(this.props.fromRootDsIds.map(e=>this.waitChildDssReadyForSingleDs(e))).catch(e=>[]):Promise.resolve([])}waitChildDssReadyForSingleDs(e){const t=s.DataSourceManager.getInstance().getDataSource(e);return(null==t?void 0:t.isDataSourceSet())&&!t.areChildDataSourcesCreated()?t.childDataSourcesReady().then(()=>t):Promise.resolve(t)}getContent(){var e,t,i,o;const n=[];for(let e=0;e<this.props.fromRootDsIds.length;e++)n.push(this.props.fromRootDsIds[e]);const a=(null===(e=null===window||void 0===window?void 0:window.jimuConfig)||void 0===e?void 0:e.isBuilder)?null===(i=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig:null===(o=(0,s.getAppStore)().getState())||void 0===o?void 0:o.appConfig;return(0,x.jsx)("div",{className:"w-100",children:n.map((e,t)=>{var i;const o=s.DataSourceManager.getInstance().getDataSource(e),n=null===(i=a.dataSources[e])||void 0===i?void 0:i.sourceLabel,r=(e=>{var t,i,o;return(null===(o=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.dataSourcesInfo)||void 0===i?void 0:i[e])||void 0===o?void 0:o.instanceStatus)===s.DataSourceStatus.CreateError})(e),l=(null==o?void 0:o.isDataSourceSet())&&(null==o?void 0:o.getChildDataSources());return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"hint-paper pl-2 pr-2 d-flex align-items-center justify-content-between",style:{fontSize:"14px"},children:[n,r&&(0,x.jsx)(O.Alert,{variant:"text",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})]}),null==l?void 0:l.map((t,i)=>(0,x.jsx)("div",{className:"mt-1 mb-1",children:(0,x.jsx)("div",{className:(0,s.classNames)("layerviewselector-ds-item pl-2 pr-2",{"layerviewselector-ds-item-selected":this.props.selectedDsIds&&this.props.selectedDsIds.includes(t.id)}),title:t.getLabel(),onClick:()=>{this.props.onSelect&&this.props.onSelect({rootDataSourceId:e,dataSourceId:t.id})},children:null==t?void 0:t.getLabel()})},i))]},t)})})}render(){return this.props.fromRootDsIds&&0!==this.props.fromRootDsIds.length?(0,x.jsx)("div",{className:"w-100",children:this.state.isLoading?(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary,width:24,height:16}):this.getContent()}):null}}const F=(0,s.injectIntl)(E),B=s.css`
& {
  .ds-selector > span {
    display: none;
  }
}
`;class U extends s.React.PureComponent{constructor(e){super(e),this.selectorConRef=s.React.createRef(),this.toggleList=e=>{this.setState({listOpen:!this.state.listOpen})},this.onResize=({width:e,height:t})=>{this.setState({width:e})},this.handleChooseLayer=e=>{if(this.props.onSelect)if(e){const t=s.DataSourceManager.getInstance().getDataSource(e.rootDataSourceId),i=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId).id,o=t.isDataSourceSet()&&t.getJimuChildId(i)[0];this.props.onSelect((0,s.Immutable)({jimuMapViewId:`${this.props.useMapWidgetIds[0]}-${e.rootDataSourceId}`,jimuLayerId:o,dataSourceId:e&&e.dataSourceId,rootDataSourceId:e&&e.rootDataSourceId}))}else this.props.onSelect((0,s.Immutable)({}));this.setState({listOpen:!1})},this.handleClickNone=()=>{this.props.onSelect&&this.props.onSelect((0,s.Immutable)({})),this.setState({listOpen:!1})},this.getTitle=()=>this.props.jimuLayerViewInfo&&this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0]&&this.props.jimuLayerViewInfo.dataSourceId?(0,x.jsx)(s.DataSourceComponent,{useDataSource:(0,s.Immutable)({dataSourceId:this.props.jimuLayerViewInfo.dataSourceId,mainDataSourceId:this.props.jimuLayerViewInfo.dataSourceId,rootDataSourceId:this.props.jimuLayerViewInfo.rootDataSourceId}),children:(e,t,i)=>null==e?void 0:e.getLabel()}):this.getNoneString(),this.getContent=()=>{const e=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],t=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e];return t&&t.useDataSources&&t.useDataSources[0]?(0,x.jsxs)("div",{className:"w-100 mt-1 mb-2",children:[(0,x.jsx)("div",{onClick:()=>{this.handleClickNone()},children:(0,x.jsx)("div",{className:"layerviewselector-ds-item pl-2 pr-2",children:this.getNoneString()})}),(0,x.jsx)("div",{className:"w-100 mt-1 mb-1",children:(0,x.jsx)("div",{className:"w-100 border border-bottom-0 border-right-0 border-left-0"})}),(0,x.jsx)("div",{className:"ds-selector",children:(0,x.jsx)(s.MultipleDataSourceComponent,{useDataSources:t.useDataSources,children:(e,t)=>{const i=(0,s.Immutable)(Object.keys(e)),o=[];return this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.dataSourceId&&o.push(this.props.jimuLayerViewInfo.dataSourceId),(0,x.jsx)(F,{fromRootDsIds:i,onSelect:e=>{this.handleChooseLayer(e)},selectedDsIds:(0,s.Immutable)(o)})}})})]}):this.getEmptyContent()},this.getNoneString=()=>this.props.intl.formatMessage({id:"none",defaultMessage:"None"}),this.getEmptyContent=()=>(0,x.jsx)("div",{className:"w-100 mt-1 mb-2",children:(0,x.jsx)("div",{className:"layerviewselector-ds-item pl-2 pr-2",onClick:()=>{this.handleClickNone()},children:this.getNoneString()})}),this.state={listOpen:!1,width:0}}render(){return(0,x.jsxs)("div",{ref:this.selectorConRef,className:(0,s.classNames)("w-100",{[this.props.className]:!!this.props.className}),children:[(0,x.jsxs)(O.Dropdown,{size:"sm",toggle:e=>{this.toggleList(e)},isOpen:this.state.listOpen,className:"w-100",children:[(0,x.jsx)(O.DropdownButton,{size:"sm",type:"tertiary",className:(0,s.classNames)("w-100 d-flex flex-column align-items-center toollist-item","justify-content-between toollist-item-click layerviewselector-input"),children:(0,x.jsx)("div",{className:"w-100 d-flex justify-content-between align-items-center",children:(0,x.jsx)("div",{className:"layerviewselector-input-text ml-2",children:this.getTitle()})})}),(0,x.jsx)(O.DropdownMenu,{className:(0,s.classNames)("ml-0 mr-0 mb-0 mt-1 p-0",{[this.props.className]:!!this.props.className}),css:B,children:(0,x.jsx)("div",{className:"w-100 h-100 layerviewselector-bg",children:(0,x.jsx)("div",{style:{width:`${this.state.width}px`},children:this.getContent()})})})]}),(0,x.jsx)(s.ReactResizeDetector,{targetRef:this.selectorConRef,handleWidth:!0,onResize:this.onResize})]})}}const z=(0,s.injectIntl)((0,m.withStyles)(U,"JimuLayerViewSelectorDeprecated"));var $=v(50170),V=v.n($),W=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const G=e=>{const t=window.SVG,{className:i}=e,o=W(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:V()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var H=v(98640),_=v(62686),J=v(13424),K=v.n(J),q=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const X=e=>{const t=window.SVG,{className:i}=e,o=q(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:K()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))},Y=(e,t)=>e.itemChildren&&0!==e.itemChildren.length?(e.itemChildren=e.itemChildren.sort((e,i)=>t[e.itemKey].index-t[i.itemKey].index),e.itemChildren.forEach(e=>Y(e,t)),e):e,Q=(e,t)=>{if(!e.itemChildren||0===e.itemChildren.length)return e.itemStateTitle.toLowerCase().includes(t.toLowerCase())?e:null;const i=e.itemChildren.map(e=>Q(e,t)).filter(Boolean);return i.length>0&&(e.itemStateExpanded=!0),0===i.length?e.itemStateTitle.toLowerCase().includes(t.toLowerCase())?e:null:(e.itemChildren=i,e)},Z=e=>{const t={};return e.forEach(e=>{t[e.id]=e}),t},ee=e=>{const{jimuMapViewId:t,hideLayers:i,disableLayers:o,isMultiSelection:n=!1,selectedValues:a,isShowTables:r=!1}=e,l=s.hooks.useTranslation(O.defaultMessages),{useState:c,useEffect:d,useMemo:p,useRef:u}=s.React,[h,m]=c(""),[g,f]=c(!1),[y,b]=c(null),[S,w]=c(null),[C,j]=c(null),[I,k]=c(!0),[T,P]=c(!1),N=u(null);d(()=>{const e=_.MapViewManager.getInstance().getJimuMapViewById(t);if(!e)return;k(!0),e.whenJimuMapViewLoaded().then(()=>{k(!1),r&&j(e.jimuTables)});const i=e.getAllJimuLayerViews();w(Z(i));const s=()=>{const t=e.getAllJimuLayerViews();w(Z(t))};return e.addJimuLayerViewCreatedListener(s),()=>{null==e||e.removeJimuLayerViewCreatedListener(s)}},[r,t]);const[M,L]=c([]);d(()=>{if(!S)return;const e=((e,t,i,s,o,n,a)=>{const r={itemKey:"root item",itemStateTitle:"root item",itemChildren:[]},l={};for(const i of Object.keys(e)){const n=!!t&&t(e[i],e),a=(null==s?void 0:s.length)>0&&s.includes(i);l[i]={itemKey:i,itemStateTitle:e[i].layer.title,itemChildren:[],isItemSelectable:!n,itemStateChecked:!n&&a,itemStateExpanded:o.includes(i)}}for(const[t,s]of Object.entries(e)){const{parentJimuLayerViewId:o}=s;if(!e[t].fromRuntime){const s=l[t];i&&i(e[t],e)||(null===o?r.itemChildren.push(s):l[o].itemChildren.push(s))}}const c=Y(r,e);if(n){const e={};for(const t of Object.keys(null!=a?a:{})){const i=(null==s?void 0:s.length)>0&&s.includes(t);e[t]={itemKey:t,itemStateTitle:a[t].title,itemChildren:[],isItemSelectable:!0,itemStateChecked:i,itemStateIcon:{icon:v(18249)}},c.itemChildren.push(e[t])}}return c})(S,o,i,a,M,r,C);b(e)},[S,o,i,a,M,r,C]),d(()=>{g&&N.current&&((0,s.focusElementInKeyboardMode)(N.current,!0),N.current.select())},[g]);const D=p(()=>{if(h){const e=JSON.parse(JSON.stringify(y)),t=Q(e,h);if(t)return t;return{itemKey:"root item",itemStateTitle:"root item",itemChildren:[]}}return y},[y,h]),A=(t,i,s)=>{const o=JSON.parse(JSON.stringify(t)),n=[],a=[];o.itemChildren.forEach(function e(t){const o=t.itemStateChecked,r=t.isItemSelectable;"itemStateChecked"===i&&s&&t.isItemSelectable||"toggleAll"===i&&!o&&r?a.push(t.itemKey):"itemStateExpanded"===i&&n.push(t.itemKey),t.itemChildren&&t.itemChildren.length>0&&t.itemChildren.forEach(e)}),"itemStateChecked"===i?s?e.onChange(a):e.onChange([]):"toggleAll"===i?e.onChange(a):"itemStateExpanded"===i&&L(s?n:[])};return(0,x.jsxs)("div",{className:(0,s.classNames)("component-layer-view-selector","w-100 h-100",e.className||""),role:"group","aria-label":l("layers"),children:[(0,x.jsxs)("div",{className:"button-container",children:[(0,x.jsx)(O.TextInput,{allowClear:!0,size:"sm",type:"text",className:(0,s.classNames)("search-input",{"d-none":!g}),value:h,placeholder:l("SearchLabel"),onChange:e=>{const t=e.target.value;m(t)},"aria-label":l("SearchLabel"),ref:N}),(0,x.jsx)(O.Label,{className:(0,s.classNames)("layer-label",{"d-none":g}),title:l("layers"),check:!0,children:l("layers")}),(0,x.jsxs)("div",{className:"right-buttons",children:[(0,x.jsxs)(O.Dropdown,{className:(0,s.classNames)({"d-none":g}),isOpen:T,toggle:()=>{P(!T)},"aria-label":l("batchOptions"),children:[(0,x.jsx)(O.DropdownButton,{className:"batch-option-btn",onClick:()=>{P(!T)},arrow:!1,icon:!0,type:"tertiary",variant:"text",size:"sm",title:l("batchOptions"),children:(0,x.jsx)(X,{autoFlip:!0})}),(0,x.jsx)(O.DropdownMenu,{children:(n?[{value:"selectAll",label:l("selectAllAvailableLayers")},{value:"unselectAll",label:l("unselectAllAvailableLayers")},{value:"toggleAll",label:l("toggleAll")},{value:"divider",divider:!0},{value:"expandAll",label:l("expandAllLayers")},{value:"collapseAll",label:l("collapseAllLayers")}]:[{value:"expandAll",label:l("expandAllLayers")},{value:"collapseAll",label:l("collapseAllLayers")}]).map(e=>(0,x.jsx)(O.DropdownItem,{divider:e.divider,onClick:()=>{(e=>{switch(e){case"selectAll":A(y,"itemStateChecked",!0);break;case"unselectAll":A(y,"itemStateChecked",!1);break;case"expandAll":A(y,"itemStateExpanded",!0);break;case"collapseAll":A(y,"itemStateExpanded",!1);break;case"toggleAll":A(y,"toggleAll")}})(e.value)},title:e.label,children:e.label},e.value))})]}),(0,x.jsx)(O.Button,{type:"tertiary",size:"sm",icon:!0,title:l("SearchLabel"),onClick:()=>{f(!g),m("")},children:(0,x.jsx)(G,{})})]})]}),(0,x.jsx)("div",{className:"tree-container",children:I?(0,x.jsx)(O.Loading,{className:"w-100 h-100",type:O.LoadingType.Secondary}):(0,x.jsx)(H.Tree,{className:"w-100",collapseStyle:H.TreeCollapseStyle.Arrow,dndEnabled:!1,onUpdateItem:(t,i)=>{var s,o;if(t.updateType===H.TreeItemActionType.HandleExpandItem){const e=null===(s=t.currentItemJson)||void 0===s?void 0:s.itemKey,i=null===(o=t.changeItemJson)||void 0===o?void 0:o.itemStateExpanded;e&&L(t=>i?[...t,e]:t.filter(t=>t!==e))}if(t.updateType===H.TreeItemActionType.HandleCheckboxChanged){const[i]=t.itemJsons;if(n){const t=a?[...a]:[];i.isItemSelectable&&i.itemStateChecked?t.push(i.itemKey):i.isItemSelectable&&!1===i.itemStateChecked&&t.splice(t.indexOf(i.itemKey),1),e.onChange(t)}else i.isItemSelectable&&i.itemStateChecked?e.onChange([i.itemKey]):i.isItemSelectable&&!1===i.itemStateChecked&&e.onChange([])}},rootItemJson:D||y,isMultiSelection:n,checkboxLinkage:!1,size:"sm",treeAlignmentType:H.TreeAlignmentType.Intact,disableDoubleClickTitle:!0,treeStyle:H.TreeStyle.Basic,singleLineText:!0,searchedText:h})})]})},te=(0,m.withStyles)(ee,"JimuLayerViewSelector"),ie=e=>{const t=s.hooks.useTranslation(O.defaultMessages),{useRef:i,useState:o}=s.React,n=i(null),[a,r]=o(!1);return(0,x.jsx)("div",{className:(0,s.classNames)("component-layer-view-selector-dropdown","w-100",e.className||""),children:(0,x.jsxs)(O.Dropdown,{className:"w-100",direction:"down",toggle:()=>{r(!a)},isOpen:a,autoWidth:!0,children:[(0,x.jsx)(O.DropdownButton,{ref:e=>{n.current=e},role:"combobox",children:(()=>{var i;const{selectedValues:s,isMultiSelection:o,jimuMapViewId:n}=e,a=(null==s?void 0:s.length)||0;if(0===a)return t("numSelected",{number:a});if(o)return t("numSelected",{number:a});{const e=_.MapViewManager.getInstance().getJimuMapViewById(n);return null===(i=null==e?void 0:e.jimuLayerViews[s[0]])||void 0===i?void 0:i.layer.title}})()}),(0,x.jsx)(O.DropdownMenu,{className:"shadow-3",css:s.css`
      ${n?`\n          width: ${s.polished.rem(1.5*(null===(l=n.current)||void 0===l?void 0:l.clientWidth))} !important;\n        `:""}
      padding: 16px;
    `,alignment:"end",children:(0,x.jsx)(te,Object.assign({},e,{isInDropdown:!0}))})]})});var l},se=(0,m.withStyles)(ie,"JimuLayerViewSelectorDropdown"),oe=e=>{var t,i,o,n,a,r;if(!e)return"";const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(n=(0,s.getAppStore)().getState())||void 0===n?void 0:n.appConfig;return(null===(a=l.dataSources[e])||void 0===a?void 0:a.label)||(null===(r=l.dataSources[e])||void 0===r?void 0:r.sourceLabel)},ne=e=>{const t=s.hooks.useTranslation(O.defaultMessages),i={id:"none",label:t("none")},o=s.ReactRedux.useSelector(e=>{var t,i;return(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig:e.appConfig}),n=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.browserSizeMode}),a=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo.currentPageId}),r=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo.currentDialogId}),l=r?s.ContainerType.Dialog:s.ContainerType.Page,c=r||a,d=s.React.useMemo(()=>{const e=T.searchUtils.getMapWidgets(o,n,l,c);return(()=>{const i=[],n=e[0].maps.length>0;let a=!1;if(n){L(e[0].maps,o,M.Widget).forEach((e,n)=>{if(o.widgets[e].useDataSources&&o.widgets[e].useDataSources.length>0){a||(i.push(P),a=!0);const n={header:!0,label:`${l===s.ContainerType.Dialog?t("currentWindow"):t("currentPage")} | ${o.widgets[e].label}`};i.push(n),o.widgets[e].useDataSources.forEach(n=>{const a={id:`${e}-${n.dataSourceId}`,label:oe(n.dataSourceId),headerLabel:`${l===s.ContainerType.Dialog?t("currentWindow"):t("currentPage")} ${o.widgets[e].label}`};i.push(a)})}})}const r=N(1,e);let c=!1;const d=L(r.pageList,o,M.Page);for(let e=0;e<r.pageList.length;e++){const t=L(d[e].maps,o,M.Widget);for(let s=0;s<t.length;s++)if(o.widgets[t[s]].useDataSources&&o.widgets[t[s]].useDataSources.length>0){c||(i.push(P),c=!0);const n={header:!0,label:`${o.pages[d[e].id].label} | ${o.widgets[t[s]].label}`};i.push(n),o.widgets[t[s]].useDataSources.forEach(n=>{const a={id:`${t[s]}-${n.dataSourceId}`,label:oe(n.dataSourceId),headerLabel:`${o.pages[d[e].id].label} ${o.widgets[t[s]].label}`};i.push(a)})}}if(r.dialogList){let e=!1;const t=L(r.dialogList,o,M.Dialog);for(let s=0;s<r.dialogList.length;s++){const n=L(t[s].maps,o,M.Widget);for(let a=0;a<n.length;a++)if(o.widgets[n[a]].useDataSources&&o.widgets[n[a]].useDataSources.length>0){e||(i.push(P),e=!0);const r={header:!0,label:`${o.dialogs[t[s].id].label} | ${o.widgets[n[a]].label}`};i.push(r),o.widgets[n[a]].useDataSources.forEach(e=>{const r={id:`${n[a]}-${e.dataSourceId}`,label:oe(e.dataSourceId),headerLabel:`${o.dialogs[t[s].id].label} ${o.widgets[n[a]].label}`};i.push(r)})}}}return i})()},[o,n,l,c,t]),p=(()=>{var t;if(!e.useMapViewIds||0===(null===(t=e.useMapViewIds)||void 0===t?void 0:t.length))return null;const i=e.useMapViewIds[0];return d.find(e=>e.id===i)||null})();return(0,x.jsx)("div",{className:"w-100",children:(0,x.jsx)("div",{className:"component-map-view-selector",children:(0,x.jsx)(O.Select,{size:"sm",onChange:t=>{var s;const o=t.target.value,n=o===i.id?[]:[o];null===(s=e.onChange)||void 0===s||s.call(e,n)},value:p?p.id:i.id,"aria-label":e["aria-label"],children:[i].concat(d).map((e,i)=>{var o;return(e=>{var t,i,o;return(null===(o=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.dataSourcesInfo)||void 0===i?void 0:i[e])||void 0===o?void 0:o.instanceStatus)===s.DataSourceStatus.CreateError})(null===(o=e.id)||void 0===o?void 0:o.split("-")[1])?(0,x.jsxs)(O.Option,{disabled:!0,className:"d-flex align-items-center justify-content-start",children:[(0,x.jsx)("span",{children:e.label}),(0,x.jsx)(O.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:t("dataSourceCreateError"),style:{marginLeft:"auto"}})]}):(0,x.jsxs)(O.Option,{header:e.header,divider:e.divider,value:e.id,children:[!e.header&&(0,x.jsx)("div",{className:"sr-only",children:e.headerLabel}),e.label]},i)})})})})},ae=ne;class re extends s.React.PureComponent{constructor(e){super(e),this.onStyleClick=e=>{this.state.selectedValue!==e&&(this.setState({selectedValue:e}),this.props.onChange&&this.props.onChange(e))},this.state={selectedValue:this.props.value}}componentDidUpdate(e,t){e.value!==this.props.value&&this.setState({selectedValue:this.props.value})}render(){const e=this.props.styles;return(0,x.jsx)("div",{className:(0,s.classNames)("widget-setting--stylepicker w-100",{small:"small"===this.props.size}),children:Object.keys(e).map((t,i)=>(0,x.jsx)("div",{role:"button",className:(0,s.classNames)("widget-setting--stylepicker-item",{active:t===this.state.selectedValue,"full-width":"full"===e[t].size}),style:{backgroundImage:`url(${e[t].thumbnail})`},onClick:()=>{this.onStyleClick(t)}},t))})}}const le=(0,m.withStyles)(re,"StylePicker");var ce=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};class de extends s.React.PureComponent{constructor(e){super(e),this.state={value:this.props.value},this.onRadioButtonChange=e=>{const t=e.target.value;this.state.value!==t&&(this.setState({value:t}),this.props.onChange&&this.props.onChange(t))},de.count++,this.inputName=`setting-radiogroup-${de.count}`}render(){const e=this.props,{options:t,className:i}=e,s=ce(e,["options","className"]);return(0,x.jsx)(O.FormGroup,Object.assign({},s,{onChange:this.onRadioButtonChange,className:`setting--button-group ${i}`,children:t.map(e=>(0,x.jsxs)(O.Label,{children:[(0,x.jsx)(O.Radio,{value:e.value,name:this.inputName,checked:this.state.value===e.value}),e.content]},e.value))}))}}de.count=0;const pe=(0,m.withStyles)(de,"RadioGroup"),ue=O.CollapsablePanel,he=O.CollapsablePanel,me=O.CollapsableToggle,ge=O.CollapsableRadio,ve=O.CollapsableCheckbox;class fe extends s.React.PureComponent{constructor(){super(...arguments),this.itemOnClick=e=>{this.props.onClick(e),this.setState({selectedItemName:e.name})}}render(){const e=this.props.datas.find(e=>this.props.linkParam.value===e.id),t=e&&e.id;return(0,x.jsx)("div",{className:"link-selector-list w-100",children:(0,x.jsx)(O.Select,{value:t||"",className:"w-100",onChange:e=>{this.itemOnClick(this.props.datas.find(t=>t.id===e.target.value))},"aria-label":this.props["aria-label"],size:"sm",children:this.props.datas.map((e,t)=>(0,x.jsx)("option",{value:e.id,children:e.name},t))})})}}function ye(e,t){var i,o;const n=null===(i=null==t?void 0:t.pages)||void 0===i?void 0:i[e];if((null==n?void 0:n.type)===s.PageType.Normal){const i=T.searchUtils.getContentsInContainer(t,{type:s.ContainerType.Page,id:e},s.LayoutItemType.Section,T.utils.getCurrentSizeMode());let a=[],r=[];return n.header&&(a=T.searchUtils.getContentsInContainer(t,{type:s.ContainerType.Header,id:"header"},s.LayoutItemType.Section,T.utils.getCurrentSizeMode())),n.footer&&(r=T.searchUtils.getContentsInContainer(t,{type:s.ContainerType.Footer,id:"footer"},s.LayoutItemType.Section,T.utils.getCurrentSizeMode())),null===(o=a.concat(i,r))||void 0===o?void 0:o.sort((e,i)=>{var s,o,n,a,r;return null===(n=null===(o=null===(s=null==t?void 0:t.sections)||void 0===s?void 0:s[e])||void 0===o?void 0:o.label)||void 0===n?void 0:n.localeCompare(null===(r=null===(a=null==t?void 0:t.sections)||void 0===a?void 0:a[i])||void 0===r?void 0:r.label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})})}return[]}function be(e,t){var i;return(null===(i=null==t?void 0:t.dialogs)||void 0===i?void 0:i[e])?T.searchUtils.getContentsInContainer(t,{type:s.ContainerType.Dialog,id:e},s.LayoutItemType.Section,T.utils.getCurrentSizeMode()):[]}function Se(e,t){if(!e)return[];const i=xe(e,t);if(i&&i.length>0){let e=[],s=[];return i.forEach(i=>{e=e.concat(we(i,t).map(e=>e.id))}),e.length>0&&e.forEach(e=>{s=s.concat(Se(e,t))}),e.concat(s)}return[]}function xe(e,t){return T.searchUtils.getContentsInContainer(t,{type:s.ContainerType.View,id:e},s.LayoutItemType.Section,T.utils.getCurrentSizeMode())||[]}function we(e,t){const i=t.sections[e].views,s=[];for(let e=0;e<i.length;e++)s.push({id:i[e],label:t.views[i[e]].label});return s.sort((e,t)=>{var i;return null===(i=e.label)||void 0===i?void 0:i.localeCompare(t.label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})})}function Ce(e,t){const i=null==e?void 0:e.pages,o={id:s.CONSTANTS.CURRENT_PAGE,name:t.formatMessage({id:"currentPage",defaultMessage:O.defaultMessages.currentPage})},n=i&&Object.keys(i).filter(e=>i[e].type===s.PageType.Normal).sort((e,t)=>{var s;return null===(s=i[e].label)||void 0===s?void 0:s.localeCompare(i[t].label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})});let a=[o];return n&&(a=a.concat(n.map(e=>({id:e,name:i[e].label})))),a}function je(e){const t=null==e?void 0:e.dialogs,i=t&&Object.values(t).filter(e=>(null==e?void 0:e.mode)===s.DialogMode.Fixed)||[],o=t&&Object.values(t).filter(e=>(null==e?void 0:e.mode)===s.DialogMode.Anchored)||[],n=i.concat(o).sort((e,t)=>{var i;return null===(i=e.label)||void 0===i?void 0:i.localeCompare(t.label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})}).map(e=>e.id);return n&&n.filter(e=>!t[e].isSplash).map(e=>({id:e,name:t[e].label}))}function Ie(e){var t;return ke(e.linkType===s.LinkType.View?null===(t=e.value)||void 0===t?void 0:t.split(",")[0]:null)}function ke(e){return"string"==typeof e&&e.includes("dialog_")}const Oe=["https","mailto","tel","sms","ftp"];class Te extends s.React.PureComponent{constructor(){super(...arguments),this.getInitLinkParam=()=>{const e=this.props.appConfig.pageStructure;if(!e||e.length<1)return(0,s.Immutable)({value:""});if(this.props.originLinkParam.linkType!==s.LinkType.Page){const e=Ce(this.props.appConfig,this.props.intl);return(0,s.Immutable)({linkType:s.LinkType.Page,value:e&&e.some(e=>"default"===e.id)?"default":e&&e[0]&&e[0].id,openType:!this.props.openTypes||this.props.openTypes.includes(s.OpenTypes.CurrentWindow)?s.OpenTypes.CurrentWindow:this.props.openTypes[0]})}return this.props.originLinkParam},this.setLinkParam=e=>{let t=this.props.linkParam;t=t.set("value",e.id),this.props.onLinkParamChange(t)}}componentDidMount(){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}render(){const e=Ce(this.props.appConfig,this.props.intl);return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"chooseAPage",defaultMessage:O.defaultMessages.chooseAPage})}),(0,x.jsx)("div",{children:(0,x.jsx)(fe,{linkParam:this.props.linkParam,datas:e,onClick:this.setLinkParam,"aria-label":this.props.intl.formatMessage({id:"chooseAPage",defaultMessage:O.defaultMessages.chooseAPage})})})]})}}class Pe extends s.React.PureComponent{constructor(){super(...arguments),this.getInitLinkParam=()=>{const e=this.props.appConfig.dialogs;if(!e||Object.keys(e).length<1)return(0,s.Immutable)({linkType:s.LinkType.Dialog,value:""});if(this.props.originLinkParam.linkType!==s.LinkType.Dialog){const e=je(this.props.appConfig);return(0,s.Immutable)({linkType:s.LinkType.Dialog,value:e&&e[0]&&e[0].id})}return this.props.originLinkParam},this.setLinkParam=e=>{let t=this.props.linkParam;t=t.set("value",e.id),this.props.onLinkParamChange(t)}}componentDidMount(){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}componentDidUpdate(e){if(e.appConfig!==this.props.appConfig){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}}render(){const e=je(this.props.appConfig);return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"chooseADialog",defaultMessage:O.defaultMessages.chooseADialog})}),(0,x.jsx)("div",{children:e&&e.length>0&&(0,x.jsx)(fe,{linkParam:this.props.linkParam,datas:e,onClick:this.setLinkParam,"aria-label":this.props.intl.formatMessage({id:"chooseADialog",defaultMessage:O.defaultMessages.chooseADialog})})})]})}}class Ne extends s.React.PureComponent{constructor(){super(...arguments),this.getInitLinkParam=()=>{const e=T.searchUtils.getBlockAnchorPointsInPage(T.utils.getAppConfig(),T.utils.getCurrentPageId(),T.utils.getCurrentSizeMode());if(!e||e.length<1)return(0,s.Immutable)({linkType:s.LinkType.Block,value:""});if(this.props.originLinkParam.linkType!==s.LinkType.Block){const e=this.getBlockData();return(0,s.Immutable)({linkType:s.LinkType.Block,value:e&&e.some(e=>"default"===e.id)?"default":e&&e[0]&&e[0].id})}return this.props.originLinkParam},this.getBlockData=()=>{var e;return(null===(e=T.searchUtils.getBlockAnchorPointsInPage(T.utils.getAppConfig(),T.utils.getCurrentPageId(),T.utils.getCurrentSizeMode()))||void 0===e?void 0:e.sort((e,t)=>{var i;return null===(i=e.label)||void 0===i?void 0:i.localeCompare(t.label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})})).map(e=>({id:e.id,name:e.label}))},this.setLinkParam=e=>{let t=this.props.linkParam;t=t.set("value",e.id),this.props.onLinkParamChange(t)}}componentDidMount(){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}render(){const e=this.getBlockData();return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"jumpTo",defaultMessage:O.defaultMessages.jumpTo})}),(0,x.jsx)("div",{children:e&&e.length>0&&(0,x.jsx)(fe,{linkParam:this.props.linkParam,datas:e,onClick:this.setLinkParam,"aria-label":this.props.intl.formatMessage({id:"jumpTo",defaultMessage:O.defaultMessages.jumpTo})})})]})}}class Me extends s.React.PureComponent{constructor(){super(...arguments),this.screenGroupLabelStyle={marginLeft:"-20px"},this.getInitLinkParam=()=>{const e=this.getScreenData();return!e||e.length<1?(0,s.Immutable)({linkType:s.LinkType.Screen,value:""}):this.props.originLinkParam.linkType!==s.LinkType.Screen?(0,s.Immutable)({linkType:s.LinkType.Screen,value:e[0].screens[0].id}):this.props.originLinkParam},this.getScreenData=()=>{var e;return null===(e=T.searchUtils.getScreenAnchorPointsInPage(T.utils.getAppConfig(),T.utils.getCurrentPageId(),T.utils.getCurrentSizeMode()))||void 0===e?void 0:e.sort((e,t)=>{var i;return null===(i=e.label)||void 0===i?void 0:i.localeCompare(t.label,null===window||void 0===window?void 0:window.locale,{numeric:!0,sensitivity:"base"})})},this.setLinkParam=e=>{let t=this.props.linkParam;t=t.set("value",e.target.value),this.props.onLinkParamChange(t)}}componentDidMount(){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}render(){var e;const t=this.getScreenData(),i=[];return t.forEach(e=>{i.push((0,x.jsx)("option",{value:e.id,disabled:!0,style:this.screenGroupLabelStyle,children:e.label},e.id)),e.screens.forEach((t,s)=>i.push((0,x.jsx)("option",{value:t.id,children:t.label},`${e.id}-${s}`)))}),(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"jumpTo",defaultMessage:O.defaultMessages.jumpTo})}),(0,x.jsx)("div",{children:t.length>0&&(0,x.jsx)(O.Select,{value:null===(e=this.props.linkParam)||void 0===e?void 0:e.value,className:"w-100",onChange:this.setLinkParam,size:"sm","aria-label":this.props.intl.formatMessage({id:"jumpTo",defaultMessage:O.defaultMessages.jumpTo}),children:i})})]})}}var Le=v(30655),De=v.n(Le),Ae=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Re=e=>{const t=window.SVG,{className:i}=e,o=Ae(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:De()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Ee=v(94064),Fe=v.n(Ee),Be=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Ue=e=>{const t=window.SVG,{className:i}=e,o=Be(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Fe()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};class ze extends s.React.PureComponent{constructor(){super(...arguments),this.onCollapseClick=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({collapse:!this.state.collapse})}}componentWillMount(){this.setState({collapse:this.props.isOpen})}render(){return(0,x.jsxs)("div",{className:(0,s.classNames)("w-100",this.props.className),children:[(0,x.jsxs)("div",{title:this.props.title,style:{overflow:"hidden"},className:"w-100 btn pb-2 pr-2 d-flex justify-content-between",children:[(0,x.jsx)("div",{children:this.props.title}),(0,x.jsx)(O.Button,{type:"tertiary",size:"sm",className:"collapse-btn py-0 jimu-outline-inside pr-0",onClick:this.onCollapseClick,"aria-label":this.props.title,"aria-expanded":this.state.collapse,children:this.state.collapse?(0,x.jsx)(Re,{size:"s"}):(0,x.jsx)(Ue,{size:"s"})})]}),(0,x.jsx)(O.Collapse,{isOpen:this.state.collapse,"aria-label":this.props.title,children:this.props.children})]})}}class $e extends s.React.PureComponent{constructor(e){super(e),this.noScroll="Do not scroll",this.getInitLinkParam=()=>{if(this.props.originLinkParam.linkType===s.LinkType.View)return this.props.originLinkParam;{let e=(0,s.Immutable)({linkType:s.LinkType.View,value:""});return ke(this.getDefaultPageOrDialogId())||(e=e.set("openType",this.getInitOpenType())),e}},this.getInitOpenType=()=>!this.props.openTypes||this.props.openTypes.includes(s.OpenTypes.CurrentWindow)?s.OpenTypes.CurrentWindow:this.props.openTypes[0],this.pageOrDialogChange=e=>{let t=this.props.linkParam;t=t.set("value",e.target.value),t=Ie(t)?t.without("openType"):t.set("openType",this.getInitOpenType()),this.props.onLinkParamChange(t)},this.viewChange=(e,t)=>{let i=[];i=Object.assign(i,this.state.viewLinkParamArr),i[0]||(i[0]=this.getDefaultPageOrDialogId());const s=this.props.appConfig.sections[t].views;let o=i.filter(t=>s.some(e=>e===t)&&t!==e),n=[];const a=i.indexOf(e);if(a>-1?o=o.concat(i[a]):n=n.concat(e),o&&o.length>0){let e=[];o.forEach(t=>{e=e.concat(Se(t,this.props.appConfig))}),o=o.concat(e)}i=i.filter(e=>!o.some(t=>t===e)),i=i.concat(n);let r=this.props.linkParam;r=r.set("value",i.join(",")),this.props.onLinkParamChange(r)},this.viewRemove=e=>{let t=[];t=Object.assign(t,this.state.viewLinkParamArr),t[0]||(t[0]=this.getDefaultPageOrDialogId());const i=Se(e,this.props.appConfig).concat(e);t=t.slice(0,1).concat(t.slice(1).filter(e=>!i.some(t=>t===e)));let s=this.props.linkParam;s=s.set("value",t.join(",")),this.props.onLinkParamChange(s,!0)},this.getDefaultPageOrDialogId=()=>{const e=this.props.appConfig&&this.props.appConfig.pages,t=e&&Object.keys(e).filter(e=>ye(e,this.props.appConfig).length>0),i=t&&t.find(t=>e[t].isDefault)||(null==t?void 0:t[0]);if(i)return i;const s=this.props.appConfig&&this.props.appConfig.dialogs,o=s&&Object.keys(s).filter(e=>be(e,this.props.appConfig).length>0);return null==o?void 0:o[0]},this.getSelectedViewIds=()=>this.state.viewLinkParamArr.slice(1),this.state={viewLinkParamArr:[],scrollToViewId:this.noScroll}}componentDidMount(){const e=this.getInitLinkParam(),{value:t,linkType:i}=e;t&&i===s.LinkType.View?this.setState({viewLinkParamArr:t.split(",")}):this.setState({viewLinkParamArr:[]}),this.props.onLinkParamChange(e)}static getDerivedStateFromProps(e,t){const{value:i,linkType:o}=e.linkParam;return i&&o===s.LinkType.View?Object.assign(Object.assign({},t),{viewLinkParamArr:i.split(",")}):Object.assign(Object.assign({},t),{viewLinkParamArr:[]})}render(){var e,t,i;if(!this.props.appConfig)return null;const o=Ce(this.props.appConfig,this.props.intl),n=je(this.props.appConfig);let a=this.state.viewLinkParamArr[0];o.some(e=>e.id===a)||n.some(e=>e.id===a)||(a=this.getDefaultPageOrDialogId());const r=o.filter(e=>ye(e.id,this.props.appConfig).length>0),l=n.filter(e=>be(e.id,this.props.appConfig).length>0);return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"chooseViews",defaultMessage:O.defaultMessages.chooseViews})}),(0,x.jsxs)("div",{children:[(0,x.jsxs)(O.Select,{value:a,onChange:this.pageOrDialogChange,className:"w-100 mb-4",size:"sm","aria-label":this.props.intl.formatMessage({id:"chooseViews",defaultMessage:O.defaultMessages.chooseViews}),children:[(0,x.jsx)(O.Option,{header:!0,children:this.props.intl.formatMessage({id:"page",defaultMessage:s.defaultMessages.page})}),r.map((e,t)=>(0,x.jsx)(O.Option,{value:e.id,children:e.name},t)),l.length>0&&(0,x.jsx)(O.Option,{header:!0,children:this.props.intl.formatMessage({id:"dialog",defaultMessage:s.defaultMessages.dialog})}),l.map((e,t)=>(0,x.jsx)(O.Option,{value:e.id,children:e.name},t))]}),(0,x.jsx)("div",{className:(0,s.classNames)("choose-view",{"mb-4":(null===(e=ye(a,this.props.appConfig))||void 0===e?void 0:e.length)>0}),children:ye(a,this.props.appConfig).map(e=>(0,x.jsx)(Ve,{sections:this.props.appConfig.sections,sectionId:e,viewsInfo:we(e,this.props.appConfig),viewLinkParamArr:this.state.viewLinkParamArr,viewChange:this.viewChange,viewRemove:this.viewRemove},e))}),(0,x.jsx)("div",{className:(0,s.classNames)("choose-view",{"mb-4":(null===(t=be(a,this.props.appConfig))||void 0===t?void 0:t.length)>0}),children:be(a,this.props.appConfig).map(e=>(0,x.jsx)(Ve,{sections:this.props.appConfig.sections,sectionId:e,viewsInfo:we(e,this.props.appConfig),viewLinkParamArr:this.state.viewLinkParamArr,viewChange:this.viewChange,viewRemove:this.viewRemove},e))}),(0,x.jsx)("div",{className:(0,s.classNames)("choose-view",{"mb-4":(null===(i=this.getSelectedViewIds())||void 0===i?void 0:i.length)>0}),children:this.getSelectedViewIds().map(e=>xe(e,this.props.appConfig).map(e=>(0,x.jsx)(Ve,{sections:this.props.appConfig.sections,sectionId:e,viewsInfo:we(e,this.props.appConfig),viewLinkParamArr:this.state.viewLinkParamArr,viewChange:this.viewChange,viewRemove:this.viewRemove},e)))})]})]})}}class Ve extends s.React.PureComponent{constructor(e){super(e),this.onViewChange=e=>{this.setState({viewId:e}),this.props.viewChange(e,this.props.sectionId)},this.state={viewId:null}}componentWillUnmount(){this.props.viewRemove(this.state.viewId)}render(){return(0,x.jsx)(ze,{className:"mb-4 choose-view",title:this.props.sections[this.props.sectionId]&&this.props.sections[this.props.sectionId].label,isOpen:!0,children:(0,x.jsx)("div",{className:"link-selector-list w-100 view-border border-top-0 border-left-0 border-right-0 rounded-0",role:"listbox",children:this.props.viewsInfo.map((e,t)=>(0,x.jsx)(O.Button,{role:"option",onClick:()=>{this.onViewChange(e.id)},className:(0,s.classNames)("jimu-outline-inside link-selector-list-item btn w-100 view-border px-2 pt-1 text-left border-bottom-0 rounded-0 text-truncate",{"item-common":!this.props.viewLinkParamArr.includes(e.id)},{"item-selected":this.props.viewLinkParamArr.includes(e.id)}),title:e.label,"aria-selected":this.props.viewLinkParamArr.includes(e.id),children:e.label},t))})},this.props.sectionId)}}var We=v(84845);class Ge extends s.React.PureComponent{constructor(e){var t;super(e),this.getInitLinkParam=()=>this.props.originLinkParam.linkType===s.LinkType.WebAddress?this.props.originLinkParam:(0,s.Immutable)({linkType:s.LinkType.WebAddress,openType:!this.props.openTypes||this.props.openTypes.includes(s.OpenTypes.NewWindow)?s.OpenTypes.NewWindow:this.props.openTypes[0],value:""}),this.webAddressInputChange=e=>{const t=e.value;let i=this.props.linkParam;i=i.set("value",t).set("expression",null),this.props.onLinkParamChange(i)},this.webAddressExpressionChange=e=>{let t=this.props.linkParam;t=t.set("expression",e).set("value",""),this.props.onLinkParamChange(t),this.closeExpPopup()},this.openExpPopup=()=>{this.setState({isExpPopupOpen:!0})},this.closeExpPopup=()=>{this.setState({isExpPopupOpen:!1})},this.getDefaultExp=()=>({name:"Expression",parts:[{type:s.ExpressionPartType.String,exp:'"https://"'}]}),this.onUrlChange=e=>{this.setState({url:e.value})},this.state={isExpPopupOpen:!1,url:(null===(t=this.props.linkParam)||void 0===t?void 0:t.linkType)===s.LinkType.WebAddress?this.props.linkParam.value:""}}componentDidMount(){const e=this.getInitLinkParam();this.props.onLinkParamChange(e)}componentDidUpdate(e){var t,i,o;(null===(t=e.linkParam)||void 0===t?void 0:t.value)!==(null===(i=this.props.linkParam)||void 0===i?void 0:i.value)&&this.setState({url:(null===(o=this.props.linkParam)||void 0===o?void 0:o.linkType)===s.LinkType.WebAddress?this.props.linkParam.value:this.state.url})}render(){const e=this.props.expressionInputTypes||(0,s.Immutable)([We.ExpressionInputType.Static,We.ExpressionInputType.Attribute,We.ExpressionInputType.Expression,We.ExpressionInputType.Arcade]);return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)("div",{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"url",defaultMessage:O.defaultMessages.url})}),(0,x.jsx)("div",{children:this.props.useDataSources&&this.props.useDataSources.length>0?(0,x.jsx)(We.ExpressionInput,{useDataSources:this.props.useDataSources,onChange:this.webAddressExpressionChange,expression:this.props.linkParam&&this.props.linkParam.expression||this.getDefaultExp(),closeExpPopup:this.closeExpPopup,openExpPopup:this.openExpPopup,isExpPopupOpen:this.state.isExpPopupOpen,types:e,widgetId:this.props.widgetId,"aria-label":this.props.intl.formatMessage({id:"url",defaultMessage:O.defaultMessages.url})}):(0,x.jsx)(O.UrlInput,{value:this.state.url,schemes:Oe,onChange:this.onUrlChange,className:"w-100",onAcceptValue:this.webAddressInputChange,"aria-label":this.props.intl.formatMessage({id:"url",defaultMessage:O.defaultMessages.url})})})]})}}class He extends s.React.PureComponent{constructor(e){if(super(e),this.getLinkTypeContent=()=>{const e=this.getHiddenLinks();return this.props.isLinkPageSetting||window.isExpressBuilder?(0,x.jsxs)(O.Select,{value:this.state.linkParam.linkType,size:"sm",onChange:this.linkTypeChange,className:"w-100","aria-label":this.props.intl.formatMessage({id:"linkTo",defaultMessage:O.defaultMessages.linkTo}),children:[!e.some(e=>e===s.LinkType.WebAddress)&&(0,x.jsx)("option",{value:s.LinkType.WebAddress,children:this.props.intl.formatMessage({id:"url",defaultMessage:O.defaultMessages.url})}),!e.some(e=>e===s.LinkType.None)&&(0,x.jsx)("option",{value:s.LinkType.None,children:this.props.intl.formatMessage({id:"none",defaultMessage:O.defaultMessages.none})})]}):(0,x.jsxs)(O.Select,{value:this.state.linkParam.linkType,size:"sm",onChange:this.linkTypeChange,className:"w-100","aria-label":this.props.intl.formatMessage({id:"linkTo",defaultMessage:O.defaultMessages.linkTo}),children:[!e.some(e=>e===s.LinkType.None)&&(0,x.jsx)("option",{value:s.LinkType.None,children:this.props.intl.formatMessage({id:"none",defaultMessage:O.defaultMessages.none})}),!e.some(e=>e===s.LinkType.Page)&&(0,x.jsx)("option",{value:s.LinkType.Page,children:this.props.intl.formatMessage({id:"page",defaultMessage:s.defaultMessages.page})}),!e.some(e=>e===s.LinkType.View)&&(0,x.jsx)("option",{value:s.LinkType.View,children:this.props.intl.formatMessage({id:"view",defaultMessage:s.defaultMessages.view})}),!e.some(e=>e===s.LinkType.Dialog)&&(0,x.jsx)("option",{value:s.LinkType.Dialog,children:this.props.intl.formatMessage({id:"dialog",defaultMessage:s.defaultMessages.dialog})}),!e.some(e=>e===s.LinkType.WebAddress)&&(0,x.jsx)("option",{value:s.LinkType.WebAddress,children:this.props.intl.formatMessage({id:"url",defaultMessage:O.defaultMessages.url})}),!e.some(e=>e===s.LinkType.Block)&&(0,x.jsx)("option",{value:s.LinkType.Block,children:this.props.intl.formatMessage({id:"block",defaultMessage:s.defaultMessages.block})}),!e.some(e=>e===s.LinkType.PageTop)&&(0,x.jsx)("option",{value:s.LinkType.PageTop,children:this.props.intl.formatMessage({id:"pageTop",defaultMessage:O.defaultMessages.pageTop})}),!e.some(e=>e===s.LinkType.PrintPreview)&&(0,x.jsx)("option",{value:s.LinkType.PrintPreview,children:this.props.intl.formatMessage({id:"printPreview",defaultMessage:O.defaultMessages.printPreview})}),!e.some(e=>e===s.LinkType.CookieBanner)&&(0,x.jsx)("option",{value:s.LinkType.CookieBanner,children:this.props.intl.formatMessage({id:"cookieBanner",defaultMessage:O.defaultMessages.cookieBanner})})]})},this.getHiddenLinks=()=>{var e,t,i,o,n,a;let r=this.props.hiddenLinks||(0,s.Immutable)([]);const l=T.utils.getCurrentPageId(),c=T.utils.getAppConfig(),d=null===(e=c.pages)||void 0===e?void 0:e[l],p=T.searchUtils.findLayoutId(null==d?void 0:d.layout,T.utils.getCurrentSizeMode(),c.mainSizeMode),u=c.layouts[p],h=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(i=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo)||void 0===o?void 0:o.currentDialogId:null===(n=(0,s.getAppStore)().getState().appRuntimeInfo)||void 0===n?void 0:n.currentDialogId;return((null==u?void 0:u.type)===s.LayoutType.FixedLayout||h)&&(r=r.concat([s.LinkType.Block,s.LinkType.Screen,s.LinkType.PageTop])),(null===(a=null==c?void 0:c.cookieBanner)||void 0===a?void 0:a.enable)||(r=r.concat([s.LinkType.CookieBanner])),r},this.getLinkContent=e=>{switch(e){case s.LinkType.None:return null;case s.LinkType.Page:return(0,x.jsx)(Te,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,appConfig:this.props.appConfig,onLinkParamChange:this.linkParamChange,intl:this.props.intl,openTypes:this.props.openTypes});case s.LinkType.Dialog:return(0,x.jsx)(Pe,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,appConfig:this.props.appConfig,onLinkParamChange:this.linkParamChange,intl:this.props.intl});case s.LinkType.Block:return(0,x.jsx)(Ne,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,onLinkParamChange:this.linkParamChange,intl:this.props.intl});case s.LinkType.Screen:return(0,x.jsx)(Me,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,onLinkParamChange:this.linkParamChange,intl:this.props.intl});case s.LinkType.View:return(0,x.jsx)($e,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,intl:this.props.intl,openTypes:this.props.openTypes,appConfig:this.props.appConfig,onLinkParamChange:this.linkParamChange,browserSizeMode:this.props.browserSizeMode});case s.LinkType.WebAddress:return(0,x.jsx)(Ge,{originLinkParam:this.state.originLinkParam,linkParam:this.state.linkParam,intl:this.props.intl,onLinkParamChange:this.linkParamChange,useDataSources:this.props.useDataSources,openTypes:this.props.openTypes,widgetId:this.props.widgetId,expressionInputTypes:this.props.expressionInputTypes});default:return null}},this.linkTypeChange=e=>{const t=e.target.value;let i=(0,s.Immutable)(this.state.linkParam);[s.LinkType.None,s.LinkType.PageTop,s.LinkType.CookieBanner,s.LinkType.PrintPreview].includes(t)&&(i=(0,s.Immutable)({})),i=i.set("linkType",t),this.needOpenIn(i)||(i=i.without("openType")),this.setState({linkParam:i})},this.radioOpenTypeChange=e=>{let t=(0,s.Immutable)(this.state.linkParam);t=t.set("openType",e),this.setState({linkParam:t})},this.linkParamChange=(e,t)=>{t?e&&this.state.linkParam&&e.linkType===this.state.linkParam.linkType&&this.setState({linkParam:this.fixLinkParam(e)}):this.setState({linkParam:this.fixLinkParam(e)})},this.fixLinkParam=e=>{var t;let i=e;if((null==e?void 0:e.linkType)===s.LinkType.View&&(null==e?void 0:e.value)){const s=null===(t=this.props.appConfig)||void 0===t?void 0:t.views,o=e.value.split(","),n=o.slice(1).filter(e=>null==s?void 0:s[e]),a=[o[0]].concat(n).join(",");i=i.set("value",a)}return i},this.settingConfirm=()=>{const e=(0,s.Immutable)(this.state.linkParam);this.setState({originLinkParam:e}),this.props.onSettingConfirm(e)},this.isLinkParamOk=e=>{if(!e||!e.linkType)return!1;if(e.linkType===s.LinkType.View){const t=e.value&&e.value.split(",")[0]||null,i=e.value&&e.value.split(",").slice(1)||[];return!!(t&&"string"==typeof t&&i.length>0)}if(e.linkType===s.LinkType.WebAddress){if(this.props.useDataSources&&this.props.useDataSources.length>0){const t=e.expression&&e.expression.parts;let i=!1;return t&&t.length>0&&(i=1!==t.length||!!t[0].exp&&'""'!==t[0].exp),i}{const t="valid"!==s.urlUtils.checkAbsoluteUrl(e.value,Oe);return e.value&&!t}}return e.linkType===s.LinkType.PageTop||e.linkType===s.LinkType.PrintPreview||e.linkType===s.LinkType.None||e.linkType===s.LinkType.CookieBanner||!(!e.value||"string"!=typeof e.value)},this.props.linkParam&&this.props.linkParam.linkType)this.state={linkParam:(0,s.Immutable)(this.props.linkParam),originLinkParam:(0,s.Immutable)(this.props.linkParam)};else{const e={linkType:s.LinkType.None,openType:!this.props.openTypes||this.props.openTypes.includes(s.OpenTypes.CurrentWindow)?s.OpenTypes.CurrentWindow:this.props.openTypes[0]};this.state={linkParam:(0,s.Immutable)(e),originLinkParam:(0,s.Immutable)(e)}}}needOpenIn(e){if(!e)return!0;return![s.LinkType.Dialog,s.LinkType.Block,s.LinkType.Screen,s.LinkType.PageTop,s.LinkType.PrintPreview,s.LinkType.CookieBanner].some(t=>t===e.linkType)&&!Ie(e)}render(){if(this.props.appConfig){const e=this.getLinkTypeContent(),t=this.getLinkContent(this.state.linkParam.linkType);return(0,x.jsx)("div",{className:(0,s.classNames)(this.props.className,"w-100 h-100",{[m.Theme2GlobalStyleClassName]:this.context,[m.ThemeGlobalStyleClassName]:!this.context}),children:(0,x.jsx)("div",{className:"widget-builder-link-selector w-100 h-100",children:(0,x.jsxs)("div",{style:{position:"relative"},className:"w-100 h-100",children:[(0,x.jsxs)(O.Container,{children:[(0,x.jsx)(O.Row,{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"linkTo",defaultMessage:O.defaultMessages.linkTo})}),(0,x.jsx)(O.Row,{className:"mb-4",children:e}),this.state.linkParam.linkType!==s.LinkType.None?(0,x.jsxs)("div",{children:[(0,x.jsx)(O.Row,{className:"mb-4",children:t}),this.needOpenIn(this.state.linkParam)&&(0,x.jsxs)("div",{children:[(0,x.jsx)(O.Row,{className:"mb-3 option-name",children:this.props.intl.formatMessage({id:"openIn",defaultMessage:O.defaultMessages.openIn})}),(0,x.jsxs)(O.Row,{role:"radiogroup",className:"p-0","aria-label":this.props.intl.formatMessage({id:"openIn",defaultMessage:O.defaultMessages.openIn}),children:[(!this.props.openTypes||this.props.openTypes.some(e=>e===s.OpenTypes.CurrentWindow))&&(0,x.jsxs)(O.Label,{className:"link-setting-cursor-pointer open-type-label mb-6 d-flex align-items-center",children:[(0,x.jsx)(O.Radio,{name:"openIn",className:"mr-2",onChange:()=>{this.radioOpenTypeChange(s.OpenTypes.CurrentWindow)},checked:this.state.linkParam.openType===s.OpenTypes.CurrentWindow}),this.props.intl.formatMessage({id:"appWindow",defaultMessage:O.defaultMessages.appWindow})]}),(!this.props.openTypes||this.props.openTypes.some(e=>e===s.OpenTypes.TopWindow))&&(0,x.jsxs)(O.Label,{className:"link-setting-cursor-pointer open-type-label mb-6 d-flex align-items-center",children:[(0,x.jsx)(O.Radio,{name:"openIn",className:"mr-2",onChange:()=>{this.radioOpenTypeChange(s.OpenTypes.TopWindow)},checked:this.state.linkParam.openType===s.OpenTypes.TopWindow}),this.props.intl.formatMessage({id:"topWindow",defaultMessage:O.defaultMessages.topWindow})]}),(!this.props.openTypes||this.props.openTypes.some(e=>e===s.OpenTypes.NewWindow))&&(0,x.jsxs)(O.Label,{className:"link-setting-cursor-pointer open-type-label mb-6 d-flex align-items-center",children:[(0,x.jsx)(O.Radio,{name:"openIn",className:"mr-2",onChange:()=>{this.radioOpenTypeChange(s.OpenTypes.NewWindow)},checked:this.state.linkParam.openType===s.OpenTypes.NewWindow}),this.props.intl.formatMessage({id:"newWindow",defaultMessage:O.defaultMessages.newWindow})]})]})]})]}):null]}),(0,x.jsx)("div",{className:"w-100 link-setting-ok-btn-container",style:{position:"absolute"},children:(0,x.jsx)(O.Button,{className:"w-100 link-setting-ok-btn",type:"primary",onClick:this.settingConfirm,disabled:!this.isLinkParamOk(this.state.linkParam),title:this.props.intl.formatMessage({id:"ok",defaultMessage:s.defaultMessages.ok}),children:(0,x.jsx)("div",{className:"text-truncate",children:this.props.intl.formatMessage({id:"ok",defaultMessage:s.defaultMessages.ok})})})})]})})})}return null}}He.contextType=m.UseTheme2Context;const _e=s.ReactRedux.connect(e=>{var t,i;return{appConfig:window&&window.jimuConfig&&window.jimuConfig.isBuilder?null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig:e.appConfig,browserSizeMode:window&&window.jimuConfig&&window.jimuConfig.isBuilder?null===(i=e.appStateInBuilder)||void 0===i?void 0:i.browserSizeMode:e.browserSizeMode}})((0,s.injectIntl)((0,m.withStyles)(He,"LinkSelectorContent"))),Je=_e;var Ke=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const qe={rootBoundary:"viewport"};class Xe extends s.React.PureComponent{constructor(){super(...arguments),this.closeBtnRef=s.React.createRef(),this.popperRef=s.React.createRef(),this.handleDocumentMousedown=e=>{if(this.props.isOpen){const t=e.target;(!this.props.trigger||(Array.isArray(this.props.trigger)?!this.props.trigger.some(e=>!(0,O.isOutBoundary)(t,e)):(0,O.isOutBoundary)(t,this.props.trigger)))&&this.toggle()}},this.toggle=()=>{this.props.toggle()},this.keepFocusAfterClose=()=>{setTimeout(()=>{this.props.backToFocusNode?(0,s.focusElementInKeyboardMode)(this.props.backToFocusNode):Array.isArray(this.props.trigger)?(0,s.focusElementInKeyboardMode)(this.props.trigger[0]):(0,s.focusElementInKeyboardMode)(this.props.trigger)},200)},this.onKeyDown=e=>{var t;if("Esc"===e.key||"Escape"===e.key){if(!(null===(t=this.popperRef.current)||void 0===t?void 0:t.contains(e.target)))return;e.target===this.closeBtnRef.current?this.toggle():(0,s.focusElementInKeyboardMode)(this.closeBtnRef.current)}}}componentDidMount(){var e;null===(e=this.getReference(this.props.position))||void 0===e||e.addEventListener("mousedown",this.handleDocumentMousedown,!1)}componentDidUpdate(e){var t;const i="left"===this.props.position&&e.leftSidebarCollapse&&!this.props.leftSidebarCollapse||"right"===this.props.position&&e.rightSidebarCollapse&&!this.props.rightSidebarCollapse,s=this.props.widgetId&&this.props.layoutSelection!==e.layoutSelection&&(null===(t=T.searchUtils.findLayoutItem(T.utils.getAppConfig(),this.props.layoutSelection))||void 0===t?void 0:t.widgetId)!==this.props.widgetId,o=!e.isTemplatePage&&this.props.isTemplatePage;(i||s||o)&&this.props.isOpen&&this.toggle(),e.isOpen&&!this.props.isOpen&&this.keepFocusAfterClose()}componentWillUnmount(){var e;null===(e=this.getReference(this.props.position))||void 0===e||e.removeEventListener("mousedown",this.handleDocumentMousedown,!1)}getReference(e){return"left"===e?document&&document.querySelector('[data-layoutid="left-sidebar-left-layout"]'):document&&document.querySelector('[data-layoutid="right-sidebar-right-layout"]')}getPlacement(e){return"left"===e?"right-start":"left-start"}render(){const e=this.props,{isOpen:t,position:i,className:o,dispatch:n,leftSidebarCollapse:a,rightSidebarCollapse:r,trigger:l,backToFocusNode:c,widgetId:d,layoutSelection:p,title:u,isTemplatePage:h,addFocusableContainerClass:m}=e,g=Ke(e,["isOpen","position","className","dispatch","leftSidebarCollapse","rightSidebarCollapse","trigger","backToFocusNode","widgetId","layoutSelection","title","isTemplatePage","addFocusableContainerClass"]);return(0,x.jsx)(O.Popper,Object.assign({reference:this.getReference(i),placement:this.getPlacement(i),open:t,forceLatestFocusElements:!0,autoUpdate:!0,className:(0,s.classNames)("bg-light-300",o),shiftOptions:qe},g,{toggle:null,onKeyDown:this.onKeyDown,"aria-label":"string"==typeof this.props["aria-label"]?this.props["aria-label"]:"string"==typeof u?u:void 0,children:(0,x.jsxs)("div",{className:"w-100 h-100",ref:this.popperRef,children:[void 0!==u&&(0,x.jsx)(O.PanelHeader,{title:u,showClose:!0,onClose:this.toggle,level:1,className:(0,s.classNames)("p-4",{[O.FOCUSABLE_CONTAINER_CLASS]:m}),closeButtonRef:this.closeBtnRef}),void 0!==u?(0,x.jsx)("div",{css:s.css`height: calc(100% - 56px); overflow: auto;`,children:this.props.children}):this.props.children]})}))}}const Ye=s.ReactRedux.connect((e,t)=>{var i,s,o,n,a,r,l,c,d,p;return{leftSidebarCollapse:null===(s=null===(i=e.widgetsState)||void 0===i?void 0:i["left-sidebar"])||void 0===s?void 0:s.collapse,rightSidebarCollapse:null===(n=null===(o=e.widgetsState)||void 0===o?void 0:o["right-sidebar"])||void 0===n?void 0:n.collapse,layoutSelection:t.widgetId?(null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?null===(l=null===(r=e.appStateInBuilder)||void 0===r?void 0:r.appRuntimeInfo)||void 0===l?void 0:l.selection:null===(c=e.appRuntimeInfo)||void 0===c?void 0:c.selection:null,isTemplatePage:(null===(d=null===window||void 0===window?void 0:window.jimuConfig)||void 0===d?void 0:d.isBuilder)&&"template"===(null===(p=e.appRuntimeInfo)||void 0===p?void 0:p.currentPageId)}})((0,m.withStyles)(Xe,"SidePopper"));class Qe extends s.React.PureComponent{constructor(){super(...arguments),this.close=()=>{this.props.onSettingCancel()},this.getIsOpen=()=>this.props.isOpen||this.props.showDialog}render(){const e=this.props.position||"right",{title:t}=this.props;return(0,x.jsx)(Ye,{isOpen:this.getIsOpen(),position:e,toggle:this.close,trigger:this.props.trigger,backToFocusNode:this.props.backToFocusNode,widgetId:this.props.widgetId,title:this.props.intl.formatMessage({id:t?"setLinkForTitle":"setLink",defaultMessage:t?O.defaultMessages.setLinkForTitle:O.defaultMessages.setLink},{title:t}),children:(0,x.jsx)("div",{className:"bg-default w-100 h-100 px-4",children:(0,x.jsx)(_e,{isLinkPageSetting:this.props.isLinkPageSetting,linkParam:this.props.linkParam,onSettingConfirm:this.props.onSettingConfirm,useDataSources:this.props.useDataSources,widgetId:this.props.widgetId,hiddenLinks:this.props.hiddenLinks,openTypes:this.props.openTypes,expressionInputTypes:this.props.expressionInputTypes})})})}}const Ze=(0,s.injectIntl)((0,m.withTheme)(Qe)),et=Ze;var tt=v(76490),it=v.n(tt),st=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ot=e=>{const t=window.SVG,{className:i}=e,o=st(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:it()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var nt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};class at extends s.React.PureComponent{constructor(e){super(e),this.linkSelectorTrigger=s.React.createRef(),this.toggle=()=>{const e=!this.state.isOpen;this.setState({isOpen:e},()=>{this.setState({renderPopper:e})})},this.onCancel=()=>{var e,t;null===(t=(e=this.props).onSettingCancel)||void 0===t||t.call(e),this.toggle()},this.onConfirm=e=>{var t,i;null===(i=(t=this.props).onSettingConfirm)||void 0===i||i.call(t,e),this.toggle()},this.getIsOpen=()=>this.state.isOpen&&!s.urlUtils.getAppIdPageIdFromUrl().pageId,this.state={isOpen:!1,renderPopper:!1}}render(){const e=this.props,{theme:t,intl:i,buttonLabel:s}=e,o=nt(e,["theme","intl","buttonLabel"]),n=s||this.props.intl.formatMessage({id:"setLink",defaultMessage:O.defaultMessages.setLink});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(O.Button,{className:"w-100 text-overlay",type:"primary",onClick:this.toggle,ref:this.linkSelectorTrigger,title:n,children:(0,x.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,x.jsx)(ot,{className:"text-overlay mr-1"}),n]})}),this.state.renderPopper&&(0,x.jsx)(Ze,Object.assign({},o,{isOpen:this.getIsOpen(),position:"right",onSettingCancel:this.onCancel,onSettingConfirm:this.onConfirm,trigger:this.linkSelectorTrigger.current,widgetId:this.props.widgetId}))]})}}const rt=(0,m.withTheme)((0,s.injectIntl)(at));var lt=v(13089),ct=function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((s=s.apply(e,t||[])).next())})};function dt(){return ct(this,void 0,void 0,function*(){const e=yield pt(),t=yield ut(),i={};return Object.keys(e).forEach(t=>{i[t]||(i[t]={items:[],isPremium:e[t].isPremium,isSubscriber:e[t].isSubscriber}),i[t].items=i[t].items.concat(e[t].dataSources.map(e=>({label:s.dataSourceUtils.getLabelFromArcGISServiceUrl(t),id:e.id})))}),Object.keys(t).forEach(e=>{i[e]||(i[e]={items:[],isPremium:t[e].isPremium,isSubscriber:t[e].isSubscriber}),i[e].items=i[e].items.concat(t[e].utilities.map(e=>{const t=s.UtilityManager.getInstance().getUtilityJson(e.utilityId);return{label:(null==t?void 0:t.label)||(null==t?void 0:t.name)||(null==t?void 0:t.sourceLabel),id:e.utilityId}}))}),i})}function pt(){return ct(this,void 0,void 0,function*(){var e,t,i,o,n;const a=window.jimuConfig.isBuilder?null===(i=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.dataSources:null===(n=null===(o=(0,s.getAppStore)().getState())||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.dataSources,r=[];return a&&Object.keys(a).forEach(e=>{const t=s.DataSourceManager.getInstance().getDataSource(e);r.push(ht(t))}),Promise.allSettled(r).then(e=>{let t={};return e.filter(e=>"fulfilled"===e.status).map(e=>e.value).forEach(e=>{e&&Object.keys(e).forEach(i=>{t[i]?t[i].dataSources=t[i].dataSources.concat(e[i].dataSources):t=Object.assign(Object.assign({},t),e)})}),t})})}function ut(){return ct(this,void 0,void 0,function*(){var e,t,i,o;const n=null===(o=null===(i=null===(t=null===(e=(0,s.getAppStore)())||void 0===e?void 0:e.getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===o?void 0:o.utilities,a=[];return n&&Object.keys(n).forEach(e=>{a.push(function(e){return ct(this,void 0,void 0,function*(){var t,i,o,n;const a={};if(!e)return a;const r=null===(n=null===(o=null===(i=null===(t=(0,s.getAppStore)())||void 0===t?void 0:t.getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.widgets,l=r&&Object.values(r).some(t=>{var i;return null===(i=t.useUtilities)||void 0===i?void 0:i.some(t=>t.utilityId===e.id)}),c=e.url;if(c&&l){const t=yield s.proxyUtils.isUtilityPremium(e),i=yield s.proxyUtils.isUtilitySubscriber(e);if(t||i){const o=yield s.UtilityManager.getInstance().getUtility(e.id);a[c]={utilities:[o],isPremium:t,isSubscriber:i}}}return a})}(n[e]))}),Promise.allSettled(a).then(e=>{let t={};return e.filter(e=>"fulfilled"===e.status).map(e=>e.value).forEach(e=>{e&&Object.keys(e).forEach(i=>{t[i]?t[i].utilities=t[i].utilities.concat(e[i].utilities):t=Object.assign(Object.assign({},t),e)})}),t})})}function ht(e){return ct(this,arguments,void 0,function*(e,t=!1){var i,o,n,a,r,l,c;const d={};if(!e)return d;e.isDataSourceSet()&&!e.areChildDataSourcesCreated()&&(yield e.childDataSourcesReady());const p=window.jimuConfig.isBuilder?null===(n=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.widgets:null===(r=null===(a=(0,s.getAppStore)().getState())||void 0===a?void 0:a.appConfig)||void 0===r?void 0:r.widgets,u=(null===(l=e.getMainDataSource())||void 0===l?void 0:l.id)===e.id,h=lt.dataComponentsUtils.getWidgetsUsingDsOrItsViews(e.id,p,!1).length>0,m=s.dataSourceUtils.getFullArcGISServiceUrl(null===(c=e.getDataSourceJson())||void 0===c?void 0:c.url,!1);if(u&&m&&(t||h)){const t=yield s.proxyUtils.isDataSourcePremium(e.getDataSourceJson()),i=yield s.proxyUtils.isDataSourceSubscriber(e.getDataSourceJson());(t||i)&&(d[m]={dataSources:[e],isPremium:t,isSubscriber:i})}const g=[];if(u&&e.isDataSourceSet()){const i=(e.type===s.AllDataSourceTypes.WebMap||e.type===s.AllDataSourceTypes.WebScene)&&h||t;e.getChildDataSources().forEach(e=>{g.push(ht(e,i))})}return Promise.allSettled(g).then(e=>{let t=d;return e.filter(e=>"fulfilled"===e.status).map(e=>e.value).forEach(e=>{e&&Object.keys(e).forEach(i=>{t[i]?t[i].dataSources=t[i].dataSources.concat(e[i].dataSources):t=Object.assign(Object.assign({},t),e)})}),t})})}function mt(e,t){var i;if(!e||!t)return null;let s=null;for(const o in t)if((null===(i=t[o])||void 0===i?void 0:i.sourceUrl)===e){s=t[o];break}return s}function gt(e,t,i,s){if(!e||!t)return!1;if(!(e.sourceUrl===t))return!1;if(!(!e.hitsPerInterval&&!i||e.hitsPerInterval===i))return!1;return!((e.intervalSeconds||s)&&e.intervalSeconds!==s)}function vt(){var e,t;const i=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder.appInfo;return null===(t=null==i?void 0:i.typeKeywords)||void 0===t?void 0:t.includes("Registered App")}function ft(){return ct(this,void 0,void 0,function*(){var e,t,i,o,n,a,r,l,c,d;if(!(!(null===(i=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appContext)||void 0===t?void 0:t.jimuConfig)||void 0===i?void 0:i.isInPortal)&&!(null===(a=null===(n=null===(o=(0,s.getAppStore)().getState())||void 0===o?void 0:o.appContext)||void 0===n?void 0:n.jimuConfig)||void 0===a?void 0:a.isDevEdition)))return yield Promise.resolve(!1);const p=vt();let u=!1;if(!p){const e=null===(r=(0,s.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder.appInfo,t=null===(d=null===(c=null===(l=(0,s.getAppStore)().getState())||void 0===l?void 0:l.appStateInBuilder)||void 0===c?void 0:c.user)||void 0===d?void 0:d.username;u=(null==e?void 0:e.owner)===t}if(!(p||u))return yield Promise.resolve(!1);const h=yield dt(),m=Object.keys(h).map(e=>ct(this,void 0,void 0,function*(){return yield s.ServiceManager.getInstance().fetchServiceInfo(e).then(e=>e.isHostedInSamePortal)}));return Promise.allSettled(m).then(e=>e.filter(e=>"fulfilled"===e.status).map(e=>e.value)).then(e=>(null==e?void 0:e.length)>0&&(null==e?void 0:e.some(e=>e)))})}function yt(e,t){return ct(this,void 0,void 0,function*(){if(!e||0===e.length||!t)return void(yield Promise.resolve());const i=wt();yield s.esri.restRequest.request(i,{authentication:s.SessionManager.getInstance().getSessionByUrl((0,s.getAppStore)().getState().portalUrl),httpMethod:"POST",params:{proxies:e.join()}}).then(e=>ct(this,void 0,void 0,function*(){var i;return e.results&&Object.values(e.results).forEach(e=>{e.success&&bt(e.proxyId,t)}),null==t||t.exec(),(null===(i=e.results)||void 0===i?void 0:i.every(e=>!0===e.success))?Promise.resolve():Promise.reject(new Error(`Deleting existing proxy failed: ${JSON.stringify(e)}`))})).catch(i=>ct(this,void 0,void 0,function*(){return e.forEach(e=>{bt(e,t)}),null==t||t.exec(),Promise.reject(new Error(`Deleting existing proxy failed: ${JSON.stringify(i)}`))}))})}function bt(e,t){var i,o,n;const a=null===(n=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.appProxies,r=a&&Object.values(a).find(t=>t.proxyId===e);r&&(null==t||t.removeAppProxy(r.id))}function St(){var e,t,i,o,n,a,r;const l=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.portalUrl,c=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appId;return`${l}/sharing/rest/content/users/${null===(r=null===(a=null===(n=(0,s.getAppStore)().getState())||void 0===n?void 0:n.appStateInBuilder)||void 0===a?void 0:a.appInfo)||void 0===r?void 0:r.owner}/items/${c}`}function xt(){return`${St()}/createProxies`}function wt(){return`${St()}/deleteProxies`}var Ct=v(56499),jt=v.n(Ct),It=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const kt=e=>{const t=window.SVG,{className:i}=e,o=It(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:jt()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};class Ot extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.interval={none:this.props.intl.formatMessage({id:"intervalNone",defaultMessage:O.defaultMessages.intervalNone}),second:this.props.intl.formatMessage({id:"intervalSecond",defaultMessage:O.defaultMessages.intervalSecond}),minute:this.props.intl.formatMessage({id:"intervalMinute",defaultMessage:O.defaultMessages.intervalMinute}),hour:this.props.intl.formatMessage({id:"intervalHour",defaultMessage:O.defaultMessages.intervalHour}),day:this.props.intl.formatMessage({id:"intervalDay",defaultMessage:O.defaultMessages.intervalDay})},this.setIsHostedInSamePortal=()=>{this.props.sourceUrl&&s.ServiceManager.getInstance().fetchServiceInfo(this.props.sourceUrl).then(e=>{this.__unmount||this.setState({isHostedInSamePortal:e.isHostedInSamePortal})})},this.onToggleProxy=()=>{let e;e=this.props.proxySettingConfig?null:(0,s.Immutable)({sourceUrl:this.props.sourceUrl}),this.props.onChange(this.props.sourceUrl,e)},this.onHitsPerIntervalChange=e=>{const t=e,i={sourceUrl:this.props.sourceUrl,hitsPerInterval:t},s=this.props.proxySettingConfig?Object.assign(Object.assign({},this.props.proxySettingConfig),i):i;this.props.onChange(this.props.sourceUrl,s)},this.onIntervalUnitChange=e=>{const t=e.target.value,i=this.getIntervalSeconds(t),s={sourceUrl:this.props.sourceUrl,intervalSeconds:i},o=this.props.proxySettingConfig?Object.assign(Object.assign({},this.props.proxySettingConfig),s):s;this.props.onChange(this.props.sourceUrl,o)},this.state={isHostedInSamePortal:!0}}componentDidMount(){this.__unmount=!1,this.setIsHostedInSamePortal()}componentDidUpdate(e){this.__unmount=!1,e.sourceUrl!==this.props.sourceUrl&&this.setIsHostedInSamePortal()}componentWillUnmount(){this.__unmount=!0}getIntervalUnit(e){if(!e)return"none";switch(e){case 1:return"second";case 60:return"minute";case 3600:return"hour";case 86400:return"day";default:return"none"}}getIntervalSeconds(e){if(!e)return null;switch(e){case"second":return 1;case"minute":return 60;case"hour":return 3600;case"day":return 86400;default:return null}}render(){var e,t;if(!this.props.sourceUrl)return null;const i=this.props.label,o=!!this.props.proxySettingConfig,n=this.getIntervalUnit(null===(e=this.props.proxySettingConfig)||void 0===e?void 0:e.intervalSeconds),a=s.SessionManager.getInstance().getMainSession(),r=`${this.props.sourceUrl}?token=${a.token}`;return(0,x.jsxs)("tr",{className:"row m-0 content-table-tr",children:[(0,x.jsx)("td",{className:"col-2",title:this.state.isHostedInSamePortal?null:this.props.intl.formatMessage({id:"disabledProxyTooltip",defaultMessage:O.defaultMessages.disabledProxyTooltip}),children:(0,x.jsx)(O.Switch,{onChange:this.onToggleProxy,checked:o,className:"mr-2",disabled:!this.state.isHostedInSamePortal,"aria-label":this.props.intl.formatMessage({id:"authorized",defaultMessage:O.defaultMessages.authorized}),"aria-checked":o})}),(0,x.jsx)("td",{className:"col-4",title:i,children:(0,x.jsx)(O.Link,{to:r,target:"_blank",className:"font-size-13 px-0 text-truncate d-block text-left","aria-label":this.props.intl.formatMessage({id:"subscriberContent",defaultMessage:O.defaultMessages.subscriberContent}),children:i})}),(0,x.jsx)("td",{className:"col-2",children:this.props.isPremium&&(0,x.jsx)(kt,{size:"m"})}),(0,x.jsx)("td",{className:"col-2",children:o&&(0,x.jsx)(O.NumericInput,{size:"sm",value:null===(t=this.props.proxySettingConfig)||void 0===t?void 0:t.hitsPerInterval,onChange:this.onHitsPerIntervalChange,precision:0,min:1,className:"request-limit","aria-label":this.props.intl.formatMessage({id:"requestLimit",defaultMessage:O.defaultMessages.requestLimit})})}),(0,x.jsx)("td",{className:"col-2",children:o&&(0,x.jsx)(O.Select,{value:n,onChange:this.onIntervalUnitChange,size:"sm",className:"request-interval","aria-label":this.props.intl.formatMessage({id:"requestInterval",defaultMessage:O.defaultMessages.requestInterval}),children:Object.keys(this.interval).map((e,t)=>(0,x.jsx)("option",{value:e,selected:e===n,children:this.interval[e]},t))})})]})}}const Tt=s.dataSourceUtils.dataSourceJsonCreator;class Pt extends s.React.PureComponent{constructor(){super(...arguments),this.columnName={authorized:this.props.intl.formatMessage({id:"authorized",defaultMessage:O.defaultMessages.authorized}),subscriberContent:this.props.intl.formatMessage({id:"subscriberContent",defaultMessage:O.defaultMessages.subscriberContent}),credits:this.props.intl.formatMessage({id:"credits",defaultMessage:O.defaultMessages.credits}),requestLimit:this.props.intl.formatMessage({id:"requestLimit",defaultMessage:O.defaultMessages.requestLimit}),requestInterval:this.props.intl.formatMessage({id:"requestInterval",defaultMessage:O.defaultMessages.requestInterval})},this.onProxyChange=(e,t)=>{const i=this.props.proxySettingConfigs||{},o=Object.assign({},i),n=Tt.getDataSourceTypeFromArcGISWholeServiceUrl(e)===s.DataSourceTypes.SceneService;if(t){if(o[e]=t,n){const i=e.replace("/SceneServer","/FeatureServer"),s=Object.assign(Object.assign({},t),{sourceUrl:i});o[i]=s}}else if(delete o[e],n){delete o[e.replace("/SceneServer","/FeatureServer")]}this.props.onChange(o)}}render(){const e=this.props.needProxyItems,t=this.props.proxySettingConfigs;return(0,x.jsxs)("div",{className:(0,s.classNames)("h-100 w-100 bg-light-300",{[this.props.className]:!!this.props.className}),children:[(0,x.jsxs)("div",{className:"subscriber-warning",children:[!this.props.appHasBeenSaved&&(0,x.jsx)("div",{children:this.props.intl.formatMessage({id:"unsavedChangedRemind",defaultMessage:O.defaultMessages.unsavedChangedRemind})}),this.props.intl.formatMessage({id:"subscriberWarning",defaultMessage:O.defaultMessages.subscriberWarning})]}),(0,x.jsx)("div",{className:"secondary-title mt-5 mb-4",children:this.props.intl.formatMessage({id:"data",defaultMessage:O.defaultMessages.data})}),(0,x.jsxs)("table",{className:"content-table w-100",children:[(0,x.jsx)("thead",{className:"content-table-header container",children:(0,x.jsx)("tr",{className:"row",children:Object.keys(this.columnName).map((e,t)=>(0,x.jsx)("th",{className:(0,s.classNames)("text-truncate",{"col-4":"subscriberContent"===e,"col-2":"subscriberContent"!==e}),title:this.columnName[e],children:this.columnName[e]},t))})}),(0,x.jsx)("tbody",{className:"container",children:e&&Object.keys(e).map((i,s)=>{var o,n;const a=e[i];return(0,x.jsx)(Ot,{isPremium:a.isPremium,isSubscriber:a.isSubscriber,sourceUrl:i,intl:this.props.intl,onChange:this.onProxyChange,label:null===(n=null===(o=a.items)||void 0===o?void 0:o[0])||void 0===n?void 0:n.label,proxySettingConfig:null==t?void 0:t[i]},s)})})]})]})}}const Nt=(0,s.injectIntl)((0,m.withStyles)(Pt,"ProxySetting"));var Mt=function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((s=s.apply(e,t||[])).next())})};const Lt=s.dataSourceUtils.dataSourceJsonCreator,Dt={};class At extends s.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.headerRef=s.React.createRef(),this.getProxySettingConfigs=e=>{var t,i;const o={},n=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.appProxies;return Object.keys(e).forEach(e=>{const t=mt(e,n);t&&(o[e]=t.without("id").without("proxyId").without("proxyUrl"))}),Promise.resolve(o)},this.registerApp=()=>Mt(this,void 0,void 0,function*(){var e,t,i,o;const n=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appId;if(Dt[n])return yield Dt[n];const a=`${null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.portalUrl}/sharing/rest/oauth2/registerApp`;return Dt[n]=s.esri.restRequest.request(a,{authentication:s.SessionManager.getInstance().getSessionByUrl((0,s.getAppStore)().getState().portalUrl),httpMethod:"POST",params:{itemId:n,appType:"browser",redirect_uris:JSON.stringify([this.getAppRootUrl()])}}),yield Dt[n]}),this.createProxies=e=>Mt(this,void 0,void 0,function*(){var t,i,o;if(!e)return yield Promise.resolve(null);const n=null===(o=null===(i=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===o?void 0:o.appProxies,a={};let r=[];if(Object.keys(e).forEach(t=>{const i=e[t];if(!i)return;const s=i.hitsPerInterval,o=i.intervalSeconds,l=mt(t,n);gt(l,t,s,o)?a[l.id]=l:r=r.concat({sourceUrl:t,hitsPerInterval:s,intervalSeconds:o})}),0===r.length)return(0,s.Immutable)(a);vt()||(yield this.registerApp());const l={referrers:[this.getAppOrTemplateUrl()].concat(s.proxyUtils.getProxyReferrers())},c=xt();return s.esri.restRequest.request(c,{authentication:s.SessionManager.getInstance().getSessionByUrl((0,s.getAppStore)().getState().portalUrl),httpMethod:"POST",params:{serviceProxyParams:l,proxies:r}}).then(e=>{var t,i;const o=(null==e?void 0:e.appProxies)||[],n=a,r=null===(i=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig,l=null==r?void 0:r.appProxies;return o.forEach(e=>{const t=mt(e.sourceUrl,l),i=(null==t?void 0:t.id)||s.appConfigUtils.getUniqueId("appProxy");n[i]=Object.assign(Object.assign({},e),{id:i})}),(0,s.Immutable)(n)})}),this.getAppRootUrl=()=>{var e;return null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.origin},this.getAppOrTemplateUrl=()=>{var e,t,i,o,n,a;const r=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appId,l=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appInfo,c="Web Experience Template"===(null==l?void 0:l.type),d=null===(n=s.urlUtils.getAppUrl({id:r,type:c?"template":"app"}))||void 0===n?void 0:n.replace(/^\//,"");return`${null===(a=this.getAppRootUrl())||void 0===a?void 0:a.replace(/\/$/,"")}/${d}`},this.onProxyConfigChange=e=>{this.setState({proxySettingConfigs:e})},this.onFinish=()=>{var e,t,i,o;this.setState({isLoading:!0});const n=this.state.proxySettingConfigs||{},a=null===(i=null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.appProxies,r=a&&Object.values(a).filter(e=>{var t;let i=n[null==e?void 0:e.sourceUrl];if(Lt.getDataSourceTypeFromArcGISWholeServiceUrl(null==e?void 0:e.sourceUrl)===s.DataSourceTypes.FeatureService){const s=null===(t=null==e?void 0:e.sourceUrl)||void 0===t?void 0:t.replace("/FeatureServer","/SceneServer"),o=n[s];i=i||(o?Object.assign(Object.assign({},o),{sourceUrl:null==e?void 0:e.sourceUrl}):null)}return!i||!gt(e,i.sourceUrl,i.hitsPerInterval,i.intervalSeconds)});yt(null==r?void 0:r.map(e=>e.proxyId),null===(o=this.state)||void 0===o?void 0:o.getAppConfigAction()).then(()=>this.createProxies(n).then(e=>{var t;if(!this.__unmount){if(e){const i=null===(t=this.state)||void 0===t?void 0:t.getAppConfigAction();Object.keys(e).forEach(t=>{null==i||i.editAppProxy(e[t])}),null==i||i.exec()}const i=(0,s.getAppStore)().getState().appStateInBuilder.appConfig;this.props.onFinish(i)}})).catch(e=>{console.error("Creating proxy failed: ",e),this.setState({isLoading:!1,isError:!0})})},this.getPublishButtonText=()=>{const{appHasBeenSaved:e,intl:t}=this.props;return e?t.formatMessage({id:"publish",defaultMessage:s.defaultMessages.publish}):t.formatMessage({id:"saveAndPublish",defaultMessage:O.defaultMessages.saveAndPublish})},this.getSubscriberContentString=()=>{const{appHasBeenSaved:e,intl:t}=this.props;return e?t.formatMessage({id:"subscriberContents",defaultMessage:O.defaultMessages.subscriberContents}):t.formatMessage({id:"unsavedChangesAndSubscriberContents",defaultMessage:O.defaultMessages.unsavedChangesAndSubscriberContents})},this.onKeydown=e=>{var t,i;"Escape"===e.key&&(0,s.focusElementInKeyboardMode)(null===(i=null===(t=this.headerRef.current)||void 0===t?void 0:t.querySelector)||void 0===i?void 0:i.call(t,"button.close"))},this.state={getAppConfigAction:null,isLoading:!1,isError:!1,proxySettingConfigs:null,needProxyItems:null}}componentDidMount(){this.__unmount=!1,s.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})}),this.setState({isLoading:!0}),this.initNeedProxyItemsAndProxySettingConfigs()}componentDidUpdate(e){!e.isOpen&&this.props.isOpen&&this.initNeedProxyItemsAndProxySettingConfigs()}initNeedProxyItemsAndProxySettingConfigs(){return Mt(this,void 0,void 0,function*(){this.setState({isLoading:!0});try{const e=yield dt(),t=yield this.getProxySettingConfigs(e);this.__unmount||this.setState({proxySettingConfigs:t,needProxyItems:e,isLoading:!1})}catch(e){this.__unmount||this.setState({isLoading:!1}),console.error("Getting proxy config error",e)}})}componentWillUnmount(){this.__unmount=!0}render(){const e=this.state.proxySettingConfigs,t=this.state.needProxyItems,i=this.getSubscriberContentString();return(0,x.jsxs)(O.Modal,{isOpen:this.props.isOpen,centered:!0,className:(0,s.classNames)({[this.props.className]:!!this.props.className}),onKeyDown:this.onKeydown,returnfocusafterclose:"true",contentClassName:"proxy-setting-container",backdrop:"static","aria-label":i,children:[(0,x.jsx)("div",{ref:this.headerRef,children:(0,x.jsx)(O.ModalHeader,{className:"d-flex justify-content-between header px-30",toggle:this.props.onToggle,children:(0,x.jsx)("div",{className:"flex-grow-1 text-truncate",children:i})})}),(0,x.jsx)(O.ModalBody,{className:"d-flex px-30",children:(0,x.jsx)(Nt,{onChange:this.onProxyConfigChange,proxySettingConfigs:e,needProxyItems:t,appHasBeenSaved:this.props.appHasBeenSaved})}),(0,x.jsxs)(O.ModalFooter,{className:"px-30",children:[(0,x.jsx)(O.Button,{className:"mr-2",type:"primary",onClick:this.onFinish,children:this.getPublishButtonText()}),(0,x.jsx)(O.Button,{type:"default",onClick:this.props.onCancel,children:this.props.intl.formatMessage({id:"cancel",defaultMessage:s.defaultMessages.cancel})})]}),this.state.isLoading&&(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary}),this.state.isError&&(0,x.jsx)(O.Message,{severity:"error",withIcon:!0,open:this.state.isError,autoHideDuration:5e3,onClose:()=>{this.setState({isError:!1})},message:this.props.intl.formatMessage({id:"createProxyToPublishAppError",defaultMessage:O.defaultMessages.createProxyToPublishAppError})})]})}}const Rt=(0,m.withStyles)((0,m.withTheme)((0,s.injectIntl)(At)),"ProxySettingPopup"),Et=s.ReactRedux.connect((e,t)=>{var i,s;return{appProxies:null===(s=null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===s?void 0:s.appProxies}})(Rt);var Ft=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};class Bt extends s.React.PureComponent{componentDidUpdate(e){this.props.pageId===e.pageId&&this.props.sizemode===e.sizemode||this.props.toggle()}getStyle(){const{theme:e}=this.props;return e&&s.css`
      background-color: ${e.ref.palette.neutral[400]};
      ${(0,m.popperPointer)({background:e.ref.palette.neutral[400],border:{color:e.ref.palette.neutral[600],width:"1px"}})}
    `}render(){const e=this.props,{pageId:t,sizemode:i,dispatch:s}=e,o=Ft(e,["pageId","sizemode","dispatch"]);return(0,x.jsx)(O.Popper,Object.assign({className:"page-aware-popper",css:this.getStyle()},o))}}const Ut=s.ReactRedux.connect(function(e){return{pageId:e.appRuntimeInfo.currentPageId,sizemode:e.browserSizeMode}})(Bt);var zt=v(62838),$t=v.n(zt),Vt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Wt=e=>{const t=window.SVG,{className:i}=e,o=Vt(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:$t()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Gt=v(71245),Ht=v.n(Gt),_t=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Jt=e=>{const t=window.SVG,{className:i}=e,o=_t(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Ht()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Kt=v(2918),qt=v.n(Kt),Xt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Yt=e=>{const t=window.SVG,{className:i}=e,o=Xt(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:qt()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))},Qt=1e3,Zt=s.css`
  color: var(ref-palette-neutral-1100);

  .widget-enterprise-btn {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  .px-20 {
    padding-left: 18px;
    padding-right: 18px;
  }

  .pt-20 {
    padding-top: 20px;
  }

  .list-container {
    height: calc(100% - 150px);
    overflow-y: auto;
    padding-bottom: 20px;
  }

  .groups {
    font-size: 13px;
    font-weight: 600;
    color: var(--ref-palette-neutral-900);
  }

  .group-select {
    width: 210px;
  }

  .widget-group {
    .group-label{
      font-size: 13px;
      font-weight: 600;
      color: var(--ref-palette-neutral-900);
    }
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    grid-row-gap: 0.5rem;
    grid-column-gap: 0.5rem;
  }

  .widget-card {
    height: 80px;
    width: 112px;
    padding: 0;
    border: none;
    position: relative;

    .widget-card--content {
      padding-top: 12px;
      cursor: pointer;
      background-color: var(--ref-palette-neutral-500);
      &:hover {
        background-color: var(--ref-palette-neutral-600);
      }
    }

    .widget-card-image {
      width: 20px;
      height: 20px;
      &:after {
        display: none;
      }
      img {
        width: 20px;
        height: 20px;
      }
    }

    .widget-card-name {
      line-height: 1rem;
      max-height: 2rem;
      white-space: normal;
      color: var(--ref-palette-neutral-1200);
      padding: 0 5px;
      font-size: 13px;
    }
  }
`;class ei extends s.React.PureComponent{constructor(e){super(e),this.allGroup={value:Qt,label:this.props.intl.formatMessage({id:"all",defaultMessage:O.defaultMessages.all})},this.getRequireLicenseIconTooltip=e=>this.props.intl.formatMessage({id:`${e}License`}),this.getRequireLicenseIcon=e=>{switch(e){case"Enterprise":return(0,x.jsx)(Jt,{});case"Autodesk":return(0,x.jsx)(Yt,{})}},this.WidgetCard=({widgetInfo:e})=>{var t,i,o;return(0,x.jsxs)("div",{className:"d-flex align-items-start justify-content-center widget-card",children:[(null===(t=e.manifest)||void 0===t?void 0:t.requireLicense)&&(0,x.jsx)(O.Button,{title:this.getRequireLicenseIconTooltip(e.manifest.requireLicense),type:"tertiary",className:"widget-enterprise-btn",disableHoverEffect:!0,disableRipple:!0,icon:!0,size:"sm",children:this.getRequireLicenseIcon(e.manifest.requireLicense)}),(0,x.jsx)(O.Button,{className:"w-100 h-100 p-0",onClick:()=>{this.props.onSelect(e)},"aria-label":e.label,children:(0,x.jsxs)("div",{className:"d-flex flex-column w-100 h-100 widget-card--content",children:[(0,x.jsx)("div",{className:"d-flex justify-content-center",children:(0,x.jsx)("div",{className:"widget-card-image",children:(0,x.jsx)(O.Icon,{size:20,className:"w-100 m-0",autoFlip:null===(o=null===(i=e.manifest)||void 0===i?void 0:i.properties)||void 0===o?void 0:o.flipIcon,icon:"string"==typeof e.icon?e.icon:e.icon&&e.icon.svg,color:"var(--ref-palette-neutral-1200)"})})}),(0,x.jsx)("div",{className:"flex-grow-1 d-flex align-items-center",children:(0,x.jsx)("div",{className:"widget-card-name w-100 text-center text-capitalize text-truncate",css:s.css`
                line-height: 1rem;
                max-height: 2.2rem;
                white-space: normal;
              `,title:e.label,children:e.label})})]})},e.name)]})},this.WidgetGroup=({group:e})=>{if(!e)return null;const t=this.WidgetCard;return(0,x.jsxs)("div",{className:"widget-group w-100 mb-4",children:[(0,x.jsx)("h4",{className:"group-label w-100 text-break",title:e.label,children:e.label}),(0,x.jsx)("div",{className:"card-grid m-0",children:e.itemList.sort((e,t)=>e.order-t.order).map((e,i)=>e?(0,x.jsx)(t,{widgetInfo:e},i):(0,x.jsx)("div",{className:"widget-card",style:{visibility:"hidden"}},i))})]})},this.getGroupList=(e,t,i)=>{var s,o,n,a;const r=[this.allGroup];if(!!e){const t=this.getCommonGroups(e,Qt,i);t&&Object.values(t).forEach(e=>{"number"==typeof e.groupId&&r.push({value:e.groupId,label:this.getGroupLabel(e.groupId)})})}if(null===(o=null===(s=this.state.jimuForBuilderUtils)||void 0===s?void 0:s.showCustomWidgets)||void 0===o?void 0:o.call(s,e)){this.getCustomGroup(e,t,Qt,i)&&r.push({value:null===(n=this.state.jimuForBuilderUtils)||void 0===n?void 0:n.CUSTOM_GROUP,label:this.getGroupLabel(null===(a=this.state.jimuForBuilderUtils)||void 0===a?void 0:a.CUSTOM_GROUP)})}return r.filter(e=>!!e.label)},this.changeSelectedGroup=e=>{this.setState({selectedGroup:e.target.value})},this.onSearchValueChange=e=>{this.setState({searchValue:e.target.value,selectedGroup:Qt})},this.state={selectedGroup:Qt,commonWidgetList:null,remoteCustomWidgetList:null,searchValue:"",jimuForBuilderUtils:null},this.searchInputRef=s.React.createRef()}componentDidMount(){this.loadJimuForBuilderUtilsPromise=s.cancelablePromise.cancelable(s.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.setState({jimuForBuilderUtils:null==e?void 0:e.utils})})),s.lodash.defer(()=>{(0,s.focusElementInKeyboardMode)(this.searchInputRef.current,!0)})}componentDidUpdate(e,t){!t.jimuForBuilderUtils&&this.state.jimuForBuilderUtils&&(this.loadCommonWidgetList(this.state.jimuForBuilderUtils.fetchCommonWidgetList),this.loadCustomWidgetList(this.state.jimuForBuilderUtils.fetchRemoteCustomWidgetList))}componentWillUnmount(){var e,t,i;null===(e=this.loadJimuForBuilderUtilsPromise)||void 0===e||e.cancel(),null===(t=this.loadCommonWidgetsPromise)||void 0===t||t.cancel(),null===(i=this.loadCommonWidgetsPromise)||void 0===i||i.cancel()}loadCommonWidgetList(e){e&&(this.loadCommonWidgetsPromise=s.cancelablePromise.cancelable(e().then(e=>{var t,i;const s=null==e?void 0:e.filter(e=>this.props.isAccepted(e,this.props.isPlaceholder));null===(i=(t=this.props).onWidgetLoaded)||void 0===i||i.call(t),this.setState({commonWidgetList:s})})))}loadCustomWidgetList(e){e&&(this.loadRemoteCustomWidgetsPromise=s.cancelablePromise.cancelable(e().then(e=>{var t,i;const s=null==e?void 0:e.filter(e=>this.props.isAccepted(e,this.props.isPlaceholder));null===(i=(t=this.props).onWidgetLoaded)||void 0===i||i.call(t),this.setState({remoteCustomWidgetList:s})})))}getGroupLabel(e){var t,i;return null===(i=null===(t=this.state.jimuForBuilderUtils)||void 0===t?void 0:t.getWidgetsGroupLabel)||void 0===i?void 0:i.call(t,e,this.props.intl)}getCommonGroups(e,t,i){const s=t===Qt?e:null==e?void 0:e.filter(e=>e.group===t),o={};return null==s||s.forEach(e=>{var t;if(e.group===(null===(t=this.state.jimuForBuilderUtils)||void 0===t?void 0:t.CUSTOM_GROUP))return;const s=this.getGroupLabel(e.group);(this.isFuzzySearch(s,i)||this.isFuzzySearch(e.label,i))&&(o[e.group]||(o[e.group]={label:s,groupId:e.group,itemList:[]}),o[e.group].itemList.push(e))}),o}getCustomGroup(e,t,i,s){var o,n,a;if(i===Qt||i===(null===(o=this.state.jimuForBuilderUtils)||void 0===o?void 0:o.CUSTOM_GROUP)){const i=this.getGroupLabel(null===(n=this.state.jimuForBuilderUtils)||void 0===n?void 0:n.CUSTOM_GROUP),o=(t||[]).concat((null==e?void 0:e.filter(e=>{var t;return e.group===(null===(t=this.state.jimuForBuilderUtils)||void 0===t?void 0:t.CUSTOM_GROUP)}))||[]).filter(e=>this.isFuzzySearch(i,s)||this.isFuzzySearch(e.label,s));if(!s||o.length>0)return{label:i,groupId:null===(a=this.state.jimuForBuilderUtils)||void 0===a?void 0:a.CUSTOM_GROUP,itemList:o}}return null}isFuzzySearch(e,t){return!!e&&(!t||e.toLocaleLowerCase().includes(t.toLocaleLowerCase()))}render(){var e,t,i,o;const n=this.WidgetGroup,{commonWidgetList:a,remoteCustomWidgetList:r,selectedGroup:l,searchValue:c}=this.state,d=!!a;let p=a;const u=null===(t=null===(e=this.state.jimuForBuilderUtils)||void 0===e?void 0:e.getSectionItemForWidgetsList)||void 0===t?void 0:t.call(e,this.props.intl);d&&this.props.isAccepted(u,this.props.isPlaceholder)&&(p=a.concat([u]));const h=d&&this.getCommonGroups(p,l,c),m=null===(o=null===(i=this.state.jimuForBuilderUtils)||void 0===i?void 0:i.showCustomWidgets)||void 0===o?void 0:o.call(i,p),g=m&&this.getCustomGroup(p,r,l,c),v=this.getGroupList(p,r,c);return(0,x.jsxs)("div",{className:(0,s.classNames)("content mt-4",this.props.className),css:Zt,children:[(0,x.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4 px-20",children:(0,x.jsx)(O.TextInput,{ref:this.searchInputRef,prefix:(0,x.jsx)(G,{size:16,color:"var(--ref-palette-neutral-800)"}),value:c,onChange:this.onSearchValueChange,className:"w-100",size:"sm",placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:s.defaultMessages.search}),allowClear:!0})}),(0,x.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4 px-20",children:[(0,x.jsx)("div",{className:"groups",children:this.props.intl.formatMessage({id:"category",defaultMessage:O.defaultMessages.category})}),(0,x.jsx)(O.Select,{className:"group-select",size:"sm",value:l,onChange:this.changeSelectedGroup,children:v.map((e,t)=>(0,x.jsx)("option",{value:e.value,selected:e.value===l,children:e.label},t))})]}),(0,x.jsxs)("div",{className:"w-100 list-container px-20",children:[!a&&(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary}),d&&Object.values(h).sort((e,t)=>e.groupId-t.groupId).map((e,t)=>(0,x.jsx)(n,{group:e},t)),m&&(0,x.jsx)(n,{group:g})]})]})}}ei.defaultProps={isPlaceholder:!1,isAccepted:()=>!0};const ti=(0,s.injectIntl)(ei),ii={rootBoundary:"viewport",padding:0},si={fallbackPlacements:["top","right","bottom","left"]},oi=s.css`
  background-color: var(--sys-color-surface-paper);
  color: var(--ref-palette-neutral-1100);

  .content {
    height: 600px;
    width: 404px;
    overflow: hidden;
    padding: 0;
  }

  .title {
    font-size: 16px;
    font-weight: 600;
    color: var(--ref-palette-neutral-1100);
  }

  .px-20 {
    padding-left: 20px;
    padding-right: 20px;
  }

  .pt-20 {
    padding-top: 20px;
  }
`;class ni extends s.React.PureComponent{constructor(e){super(e),this.togglePopper=e=>{this.state.open&&this.props.onClose&&this.props.onClose(e)},this.onWidgetLoaded=()=>{this.setState({generation:this.state.generation+1})},this.state={open:!0,generation:0}}render(){var e;return this.state.open?(0,x.jsx)(Ut,{className:this.props.className,placement:null!==(e=this.props.placement)&&void 0!==e?e:"bottom",toggle:this.togglePopper,css:oi,version:this.state.generation,shiftOptions:ii,flipOptions:si,reference:this.props.referenceElement,open:!0,forceLatestFocusElements:!0,autoFocus:!1,children:(0,x.jsxs)("div",{className:"shadow-3 content",css:this.props.css,children:[(0,x.jsxs)("div",{className:"d-flex justify-content-between align-items-center px-20 pt-20",children:[(0,x.jsx)("div",{className:"title",children:this.props.intl.formatMessage({id:"addWidget",defaultMessage:O.defaultMessages.addWidget})}),(0,x.jsx)(O.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.togglePopper,title:this.props.intl.formatMessage({id:"close",defaultMessage:s.defaultMessages.close}),children:(0,x.jsx)(Wt,{})})]}),(0,x.jsx)(ti,{isPlaceholder:this.props.isPlaceholder,isAccepted:this.props.isAccepted,onSelect:this.props.onSelect,onWidgetLoaded:this.onWidgetLoaded})]})}):null}}ni.defaultProps={isPlaceholder:!1,isAccepted:()=>!0};const ai=(0,s.injectIntl)(ni);var ri=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const li=s.css`button { padding: 0 !important; }`,ci=e=>{const{rootItemJson:t,onSort:i,onRemove:o,css:n,className:a}=e,r=ri(e,["rootItemJson","onSort","onRemove","css","className"]),[l,c]=s.React.useState(0),d=s.React.useMemo(()=>0===l?t:Object.assign({},t),[t,l]),p=s.React.useCallback((e,t)=>{"handleDidDrop"===e.updateType&&(null==i||i(e))},[i]),u=s.hooks.useTranslation(O.defaultMessages),h=s.React.useCallback((e,t)=>{var i;const s=t.props.itemJsons[0];return(0,x.jsxs)("div",{css:li,className:"d-flex align-items-center justify-content-end",children:[(null===(i=s.itemChildren)||void 0===i?void 0:i.length)>0&&(0,x.jsx)(O.Tooltip,{title:s.itemStateExpanded?u("collapse"):u("expand"),children:(0,x.jsx)(O.Button,{onClick:()=>{s.itemStateExpanded=!s.itemStateExpanded,c(e=>e+1)},type:"tertiary",disableHoverEffect:!0,disableRipple:!0,icon:!0,"aria-expanded":s.itemStateExpanded,children:s.itemStateExpanded?(0,x.jsx)(Ue,{size:"s"}):(0,x.jsx)(Re,{size:"s"})})}),(0,x.jsx)(O.Tooltip,{title:u("deleteOption"),children:(0,x.jsx)(O.Button,{onClick:()=>{null==o||o(s)},type:"tertiary",disableHoverEffect:!0,disableRipple:!0,icon:!0,children:(0,x.jsx)(Wt,{size:"s"})})})]})},[o,u]);(0,m.useTheme)();return(0,x.jsx)(H.Tree,Object.assign({css:[s.css`
width: 100%;
.jimu-tree-main {
  padding: 2px 0 2px 0;
  overflow: hidden;
}
.jimu-tree-item__drag-handle, .jimu-tree-item__title {
  cursor: move;
}
.jimu-tree-item__children-toggle {
  display: none;
}
.toggle-placeholder {
  display: none;
}
.jimu-collapse {
  width: 100%;
}
`,n],className:(0,s.classNames)("sort-tree",a),rootItemJson:d,dndEnabled:!0,isMultiSelection:!1,treeAlignmentType:H.TreeAlignmentType.Intact,renderOverrideItemCommands:h},r,{onUpdateItem:p}))},di={rootBoundary:"viewport",padding:0},pi={fallbackPlacements:["top","right","bottom","left"]},ui=e=>{const{title:t,placement:i,referenceElement:o,onClose:n,css:a,className:r,rootItemJson:l,onSort:c,onRemove:d}=e;return(0,x.jsx)(m.ThemeSwitchComponent,{useTheme2:!0,children:(0,x.jsxs)(Ut,{placement:null!=i?i:"bottom",reference:o,toggle:n,css:a,className:(0,s.classNames)("sort-tree-popper",r),shiftOptions:di,flipOptions:pi,open:!0,forceLatestFocusElements:!0,children:[(0,x.jsx)(O.PanelHeader,{className:"p-3",title:t,onClose:n}),(0,x.jsx)("div",{className:"panel-body p-3",children:(0,x.jsx)(ci,{rootItemJson:l,onSort:c,onRemove:d})})]})})};var hi=v(29435),mi=v.n(hi),gi=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const vi=e=>{const t=window.SVG,{className:i}=e,o=gi(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:mi()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var fi=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const yi=()=>s.css`
  .jimu-collapse-wrapper-inner {
    padding-top: var(--sys-spacing-2);
  }
`,bi=()=>s.css`
  flex-grow: 1;
  display: flex;
  justify-content: space-between;
  align-items: center;
  .label {
    color:  var(--sys-color-action-text);
    &.disabled {
      color: var(--sys-color-action-disabled-text);
    }
  }
`;function Si(e){const{label:t,isEmpty:i,onReset:s,children:o}=e,n=fi(e,["label","isEmpty","onReset","children"]),a=(0,x.jsx)(xi,{label:t,isEmpty:i,onReset:s});return(0,x.jsx)(O.CollapsablePanel,Object.assign({css:yi(),headerTag:"div",label:a,"aria-label":t},n,{defaultIsOpen:!i,children:o}))}function xi(e){const{label:t,isEmpty:i,onReset:o}=e,n=s.hooks.useTranslation(O.defaultMessages)("reset");return(0,x.jsxs)("div",{css:bi(),children:[(0,x.jsx)("span",{className:(0,s.classNames)("label",{disabled:i}),children:t}),!i&&(0,x.jsx)(O.Button,{size:"sm",variant:"text",icon:!0,title:n,"aria-label":t,className:"p-0",onClick:o,children:(0,x.jsx)(vi,{})})]})}var wi=v(16884);function Ci(e){var t,i,o,n;const{template:a,onClick:r}=e,l=(0,s.getAppStore)().getState().appContext.locale,c=null!==(i=null===(t=a.i18nLabel)||void 0===t?void 0:t[l])&&void 0!==i?i:a.label,d=null!==(n=null===(o=a.i18nDescription)||void 0===o?void 0:o[l])&&void 0!==n?n:a.description,p=null!=a.gifThumbnail,u="templage_desc_"+a.name,h=s.React.useMemo(()=>s.css`
    transform: ${(0,s.getAppStore)().getState().appContext.isRTL&&a.flipThumbnail?"scaleX(-1);":""}  ;
  `,[a]);return(0,x.jsxs)("div",{className:"block-item",children:[(0,x.jsx)(O.Tooltip,{title:d,children:(0,x.jsxs)(O.Button,{role:"option","aria-label":c,"aria-describedby":u,onClick:r,className:"block-item--icon p-0",children:[(0,x.jsx)("img",{className:(0,s.classNames)("default-icon",{"multiple-icon":p}),css:h,src:a.thumbnail,draggable:!1,width:a.thumbnailWidth/2,height:a.thumbnailHeight/2}),p&&(0,x.jsx)("img",{className:(0,s.classNames)("gif-icon",{"multiple-icon":p}),css:h,draggable:!1,src:a.gifThumbnail})]})}),(0,x.jsx)("span",{"aria-hidden":!0,className:"block-item-label text-center mt-2",css:s.css`max-width: ${a.thumbnailWidth/2}px`,children:c}),(0,x.jsx)("span",{"aria-hidden":!0,className:"sr-only",id:u,children:d})]})}var ji=v(39524),Ii=v.n(ji),ki=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Oi=e=>{const t=window.SVG,{className:i}=e,o=ki(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Ii()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Ti=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};function Pi(e){const{templates:t,onItemSelect:i,formatMessage:o,className:n=""}=e,a=Ti(e,["templates","onItemSelect","formatMessage","className"]),r=s.React.useMemo(()=>(0,m.getBuilderThemeVariables)(),[]),l=s.React.useMemo(()=>s.css`
    width: auto;
    padding: 20px;
    background-color: ${r?r.ref.palette.neutral[400]:"var(--ref-palette-neutral-400)"};
    &.with-items {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-row-gap: 10px;
      grid-column-gap: 10px;
    }

    .block-item {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 0;

      .jimu-btn {
        border-radius: unset !important;
      }

      .block-item--icon {
        background: ${r?r.ref.palette.neutral[300]:"var(--ref-palette-neutral-300)"};
        border: none;
        position: relative;
        cursor: pointer;

        .default-icon {
          opacity: 1;
        }
        .gif-icon {
          opacity: 0;
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
      }
      .block-item--icon:hover {
        outline: 2px solid ${r?r.sys.color.primary.main:"var(--sys-color-primary-main)"};
        .default-icon.multiple-icon {
          opacity: 0;
        }
        .gif-icon {
          opacity: 1;
        }
      }

      .block-item-label {
        user-select: none;
        color: ${r?r.ref.palette.neutral[900]:"var(--ref-palette-neutral-900)"};
      }
    }

    .size-mode-SMALL & .block-item {
      width: 140px;
      height: auto;
    }

    .empty-placeholder {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      .empty-placeholder-icon{
        color: var(--sys-color-action-disabled-text);
      }
      .empty-placeholder-text{
        color: ${r?r.ref.palette.neutral[900]:"var(--ref-palette-neutral-900)"};
        font-size: ${s.polished.rem(14)};
        margin-top: 16px;
      }
    }

  `,[r]);return(0,x.jsxs)("div",Object.assign({className:(0,s.classNames)(n,window.jimuConfig.isInBuilder?m.Theme2GlobalStyleClassName:"",t.length>0?"with-items":""),css:l},a,{role:"listbox",children:[t.map(e=>(0,x.jsx)(Ci,{template:e,onClick:()=>{i(e)}},e.name)),0===t.length&&(0,x.jsxs)("div",{className:"empty-placeholder w-100",children:[(0,x.jsx)("div",{className:"empty-placeholder-icon",children:(0,x.jsx)(Oi,{size:48})}),(0,x.jsx)("div",{className:"empty-placeholder-text",children:o("noTemplatesAvailable")})]})]}))}var Ni=v(48799),Mi=v.n(Ni),Li=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Di=e=>{const t=window.SVG,{className:i}=e,o=Li(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Mi()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};class Ai extends s.React.PureComponent{constructor(e){super(e),this.onTabSelect=e=>{this.props.onTabSelect(e)},this.onFullScreenTypeChange=e=>{this.setState({fullScreenType:e.target.value})},this.getValueLabelItems=e=>e.map(e=>({value:e,label:e})),this.getCapabilitiesForFullScreenApp=()=>{const e=(0,wi.getTemplateCapabilitiesOnlyInCurrentLocale)(wi.TemplateType.FullScreenPage),t=(0,wi.getTemplateCapabilitiesOnlyInCurrentLocale)(wi.TemplateType.FullScreenGridPage),i=e.concat(t),s=Array.from(new Set(i)).sort();return this.getValueLabelItems(s)},this.getCapabilitiesForScrollingPage=()=>{const e=(0,wi.getTemplateCapabilitiesOnlyInCurrentLocale)(wi.TemplateType.ScrollingPage);return this.getValueLabelItems(e)},this.getFilterdTemplatesForFullScreenApp=e=>{let t=[];if("fixed"===e)t=(0,wi.getFullScreenPageTemplates)();else if("grid"===e)t=(0,wi.getFullScreenGridPageTemplates)();else{const e=(0,wi.getFullScreenPageTemplates)(),i=(0,wi.getFullScreenGridPageTemplates)();t=[e[0],i[0]].concat(e.slice(1),i.slice(1))}const i=this.state.capabilitiesSelectedForFullScreenApp.map(e=>e.label);return(0,wi.getTemplatesByCapabilityTags)(t,i)},this.getFilterdTemplatesForScrollingPage=()=>{const e=(0,wi.getScrollingPageTemplates)(),t=this.state.capabilitiesSelectedForScrollingPage.map(e=>e.label);return(0,wi.getTemplatesByCapabilityTags)(e,t)},this.state={fullScreenType:"all",capabilitiesForFullScreenApp:this.getCapabilitiesForFullScreenApp(),capabilitiesForScrollingPage:this.getCapabilitiesForScrollingPage(),capabilitiesSelectedForFullScreenApp:[],capabilitiesSelectedForScrollingPage:[]}}render(){const{theme:e,formatMessage:t}=this.props,{fullScreenType:i}=this.state,o=this.getFilterdTemplatesForFullScreenApp(i),n=this.getFilterdTemplatesForScrollingPage();return(0,x.jsxs)("div",{className:"w-100 h-100",children:[(0,x.jsx)("h5",{className:"pt-4 px-5 mb-2 hint-paper text-truncate",title:t("addPage"),children:t("addPage")}),(0,x.jsxs)(O.Tabs,{defaultValue:"fullScreenApp",fill:!0,type:"underline",css:s.css`
            height: calc(100% - 49px);
            width: 390px;
            .tab-content {
              height: calc(100% - 30px);
              .tab-pane {
                height: 100%;
                overflow-y: scroll;
              }
              .tab-pane:first-of-type {
                overflow-y: hidden;
              }
            }
            .jimu-nav {
              padding-left: ${e&&e.sys.spacing(5)};
              padding-right: ${e&&e.sys.spacing(5)};
            }
            .nav-item {
              width: 50%;
              .tab-title {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
              }
            }
          `,onChange:this.onTabSelect,children:[(0,x.jsx)(O.Tab,{id:"fullScreenApp",title:t("fullScreenApp"),className:O.FOCUSABLE_CONTAINER_CLASS,children:(0,x.jsxs)("div",{className:"d-flex flex-column h-100",children:[(0,x.jsxs)("div",{className:"d-flex align-self-end my-4 w-100",css:s.css`padding: 0 24px;`,children:[(0,x.jsxs)(O.Select,{value:i,"aria-label":t("page"),size:"sm",onChange:this.onFullScreenTypeChange,children:[(0,x.jsx)("option",{value:"all",children:t("all")}),(0,x.jsx)("option",{value:"fixed",children:t("fixed")}),(0,x.jsx)("option",{value:"grid",children:t("grid")})]}),(0,x.jsx)("div",{className:"ml-2",children:(0,x.jsx)(O.Badge,{dot:!0,color:"primary",hideBadge:0===this.state.capabilitiesSelectedForFullScreenApp.length,children:(0,x.jsx)(O.AdvancedSelect,{icon:!0,size:"sm",arrow:!1,title:this.props.formatMessage("capabilities"),"aria-label":this.props.formatMessage("capabilities"),isMultiple:!0,isEmptyOptionHidden:!0,customDropdownButtonContent:()=>(0,x.jsx)(Di,{}),selectedValues:this.state.capabilitiesSelectedForFullScreenApp,staticValues:this.state.capabilitiesForFullScreenApp,onChange:e=>{this.setState({capabilitiesSelectedForFullScreenApp:e||[]})}})})})]}),(0,x.jsx)(Pi,{className:(0,s.classNames)({[O.FOCUSABLE_CONTAINER_CLASS]:"fullScreenApp"===this.props.tabId}),templates:o,onItemSelect:this.props.onItemSelect,formatMessage:this.props.formatMessage,css:s.css`
                  height: calc(100% - 64px);
                  overflow: auto;
                  padding-top: 0;
                `})]})}),(0,x.jsxs)(O.Tab,{id:"scrollingPage",title:t("scrollingPage"),className:O.FOCUSABLE_CONTAINER_CLASS,children:[(0,x.jsx)("div",{className:"d-flex justify-content-end my-4",css:s.css`padding: 0 24px;`,children:(0,x.jsx)(O.Badge,{dot:!0,color:"primary",hideBadge:0===this.state.capabilitiesSelectedForScrollingPage.length,children:(0,x.jsx)(O.AdvancedSelect,{icon:!0,size:"sm",arrow:!1,className:"",css:s.css`width: fit-content;`,title:this.props.formatMessage("capabilities"),"aria-label":this.props.formatMessage("capabilities"),isMultiple:!0,isEmptyOptionHidden:!0,customDropdownButtonContent:()=>(0,x.jsx)(Di,{}),selectedValues:this.state.capabilitiesSelectedForScrollingPage,staticValues:this.state.capabilitiesForScrollingPage,onChange:e=>{this.setState({capabilitiesSelectedForScrollingPage:e||[]})}})})}),(0,x.jsx)(Pi,{className:(0,s.classNames)({[O.FOCUSABLE_CONTAINER_CLASS]:"scrollingPage"===this.props.tabId}),templates:n,onItemSelect:this.props.onItemSelect,formatMessage:this.props.formatMessage,css:s.css`
                height: calc(100% - 64px);
                padding-top: 0;
              `})]})]})]})}}const Ri={rootBoundary:"viewport",padding:{bottom:20}};class Ei extends s.React.PureComponent{constructor(e){super(e),this.togglePopper=()=>{this.state.open&&this.props.onClose&&this.props.onClose(),this.state.open&&(0,s.focusElementInKeyboardMode)(this.props.referenceElement),this.setState({open:!this.state.open})},this.tabSelect=e=>{this.setState({tabId:e})},this.onItemSelect=e=>{this.props.onClose(),this.props.onItemSelect(e)},this.state={open:!0,tabId:"fullScreenApp"}}render(){const{referenceElement:e,theme:t}=this.props;return(0,x.jsx)(Ut,{placement:"bottom",theme:this.props.theme,reference:e,offsetOptions:10,open:!0,toggle:this.togglePopper,arrowOptions:!0,shiftOptions:Ri,forceLatestFocusElements:!0,children:(0,x.jsx)("div",{css:s.css`
            width: 390px;
            max-height: 640px;
            height: calc(100vh - 150px);
            overflow: hidden;
          `,children:(0,x.jsx)(Ai,{theme:t,tabId:this.state.tabId,onTabSelect:this.tabSelect,formatMessage:this.props.formatMessage,onItemSelect:this.onItemSelect})})})}}class Fi extends s.React.PureComponent{constructor(e){super(e),this.onTypeChange=e=>{this.setState({type:e.target.value})},this.getCapabilities=()=>{const e=(0,wi.getTemplateCapabilitiesOnlyInCurrentLocale)(wi.TemplateType.Window);return Array.from(new Set(e)).sort().map(e=>({value:e,label:e}))},this.getFilterdTemplates=e=>{let t=[];t="fixedModalWindow"===e?(0,wi.getFixedModalWindowTemplates)():"fixedNonModalWindow"===e?(0,wi.getFixedNonModalWindowTemplates)():"anchoredWindow"===e?(0,wi.getAnchoredWindowTemplates)():(0,wi.getWindowTemplates)();const i=this.state.capabilitiesSelected.map(e=>e.label);return(0,wi.getTemplatesByCapabilityTags)(t,i)},this.state={type:"all",capabilities:this.getCapabilities(),capabilitiesSelected:[]}}render(){const{formatMessage:e,onItemSelect:t}=this.props,{type:i}=this.state,o=this.getFilterdTemplates(i);return(0,x.jsxs)("div",{className:"w-100 h-100",children:[(0,x.jsx)("h5",{className:"pt-4 px-5 mb-2 hint-paper text-truncate",title:e("addDialog"),children:e("addDialog")}),(0,x.jsxs)("div",{className:"d-flex flex-column h-100",children:[(0,x.jsxs)("div",{className:"d-flex align-self-end my-4 w-100",css:s.css`padding: 0 24px;`,children:[(0,x.jsxs)(O.Select,{value:this.state.type,"aria-label":e("addDialog"),size:"sm",onChange:this.onTypeChange,children:[(0,x.jsx)("option",{value:"all",children:e("all")}),(0,x.jsx)("option",{value:"fixedModalWindow",children:e("fixedModalWindow")}),(0,x.jsx)("option",{value:"fixedNonModalWindow",children:e("fixedNonModalWindow")}),(0,x.jsx)("option",{value:"anchoredWindow",children:e("anchoredWindow")})]}),(0,x.jsx)("div",{className:"ml-2",children:(0,x.jsx)(O.Badge,{dot:!0,color:"primary",hideBadge:0===this.state.capabilitiesSelected.length,children:(0,x.jsx)(O.AdvancedSelect,{icon:!0,size:"sm",arrow:!1,title:e("capabilities"),"aria-label":e("capabilities"),isMultiple:!0,isEmptyOptionHidden:!0,customDropdownButtonContent:()=>(0,x.jsx)(Di,{}),selectedValues:this.state.capabilitiesSelected,staticValues:this.state.capabilities,onChange:e=>{this.setState({capabilitiesSelected:e||[]})}})})})]}),(0,x.jsx)(Pi,{templates:o,onItemSelect:t,formatMessage:e,css:s.css`
              height: calc(100% - 110px);
              overflow: auto;
              padding-top: 0;
              .block-item .block-item--icon {
                outline-offset: -2px;
              }
            `})]})]})}}const Bi={rootBoundary:"viewport",padding:{bottom:20}};class Ui extends s.React.PureComponent{constructor(e){super(e),this.togglePopper=()=>{this.state.open&&this.props.onClose&&this.props.onClose(),this.state.open&&(0,s.focusElementInKeyboardMode)(this.props.referenceElement),this.setState({open:!this.state.open})},this.onItemSelect=e=>{this.props.onClose(),this.props.onItemSelect(e)},this.state={open:!0}}render(){const{referenceElement:e,theme:t}=this.props;return(0,x.jsx)(Ut,{placement:"bottom",theme:t,reference:e,offsetOptions:10,open:!0,toggle:this.togglePopper,arrowOptions:!0,shiftOptions:Bi,forceLatestFocusElements:!0,children:(0,x.jsx)("div",{css:s.css`
            width: 390px;
            max-height: 640px;
            height: calc(100vh - 150px);
            overflow: hidden;
          `,children:(0,x.jsx)(Fi,{formatMessage:this.props.formatMessage,onItemSelect:this.onItemSelect})})})}}const zi={rootBoundary:"viewport",crossAxis:!0,padding:{bottom:20}},$i={boundary:document.body,fallbackPlacements:["right","left"]};function Vi(e){const{title:t,templates:i,templateContentStyle:o,referenceElement:n,onItemSelect:a,onClose:r}=e,l=s.React.useMemo(()=>e.theme?e.theme:window.jimuConfig.isInBuilder?(0,m.getTheme2)():(0,m.getTheme)(),[e.theme]),c=s.React.useMemo(()=>s.css`
    min-width: 300px;
    width: auto;
    border: 1px solid ${l?l.ref.palette.neutral[600]:"var(--ref-palette-neutral-600)"};
    box-shadow: 0 4px 20px 4px rgba(0,0,0,0.50);

    .template-content {
      max-height: 600px;
      height: ${t?"calc(100% - 50px)":"100%"};
      overflow: auto;
    }

    .size-mode-SMALL & .template-content {
      width: 320px;
    }
  `,[l,t]),d=s.React.useCallback(()=>{null==r||r(),"function"==typeof(null==n?void 0:n.focus)&&s.lodash.defer(()=>{(0,s.focusElementInKeyboardMode)(n)})},[r,n]),p=s.React.useCallback(e=>{d(),a(e)},[d,a]);return(0,x.jsxs)(Ut,{placement:"bottom",theme:l,css:c,reference:n,offsetOptions:10,toggle:d,open:!0,arrowOptions:!0,shiftOptions:zi,flipOptions:$i,children:[t&&(0,x.jsx)("h5",{className:"hint-paper text-truncate title px-5 pt-4 mb-0",children:t}),(0,x.jsx)("div",{className:"template-content",style:o,children:(0,x.jsx)(Pi,{templates:i,onItemSelect:p})})]})}var Wi=v(12046),Gi=v.n(Wi),Hi=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const _i=e=>{const t=window.SVG,{className:i}=e,o=Hi(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Gi()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Ji=v(23662),Ki=v.n(Ji),qi=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Xi=e=>{const t=window.SVG,{className:i}=e,o=qi(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Ki()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var Yi=v(54578),Qi=v.n(Yi),Zi=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const es=e=>{const t=window.SVG,{className:i}=e,o=Zi(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Qi()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var ts=v(14962),is=v.n(ts),ss=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const os=e=>{const t=window.SVG,{className:i}=e,o=ss(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:is()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var ns=v(32881),as=v.n(ns),rs=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ls=e=>{const t=window.SVG,{className:i}=e,o=rs(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:as()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};class cs extends s.React.PureComponent{constructor(e){super(e),this.preValue=null,this.initRuleOptionName=(e,t)=>{var i,o;const n=(null==e?void 0:e.map(e=>null==e?void 0:e.ruleOptionName))||[],a=(null==t?void 0:t.map(e=>null==e?void 0:e.ruleOptionName))||[];let r=!1;(null==e?void 0:e.length)===(null==t?void 0:t.length)&&n.join("")===a.join("")||(r=!0,this.initEditOptionNameStatus(e)),(r||!(null===(o=null===(i=this.state)||void 0===i?void 0:i.ruleOptionName)||void 0===o?void 0:o.length)&&(null==n?void 0:n.length)>0)&&this.setState({ruleOptionName:(0,s.Immutable)(n)})},this.initEditOptionNameStatus=e=>{const t=e.map(e=>!1);this.setState({editOptionNameStatus:t})},this.initData=()=>{if(Array.isArray(this.props.value)&&this.props.value.length)return!1;const e=this.deepClone(this.state.option);e.ruleOptionName=this.props.intl.formatMessage({id:"option",defaultMessage:O.defaultMessages.option})+0;const t=[e];this.props.onChange(t)},this.onOptionChange=(e,t,i,s)=>{let o=this.deepClone(this.props.value);o[t].rule[e][i]=s,o=this.getNewSortDataWithNewOptionName(o,t),this.props.onChange(o,t)},this.onOptionKeyUp=(e,t,i,s,o)=>{"Enter"!==e.key&&" "!==e.key||this.onOptionChange(t,i,s,o)},this.onSelectChange=(e,t,i)=>{const s=e[0];if(!s)return;let o=this.deepClone(this.props.value);const n=s.name;o[i].rule[t].jimuFieldName=n,o=this.getNewSortDataWithNewOptionName(o,i),this.props.onChange(o,i)},this.getNewSortDataWithNewOptionName=(e,t)=>{const i=this.getNewOptionName(null==e?void 0:e[t]);return i&&(e[t].ruleOptionName=i),e},this.getNewOptionName=e=>{const t=this.getOptionNameWithRule(null==e?void 0:e.rule);if(null==e?void 0:e.autoUpdateOptionName)return t},this.getOptionNameWithRule=e=>e.map(e=>{var t;const i=e.order===s.OrderRule.Asc?"ASC":"DESC";return`${null===(t=e.jimuFieldName)||void 0===t?void 0:t.toLocaleUpperCase()}_${i}`})[0],this.addOption=()=>{const e=Array.isArray(this.props.value),t=e?this.props.value.length:0,i=this.createOptionText(t),s=this.deepClone(this.state.option);s.ruleOptionName=i;const o=e?this.deepClone(this.props.value):[];o.push(s),this.props.onChange(o)},this.createOptionText=e=>{const t=this.props.intl.formatMessage({id:"option",defaultMessage:O.defaultMessages.option})+e;if(!this.isOptionNameRepeat(t))return t;const i=e+1;return this.createOptionText(i)},this.deleteOption=(e,t)=>{if(t&&"Enter"!==t.key&&" "!==t.key)return!1;const i=this.deepClone(this.props.value);i.splice(e,1),this.props.onChange(i)},this.deleteAll=()=>{this.props.onChange([])},this.toggleOptionNameDisplay=(e,t=!1,i)=>{const{editOptionNameStatus:o}=this.state;if(i&&"Enter"!==i.key&&" "!==i.key)return!1;const n=(null==o?void 0:o.asMutable({deep:!0}))||[];n[e]=t,this.setState({editOptionNameStatus:(0,s.Immutable)(n)},()=>{var e;null===(e=this.inputRef)||void 0===e||e.select()})},this.handleOptionNameChange=(e,t)=>{if(!t)return;const i=this.deepClone(this.props.value),s=t;!this.isOptionNameRepeat(s)&&s&&(i[e].ruleOptionName=s,i[e].autoUpdateOptionName=!1),this.props.onChange(i)},this.isOptionNameRepeat=e=>{if(!Array.isArray(this.props.value))return!1;let t=!1;return this.props.value.forEach(i=>{i.ruleOptionName===e&&(t=!0)}),t},this.deepClone=e=>{const t=Array.isArray(e)?[]:{};for(const i in e){const s=("object"==typeof e[i]||"function"==typeof e[i])&&null!==e[i];t[i]=s?this.deepClone(e[i]):e[i]}return t},this.setInputRef=e=>{e&&(this.inputRef=e,(0,s.focusElementInKeyboardMode)(e,!0))},this.createRuleOptionElement=(e,t,i,o)=>{const n=t.jimuFieldName?(0,s.Immutable)([t.jimuFieldName]):(0,s.Immutable)([]);return(0,x.jsxs)("div",{className:"select-down-con",children:[this.props.useDataSource&&(0,x.jsx)("div",{className:"sort-field-selector",children:(0,x.jsx)(lt.FieldSelector,{useDataSources:e,onChange:(e,t)=>{this.onSelectChange(e,i,o)},selectedFields:n,isDataSourceDropDownHidden:!0,useDropdown:!0,useKeyUpEvent:!0})}),[{getTitle:()=>this.nls("ascending"),order:s.OrderRule.Asc},{getTitle:()=>this.nls("descending"),order:s.OrderRule.Desc}].map((e,n,a)=>(0,x.jsxs)(O.Button,{title:e.getTitle(),size:"sm",type:t.order===e.order?"primary":"secondary",className:"sort-button "+(this.props.singleRowItemOnly&&t.order!==e.order?"collapse":""),onClick:()=>{this.onOptionChange(i,o,"order",this.props.singleRowItemOnly?[...a,a[0]][n+1].order:e.order)},onKeyUp:t=>{this.onOptionKeyUp(t,i,o,"order",this.props.singleRowItemOnly?[...a,a[0]][n+1].order:e.order)},children:[e.order===s.OrderRule.Asc&&(0,x.jsx)(os,{size:"12",className:"sort-arrow-down-icon"}),e.order===s.OrderRule.Desc&&(0,x.jsx)(es,{size:"12",className:"sort-arrow-down-icon"})]},n))]},t.jimuFieldName||i)},this.onRuleOptionNameChange=(e,t)=>{var i;const o=e.target.value,n=(null===(i=this.state.ruleOptionName)||void 0===i?void 0:i.asMutable({deep:!0}))||[];n[t]=o,this.setState({ruleOptionName:(0,s.Immutable)(n)})},this.createOptionNameElement=(e,t)=>{var i;const{editOptionNameStatus:s}=this.state,o=e.ruleOptionName,n=null===(i=this.state.ruleOptionName)||void 0===i?void 0:i[t],a=this.props.intl.formatMessage({id:"optionNamePlaceholder",defaultMessage:O.defaultMessages.optionNamePlaceholder}),r=(0,x.jsx)(O.TextInput,{className:"flex-grow-1 h-100 edit-input",size:"sm",type:"text",defaultValue:o,onChange:e=>{this.onRuleOptionNameChange(e,t)},onAcceptValue:e=>{this.handleOptionNameChange(t,e)},onBlur:()=>{this.toggleOptionNameDisplay(t,!1)},ref:e=>{this.setInputRef(e)},placeholder:a,title:n||a,"aria-label":n||a});return(0,x.jsxs)("div",{className:"option-name d-flex align-items-center flex-grow-1","aria-label":o,children:[s[t]?r:(0,x.jsx)("span",{id:"optionNameCon",title:o,onDoubleClick:()=>{this.toggleOptionNameDisplay(t,!0)},children:o}),(0,x.jsx)(O.Button,{size:"sm",type:"tertiary",icon:!0,className:"padding-0 option-name-icon-con",title:this.nls("edit"),"aria-describedby":"optionNameCon",onClick:()=>{this.toggleOptionNameDisplay(t,!s[t])},onKeyDown:e=>{this.toggleOptionNameDisplay(t,!s[t],e)},children:(0,x.jsx)(_i,{size:"s",className:"option-name-icon"})})]})},this.createOptionElement=(e,t,i)=>{let o;o=(0,x.jsx)("div",{className:"close-con text-right",children:(0,x.jsx)(O.Button,{size:"sm",icon:!0,type:"tertiary",className:"padding-0",title:this.nls("deleteOption"),onClick:()=>{this.deleteOption(i)},onKeyUp:e=>{this.deleteOption(i,e)},children:(0,x.jsx)(Wt,{size:this.props.singleRowItemOnly?14:12,className:"sort-arrow-down-icon"})})});const n=()=>t.rule.map((t,s)=>this.createRuleOptionElement(e,t,s,i));return(0,x.jsx)("div",{className:"select-con flex-grow-1",role:"group","aria-label":t.ruleOptionName,children:this.props.singleRowItemOnly&&(0,x.jsx)(s.React.Fragment,{children:(0,x.jsxs)("div",{className:"option-name-con",children:[(0,x.jsx)(ls,{size:14}),n(),o]})})||(0,x.jsxs)(s.React.Fragment,{children:[(0,x.jsxs)("div",{className:"option-name-con d-flex align-items-center",children:[(()=>this.createOptionNameElement(t,i))(),o]}),n()]})},i)},this.nls=e=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:O.defaultMessages[e]}):e,this.onDataSourceCreated=e=>null,this.state={option:{ruleOptionName:"",autoUpdateOptionName:!0,isEditOptionName:!1,rule:[{jimuFieldName:"",order:s.OrderRule.Asc}]},ruleOptionName:null,editOptionNameStatus:(0,s.Immutable)([])}}componentDidMount(){this.initData()}componentDidUpdate(e,t){var i,s,o,n;this.preValue=null==e?void 0:e.value,this.initRuleOptionName(null===(i=this.props)||void 0===i?void 0:i.value,null==e?void 0:e.value),(null===(s=null==e?void 0:e.useDataSource)||void 0===s?void 0:s.dataSourceId)!==(null===(n=null===(o=this.props)||void 0===o?void 0:o.useDataSource)||void 0===n?void 0:n.dataSourceId)&&Promise.resolve(!0).then(()=>{this.initData()})}render(){const{value:e}=this.props,t=this.props.intl.formatMessage({id:"invalidExpression",defaultMessage:O.defaultMessages.invalidExpression});return(0,x.jsx)("div",{className:(0,s.classNames)("sort-con",this.props.singleRowItemOnly&&"single-row-item",{[this.props.className]:!!this.props.className}),children:(0,x.jsxs)("div",{children:[(0,x.jsxs)(O.Button,{type:"tertiary",className:"add-option-btn",onClick:this.addOption,children:[(0,x.jsx)(Xi,{size:"s",className:"add-option-icon"}),(0,x.jsx)("span",{children:this.props.intl.formatMessage({id:"addOption",defaultMessage:O.defaultMessages.addOption})})]}),(0,x.jsx)(s.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,children:i=>Array.isArray(e)?(0,x.jsx)(H.List,{size:"sm",className:"setting-ui-unit-list",itemsJson:e.asMutable({deep:!0}).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,s]=i,o=s.map(e=>e.itemStateDetailContent);e.updateType===H.TreeItemActionType.HandleDidDrop&&this.props.onChange(o)},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{var i;const{itemJsons:o}=t.props,n=o[0],a=o[1];return this.createOptionElement((0,s.Immutable)([null===(i=this.props.useDataSource)||void 0===i?void 0:i.asMutable({deep:!0})]),n.itemStateDetailContent,a.indexOf(n))}}):t}),Array.isArray(e)&&0===e.length&&(0,x.jsxs)("div",{className:"no-sort-remind",children:[(0,x.jsx)("div",{children:this.props.intl.formatMessage({id:"noOptionRemindText",defaultMessage:O.defaultMessages.noOptionRemindText})}),(0,x.jsx)("div",{children:this.props.intl.formatMessage({id:"pleaseAddOne",defaultMessage:O.defaultMessages.pleaseAddOne})})]})]})})}}const ds=(0,m.withStyles)((0,s.injectIntl)(cs),"SortSetting");var ps=v(16435),us=v.n(ps),hs=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ms=e=>{const t=window.SVG,{className:i}=e,o=hs(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:us()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var gs=v(57993),vs=v.n(gs),fs=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ys=e=>{const t=window.SVG,{className:i}=e,o=fs(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:vs()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))};var bs=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Ss=e=>{const t=s.hooks.useTranslation(O.defaultMessages),{vertical:i=!1,onChange:o,autoFlip:n=!0,className:a,size:r="sm"}=e,l=bs(e,["vertical","onChange","autoFlip","className","size"]);return(0,x.jsxs)(O.AdvancedButtonGroup,Object.assign({size:r,className:(0,s.classNames)("setting--direction-selector",a)},l,{children:[(0,x.jsx)(O.Button,{size:r,title:t("horizontal"),"aria-label":t("horizontal"),type:"default",icon:!0,active:!i,onClick:()=>{o(!1)},children:(0,x.jsx)(ms,{autoFlip:n})}),(0,x.jsx)(O.Button,{size:r,title:t("vertical"),"aria-label":t("vertical"),type:"default",icon:!0,active:i,onClick:()=>{o(!0)},children:(0,x.jsx)(ys,{})})]}))};var xs;!function(e){e.Auto="AUTO",e.Custom="CUSTOM"}(xs||(xs={}));class ws extends s.React.PureComponent{constructor(e){super(e),this.toggleDropdown=()=>{this.setState(e=>({dropdownOpen:!e.dropdownOpen}))},this.state={dropdownOpen:!1},this._onAutoSelected=this.onSelect.bind(this,xs.Auto),this._onCustomSelected=this.onSelect.bind(this,xs.Custom)}onSelect(e){this.props.mode!==e&&this.props.onChange(e)}getStyle(){return s.css`
      .auto-dropdown.jimu-dropdown {
        width: 26px;
        height: 26px;

        .btn {
          padding: 0 !important;
        }
      }

      & > .jimu-dropdown .jimu-dropdown-button,
      & > .jimu-dropdown .jimu-dropdown-button:hover {
        height: 26px;
        padding: 0 0.375rem;
      }
    `}autoInput(){return(0,x.jsx)(O.Input,{style:{width:"110px"},css:s.css`
          background-color: var(--ref-palette-neutral-600);
          border-color: var(--ref-palette-neutral-600);
          color: var(--ref-palette-black);
          height: 1.625rem;
          border-width: 0;
          padding: 0 0.25rem;
        `,disabled:!0,value:this.props.intl.formatMessage({id:"auto"})})}render(){const{mode:e,intl:t}=this.props,i=t.formatMessage({id:"auto"}),o=t.formatMessage({id:"custom"});return(0,x.jsxs)("div",{className:"d-flex",css:this.getStyle(),children:[(0,x.jsxs)(O.Dropdown,{className:"auto-dropdown",isOpen:this.state.dropdownOpen,toggle:this.toggleDropdown,children:[(0,x.jsx)(O.DropdownButton,{icon:!0}),(0,x.jsxs)(O.DropdownMenu,{children:[(0,x.jsxs)(O.DropdownItem,{onClick:this._onAutoSelected,children:[(0,x.jsx)("span",{css:s.css`width: 1rem;`,children:e===xs.Auto&&(0,x.jsx)(kt,{size:"s"})}),i]}),(0,x.jsxs)(O.DropdownItem,{onClick:this._onCustomSelected,children:[(0,x.jsx)("span",{css:s.css`width: 1rem;`,children:e===xs.Custom&&(0,x.jsx)(kt,{size:"s"})}),o]})]})]}),e===xs.Auto&&this.autoInput(),e===xs.Custom&&this.props.children]})}}const Cs=(0,s.injectIntl)(ws);var js=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Is={crossAxis:!0},ks={fallbackPlacements:["bottom-end","top-end"]},Os=(0,m.styled)(O.FloatingPanel)(()=>{const e=(0,m.getTheme2)(),t=null==e?void 0:e.ref.palette.neutral[1e3],i=null==e?void 0:e.ref.palette.neutral[1100];return`\n    background-color: ${null==e?void 0:e.ref.palette.neutral[400]};\n    color: ${t};\n    border: 1px solid ${null==e?void 0:e.ref.palette.neutral[600]};\n    > .popper-box {\n      > .panel-header {\n        color: ${t};\n        .action-btn {\n          color: ${t};\n          &:hover {\n            color: ${i};\n          }\n        }\n      }\n    }\n  `}),Ts=s.React.forwardRef((e,t)=>{const{className:i,placement:o="right-start",onInitResizeHandler:n,onInitDragHandler:a,version:r}=e,l=js(e,["className","placement","onInitResizeHandler","onInitDragHandler","version"]),c=s.React.useRef(null),d=s.hooks.useForkRef(t,c),[p,u]=s.hooks.useControlled({controlled:r,default:0});return s.React.useEffect(()=>{null==n||n(()=>{var e;null===(e=c.current)||void 0===e||e.classList.add("d-none")},null,()=>{var e;u(e=>e+1),null===(e=c.current)||void 0===e||e.classList.remove("d-none")})},[n,u]),s.React.useEffect(()=>{null==a||a(()=>{var e;null===(e=c.current)||void 0===e||e.classList.add("d-none")},null,()=>{var e;u(e=>e+1),null===(e=c.current)||void 0===e||e.classList.remove("d-none")})},[a,u]),(0,x.jsx)(Os,Object.assign({className:(0,s.classNames)("shadow-2",i),shiftOptions:Is,flipOptions:ks,placement:o,ref:d,version:p},l))});var Ps=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Ns=e=>{const{onClose:t,open:i,reference:o,children:n,floating:a}=e,r=Ps(e,["onClose","open","reference","children","floating"]),l=s.hooks.useTranslation(O.defaultMessages)("quickStyle");return(0,x.jsxs)(x.Fragment,{children:[a&&(0,x.jsx)(Ts,Object.assign({},r,{headerTitle:a?l:"",onHeaderClose:t,children:n})),!a&&(0,x.jsxs)(O.Popper,Object.assign({open:i,reference:o},r,{children:[(0,x.jsx)(O.PanelHeader,{className:"px-4 py-2",title:l,onClose:t}),n]}))]})},Ms=6,Ls=1e3,Ds=6,As="default_geocode",Rs=3e5;var Es,Fs;!function(e){e.Both="Both",e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(Es||(Es={})),function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(Fs||(Fs={}));const Bs="FieldName",Us="FieldValue",zs=99,$s=1e3,Vs=20,Ws="__",Gs="objectid",Hs="address",_s="default_address",Js="Default Address",Ks="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",qs="ArcGIS World Geocoding Service";var Xs=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Ys=[{name:"printTask",type:s.SupportedUtilityType.Printing},{name:"geometry",type:s.SupportedUtilityType.Geometry},{name:"geoenrichment",type:s.SupportedUtilityType.GeoEnrichment},{name:"route",type:s.SupportedUtilityType.Routing},{name:"geocode",dynamic:!0,type:s.SupportedUtilityType.GeoCoding}];function Qs(e,t){if(/rest\/services\/.*\/GeocodeServer/.test(t.url)){const{url:e}=t;return Xs(t,["url"])}return"printTask"===e?{templates:t.templates}:null}function Zs(e,t,i,s){const{url:o,label:n}=e,a=null===t||t.includes(e.type),r=!i||n.toLowerCase().includes(i.toLowerCase()),l=!s||s.test(o);return a&&r&&l}var eo,to=function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((s=s.apply(e,t||[])).next())})};!function(e){e.Pass="Pass",e.NotHttps="Not_Https",e.InvalidURL="Invalid_URL"}(eo||(eo={}));const io=e=>{if(!e)return"geocoder";const t=e.split("/");return t[t.length-2]||"geocoder"},so=e=>!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e);function oo(e){return to(this,void 0,void 0,function*(){const{useUtility:t}=e,i=(null==e?void 0:e.geocodeURL)||(yield uo(t));return ho(i).then(t=>{if((null==t?void 0:t.urlCheckResultType)!==eo.Pass)return Promise.resolve({urlCheckResult:t});{const i=t.addressFields.concat(t.candidateFields),s=Object.assign(Object.assign({},e),{urlCheckResult:t,fields:i}),o=no(s);return Promise.resolve({urlCheckResult:t,dataSourceConfig:o})}})})}const no=e=>{const{urlCheckResult:t,useUtility:i,fields:s,datasourceConfig:o,configId:n,viewId:a,createOutputDs:r,id:l,dataSourceConfigItem:c,geocodeURL:d,notAddNewUtility:p}=e,{singleLineFieldName:u,spatialReference:h,isSupportSuggest:m}=t,g=ko(null==o?void 0:o.asMutable({deep:!0})),v=n||Oo(g,a);let f=o?o.asMutable({deep:!0}):[];const y=ro(i,d),b=lo(i,d),S=co(i),{addressFieldsSchema:x,defaultAddressFieldName:w}=bo(s),C={configId:v,icon:null,label:y,hint:b,useUtility:i,searchServiceType:Fs.GeocodeService,singleLineFieldName:u,isSupportSuggest:m,spatialReference:h,zoomScale:S};return p&&(C.geocodeURL=d),r&&(C.outputDataSourceId=`${l}_output_${v}`,C.addressFields=x,C.displayFields=ao(x,w),C.defaultAddressFieldName=w),(null==c?void 0:c.configId)?f=o.map(e=>(null==e?void 0:e.configId)===v?C:e):f.push(C),f},ao=(e,t)=>{let i;return null==e||e.forEach(e=>{var s;(null===(s=null==e?void 0:e.jimuName)||void 0===s?void 0:s.toLocaleLowerCase())===t&&(i=e)}),i||(i=e[0]),[i]},ro=(e,t)=>{if(null==e?void 0:e.utilityId)return s.UtilityManager.getInstance().getLabelOfUseUtility(e);if(t){const e=po(t);return null==e?void 0:e.name}},lo=(e,t)=>{var i;if(null==e?void 0:e.utilityId){const t=s.UtilityManager.getInstance().getUtilityJson(e.utilityId);return null===(i=null==t?void 0:t.orgSetting)||void 0===i?void 0:i.placeholder}if(t){const e=po(t);return null==e?void 0:e.placeholder}},co=e=>{if(!e)return null;const t=s.UtilityManager.getInstance().getUtilityJson(e.utilityId),i=null==t?void 0:t.url,o=po(i);return(null==o?void 0:o.zoomScale)||null},po=e=>{var t;const i=null===(t=(0,s.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices;return((null==i?void 0:i.geocode)||[]).filter(t=>(null==t?void 0:t.url)===e)[0]},uo=e=>to(void 0,void 0,void 0,function*(){return s.UtilityManager.getInstance().getUrlOfUseUtility(e).then(e=>Promise.resolve(e),e=>Promise.reject(new Error(e)))}),ho=e=>to(void 0,void 0,void 0,function*(){const t=new RegExp("^(([h][t]{2}[p][s])?://)");if(!e||!t.test(e))return Promise.resolve({urlCheckResultType:eo.NotHttps});try{return(0,s.loadArcGISJSAPIModules)(["esri/request"]).then(t=>{const[i]=t;return i(e,{query:{f:"json"},responseType:"json"}).then(e=>{var t;const i=(null==e?void 0:e.data)||{};if(null==i?void 0:i.capabilities){const e=(null==i?void 0:i.singleLineAddressField)||{},s=(null==i?void 0:i.addressFields)||[],o=(null==i?void 0:i.spatialReference)||null,n=(null==i?void 0:i.candidateFields)||[],a=(null===(t=null==i?void 0:i.capabilities)||void 0===t?void 0:t.split(","))||[],r=null==a?void 0:a.includes("Suggest");return Promise.resolve({urlCheckResultType:eo.Pass,singleLineFieldName:null==e?void 0:e.name,addressFields:s,isSupportSuggest:r,candidateFields:n,spatialReference:o})}return Promise.resolve({urlCheckResultType:eo.InvalidURL})},e=>Promise.resolve({urlCheckResultType:eo.InvalidURL}))},e=>Promise.resolve({urlCheckResultType:eo.InvalidURL}))}catch(e){return Promise.resolve({urlCheckResultType:eo.InvalidURL})}});function mo(e){var t;return function(e,t,i,s,o){const n=[];return Ys.forEach(a=>{const r=e[a.name],l=o(a.name);if(a.dynamic){if(Array.isArray(r))n.push({id:a.name,name:a.name,label:l,type:a.type,children:r.map((e,t)=>{var i;const s=Qs(a.name,e);return{id:`${a.name}_${t}`,name:a.name,type:a.type,index:t,label:null!==(i=e.name)&&void 0!==i?i:e.id,url:e.url,setting:s}}).filter(e=>Zs(e,t,i,s))});else if(r){const e=Qs(a.name,r);n.push({id:a.name,name:a.name,label:l,type:a.type,url:r.url,setting:e})}}else if(r){const e=Qs(a.name,r);n.push({id:a.name,name:a.name,label:l,type:a.type,url:r.url,setting:e})}}),n.filter(e=>e.children?e.children.length>0:Zs(e,t,i,s))}(null===(t=(0,s.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices,s.SupportedUtilityType.GeoCoding,null,null,e)}function go(e,t){return to(this,void 0,void 0,function*(){const{utility:i,id:o,createOutputDs:n,viewId:a,notAddNewUtility:r,index:l}=e;if(!i)return Promise.resolve(null);const c=t||s.UtilityManager.getInstance().getIdOfOrgUtility(i.name,i.url,i.index,i.label),d=a?`${a}_${c||l}`:`${As}_${c||l}`,p=a?`${a}_${i.index}`:`${As}_${i.index}`;return oo({id:o,createOutputDs:n,dataSourceConfigItem:null,viewId:r?p:d,configId:null,datasourceConfig:null,useUtility:{utilityId:c},geocodeURL:i.url,notAddNewUtility:r}).then(e=>{var t,i;return(null===(t=e.urlCheckResult)||void 0===t?void 0:t.urlCheckResultType)===eo.Pass&&(null===(i=e.dataSourceConfig)||void 0===i?void 0:i.length)>0?Promise.resolve(e.dataSourceConfig[0]):Promise.resolve(null)})})}const vo={jimuName:Gs,alias:"OBJECTID",esriType:s.EsriFieldType.OID,type:s.JimuFieldType.Number,name:Gs},fo=(e="",t=[])=>{const i={};return null==t||t.forEach((e,t)=>{i[null==e?void 0:e.jimuName]=e,0===t&&(i[Gs]=vo)}),{label:e,idField:Gs,fields:i}},yo=(e,t=0)=>{let i=_s;return null==e||e.forEach(s=>{i=t?`${i}${t}`:i,s.jimuName===i&&(i=yo(e,t+=1))}),i},bo=(e=[])=>{var t;const i=null===(t=null==e?void 0:e.map(e=>s.dataSourceUtils.convertFieldToJimuField(e,e)))||void 0===t?void 0:t.filter(e=>e),o=yo(i,0),n={jimuName:o,alias:Js,type:s.JimuFieldType.String,esriType:s.EsriFieldType.String,name:o};return i.unshift(n),{addressFieldsSchema:i,defaultAddressFieldName:o}},So=(e,t,i,o)=>{const n=o||(e=>so(e)?qs:io(e))(i),a=Po(t,e),r=fo(o);return{id:a,type:s.DataSourceTypes.FeatureLayer,label:n,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:r,geometryType:"esriGeometryPoint"}},xo=e=>e?e.type===s.DataSourceTypes.SceneLayer?e.getAssociatedDataSource():e:null,wo=(e,t)=>!(!e||!t)&&t.some(t=>t.dataSourceId===e.dataSourceId),Co=(e,t)=>{var i;return(null===(i=t.filter(t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId)))||void 0===i?void 0:i.length)>0},jo=(e,t)=>{var i;if((null==e?void 0:e.length)!==(null==t?void 0:t.length))return!0;const s=[];if(null==e||e.forEach(e=>{var i;const o=t.filter(t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId));(null==o?void 0:o.length)>0&&s.push({dsFields:null==e?void 0:e.fields,preDsFields:null===(i=o[0])||void 0===i?void 0:i.fields})}),(null==s?void 0:s.length)!==(null==e?void 0:e.length))return!0;return(null===(i=null==s?void 0:s.filter(e=>{var t,i,s,o;const n=(null===(t=null==e?void 0:e.dsFields)||void 0===t?void 0:t.length)!==(null===(i=null==e?void 0:e.preDsFields)||void 0===i?void 0:i.length),a=(null===(o=null===(s=null==e?void 0:e.dsFields)||void 0===s?void 0:s.filter(t=>{var i;return!(null===(i=null==e?void 0:e.preDsFields)||void 0===i?void 0:i.includes(t))}))||void 0===o?void 0:o.length)>0;return n||a}))||void 0===i?void 0:i.length)>0},Io=(e,t,i)=>{var s,o,n;const a=(null===(s=null==e?void 0:e.useDataSources)||void 0===s?void 0:s.asMutable({deep:!0}))||[],r=(null===(o=null==e?void 0:e.outputDataSources)||void 0===o?void 0:o.asMutable({deep:!0}))||[];if((null==a?void 0:a.length)!==(null==t?void 0:t.length)||(null==r?void 0:r.length)!==(null==i?void 0:i.length))return!0;const l=jo(t,a),c=(null===(n=r.filter(e=>!(null==i?void 0:i.includes(e))))||void 0===n?void 0:n.length)>0;return l||c},ko=e=>null==e?void 0:e.map(e=>e.configId),Oo=(e,t)=>{if(!e||0===(null==e?void 0:e.length))return t?`config_${t}_0`:"config_0";const i=To(e);return t?`config_${t}_${i+1}`:`config_${i+1}`},To=e=>{var t;const i=null==e?void 0:e.map(e=>{var t;const i=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return i?Number(i):0});return null===(t=null==i?void 0:i.sort((e,t)=>t-e))||void 0===t?void 0:t[0]},Po=(e,t)=>{var i;if(!e)return`${t}_output_0`;const s=null===(i=null==e?void 0:e.split("_"))||void 0===i?void 0:i.pop();return`${t}_output_${Number(s)}`},No=e=>{var t;const{datasourceConfig:i,dsJsonOriginDs:o,useDataSource:n,configId:a,viewId:r,fieldsInMapSearchProperties:l,exactMatch:c,label:d,searchInCurrentMapExtent:p}=e,u=ko(null==i?void 0:i.asMutable({deep:!0})),h=a||Oo(u,r),m=d||(null==o?void 0:o.getLabel()),g=Do(n,l);if(u&&u.includes(h)){const e=i.filter(e=>e.configId===h)[0],o=null===(t=e.useDataSource)||void 0===t?void 0:t.dataSourceId,a=n.dataSourceId;if(o&&a&&s.dataSourceUtils.areDerivedFromSameMain(o,a)){const t=Mo((0,s.Immutable)(Object.assign(Object.assign({},e),{configId:h,useDataSource:n,label:m})));return null==t?void 0:t.asMutable({deep:!0})}}n.fields=null==g?void 0:g.map(e=>null==e?void 0:e.jimuName);return{configId:h,icon:null,label:m,displayLabel:!0,useDataSource:n,displayFields:g,searchFields:g,hint:"",searchServiceType:Fs.FeatureService,searchExact:!!c,searchInCurrentMapExtent:!!p}},Mo=e=>{var t,i,s,o;const n=(null===(i=null===(t=null==e?void 0:e.searchFields)||void 0===t?void 0:t.asMutable({deep:!0}))||void 0===i?void 0:i.map(e=>null==e?void 0:e.jimuName))||[],a=(null===(o=null===(s=null==e?void 0:e.displayFields)||void 0===s?void 0:s.asMutable({deep:!0}))||void 0===o?void 0:o.map(e=>null==e?void 0:e.jimuName))||[],r=Array.from(new Set(n.concat(a)));return e.setIn(["useDataSource","fields"],r)},Lo=e=>{const{datasourceConfig:t,datasourceConfigItem:i,configId:s}=e;let o=t?t.asMutable({deep:!0}):[];const n=No(e);return(null==i?void 0:i.configId)?o=o.map(e=>(null==e?void 0:e.configId)===s?n:e):o.push(n),{dsConfigItem:n,datasourceConfig:o}},Do=(e,t)=>{var i,o,n,a,r;const l=s.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),c=(null==l?void 0:l.getLayerDefinition)&&(null===(i=null==l?void 0:l.getLayerDefinition())||void 0===i?void 0:i.displayField);let d;(null==t?void 0:t.length)>0&&(d=t.map(e=>null==e?void 0:e.name));const p=null===(o=null==l?void 0:l.getSchema())||void 0===o?void 0:o.fields;let u;const h=[];for(const e in p)(null===(n=null==p?void 0:p[e])||void 0===n?void 0:n.type)!==s.JimuFieldType.Date&&h.push(null==p?void 0:p[e]),(null===(a=null==p?void 0:p[e])||void 0===a?void 0:a.name)===c&&(null===(r=null==p?void 0:p[e])||void 0===r?void 0:r.type)!==s.JimuFieldType.Date&&c&&(u=null==p?void 0:p[e]);let m=[];return d?m=null==h?void 0:h.filter(e=>d.includes(e.name)):(null==h?void 0:h.length)>0&&(m=(null==h?void 0:h.length)>1?[(0,s.Immutable)(h[1])]:[(0,s.Immutable)(h[0])]),d&&0===(null==m?void 0:m.length)&&(null==h?void 0:h.length)>0&&(m=(null==h?void 0:h.length)>1?[(0,s.Immutable)(h[1])]:[(0,s.Immutable)(h[0])]),d&&(null==m?void 0:m.length)>0?m:u?[(0,s.Immutable)(u)]:m},Ao=e=>s.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,s.Immutable)(e)).then(e=>{const t=xo(e);return t||Promise.reject(Error("")),t}),Ro=e=>{const t={useDataSources:[],outputDataSources:[]};return Object.keys(e||{}).forEach(i=>{var o;const n=e[i],a=Eo((0,s.Immutable)((null==n?void 0:n.dataSourceConfig)||[]),!0);null===(o=a.useDataSources)||void 0===o||o.forEach(e=>{Co(e,null==t?void 0:t.useDataSources)?t.useDataSources=zo(e,t.useDataSources):t.useDataSources.push(e)}),t.outputDataSources=t.outputDataSources.concat(a.outputDataSources)}),t},Eo=(e,t)=>{var i;return null===(i=null==e?void 0:e.asMutable({deep:!0}))||void 0===i?void 0:i.reduce((e,i)=>{const s=null==i?void 0:i.useDataSource;if(s&&(Co(s,null==e?void 0:e.useDataSources)?e.useDataSources=zo(s,null==e?void 0:e.useDataSources):null==e||e.useDataSources.push(s)),t){const t=Bo(i);t&&e.outputDataSources.push(t)}return e},{useDataSources:[],outputDataSources:[]})},Fo=(e,t,i)=>{var o,n,a,r;const l=(0,s.getAppStore)().getState(),c=null===(a=null===(n=null===(o=null==l?void 0:l.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.widgets)||void 0===a?void 0:a[t],d={id:t};return d.useDataSources=null==e?void 0:e.useDataSources,i&&(d.outputDataSources=null===(r=null==e?void 0:e.outputDataSources)||void 0===r?void 0:r.map(e=>null==e?void 0:e.id)),{dsInWidgetJson:d,isWidgetJsonDsChanged:Io(c,d.useDataSources,d.outputDataSources)}},Bo=(e,t=!0)=>{let i;return(null==e?void 0:e.searchServiceType)===Fs.GeocodeService&&(i={id:null==e?void 0:e.outputDataSourceId,type:s.DataSourceTypes.FeatureLayer,label:null==e?void 0:e.label,originDataSources:[],isOutputFromWidget:t,isDataInDataSourceInstance:!1,schema:fo(null==e?void 0:e.label,null==e?void 0:e.addressFields),geometryType:"esriGeometryPoint"}),i};function Uo(e){const t=s.DataSourceManager.getInstance().getDataSource(e);return t&&t.supportSpatialInfo&&!t.supportSpatialInfo()}const zo=(e,t)=>t.map(t=>{if((null==e?void 0:e.dataSourceId)===(null==t?void 0:t.dataSourceId)){const i=(null==e?void 0:e.fields)||[],s=(null==t?void 0:t.fields)||[],o=Array.from(new Set(s.concat(i)));t.fields=o}return t});var $o=v(71371),Vo=function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((s=s.apply(e,t||[])).next())})};function Wo(e){return Vo(this,void 0,void 0,function*(){var t,i;const{nls:s,isSingle:o,createOutputDs:n,id:a,viewId:r,notAddNewUtility:l}=e,c=(null===(i=null===(t=mo(s))||void 0===t?void 0:t[0])||void 0===i?void 0:i.children)||[];if(o){const e={utility:c[0],id:a,createOutputDs:n,viewId:r,notAddNewUtility:l,index:0},t=yield Go(e);return Promise.resolve(t?[t]:[])}{const e=null==c?void 0:c.map((e,t)=>Go({utility:e,id:a,createOutputDs:n,viewId:As,notAddNewUtility:l,index:t})),t=yield Promise.all(e),i=null==t?void 0:t.filter(e=>!!e);return Promise.resolve(i)}})}function Go(e){return Vo(this,void 0,void 0,function*(){const{utility:t,notAddNewUtility:i}=e;if(!t)return Promise.resolve(null);let o=s.UtilityManager.getInstance().getIdOfOrgUtility(t.name,t.url,t.index,t.label);return o||i||(o=(0,$o.addNewUtility)(t)),go(e,o)})}var Ho=v(35809);const _o=e=>{const t={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:H.TreeItemActionType.RenderOverrideItemTitle},{name:H.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},i=s.css`
    &{
      max-height: 256px;
      overflow-y: auto;
    }
  `,o=(0,m.useTheme)(),{disPlayField:n,useDataSource:a,onFieldChange:r}=e;return(0,x.jsxs)("div",{className:"w-100",children:[(0,x.jsx)(lt.FieldSelector,{useDataSources:a?(0,s.Immutable)([a]):(0,s.Immutable)([]),onChange:e=>{r(e,n,!0)},selectedFields:(0,s.Immutable)(null==n?void 0:n.map(e=>null==e?void 0:e.name)),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,types:(0,s.Immutable)([s.JimuFieldType.Number,s.JimuFieldType.String])}),(0,x.jsx)("div",{css:i,children:(0,x.jsx)(H.List,Object.assign({size:"sm",className:"mt-2",autoHandleFocus:!1,itemsJson:Array.from(n).map((e,t)=>({itemStateDetailContent:e,itemKey:`${null==e?void 0:e.name}${t}`,itemStateIcon:lt.dataComponentsUtils.getIconFromFieldType(e.type,o),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,s]=i,o=s.map(e=>e.itemStateDetailContent);r(o,n,!0)}},t))})]})},{useEffect:Jo,useRef:Ko}=s.React,qo=(0,s.Immutable)([s.AllDataSourceTypes.FeatureLayer,s.AllDataSourceTypes.SceneLayer,s.AllDataSourceTypes.BuildingComponentSubLayer,s.AllDataSourceTypes.OrientedImageryLayer,s.AllDataSourceTypes.ImageryLayer,s.AllDataSourceTypes.SubtypeGroupLayer,s.AllDataSourceTypes.SubtypeSublayer]),Xo=e=>{var t;const i=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages),o=Ko(null),{trigger:n,isOpen:a,id:r,datasourceConfig:l,dsConfigItemIndex:c,popperFocusNode:d,viewId:p,propsForDataSourceSelector:u,showSearchInCurrentMapExtentSetting:h,hideDisplayFieldSetting:m,toggle:g,updateConfigForLayerOptions:v,onSettingChange:f,dsStatusChange:y,hideIconSetting:b,supportedDsTypes:S,hideDs:w}=e,C=(null==l?void 0:l[c])||(0,s.Immutable)({}),{configId:I,label:T,icon:P,searchFields:N,searchExact:M,displayFields:L,hint:D,useDataSource:A,searchInCurrentMapExtent:R}=C,[E,F]=s.React.useState(null),[B,U]=s.React.useState(T);Jo(()=>{I&&U(T)},[I]),Jo(()=>{I&&T!==B&&U(T)},[C]),Jo(()=>{a&&(clearTimeout(o.current),o.current=setTimeout(()=>{const e=document.querySelector(".search-ds-setting-popper .action-close");(0,s.focusElementInKeyboardMode)(e)},200))},[a]);const z=()=>{const e=ko(null==l?void 0:l.asMutable({deep:!0})),t=I||Oo(e,p);let i=l?l.asMutable({deep:!0}):[];const o={configId:t,icon:null,label:"......",displayLabel:!0,useDataSource:null,displayFields:[],searchFields:[],hint:"",searchServiceType:Fs.FeatureService};i=i.map(e=>(null==e?void 0:e.configId)===t?o:e),v((0,s.Immutable)(i))},$=(e,t,i=!1)=>{var o,n;if(!e)return;const a=i?"displayFields":"searchFields";let r=V(e);0===(null==r?void 0:r.length)&&(r=null===(n=null===(o=(0,s.Immutable)(t))||void 0===o?void 0:o.asMutable({deep:!0}))||void 0===n?void 0:n.splice(0,1));const d=null==l?void 0:l.asMutable({deep:!0});let p=null==C?void 0:C.setIn([a],r);p=Mo(p),null==d||d.splice(c,1,null==p?void 0:p.asMutable({deep:!0})),v((0,s.Immutable)(d))},V=e=>null==e?void 0:e.filter(e=>(null==e?void 0:e.type)!==(null===s.JimuFieldType||void 0===s.JimuFieldType?void 0:s.JimuFieldType.Date)),W=(e,t)=>{const i=null==l?void 0:l.asMutable({deep:!0}),o=null==C?void 0:C.setIn(e,t);null==i||i.splice(c,1,null==o?void 0:o.asMutable({deep:!0})),f((0,s.Immutable)(i),null,p)},G=e=>{W(["searchExact"],!M)},H=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;U(i)},_=e=>{e?(U(null==e?void 0:e.trim()),W(["label"],null==e?void 0:e.trim())):U(T)},J=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;W(["hint"],i)},K=e=>{W(["searchInCurrentMapExtent"],!R)},q=()=>{if(!(null==C?void 0:C.useDataSource)||!h)return!1;return!Uo(C.useDataSource.dataSourceId)},X=(null==C?void 0:C.useDataSource)?[null===(t=null==C?void 0:C.useDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]:[];return(0,x.jsx)(Ye,{className:"search-ds-setting-popper",isOpen:a,position:"right",toggle:g,trigger:n,title:i("setLayerSource"),backToFocusNode:d,children:(0,x.jsxs)("div",{className:"w-100 h-100",css:s.css`overflow: auto;`,children:[(0,x.jsx)(j,{style:{paddingTop:0},children:(0,x.jsx)(k,{flow:"wrap",label:i("data"),children:(0,x.jsx)(lt.DataSourceSelector,{closeDataSourceListOnChange:!0,hideDs:w,types:S?(0,s.Immutable)(S):qo,useDataSources:(0,s.Immutable)(X),disableRemove:()=>!0,mustUseDataSource:!0,onChange:e=>{e&&e.length>0?1===(null==e?void 0:e.length)||I?(e=>{Ao(e).then(t=>{const i=Lo({datasourceConfig:l,datasourceConfigItem:C,dsJsonOriginDs:t,useDataSource:e,configId:I});v((0,s.Immutable)(i.datasourceConfig))})})(e[0]):(e=>{const t=e.map(e=>Ao(e).then(t=>{const i=No({datasourceConfig:l,datasourceConfigItem:C,dsJsonOriginDs:t,useDataSource:e,configId:null});return Promise.resolve(i)}));Promise.all(t).then(e=>{const t=[];e=e.map(e=>{if(null==t?void 0:t.includes(null==e?void 0:e.configId)){const i=Oo(t,p);e.configId=i}return t.push(e.configId),e});let i=l?l.asMutable({deep:!0}):[];i=i.concat(e),v((0,s.Immutable)(i),!0)})})(e):z()},widgetId:r,isBatched:!0,isMultiple:!I,disableDataView:null==u?void 0:u.disableDataView,fromDsIds:(null==u?void 0:u.fromDsIds)?(0,s.Immutable)(null==u?void 0:u.fromDsIds):null,fromRootDsIds:(null==u?void 0:u.fromRootDsIds)?(0,s.Immutable)(null==u?void 0:u.fromRootDsIds):null})})}),(null==C?void 0:C.configId)&&E&&(0,x.jsxs)("div",{children:[(0,x.jsx)(j,{children:(0,x.jsx)(k,{flow:"wrap",label:i("label"),children:(0,x.jsx)(O.TextInput,{"aria-label":i("label"),size:"sm",value:B||"",onAcceptValue:_,onChange:H,className:"w-100",placeholder:i("findAddressOrPlace")})})}),!b&&(0,x.jsx)(j,{children:(0,x.jsx)(k,{label:i("searchIcon"),children:(0,x.jsx)(Ho.IconPicker,{icon:P,onChange:e=>{W(["icon"],e)},configurableOption:"none",setButtonUseColor:!1})})}),(0,x.jsxs)(j,{title:i("searchOptions"),role:"group","aria-label":i("searchOptions"),children:[(0,x.jsxs)(k,{flow:"wrap",label:i("selectSearchFields"),role:"group","aria-label":i("selectSearchFields"),children:[(0,x.jsx)(lt.FieldSelectorWithFullTextIndex,{useDataSources:A?(0,s.Immutable)([A]):(0,s.Immutable)([]),onChange:e=>{$(e,N)},selectedFields:(0,s.Immutable)(null==N?void 0:N.map(e=>null==e?void 0:e.name)),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,widgetId:r,types:(0,s.Immutable)([s.JimuFieldType.Number,s.JimuFieldType.String])}),(0,x.jsxs)("div",{className:"mt-2","aria-label":i("exactMatch"),onClick:G,children:[(0,x.jsx)(O.Checkbox,{title:i("exactMatch"),checked:M,className:"mr-2"}),i("exactMatch")]})]}),!m&&(0,x.jsx)(k,{flow:"wrap",label:i("displayFields"),role:"group","aria-label":i("displayFields"),children:(0,x.jsx)(_o,{disPlayField:L||[],onFieldChange:$,useDataSource:A})}),(0,x.jsx)(k,{flow:"wrap",label:i("searchHint"),children:(0,x.jsx)(O.TextInput,{size:"sm",value:D||"",title:D||i("findAddressOrPlace"),"aria-label":i("searchHint"),onChange:J,className:"w-100",placeholder:i("findAddressOrPlace")})}),q()&&(0,x.jsx)(k,{children:(0,x.jsxs)("div",{className:"mt-2","aria-label":i("searchInCurrentMapExtent"),onClick:K,children:[(0,x.jsx)(O.Checkbox,{title:i("searchInCurrentMapExtent"),checked:!!R,className:"mr-2"}),i("searchInCurrentMapExtent")]})})]})]}),(null==X?void 0:X[0])&&(0,x.jsx)("div",{className:"waiting-for-database",children:(0,x.jsx)(s.DataSourceComponent,{useDataSource:(0,s.Immutable)(X[0]),onDataSourceCreated:e=>{F(e),e&&y(e.id,!0)},onCreateDataSourceFailed:e=>{if(!(null==C?void 0:C.useDataSource))return!1;const t=C.useDataSource.dataSourceId;y(t,!1)}})})]})})};var Yo=v(96745),Qo=v.n(Yo),Zo=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const en=e=>{const t=window.SVG,{className:i}=e,o=Zo(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:Qo()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))},{useEffect:tn,useRef:sn}=s.React;var on;!function(e){e.Pass="Pass",e.NotHttps="Not_Https",e.InvalidURL="Invalid_URL"}(on||(on={}));const nn=[s.SupportedUtilityType.GeoCoding],an=/http(s)?:\/\/(geocode|geocodedev|geocodeqa)(\.){0,3}\.arcgis\.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,rn=e=>{const t=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages),i=sn(null),{id:o,trigger:n,toggle:a,isOpen:r,datasourceConfig:l,dsConfigItemIndex:c,popperFocusNode:d,createOutputDs:p,viewId:u,showSearchInCurrentMapExtentSetting:h,showEnableLocalSearchSetting:m,onSettingChange:g,updateConfigForLayerOptions:v,hideIconSetting:f}=e,y=(null==l?void 0:l[c])||(0,s.Immutable)({}),{configId:b,label:S,icon:w,hint:C,outputDataSourceId:I,displayFields:T,searchInCurrentMapExtent:P,enableLocalSearch:N}=y,[M,L]=s.React.useState(S),[D,A]=s.React.useState(!1),[R,E]=s.React.useState(on.Pass),[F,B]=s.React.useState(null==y?void 0:y.useUtility),[U,z]=s.React.useState(!1),[$,V]=s.React.useState(!1),[W,G]=s.React.useState(null),[H,_]=s.React.useState(null),[J,K]=s.React.useState(null),[q,X]=s.React.useState(!1);tn(()=>{r&&(clearTimeout(i.current),i.current=setTimeout(()=>{const e=document.querySelector(".search-locator-setting-popper .action-close");(0,s.focusElementInKeyboardMode)(e)},200))},[r]),tn(()=>{r&&(E(on.Pass),z(!1),(null==y?void 0:y.useUtility)?(uo(null==y?void 0:y.useUtility).then(e=>{A(!1),K(e),ho(e).then(e=>{A(!0),E(null==e?void 0:e.urlCheckResultType)},e=>{A(!0)})}),B(null==y?void 0:y.useUtility),L(null==y?void 0:y.label)):(B(null),L(qs)))},[c,b,r]),tn(()=>{L(null==y?void 0:y.label),V(!!(null==y?void 0:y.enableCountryCode)),G(null==y?void 0:y.countryCode),_(null==y?void 0:y.minScale)},[y]),tn(()=>{X(an.test(J))},[J]);const Y=(e,t)=>{const i=null==l?void 0:l.asMutable({deep:!0}),o=null==y?void 0:y.setIn(e,t);null==i||i.splice(c,1,null==o?void 0:o.asMutable({deep:!0})),g((0,s.Immutable)(i),null,u)},Q=e=>{const t=e[0];if(B(t||null),t){z(!0);const e={id:o,createOutputDs:p,dataSourceConfigItem:y,viewId:u,configId:b,datasourceConfig:l,useUtility:null==t?void 0:t.asMutable({deep:!0})};A(!1),oo(e).then(e=>{A(!0),z(!1);const{urlCheckResult:t,dataSourceConfig:i}=e;(null==t?void 0:t.urlCheckResultType)!==on.Pass?B(null):v((0,s.Immutable)(i))},e=>{A(!0)})}else Z()},Z=()=>{const e=ko(null==l?void 0:l.asMutable({deep:!0})),t=b||Oo(e,u);let i=l?l.asMutable({deep:!0}):[];const o={configId:t,icon:null,label:".....",hint:"",useUtility:null,searchServiceType:Fs.GeocodeService,singleLineFieldName:""};i=l.map(e=>(null==e?void 0:e.configId)===t?o:e),v((0,s.Immutable)(i))},ee=s.css`
    &>div {
      padding: 0!important;
    }
  `,te=e=>{var t;if(!e)return(0,s.Immutable)([]);const i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder.appConfig)||void 0===t?void 0:t.utilities;if(null==i?void 0:i[e.utilityId])return(0,s.Immutable)([e]);(0,s.Immutable)([])},ie=(0,s.useIntl)();return(0,x.jsx)(Ye,{className:"search-locator-setting-popper",isOpen:r,position:"right",toggle:a,trigger:n,title:t("setLocatorSource"),backToFocusNode:d,children:(0,x.jsxs)("div",{className:"w-100 h-100",css:s.css`overflow: auto;`,children:[(0,x.jsx)(j,{style:{paddingTop:0},children:(0,x.jsxs)(k,{flow:"wrap",label:t("locatorSource"),role:"group","aria-label":t("locatorSource"),children:[(0,x.jsx)("div",{className:"w-100",role:"group","aria-label":t("locatorSource"),css:ee,children:(0,x.jsx)($o.UtilitySelector,{useUtilities:te(F),onChange:Q,showRemove:!1,types:nn,closePopupOnSelect:!0})}),R!==on.Pass&&D&&(0,x.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between mt-1",children:(0,x.jsx)(O.Alert,{form:"basic",type:"warning",className:"w-100",open:!0,withIcon:!0,text:t("invalidUrlMessage")})})]})}),U&&(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary}),R===on.Pass&&b&&F&&(0,x.jsxs)("div",{children:[(0,x.jsx)(j,{children:(0,x.jsx)(k,{flow:"wrap",label:t("label"),children:(0,x.jsx)(O.TextInput,{"aria-label":t("label"),size:"sm",value:M||"",onChange:e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;L(i)},onAcceptValue:e=>{e?(L(null==e?void 0:e.trim()),Y(["label"],null==e?void 0:e.trim())):L(S)},className:"w-100"})})}),!f&&(0,x.jsx)(j,{children:(0,x.jsx)(k,{label:t("searchIcon"),children:(0,x.jsx)(Ho.IconPicker,{icon:w,onChange:e=>{Y(["icon"],e)},configurableOption:"none",setButtonUseColor:!1})})}),(0,x.jsxs)(j,{title:t("searchOptions"),role:"group","aria-label":t("searchOptions"),children:[I&&(0,x.jsx)(k,{flow:"wrap",label:t("displayFields"),role:"group","aria-label":t("displayFields"),children:(0,x.jsx)(_o,{disPlayField:T||[],onFieldChange:(e,t,i=!1)=>{var o,n;if(!e)return;0===(null==e?void 0:e.length)&&(e=null===(n=null===(o=(0,s.Immutable)(t))||void 0===o?void 0:o.asMutable({deep:!0}))||void 0===n?void 0:n.splice(0,1));const a=null==l?void 0:l.asMutable({deep:!0}),r=null==y?void 0:y.setIn(["displayFields"],e);null==a||a.splice(c,1,null==r?void 0:r.asMutable({deep:!0})),v((0,s.Immutable)(a))},useDataSource:{dataSourceId:I,mainDataSourceId:I}})}),(0,x.jsx)(k,{flow:"wrap",label:t("searchHint"),children:(0,x.jsx)(O.TextInput,{size:"sm","aria-label":t("searchHint"),title:C||t("findAddressOrPlace"),value:C||"",onChange:e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;Y(["hint"],i)},className:"w-100",placeholder:t("findAddressOrPlace")})}),m&&(0,x.jsx)(k,{label:t("enableLocalSearch"),children:(0,x.jsx)(O.Switch,{title:t("enableLocalSearch"),checked:!!N,onChange:e=>{const t=!N,i=null==l?void 0:l.asMutable({deep:!0});let o=null==y?void 0:y.setIn(["enableLocalSearch"],t);t&&(o=o.setIn(["minScale"],Rs)),null==i||i.splice(c,1,null==o?void 0:o.asMutable({deep:!0})),g((0,s.Immutable)(i),null,u)}})}),m&&!!N&&(0,x.jsx)(k,{label:t("minScale"),flow:"wrap",children:(0,x.jsx)(O.NumericInput,{"aria-label":t("minScale"),size:"sm",value:H,showHandlers:!1,onChange:e=>{_(e)},onAcceptValue:e=>{(e<0||!e)&&(e=Rs),_(e),Y(["minScale"],e)},className:"w-100"})}),q&&(0,x.jsx)(k,{children:(0,x.jsxs)(O.Label,{className:"d-flex w-100 align-items-center",onClick:()=>{V(!$),Y(["enableCountryCode"],!$)},children:[(0,x.jsx)(O.Checkbox,{className:"mr-2",checked:$}),(0,x.jsx)("div",{children:t("searchCountryCodeLabel")})]})}),(null==y?void 0:y.enableCountryCode)&&(0,x.jsx)(k,{role:"group","aria-label":t("searchCountryCodeLabel"),children:(0,x.jsx)(O.TextInput,{placeholder:t("searchCountryCodeHint"),"aria-label":t("label"),size:"sm",value:W||"",onChange:e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;G(i)},onAcceptValue:e=>{G(null==e?void 0:e.trim()),Y(["countryCode"],null==e?void 0:e.trim())},className:"w-100",suffix:(0,x.jsx)(O.Button,{disableHoverEffect:!0,disableRipple:!0,type:"tertiary",size:"sm",target:"_blank",icon:!0,href:"https://developers.arcgis.com/rest/geocode/api-reference/geocode-coverage.htm",children:(0,x.jsx)(en,{autoFlip:!s.i18n.isSameLanguage(null==ie?void 0:ie.locale,"he")})})})}),h&&(0,x.jsx)(k,{children:(0,x.jsxs)(O.Label,{className:"d-flex w-100 align-items-center",onClick:e=>{Y(["searchInCurrentMapExtent"],!P)},children:[(0,x.jsx)(O.Checkbox,{className:"mr-2",checked:!!P}),(0,x.jsx)("div",{children:t("searchInCurrentMapExtent")})]})})]})]})]})})},{useState:ln,useEffect:cn}=s.React,dn=e=>{const{datasourceConfig:t,dsStatusChange:i}=e,[o,n]=ln([]),a=e=>{e&&i(e.id,!0)};return cn(()=>{const e=[];t.forEach(t=>{t.searchServiceType===Fs.FeatureService&&(null==t?void 0:t.useDataSource)&&e.push(null==t?void 0:t.useDataSource)}),n(e)},[t]),(0,x.jsx)("div",{className:"data-source-list",children:o.map((e,t)=>(0,x.jsx)(s.DataSourceComponent,{useDataSource:e,onDataSourceCreated:a,onCreateDataSourceFailed:t=>{var s;s=e.dataSourceId,i(s,!1)}},t))})};var pn=function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((s=s.apply(e,t||[])).next())})};const{useState:un,useRef:hn}=s.React,mn=v(62838),gn=s.css`
  .warning-alert-con {
    padding: 0 !important;
  }
  .warning-alert-con .jimu-icon-component {
    color: var(--sys-color-warning-light) !important;
  }
  .setting-ui-unit-list-new {
    margin-top: 4px;
  }
`,vn=e=>{const t=s.hooks.useTranslation(s.defaultMessages,O.defaultMessages),i=hn(!1),o=hn(null),n=hn(null),a=hn(null),{className:r,datasourceConfig:l,useDataSources:c,dsConfigItemIndex:d,createOutputDs:p,showSourcePanel:u,showNewSourceItem:h,id:m,dataSourceCreateStatus:g,dsStatusChange:v,onDsConfigIdChange:f,updateConfigForLayerOptions:y,hideSidePopper:b}=e,S=s.ReactRedux.useSelector(e=>{var t,i,s;return null===(s=null===(i=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===s?void 0:s[m]}),w=s.ReactRedux.useSelector(e=>{var t,i;return null===(i=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets}),C={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:H.TreeItemActionType.RenderOverrideItemTitle},{name:H.TreeItemActionType.RenderOverrideItemDetailToggle},{name:H.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},[j,I]=un(null),[k,T]=un(null),[P,N]=un(!1),[M,L]=un(null);s.ReactRedux.useSelector(e=>{var i,o;const a={},r=(null===(o=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo)||void 0===o?void 0:o.utilityStates)||{};null==l||l.forEach(e=>{(null==e?void 0:e.searchServiceType)===Fs.GeocodeService&&(a[e.configId]=((e,i)=>{var o,n;if((null==e?void 0:e.searchServiceType)===Fs.FeatureService)return null;const a=null===(o=null==e?void 0:e.useUtility)||void 0===o?void 0:o.utilityId;return s.UtilityManager.getInstance().utilityHasSignInError(a)?t("signInErrorDefault"):!1===(null===(n=null==i?void 0:i[a])||void 0===n?void 0:n.success)?t("utilityNotAvailable"):null})(null==e?void 0:e.asMutable({deep:!0}),r))}),n.current=a});const D=s.hooks.useEventCallback(()=>{const e=null==l?void 0:l.asMutable({deep:!0});null==e||e.splice(k,1),y((0,s.Immutable)(e)),b()}),A=e=>{var t;(null===(t=l[e])||void 0===t?void 0:t.searchServiceType)===Fs.GeocodeService?i.current?R(e):pn(void 0,void 0,void 0,function*(){return!i.current&&s.moduleLoader.loadModule("jimu-ui/advanced/data-source-selector").then(e=>(i.current=!0,o.current=e.dataComponentsUtils,a.current=e.DataSourceRemoveWaringReason,L(e.DataSourceRemoveWarningPopup),Promise.resolve(!0)))}).then(()=>{R(e)}):E(e)},R=s.hooks.useEventCallback(e=>{const t=l[e].outputDataSourceId;0===o.current.getWidgetsUsingDsOrItsDescendantDss(t,w).length?E(e):(I(t),N(!0),T(e))}),E=e=>{const t=null==l?void 0:l.asMutable({deep:!0});null==t||t.splice(e,1),y((0,s.Immutable)(t)),b()},F=s.hooks.useEventCallback(e=>{const t=(null==l?void 0:l.map(e=>null==e?void 0:e.configId))||[],i=(null==e?void 0:e.map(e=>null==e?void 0:e.configId))||[];return t.join("")!==i.join("")});return(0,x.jsxs)("div",{className:`w-100 mt-2 ${r||""}`,css:gn,children:[(0,x.jsx)(H.List,Object.assign({className:"w-100",itemsJson:Array.from(l).map((e,i)=>{var s;return{itemStateDetailContent:e,itemKey:`${i}`,itemStateChecked:u&&i===d,itemStateTitle:null==e?void 0:e.label,itemStateIcon:{icon:null===(s=e.icon)||void 0===s?void 0:s.svg},itemStateCommands:[{label:t("deleteOption"),iconProps:()=>({icon:mn,size:12}),action:()=>{A(i)}}]}}),dndEnabled:!0,renderOverrideItemDetailToggle:(e,i)=>{var s,o;const{itemJsons:a}=i.props,[r]=a,l=null==r?void 0:r.itemStateDetailContent,d=(null==l?void 0:l.searchServiceType)===Fs.GeocodeService,u=d?null==l?void 0:l.outputDataSourceId:null===(s=null==l?void 0:l.useDataSource)||void 0===s?void 0:s.dataSourceId,h=!!p&&!((e,t=!1)=>{let i,s=!0;if(t){const t=(null==S?void 0:S.outputDataSources)||[];i=(null==t?void 0:t.filter(t=>e===t).length)>0}else i=(null==c?void 0:c.filter(t=>e===t.dataSourceId).length)>0;return"boolean"!=typeof(null==g?void 0:g[e])||(null==g?void 0:g[e])||(s=!1),i&&e&&s})(u,d),m=null===(o=n.current)||void 0===o?void 0:o[l.configId];return d&&m?(0,x.jsx)(O.Alert,{className:"warning-alert-con",variant:"text",form:"tooltip",size:"small",type:"warning",text:m}):h&&u?(0,x.jsx)(O.Alert,{variant:"text",form:"tooltip",size:"small",type:"error",text:t("dataSourceCreateError")}):""},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,o]=i,n=o.map(e=>e.itemStateDetailContent);f(null),F(n)&&y((0,s.Immutable)(n))},onClickItemBody:(e,t)=>{var i;const{itemJsons:[s]}=t.props,o=(null===(i=null==s?void 0:s.itemStateDetailContent)||void 0===i?void 0:i.searchServiceType)===Fs.GeocodeService;f(+s.itemKey,o)}},C)),h&&(0,x.jsx)(H.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map((e,t)=>({itemStateDetailContent:"item",itemKey:"index",itemStateChecked:!0,itemStateTitle:"......",itemStateCommands:[]})),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},C)),M&&(0,x.jsx)(M,{dataSourceId:j,isOpen:P,toggle:()=>{N(!P)},reason:a.current.DataSourceRemoved,afterRemove:()=>{I(null),T(null),N(!1)},beforeRemove:D}),(0,x.jsx)(dn,{datasourceConfig:l,dsStatusChange:v})]})},{useSelector:fn}=s.ReactRedux,{useRef:yn,useEffect:bn}=s.React,Sn=e=>{var t,i,o,n;const a=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages),r=(0,m.useTheme)(),{datasourceConfig:l,id:c,useDataSources:d,searchDataSettingType:p,showSearchInCurrentMapExtentSetting:u,createOutputDs:h,hideIconSetting:g,hideDisplayFieldSetting:v,enableFiltering:f,viewId:y,hideEnableFiltering:b,showEnableLocalSearchSetting:S,hideTitleOfNewSearchSource:w,propsForDataSourceSelector:C,autoSelectSingleGeocodeService:I,autoSelectAllOrgGeocodeService:T,onSettingChange:P,onOutputDsSettingChange:N,onEnableFilteringChange:M,supportedDsTypes:L,hideDs:D}=e,A=yn(null),R=yn(null),E=yn(!1),F=yn(null),B=yn(null),[U,z]=s.React.useState(!1),[$,V]=s.React.useState(!1),[W,G]=s.React.useState(!1),[H,_]=s.React.useState(!1),[J,K]=s.React.useState(null),[q,X]=s.React.useState(null),[Y,Q]=s.React.useState((0,s.Immutable)({})),[Z,ee]=s.React.useState(!1),te=fn(e=>{var t,i,s;return null===(s=null===(i=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===s?void 0:s[c]}),ie=fn(e=>e.appStateInBuilder.appConfig.utilities),se=s.css`
    & {
      background-color: ${null===(i=null===(t=null==r?void 0:r.sys.color)||void 0===t?void 0:t.secondary)||void 0===i?void 0:i.main};
    }
  `,oe=s.css`
    .data-remind {
      color: ${null===(n=null===(o=null==r?void 0:r.ref.palette)||void 0===o?void 0:o.neutral)||void 0===n?void 0:n[1e3]};
      font-size: ${s.polished.rem(12)};
    }
    .loading-con {
      height: 80px;
    }
  `;bn(()=>{F.current=null==l?void 0:l.asMutable({deep:!0}),h&&ae()},[l]),bn(()=>{const e=(T||I)&&!B.current&&!E.current&&!l,t=F.current||[];if(e){const e={nls:a,id:c,createOutputDs:h,viewId:y,isSingle:I};E.current=!0,ee(!0),Wo(e).then(e=>{if(E.current=!1,B.current=e,ee(!1),e){let i=t;i=null==e?void 0:e.concat(i),de((0,s.Immutable)(i))}},e=>{ee(!1),E.current=!1})}},[T,I]),bn(()=>{ne(ie)},[ie]);const ne=e=>{let t=!1;const i=null==l?void 0:l.filter(i=>{var s;if((null==i?void 0:i.searchServiceType)===Fs.FeatureService)return!0;{const o=null===(s=null==i?void 0:i.useUtility)||void 0===s?void 0:s.utilityId;return!o||(!!(null==e?void 0:e[o])||(t=!0,!1))}});t&&de(i)},ae=()=>{const e=(null==te?void 0:te.outputDataSources)||[],t=(null==l?void 0:l.asMutable({deep:!0}))||[];for(let i;i<(null==t?void 0:t.length)-1;i++){const s=t[i];if((null==s?void 0:s.searchServiceType)===Fs.FeatureService)continue;const o=null==s?void 0:s.outputDataSourceId;if(!(null==e?void 0:e.includes(o))){de(l);break}}},re=(e,t=!1)=>{const i=Y.set(e,t);Q(i)},le=()=>{G(!1),V(!1),K(null)},ce=e=>{const t=e?!W:!$;if(_(t),t){const e=(null==l?void 0:l.length)||0;K(e),he(e,!0)}e?V(t):G(t)},de=(e,t=!1)=>{pe(e)&&_(!1),t&&le();const i=Eo(e,h),s=Fo(i,c,h);h?N&&N(i.outputDataSources,e,s,y):P&&P(e,s,y)},pe=e=>(null==e?void 0:e.length)!==(null==l?void 0:l.length),ue=()=>{var e;const t=null===(e=null==l?void 0:l.asMutable({deep:!0}))||void 0===e?void 0:e.filter(e=>(null==e?void 0:e.useDataSource)||(null==e?void 0:e.useUtility));de((0,s.Immutable)(t))},he=(e,t=!1)=>{let i;i=t?R.current.getElementsByClassName("add-search-btn")[0]:R.current.getElementsByClassName("jimu-tree-item__body")[e],X(i)};return(0,x.jsxs)("div",{children:[(0,x.jsxs)(j,{css:oe,children:[!w&&(0,x.jsx)(k,{flow:"wrap",children:(0,x.jsx)("span",{className:"w-100 data-remind",id:`addSources_${c}`,children:a("addSources")})}),(0,x.jsxs)(k,{flow:"wrap",children:[(0,x.jsxs)("div",{className:"w-100",ref:R,children:[(0,x.jsxs)("div",{children:[(!p||p===Es.Both)&&(0,x.jsxs)(O.Dropdown,{className:"w-100",size:"sm",toggle:()=>{z(!U)},isOpen:U,autoWidth:!0,children:[(0,x.jsx)(O.DropdownButton,{"aria-describedby":`addSources_${c}`,className:"add-search-btn w-100",title:a("newSearchSource"),"aria-label":a("newSearchSource"),arrow:!1,icon:!0,type:"primary",children:(0,x.jsxs)("div",{className:"w-100 text-truncate",children:[(0,x.jsx)(Xi,{className:"mr-1 d-inline-block",autoFlip:!0}),a("newSearchSource")]})}),(0,x.jsxs)(O.DropdownMenu,{css:se,children:[(0,x.jsx)(O.DropdownItem,{className:"w-100",onClick:()=>{ce(!0)},title:a("layerSource"),children:a("layerSource")}),(0,x.jsx)(O.DropdownItem,{className:"w-100",onClick:()=>{ce(!1)},title:a("locatorSource"),children:a("locatorSource")})]})]}),p===Es.FeatureService&&(0,x.jsxs)(O.Button,{type:"primary",className:"w-100 add-search-btn",onClick:()=>{ce(!0)},children:[(0,x.jsx)(Xi,{className:"mr-1 d-inline-block",autoFlip:!0}),a("layerSource")]}),p===Es.GeocodeService&&(0,x.jsxs)(O.Button,{type:"primary",className:"w-100 add-search-btn",onClick:()=>{ce(!1)},children:[(0,x.jsx)(Xi,{className:"mr-1 d-inline-block",autoFlip:!0}),a("locatorSource")]})]}),(0,x.jsx)("div",{className:"w-100",ref:A,children:(0,x.jsx)(vn,{id:c,dsConfigItemIndex:J,datasourceConfig:l||(0,s.Immutable)([]),showSourcePanel:(()=>{var e;return(null===(e=null==l?void 0:l[J])||void 0===e?void 0:e.searchServiceType)===Fs.GeocodeService?W:$})(),useDataSources:d,onDsConfigIdChange:(e,t)=>{_(!1),"number"==typeof e?(he(e,!1),J===e?t?(G(!W),V(!1)):(V(!$),G(!1)):(K(e),t?(G(!0),V(!1)):(V(!0),G(!1)))):le()},showNewSourceItem:H,updateConfigForLayerOptions:de,hideSidePopper:le,dsStatusChange:re,createOutputDs:h,dataSourceCreateStatus:Y})})]}),(0,x.jsx)(Xo,{supportedDsTypes:L,hideDs:D,viewId:y,id:c,dsConfigItemIndex:J,datasourceConfig:l||(0,s.Immutable)([]),useDataSources:d,isOpen:$,onSettingChange:P,trigger:null==A?void 0:A.current,updateConfigForLayerOptions:de,toggle:()=>{$&&K(null),V(!$),_(!1),ue()},dsStatusChange:re,popperFocusNode:q,hideIconSetting:g,hideDisplayFieldSetting:v,propsForDataSourceSelector:C,showSearchInCurrentMapExtentSetting:u}),(0,x.jsx)(rn,{id:c,viewId:y,dsConfigItemIndex:J,datasourceConfig:l||(0,s.Immutable)([]),useDataSources:d,isOpen:W,onSettingChange:P,updateConfigForLayerOptions:de,trigger:null==A?void 0:A.current,toggle:()=>{W&&K(null),G(!W),_(!1),ue()},popperFocusNode:q,hideIconSetting:g,createOutputDs:h,showSearchInCurrentMapExtentSetting:u,showEnableLocalSearchSetting:S})]}),Z&&(0,x.jsx)(k,{children:(0,x.jsx)("div",{className:"position-relative w-100 loading-con",children:(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary})})})]}),(p===Es.Both||p===Es.FeatureService)&&!b&&(0,x.jsx)(j,{children:(0,x.jsx)(k,{tag:"label",label:a("enableSearchFilter"),children:(0,x.jsx)(O.Switch,{checked:f,onChange:e=>{const t=e.target.checked;M&&M(t)},title:a("enableSearchFilter")})})}),(p===Es.Both||p===Es.FeatureService)&&(0,x.jsx)("span",{})]})};var xn=v(68972);const wn=e=>{const t=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages),i=(0,m.useTheme)(),o=s.css`
    .check-box-label {
      color: ${i.ref.palette.neutral[1100]}
    }
    .search-setting-con {
      padding-left: 0;
      padding-right: 0;
    }
    .checkbox-con .jimu-widget-setting--row-label{
      max-width: 100%;
    }
    .cursor-pointer {
      cursor: pointer;
    }
  `,{onSettingChange:n,hideRecentSearchSetting:a}=e,r=e.settingConfig||(0,s.Immutable)({}),{maxSuggestions:l,isUseCurrentLoation:c,isShowRecentSearches:d,recentSearchesMaxNumber:p}=r,[u,h]=s.React.useState(p),[g,v]=s.React.useState(l);(0,xn.useEffect)(()=>{h(p),v(l)},[r]);const f=(e,t)=>{const i=r.setIn(e,t);n&&n(i)},y=(e,t=1)=>{if(0===(null==e?void 0:e.length))return!0;if(isNaN(Number(e)))return!1;{const i=Number(e);return Number.isInteger(i)&&i>=t}};return(0,x.jsxs)("div",{css:o,children:[(0,x.jsx)(k,{flow:"wrap",className:"mt-2 checkbox-con",label:t("maximumSuggestions"),children:(0,x.jsx)(O.TextInput,{size:"sm","aria-label":t("maximumSuggestions"),value:g,onChange:e=>{const t=e.target.value;y(t,0)&&v(t)},onAcceptValue:e=>{(!e||e>Ls)&&v(e=l||Ms),y(e,0)&&f(["maxSuggestions"],Number(e))},className:"w-100"})}),(0,x.jsx)(k,{children:(0,x.jsxs)("div",{className:"cursor-pointer d-flex align-items-center",onClick:e=>{f(["isUseCurrentLoation"],!c)},"aria-label":t("useCurrentLocation"),children:[(0,x.jsx)(O.Checkbox,{checked:!!c,className:"mr-1",title:t("useCurrentLocation")}),(0,x.jsx)("span",{className:"check-box-label",children:t("useCurrentLocation")})]})}),!a&&(0,x.jsx)(k,{tag:"label",label:t("recentSearches"),children:(0,x.jsx)(O.Switch,{checked:d||!1,title:t("recentSearches"),onChange:e=>{f(["isShowRecentSearches"],!d)}})}),d&&(0,x.jsx)(k,{label:t("maximumNumber"),children:(0,x.jsx)(O.TextInput,{size:"sm","aria-label":t("maximumNumber"),value:u,onChange:e=>{const t=e.target.value;y(t)&&h(t)},onAcceptValue:e=>{e||h(e=p||Ds),y(e)&&f(["recentSearchesMaxNumber"],Number(e))},style:{width:"50px"}})})]})},Cn=e=>{const t=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages),{hint:i,allowSearchSourceSelection:o,enableAllowSearchSourceSelectionSetting:n,onGeneralSettingChange:a}=e,[r,l]=s.React.useState(i);(0,xn.useEffect)(()=>{l(i)},[i]);return(0,x.jsxs)("div",{className:"general-setting-con",children:[n&&(0,x.jsx)(k,{children:(0,x.jsxs)("div",{className:"d-flex w-100 align-items-center",onClick:e=>{a&&a(["allowSearchSourceSelection"],!1===o)},children:[(0,x.jsx)(O.Checkbox,{"aria-label":t("allowSearchSourceSelection"),className:"mr-3",checked:!1!==o}),(0,x.jsx)("div",{children:t("allowSearchSourceSelection")})]})}),(0,x.jsx)(k,{flow:"wrap",label:t("multiSearchHint"),children:(0,x.jsx)(O.TextInput,{"aria-label":t("multiSearchHint"),title:r||t("findAddressOrPlace"),size:"sm",value:r,onChange:e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;l(i)},onAcceptValue:e=>{l(e),a&&a(["hint"],e)},className:"w-100",placeholder:t("findAddressOrPlace")})})]})};var jn=v(53195),In=v.n(jn),kn=v(72529),On=v.n(kn);var Tn=["br","col","colgroup","dl","hr","iframe","img","input","link","menuitem","meta","ol","param","select","table","tbody","tfoot","thead","tr","ul","wbr"],Pn={"accept-charset":"acceptCharset",acceptcharset:"acceptCharset",accesskey:"accessKey",allowfullscreen:"allowFullScreen",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",cellpadding:"cellPadding",cellspacing:"cellSpacing",charset:"charSet",class:"className",classid:"classID",classname:"className",colspan:"colSpan",contenteditable:"contentEditable",contextmenu:"contextMenu",controlslist:"controlsList",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",datetime:"dateTime",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",enctype:"encType",for:"htmlFor",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",innerhtml:"innerHTML",inputmode:"inputMode",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",marginwidth:"marginWidth",marginheight:"marginHeight",maxlength:"maxLength",mediagroup:"mediaGroup",minlength:"minLength",nomodule:"noModule",novalidate:"noValidate",playsinline:"playsInline",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rowspan:"rowSpan",spellcheck:"spellCheck",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",tabindex:"tabIndex",typemustmatch:"typeMustMatch",usemap:"useMap",accentheight:"accentHeight","accent-height":"accentHeight",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",arabicform:"arabicForm","arabic-form":"arabicForm",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",diffuseconstant:"diffuseConstant",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",edgemode:"edgeMode",enablebackground:"enableBackground","enable-background":"enableBackground",externalresourcesrequired:"externalResourcesRequired",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",imagerendering:"imageRendering","image-rendering":"imageRendering",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",vmathematical:"vMathematical","v-mathematical":"vMathematical",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan",onblur:"onBlur",onchange:"onChange",onclick:"onClick",oncontextmenu:"onContextMenu",ondoubleclick:"onDoubleClick",ondrag:"onDrag",ondragend:"onDragEnd",ondragenter:"onDragEnter",ondragexit:"onDragExit",ondragleave:"onDragLeave",ondragover:"onDragOver",ondragstart:"onDragStart",ondrop:"onDrop",onerror:"onError",onfocus:"onFocus",oninput:"onInput",oninvalid:"onInvalid",onkeydown:"onKeyDown",onkeypress:"onKeyPress",onkeyup:"onKeyUp",onload:"onLoad",onmousedown:"onMouseDown",onmouseenter:"onMouseEnter",onmouseleave:"onMouseLeave",onmousemove:"onMouseMove",onmouseout:"onMouseOut",onmouseover:"onMouseOver",onmouseup:"onMouseUp",onscroll:"onScroll",onsubmit:"onSubmit",ontouchcancel:"onTouchCancel",ontouchend:"onTouchEnd",ontouchmove:"onTouchMove",ontouchstart:"onTouchStart",onwheel:"onWheel"};function Nn(e,t){const{key:i,level:s,...o}=t;switch(e.nodeType){case 1:return xn.createElement(function(e){if(/[a-z]+[A-Z]+[a-z]+/.test(e))return e;return e.toLowerCase()}(e.nodeName),function(e,t){const i={key:t};if(e instanceof Element){const t=e.getAttribute("class");t&&(i.className=t),[...e.attributes].forEach(e=>{switch(e.name){case"class":break;case"style":i[e.name]="string"!=typeof(t=e.value)?{}:t.split(/ ?; ?/).reduce((e,t)=>{const[i,s]=t.split(/ ?: ?/).map((e,t)=>0===t?e.replace(/\s+/g,""):e.trim());if(i&&s){const t=i.replace(/(\w)-(\w)/g,(e,t,i)=>`${t}${i.toUpperCase()}`);let o=s.trim();Number.isNaN(Number(s))||(o=Number(s)),e[i.startsWith("-")?i:t]=o}return e},{});break;case"allowfullscreen":case"allowpaymentrequest":case"async":case"autofocus":case"autoplay":case"checked":case"controls":case"default":case"defer":case"disabled":case"formnovalidate":case"hidden":case"ismap":case"itemscope":case"loop":case"multiple":case"muted":case"nomodule":case"novalidate":case"open":case"readonly":case"required":case"reversed":case"selected":case"typemustmatch":i[Pn[e.name]||e.name]=!0;break;default:i[Pn[e.name]||e.name]=e.value}var t})}return i}(e,i),Mn(e.childNodes,s,o));case 3:{const t=e.nodeValue?.toString()??"";if(!o.allowWhiteSpaces&&/^\s+$/.test(t)&&!/[\u00A0\u202F]/.test(t))return null;if(!e.parentNode)return t;const i=e.parentNode.nodeName.toLowerCase();return Tn.includes(i)?(/\S/.test(t)&&console.warn(`A textNode is not allowed inside '${i}'. Your text "${t}" will be ignored`),null):t}case 8:default:return null;case 11:return Mn(e.childNodes,s,t)}}function Mn(e,t,i){const s=[...e].map((e,s)=>Dn(e,{...i,index:s,level:t+1})).filter(Boolean);return s.length?s:null}function Ln(e,t={}){return"string"==typeof e?function(e,t={}){if(!e||"string"!=typeof e)return null;const{includeAllNodes:i=!1,nodeOnly:s=!1,selector:o="body > *",type:n="text/html"}=t;try{const a=(new DOMParser).parseFromString(e,n);if(i){const{childNodes:e}=a.body;return s?e:[...e].map(e=>Dn(e,t))}const r=a.querySelector(o)||a.body.childNodes[0];if(!(r instanceof Node))throw new TypeError("Error parsing input");return s?r:Dn(r,t)}catch(e){0}return null}(e,t):e instanceof Node?Dn(e,t):null}function Dn(e,t={}){if(!(e&&e instanceof Node))return null;const{actions:i=[],index:s=0,level:o=0,randomKey:n}=t;let a=e,r=`${o}-${s}`;const l=[];return n&&0===o&&(r=`${function(e=6){const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let i="";for(let s=e;s>0;--s)i+=t[Math.round(61*Math.random())];return i}()}-${r}`),Array.isArray(i)&&i.forEach(t=>{t.condition(a,r,o)&&("function"==typeof t.pre&&(a=t.pre(a,r,o),a instanceof Node||(a=e)),"function"==typeof t.post&&l.push(t.post(a,r,o)))}),l.length?l:Nn(a,{key:r,level:o,...t})}var An=Object.defineProperty,Rn=(e,t,i)=>((e,t,i)=>t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i),En="react-inlinesvg",Fn={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed",READY:"ready",UNSUPPORTED:"unsupported"};function Bn(e){return e[Math.floor(Math.random()*e.length)]}function Un(){return!("undefined"==typeof window||!window.document?.createElement)}function zn(){return function(){if(!document)return!1;const e=document.createElement("div");e.innerHTML="<svg />";const t=e.firstChild;return!!t&&"http://www.w3.org/2000/svg"===t.namespaceURI}()&&"undefined"!=typeof window&&null!==window}async function $n(e,t){const i=await fetch(e,t),s=i.headers.get("content-type"),[o]=(s??"").split(/ ?; ?/);if(i.status>299)throw new Error("Not found");if(!["image/svg+xml","text/plain"].some(e=>o.includes(e)))throw new Error(`Content type isn't valid: ${o}`);return i.text()}function Vn(e=1){return new Promise(t=>{setTimeout(t,1e3*e)})}var Wn,Gn=class{constructor(){Rn(this,"cacheApi"),Rn(this,"cacheStore"),Rn(this,"subscribers",[]),Rn(this,"isReady",!1),this.cacheStore=new Map;let e=En,t=!1;Un()&&(e=window.REACT_INLINESVG_CACHE_NAME??En,t=!!window.REACT_INLINESVG_PERSISTENT_CACHE&&"caches"in window),t?caches.open(e).then(e=>{this.cacheApi=e}).catch(e=>{console.error(`Failed to open cache: ${e.message}`),this.cacheApi=void 0}).finally(()=>{this.isReady=!0;const e=[...this.subscribers];this.subscribers.length=0,e.forEach(e=>{try{e()}catch(e){console.error(`Error in CacheStore subscriber callback: ${e.message}`)}})}):this.isReady=!0}onReady(e){this.isReady?e():this.subscribers.push(e)}async get(e,t){return await(this.cacheApi?this.fetchAndAddToPersistentCache(e,t):this.fetchAndAddToInternalCache(e,t)),this.cacheStore.get(e)?.content??""}set(e,t){this.cacheStore.set(e,t)}isCached(e){return this.cacheStore.get(e)?.status===Fn.LOADED}async fetchAndAddToInternalCache(e,t){const i=this.cacheStore.get(e);if(i?.status!==Fn.LOADING){if(!i?.content){this.cacheStore.set(e,{content:"",status:Fn.LOADING});try{const i=await $n(e,t);this.cacheStore.set(e,{content:i,status:Fn.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:Fn.FAILED}),t}}}else await this.handleLoading(e,async()=>{this.cacheStore.set(e,{content:"",status:Fn.IDLE}),await this.fetchAndAddToInternalCache(e,t)})}async fetchAndAddToPersistentCache(e,t){const i=this.cacheStore.get(e);if(i?.status===Fn.LOADED)return;if(i?.status===Fn.LOADING)return void await this.handleLoading(e,async()=>{this.cacheStore.set(e,{content:"",status:Fn.IDLE}),await this.fetchAndAddToPersistentCache(e,t)});this.cacheStore.set(e,{content:"",status:Fn.LOADING});const s=await(this.cacheApi?.match(e));if(s){const t=await s.text();return void this.cacheStore.set(e,{content:t,status:Fn.LOADED})}try{await(this.cacheApi?.add(new Request(e,t)));const i=await(this.cacheApi?.match(e)),s=await(i?.text())??"";this.cacheStore.set(e,{content:s,status:Fn.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:Fn.FAILED}),t}}async handleLoading(e,t){for(let t=0;t<10;t++){if(this.cacheStore.get(e)?.status!==Fn.LOADING)return;await Vn(.1)}await t()}keys(){return[...this.cacheStore.keys()]}data(){return[...this.cacheStore.entries()].map(([e,t])=>({[e]:t}))}async delete(e){this.cacheApi&&await this.cacheApi.delete(e),this.cacheStore.delete(e)}async clear(){if(this.cacheApi){const e=await this.cacheApi.keys();await Promise.allSettled(e.map(e=>this.cacheApi.delete(e)))}this.cacheStore.clear()}};function Hn(e){const t=(0,xn.useRef)(void 0);return(0,xn.useEffect)(()=>{t.current=e}),t.current}function _n(e){const{baseURL:t,content:i,description:s,handleError:o,hash:n,preProcessor:a,title:r,uniquifyIDs:l=!1}=e;try{const e=function(e,t){if(t)return t(e);return e}(i,a),o=Ln(e,{nodeOnly:!0});if(!(o&&o instanceof SVGSVGElement))throw new Error("Could not convert the src to a DOM Node");const c=Jn(o,{baseURL:t,hash:n,uniquifyIDs:l});if(s){const e=c.querySelector("desc");e?.parentNode&&e.parentNode.removeChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","desc");t.innerHTML=s,c.prepend(t)}if(void 0!==r){const e=c.querySelector("title");if(e?.parentNode&&e.parentNode.removeChild(e),r){const e=document.createElementNS("http://www.w3.org/2000/svg","title");e.innerHTML=r,c.prepend(e)}}return c}catch(e){return o(e)}}function Jn(e,t){const{baseURL:i="",hash:s,uniquifyIDs:o}=t,n=["id","href","xlink:href","xlink:role","xlink:arcrole"],a=["href","xlink:href"];return o?([...e.children].forEach(e=>{if(e.attributes?.length){const t=Object.values(e.attributes).map(e=>{const t=e,o=/url\((.*?)\)/.exec(e.value);return o?.[1]&&(t.value=e.value.replace(o[0],`url(${i}${o[1]}__${s})`)),t});n.forEach(e=>{const i=t.find(t=>t.name===e);var o,n;i&&(o=e,n=i.value,!a.includes(o)||!n||n.includes("#"))&&(i.value=`${i.value}__${s}`)})}return e.children.length?Jn(e,t):e}),e):e}function Kn(e){const{cacheRequests:t=!0,children:i=null,description:s,fetchOptions:o,innerRef:n,loader:a=null,onError:r,onLoad:l,src:c,title:d,uniqueHash:p}=e,[u,h]=(0,xn.useReducer)((e,t)=>({...e,...t}),{content:"",element:null,isCached:t&&Wn.isCached(e.src),status:Fn.IDLE}),{content:m,element:g,isCached:v,status:f}=u,y=Hn(e),b=Hn(u),S=(0,xn.useRef)(p??function(e){const t="abcdefghijklmnopqrstuvwxyz",i=`${t}${t.toUpperCase()}1234567890`;let s="";for(let t=0;t<e;t++)s+=Bn(i);return s}(8)),x=(0,xn.useRef)(!1),w=(0,xn.useRef)(!1),C=(0,xn.useCallback)(e=>{x.current&&(h({status:"Browser does not support SVG"===e.message?Fn.UNSUPPORTED:Fn.FAILED}),r?.(e))},[r]),j=(0,xn.useCallback)((e,t=!1)=>{x.current&&h({content:e,isCached:t,status:Fn.LOADED})},[]),I=(0,xn.useCallback)(async()=>{const e=await $n(c,o);j(e)},[o,j,c]),k=(0,xn.useCallback)(()=>{try{const t=Ln(_n({...e,handleError:C,hash:S.current,content:m}));if(!t||!(0,xn.isValidElement)(t))throw new Error("Could not convert the src to a React element");h({element:t,status:Fn.READY})}catch(e){C(e)}},[m,C,e]),O=(0,xn.useCallback)(async()=>{const e=/^data:image\/svg[^,]*?(;base64)?,(.*)/u.exec(c);let i;if(e?i=e[1]?window.atob(e[2]):decodeURIComponent(e[2]):c.includes("<svg")&&(i=c),i)j(i);else try{if(t){const e=await Wn.get(c,o);j(e,!0)}else await I()}catch(e){C(e)}},[t,I,o,C,j,c]),T=(0,xn.useCallback)(async()=>{x.current&&h({content:"",element:null,isCached:!1,status:Fn.LOADING})},[]);(0,xn.useEffect)(()=>{if(x.current=!0,Un()&&!w.current){try{if(f===Fn.IDLE){if(!zn())throw new Error("Browser does not support SVG");if(!c)throw new Error("Missing src");T()}}catch(e){C(e)}return w.current=!0,()=>{x.current=!1}}},[]),(0,xn.useEffect)(()=>{if(Un()&&y&&y.src!==c){if(!c)return void C(new Error("Missing src"));T()}},[C,T,y,c]),(0,xn.useEffect)(()=>{f===Fn.LOADED&&k()},[f,k]),(0,xn.useEffect)(()=>{Un()&&y&&y.src===c&&(y.title===d&&y.description===s||k())},[s,k,y,c,d]),(0,xn.useEffect)(()=>{if(b)switch(f){case Fn.LOADING:b.status!==Fn.LOADING&&O();break;case Fn.LOADED:b.status!==Fn.LOADED&&k();break;case Fn.READY:b.status!==Fn.READY&&l?.(c,v)}},[O,k,v,l,b,c,f]);const P=function(e,...t){const i={};for(const s in e)({}).hasOwnProperty.call(e,s)&&(t.includes(s)||(i[s]=e[s]));return i}(e,"baseURL","cacheRequests","children","description","fetchOptions","innerRef","loader","onError","onLoad","preProcessor","src","title","uniqueHash","uniquifyIDs");return Un()?g?(0,xn.cloneElement)(g,{ref:n,...P}):[Fn.UNSUPPORTED,Fn.FAILED].includes(f)?i:a:a}const qn={s:12,m:16,l:20},Xn=e=>{let t=qn.m;return Object.keys(qn).includes(e)?t=qn[e]:"string"!=typeof e&&"number"!=typeof e||(t=e),t=t||qn.m,t},Yn=/\.svg$/,Qn=/<svg\b[^>]*>([\s\S]*?)<\/svg>/;var Zn=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ea=e=>(0,x.jsx)("svg",Object.assign({},e,{viewBox:"0,0,16,16",children:(0,x.jsx)("path",{d:"M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8Z",fill:"currentColor"})})),ta=e=>(0,x.jsxs)("svg",Object.assign({},e,{children:[(0,x.jsx)("path",{d:"M4 4.7959L4.79602 4L8.0199 7.22388L11.204 4.03979L12 4.83569L8.81592 8.02002L11.9598 11.1641L11.1639 11.9602L8.0199 8.81592L4.83606 12L4.04004 11.2041L7.224 8.02002L4 4.7959Z",fill:"currentColor"}),(0,x.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 4L4 0H12L16 4V12L12 16H4L0 12V4ZM1 4.41431L4.41418 1H11.5858L15 4.41431V11.5857L11.5858 15H4.41418L1 11.5857V4.41431Z",fill:"currentColor"})]})),ia=(0,m.styled)(function(e){Wn||(Wn=new Gn);const{loader:t}=e,[i,s]=(0,xn.useState)(Wn.isReady);return(0,xn.useEffect)(()=>{i||Wn.onReady(()=>{s(!0)})},[i]),i?xn.default.createElement(Kn,{...e}):t},{name:"SVG",part:"root"})(()=>({fill:"currentColor"})),sa=s.React.memo(s.React.forwardRef((e,t)=>{var i;const{role:o,className:n,src:a,srcRTL:r,isRTL:l=(null===(i=(0,s.getAppStore)().getState().appContext)||void 0===i?void 0:i.isRTL),size:c="m",color:d,style:p,autoFlip:u=!1,currentColor:h=!0,preProcessor:m,width:g,height:v,loader:f,children:y,"aria-hidden":b=!0}=e,S=Zn(e,["role","className","src","srcRTL","isRTL","size","color","style","autoFlip","currentColor","preProcessor","width","height","loader","children","aria-hidden"]),w=!0===b||"true"===b,C=!w,j=o||(w?"none":void 0),I=u&&l,k=I&&r,O=k?r:a,T=Xn(c),P=g||T,N=v||T,M=Object.assign(Object.assign({},e),{size:T}),L=(0,s.classNames)("jimu-svg",n,"svg-component",{rtl:I&&!k}),D=s.React.useMemo(()=>f||(0,x.jsx)(ea,{type:"loading",className:L,width:P,height:N,color:"var(--ref-palette-neutral-600)"}),[L,N,f,P]),A=s.React.useMemo(()=>y||(0,x.jsx)(ta,{type:"error",className:L,width:16,height:16,color:"var(--ref-palette-neutral-800)"}),[y,L]),R=s.React.useMemo(()=>{const e=(null==p?void 0:p.transform)||(I&&!k?"scaleX(-1)":"");return Object.assign(Object.assign({},p),{color:d,transform:e})},[p,d,I,k]),E=s.React.useMemo(()=>{if(h||m)return e=>{var t;return e=null!==(t=null==m?void 0:m(e))&&void 0!==t?t:e,e=h?(e=>e.replace(/fill="(?!.*none).*?"/g,'fill="currentColor"').replace(/stroke="(?!.*none).*?"/g,'stroke="currentColor"'))(e):e}},[h,m]);return(0,x.jsx)(ia,Object.assign({role:j,styleState:M,focusable:C,className:L,width:P,height:N,src:O,style:R,loader:D,preProcessor:E,innerRef:t,"aria-hidden":b},S,{children:A}))})),oa=(0,m.styled)(sa,{name:"Icon",part:"root"})(),na=(0,m.styled)("img",{name:"Icon",part:"img"})(),aa=s.React.memo(s.React.forwardRef((e,t)=>{var i;const{className:o,style:n,icon:a,width:r,height:l,size:c="m",color:d,rotate:p,flip:u,title:h,options:g,currentColor:v=!0,autoFlip:f,role:y,preProcessor:b,"aria-label":S,"aria-hidden":w}=e,C=Xn(c),j=r||C,I=l||C,k=g?g.currentColor:v,O=f&&(null===(i=(0,s.getAppStore)().getState().appContext)||void 0===i?void 0:i.isRTL),T="string"==typeof(P=a)&&P?Yn.test(P)||Qn.test(P):(console.warn("The `icon` should be a URL or a string (base64 or url encoded)."),!1);var P;const N=Object.assign(Object.assign({},e),{size:C,currentColor:k}),M=(e=>{const{flip:t}=e,i={root:[t&&`flip-${t}`],img:[t&&`flip-${t}`]};return m.utils.composeClasses("icon",i)})(N),L=s.React.useMemo(()=>{let e="";O&&(e="scaleX(-1)"),"vertical"===u?e="scaleY(-1)":"horizontal"===u&&(e="scaleX(-1)");return`${p?`rotate(${p}deg)`:""} ${e}`},[u,O,p]),D=s.React.useMemo(()=>Object.assign(Object.assign({},n),{transform:L}),[n,L]),A=s.React.useMemo(()=>"string"==typeof a?s.appConfigUtils.processResourceUrl(a):void 0,[a]);return(0,x.jsx)(s.React.Fragment,{children:T?(0,x.jsx)(oa,{ref:t,styleState:N,src:a,color:d,width:j,height:I,className:(0,s.classNames)(M.root,o,{rtl:O}),style:D,title:h,autoFlip:!1,"aria-label":S||h,"aria-hidden":w,preProcessor:b,currentColor:k,role:y}):(0,x.jsx)(na,{ref:t,styleState:N,src:A,width:j,height:I,className:(0,s.classNames)(M.img,o,{rtl:O}),style:D,alt:null!=h?h:"",role:y})})}));var ra=v(28996),la=v.n(ra);const ca=e=>s.css`
    .multiple-map-item {
      position: relative;
      background-color: ${e.ref.palette.neutral[500]};
      .multiple-map-item__body {
        display: flex;
        align-items: center;
        padding: 0.375rem 0.5rem 0.375rem 0;
        margin: 0.25rem 0;
        background-color: ${e.ref.palette.neutral[500]};
        cursor: pointer;
        font-weight: 400;
        .multiple-map-item__icon {
          margin-left: 0.75rem;
          flex: 0 0 auto;
        }
        .multiple-map-item__title {
          margin-left: 0.375rem;
          flex: 1 1 0%;
          overflow: hidden;
          text-overflow: ellipsis;
          width: 0;
          min-width: 0;
        }
        .multiple-map-item__commands {
          margin-left: auto;
          flex: 0 0 auto;
          button {
            padding: 0;
          }
          .multiple-map-item-invalid-icon {
            color: var(--sys-color-warning-dark);
          }
        }
      }
      .multiple-map-item__childList {
        padding: 0 0.5rem 0.5rem 0.5rem;
      }
    }
    .multiple-map-item.active:after {
      border-left: 0.125rem solid ${e.sys.color.primary.main}!important;
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
    }
  `;function da(e){var t,i;const{mapWidgetId:o,itemJson:n,isDataSourceValid:a,showSelectedLayers:r,dndEnabled:l,onMapItemClick:c,onLayerItemClick:d,onLayerReorder:p}=e,[u,h]=s.React.useState(!1),g=s.React.useRef(null),v=(0,m.useTheme)(),{itemKey:f,itemStateTitle:y,itemStateIcon:b,itemStateChecked:S}=n,w=a&&!a(f).isValid,C=w?null===(t=a(f))||void 0===t?void 0:t.invalidMessage:"";return(0,x.jsx)("div",{className:"multiple-map-item-container",css:ca(v),children:(0,x.jsxs)("div",{className:(0,s.classNames)("multiple-map-item",S?"active":""),children:[(0,x.jsxs)("div",{ref:g,role:"button",className:(0,s.classNames)("multiple-map-item__body"),onClick:()=>{c(n,g.current)},tabIndex:0,onKeyDown:e=>{"Space"!==e.code&&"Enter"!==e.code||e.target!==e.currentTarget||c(n,g.current)},children:[b&&(0,x.jsx)(aa,{size:16,icon:b.icon,className:"multiple-map-item__icon"}),(0,x.jsx)("div",{className:"multiple-map-item__title",children:y}),(0,x.jsxs)("div",{className:"multiple-map-item__commands",children:[w&&(0,x.jsx)(O.Tooltip,{title:C,role:"tooltip",children:(0,x.jsx)(O.Button,{icon:!0,variant:"text",className:"multiple-map-item-invalid-icon",children:(0,x.jsx)(aa,{size:16,icon:la()})})}),r&&(null===(i=n.itemChildren)||void 0===i?void 0:i.length)>0&&(0,x.jsx)(O.Button,{icon:!0,variant:"text",onClick:e=>{(e=>{e.stopPropagation(),h(!u)})(e)},children:(0,x.jsx)(aa,{size:16,icon:u?Fe():De()})})]})]}),u&&n.itemChildren&&(0,x.jsx)(H.List,{className:"multiple-map-item__childList",itemsJson:n.itemChildren,dndEnabled:l,onClickItemBody:(e,t)=>{const i=t.dragRef.current.parentNode.parentNode;d(e,t,i)},onUpdateItem:(e,t)=>{if(e.updateType===H.TreeItemActionType.HandleDidDrop){const e=t.props.itemJsons[1];p&&p(`${o}-${f}`,e)}}})]})})}const pa=()=>{const e=[];for(let t=0;t<2;t++)e.push({itemKey:t.toString(),itemStateCommands:[{iconProps:()=>({icon:" ",size:12,style:{opacity:0}})}]});return(0,x.jsx)(H.List,{className:"w-100",itemsJson:e,dndEnabled:!1,handleClickItemBody:()=>null})};const ua=function(e){var t,i;const{mapWidgetId:o,disabled:n,disableSwitchMap:a=!1,onClick:r,onMapItemClick:l,onLayerItemClick:c,sidePopperContent:d,isDataSourceValid:p,showDefaultMapWhenEmpty:u,keepLastTimeMap:h=!1,"aria-describedby":m="",showSelectedLayers:g=!1,selectedJimuLayerViewIds:v,children:f,dndEnabled:y,onLayerReorder:b,emptyWarningMessage:S,getLayerCustomIcon:w,isLayerDisabled:C}=e,j=s.React.useRef(null),I=s.React.useRef(null),[k,T]=s.React.useState(!1),[P,N]=s.React.useState(!1),[M,L]=s.React.useState(""),[D,A]=s.React.useState(null),R=_.MapViewManager.getInstance().getJimuMapViewGroup(o),[E,F]=s.React.useState(!1),B=s.hooks.useTranslation(O.defaultMessages),U=s.ReactRedux.useSelector(e=>{var t,i,s;const n=e.appStateInBuilder;return n&&(null===(s=null===(i=null===(t=null==n?void 0:n.appConfig)||void 0===t?void 0:t.widgets)||void 0===i?void 0:i[o])||void 0===s?void 0:s.useDataSources)}),z=s.ReactRedux.useSelector(e=>{const t=e.appStateInBuilder;return t&&(null==t?void 0:t.dataSourcesInfo)},(e,t)=>{if(U){for(const i of U)if(e&&t&&e[i.dataSourceId]!==t[i.dataSourceId])return!1;return!0}return!0});s.React.useEffect(()=>{if(!E)if(U&&0!==(null==U?void 0:U.length)){let e=0;for(const t of U){const i=null==z?void 0:z[t.dataSourceId];!i||i.instanceStatus!==s.DataSourceStatus.Created&&i.instanceStatus!==s.DataSourceStatus.CreateError||(e++,e===U.length&&F(!0))}}else F(!0)},[E,z,U]);const $=s.React.useCallback(e=>{if(!e)return"";return e.getLabel()||(null==e?void 0:e.getDataSourceJson().sourceLabel)||e.id},[]),V=e=>{const t=[];return e.forEach(e=>{if(t.push(e),e.allLayers){const i=e.allLayers;t.push(...V(i))}e.sublayers&&e.sublayers.length&&t.push(...V(e.sublayers))}),t},W=null===(i=null===(t=null==U?void 0:U.asMutable({deep:!0}))||void 0===t?void 0:t.sort((e,t)=>e.dataSourceId.localeCompare(t.dataSourceId)))||void 0===i?void 0:i.map(e=>{const t=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId);let i=null;const a=`${o}-${e.dataSourceId}`;var r,l;return t?(i={itemStateTitle:$(t),itemStateChecked:e.dataSourceId===D||(r=e.dataSourceId,l=D,!(!l||!r)&&l.includes(r)),itemKey:e.dataSourceId,itemStateDisabled:n,itemStateIcon:{icon:t.type===s.DataSourceTypes.WebScene?On():In()}},g&&(i.itemChildren=(e=>{const t=v[e],i=e.split("-")[1];if(!t||0===t.length)return null;const s=_.MapViewManager.getInstance().getJimuMapViewById(e);if(!s)return null;const o=[],n=V(s.view.map.allLayers),a=s.view.map.tables;for(const r of n.concat(...a)){const n=s.getJimuLayerViewIdByAPILayer(r),a=t.indexOf(n);-1!==a&&(o[a]={itemKey:n,itemStateTitle:null==r?void 0:r.title,itemStateChecked:D===n,itemStateCommands:w&&w(n,e)?[{iconProps:{icon:w(n,e),width:"16px",height:"16px"}}]:[],parent:i})}return o})(a))):i={itemStateTitle:B("none"),itemKey:e.dataSourceId,itemStateDisabled:!0},i}),G=s.React.useCallback(()=>!u||U&&0!==U.length?{itemKey:"root",itemChildren:W}:{itemKey:"root",itemChildren:[{itemStateTitle:B("multipleMapDefaultWebMap"),itemKey:"default",itemStateChecked:"default"===D,itemStateDisabled:n,itemStateIcon:{icon:In()}}]},[W,n,u,B,U,D]),H=(e,t)=>{const i=e;if(p&&!p(i.itemKey).isValid)return;I.current=t,r&&r(i.itemKey),l&&l(i.itemKey);let s="";D===i.itemKey?(s="",T(!1)):(s=i.itemKey,L(i.itemStateTitle),T(!0),N(!1)),A(s),K(s)},J=(e,t,i)=>{const{itemJsons:s}=t.props,n=s[0],a=`${o}-${n.parent}`;if(C&&C(n.itemKey,a))return;I.current=i,c&&c(n.itemKey,a);let r="";D===n.itemKey?(r="",N(!1)):(r=n.itemKey,L(n.itemStateTitle),N(!0),k&&T(!1)),A(r);const l=r?n.parent:"";K(l)},K=e=>{var t;if(a)return;const i=R.getActiveJimuMapView().dataSourceId,n=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig.widgets[o].config.initialMapDataSourceID;""===e?h||i===n||R.switchMap():e!==i&&R.switchMap()};return!G().itemChildren||0===G().itemChildren.length?S&&"string"!=typeof S?S:(0,x.jsx)(O.Alert,{tabIndex:0,className:"w-100",open:!0,text:S||B("customizeLayerWarnings"),type:"warning"}):(0,x.jsx)("div",{ref:j,className:"w-100 multiple-jimu-map-config-component","aria-describedby":m,children:E?(0,x.jsxs)(s.React.Fragment,{children:[G().itemChildren.map(e=>(0,x.jsx)(da,{mapWidgetId:o,itemJson:e,showSelectedLayers:g,onMapItemClick:H,onLayerItemClick:J,dndEnabled:y,onLayerReorder:b,isDataSourceValid:p},e.itemKey)),(0,x.jsx)(Ye,{position:"right",isOpen:k,toggle:()=>{T(!1),A(""),K(""),(0,s.focusElementInKeyboardMode)(null==j?void 0:j.current)},title:M,trigger:null==j?void 0:j.current,backToFocusNode:I.current,children:d}),(0,x.jsx)(Ye,{position:"right",isOpen:P,toggle:()=>{N(!1),A(""),K(""),(0,s.focusElementInKeyboardMode)(null==j?void 0:j.current)},title:M,trigger:null==j?void 0:j.current,backToFocusNode:I.current,children:f})]}):(0,x.jsx)(pa,{})})};var ha,ma;!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(ha||(ha={})),function(e){e.Default="DEFAULT",e.Selected="SELECTED",e.Hover="HOVER"}(ma||(ma={}));var ga=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const va=e=>{const t=window.SVG,{className:i}=e,o=ga(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,x.jsx)(t,Object.assign({className:n,src:la()},o)):(0,x.jsx)("svg",Object.assign({className:n},o))},fa=e=>{const{layout:t,config:i,widgetId:s,status:o,isCardWidget:n,mainSizeMode:a}=e,r=(null==e?void 0:e.layouts)||{},l=(null==r?void 0:r[o])||{},c=(0,S.getAppConfigAction)();Object.keys(l).forEach(e=>{const t=T.searchUtils.findLayoutId(l,e,a);t&&c.removeLayout(t)});const d=ba(i,n,t,o);(null==r?void 0:r[o])&&delete r[o],c.editWidgetConfig(s,d),c.editWidgetProperty(s,"layouts",r),c.exec()},ya=e=>{const{layout:t,config:i,widgetId:o,appConfig:n,status:a,label:r,isCardWidget:l,mainSizeMode:c}=e,d=(null==e?void 0:e.layouts)||{},p=(0,S.getAppConfigAction)(),u=(null==d?void 0:d[ma.Default])||{};Object.keys(u).forEach(e=>{var t;const i=null===(t=n.widgets[o].layouts[a])||void 0===t?void 0:t[e];i&&p.removeLayout(i);const l=T.searchUtils.findLayoutId(d[ma.Default],e,c),u=p.duplicateLayout(l,!1);p.editLayoutProperty(u.id,"label",r),p.editWidgetProperty(o,`layouts.${a}.${e}`,u.id),p.editLayoutProperty(u.id,"parent",{type:s.LayoutParentType.Widget,id:o})});const h=ba(i,l,t,a);p.editWidgetConfig(o,h),p.exec()};function ba(e,t,i,s){let o=e;return o=t?e.set("cardLayout",i):e.setIn(["cardConfigs",s,"listLayout"],i),o}const Sa=s.css`
  .jimu-radio {
    cursor: pointer;
  }
  .clear-padding {
    padding-left: 0;
    padding-right: 0;
  }
`,xa=s.css`
  & .modal-content {
    border: none;
  }
  .header-con {
    & {
      border: none;
      padding: ${s.polished.rem(30)};
      padding-bottom: 0;
    }
    svg {
      color: var(--sys-color-warning-main);
      border-bottom: none;
      margin-right: ${s.polished.rem(12)} !important;
    }
  }
  .modal-body {
    padding: ${s.polished.rem(24)} ${s.polished.rem(30)};
  }
  .modal-footer {
    & {
      padding: ${s.polished.rem(30)};
      padding-top: 0;
    }
  }
`,wa=e=>{const{id:t,cardLayout:i,status:o,isCardWidget:n,layouts:a,mainSizeMode:r,config:l,appConfig:c}=e,[d,p]=(0,xn.useState)(!1),[u,h]=(0,xn.useState)(null),[m,g]=(0,xn.useState)(null),[v,f]=(0,xn.useState)(null),y=s.React.useRef(i),b=s.React.useRef(i),S=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages);(0,xn.useEffect)(()=>{y.current=e.cardLayout,b.current=e.cardLayout},[o,e.cardLayout]);const w=()=>{p(!d),y.current=b.current},C=s.React.useCallback(()=>{const e={layout:y.current,config:l,widgetId:t,appConfig:c,status:o,label:S(o.toLowerCase()),isCardWidget:n,layouts:null==a?void 0:a.asMutable({deep:!0}),mainSizeMode:r};y.current===ha.AUTO?fa(e):ya(e),p(!1),b.current=y.current},[l,t,c,o,n,a,r,S]),I=e=>{b.current!==e&&(e===ha.AUTO?(h(S("remindAutoLayoutTitle")),g(S("remindAutoLayoutText")),f("")):(h(S("remindCustomLayoutTitle")),g(S("remindCustomLayoutText")),f(S("remindCustomLayoutBottomText"))),p(!0),y.current=e)};return(0,x.jsx)("div",{css:Sa,role:"group","aria-label":S("layout"),children:(0,x.jsxs)(j,{className:"clear-padding",title:S("layout"),children:[(0,x.jsx)(k,{flow:"wrap",children:(0,x.jsxs)("div",{className:"d-flex align-items-center",onClick:()=>{I(ha.AUTO)},children:[(0,x.jsx)(O.Radio,{title:S("auto"),checked:i===ha.AUTO,className:"mr-2"})," ",S("auto")]})}),(0,x.jsx)(k,{children:(0,x.jsxs)("div",{className:"d-flex align-items-center",onClick:()=>{I(ha.CUSTOM)},children:[(0,x.jsx)(O.Radio,{title:S("custom"),checked:i===ha.CUSTOM||!i,className:"mr-2"})," ",S("custom")]})}),(0,x.jsxs)(O.Modal,{isOpen:d,toggle:w,centered:!0,css:xa,children:[(0,x.jsxs)(O.ModalHeader,{className:"header-con",children:[(0,x.jsx)(va,{className:"mr-2",size:24}),u]}),(0,x.jsxs)(O.ModalBody,{children:[(0,x.jsx)("div",{children:m}),v&&(0,x.jsx)("div",{className:"mt-5",children:v})]}),(0,x.jsxs)(O.ModalFooter,{children:[(0,x.jsx)(O.Button,{title:S("ok"),type:"primary",onClick:C,children:S("ok")}),(0,x.jsx)(O.Button,{title:S("cancel"),onClick:()=>{p(!1)},children:S("cancel")})]})]})]})})};function Ca(e){var t;const{mapViewId:i,isCustomizeEnabled:o,isShowRuntimeAddedLayerEnabled:n,selectedValues:a,showTable:r=!0,onToggleCustomize:l,onShowRuntimeAddedLayersChange:c,onSelectedLayerIdChange:d,showRuntimeAddedLayerOption:p=!0,extraSettingOptions:u,hideLayers:h,disableLayers:m,isJlvLoading:g=!1}=e,v=s.hooks.useTranslation(O.defaultMessages,s.defaultMessages);return(0,x.jsxs)("div",{className:"w-100 h-100 layer-item-panel",children:[(0,x.jsxs)(j,{children:[g&&(0,x.jsx)(O.Loading,{type:O.LoadingType.Secondary}),(0,x.jsx)(k,{tag:"label",label:v("customizeLayers"),children:(0,x.jsx)(O.Switch,{className:"can-x-switch",checked:o,"data-key":"customizeLayers",onChange:e=>{(e=>{const t=Ia(i,r);l(e,t)})(e.target.checked)}})}),o&&p&&(0,x.jsx)(k,{tag:"label",label:v("showRuntimeAddedLayers"),children:(0,x.jsx)(O.Switch,{className:"can-x-switch",checked:n,"data-key":"showRuntimeAddedLayers",onChange:e=>{c(e.target.checked)}})}),o&&u]}),o&&(0,x.jsx)(j,{children:(0,x.jsx)(k,{children:(0,x.jsx)(te,{jimuMapViewId:i,onChange:d,isMultiSelection:!0,selectedValues:null===(t=a[i])||void 0===t?void 0:t.asMutable(),isShowTables:r,hideLayers:h,disableLayers:m},i)})})]})}function ja(e){const{mapWidgetId:t,onMapItemClick:i,onLayerItemClick:s,mapViewId:o,isCustomizeEnabled:n,isShowRuntimeAddedLayerEnabled:a,showTable:r,disableSwitchMap:l,onToggleCustomize:c,onShowRuntimeAddedLayersChange:d,onSelectedLayerIdChange:p,selectedValues:u,showSelectedLayers:h=!1,children:m,dndEnabled:g=!1,onLayerReorder:v,extraSettingOptions:f,showRuntimeAddedLayerOption:y,hideLayers:b,disableLayers:S,emptyWarningMessage:w,isDataSourceValid:C,getLayerCustomIcon:j,isJlvLoading:I=!1,isLayerDisabled:k}=e;return(0,x.jsx)(ua,{mapWidgetId:t,onLayerItemClick:s,onMapItemClick:i,showSelectedLayers:h,selectedJimuLayerViewIds:u,dndEnabled:g,onLayerReorder:v,emptyWarningMessage:w,isDataSourceValid:C,disableSwitchMap:l,getLayerCustomIcon:j,isLayerDisabled:k,sidePopperContent:(0,x.jsx)(Ca,{mapViewId:o,isCustomizeEnabled:n,isShowRuntimeAddedLayerEnabled:a,showTable:r,onToggleCustomize:c,onShowRuntimeAddedLayersChange:d,onSelectedLayerIdChange:p,selectedValues:u,extraSettingOptions:f,showRuntimeAddedLayerOption:y,hideLayers:b,disableLayers:S,isJlvLoading:I},o),children:m})}function Ia(e,t){const i=_.MapViewManager.getInstance().getJimuMapViewById(e);if(!i)return[];let s=Object.keys((null==i?void 0:i.jimuLayerViews)||{}).filter(e=>!i.jimuLayerViews[e].fromRuntime);return t&&(s=s.concat(...Object.keys(null==i?void 0:i.jimuTables))),s}function ka(e,t){var i,o,n;const a=function(e){const t=[],i=Oa(e),o=null==i?void 0:i.useMapWidgetIds,n={};(null==o?void 0:o.length)>0&&o.forEach(e=>{if(e){const i=Oa(e),s=null==i?void 0:i.useDataSources;s&&s.forEach(e=>{var i;const s=null===(i=null==e?void 0:e.asMutable)||void 0===i?void 0:i.call(e,{deep:!0});s&&s.dataSourceId&&!n[s.dataSourceId]&&(n[s.dataSourceId]=!0,t.push(s))})}});return(0,s.Immutable)(t)}(e),r=function(e,t){const i=function(e,t){var i,o,n,a;const r=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig,l=null===(n=null==r?void 0:r.widgets)||void 0===n?void 0:n[e],c=null===(a=null==l?void 0:l.manifest)||void 0===a?void 0:a.publishMessages;let d=null;return c.forEach(e=>{const i=e;(null==i?void 0:i.messageCarryData)&&(null==i?void 0:i.messageType)===t&&(d=null==i?void 0:i.messageCarryData)}),d}(e,t);return i||s.MessageCarryData.UseDataSource}(e,t),l=null===(o=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===o?void 0:o.appConfig,c=null===(n=null==l?void 0:l.widgets)||void 0===n?void 0:n[e];let d=(null==c?void 0:c.useDataSources)?null==c?void 0:c.useDataSources:a;d=d||(0,s.Immutable)([]);const p=function(e){var t;const i=null!==(t=null==e?void 0:e.map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null})))&&void 0!==t?t:[];return(0,s.Immutable)(i)}(null==c?void 0:c.outputDataSources)||(0,s.Immutable)([]),u=null==d?void 0:d.asMutable({deep:!0}).concat(null==p?void 0:p.asMutable({deep:!0}));switch(r){case s.MessageCarryData.OutputDataSource:return p;case s.MessageCarryData.UseDataSource:return d;case s.MessageCarryData.BothDataSource:return(0,s.Immutable)(u)}}function Oa(e){var t;if(!e)return null;const i=function(){var e,t,i;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appConfig}();return null===(t=null==i?void 0:i.widgets)||void 0===t?void 0:t[e]}var Ta=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Pa=s.React.memo(e=>{const{messageWidgetId:t,messageType:i,clearInvalid:o=!0,defaultSelectAll:n=!0,types:a,useDataSources:r=(0,s.Immutable)([]),onChange:l}=e,c=Ta(e,["messageWidgetId","messageType","clearInvalid","defaultSelectAll","types","useDataSources","onChange"]),{fromRootDsIds:d,fromDsIds:p,allUseDataSources:u}=s.React.useMemo(()=>{let e=(0,s.Immutable)([]),o=(0,s.Immutable)([]),n=(0,s.Immutable)([]);const r=s.DataSourceManager.getInstance();return(ka(t,i)||(0,s.Immutable)([])).forEach(t=>{const i=r.getDataSource(t.dataSourceId);if(i)if(i.type===s.DataSourceTypes.WebMap||i.type===s.DataSourceTypes.WebScene){const o=i;e=e.concat([t.dataSourceId]);const r=o.getAllChildDataSources().filter(e=>a.includes(e.type)).map(e=>s.dataSourceUtils.getUseDataSourceByDataSource(e));n=n.concat(r)}else o=o.concat([i.isDataView?i.getMainDataSource().id:i.id]),n=n.concat(t)}),{fromRootDsIds:e.length>0?e:void 0,fromDsIds:0===e.length?o:void 0,allUseDataSources:n}},[a,i,t]),h=s.hooks.useLatest(r);return s.React.useEffect(()=>{const e=(null==u?void 0:u.map(e=>e.mainDataSourceId))||[],t=h.current.filter(t=>e.includes(t.dataSourceId)||e.includes(t.mainDataSourceId)||e.includes(t.rootDataSourceId));o&&t.length<h.current.length&&l(t.asMutable({deep:!0}))},[u,o,l,h]),s.React.useEffect(()=>{n&&0===h.current.length&&l(u.asMutable({deep:!0}))},[u,n,l,h]),(0,x.jsx)(lt.DataSourceSelector,Object.assign({types:a,useDataSources:r,fromRootDsIds:d,fromDsIds:p,onChange:l,mustUseDataSource:!0,isMultiple:!0,isMultipleDataView:!0,hideAddDataButton:!0,hideDataView:!0,hideTypeDropdown:!0,enableToSelectOutputDsFromSelf:!0},c))});function Na(e){var t,i;const o=(0,s.getAppStore)().getState().appStateInBuilder,n=o.appRuntimeInfo.currentPageId,a=o.appRuntimeInfo.currentDialogId;let r=o.appRuntimeInfo.dialogInfos||(0,s.Immutable)({});const l=o.appConfig.dialogs,c=o.appConfig.pages,d={canClose:!0,checked:!0,isClosed:!0};return a&&((null===(t=l[a])||void 0===t?void 0:t.isSplash)&&(r=r.set(a,d)),c[n].autoOpenDialogId&&(r=r.set(n+"-"+c[n].autoOpenDialogId,d)),e&&Object.keys(c).forEach(e=>{c[e].autoOpenDialogId===a&&(r=r.set(e+"-"+a,d))})),(null===(i=l[a])||void 0===i?void 0:i.isSplash)||Object.keys(l).some(e=>{l[e].isSplash&&(r=r.set(e,d))}),e&&r&&Object.keys(r).forEach(t=>{t!==e&&t!==n+"-"+e||(r=r.set(t,{canClose:Ma(e),checked:!1,isClosed:!1}))}),r}function Ma(e){const t=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.dialogs[e];return!t.interactionType||!t.confirmBeforeClose}function La(e){const t=(0,s.getAppStore)().getState().appStateInBuilder,i=t.appRuntimeInfo.currentPageId,o=t.appRuntimeInfo.currentDialogId;if(S.builderAppSync.publishChangeSelectionToApp(null),o){const e=Na();S.builderAppSync.publishDialogInfosChangeToApp(e),S.builderAppSync.publishDialogChangeToApp(null)}i!==e&&S.builderAppSync.publishPageChangeToApp(e),S.builderAppSync.publishActivePagePartChangeToApp(s.PagePart.Body)}function Da(e,t=!1){S.builderAppSync.publishChangeSelectionToApp(null);const i=(0,s.getAppStore)().getState().appStateInBuilder.appRuntimeInfo.currentDialogId;if(t||e!==i){S.builderAppSync.publishDialogChangeToApp(e);const t=Na(e);S.builderAppSync.publishDialogInfosChangeToApp(t),S.builderAppSync.publishActivePagePartChangeToApp(null)}}(0,m.registerStyles)("jimu-ui/advanced/setting-components/",e)})(),f})())}}});