System.register(["jimu-core","jimu-core/emotion","jimu-for-builder","jimu-theme","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/sql-expression-runtime"],function(e,t){var a={},o={},s={},i={},n={},r={},l={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageActionConnectionType=e.MessageActionConnectionType,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.ReactRedux=e.ReactRedux,a.SqlExpressionMode=e.SqlExpressionMode,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.moduleLoader=e.moduleLoader,a.polished=e.polished,a.version=e.version},function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){s.AppMessageManager=e.AppMessageManager,s.defaultMessages=e.defaultMessages},function(e){i.withTheme=e.withTheme},function(e){n.Label=e.Label,n.Radio=e.Radio,n.Select=e.Select},function(e){r.MessageActionDataSelector=e.MessageActionDataSelector,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){l.getJimuFieldNamesBySqlExpression=e.getJimuFieldNamesBySqlExpression}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=i},4108:e=>{"use strict";e.exports=s},5037:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 40"><path fill="#A8A8A8" fill-rule="evenodd" d="M6 30v10H0v-1h5v-9zM3.162 18.582a.5.5 0 0 1 0 .71l-1.416 1.421a2.497 2.497 0 0 0-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 0 1 .712.713L6 24.968a3.5 3.5 0 0 1-4.967 0 3.5 3.5 0 0 1 0-4.967l1.416-1.422a.504.504 0 0 1 .713.003m4.967-.71a.5.5 0 0 1 0 .71L4.58 22.129a.504.504 0 0 1-.713-.712l3.548-3.548a.504.504 0 0 1 .713.003m2.838-2.838a3.5 3.5 0 0 1 0 4.967l-1.42 1.419a.504.504 0 0 1-.713-.712l1.423-1.417a2.5 2.5 0 0 0 0-3.547 2.5 2.5 0 0 0-3.547 0l-1.42 1.419a.504.504 0 0 1-.713-.712l1.42-1.42a3.506 3.506 0 0 1 4.97.003M6 0v10H5V1H0V0z"></path></svg>'},14321:e=>{"use strict";e.exports=n},67386:e=>{"use strict";e.exports=o},76117:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=r}},t={};function c(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";c.r(u),c.d(u,{ChangeSectionViewActionSetting:()=>N,ChooseConnectionType:()=>i,FilterDataRecordActionSetting:()=>R,SelectDataRecordActionSetting:()=>B,messageActionUtils:()=>e});var e={};c.r(e),c.d(e,{getAppConfig:()=>v,getDsByWidgetId:()=>d,getDsIdsByWidgetId:()=>l,getMapUseDataSourcesByUseMapWidgetIds:()=>D,getMessageCarryData:()=>p,getMessageCarryDataByWidgetId:()=>g,getNewActionItem:()=>h,getNewMessage:()=>r,getWidgetJson:()=>f,initOutputDataSources:()=>S});var t=c(67386),a=c(79244),o=c(14321),s=c(4108);const i=e=>{const{messageDataSource:i,actionDataSource:n,connectionType:r,onUseLayersRelationship:l,onSetCustomFields:c}=e,[u,d]=a.React.useState(!1),p=a.hooks.useLatest(r);a.React.useEffect(()=>{if(!i||!n)return;const e=a.dataSourceUtils.getMainOriginDataSource(i),t=a.dataSourceUtils.getMainOriginDataSource(n),o=()=>{p.current===a.MessageActionConnectionType.UseLayersRelationship&&c()};(null==e?void 0:e.createRelatedDataSources)?e.createRelatedDataSources().then((e=[])=>{e.includes(t)?d(!0):(d(!1),o())}):(d(!1),o())},[i,n,p,c]),a.React.useEffect(()=>{p.current||(u?l():c())},[u,p,c,l]);const g=a.hooks.useTranslation(s.defaultMessages);return u?(0,t.jsxs)(a.React.Fragment,{children:[(0,t.jsxs)(o.Label,{className:"justify-content-start",onClick:l,children:[(0,t.jsx)(o.Radio,{className:"mr-2",role:"radio",checked:r===a.MessageActionConnectionType.UseLayersRelationship}),g("frameworkAction_UseRelationship")]}),(0,t.jsxs)(o.Label,{className:"mt-3 justify-content-start",onClick:c,children:[(0,t.jsx)(o.Radio,{className:"mr-2",role:"radio",checked:!r||r===a.MessageActionConnectionType.SetCustomFields}),g("frameworkAction_CustomFields")]})]}):null};var n=c(1888);const r=(e,t)=>({id:a.appConfigUtils.getUniqueId("messageConfig"),widgetId:t,messageType:e,actions:[]});function l(e,t){var o;const s=d(e,t);return(0,a.Immutable)(null!==(o=null==s?void 0:s.map(e=>null==e?void 0:e.mainDataSourceId))&&void 0!==o?o:[])}function d(e,t){var o,s,i;const n=D(e),r=p(e,t),l=null===(s=null===(o=(0,a.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===s?void 0:s.appConfig,c=null===(i=null==l?void 0:l.widgets)||void 0===i?void 0:i[e];let u=(null==c?void 0:c.useDataSources)?null==c?void 0:c.useDataSources:n;u=u||(0,a.Immutable)([]);const d=S(null==c?void 0:c.outputDataSources)||(0,a.Immutable)([]),g=null==u?void 0:u.asMutable({deep:!0}).concat(null==d?void 0:d.asMutable({deep:!0}));switch(r){case a.MessageCarryData.OutputDataSource:return d;case a.MessageCarryData.UseDataSource:return u;case a.MessageCarryData.BothDataSource:return(0,a.Immutable)(g)}}function p(e,t){const o=g(e,t);return o||a.MessageCarryData.UseDataSource}function g(e,t){var o,s,i,n;const r=null===(s=null===(o=(0,a.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===s?void 0:s.appConfig,l=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[e],c=null===(n=null==l?void 0:l.manifest)||void 0===n?void 0:n.publishMessages;let u=null;return c.forEach(e=>{const a=e;(null==a?void 0:a.messageCarryData)&&(null==a?void 0:a.messageType)===t&&(u=null==a?void 0:a.messageCarryData)}),u}function S(e){var t;const o=null!==(t=null==e?void 0:e.map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null})))&&void 0!==t?t:[];return(0,a.Immutable)(o)}const h=(e,t,o,s)=>{const i=null!=e.views;let n;e.id,n=!i&&e.id?(0,a.getAppStore)().getState().appStateInBuilder?(0,a.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e.id].manifest.version:null:a.version;let r=m(t,s,o)?null:void 0;if("function"==typeof t.getDefaultMessageActionConfig){const e={widgetId:o,type:s};r=t.getDefaultMessageActionConfig(e)}return{actionId:t.id+"-"+(new Date).getTime().toString(),widgetId:i?null:e.id,sectionId:i?e.id:null,messageWidgetId:o,actionName:t.name,description:null,config:r,version:n}},m=(e,t,a)=>!!s.AppMessageManager.getInstance().getActionSettingComponentUri(e,t,a);function D(e){const t=[],o=f(e),s=null==o?void 0:o.useMapWidgetIds,i={};return(null==s?void 0:s.length)>0&&s.forEach(e=>{if(e){const a=f(e),o=null==a?void 0:a.useDataSources;o&&o.forEach(e=>{var a;const o=null===(a=null==e?void 0:e.asMutable)||void 0===a?void 0:a.call(e,{deep:!0});o&&o.dataSourceId&&!i[o.dataSourceId]&&(i[o.dataSourceId]=!0,t.push(o))})}}),(0,a.Immutable)(t)}function f(e){var t;if(!e)return null;const a=v();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function v(){var e,t,o;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,a.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(o=(0,a.getAppStore)().getState())||void 0===o?void 0:o.appConfig}var y=c(76117);function I(e){var t,o,s;const{widgetId:i,useDataSource:n,messageType:r,arcGISDataSourceTypes:c}=e,u=null===(o=null===(t=(0,a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,d=null===(s=null==u?void 0:u.widgets)||void 0===s?void 0:s[i],g=function(e,t){var o,s,i;const n=null===(s=null===(o=(0,a.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===s?void 0:s.appConfig,r=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e],l=[],c=a.DataSourceManager.getInstance(),u=D(e),d=(null==r?void 0:r.useDataSources)?null==r?void 0:r.useDataSources:u;return null==d||d.forEach(e=>{const a=c.getDataSource(e.dataSourceId);(null==a?void 0:a.type)!==t.WebMap&&(null==a?void 0:a.type)!==t.WebScene||l.push(e.dataSourceId)}),l.length>0?(0,a.Immutable)(l):null}(i,c),S=function(e,t,o){const s=(null==e?void 0:e.outputDataSources)||[],i=(null==e?void 0:e.useDataSources)||[];if(o)return!1;switch(t){case a.MessageCarryData.OutputDataSource:return 1===(null==s?void 0:s.length);case a.MessageCarryData.UseDataSource:return 1===(null==i?void 0:i.length);case a.MessageCarryData.BothDataSource:return 1===s.length+i.length}}(d,p(i,r),g);return{isReadOnly:S,useDataSources:n&&n.dataSourceId?(0,a.Immutable)([n.asMutable({deep:!0})]):null,fromRootDsIds:g,fromDsIds:g?null:l(i,r)}}function x(e){var t,o,s,i,n,r,l,c,u,p,g,S,h,m,f,v,y,I;const{widgetId:x,oldUseDataSource:w,messageType:b,arcGISDataSourceTypes:C}=e,A=(0,a.getAppStore)().getState().appStateInBuilder.appConfig,j=a.DataSourceManager.getInstance(),U=A.widgets[x],T=D(x),M=(null==U?void 0:U.useDataSources)?null==U?void 0:U.useDataSources:T;let E=null,L=!1;const k=null===(o=null===(t=j.getDataSource(w.dataSourceId))||void 0===t?void 0:t.getDataSourceJson())||void 0===o?void 0:o.isOutputFromWidget,R=d(x,b),q=(null==R?void 0:R[0])&&(null===(s=null==R?void 0:R[0])||void 0===s?void 0:s.dataSourceId);if(!q)return null;const B=null===(i=j.getDataSource(q))||void 0===i?void 0:i.getDataSourceJson();if(!B||B.type!==C.WebMap&&B.type!==C.WebScene||(L=!0),L){let e=!1;if(U&&M)for(let t=0;t<M.length;t++)if(M[t].dataSourceId===w.rootDataSourceId){e=!0;break}E=e?w:null}else{let e=!1;if(R)for(let t=0;t<(null==R?void 0:R.length);t++){const o=k?null===(r=null===(n=j.getDataSource(w.dataSourceId))||void 0===n?void 0:n.getMainDataSource())||void 0===r?void 0:r.id:w.dataSourceId,s=k?null===(u=null===(c=j.getDataSource(null===(l=null==R?void 0:R[t])||void 0===l?void 0:l.dataSourceId))||void 0===c?void 0:c.getMainDataSource())||void 0===u?void 0:u.id:null===(p=null==R?void 0:R[t])||void 0===p?void 0:p.mainDataSourceId,i=k?null===(h=null===(S=j.getDataSource(null===(g=null==R?void 0:R[t])||void 0===g?void 0:g.dataSourceId))||void 0===S?void 0:S.getMainDataSource())||void 0===h?void 0:h.id:null===(m=null==R?void 0:R[t])||void 0===m?void 0:m.dataSourceId;let d=i===o;if(b===a.MessageType.DataRecordsSelectionChange&&i!==o&&(d=o===s),d){e=!0;break}}E=e?w:1===(null==R?void 0:R.length)?(0,a.Immutable)({dataSourceId:null===(f=null==R?void 0:R[0])||void 0===f?void 0:f.dataSourceId,mainDataSourceId:null===(v=null==R?void 0:R[0])||void 0===v?void 0:v.mainDataSourceId,dataViewId:null===(y=null==R?void 0:R[0])||void 0===y?void 0:y.dataViewId,rootDataSourceId:null===(I=null==R?void 0:R[0])||void 0===I?void 0:I.rootDataSourceId}):null}return E}function w(e){return!(!e.messageUseDataSource||!e.actionUseDataSource)&&!(e.messageUseDataSource.mainDataSourceId!==e.actionUseDataSource.mainDataSourceId||!function(e){return!e.messageUseDataSource.rootDataSourceId&&!e.actionUseDataSource.rootDataSourceId||e.messageUseDataSource.rootDataSourceId===e.actionUseDataSource.rootDataSourceId}(e))}function b(e){let t;return t=Array.isArray(e)?U(e):j(e),t}function C(e,t){var o,s,i;const n=a.DataSourceManager.getInstance();if(t){const a=null==t?void 0:t.dataSourceId,r=null==t?void 0:t.rootDataSourceId,l=(null===(o=n.getDataSource(a))||void 0===o?void 0:o.getDataSourceJson())||(null===(s=n.getDataSource(r))||void 0===s?void 0:s.getDataSourceJson()),c=(null===(i=null==e?void 0:e.filter(e=>e.dataSourceId===a))||void 0===i?void 0:i.length)>0;return l&&c?t:null}return null}function A(e,t){let a=!1,o=e,s=null==e?void 0:e.actionUseDataSource;return s&&(s=C(t,s),s||(a=!0,o=o.set("actionUseDataSource",null))),{isConfigChange:a,newActionConfig:o}}const j=e=>{var t;const o=null==e?void 0:e.asMutable({deep:!0});let s=[];const i=null==o?void 0:o.actionUseDataSource,n=null==o?void 0:o.messageUseDataSource;if(n&&s.push(n),i){const e=(null==o?void 0:o.sqlExprObj)||null,r=(0,y.getJimuFieldNamesBySqlExpression)((0,a.Immutable)(e))||[],l=(null==i?void 0:i.fields)||[];let c=(0,a.Immutable)(i).set("fields",Array.from(new Set(l.concat(r))));(null==n?void 0:n.dataSourceId)===i.dataSourceId&&(s=[],(null===(t=null==n?void 0:n.fields)||void 0===t?void 0:t.length)>0&&(c=c.set("fields",Array.from(new Set(c.fields.concat(n.fields)))))),s.push(null==c?void 0:c.asMutable({deep:!0}))}return s},U=e=>{const t=null==e?void 0:e.asMutable({deep:!0}),o={};return t.forEach(e=>{j((0,a.Immutable)(e)).forEach(e=>{if(null==o?void 0:o[e.dataSourceId]){let t=o[e.dataSourceId].fields||[];t=t.concat((null==e?void 0:e.fields)||[]),t=Array.from(new Set(t)),o[e.dataSourceId].fields=t}else o[e.dataSourceId]=e})}),Object.keys(o).map(e=>o[e])};var T=c(5037),M=c.n(T),E=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(a[o[s]]=e[o[s]])}return a};const L=e=>{const o=window.SVG,{className:s}=e,i=E(e,["className"]),n=(0,a.classNames)("jimu-icon jimu-icon-component",s);return o?(0,t.jsx)(o,Object.assign({className:n,src:M()},i)):(0,t.jsx)("svg",Object.assign({className:n},i))};class k extends a.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,o,s,i;const{messageWidgetId:n,messageType:r,config:l}=this.props,c=a.DataSourceManager.getInstance();let u=null,p=!0;const g=this.getMessageUseDataSource();if(g)u=x({widgetId:n,oldUseDataSource:g,messageType:r,arcGISDataSourceTypes:a.DataSourceTypes});else{const l=d(n,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const n=null===(e=c.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();u=!n||n.type!==a.DataSourceTypes.WebMap&&n.type!==a.DataSourceTypes.WebScene?(0,a.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(o=null==l?void 0:l[0])||void 0===o?void 0:o.mainDataSourceId,dataViewId:null===(s=null==l?void 0:l[0])||void 0===s?void 0:s.dataViewId,rootDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.rootDataSourceId}):null}}const S=Array.isArray(l)?null==l?void 0:l[0]:l;if(void 0!==(null==S?void 0:S.enableQueryWithCurrentExtent)&&(p=S.enableQueryWithCurrentExtent),r===a.MessageType.ExtentChange){if(Array.isArray(l))return null==l?void 0:l.map(e=>this.getInitActionConfigItem(u,p,e));return[l?this.getInitActionConfigItem(u,p,l):this.getInitActionConfigItem(u,p,null)]}return this.getInitActionConfigItem(u,p,l)},this.getInitActionConfigItem=(e,t,a)=>{const{useDataSources:o}=this.props,s=C(o,null==a?void 0:a.actionUseDataSource);return{messageUseDataSource:e,actionUseDataSource:s,sqlExprObj:(null==s?void 0:s.dataSourceId)?a.sqlExprObj:null,enableQueryWithCurrentExtent:t}},this.onSettingChange=e=>{const t=b(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{let t=this.props.config;Array.isArray(t)?t=null==t?void 0:t.map(t=>t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null)):(t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null),0===e.length&&(t=t.set("connectionType",null))),this.onSettingChange(t)},this.handleActionLayerChange=e=>{let t=this.props.config;if(Array.isArray(t)){const o={messageUseDataSource:this.getMessageUseDataSource(),actionUseDataSource:null,sqlExprObj:null,enableQueryWithCurrentExtent:!0,enabledDataRelationShip:!0};if(0===(null==e?void 0:e.length))t=(0,a.Immutable)([o]);else{const s=null==e?void 0:e.map(e=>Object.assign(Object.assign({},o),{actionUseDataSource:e}));t=(0,a.Immutable)(s)}}else t=t.set("actionUseDataSource",(null==e?void 0:e[0])||null).set("sqlExprObj",null),0===e.length&&(t=t.set("connectionType",null));this.onSettingChange(t)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{this.handleActionConditionsChange("sqlExprObj",e)},this.handleActionConditionsChange=(e,t)=>{const{config:o}=this.props;let s=o;if(Array.isArray(o)&&1===(null==o?void 0:o.length)){const o=s[0].set(e,t);s=(0,a.Immutable)([o])}else s=o.set(e,t);this.onSettingChange(s)},this.onMessageFieldSelected=(e,t)=>{const{config:a}=this.props,o=a.set("messageUseDataSource",{dataSourceId:a.messageUseDataSource.dataSourceId,mainDataSourceId:a.messageUseDataSource.mainDataSourceId,dataViewId:a.messageUseDataSource.dataViewId,rootDataSourceId:a.messageUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)});this.onSettingChange(o)},this.onActionFieldSelected=(e,t)=>{const{config:a}=this.props,o=a.set("actionUseDataSource",{dataSourceId:a.actionUseDataSource.dataSourceId,mainDataSourceId:a.actionUseDataSource.mainDataSourceId,dataViewId:a.actionUseDataSource.dataViewId,rootDataSourceId:a.actionUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)});this.onSettingChange(o)},this.switchEnabledDataRelationShip=e=>{this.onSettingChange(this.props.config.set("enabledDataRelationShip",e))},this.switchEnabledQueryWithCurrentExtent=e=>{this.handleActionConditionsChange("enableQueryWithCurrentExtent",e)},this.checkIsDisableDataView=e=>{var t,o,s,i;if(this.props.messageType===a.MessageType.DataRecordsSelectionChange)return!0;const n=null===(o=null===(t=(0,a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,r=null===(s=null==n?void 0:n.widgets)||void 0===s?void 0:s[e];if(r){return"Map"===(null===(i=null==r?void 0:r.manifest)||void 0===i?void 0:i.label)}return!1},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",a.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",a.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.checkIsShowFrameworkActionConditions=()=>{var e;return!(window.isExpressBuilder||!(null===(e=this.props.config)||void 0===e?void 0:e.actionUseDataSource)||!this.props.config.messageUseDataSource||Array.isArray(this.props.config))},this.getMessageUseDataSource=()=>{var e;const{config:t}=this.props;return Array.isArray(t)?null===(e=t[0])||void 0===e?void 0:e.messageUseDataSource:null==t?void 0:t.messageUseDataSource},this.checkIsNotRenderActionSetting=()=>{const{Button:e,Icon:t,Switch:a,Collapse:o,SettingSection:s,SettingRow:i,FieldSelector:n,DataSourceSelector:r,SqlExpressionBuilderPopup:l}=this.state;return!(e&&t&&a&&o&&s&&i&&n&&r&&l)},this.nls=e=>{const t=Object.assign({},s.defaultMessages,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:t[e]})},this.renderFrameworkActionConditions=()=>{var e,o;const{Button:s,Switch:n,Collapse:r,SettingSection:l,SettingRow:c,FieldSelector:u,SqlExpressionBuilderPopup:d,Label:p}=this.state,{config:g,theme:S}=this.props,h=g.messageUseDataSource&&a.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),m=g.actionUseDataSource&&a.DataSourceManager.getInstance().getDataSource(g.actionUseDataSource.dataSourceId),D=w(g),f=!g.connectionType||g.connectionType===a.MessageActionConnectionType.SetCustomFields;return(0,t.jsxs)(l,{title:this.nls("frameworkAction_Conditions"),"aria-label":this.nls("frameworkAction_Conditions"),role:"group",children:[(0,t.jsx)(c,{children:(0,t.jsxs)(p,{check:!0,className:"d-flex align-items-center w-100",children:[(0,t.jsx)("div",{className:"flex-grow-1",children:this.nls("frameworkAction_RelateMessage")}),(0,t.jsx)(n,{"aria-describedby":"frameworkAction_AutoBind",checked:this.props.config.enabledDataRelationShip,"aria-label":this.nls("frameworkAction_RelateMessage"),onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)}})]})}),(0,t.jsx)(c,{children:(0,t.jsxs)(r,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100",children:[(0,t.jsx)(i,{messageDataSource:h,actionDataSource:m,connectionType:g.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),D&&(0,t.jsx)("div",{className:"w-100 border p-1 mr-2",id:"frameworkAction_AutoBind",children:this.nls("frameworkAction_AutoBind")}),!D&&f&&(0,t.jsxs)("div",{className:"w-100 d-flex align-items-center mt-3",children:[(0,t.jsxs)("div",{className:"d-flex flex-column relate-panel-left",children:[(0,t.jsx)(u,{className:"w-100 jimu-outline-inside",useDataSources:(0,a.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.nls("frameworkAction_TriggerLayerField"),"aria-label":this.nls("frameworkAction_TriggerLayerField"),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,a.Immutable)([])}),(0,t.jsx)(u,{className:"w-100 action-select-chooser jimu-outline-inside",placeholder:this.nls("frameworkAction_ActionLayerField"),"aria-label":this.nls("frameworkAction_ActionLayerField"),useDataSources:(0,a.Immutable)([null===(o=this.props.config.actionUseDataSource)||void 0===o?void 0:o.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,a.Immutable)([])})]}),(0,t.jsx)(L,{autoFlip:!0,className:"flex-none",width:12,height:40,color:S.ref.palette.neutral[900]})]})]})}),(0,t.jsxs)(c,{children:[(0,t.jsx)(s,{type:"link",disabled:!this.props.config.actionUseDataSource,"aria-describedby":"frameworkAction_SetExpression",className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup,children:(0,t.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"},children:this.nls("frameworkAction_MoreConditions")})}),this.props.config.actionUseDataSource&&(0,t.jsx)(a.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource,children:e=>(0,t.jsx)(d,{dataSource:e,mode:a.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})})]}),(0,t.jsx)(c,{children:(0,t.jsx)("div",{className:"sql-expr-display",id:"frameworkAction_SetExpression",children:this.props.config.sqlExprObj&&m?a.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,m).displaySQL:this.nls("frameworkAction_SetExpression")})})]})},this.renderFrameworkConditionsWhenQueryByExtent=()=>{const{Button:e,Switch:o,SettingSection:s,SettingRow:i,SqlExpressionBuilderPopup:n,Label:r}=this.state,l=this.props.config;let c,u;Array.isArray(l)?(c=null==l?void 0:l[0],u=l.length>1||c.enableQueryWithCurrentExtent):(c=l,u=c.enableQueryWithCurrentExtent);const d=c.actionUseDataSource&&a.DataSourceManager.getInstance().getDataSource(c.actionUseDataSource.dataSourceId);return(0,t.jsxs)(s,{title:this.nls("frameworkAction_Conditions"),children:[(0,t.jsx)(i,{tag:"label",children:(0,t.jsxs)(r,{check:!0,className:"d-flex align-items-center w-100",children:[(0,t.jsx)("div",{className:"flex-grow-1",children:this.nls("frameworkAction_QueryByExtent")}),(0,t.jsx)(o,{checked:u,onChange:e=>{this.switchEnabledQueryWithCurrentExtent(e.target.checked)}})]})}),(0,t.jsx)(i,{children:(0,t.jsx)(e,{className:"p-0 text-left",type:"link",disabled:!c.actionUseDataSource,onClick:this.showSqlExprPopup,title:this.nls("frameworkAction_MoreConditions"),"aria-describedby":"frameworkAction_SetExpression_Extent",children:this.nls("frameworkAction_MoreConditions")})}),(0,t.jsxs)(i,{children:[c.actionUseDataSource&&(0,t.jsx)(a.DataSourceComponent,{useDataSource:c.actionUseDataSource,children:e=>(0,t.jsx)(n,{dataSource:e,mode:a.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:c.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})}),(0,t.jsx)("div",{className:"sql-expr-display body-1",id:"frameworkAction_SetExpression_Extent",children:c.sqlExprObj&&d?a.dataSourceUtils.getArcGISSQL(c.sqlExprObj,d).displaySQL:this.nls("frameworkAction_SetExpression")})]})]})},this.getActionbactionUseDataSource=()=>{const{config:e}=this.props,t=[];return Array.isArray(e)?e.forEach(e=>{(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource)}):(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource),t},this.checkIsShowConditions=()=>{let e;return e=!Array.isArray(this.props.config)||1===this.props.config.length,!window.isExpressBuilder&&e},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){a.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"]).then(e=>{this.setState({Button:e[0].Button,Label:e[0].Label,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,SqlExpressionBuilderPopup:e[3].SqlExpressionBuilderPopup,DSSelectorTypes:(0,a.Immutable)([a.DataSourceTypes.FeatureLayer,a.DataSourceTypes.SceneLayer,a.DataSourceTypes.OrientedImageryLayer,a.DataSourceTypes.ImageryLayer,a.DataSourceTypes.BuildingComponentSubLayer,a.DataSourceTypes.SubtypeGroupLayer,a.DataSourceTypes.SubtypeSublayer])},()=>{let e=this.getInitConfig(),t=this.props.config;t=this.props.messageType===a.MessageType.ExtentChange?(0,a.Immutable)(e):t.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj),this.onSettingChange(t)})})}componentDidUpdate(e,t){const{useDataSources:a,config:o}=this.props;if(e.config&&o){const e=function(e,t){let a=!1,o=e;if(Array.isArray(e))o=e.map(e=>{const o=A(e,t);return o.isConfigChange?(a=!0,o.newActionConfig):e});else{const s=A(e,t);s.isConfigChange&&(a=!0,o=s.newActionConfig)}return{isConfigChange:a,newActionConfig:o}}(o,a);(null==e?void 0:e.isConfigChange)&&this.onSettingChange(e.newActionConfig)}}getStyle(e){return a.css`
      .setting-header {
        padding: ${a.polished.rem(10)} ${a.polished.rem(16)} ${a.polished.rem(0)} ${a.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        .action-select-chooser {
          margin-top: ${a.polished.rem(12)};
        }
      }
    `}render(){const{SettingSection:e,DataSourceSelector:o}=this.state,{messageWidgetId:s,messageType:i}=this.props;if(this.checkIsNotRenderActionSetting())return null;const n=I({widgetId:s,useDataSource:this.getMessageUseDataSource(),messageType:i,arcGISDataSourceTypes:a.DataSourceTypes}),r=this.getActionbactionUseDataSource();return this.props.messageType===a.MessageType.ExtentChange?(0,t.jsxs)("div",{css:this.getStyle(this.props.theme),children:[(0,t.jsx)(e,{title:this.nls("frameworkAction_ActionLayer"),"aria-label":this.nls("frameworkAction_ActionLayer"),role:"group",children:(0,t.jsx)(o,{isMultiple:!0,types:this.state.DSSelectorTypes,useDataSources:(0,a.Immutable)(r),hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})}),this.checkIsShowConditions()&&this.renderFrameworkConditionsWhenQueryByExtent()]}):(0,t.jsxs)("div",{css:this.getStyle(this.props.theme),children:[(0,t.jsx)(e,{title:this.nls("messageAction_TriggerData"),"aria-label":this.nls("messageAction_TriggerData"),role:"group",children:(0,t.jsx)(o,{types:this.state.DSSelectorTypes,useDataSources:n.useDataSources,fromRootDsIds:n.fromRootDsIds,fromDsIds:n.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>n.isReadOnly,disableDataSourceList:n.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})}),(0,t.jsx)(e,{title:this.nls("frameworkAction_ActionLayer"),"aria-label":this.nls("frameworkAction_ActionLayer"),role:"group",children:(0,t.jsx)(o,{isMultiple:Array.isArray(this.props.config),types:this.state.DSSelectorTypes,useDataSources:(0,a.Immutable)(r),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})}),this.checkIsShowFrameworkActionConditions()&&this.renderFrameworkActionConditions()]})}}k.defaultProps={config:(0,a.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0,enableQueryWithCurrentExtent:!0})};const R=a.ReactRedux.connect(e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo}))((0,n.withTheme)(k));class q extends a.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,o,s,i;const{messageWidgetId:n,messageType:r,config:l,useDataSources:c}=this.props,u=a.DataSourceManager.getInstance();let p=null;const g=C(c,null==l?void 0:l.actionUseDataSource);if(this.props.config.messageUseDataSource)p=x({widgetId:n,oldUseDataSource:this.props.config.messageUseDataSource,messageType:r,arcGISDataSourceTypes:a.DataSourceTypes});else{const l=d(n,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const n=null===(e=u.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();p=!n||n.type!==a.DataSourceTypes.WebMap&&n.type!==a.DataSourceTypes.WebScene?(0,a.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(o=null==l?void 0:l[0])||void 0===o?void 0:o.mainDataSourceId,dataViewId:null===(s=null==l?void 0:l[0])||void 0===s?void 0:s.dataViewId,rootDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.rootDataSourceId}):null}}return g&&g.dataSourceId?{messageUseDataSource:p,actionUseDataSource:g,sqlExprObj:this.props.config.sqlExprObj}:{messageUseDataSource:p,actionUseDataSource:g,sqlExprObj:null}},this.onSettingChange=e=>{const t=b(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleActionLayerChange=e=>{e&&e.length>0?this.handleActionLayerSelected(e[0]):this.handleRemoveLayerForActionLayer()},this.handleTriggerLayerSelected=e=>{const t=this.props.config.set("messageUseDataSource",e);this.onSettingChange(t)},this.handleActionLayerSelected=e=>{const t=this.props.config.set("actionUseDataSource",e).set("sqlExprObj",null);this.onSettingChange(t)},this.handleRemoveLayerForTriggerLayer=()=>{const e=this.props.config.set("messageUseDataSource",null).set("connectionType",null);this.onSettingChange(e)},this.handleRemoveLayerForActionLayer=()=>{const e=this.props.config.set("actionUseDataSource",null).set("sqlExprObj",null).set("connectionType",null);this.onSettingChange(e)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{const t=this.props.config.set("sqlExprObj",e);this.onSettingChange(t)},this.onMessageFieldSelected=(e,t)=>{const{config:a}=this.props,o=a.set("messageUseDataSource",{dataSourceId:a.messageUseDataSource.dataSourceId,mainDataSourceId:a.messageUseDataSource.mainDataSourceId,dataViewId:a.messageUseDataSource.dataViewId,rootDataSourceId:a.messageUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)});this.onSettingChange(o)},this.onActionFieldSelected=(e,t)=>{const{config:a}=this.props,o=a.set("actionUseDataSource",{dataSourceId:a.actionUseDataSource.dataSourceId,mainDataSourceId:a.actionUseDataSource.mainDataSourceId,dataViewId:a.actionUseDataSource.dataViewId,rootDataSourceId:a.actionUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)});this.onSettingChange(o)},this.switchEnabledDataRelationShip=e=>{const t=this.props.config.set("enabledDataRelationShip",e);this.onSettingChange(t)},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",a.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",a.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.nls=e=>{const t=Object.assign({},s.defaultMessages,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:t[e]})},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){a.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"]).then(e=>{this.setState({Button:e[0].Button,Label:e[0].Label,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,SqlExpressionBuilderPopup:e[3].SqlExpressionBuilderPopup,DSSelectorTypes:(0,a.Immutable)([a.AllDataSourceTypes.FeatureLayer,a.AllDataSourceTypes.SceneLayer,a.AllDataSourceTypes.OrientedImageryLayer,a.AllDataSourceTypes.ImageryLayer,a.AllDataSourceTypes.BuildingComponentSubLayer,a.AllDataSourceTypes.SubtypeGroupLayer,a.AllDataSourceTypes.SubtypeSublayer])},()=>{const e=this.getInitConfig(),t=this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj);this.onSettingChange(t)})})}getStyle(e){return a.css`
      .setting-header {
        padding: ${a.polished.rem(10)} ${a.polished.rem(16)} ${a.polished.rem(0)} ${a.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        .action-select-chooser {
          margin-top: ${a.polished.rem(12)};
        }
      }
    `}render(){var e,o;const{Button:s,Icon:n,Label:r,Switch:l,Collapse:c,SettingSection:u,SettingRow:d,FieldSelector:p,DataSourceSelector:g,SqlExpressionBuilderPopup:S}=this.state,{messageWidgetId:h,messageType:m,config:D,theme:f}=this.props;if(!(s&&n&&l&&c&&u&&d&&p&&g&&S))return null;const v=I({widgetId:h,useDataSource:D.messageUseDataSource,messageType:m,arcGISDataSourceTypes:a.DataSourceTypes}),y=this.props.config.messageUseDataSource&&a.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),x=this.props.config.actionUseDataSource&&a.DataSourceManager.getInstance().getDataSource(this.props.config.actionUseDataSource.dataSourceId),b=w(D),C=!D.connectionType||D.connectionType===a.MessageActionConnectionType.SetCustomFields;return(0,t.jsxs)("div",{css:this.getStyle(this.props.theme),children:[(0,t.jsx)(u,{role:"group",title:this.nls("messageAction_TriggerData"),"aria-label":this.nls("messageAction_TriggerData"),children:(0,t.jsx)(g,{types:this.state.DSSelectorTypes,useDataSources:v.useDataSources,fromRootDsIds:v.fromRootDsIds,fromDsIds:v.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>v.isReadOnly,disableDataSourceList:v.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})}),(0,t.jsx)(u,{role:"group",title:this.nls("frameworkAction_ActionLayer"),"aria-label":this.nls("frameworkAction_ActionLayer"),children:(0,t.jsx)(g,{types:this.state.DSSelectorTypes,useDataSources:this.props.config.actionUseDataSource?(0,a.Immutable)([this.props.config.actionUseDataSource]):(0,a.Immutable)([]),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})}),this.props.config&&this.props.config.actionUseDataSource&&this.props.config.messageUseDataSource&&(0,t.jsxs)(u,{role:"group",title:this.nls("frameworkAction_Conditions"),"aria-label":this.nls("frameworkAction_Conditions"),children:[(0,t.jsx)(d,{children:(0,t.jsxs)(r,{check:!0,className:"d-flex align-items-center w-100",children:[(0,t.jsx)("div",{className:"flex-grow-1",children:this.nls("frameworkAction_RelateMessage")}),(0,t.jsx)(l,{checked:this.props.config.enabledDataRelationShip,"aria-describedby":"frameworkAction_AutoBind",onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)},"aria-label":this.nls("frameworkAction_RelateMessage")})]})}),(0,t.jsx)(d,{children:(0,t.jsxs)(c,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100",children:[(0,t.jsx)(i,{messageDataSource:y,actionDataSource:x,connectionType:D.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),b&&(0,t.jsx)("div",{className:"w-100 border p-1 mr-2","aria-label":this.nls("frameworkAction_AutoBind"),id:"frameworkAction_AutoBind",children:this.nls("frameworkAction_AutoBind")}),!b&&C&&(0,t.jsxs)("div",{className:"w-100 d-flex align-items-center mt-3",children:[(0,t.jsxs)("div",{className:"d-flex flex-column relate-panel-left",children:[(0,t.jsx)(p,{className:"w-100",useDataSources:(0,a.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.nls("frameworkAction_TriggerLayerField"),"aria-label":this.nls("frameworkAction_TriggerLayerField"),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,a.Immutable)([])}),(0,t.jsx)(p,{className:"w-100 action-select-chooser",placeholder:this.nls("frameworkAction_ActionLayerField"),"aria-label":this.nls("frameworkAction_ActionLayerField"),useDataSources:(0,a.Immutable)([null===(o=this.props.config.actionUseDataSource)||void 0===o?void 0:o.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,a.Immutable)([])})]}),(0,t.jsx)(L,{autoFlip:!0,className:"flex-none",width:12,height:40,color:f.ref.palette.neutral[900]})]})]})}),(0,t.jsxs)(d,{children:[(0,t.jsx)(s,{type:"link",disabled:!this.props.config.actionUseDataSource,"aria-describedby":"frameworkAction_SetExpression",className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup,children:(0,t.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"},children:this.nls("frameworkAction_MoreConditions")})}),this.props.config.actionUseDataSource&&(0,t.jsx)(a.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource,children:e=>(0,t.jsx)(S,{dataSource:e,mode:a.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})})]}),(0,t.jsx)(d,{children:(0,t.jsx)("div",{className:"sql-expr-display",id:"frameworkAction_SetExpression",children:this.props.config.sqlExprObj&&x?a.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,x).displaySQL:this.nls("frameworkAction_SetExpression")})})]})]})}}q.defaultProps={config:(0,a.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})};const B=a.ReactRedux.connect(e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo}))((0,n.withTheme)(q));var O=c(79298);const F=(0,a.Immutable)([a.DataSourceTypes.FeatureLayer,a.DataSourceTypes.SceneLayer,a.DataSourceTypes.BuildingComponentSubLayer,a.DataSourceTypes.ImageryLayer,a.DataSourceTypes.OrientedImageryLayer,a.DataSourceTypes.SubtypeGroupLayer,a.DataSourceTypes.SubtypeSublayer]);class _ extends a.React.PureComponent{constructor(e){var t,a;super(e),this.handleViewChange=(e,t)=>{var a,o;this.props.onSettingChange({actionId:this.props.actionId,config:{sectionId:this.props.sectionId,useDataSources:null!==(o=null===(a=this.props.config)||void 0===a?void 0:a.useDataSources)&&void 0!==o?o:[],viewId:t}})},this.handleDataChange=e=>{var t,a;this.props.onSettingChange({actionId:this.props.actionId,config:{sectionId:this.props.sectionId,viewId:null!==(a=null===(t=this.props.config)||void 0===t?void 0:t.viewId)&&void 0!==a?a:this.props.views[0],useDataSources:(null==e?void 0:e.length)>0?e:[]}})},this.state={useCustomData:(null===(a=null===(t=this.props.config)||void 0===t?void 0:t.useDataSources)||void 0===a?void 0:a.length)>0}}render(){var e,s,i;const{views:n,config:r,messageWidgetId:l}=this.props,c=null!==(e=null==r?void 0:r.viewId)&&void 0!==e?e:null==n?void 0:n[0],u=null===(s=(0,a.getAppStore)().getState().appStateInBuilder)||void 0===s?void 0:s.appConfig;return u&&(null==n?void 0:n.length)>0?(0,t.jsxs)("div",{children:[(0,t.jsxs)(O.SettingSection,{title:this.props.intl.formatMessage({id:"messageAction_TriggerData"}),children:[(0,t.jsx)(O.SettingRow,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:(0,t.jsxs)(o.Label,{check:!0,centric:!0,className:"justify-content-start",children:[(0,t.jsx)(o.Radio,{name:"useAllData",style:{cursor:"pointer"},value:"all",className:"mr-2",checked:!this.state.useCustomData,onClick:()=>{this.setState({useCustomData:!1})}}),this.props.intl.formatMessage({id:"allDataWithoutCount"})]})}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)(o.Label,{check:!0,centric:!0,className:"justify-content-start",children:[(0,t.jsx)(o.Radio,{name:"useCustomData",style:{cursor:"pointer"},value:"custom",className:"mr-2",checked:this.state.useCustomData,onClick:()=>{this.setState({useCustomData:!0})}}),this.props.intl.formatMessage({id:"custom"})]})})]})}),this.state.useCustomData&&(0,t.jsx)(O.SettingRow,{flow:"wrap",children:(0,t.jsx)(O.MessageActionDataSelector,{messageWidgetId:l,messageType:a.MessageType.DataRecordsSelectionChange,types:F,useDataSources:(0,a.Immutable)(null!==(i=null==r?void 0:r.useDataSources)&&void 0!==i?i:[]),onChange:this.handleDataChange})})]}),(0,t.jsx)(O.SettingSection,{title:this.props.intl.formatMessage({id:"messageAction_ChangeView"}),children:(0,t.jsx)(O.SettingRow,{children:(0,t.jsx)(o.Select,{value:c,onChange:this.handleViewChange,children:n.map(e=>{const a=u.views[e];return(0,t.jsx)("option",{value:e,children:a.label||e},e)})})})})]}):null}}const N=a.ReactRedux.connect((e,t)=>{var a,o;const{sectionId:s}=t,i=null===(a=e.appStateInBuilder)||void 0===a?void 0:a.appConfig;return(null===(o=null==i?void 0:i.sections)||void 0===o?void 0:o[s])?{views:i.sections[s].views}:{views:null}})(_)})(),u})())}}});