define(["exports","./index2-52261f8e","./shared-components-4e078ab3","./store-d154d928","./analysis-tool-context-5cb0d8b6"],(function(t,e,a,n,s){"use strict";const i=e.proxyCustomElement(class extends e.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolStandardSettingsHelpClick=e.createEvent(this,"analysisToolStandardSettingsHelpClick",7),this.mapExtentInputs=[],this.stateContextChanged=!1,this.handleExtentChange=(t,e)=>{var a;n.set(n.state.context,["extent",t],e);const s=n.state.context.extent;void 0!==(null===(a=n.state.mapView)||void 0===a?void 0:a.spatialReference)&&(s.spatialReference=n.state.mapView.spatialReference,n.state.context.extent=this.getContextExtent(s)),n.state.context=Object.assign({},n.state.context)},this.handleCalciteListChange=async t=>{var e,a;const[s]=(await(null===(e=t.target)||void 0===e?void 0:e.getSelectedItems())).values();n.state.settingsSelectedExtentOption=s.value,this.incomingLayerObjects.extentLayer=void 0,null===(a=this.extentPopover)||void 0===a||a.remove()},this.setMapExtent=()=>{void 0!==n.state.mapView&&(n.state.context.extent=this.getContextExtent(n.state.mapView.extent)),n.state.context=Object.assign({},n.state.context),this.stateContextChanged=!0},this.handleLayerInputClose=t=>{"extent"===t?(delete n.state.context.extent,this.incomingLayerObjects.extentLayer=void 0):"spatialReference"===t&&(delete n.state.context.outSR,this.incomingLayerObjects.spatialRefLayer=void 0),this.incomingLayerObjects=Object.assign({},this.incomingLayerObjects),n.state.context=Object.assign({},n.state.context)},this.handleLayerInputChange=(t,a)=>{var s;const i=null===(s=t.target)||void 0===s?void 0:s.selectedLayers;if("extent"===a&&void 0!==(null==i?void 0:i.fullExtent))n.state.context.extent=this.getContextExtent(i.fullExtent);else if(void 0!==i&&"spatialReference"in i){const{wkid:t,latestWkid:a,wkt:s}=null==i?void 0:i.spatialReference;e.isEmptyDataItem(t)||n.set(n.state.context,"outSR.wkid",t),e.isEmptyDataItem(a)||n.set(n.state.context,"outSR.latestWkid",a),e.isEmptyDataItem(s)||n.set(n.state.context,"outSR.wkt",s)}n.state.context=Object.assign({},n.state.context)},this.createExtentPopover=t=>{var e,s;null===(e=this.extentPopover)||void 0===e||e.remove(),this.extentPopover=document.createElement("calcite-popover");const i={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,heading:this.strings.processingExtent,closable:!0,open:!0,referenceElement:t.target};Object.assign(this.extentPopover,i),this.extentPopover.addEventListener("calcitePopoverClose",null===(s=this.extentPopover)||void 0===s?void 0:s.remove);const l=document.createElement("calcite-pick-list");l.addEventListener("calciteListChange",this.handleCalciteListChange);const o=[{label:this.strings.default,description:this.strings.defaultText,value:a.ExtentOptions.Default},{label:this.strings.coordinates,description:this.strings.coordinatesText,value:a.ExtentOptions.Coordinates},{label:this.strings.mapExtent,description:this.strings.mapExtentText,value:a.ExtentOptions.MapExtent},{label:this.strings.layer,description:this.strings.layerText,value:a.ExtentOptions.Layer}].map((t=>{const e=document.createElement("calcite-pick-list-item");return Object.assign(e,t),e.selected=e.value===n.state.settingsSelectedExtentOption,e}));l.append(...o),this.extentPopover.append(l),document.body.append(this.extentPopover),setTimeout((()=>requestAnimationFrame((()=>{var t;return null===(t=this.extentPopover)||void 0===t?void 0:t.setFocus()}))),1)},this.handleSpatialReferenceChange=t=>{n.state.context.outSR={latestWkid:t.detail.latestWkid}},this.hideOutSR=!1,this.hideCategories=["Vertical Coordinate Systems"],this.hideExtent=!1,this.incomingLayerObjects={}}async validateStandardSettings(){var t,e,s,i;let l=!0,o=!0;switch(n.state.settingsSelectedExtentOption){case a.ExtentOptions.Layer:const n=null===(t=this.hostElement.shadowRoot)||void 0===t?void 0:t.querySelector(".extent");null!=n&&(l=await n.checkValidity());break;case a.ExtentOptions.Coordinates:const s=null===(e=this.hostElement.shadowRoot)||void 0===e?void 0:e.querySelectorAll("analysis-number-input"),i=[];null!=s&&(s.forEach((t=>{i.push(t.checkValidity())})),l=!(await Promise.all(i)).some((t=>!1===t)))}switch(n.state.settingsSelectedOutSpatialRefOption){case a.OutSROptions.SameAsLayer:const t=null===(s=this.hostElement.shadowRoot)||void 0===s?void 0:s.querySelector(".spatialReference");null!=t&&(o=await t.checkValidity());break;case a.OutSROptions.BrowseCS:const e=null===(i=this.hostElement.shadowRoot)||void 0===i?void 0:i.querySelector("analysis-spatial-reference-input");null!=e&&(o=await e.checkValidity())}return Promise.resolve(o&&l)}async componentWillLoad(){const t={};n.state.settingsSelectedExtentOption===a.ExtentOptions.Layer&&void 0!==n.state.mapLevelContext.extentLayer&&(t.extentLayer=await n.getEnvSettingsLayer(n.state.mapLevelContext.extentLayer)),n.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&void 0!==n.state.mapLevelContext.spatialRefLayer&&(t.spatialRefLayer=await n.getEnvSettingsLayer(n.state.mapLevelContext.spatialRefLayer)),this.incomingLayerObjects=t,({strings:this.strings,dir:this.dir}=await e.fetchComponentLocaleStrings(this.hostElement,e.getAssetPath(".")))}componentDidRender(){this.stateContextChanged&&(setTimeout((()=>requestAnimationFrame((()=>{var t;return null===(t=this.mapExtentInputs)||void 0===t?void 0:t.forEach((t=>t.checkValidity()))}))),1),this.stateContextChanged=!1)}disconnectedCallback(){var t,e;null===(t=this.extentPopover)||void 0===t||t.remove(),null===(e=this.coordinateSystemPopover)||void 0===e||e.remove()}renderCoordinateConfig(){const{strings:t}=this,{extent:s}=n.state.context;return e.h("div",null,e.h("calcite-button",{class:a.SharedHTMLClasses.controlSpacing,scale:a.UIDefaults.Scale,appearance:"outline",kind:"neutral",width:"full",onClick:this.setMapExtent},t.setCoordinates),e.h("calcite-label",null,t.top,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:null==s?void 0:s.ymax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>{var e;return this.handleExtentChange("ymax",null===(e=t.target)||void 0===e?void 0:e.value)}})),e.h("calcite-label",null,t.bottom,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:null==s?void 0:s.ymin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>{var e;return this.handleExtentChange("ymin",null===(e=t.target)||void 0===e?void 0:e.value)}})),e.h("calcite-label",null,t.left,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:null==s?void 0:s.xmin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>{var e;return this.handleExtentChange("xmin",null===(e=t.target)||void 0===e?void 0:e.value)}})),e.h("calcite-label",null,t.right,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:null==s?void 0:s.xmax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>{var e;return this.handleExtentChange("xmax",null===(e=t.target)||void 0===e?void 0:e.value)}})))}renderLayerInput(t){var a,i,l;let o;const r=n.state.mapLayers;if("extent"===t?o=null===(a=this.incomingLayerObjects)||void 0===a?void 0:a.extentLayer:"spatialReference"===t&&(o=null===(i=this.incomingLayerObjects)||void 0===i?void 0:i.spatialRefLayer),void 0!==o){const t="layerId"in o?o.layerId:0,e=`${o.url}/${t}`;void 0===n.findExistingLayer(e)&&r.push(o)}return e.h("analysis-layer-input",{class:t,required:!0,descriptionDisplay:"spatialReference",mapLayers:r,layerFilterType:[s.LayerFilterType.Imagery_All,s.LayerFilterType.Feature_All],selectedLayers:o,user:null===(l=n.state.portal)||void 0===l?void 0:l.user,mapView:n.state.mapView,onAnalysisLayerInputClose:()=>this.handleLayerInputClose(t),onAnalysisLayerInputChange:e=>this.handleLayerInputChange(e,t)})}renderChooseSpatialReference(){var t,a,s,i;const l=null!==(a=null===(t=n.state.context.outSR)||void 0===t?void 0:t.latestWkid)&&void 0!==a?a:null===(s=n.state.context.outSR)||void 0===s?void 0:s.wkid;return e.h("analysis-spatial-reference-input",{errorMessage:void 0!==(null===(i=n.state.context.outSR)||void 0===i?void 0:i.wkt)&&void 0===l?this.strings.unableToRepopulateOutSR:void 0,dir:this.dir,required:!0,onAnalysisSpatialReferenceInputChange:t=>this.handleSpatialReferenceChange(t),value:void 0!==l?{latestWkid:l}:void 0,hideCategories:this.hideCategories})}renderOutSR(){const{strings:t}=this;return e.h("div",null,e.h("analysis-label",{label:t.outputCS,onAnalysisLabelHelpActionClick:e=>this.analysisToolStandardSettingsHelpClick.emit({key:s.AnalysisToolContextKeys.OutSR,parameterName:t.outputCS,refElement:e.target})}),e.h("calcite-dropdown",{class:`display-block ${a.SharedHTMLClasses.controlSpacing}`,placement:"bottom",scale:a.UIDefaults.Scale},e.h("calcite-button",{class:a.SharedHTMLClasses.analysisBorder,alignment:"space-between",appearance:"transparent",kind:"neutral","icon-end":"chevron-down",scale:a.UIDefaults.Scale,slot:"trigger",width:"full"},t[n.state.settingsSelectedOutSpatialRefOption]),e.h("calcite-dropdown-group",null,e.h("calcite-dropdown-item",{onClick:()=>{n.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsInput,this.incomingLayerObjects.spatialRefLayer=void 0}},t.sameAsInput),e.h("calcite-dropdown-item",{onClick:()=>{n.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.BrowseCS,this.incomingLayerObjects.spatialRefLayer=void 0}},t.browseCS),e.h("calcite-dropdown-item",{onClick:()=>{n.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsLayer,this.incomingLayerObjects.spatialRefLayer=void 0}},t.sameAsLayer))),n.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&this.renderLayerInput("spatialReference"),n.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.BrowseCS&&this.renderChooseSpatialReference())}renderExtent(){const{strings:t}=this,{settingsSelectedExtentOption:i}=n.state;return e.h("div",null,e.h("analysis-label",{label:t.processingExtent,onAnalysisLabelHelpActionClick:e=>this.analysisToolStandardSettingsHelpClick.emit({key:s.AnalysisToolContextKeys.Extent,parameterName:t.processingExtent,refElement:e.target})}),e.h("calcite-value-list-item",{class:[a.SharedHTMLClasses.controlSpacing,a.SharedHTMLClasses.analysisBorder].join(" "),label:t[i],description:t[`${i}Text`],value:i,onClick:t=>this.createExtentPopover(t)},e.h("calcite-action",{slot:"actions-end",icon:"chevron-down",text:""})),i===a.ExtentOptions.Coordinates&&this.renderCoordinateConfig(),i===a.ExtentOptions.Layer&&this.renderLayerInput("extent"))}render(){return e.h(e.Host,null,!this.hideOutSR&&this.renderOutSR(),!this.hideExtent&&this.renderExtent())}getContextExtent(t){const{xmin:a,ymin:s,xmax:i,ymax:l,spatialReference:o}=t,{wkid:r,latestWkid:c,wkt:d}=o,u={xmin:a,ymin:s,xmax:i,ymax:l};return e.isEmptyDataItem(r)||n.set(u,"spatialReference.wkid",r),e.isEmptyDataItem(c)||n.set(u,"spatialReference.latestWkid",c),e.isEmptyDataItem(d)||n.set(u,"spatialReference.wkt",d),u}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}:host{display:flex;flex-direction:column}.control-spacing{width:100%}.display-block{display:block}"}},[1,"analysis-tool-standard-settings",{hideOutSR:[516,"hide-out-s-r"],hideCategories:[16],hideExtent:[516,"hide-extent"],incomingLayerObjects:[32],validateStandardSettings:[64]}]);function l(){"undefined"!=typeof customElements&&["analysis-tool-standard-settings"].forEach((t=>{"analysis-tool-standard-settings"===t&&(customElements.get(t)||customElements.define(t,i))}))}l(),t.AnalysisToolStandardSettings=i,t.defineCustomElement=l}));