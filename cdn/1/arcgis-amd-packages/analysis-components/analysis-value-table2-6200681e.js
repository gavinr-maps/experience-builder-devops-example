define(["exports","./index-86304dcd","./index2-600fb1b2","./set-bd0d1ec7","./primitiveFactory-2717fa00","./utils-2b3d82c1","./analysis-attribute-expression2-f34aed10","./analysis-boolean-input2-10e22433","./analysis-chip-group2-2361bfef","./analysis-dataset-input2-144fd55c","./analysis-dataset-input-popover2-6e06b4c4","./analysis-date-input2-a3eee199","./analysis-expression-group2-0d72ca83","./analysis-field-input2-00f0f6a4","./analysis-field-select2-5be8f180","./analysis-folder-input2-1973e9af","./analysis-geoenrichment-databrowser2-dbeaea59","./analysis-geoenrichment-input2-d9f2f892","./analysis-item-browser2-db031f89","./analysis-item-input2-14927f19","./analysis-label2-b880686f","./analysis-layer-input2-df2bc8f1","./analysis-layer-input-popover2-fe1e3b94","./analysis-linear-unit-input2-79a3e9cb","./analysis-multiple-input2-1f652890","./analysis-number-input2-cecfa17d","./analysis-query-builder2-19c561dd","./analysis-query-entry2-c95d7a4d","./analysis-query-input2-2ac9834d","./analysis-query-modal2-d2d9489a","./analysis-query-target-select2-b8d3432e","./analysis-spatial-expression2-90d05c57","./analysis-spatial-reference-input2-b717f27f","./analysis-spatial-reference-selector2-e3494e33","./analysis-string-input2-192086f8","./analysis-summary-fields2-587141b3","./analysis-summary-fields-popover2-71590aef","./analysis-traffic-time-input2-120e03e0","./analysis-tree2-79fa9cfa","./analysis-workflow-select2-7ecf2f29","./analysis-workflow-select-popover2-29b3b286"],(function(e,t,a,s,n,i,l,r,o,u,c,m,d,y,p,f,h,v,g,b,E,k,C,I,P,V,w,S,q,T,A,L,x,D,_,M,O,U,j,R,W){"use strict";const K="esriGPParameterTypeRequired";function B(e){const t=e.indexOf(".");let a=e,s="";return t>0&&(a=e.substring(0,t),s=e.substring(t+1)),[a,s]}function H(e){const t=new Map;for(const a of e){const e=Array.isArray(a.destination)?a.destination:[a.destination];for(const s of e){const[e]=B(s);t.has(e)?t.get(e).push(a):t.set(e,[a])}}return t}function N(e,t,n){let i=Object.assign({},e);for(const e of n)for(const[n,l]of Object.entries(t)){const t=""===e?n:`${e}.${n}`;t.includes("UIparameterInfos")?i=a.setImmutableValue(i,t,l):s.set(i,t,l)}return i}function z(e){const{param:t,data:s,rules:n,renderedParameters:i,currentTool:l}=e,r=t.name;if(void 0===r)return[t,s];let o=Object.assign({},t);for(const e of n){const t=a.processRule({rule:e,data:s,renderedParams:null!=i?i:{},currentTool:l});if(void 0===t)continue;const n=(Array.isArray(e.destination)?e.destination:[e.destination]).map(B).filter((([e])=>e===r));"value"in t&&(s[r]=t.value),o=N(o,t,n.map((([,e])=>e))),o.value=s[r]}return[o,s]}function $(e){let t;return e.impedanceAttributeName===e.timeAttributeName?t="time":e.impedanceAttributeName===e.distanceAttributeName&&(t="distance"),t}function G(e){var t,s,n,i,l;const{param:r,data:o,travelModeInfo:u,straightLineLabel:c}=e,m=r.name;if(void 0===m)return[r,o];const d=o[m],y="defaultValue"in r?r.defaultValue:void 0,p=[],f={},h={};let v;if(void 0!==u){const e=null===(t=null==u?void 0:u.travelModes)||void 0===t?void 0:t.filter((e=>void 0===r.filterTravelModeType||$(e)===r.filterTravelModeType));v=null!==(s=null==u?void 0:u.defaultTravelMode)&&void 0!==s?s:void 0,void 0!==r.filterTravelModeType&&$(v)!==r.filterTravelModeType&&(v=null!==(n=null==e?void 0:e[0])&&void 0!==n?n:void 0),(a.isEmptyDataItem(d)||d===y&&d!==a.StraightLineParameterValue)&&(o[m]=v),null==e||e.forEach((e=>{const t=$(e);p.push(e.id),f[e.id]=e.name,h[e.id]=function(e,t){var a,s,n,i;let l;switch(e.type.toLowerCase()){case"automobile":const e={time:"driving-time",distance:"driving-distance",other:"car"};l=null!==(a=e[null!=t?t:"other"])&&void 0!==a?a:e.other;break;case"walk":const r={time:"walking-time",distance:"walking-distance",other:"walk"};l=null!==(s=r[null!=t?t:"other"])&&void 0!==s?s:r.other;break;case"truck":const o={time:"trucking-time",distance:"trucking-distance",other:"dashboard"};l=null!==(n=o[null!=t?t:"other "])&&void 0!==n?n:o.other;break;default:const u={time:"edit-attributes",distance:"edit-attributes",other:"dashboard"};l=null!==(i=u[null!=t?t:"other "])&&void 0!==i?i:u.other}return l}(e,t)}))}y!==a.StraightLineParameterValue&&!0!==r.includeStraightLine||!1!==p.includes(a.StraightLineParameterValue)||(p.push(a.StraightLineParameterValue),f[a.StraightLineParameterValue]=null!=c?c:a.StraightLineParameterValue,h[a.StraightLineParameterValue]="line-straight");let g=y===a.StraightLineParameterValue?a.StraightLineParameterValue:null!==(i=null==v?void 0:v.id)&&void 0!==i?i:"";return a.isEmptyDataItem(d)||(g=d===a.StraightLineParameterValue?a.StraightLineParameterValue:null!==(l=null==d?void 0:d.id)&&void 0!==l?l:""),[Object.assign(Object.assign({},r),{choiceListLabels:f,choiceList:p,choiceListIcons:h,value:g}),o]}function J(e){var t;const{param:a,data:s,renderedParameters:n}=e,i=a.name;if(void 0===i)return[a,s];const l=null==n?void 0:n[i],r=void 0===l&&!0===a.visible,o=void 0!==l&&!1===a.visible;return r?(null!==(t=s[i])&&void 0!==t||(s[i]=a.defaultValue),a.value=s[i]):o&&(s[i]=void 0,a.value=s[i]),[a,s]}const F=e=>void 0===e.visible||!0===e.visible,Q="value-table",X={groupContainer:`${Q}__group-container`,groupAction:`${Q}__group-action`,groupAction1:`${Q}__group-action-1`,label:`${Q}__label`,groupHorizontal:`${Q}__horizontal-layout`},Y=({entryIndex:e,values:a,parameterInfos:s,valueWithoutKey:l,removeLabel:r,onEntryDeleted:o,onValueChange:u,onSetRef:c})=>{const m=s[0],d=null==m?void 0:m.label;return l?t.h("div",{class:X.groupHorizontal,key:e},Boolean(d)&&t.h("analysis-label",{label:d,hideHelp:!0,required:!0===m.required||m.parameterType===K}),t.h(n.AnalysisPrimitiveParameter,Object.assign({},s[0],{label:"",onValueChange:t=>u(e,s[0].name,t),onSetRef:t=>c(e,s[0].name,t),value:a[s[0].name]})),t.h("calcite-button",{"icon-end":"trash",appearance:"transparent",kind:"neutral",scale:"s",class:X.groupAction1,onClick:()=>o(e),label:r})):t.h("div",{class:X.groupContainer,key:e},t.h("calcite-button",{"icon-end":"trash",appearance:"transparent",kind:"neutral",scale:"s",class:X.groupAction,onClick:()=>o(e),label:r}),s.filter((e=>!("visible"in e&&!1===e.visible))).map((s=>{const l="required"in s&&!0===s.required||s.parameterType===K;return t.h("calcite-label",{scale:i.UIDefaults.Scale},t.h("analysis-label",{required:l,label:s.label,hideHelp:!0}),t.h(n.AnalysisPrimitiveParameter,Object.assign({},s,{label:"",onValueChange:t=>u(e,s.name,t),onSetRef:t=>c(e,s.name,t),value:null==a?void 0:a[s.name]})))})))};function Z(e){return void 0!==e.name}const ee=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisValueTableChange=t.createEvent(this,"analysisValueTableChange",7),this.analysisHelpClick=t.createEvent(this,"analysisHelpClick",7),this.entryInputElements=new Map,this.onAddButtonClick=()=>{this.value=this.valueWithoutKey?[...this.value,void 0]:[...this.value,this.getDefaultEntry()],this.analysisValueTableChange.emit()},this.onEntryDeleted=e=>{this.value.splice(e,1),this.removeAndUpdateEntryInputElements(e),this.value=[...this.value],this.analysisValueTableChange.emit()},this.onValueChange=(e,t,a)=>{const s=a.target.value;this.valueWithoutKey?this.value[e]=s:this.value[e][t]=s;const[,n]=this.applyRulesToEntry(e);this.value[e]=n,this.analysisValueTableChange.emit()},this.onSetRef=(e,t,a)=>{const s=this.entryInputElements.get(e);if(a)if(this.valueWithoutKey)this.entryInputElements.set(e,a);else{const n={[t]:a};this.entryInputElements.set(e,Object.assign(Object.assign({},null!=s?s:{}),n))}else if(this.valueWithoutKey)this.entryInputElements.delete(e),this.value.splice(e,1);else{null==s||delete s[t];const a=this.value[e];a&&delete a[t]}},this.validateSelection=async()=>{let e=!0;if(this.errorMessage=void 0,this.value.length<1)e=!0!==this.required,this.errorMessage=e?void 0:this.strings.requiredMessage;else{const t=Array.from(this.entryInputElements.keys()).map((e=>{let t=[];const s=this.entryInputElements.get(e);if(this.valueWithoutKey){const e=s;!1===a.isEmptyDataItem(e)&&"checkValidity"in e&&"function"==typeof e.checkValidity?t.push(e.checkValidity()):t.push(Promise.resolve(!0))}else{const e=s;t=Object.keys(e).map((t=>{const a=e[t];return void 0!==a&&"checkValidity"in a&&"function"==typeof a.checkValidity?a.checkValidity():Promise.resolve(!0)}))}return t})),s=await Promise.all(t.flat());e=void 0!==s&&void 0===s.find((e=>!1===e))}return e&&void 0===this.errorMessage},this.getDefaultEntry=()=>{const e=this.combinedParameterInfos.filter((e=>void 0!==e.defaultValue)).map((e=>[e.name,e.defaultValue]));return Object.fromEntries(e)},this.required=!1,this.value=[],this.label=void 0,this.parameterInfos=void 0,this.UIparameterInfos=void 0,this.UIparameterInfosRules=void 0,this.valueWithoutKey=!1,this.errorMessage=void 0}async checkValidity(){return Promise.resolve(this.validateSelection())}get combinedParameterInfos(){var e;let t=null!==(e=this.parameterInfos)&&void 0!==e?e:[];return void 0!==this.UIparameterInfos&&(t=this.UIparameterInfos.filter(Z).map((e=>{var t;const a=null===(t=this.parameterInfos)||void 0===t?void 0:t.find((t=>t.name===e.name));return Object.assign(Object.assign({},a),e)}))),t}get rulesByDestination(){var e;return H(null!==(e=this.UIparameterInfosRules)&&void 0!==e?e:[])}async componentWillLoad(){if(({strings:this.strings}=await a.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),void 0===this.value||0===this.value.length){const e=this.valueWithoutKey?void 0:this.getDefaultEntry();this.value=[e],!1===a.isEmptyDataItem(e)&&this.analysisValueTableChange.emit()}}render(){const e=this.value.map(((e,a)=>{const[s,n]=this.applyRulesToEntry(a);let i={};return this.valueWithoutKey?i[s[0].name]=n:i=n,t.h(Y,{entryIndex:a,values:i,valueWithoutKey:this.valueWithoutKey,parameterInfos:s,removeLabel:this.strings.removeEntryButtonLabel,onEntryDeleted:this.onEntryDeleted,onValueChange:this.onValueChange,onSetRef:this.onSetRef})}));return t.h(t.Host,null,t.h("analysis-label",{label:this.label,required:!1,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),e,t.h("calcite-button",{appearance:"outline",kind:"neutral",round:!0,"icon-start":"plus",width:"full",scale:i.UIDefaults.Scale,onClick:this.onAddButtonClick},this.strings.addEntryButtonLabel),t.h("calcite-input-message",{icon:"exclamationMarkTriangle",status:a.UIInputStatus.INVALID,scale:i.UIDefaults.Scale,hidden:!0===a.isEmptyDataItem(this.errorMessage)},this.strings.requiredMessage))}removeAndUpdateEntryInputElements(e){const t=this.entryInputElements.size;if(e>=0&&e<t){const t=new Map;for(const[a,s]of this.entryInputElements){const n=a>e?a-1:a;a!==e&&t.set(n,s)}this.entryInputElements=t}}applyRulesToEntry(e){if(this.valueWithoutKey)return[this.combinedParameterInfos,this.value[e]];const t=this.rulesByDestination,a=this.value[e],s=this.entryInputElements.get(e);let n;n=void 0===s?{}:s;const i=Object.entries(n).reduce(((e,[t,a])=>(void 0!==a&&(e[t]=a),e)),{});return[this.combinedParameterInfos.map((e=>{var s;let[n]=z({param:e,data:a,rules:null!==(s=t.get(e.name))&&void 0!==s?s:[],renderedParameters:i});return[n]=J({param:n,data:a,renderedParameters:i}),n})),a]}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-ui-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height:30vh;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:block;margin-bottom:var(--analysis-half-spacing)}.value-table__group-container{display:flex;flex-direction:column;border:1px var(--calcite-ui-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.value-table__group-action{align-self:flex-end}.value-table__group-action-1{align-self:flex-start}.value-table__label{margin:var(--analysis-half-spacing) 0}.value-table__horizontal-layout{display:flex;width:var(--analysis-component-default-width);column-gap:3%}"}},[1,"analysis-value-table",{required:[516],value:[1040],label:[513],parameterInfos:[16],UIparameterInfos:[16],UIparameterInfosRules:[16],valueWithoutKey:[516,"value-without-key"],errorMessage:[32],checkValidity:[64]}]);function te(){"undefined"!=typeof customElements&&["analysis-value-table","analysis-attribute-expression","analysis-boolean-input","analysis-chip-group","analysis-dataset-input","analysis-dataset-input-popover","analysis-date-input","analysis-expression-group","analysis-field-input","analysis-field-select","analysis-folder-input","analysis-geoenrichment-databrowser","analysis-geoenrichment-input","analysis-item-browser","analysis-item-input","analysis-label","analysis-layer-input","analysis-layer-input-popover","analysis-linear-unit-input","analysis-multiple-input","analysis-number-input","analysis-query-builder","analysis-query-entry","analysis-query-input","analysis-query-modal","analysis-query-target-select","analysis-spatial-expression","analysis-spatial-reference-input","analysis-spatial-reference-selector","analysis-string-input","analysis-summary-fields","analysis-summary-fields-popover","analysis-traffic-time-input","analysis-tree","analysis-workflow-select","analysis-workflow-select-popover"].forEach((e=>{switch(e){case"analysis-value-table":customElements.get(e)||customElements.define(e,ee);break;case"analysis-attribute-expression":customElements.get(e)||l.defineCustomElement();break;case"analysis-boolean-input":customElements.get(e)||r.defineCustomElement();break;case"analysis-chip-group":customElements.get(e)||o.defineCustomElement();break;case"analysis-dataset-input":customElements.get(e)||u.defineCustomElement();break;case"analysis-dataset-input-popover":customElements.get(e)||c.defineCustomElement();break;case"analysis-date-input":customElements.get(e)||m.defineCustomElement();break;case"analysis-expression-group":customElements.get(e)||d.defineCustomElement();break;case"analysis-field-input":customElements.get(e)||y.defineCustomElement();break;case"analysis-field-select":customElements.get(e)||p.defineCustomElement();break;case"analysis-folder-input":customElements.get(e)||f.defineCustomElement();break;case"analysis-geoenrichment-databrowser":customElements.get(e)||h.defineCustomElement();break;case"analysis-geoenrichment-input":customElements.get(e)||v.defineCustomElement();break;case"analysis-item-browser":customElements.get(e)||g.defineCustomElement();break;case"analysis-item-input":customElements.get(e)||b.defineCustomElement();break;case"analysis-label":customElements.get(e)||E.defineCustomElement();break;case"analysis-layer-input":customElements.get(e)||k.defineCustomElement();break;case"analysis-layer-input-popover":customElements.get(e)||C.defineCustomElement();break;case"analysis-linear-unit-input":customElements.get(e)||I.defineCustomElement();break;case"analysis-multiple-input":customElements.get(e)||P.defineCustomElement();break;case"analysis-number-input":customElements.get(e)||V.defineCustomElement();break;case"analysis-query-builder":customElements.get(e)||w.defineCustomElement();break;case"analysis-query-entry":customElements.get(e)||S.defineCustomElement();break;case"analysis-query-input":customElements.get(e)||q.defineCustomElement();break;case"analysis-query-modal":customElements.get(e)||T.defineCustomElement();break;case"analysis-query-target-select":customElements.get(e)||A.defineCustomElement();break;case"analysis-spatial-expression":customElements.get(e)||L.defineCustomElement();break;case"analysis-spatial-reference-input":customElements.get(e)||x.defineCustomElement();break;case"analysis-spatial-reference-selector":customElements.get(e)||D.defineCustomElement();break;case"analysis-string-input":customElements.get(e)||_.defineCustomElement();break;case"analysis-summary-fields":customElements.get(e)||M.defineCustomElement();break;case"analysis-summary-fields-popover":customElements.get(e)||O.defineCustomElement();break;case"analysis-traffic-time-input":customElements.get(e)||U.defineCustomElement();break;case"analysis-tree":customElements.get(e)||j.defineCustomElement();break;case"analysis-workflow-select":customElements.get(e)||R.defineCustomElement();break;case"analysis-workflow-select-popover":customElements.get(e)||W.defineCustomElement()}}))}te(),e.AnalysisValueTable=ee,e.adaptForTravelModes=G,e.applyRules=z,e.applyToolParameterDefaults=function(e){const{defaultValues:t,toolJsonParameters:a,toolUIJsonParametersByName:s}=e;return null==a||a.forEach((e=>{const a=null==s?void 0:s[e.name];"esriGPParameterDirectionOutput"===e.direction||void 0!==t[e.name]||void 0!==(null==a?void 0:a.visible)&&!0!==(null==a?void 0:a.visible)||(t[e.name]=e.defaultValue)})),t},e.applyToolUIJsonParameterDefaults=function(e){let{defaultValues:t}=e;const{toolName:s,toolUIJsonParametersByName:n,travelModeInfo:i}=e;return Object.keys(null!=n?n:{}).forEach((e=>{const l=null==n?void 0:n[e];void 0!==(null==l?void 0:l.name)&&!0===F(l)?void 0!==i&&void 0!==s&&!0===a.isTravelModeParameter(l.name,s)?(t[l.name]=l.defaultValue,[,t]=G({param:l,data:t,travelModeInfo:i})):t[l.name]=l.defaultValue:void 0!==(null==l?void 0:l.name)&&!1===l.visible&&(t[l.name]=void 0)})),t},e.applyUserSettings=function(e){const{defaultValues:t,user:s,hasAdvancedLicense:n}=e;return t.userSettings={unitSystem:null==s?void 0:s.units,hasNAPrivilege:a.hasNAPrivilege(s),hasGEPrivilege:a.hasGeoEnrichmentPrivilege(s),hasAdvancedLicense:n},t},e.applyUserSettingsRules=function(e){const{defaultValues:t,toolUIJsonParametersByName:a,rules:s}=e,n=H(function(e){const t=null==e?void 0:e.filter((e=>(e=>{var t,a,s;switch(e.ruleType){case"expression":return null===(t=e.expression)||void 0===t?void 0:t.includes("userSettings");case"equals":return!0===(null===(a=e.valueA)||void 0===a?void 0:a.toString().includes("userSettings"))||!0===(null===(s=e.valueB)||void 0===s?void 0:s.toString().includes("userSettings"));default:return!1}})(e)&&(e=>"effectParams"in e&&"defaultValue"in e.effectParams)(e)));return null!=t?t:[]}(s));return Object.keys(null!=a?a:{}).forEach((e=>{const s=null==a?void 0:a[e];if(void 0!==(null==s?void 0:s.name)&&!0===F(s)){const a=n.get(e);if(void 0!==a){const[e]=z({param:s,data:t,rules:a,renderedParameters:{}});t[s.name]=e.defaultValue}}})),t},e.applyVisibilityRules=J,e.defineCustomElement=te,e.getRulesByDestination=H,e.joinParams=function(e,t){var a;return null===(a=e.filter((e=>"esriGPParameterDirectionOutput"!==e.direction)))||void 0===a?void 0:a.map((e=>{const a=t.find((t=>t.name===e.name));return Object.assign(Object.assign({},a),e)}))}}));