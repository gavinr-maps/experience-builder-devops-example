define(["exports","./index-86304dcd","./index2-600fb1b2","./analysis-expression-group2-0d72ca83","./utils-2b3d82c1","./analysis-attribute-expression2-f34aed10","./analysis-query-builder2-19c561dd","./analysis-query-entry2-c95d7a4d","./analysis-query-target-select2-b8d3432e","./analysis-spatial-expression2-90d05c57"],(function(e,s,t,i,n,r,a,o,l,d){"use strict";const h=s.proxyCustomElement(class extends s.H{constructor(){super(),this.__registerHost(),this.analysisQueryModalAdd=s.createEvent(this,"analysisQueryModalAdd",7),this.analysisQueryModalDismissed=s.createEvent(this,"analysisQueryModalDismissed",7),this.analysisQueryModalError=s.createEvent(this,"analysisQueryModalError",7),this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onQueryError=e=>{this.analysisQueryModalError.emit(e.detail)},this.onTargetChange=e=>{this.target=e.target.target},this.onSelectExpressionType=e=>{const s=e.target;this.selectedExpressionType=s.value},this.onOnboardingNextClick=()=>{this.expressionGroup=this.createDefaultGroup(),this.isOnboarding=!1},this.onAddClick=()=>{var e;this.analysisQueryModalAdd.emit(null!==(e=this.newValue)&&void 0!==e?e:this.expressionGroup),this.close()},this.onClose=()=>{this.analysisQueryModalDismissed.emit()},this.onQueryChange=e=>{this.newValue=e.detail},this.selectedExpressionType="attribute",this.isOnboarding=!0,this.value=void 0,this.mode=void 0,this.expressionGroup=void 0,this.target=void 0,this.layers=[],this.open=void 0,this.recordsTerm="features",this.options=void 0}async componentWillLoad(){({strings:this.strings}=await t.fetchComponentLocaleStrings(this.hostElement,s.getAssetPath("."))),this.isOnboarding=void 0===this.value||"string"!=typeof this.value&&this.value.expressions.length<1,await Promise.allSettled(this.layers.map((e=>e.load())))}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&void 0!==this.spatialExpressionTile&&(this.tooltipRef.referenceElement=this.spatialExpressionTile)}get loadedLayers(){return(0===this.layers.length&&void 0!==this.target?[this.target]:this.layers).filter((e=>e.loaded))}createDefaultGroup(){var e;const s=null!==(e=this.target)&&void 0!==e?e:this.loadedLayers[0];let t=new i.ExpressionGroup(s,"and");return t="group"===this.selectedExpressionType?t.addNewGroup("and"):"spatial"===this.selectedExpressionType?t.addDefaultSpatialExpression(s,this.loadedLayers):t.addDefaultExpression(this.options),t}render(){return s.h("calcite-modal",{open:this.open,escapeDisabled:!0,outsideCloseDisabled:!0,ref:e=>this.containerRef=e,onCalciteModalClose:this.onClose},s.h("div",{slot:"header"},this.strings.header),s.h("div",{slot:"content"},this.isOnboarding?this.renderOnboardingContent():this.renderQueryBuilder()),s.h("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onClick:this.close},this.strings.cancel),s.h("calcite-button",{slot:"primary",width:"full",onClick:this.isOnboarding?this.onOnboardingNextClick:this.onAddClick},this.isOnboarding?this.strings.next:this.strings.add))}renderOnboardingContent(){const e=new Set(this.layers.map(n.formatLayerUrlAndId));return s.h(s.Fragment,null,s.h("analysis-query-target-select",{target:this.target,layers:this.loadedLayers,onAnalysisQueryTargetSelectChange:this.onTargetChange,recordsTerm:this.recordsTerm,disabled:"sql"===this.mode}),s.h("calcite-tile-select-group",{class:"expression-tile-select"},s.h("calcite-tile-select",{heading:this.getString(this.strings.attributeExpressionTitle,this.strings.expressionTitle),description:this.getString(this.strings.attributeExpressionDescription,this.strings.expressionDescription),checked:"attribute"===this.selectedExpressionType||void 0,icon:"list-check",value:"attribute",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),"sql"!==this.mode&&s.h(s.Fragment,null,s.h("calcite-tile-select",{ref:e=>{e&&(this.spatialExpressionTile=e)},heading:this.strings.spatialExpressionTitle,description:this.strings.spatialExpressionDescription,checked:"spatial"===this.selectedExpressionType||void 0,icon:"geographic-link-chart-layout",value:"spatial",disabled:e.size>1==0,inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),e.size>1==0&&s.h("calcite-tooltip",{label:this.strings.spatialExpressionTwoLayers,referenceElement:this.spatialExpressionTile,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),"sql"===this.mode&&s.h("calcite-tile-select",{heading:this.strings.expressionGroupTitle,description:this.strings.expressionGroupDescription,checked:"group"===this.selectedExpressionType||void 0,icon:"group-form-plus",value:"group",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType})))}renderQueryBuilder(){return s.h("analysis-query-builder",{expressionGroup:this.expressionGroup,layers:this.loadedLayers,mode:this.mode,recordsTerm:this.recordsTerm,onAnalysisQueryChange:this.onQueryChange,onAnalysisQueryError:this.onQueryError,options:this.options})}getString(e,s){return"features"===this.recordsTerm?e:s}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-ui-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height:30vh;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.query-modal{--calcite-modal-width:60rem}.expression-tile-select{justify-content:center}"}},[0,"analysis-query-modal",{value:[1025],mode:[513],expressionGroup:[16],target:[1040],layers:[16],open:[4],recordsTerm:[513,"records-term"],options:[16],selectedExpressionType:[32],isOnboarding:[32]}]);function c(){"undefined"!=typeof customElements&&["analysis-query-modal","analysis-attribute-expression","analysis-expression-group","analysis-query-builder","analysis-query-entry","analysis-query-target-select","analysis-spatial-expression"].forEach((e=>{switch(e){case"analysis-query-modal":customElements.get(e)||customElements.define(e,h);break;case"analysis-attribute-expression":customElements.get(e)||r.defineCustomElement();break;case"analysis-expression-group":customElements.get(e)||i.defineCustomElement();break;case"analysis-query-builder":customElements.get(e)||a.defineCustomElement();break;case"analysis-query-entry":customElements.get(e)||o.defineCustomElement();break;case"analysis-query-target-select":customElements.get(e)||l.defineCustomElement();break;case"analysis-spatial-expression":customElements.get(e)||d.defineCustomElement()}}))}c(),e.AnalysisQueryModal=h,e.defineCustomElement=c}));