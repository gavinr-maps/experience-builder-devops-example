define(["exports","./index-86304dcd","./index2-600fb1b2","./utils-2b3d82c1"],(function(e,t,s,i){"use strict";const r=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.analysisItemBrowserSelection=t.createEvent(this,"analysisItemBrowserSelection",7),this.analysisItemBrowserAddToMap=t.createEvent(this,"analysisItemBrowserAddToMap",7),this.analysisItemBrowserClose=t.createEvent(this,"analysisItemBrowserClose",7),this.webToolTaskMap={},this.buildDropdownItem=e=>t.h("calcite-dropdown-item",{key:e,onClick:()=>{const t=Object.assign(Object.assign({},this.currentPreviewItem),{toolName:e});this.selectedItems=[this.currentPreviewItem],this.analysisItemBrowserSelection.emit(t),this.close()}},e),this.getAllowedItemTypes=()=>["layers","layers-weblayers-features","layers-weblayers-imagery","layers-weblayers-tiledimagelayers","layers-weblayers-tables"],this.formatSublayerUrl=e=>{var t,s;return`${"item"in e?e.item.url:e.url}/${"sublayer"in e?null!==(s=null===(t=e.sublayer)||void 0===t?void 0:t.id)&&void 0!==s?s:0:""}`},this.formatErrorMessage=()=>{let e="";return e=!0===this.layerLoadingFailed?this.errorStrings.layerLoadFailure:s.formatMessage(this.strings.unsupportedLayer,{layerName:this.invalidBrowsedLayers.join(", ")}),e},this.getItemDetailsUrl=e=>{let t="";if(!s.isEmptyDataItem(e)){const{id:s}=e;t=`${i.getBaseUrl(this.portal)}/home/item.html?id=${s}`}return t},this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onSelectButtonClick=async(e,t)=>{const i=!0===t?this.analysisItemBrowserAddToMap:this.analysisItemBrowserSelection;switch(this.selectionMode){case"single":i.emit(this.selectedItems[0]),this.close();break;case"multiple":default:i.emit(this.selectedItems),this.close();break;case"single-sublayer":case"multiple-sublayer":const t=e.target;t.loading=!0,this.browsedLayerCreating=!0;let r=[];try{const e=this.selectedItems.map((e=>s.getLayerObject({url:this.formatSublayerUrl(e)})));r=(await Promise.all(e)).filter((e=>void 0!==e)),this.invalidBrowsedLayers=await this.filterUnsupportedLayers(r),this.layerLoadingFailed=!1}catch(e){this.layerLoadingFailed=!0}this.browsedLayerCreating=!1,t.loading=!1,0===this.invalidBrowsedLayers.length&&!1===this.layerLoadingFailed&&(i.emit(r),this.close())}},this.onClose=()=>{this.analysisItemBrowserClose.emit()},this.onItemBrowserUpdate=e=>{this.items=e.detail.results,this.totalItems=e.detail.total},this.onItemBrowserSelect=e=>{this.selectedItems=e.detail},this.onItemBrowserLoading=()=>{this.items=[],this.totalItems=void 0},this.onItemBrowserPreview=async e=>{const t=e.detail;if(!0===this.showWebToolSelect){this.tasksLoading=!0;const e=await this.fetchTasks(t);this.webToolTaskMap[t.id]=e}this.currentPreviewItem=t,!0===this.tasksLoading&&(this.tasksLoading=!1)},this.fetchTasks=async e=>(await s.request(`${e.url}?f=json`,{responseType:"json",authMode:"no-prompt"})).data.tasks,this.items=[],this.selectedItems=[],this.totalItems=void 0,this.browsedLayerCreating=!1,this.invalidBrowsedLayers=[],this.currentPreviewItem=void 0,this.layerLoadingFailed=!1,this.tasksLoading=!1,this.allowedGeometries=void 0,this.layerFilterType=void 0,this.displayMode="modal",this.filter="",this.bucketOptions=void 0,this.hidePreview=!1,this.hideFilters=!1,this.hideAddToMap=!1,this.header=void 0,this.user=void 0,this.portal=void 0,this.selectionMode=void 0,this.showWebToolSelect=!1}async componentWillLoad(){let e="";({strings:this.strings,locale:e}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),this.errorStrings=await s.fetchErrorsStrings(e)}render(){return this.renderModal()}renderModal(){var e;return t.h("calcite-modal",{class:"modal-variables",scale:"s",open:!0,escapeDisabled:!0,outsideCloseDisabled:!0,focusTrapDisabled:!0,onCalciteModalClose:this.onClose,ref:e=>this.containerRef=e},t.h("div",{slot:"header"},null!==(e=this.header)&&void 0!==e?e:this.strings.header),t.h("div",{slot:"content",class:"modal-content"},this.renderItemBrowser(),(0!==this.invalidBrowsedLayers.length||!0===this.layerLoadingFailed)&&t.h("div",{class:"modal-alert"},t.h("calcite-alert",{open:!0,kind:"danger",label:this.formatErrorMessage(),onCalciteAlertClose:()=>{this.invalidBrowsedLayers=[],this.layerLoadingFailed=!1}},t.h("div",{slot:"title"},this.formatErrorMessage())))),t.h("calcite-button",{slot:"back",width:"full",appearance:"solid",kind:"neutral",onClick:this.close},this.strings.cancel),!1===this.hideAddToMap&&t.h("calcite-button",{slot:"primary",width:"full",appearance:"solid",disabled:!0===this.browsedLayerCreating,onClick:e=>this.onSelectButtonClick(e,!0)},this.strings.addToMap),t.h("calcite-button",{slot:this.hideAddToMap?"primary":"secondary",appearance:this.hideAddToMap?"solid":"outline",width:"full",disabled:!0===this.browsedLayerCreating,onClick:e=>this.onSelectButtonClick(e,!1)},this.strings.confirm))}renderItemBrowser(){var e,s;const r="single-sublayer"===this.selectionMode||"multiple-sublayer"===this.selectionMode||"none"===this.selectionMode?"top":"action";return t.h("arcgis-item-browser",{api:4,allowedGeometries:this.allowedGeometries,filter:this.filter,num:20,config:{baseUrl:i.getBaseUrl(this.portal)},portal:this.portal,user:this.user,selection:null!==(e=this.selectionMode)&&void 0!==e?e:"single",onArcgisItemBrowserLoading:this.onItemBrowserLoading,onArcgisItemBrowserUpdate:this.onItemBrowserUpdate,onArcgisItemBrowserSelect:this.onItemBrowserSelect,onArcgisItemBrowserPreview:this.onItemBrowserPreview},t.h("arcgis-item-browser-top-bar",{slot:"top-bar","filter-toggle":!0},t.h("arcgis-item-browser-bucket-select",{slot:"bucket",options:this.bucketOptions}),t.h("arcgis-item-browser-search",{slot:"search",term:""})),t.h("arcgis-item-browser-sort",{slot:"sort",field:"modified"}),!1===this.hideFilters&&t.h("arcgis-item-browser-filters",{slot:"filters"},t.h("arcgis-item-browser-filter-folder",null),t.h("arcgis-item-browser-filter-categories",null),t.h("arcgis-item-browser-filter-date",{property:"modified"}),t.h("arcgis-item-browser-filter-date",{property:"created"}),t.h("arcgis-item-browser-filter-item-type",{allowedItemTypes:this.getAllowedItemTypes()}),t.h("arcgis-item-browser-filter-tags",null),t.h("arcgis-item-browser-filter-sharing",null),t.h("arcgis-item-browser-filter-content-status",null),t.h("arcgis-item-browser-filter-collaborations",null)),t.h("arcgis-item-browser-content",{slot:"content"},this.items.map((e=>t.h("arcgis-item-browser-card",{key:e.id,item:e,portal:this.portal,user:this.user,name:"item-browser",preview:this.hidePreview?void 0:r,showThumbnail:!1})))),t.h("div",{slot:"preview-footer"},!0===this.showWebToolSelect&&t.h("calcite-dropdown",{placement:"top",style:{width:"100%"}},t.h("calcite-button",{loading:this.tasksLoading,slot:"trigger",appearance:"solid",kind:"neutral",iconEnd:"chevron-down",width:"full"},this.strings.selectTask),t.h("calcite-dropdown-group",null,void 0!==(null===(s=this.currentPreviewItem)||void 0===s?void 0:s.id)?this.webToolTaskMap[this.currentPreviewItem.id].map(this.buildDropdownItem):null)),t.h("calcite-button",{href:this.getItemDetailsUrl(this.currentPreviewItem),target:"_blank",appearance:"outline-fill",kind:"neutral",width:"full"},this.strings.viewDetails)),t.h("arcgis-item-browser-pagination",{slot:"pagination",start:1,num:20,total:this.totalItems}))}async filterUnsupportedLayers(e){const{filteredLayers:t}=await i.filterLayersByType({layers:e,layerFilterTypes:this.layerFilterType,user:this.user});return[...t,...e.filter((e=>!s.checkLayerAllowAnalysis(e)))].map((e=>e.title))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-ui-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height:30vh;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.modal-content{height:100%}.modal-variables{--calcite-modal-height:min(700px, calc(75vh + 100px));--calcite-modal-width:1080px;--calcite-modal-content-padding:0px}.modal-alert{pointer-events:none;position:absolute;left:0px;bottom:0px;width:100%;display:block;z-index:50;transform:translate(0px, -0.5rem);height:calc(100% - 4rem)}"}},[0,"analysis-item-browser",{allowedGeometries:[16],layerFilterType:[1,"layer-filter-type"],displayMode:[513,"display-mode"],filter:[513],bucketOptions:[16],hidePreview:[4,"hide-preview"],hideFilters:[4,"hide-filters"],hideAddToMap:[4,"hide-add-to-map"],header:[513],user:[16],portal:[16],selectionMode:[1,"selection-mode"],showWebToolSelect:[4,"show-web-tool-select"],items:[32],selectedItems:[32],totalItems:[32],browsedLayerCreating:[32],invalidBrowsedLayers:[32],currentPreviewItem:[32],layerLoadingFailed:[32],tasksLoading:[32]}]);function a(){"undefined"!=typeof customElements&&["analysis-item-browser"].forEach((e=>{"analysis-item-browser"===e&&(customElements.get(e)||customElements.define(e,r))}))}a(),e.AnalysisItemBrowser=r,e.defineCustomElement=a}));