define(["exports","./index-86304dcd","./index2-600fb1b2","./analysis-item-browser2-db031f89","./_Uint8Array-190b1a5d","./_baseIsEqual-422e05a5","./isObject-072a0200","./get-4ace6219","./_baseGet-9bd467fe","./_MapCache-84d65af1","./identity-47e9f05a"],(function(e,t,i,s,r,n,o,a,l,h,c){"use strict";var d=1,u=2;function p(e){return e==e&&!o.isObject(e)}function m(e,t){return function(i){return null!=i&&i[e]===t&&(void 0!==t||e in Object(i))}}function v(e,t){return null!=e&&t in Object(e)}function y(e,t){return null!=e&&function(e,t,i){for(var s=-1,n=(t=l.castPath(t,e)).length,o=!1;++s<n;){var a=l.toKey(t[s]);if(!(o=null!=e&&i(e,a)))break;e=e[a]}return o||++s!=n?o:!!(n=null==e?0:e.length)&&r.isLength(n)&&r.isIndex(a,n)&&(h.isArray(e)||r.isArguments(e))}(e,t,v)}function f(e){return"function"==typeof e?e:null==e?c.identity:"object"==typeof e?h.isArray(e)?(s=e[0],o=e[1],l.isKey(s)&&p(o)?m(l.toKey(s),o):function(e){var t=a.get(e,s);return void 0===t&&t===o?y(e,s):n.baseIsEqual(o,t,3)}):(i=function(e){for(var t=r.keys(e),i=t.length;i--;){var s=t[i],n=e[s];t[i]=[s,n,p(n)]}return t}(t=e),1==i.length&&i[0][2]?m(i[0][0],i[0][1]):function(e){return e===t||function(e,t,i,s){var o=i.length,a=o;if(null==e)return!a;for(e=Object(e);o--;){var l=i[o];if(l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<a;){var h=(l=i[o])[0],c=e[h],p=l[1];if(l[2]){if(void 0===c&&!(h in e))return!1}else{var m,v=new r.Stack;if(!(void 0===m?n.baseIsEqual(p,c,d|u,s,v):m))return!1}}return!0}(e,0,i)}):function(e){return l.isKey(e)?(t=l.toKey(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return l.baseGet(t,e)}}(e);var t}(e);var t,i,s,o}function g(e,t,i,s){for(var r=-1,n=null==e?0:e.length;++r<n;){var o=e[r];t(s,o,i(o),e)}return s}var w=function(e,t,i){for(var s=-1,r=Object(e),n=i(e),o=n.length;o--;){var a=n[++s];if(!1===t(r[a],a,r))break}return e},L=function(e,t){if(null==e)return e;if(!r.isArrayLike(e))return function(e,t){return e&&w(e,t,r.keys)}(e,t);for(var i=e.length,s=-1,n=Object(e);++s<i&&!1!==t(n[s],s,n););return e};function b(e,t,i,s){return L(e,(function(e,r,n){t(s,e,i(e),n)})),s}var E,B,I=(E=function(e,t,i){e[i?0:1].push(t)},B=function(){return[[],[]]},function(e,t){var i=h.isArray(e)?g:b,s=B?[[],[]]:{};return i(e,E,f(t),s)});const M="pick-list-message",k=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisLayerInputPopoverClose=t.createEvent(this,"analysisLayerInputPopoverClose",7),this.analysisLayerInputPopoverSelectionChange=t.createEvent(this,"analysisLayerInputPopoverSelectionChange",7),this.analysisLayerInputPopoverLayerBrowsed=t.createEvent(this,"analysisLayerInputPopoverLayerBrowsed",7),this.checkForMatchingLayer=()=>{var e,t,i,s;this.calciteFilterSearchTerm=null===(e=this.picklist)||void 0===e?void 0:e.filterText,this.noSearchedLayersMessageActive=0===(null===(i=null===(t=this.picklist)||void 0===t?void 0:t.filteredItems)||void 0===i?void 0:i.length)&&0!==(null===(s=this.picklist)||void 0===s?void 0:s.filterText.length)},this.buildPickListItem=e=>t.h("calcite-pick-list-item",{key:e.id,value:e.id,label:i.getLayerLabel(e),description:i.isFeatureLayer(e)?i.isTableLayer(e)?this.strings.table:this.strings[e.geometryType]:"",selected:void 0!==this.selectedLayerIds&&this.selectedLayerIds.includes(e.id),onClick:this.onPickListChange}),this.openItemBrowser=()=>{var e;null===(e=this.itemBrowserElement)||void 0===e||e.remove(),this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.heading,this.itemBrowserElement.filter=this.itemBrowserFilter,this.itemBrowserElement.allowedGeometries=this.itemBrowserAllowedGeometries,this.itemBrowserElement.layerFilterType=this.layerFilterType,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.user=this.user,this.itemBrowserElement.selectionMode="multi"!==this.selectionMode?"single-sublayer":"multiple-sublayer",this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.popoverElement.autoClose=!1,this.popoverElement.hidden=!0,document.body.appendChild(this.itemBrowserElement)},this.closeModals=()=>{this.popoverElement.autoClose=!0,this.popoverElement.hidden=!1,void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.removeEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.addLayersToMap=(e,t)=>{const s=I(t,(e=>i.isTableLayer(e)));e.addMany(s[1]),e.tables.addMany(s[0])},this.handleItemBrowserAddToMap=e=>{this.addLayersToMap(this.mapView.map,e.detail),this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.handleItemBrowserSelection=e=>{this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.onPickListChange=async()=>{var e;const t=await(null===(e=this.picklist)||void 0===e?void 0:e.getSelectedItems());this.analysisLayerInputPopoverSelectionChange.emit({selectedLayers:t}),"multi"!==this.selectionMode&&(this.open=!1)},this.mapLayers=void 0,this.analysisSessionLayers=[],this.hideBrowseButton=!1,this.showNoticeMessage=!1,this.noticeMessage=void 0,this.selectionMode=void 0,this.referenceElement=void 0,this.placement="auto",this.open=void 0,this.selectedLayerIds=void 0,this.popoverWidth=void 0,this.user=void 0,this.portal=void 0,this.mapView=void 0,this.itemBrowserAllowedGeometries=void 0,this.itemBrowserFilter="",this.layerFilterType=void 0,this.noSearchedLayersMessageActive=!1,this.calciteFilterSearchTerm=void 0}get bucketOptions(){const e=["my","favorites","group","org","all"];return!0===this.portal.isPortal&&this.portal.sourceJSON.portalDeploymentType===i.PortalDeploymentType.Kubernetes||e.splice(4,0,"living atlas analysis"),e}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await i.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath(".")))}componentDidLoad(){this.focusTimeoutId=setTimeout((async()=>{var e,t;await(null===(t=null===(e=this.picklist)||void 0===e?void 0:e.setFocus)||void 0===t?void 0:t.call(e,"filter"))}),i.UIDefaults.PopoverTimer),setTimeout((()=>{var e,t;null===(t=null===(e=this.popoverElement)||void 0===e?void 0:e.reposition)||void 0===t||t.call(e)}),i.UIDefaults.PopoverTimer)}disconnectedCallback(){void 0!==this.focusTimeoutId&&clearTimeout(this.focusTimeoutId),this.closeModals()}async reposition(){var e,t;await(null===(t=null===(e=this.popoverElement)||void 0===e?void 0:e.reposition)||void 0===t?void 0:t.call(e))}render(){var e,s,r,n,o,a,l,h,c,d,u;const p=null!==(e=this.popoverWidth)&&void 0!==e?e:null===(s=this.referenceElement)||void 0===s?void 0:s.getBoundingClientRect().width,m=i.formatMessage(this.strings.noMatchesFound,{searchTerm:null!==(r=this.calciteFilterSearchTerm)&&void 0!==r?r:""}),v=0===(null===(n=this.analysisSessionLayers)||void 0===n?void 0:n.length)&&0===(null===(o=this.mapLayers)||void 0===o?void 0:o.length),y=!0===this.hideBrowseButton;return t.h(t.Host,{dir:this.dir,class:"analysis-popover js-app-flyout"},t.h("calcite-popover",{ref:e=>{this.popoverElement=e},style:{width:void 0!==p?`${p}px`:void 0},autoClose:!0,closable:!0,heading:this.strings.heading,referenceElement:null!==(a=this.referenceElement)&&void 0!==a?a:"analysis-layer-input",placement:this.placement,open:this.open,label:"",focusTrapDisabled:!0,onCalcitePopoverClose:()=>this.analysisLayerInputPopoverClose.emit()},t.h("calcite-panel",null,t.h("calcite-pick-list",{class:"popover-content",multiple:"multi"===this.selectionMode,filterEnabled:!0,ref:e=>{this.picklist=e},onCalciteListFilter:this.checkForMatchingLayer},t.h("calcite-notice",{open:this.showNoticeMessage,class:"half-margin",kind:"warning",scale:i.UIDefaults.Scale},t.h("div",{slot:"message"},null===(l=Array.from(new Set(this.noticeMessage)))||void 0===l?void 0:l.map((e=>t.h("p",{innerHTML:e}))))),this.noSearchedLayersMessageActive&&t.h("p",{class:M},m),v&&!1===this.noSearchedLayersMessageActive?t.h("p",{class:M},this.strings.noCompatibleLayers):t.h("div",null,t.h("calcite-pick-list-group",{"group-title":this.strings.analysisSessionLayers,hidden:0===(null===(h=this.analysisSessionLayers)||void 0===h?void 0:h.length)},(null!==(c=this.analysisSessionLayers)&&void 0!==c?c:[]).map((e=>this.buildPickListItem(e)))),t.h("calcite-pick-list-group",{"group-title":this.strings.mapLayers,hidden:0===(null===(d=this.mapLayers)||void 0===d?void 0:d.length)},(null!==(u=this.mapLayers)&&void 0!==u?u:[]).map((e=>this.buildPickListItem(e)))))),!y&&t.h("calcite-button",{slot:"footer-actions",appearance:"transparent",width:"full",onClick:this.openItemBrowser},this.strings.browseAnalysisLayers))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-ui-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height:30vh;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.fab{justify-content:center;padding:var(--analysis-half-spacing)}.half-margin{margin:var(--analysis-half-spacing)}.pick-list-message{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}"}},[1,"analysis-layer-input-popover",{mapLayers:[16],analysisSessionLayers:[16],hideBrowseButton:[516,"hide-browse-button"],showNoticeMessage:[4,"show-notice-message"],noticeMessage:[16],selectionMode:[513,"selection-mode"],referenceElement:[16],placement:[513],open:[1540],selectedLayerIds:[16],popoverWidth:[514,"popover-width"],user:[16],portal:[16],mapView:[16],itemBrowserAllowedGeometries:[16],itemBrowserFilter:[513,"item-browser-filter"],layerFilterType:[1,"layer-filter-type"],noSearchedLayersMessageActive:[32],calciteFilterSearchTerm:[32],reposition:[64]}]);function T(){"undefined"!=typeof customElements&&["analysis-layer-input-popover","analysis-item-browser"].forEach((e=>{switch(e){case"analysis-layer-input-popover":customElements.get(e)||customElements.define(e,k);break;case"analysis-item-browser":customElements.get(e)||s.defineCustomElement()}}))}T(),e.AnalysisLayerInputPopover=k,e.defineCustomElement=T,e.hasIn=y}));