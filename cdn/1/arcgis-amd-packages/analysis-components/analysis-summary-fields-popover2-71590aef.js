define(["exports","./index-86304dcd","./index2-600fb1b2","./utils-2b3d82c1"],(function(e,t,s,i){"use strict";const l="fields-message",a=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisSummaryFieldSelectionDone=t.createEvent(this,"analysisSummaryFieldSelectionDone",6),this.analysisSummaryFieldPopoverClose=t.createEvent(this,"analysisSummaryFieldPopoverClose",7),this.hasEmptySearchResults=!1,this.onSelectionDone=()=>{this.analysisSummaryFieldSelectionDone.emit(this.selection),this.open=!1},this.onCalciteListChange=e=>{const t=e.detail;this.selection=new Set(t.keys())},this.handleSelectAllClick=()=>{var e;this.showSelectAllString?this.selection=new Set(null===(e=this.fields)||void 0===e?void 0:e.map((e=>e.name))):this.selection=new Set},this.handleCalciteListFilterChange=e=>{const t=e.target;this.hasEmptySearchResults=0===t.filteredData.length,this.searchString=t.filterText},this.renderMessages=()=>{var e,i,a,n;const{noInputSelected:o,noFieldsAvailable:r,noSearchResults:h}=this.strings,c=!0===s.isEmptyDataItem(this.layer)&&t.h("calcite-label",{class:l},null!==(e=this.noLayersText)&&void 0!==e?e:s.formatMessage(void 0!==this.layerInputLocalizedLabel?o.withLayerInputLabel:o.withoutLayerInputLabel,{layerInputLabel:this.layerInputLocalizedLabel})),d=!1===s.isEmptyDataItem(this.layer)&&0===(null===(i=this.fields)||void 0===i?void 0:i.length)&&t.h("calcite-label",{class:l},null!==(a=this.noFieldsText)&&void 0!==a?a:s.formatMessage(r,{layerName:null===(n=this.layer)||void 0===n?void 0:n.title})),p=this.noSearchResults&&t.h("calcite-label",{class:l},s.formatMessage(h,{searchValue:this.searchString}));return t.h("div",null,c,d,p)},this.renderFields=()=>{var e;return t.h("calcite-pick-list",{class:"popover-content",multiple:!0,onCalciteListChange:this.onCalciteListChange,filterEnabled:!0,onCalciteListFilter:this.handleCalciteListFilterChange},this.shouldDisplaySelectAllButton&&t.h("calcite-button",{class:"toggle-select-all-button",appearance:"transparent",round:!0,onClick:this.handleSelectAllClick,scale:i.UIDefaults.Scale},this.showSelectAllString?this.strings.selectAll:this.strings.deselectAll),null===(e=this.fields)||void 0===e?void 0:e.map((e=>{const{name:s,alias:i,type:l,description:a}=e;return t.h("calcite-pick-list-item",{selected:this.selection.has(s),key:s,value:s,label:i,description:this.showFieldDescription?a:`{${s}}`,"data-field-type":l})})),this.renderMessages())},this.layer=void 0,this.layerInputLocalizedLabel=void 0,this.noFieldsText=void 0,this.noLayersText=void 0,this.showFieldDescription=!1,this.usePopupTemplatesInfo=!0,this.allowDateType=!1,this.allowStringType=!1,this.allowBigIntType=!1,this.selection=new Set,this.referenceElement=void 0,this.open=void 0,this.showSelectAllString=!0,this.searchString=void 0}async layerChange(){void 0!==this.layer?(this.fields=await s.fetchLayerFieldsInfo(this.layer,this.usePopupTemplatesInfo),this.fields=s.filterFields({fields:this.fields,layer:this.layer,allowNumericType:!0,allowOidType:!1,allowDateType:this.allowDateType,allowStringType:this.allowStringType,allowBigIntType:this.allowBigIntType,allowGeometryFields:!1})):this.fields=[]}onSelectionChange(){var e;this.showSelectAllString=this.selection.size!==(null===(e=this.fields)||void 0===e?void 0:e.length)}get noSearchResults(){return""!==this.searchString&&this.hasEmptySearchResults}get shouldDisplaySelectAllButton(){var e,t;return(null!==(t=null===(e=this.fields)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>0&&!this.noSearchResults}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),await this.layerChange(),this.onSelectionChange()}componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.summaryFieldsPopover)||void 0===e?void 0:e.setFocus()}))),1),setTimeout((()=>{var e,t;null===(t=null===(e=this.summaryFieldsPopover)||void 0===e?void 0:e.reposition)||void 0===t||t.call(e)}),i.UIDefaults.PopoverTimer)}async reposition(){var e,t;await(null===(t=null===(e=this.summaryFieldsPopover)||void 0===e?void 0:e.reposition)||void 0===t?void 0:t.call(e))}render(){var e;const s=null===(e=this.referenceElement)||void 0===e?void 0:e.offsetWidth;return t.h(t.Host,{dir:this.dir,class:"analysis-popover js-app-flyout "+("rtl"===this.dir?"analysis--rtl":"")},t.h("calcite-popover",{style:{width:void 0!==s?`${s}px`:void 0},ref:e=>{this.summaryFieldsPopover=e},autoClose:!0,label:this.strings.summaryFieldsPopover,referenceElement:this.referenceElement,placement:"trailing",closable:!0,heading:this.strings.addField,open:this.open,focusTrapDisabled:!0,onCalcitePopoverClose:()=>this.analysisSummaryFieldPopoverClose.emit()},t.h("calcite-panel",null,this.renderFields(),t.h("calcite-button",{slot:"footer",width:"full",name:"done",scale:"m",onClick:this.onSelectionDone},this.strings.done))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{layer:["layerChange"],usePopupTemplatesInfo:["layerChange"],selection:["onSelectionChange"]}}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-ui-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height:30vh;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.toggle-select-all-button{margin:0;margin-left:var(--analysis-quarter-spacing);margin-bottom:var(--analysis-quarter-spacing)}.chip-group{margin:var(--analysis-quarter-spacing)}.fields-message{margin:var(--analysis-half-spacing)}:host(.analysis--rtl) .toggle-select-all-button{margin:0;margin-right:var(--analysis-quarter-spacing);margin-top:var(--analysis-quarter-spacing)}"}},[1,"analysis-summary-fields-popover",{layer:[16],layerInputLocalizedLabel:[1,"layer-input-localized-label"],noFieldsText:[1,"no-fields-text"],noLayersText:[1,"no-layers-text"],showFieldDescription:[4,"show-field-description"],usePopupTemplatesInfo:[516,"use-popup-templates-info"],allowDateType:[516,"allow-date-type"],allowStringType:[516,"allow-string-type"],allowBigIntType:[516,"allow-big-int-type"],selection:[1040],referenceElement:[16],open:[1540],showSelectAllString:[32],searchString:[32],reposition:[64]}]);function n(){"undefined"!=typeof customElements&&["analysis-summary-fields-popover"].forEach((e=>{"analysis-summary-fields-popover"===e&&(customElements.get(e)||customElements.define(e,a))}))}n(),e.AnalysisSummaryFieldsPopover=a,e.defineCustomElement=n}));