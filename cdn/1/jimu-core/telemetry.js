System.register(["jimu-core"],function(e,t){var r={};return{setters:[function(e){r.EConsentMode=e.EConsentMode,r.getAppStore=e.getAppStore,r.utils=e.utils}],execute:function(){e((()=>{"use strict";var e={423:(e,t,r)=>{function i(e={}){const{disabled:t,portal:r}=e;return!(!t&&!1!==(null==r?void 0:r.eueiEnabled))||!(!r||function(e){return e.eueiEnabled&&e.user&&e.user.orgId===e.id}(r)||function(e){return e.user&&!e.user.orgId&&"US"===e.ipCntryCode}(r)||function(e){return!e.user&&"US"===e.ipCntryCode}(r))}r.d(t,{$:()=>i})},1635:(e,t,r)=>{r.d(t,{Tt:()=>i});function i(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(r[i[s]]=e[i[s]])}return r}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError},3463:(e,t,r)=>{r.d(t,{$I:()=>s,Bf:()=>n});const i="esri-telemetry";function s(e){return new Promise((t,r)=>{e.onload=t,e.onerror=r;const s=function(e){const{body:t,src:r,id:s,dataAttribute:o,section:a="body",type:l="text/javascript",async:c=!1,defer:d=!1,onload:u,onerror:g}=e;if("undefined"==typeof window)throw new n("Window is undefined: Cannot add script element.");if(function(e){const{id:t,dataAttribute:r}=e;return!!document.getElementById(t)||!!document.querySelector(`[data-${i}="${r}"]`)}(e))return void console.log(`script (${s||o}) is already present, skipping`);const p=function({id:e,dataAttribute:t,type:r,async:s,defer:n,body:o,src:a,onload:l,onerror:c}){const d=document.createElement("script");e&&(d.id=e);t&&d.setAttribute(`data-${i}`,t);return a&&(d.src=a),o&&(d.innerText=o),d.type=r,d.async=s,d.defer=n,l&&(d.onload=l),c&&(d.onerror=c),d}({id:s,dataAttribute:o,type:l,async:c,defer:d,body:t,src:r,onload:u,onerror:g});return"body"===a?document.body.appendChild(p):document.head.appendChild(p)}(e);s&&!e.body||t()})}class n extends Error{}},5787:(e,t,r)=>{function i(e){return e.map(e=>{const t=[];return["src","id","dataAttribute","type"].forEach(r=>{let i=r;"dataAttribute"===r&&(i="data-esri-telemetry"),e[r]&&t.push(`${i}="${e[r]}"`)}),["async","defer"].forEach(r=>{e[r]&&t.push(`${r}`)}),`<script ${t.join(" ")}>${e.body?e.body:""}<\/script>`}).join("")}r.d(t,{J:()=>i})},9244:e=>{e.exports=r}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};i.r(s),i.d(s,{GoogleAnalytics:()=>p,Telemetry:()=>u,getCookieBannerStorageKey:()=>m,getCookieConfirmations:()=>h,isAllowedToTrack:()=>b});var n=i(9244),o=i(423);const a={storage:{},memory:!0,get(e){let t;try{t=window.localStorage&&window.localStorage.getItem(e)||this.storage[e]}catch(r){t=this.storage[e]}if(t)try{return JSON.parse(t)}catch(e){return}},set(e,t){const r=JSON.stringify(t);try{window.localStorage.setItem(e,r)}catch(r){this.memory||(console.error("setting local storage failed, falling back to in-memory storage"),this.memory=!0),this.storage[e]=t}},delete(e){try{window.localStorage.removeItem(e)}catch(t){this.memory||(console.error("setting local storage failed, falling back to in-memory storage"),this.memory=!0),delete this.storage[e]}}};var l=i(3463),c=i(5787);const d=["esri.com","esriuk.com","esri.de","esri.ca","esrifrance.fr","esri.nl","esri-portugal.pt","esribulgaria.com","esri.fi","esri.kr","esrimalaysia.com.my","esri.es","esriaustralia.com.au","esri-southafrica.com","esri.cl","esrichina.com.cn","esri.co","esriturkey.com.tr","geodata.no","esriitalia.it","esri.pl"];class u{constructor(e){var t,r,i;this.trackers=[],this.options=e,this.debug=e.debug,this.suppressDisabledWarnings=e.suppressDisabledWarnings,this.disabled=(0,o.$)(e),this.logger=e.logger||console,this.disabled&&!this.suppressDisabledWarnings&&this.logger.info("Telemetry Disabled");const s=(null===(t=e.portal)||void 0===t?void 0:t.user)||e.user;s&&this.setUser(s,null===(i=null===(r=e.portal)||void 0===r?void 0:r.subscriptionInfo)||void 0===i?void 0:i.type),this.disabled||this.initializeTrackers()}initializeTrackers(){this.options.plugins&&this.trackers.push(...this.options.plugins),this.trackers.length||this.logger.error(new Error("No trackers configured"))}getScriptTags(){return this.trackers.map(e=>e.getScriptTags&&e.getScriptTags()).join("")}async init(){const e=this.trackers.map(e=>e.init());await Promise.all(e)}setUser(e={},t="Public"){let r;if(e="string"==typeof e?{username:e}:e,this.user=e,this.user.accountType=t,e.email&&e.email.split){const t=e.email.split("@")[1];r=d.filter(e=>t===e).length>0}(r||["In House","Demo and Marketing"].indexOf(t)>-1)&&(this.user.internalUser=!0)}logPageView(e,t={},r={}){if(this.disabled&&!this.suppressDisabledWarnings)return this.logger.info("Page view was not logged because telemetry is disabled."),!1;const i=this.trackers.filter(({disabled:e,hasError:t})=>!e&&!t);if(!i.length)return this.logger.warn("Page view was not logged because no enabled telemetry-plugins are registered."),!1;const s=this.preProcess(t,r);this.debug&&this.logger.info("Tracking page view",JSON.stringify(s));const n=i.map(t=>t.logPageView(e,s));return Promise.all(n).then(),!0}logEvent(e,t={}){if(this.disabled&&!this.suppressDisabledWarnings)return this.logger.info("Event was not logged because telemetry is disabled."),!1;const r=this.trackers.filter(({disabled:e,hasError:t})=>!e&&!t);if(!r.length)return this.logger.warn("Event was not logged because no enabled telemetry-plugins are registered."),!1;const i=this.preProcess(e,t);this.debug&&this.logger.info("Tracking event",JSON.stringify(i));const s=r.map(e=>e.logEvent(i));return Promise.all(s).then(),!0}logError(e={}){e=Object.assign({eventType:"error"},e),this.logEvent(e)}startWorkflow(e,t={}){const r={name:e,start:Date.now(),steps:[],workflowId:Math.floor(17592186044416*(1+Math.random())).toString(16)};this.saveWorkflow(r);const i=Object.assign({name:e,step:"start"},t);return this.logWorkflow(i),r}stepWorkflow(e,t,r={}){const i="string"==typeof r?r:r.details,s=Object.assign({name:e,step:t,details:i},r);this.logWorkflow(s)}endWorkflow(e,t={}){const r=Object.assign({name:e,step:"finish"},t);this.logWorkflow(r)}cancelWorkflow(e,t={}){const r=Object.assign({name:e,step:"cancel"},t);this.logWorkflow(r)}getWorkflow(e){const t=a.get(`TELEMETRY-WORKFLOW:${e}`);if(t){if(Date.now()-t.start<18e5)return t;this.deleteWorkflow(t)}}saveWorkflow(e){a.set(`TELEMETRY-WORKFLOW:${e.name}`,e)}deleteWorkflow(e){a.delete(`TELEMETRY-WORKFLOW:${e.name}`)}logWorkflow(e={}){e=this.preProcess(e);let t=this.getWorkflow(e.name);t||(this.startWorkflow(e.name),t=this.getWorkflow(e.name)),t.steps.push(e.step),t.duration=(Date.now()-t.start)/1e3,["cancel","finish"].indexOf(e.step)>-1?this.deleteWorkflow(t):this.saveWorkflow(t);const r=Object.assign(e,{eventType:"workflow",category:e.name,action:e.step,label:e.details,duration:t.duration,workflowId:t.workflowId});this.logEvent(r)}preProcess(e={},t={}){let r={};return this.user&&(r={user:"unknown",org:"unknown",lastLogin:this.user.lastLogin,userSince:this.user.created,internalUser:this.user.internalUser||!1,accountType:this.user.accountType}),Object.entries(Object.assign(Object.assign({},e),r)).reduce((i=t.omitComplexData,s=this.logger,function(e,[t,r]){return function(e){return["string","number","boolean","undefined"].includes(typeof e)||e&&"string"==typeof e.valueOf()}(r)?e[t]=r:i||(s.warn(`You are trying to log a non-primitive value, ${t}:${JSON.stringify(r)}. This will get logged as [object Object]`),e[t]=r),e}),{});var i,s}disableTracker(e){var t;const r=this.trackers.find(({name:t})=>t===e);r&&!r.hasError&&(r.disabled=!0,null===(t=r.disable)||void 0===t||t.call(r))}enableTracker(e){var t;const r=this.trackers.find(({name:t})=>t===e);r&&!r.hasError&&(r.disabled=!1,null===(t=r.enable)||void 0===t||t.call(r))}}var g=i(1635);class p{constructor(e){var t;if(this.name="googleAnalytics",this.dimensions={},this.metrics={},"undefined"!=typeof window&&!(null===(t=null==e?void 0:e.measurementIds)||void 0===t?void 0:t.length))throw new Error("at least one measurementId needs to be provided in your configuration");Object.assign(this,e)}_getScripts(){return[{dataAttribute:"google-analytics",async:!0,src:`https://www.googletagmanager.com/gtag/js?id=${this.measurementIds?this.measurementIds[0]:""}`}]}getScriptTags(){return(0,c.J)(this._getScripts())}async init(){if("undefined"==typeof window)throw new l.Bf("Window is undefined: Cannot add script element.");await Promise.all(this._getScripts().map(e=>(0,l.$I)(e))),this.injectConfig()}logPageView(e,t={}){const r=this.buildCustomParams(t),i=Object.assign({page_title:e||window.location.pathname},r);return window.gtag("event","page_view",i),!0}logEvent(e){let{action:t}=e,r=(0,g.Tt)(e,["action"]);const i=t||"other",s=this.buildCustomParams(r);return window.gtag("event",i,s),!0}disable(){this.measurementIds&&this.measurementIds.forEach(e=>{window[`ga-disable-${e}`]=!0})}enable(){this.measurementIds&&this.measurementIds.forEach(e=>{window[`ga-disable-${e}`]=void 0})}injectConfig(){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date);const e={custom_map:this.createDimensionsAndMetricsCustomMap(this.dimensions,this.metrics),send_page_view:!1,anonymize_ip:!0};this.measurementIds.forEach(t=>{window.gtag("config",t,e)})}buildCustomParams(e){let t,{category:r,label:i}=e;return t=this.verifyCustomDimensionAndMetrics(e),r&&(t=Object.assign(Object.assign({},t),{event_category:r})),i&&(t=Object.assign(Object.assign({},t),{event_label:i})),t}verifyCustomDimensionAndMetrics(e){const t=this.createDimensionsAndMetricsCustomMap(this.dimensions,this.metrics),r=Object.values(t);return Object.keys(e).filter(e=>r.includes(e)).reduce((t,r)=>Object.assign(t,{[r]:e[r]}),{})}createDimensionsAndMetricsCustomMap(e={},t={}){const r=this.createMetricCustomMap(t),i=this.createDimensionCustomMap(e);return Object.assign(Object.assign({},r),i)}createMetricCustomMap(e={}){return Object.keys(e).map(function(t){return{key:`metric${e[t]}`,value:t}}).filter(e=>e).reduce((e,{key:t,value:r})=>(e[t]=r,e),{})}createDimensionCustomMap(e={}){return Object.keys(e).map(function(t){return{key:`dimension${e[t]}`,value:t}}).filter(e=>e).reduce((e,{key:t,value:r})=>(e[t]=r,e),{})}}function m(){return`${n.utils.getLocalStorageAppKey()}-cookie-confirmations`}function f(){var e,t;const r=m(),i=n.utils.readLocalStorage(r);let s=null;if(s=window.jimuConfig.isInBuilder?(0,n.getAppStore)().getState().appStateInBuilder.appConfig:(0,n.getAppStore)().getState().appConfig,i){const r=JSON.parse(i).confirmTime;return!((null===(e=null==s?void 0:s.cookieBanner)||void 0===e?void 0:e.renewTime)&&r<(null===(t=null==s?void 0:s.cookieBanner)||void 0===t?void 0:t.renewTime))}return!1}function h(){return f()?JSON.parse(n.utils.readLocalStorage(m())):null}function b(){var e,t,r;let i=null;if(i=window.jimuConfig.isInBuilder?null===(e=(0,n.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appConfig:(0,n.getAppStore)().getState().appConfig,(null===(t=null==i?void 0:i.cookieBanner)||void 0===t?void 0:t.enable)&&(null===(r=null==i?void 0:i.cookieBanner)||void 0===r?void 0:r.consentMode)===n.EConsentMode.Required){if(!f())return!1;if(!h().performance)return!1}return!0}return s})())}}});