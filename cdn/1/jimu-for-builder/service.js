System.register(["jimu-core","jimu-for-builder/templates"],(function(e,t){var n={},i={};return{setters:[function(e){n.Immutable=e.Immutable,n.SessionManager=e.SessionManager,n.USER_SETTING_FILE_KEY=e.USER_SETTING_FILE_KEY,n.appConfigUtils=e.appConfigUtils,n.esri=e.esri,n.getAppStore=e.getAppStore,n.i18n=e.i18n,n.moduleLoader=e.moduleLoader,n.portalUrlUtils=e.portalUrlUtils,n.semver=e.semver,n.sharedThemeUtils=e.sharedThemeUtils,n.urlUtils=e.urlUtils,n.utils=e.utils,n.version=e.version},function(e){i.TemplateType=e.TemplateType,i.getTemplateConfig=e.getTemplateConfig}],execute:function(){e((()=>{"use strict";var e={891:e=>{e.exports=n},262:e=>{e.exports=i}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{o.r(r),o.d(r,{AppType:()=>s,PublishStatus:()=>u,SearchType:()=>i,appServices:()=>t,getResourceOrigin:()=>ge,userServices:()=>n});var e={};o.r(e),o.d(e,{addItemResource:()=>D,checkItemVersion:()=>w,createItem:()=>P,getItem:()=>A,getItemData:()=>O,getItemResource:()=>T,getItemResources:()=>I,getOriginUrl:()=>p,getRequestMethod:()=>y,getUserContentUrl:()=>m,getUserName:()=>g,importItem:()=>j,removeItem:()=>k,removeItemResource:()=>M,request:()=>f,searchItems:()=>d,updateItem:()=>R,updateItemResource:()=>L});var t={};o.r(t),o.d(t,{addToFavorites:()=>tt,changeAppFolder:()=>ot,checkImportAppVersion:()=>_e,createAppByDefaultTemplate:()=>Ce,createAppByItemTemplate:()=>Re,createAppByTemplateId:()=>Le,createTemplateByApp:()=>De,deleteApp:()=>Ye,duplicateApp:()=>Fe,getAppConfig:()=>Be,getAppGroups:()=>it,getAppInfo:()=>Ve,getDefaultTemplateConfig:()=>ut,getFolders:()=>et,getGroupCategorySchema:()=>Je,getGroupContent:()=>He,getOrgCategorySchema:()=>We,getUserTags:()=>rt,importAppFromPortal:()=>qe,importItem:()=>Ge,publishApp:()=>ze,removeFromFavorites:()=>nt,saveApp:()=>Ze,saveAsApp:()=>Ne,searchApp:()=>Ke,searchGroups:()=>st,updateAppInfo:()=>Qe,updateAppThumbnail:()=>Xe});var n={};o.r(n),o.d(n,{addUserResource:()=>ht,getUserResource:()=>pt,getUserResources:()=>mt,initUserResource:()=>St,removeUserResource:()=>gt,updateUserResource:()=>yt});var i,s,u,c=o(891);!function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(i||(i={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(s||(s={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(u||(u={}));var a=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function d(e,t=i.Other){return a(this,void 0,void 0,(function*(){return yield l(e,"item",t)}))}function l(e,t,n=i.Other){return a(this,void 0,void 0,(function*(){let o,r;return o=`${n===i.AGOL?"https://www.arcgis.com":window.location.origin}/sharing/rest/search`,r="string"==typeof e||e instanceof c.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:c.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f"]),yield f(o,r,"GET").then((n=>(n.nextStart&&-1!==n.nextStart&&(n.nextPage=function(){return a(this,void 0,void 0,(function*(){let i;return"string"==typeof e||e instanceof c.esri.restPortal.SearchQueryBuilder?i={q:e,start:n.nextStart}:(i=e,i.start=n.nextStart),yield l(i,t)}))}),n)))}))}var v=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function f(e,t={params:{f:"json"}},n="POST"){return v(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t.params);return yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>v(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>v(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===n?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then((e=>v(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>v(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then((e=>v(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>v(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(null)}))}const h=c.esri.restRequest.request;function p(e=!1){return e?c.urlUtils.getArcgisOnlineUrl():window.location.origin}function m(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}function g(){var e;return null===(e=(0,c.getAppStore)().getState().user)||void 0===e?void 0:e.username}function y(e=!1){return e?h:f}function S(e){const t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}var b=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function P(e){return b(this,void 0,void 0,(function*(){const t=Object.assign({folderId:null},e);return yield function(e){var t,n;return b(this,void 0,void 0,(function*(){if(e.file&&!e.multipart)return yield Promise.reject(new Error("The request must be a multipart request for file uploading."));if(e.multipart&&!e.filename)return yield Promise.reject(new Error("The file name is required for a multipart request."));const i=g(),o=`${p()}${m()}addItem`;e.params=Object.assign(Object.assign(Object.assign({},e.params),S(e.item)),{portalUrl:null===(n=null===(t=(0,c.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl});const r=c.esri.restRequest.appendCustomParams(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return r.params.username=i,yield f(o,r)}))}(t)}))}function j(e,t){return b(this,void 0,void 0,(function*(){const n=`${p()}${m()}importItem`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const i=Object.keys(t.params),o=new FormData;for(let e=0;e<i.length;e++)o.append(i[e],t.params[i[e]]);return t.params=o,yield f(n,t)}))}function w(e,t){return b(this,void 0,void 0,(function*(){const n=`${p()}${m()}checkItemVersion`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const i=Object.keys(t.params),o=new FormData;for(let e=0;e<i.length;e++)o.append(i[e],t.params[i[e]]);return t.params=o,yield f(n,t)}))}var U=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function O(e,t,n=!1){return U(this,void 0,void 0,(function*(){const i=`${p(n)}${m(n)}items/${e}/data`,o=Object.assign({params:{}},t);o.file&&(o.params.f=null),n&&!x()&&delete o.authentication;const r=y(n);return yield r(i,o).catch((e=>{if(!/Unexpected end of (JSON input|data at line 1 column 1)/i.test(e.message))throw e}))}))}function A(e,t,n=!1){return U(this,void 0,void 0,(function*(){const i=`${p(n)}${m(n)}items/${e}`,o=Object.assign({},t);n&&!x()&&delete o.authentication;const r=y(n);return yield r(i,o)}))}function I(e,t,n=!1){return U(this,void 0,void 0,(function*(){const i=`${p(n)}${m(n)}items/${e}/resources`;t.params=Object.assign(Object.assign({},t.params),{num:1e3}),n&&!x()&&delete t.authentication;const o=y(n);return yield o(i,t,"GET")}))}function T(e,t,n=!1){return U(this,void 0,void 0,(function*(){const i=t.fileName,o=`${p(n)}${m(n)}items/${e}/resources/${i}`;n&&!x()&&delete t.authentication;const r=y(n);return yield r(o,t,"GET")}))}function x(){const e=(0,c.getAppStore)().getState().portalUrl;return c.portalUrlUtils.isAGOLDomain(e)}var $=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function k(e){return $(this,void 0,void 0,(function*(){const t=g(),n=p();e.userName=t;const i=`${n}${m()}items/${e.id}/delete`;return yield f(i,e)}))}function M(e){return $(this,void 0,void 0,(function*(){const t=`${p()}${m()}items/${e.id}/removeResources`;return e.params=Object.assign(Object.assign({},e.params),{resource:e.resource}),yield f(t,e)}))}var E=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function R(e){return E(this,void 0,void 0,(function*(){const t=g(),n=p();e.userName=t;const i=`${n}${m()}items/${e.item.id}/update`;if(e.params=Object.assign(Object.assign({},e.params),S(e.item)),e.item.thumbnail&&"string"!=typeof e.item.thumbnail){e.params=Object.assign(Object.assign({},e.params),e.item);const t=Object.keys(e.params),n=new FormData;for(let i=0;i<t.length;i++)n.append(t[i],e.params[t[i]]);e.params=n}return yield f(i,e)}))}function L(e){return E(this,void 0,void 0,(function*(){const t=`${p()}${m()}items/${e.id}/updateResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource,void 0!==e.private&&(e.params.access=e.private?"private":"inherit");const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield f(t,e)}))}var C=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function D(e){return C(this,void 0,void 0,(function*(){const t=`${p()}${m()}items/${e.id}/addResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content,access:e.private?"private":"inherit"},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource;const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield f(t,e)}))}var G=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};const _=c.SessionManager.getInstance().isTrustedServer((0,c.getAppStore)().getState().portalUrl);function q(e,t={f:"json"},n="POST"){return G(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t);return yield fetch(n,{credentials:_?"include":"same-origin",method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>G(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>G(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===n?t&&"FormData"===t.constructor.name?yield fetch(e,{credentials:_?"include":"same-origin",method:"POST",body:t}).then((e=>G(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>G(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{credentials:_?"include":"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>G(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>G(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(null)}))}var F=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function N(e=!1){return e?c.urlUtils.getArcgisOnlineUrl():window.location.origin}var B=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};var K=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))},V=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))},J=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))},W=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function H(){const e=(0,c.getAppStore)().getState().portalUrl;return c.portalUrlUtils.isAGOLDomain(e)}const Q={frameworkAction_TriggerLayer:"Trigger data",frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy"};var X=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};const Y=c.esri.restRequest.request;function Z(e){var t,n;if(!(null==e?void 0:e.portalUrl))return!window.jimuConfig.isDevEdition;const i=(null==e?void 0:e.portalUrl)||"",o=(null===(n=null===(t=(0,c.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl)||"",r=(null==o?void 0:o.includes(i))||(null==i?void 0:i.includes(o));return(c.portalUrlUtils.isAGOLDomain(i)&&c.portalUrlUtils.isAGOLDomain(o)||r)&&!ee(e)}function z(e){if(!(null==e?void 0:e.portalUrl))return!1;const t=(null==e?void 0:e.portalUrl)||"",n=c.portalUrlUtils.isAGOLDomain(t),i=!Z(e),o=!ee(e);return i&&o&&n}function ee(e){return!!((null==e?void 0:e.portalUrl)||"").endsWith("localhost:")||e.isLocalApp}function te(e){if(ee(e))return{};const t=c.SessionManager.getInstance().getMainSession();return Z(e)?t:{}}function ne(e,t=!1,n=""){return X(this,void 0,void 0,(function*(){const o=c.SessionManager.getInstance().getMainSession();let r=null;const u=(null==n?void 0:n.includes("Template"))?s.TemplateType:s.ExperienceType;return yield Ke({q:`type: "${u}" AND owner:${null==o?void 0:o.username} AND  title:"${e}"`,sortField:"modified",sortOrder:"desc"},i.Other).then((n=>X(this,void 0,void 0,(function*(){const i=n.results;if(i&&i.length>0){const n=function(e,t){const n=[],i=/^[\d]+$/;return e.forEach((e=>{var o,r;const s=null===(r=null===(o=e.title)||void 0===o?void 0:o.split(`${t} `)[1])||void 0===r?void 0:r.split(" ")[0];i.test(s)&&n.push(Number(s))})),n.sort((function(e,t){return e<t?1:-1})),n[0]||1}(i,e);return r=he(e,i,n,t),yield Promise.resolve(r)}return r=t?e:`${e} 1`,yield Promise.resolve(r)})))).catch((e=>X(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))}function ie(e,t,n=!1){return X(this,void 0,void 0,(function*(){return yield oe(e).then((i=>X(this,void 0,void 0,(function*(){return i?n?yield function(e,t){return X(this,void 0,void 0,(function*(){return yield function(e,t){return X(this,void 0,void 0,(function*(){return yield Be(t).then((n=>X(this,void 0,void 0,(function*(){const i=ae(n,t);i.template=null==t?void 0:t.id,delete i.appProxies,delete i.historyLabels;const o=te({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,c.getAppStore)().getState().portalUrl});if(null==n?void 0:n.__not_publish)return yield Promise.reject("This item is not published");const r=new Blob([JSON.stringify(i)],{type:"application/json"});return yield ke({id:e,resource:r,name:"config.json",params:{resourcesPrefix:"config"},authentication:o}).then((()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>X(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))),(e=>X(this,void 0,void 0,(function*(){return yield Promise.reject("Resource does not exist or is inaccessible")}))))}))}(e,t).then((n=>X(this,void 0,void 0,(function*(){return yield re(e,t,!0).then((e=>X(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")}))),(e=>X(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))))}))}(e,t):yield se(e,t):yield Promise.reject(null)}))),(e=>X(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function oe(e){return X(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession();return yield xe({item:{id:e,owner:null==t?void 0:t.username,text:"",data:{__not_publish:!0}},authentication:c.SessionManager.getInstance().getMainSession()}).then((()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>X(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))}function re(e,t,n=!1,i=!1){return X(this,void 0,void 0,(function*(){const o=te(t);return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return Te("getItemResources",e)(e.id,t,z(e))}))}(t,{authentication:o}).then((o=>X(this,void 0,void 0,(function*(){const r=[],s=o&&o.resources;let u=!1;if(s)for(let o=0;o<s.length;o++){const c="config/config.json"===s[o].resource;n&&c||(c&&(u=!0),r.push(ce(e,t,s[o],i)))}return u||n?yield Promise.all(r):yield Promise.resolve(null)}))),(e=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(null)}))))}))}function se(e,t,n=!1){return X(this,void 0,void 0,(function*(){return yield re(e,t,!1,n).then((e=>X(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")}))),(e=>X(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function ue(e,t,n){return X(this,void 0,void 0,(function*(){const i=te({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,c.getAppStore)().getState().portalUrl}),o=te(t);if(n){const r=`${ge(t)}${t.id}/info/${n}?token=${null==o?void 0:o.token}`,s=`${ge(t)}${t.id}/${n}`,u=Z(t)?r:s;return yield new Promise((function(t,n){const o=new XMLHttpRequest;o.open("GET",u,!0),o.responseType="blob",o.onload=function(o){if(200===this.status){const o=this.response;return Xe({id:e,thumbnail:o,f:"json",token:null==i?void 0:i.token}).then((()=>{t(!0)}),(()=>{n(!1)}))}n(!1)},o.onerror=function(e){n()},o.send()}))}return Promise.resolve(!0)}))}function ce(e,t,n,i=!1){return X(this,void 0,void 0,(function*(){const o=te(t),r=Z(t)?`?token=${null==o?void 0:o.token}`:"",s=`${ge(t)}${t.id}/resources/`,u=te({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,c.getAppStore)().getState().portalUrl});if("config/config.json"===n.resource||"images/image-resources-list.json"===n.resource){const o=s+n.resource+r;return yield fetch(o,{cache:"no-cache"}).then((e=>X(this,void 0,void 0,(function*(){return yield e.json()})))).then((o=>X(this,void 0,void 0,(function*(){const r="config/config.json"===n.resource,s=r?ae(o,t):o;return yield function(e,t,n){return X(this,void 0,void 0,(function*(){const i=ge(t)+t+"/resources/",o=new RegExp("^"+i);const r={matcher:function(e){return o.test(e)},handler:function(n){return n.replace("/"+t+"/","/"+e+"/")}};return Promise.resolve(c.utils.replaceStringInObject(n,r))}))}(e,t.id,s).then((t=>X(this,void 0,void 0,(function*(){var o;if(delete t.appProxies,delete t.historyLabels,r){i&&(t=null===(o=Ue((0,c.Immutable)(t)))||void 0===o?void 0:o.asMutable({deep:!0}));const e=(new Date).getTime();t.timestamp=`${e}`}const s=new Blob([JSON.stringify(t)],{type:"application/json"});return yield ke({id:e,resource:s,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:u}).then((()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>X(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))))})))).catch((e=>X(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}{const t=s+n.resource+r;return yield new Promise((function(i,o){const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(t){if(200===this.status){const t=this.response;return ke({id:e,resource:t,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:u}).then((()=>{i(!0)}),(()=>{i(!1)}))}i(!1)},r.onerror=function(e){i(!1)},r.send()}))}}))}function ae(e,t){var n;const i=(0,c.getAppStore)().getState().portalUrl;e.attributes&&(e.attributes.portalUrl=i);const o=null==e?void 0:e.dataSources;if(o&&z(t))for(const e in o)de(null===(n=o[e])||void 0===n?void 0:n.portalUrl)&&(o[e].portalUrl=i);return e}function de(e){let t=!1;const n=(0,c.getAppStore)().getState().portalUrl;return(le(n,e,"mapsdevext.arcgis.com")||le(n,e,"mapsqa.arcgis.com")||le(n,e,"maps.arcgis.com"))&&(t=!0),t}function le(e,t,n){return((null==e?void 0:e.endsWith(n))||(null==e?void 0:e.endsWith(`${n}/`)))&&((null==t?void 0:t.endsWith(n))||(null==t?void 0:t.endsWith(`${n}/`)))}function ve(e,t,n){return X(this,void 0,void 0,(function*(){return yield Ve(e).then((i=>X(this,void 0,void 0,(function*(){if(i){const o=t?s.TemplateType:s.ExperienceType;return yield ne(i.title).then((r=>X(this,void 0,void 0,(function*(){if(r){const s={name:r,tags:i.tags,thumbnail:i.thumbnail,type:o,typeKeywords:null==e?void 0:e.typeKeywords};return yield pe(s,n).then((n=>X(this,void 0,void 0,(function*(){return n?yield ie(n.id,e,!t).then((()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(n.id)}))),(e=>X(this,void 0,void 0,(function*(){return console.error(e),Ye(n.id),yield Promise.reject(e)})))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}))}function fe(e){const t=`version:${c.version}`;if(!e||0===e.length)return["EXB Experience","Ready To Use","JavaScript","status: Draft",t];let n=!1,i=!1;const o=e.map((e=>(e.includes("version:")&&(i=!0),e.includes("status:")?(n=!0,"status: Draft"):e)));return!n&&o.push("status: Draft"),!i&&o.push(t),o}function he(e,t,n=1,i=!1){const o=1===n&&i?e:`${e} ${n}`;return function(e,t){let n=!1;return t.forEach((t=>{e===t.title&&(n=!0)})),n}(o,t)?he(e,t,n+1):o}function pe(e,t){return X(this,void 0,void 0,(function*(){const n={title:e.name,type:e.type||"Web Experience",typeKeywords:fe(null==e?void 0:e.typeKeywords),snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:e.tags,thumbnail:e.thumbnail};return yield ye(n,t)}))}function me(e){return X(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance(),n=(new Date).getTime();return window.jimuConfig.isDevEdition?yield window.fetch(`/apps/${e}/resources/config/config.json`).then((e=>X(this,void 0,void 0,(function*(){return yield e.json()})))):yield Y(`${c.portalUrlUtils.getPortalRestUrl((0,c.getAppStore)().getState().portalUrl)}/content/items/${e}/resources/config/config.json`,{authentication:t.getSessionByUrl((0,c.getAppStore)().getState().portalUrl),httpMethod:"GET",params:{timestamp:n}}).catch((e=>X(this,void 0,void 0,(function*(){return yield this._handleAuthError(e)}))))}))}function ge(e){const t=z(e)?c.urlUtils.getArcgisOnlineUrl():(0,c.getAppStore)().getState().portalUrl;return(null==e?void 0:e.isLocalApp)?p()+"/apps/":c.portalUrlUtils.getPlatformUrlByOrgUrl(t)+"/sharing/rest/content/items/"}function ye(e,t){return X(this,void 0,void 0,(function*(){return t?yield(n={item:e,folderId:t,authentication:c.SessionManager.getInstance().getMainSession()},c.esri.restPortal.createItemInFolder(n)):yield function(e){return Oe(this,void 0,void 0,(function*(){return Te("createItem")(e)}))}({item:e,authentication:c.SessionManager.getInstance().getMainSession()});var n}))}function Se(e){const t={};return Object.keys(e).forEach((n=>{t[n]=Object.assign({},e[n])})),t}function be(e,t){const n=e.historyLabels;Object.keys(n[t]||{}).forEach((i=>{var o;(null===(o=e[t])||void 0===o?void 0:o[i])||delete n[t][i]}))}function Pe(e,t,n){const i=e[n],o=t[n];i&&o&&Object.keys(i).forEach((r=>{var s,u;const c=(null===(u=null===(s=t.historyLabels)||void 0===s?void 0:s[n])||void 0===u?void 0:u[r])||[];o[r]&&i[r].label!==o[r].label&&(c.includes(o[r].label)||c.push(o[r].label)),c.length>0&&(e.historyLabels?e.historyLabels[n]?e.historyLabels[n][r]=c:e.historyLabels[n]={[r]:c}:e.historyLabels={[n]:{[r]:c}})}))}const je=/<[^>]*>/gm,we=e=>{if(!e)return!0;if("<p></p>"===e||"<p><br></p>"===e)return!0;let t="";return t=e.includes("<")?e.replace(je,""):e,t=null==t?void 0:t.trim(),!t};function Ue(e){var t;if(!e)return null;c.semver.lt(c.version,null==e?void 0:e.exbVersion)&&(e=e.set("exbVersion",c.version));const n=(null===(t=(0,c.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig).widgets||{};return Object.keys(n).forEach((t=>{var i,o,r,s,u;c.semver.lt(null===(o=null===(i=n[t])||void 0===i?void 0:i.manifest)||void 0===o?void 0:o.version,null===(r=n[t])||void 0===r?void 0:r.version)&&(e=e.setIn(["widgets",t,"version"],null===(u=null===(s=n[t])||void 0===s?void 0:s.manifest)||void 0===u?void 0:u.version))})),e}var Oe=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};const{importItem:Ae,checkItemVersion:Ie}=e;function Te(t,n,i){const o=i?e[i]:e[t],r=c.esri.restPortal[t];return n?Z(n)?r:o:window.jimuConfig.isDevEdition?o:r}function xe(e){return Oe(this,void 0,void 0,(function*(){return Te("updateItem")(e)}))}function $e(e,t){return Oe(this,void 0,void 0,(function*(){return Te("getItem",e)(e.id,t,z(e))}))}function ke(e){return Oe(this,void 0,void 0,(function*(){return Te("addItemResource")(e)}))}var Me=o(262),Ee=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};function Re(e,t){return Ee(this,void 0,void 0,(function*(){return yield ve(e,!1,t)}))}function Le(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return X(this,void 0,void 0,(function*(){return yield function(e){return X(this,void 0,void 0,(function*(){const t=(0,c.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!1};return yield Ve(n).then((e=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(n)})))).catch((e=>X(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}))}(e).then((e=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((t=>X(this,void 0,void 0,(function*(){return yield function(e){return X(this,void 0,void 0,(function*(){const t=(0,c.getAppStore)().getState().portalUrl;if(c.portalUrlUtils.isAGOLDomain(t))return yield Promise.reject(!1);const n={id:e,portalUrl:"https://maps.arcgis.com",isLocalApp:!1};return yield Ve(n).then((e=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(n)})))).catch((e=>X(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}))}(e).then((e=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((t=>X(this,void 0,void 0,(function*(){return yield function(e){return X(this,void 0,void 0,(function*(){if(window.jimuConfig.isDevEdition){const t=(0,c.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!0};return yield Ve(n).then((e=>X(this,void 0,void 0,(function*(){return(null==e?void 0:e.success)?yield Promise.resolve(n):yield Promise.reject("Item does not exist or is inaccessible.")})))).catch((e=>X(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}return yield Promise.reject("Item does not exist or is inaccessible.")}))}(e)}))))}))))}))}(e).then((e=>Ee(this,void 0,void 0,(function*(){return yield Re(e)}))))}))}function Ce(e,t,n,i,o){return Ee(this,void 0,void 0,(function*(){return yield ne(e).then((e=>Ee(this,void 0,void 0,(function*(){if(e){const r={template:t,name:e,description:"",type:s.ExperienceType};return yield Promise.all([ut(r)]).then((function(e){var t,s;return Ee(this,void 0,void 0,(function*(){const u=e[0];u.template=r.template,u.attributes?u.attributes.portalUrl=(0,c.getAppStore)().getState().portalUrl:u.attributes={portalUrl:(0,c.getAppStore)().getState().portalUrl};const a=null===(s=null===(t=(0,c.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.portalProperties)||void 0===s?void 0:s.sharedTheme;return u.sharedThemeVariables=c.sharedThemeUtils.createSharedThemeVariables(a),yield function(e,t){return X(this,void 0,void 0,(function*(){const n={title:e.name,type:e.type||"Web Experience",typeKeywords:["EXB Experience","Ready To Use","JavaScript","status: Draft",`version:${c.version}`],snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:e.tags,data:{__not_publish:!0}};return yield(()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(!1)})))().then((function(e){return X(this,void 0,void 0,(function*(){return e?yield Promise.reject("app existed."):yield ye(n,t)}))}))}))}(r,n).then((e=>Ee(this,void 0,void 0,(function*(){return yield function(e,t,n,i){return X(this,void 0,void 0,(function*(){const o=c.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance(),r=t.id;let s=c.utils.replaceI18nPlaceholdersInObject(e,c.i18n.getIntl(),Q);return(u=s).attributes||(u.attributes={}),u.widgets||(u.widgets={}),u.widgetsManifest||(u.widgetsManifest={}),u.views||(u.views={}),u.sections||(u.sections={}),u.dialogs||(u.dialogs={}),u.pages||(u.pages={}),u.layouts||(u.layouts={}),u.dataSources||(u.dataSources={}),u.messageConfigs||(u.messageConfigs={}),s=u,c.appConfigUtils.addWebmapOrWebsceneToAppConfig(s,n,i),o.upLoadAppConfig(r.toString(),s).then((()=>X(this,void 0,void 0,(function*(){return yield Promise.resolve(t)}))));var u}))}(u,e,i,o)}))))}))})).catch((e=>Ee(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}return yield Promise.reject(null)}))))}))}function De(e,t){return Ee(this,void 0,void 0,(function*(){return yield ve(e,!0,t)}))}function Ge(e){return Ee(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession();return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return Ae(e,t)}))}(e,{authentication:t})}))}function _e(e){return Ee(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession();return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return Ie(e,t)}))}(e,{authentication:t})}))}function qe(e){return Ee(this,void 0,void 0,(function*(){return Fe(e,null,!0)}))}function Fe(e,t,n){return Ee(this,void 0,void 0,(function*(){return yield Ve(e).then((i=>Ee(this,void 0,void 0,(function*(){if(i){const o=c.i18n.getIntl().formatMessage({id:"copy"})||"copy",r=n?i.title:`${i.title} ${o}`;return yield ne(r,!0,e.type).then((n=>Ee(this,void 0,void 0,(function*(){if(n){const o={name:n,description:(null==i?void 0:i.description)||"",snippet:(null==i?void 0:i.snippet)||"",typeKeywords:(null==i?void 0:i.typeKeywords)||[],tags:i.tags,thumbnail:i.thumbnail,type:e.type||i.type};return yield pe(o,t).then((t=>Ee(this,void 0,void 0,(function*(){return t?yield ue(t.id,e,i.thumbnail).then((()=>Ee(this,void 0,void 0,(function*(){return yield ie(t.id,e,!1).then((()=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(t.id)}))),(e=>Ee(this,void 0,void 0,(function*(){return console.error(e),Ye(t.id),yield Promise.reject(e)}))))})))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}))}function Ne(e,t,n,i){return Ee(this,void 0,void 0,(function*(){return yield ne(`${t.title}`,!0,t.type).then((o=>Ee(this,void 0,void 0,(function*(){if(o){const o={name:t.title,description:(null==t?void 0:t.description)||"",snippet:(null==t?void 0:t.snippet)||"",typeKeywords:(null==t?void 0:t.typeKeywords)||[],tags:t.tags,thumbnail:t.thumbnail,type:e.type||e.type};return yield pe(o,n).then((n=>Ee(this,void 0,void 0,(function*(){return n?(t.id=n.id,yield function(e,t,n){return X(this,void 0,void 0,(function*(){if(!n)return yield ue(t.id,e,e.thumbnail);{const e=c.SessionManager.getInstance().getMainSession(),i={id:t.id,f:"json",token:null==e?void 0:e.token,thumbnail:n};yield Xe(i,t.owner)}}))}(e,t,i).then((()=>Ee(this,void 0,void 0,(function*(){return yield oe(n.id).then((i=>Ee(this,void 0,void 0,(function*(){return i?yield se(n.id,e,!0).then((()=>Ee(this,void 0,void 0,(function*(){let e=(0,c.getAppStore)().getState().appStateInBuilder.appConfig;e=Ue(e);const i=null==e?void 0:e.asMutable({deep:!0});return delete i.appProxies,delete i.historyLabels,Ze(t,(0,c.Immutable)(i),n.id).then((()=>Ee(this,void 0,void 0,(function*(){return me(n.id).then((e=>Ee(this,void 0,void 0,(function*(){return Promise.resolve({id:n.id,appConfig:e})}))))}))))}))),(e=>Ee(this,void 0,void 0,(function*(){return console.error(e),Ye(n.id),yield Promise.reject(e)})))):yield Promise.reject(null)}))),(e=>Ee(this,void 0,void 0,(function*(){return console.error(e),Ye(n.id),yield Promise.reject(e)}))))}))))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}))}function Be(e){return Ee(this,void 0,void 0,(function*(){const t=te(e);return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return Te("getItemData",e)(e.id,t,z(e))}))}(e,{authentication:t}).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))),(e=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function Ke(e,t){return Ee(this,void 0,void 0,(function*(){const n=function(e){let t;const n=(0,c.getAppStore)().getState().portalUrl,o=c.SessionManager.getInstance().getMainSession(),r=c.portalUrlUtils.isAGOLDomain(n);switch(e){case i.Portal:t=o;break;case i.AGOL:t=r?o:{};break;case i.Other:t=window.jimuConfig.isDevEdition?{}:o}return t}(t);return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return function(e){let t;const n=(0,c.getAppStore)().getState().portalUrl,o=c.portalUrlUtils.isAGOLDomain(n);switch(e){case i.Portal:t=c.esri.restPortal.searchItems;break;case i.AGOL:t=o?c.esri.restPortal.searchItems:d;break;case i.Other:t=window.jimuConfig.isDevEdition?d:c.esri.restPortal.searchItems}return t}(t)(e,t)}))}(Object.assign(Object.assign({},e),{authentication:n}),t).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function Ve(e){return Ee(this,void 0,void 0,(function*(){const t=te(e);return yield $e(e,{authentication:t}).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function Je(e,t){return Ee(this,void 0,void 0,(function*(){const n=c.SessionManager.getInstance().getMainSession();return yield function(e,t,n){return Oe(this,void 0,void 0,(function*(){return yield function(e,t,n=!1){return W(this,void 0,void 0,(function*(){const i=`${N(n)}/sharing/rest/community/groups/${e}/categorySchema`;n&&!H()&&delete t.authentication;const o=Object.assign(Object.assign({},t),{params:{id:e},httpMethod:"GET"}),r=c.esri.restRequest.request;return yield r(i,o)}))}(e,t,n)}))}(e,{authentication:n},t).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function We(e){return Ee(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession();return yield function(e,t){return Oe(this,void 0,void 0,(function*(){return yield function(e,t=!1){return W(this,void 0,void 0,(function*(){const n=function(e=!1){var t;return e?c.urlUtils.getArcgisOnlineOrgId():null===(t=(0,c.getAppStore)().getState().user)||void 0===t?void 0:t.orgId}(t),i=`${N(t)}/sharing/rest/portals/${n}/categorySchema`;t&&!H()&&delete e.authentication;const o=Object.assign(Object.assign({},e),{httpMethod:"GET"}),r=c.esri.restRequest.request;return yield r(i,o)}))}(e,t)}))}({authentication:t},e).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function He(e,t,n){return Ee(this,void 0,void 0,(function*(){const i=c.SessionManager.getInstance().getMainSession();return yield function(e,t,n){return Oe(this,void 0,void 0,(function*(){return yield function(e,t,n=!1){return B(this,void 0,void 0,(function*(){const i=`${N(n)}/sharing/rest/content/groups/${e}/search`;n&&!function(){const e=(0,c.getAppStore)().getState().portalUrl;return c.portalUrlUtils.isAGOLDomain(e)}()&&delete t.authentication;const o=Object.assign(Object.assign({},t),{httpMethod:"GET"}),r=c.esri.restRequest.request;return yield r(i,o)}))}(e,t,n)}))}(e,{params:t,authentication:i},n).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function Qe(e){return Ee(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=window.jimuConfig.isDevEdition?"localhost:":(0,c.getAppStore)().getState().portalUrl,i={id:e.id,portalUrl:n};return yield $e(i,{authentication:t}).then((n=>Ee(this,void 0,void 0,(function*(){return yield xe({item:e,owner:n.owner,authentication:t}).then((()=>null))}))))}))}function Xe(e,t=""){return Ee(this,void 0,void 0,(function*(){const n=c.SessionManager.getInstance().getMainSession();return yield function(e){return Oe(this,void 0,void 0,(function*(){return window.jimuConfig.isDevEdition?yield R(e):yield function(e){return F(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=e.owner?e.owner:null==t?void 0:t.username,i=`${(0,c.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${n}/items/${e.item.id}/update`;e.params=Object.assign(Object.assign({},e.params),e.item);const o=Object.keys(e.params),r=new FormData;for(let t=0;t<o.length;t++)r.append(o[t],e.params[o[t]]);return e.params=r,yield q(i,r)}))}(e)}))}({item:e,authentication:n,owner:t}).then((()=>null))}))}function Ye(e){return Ee(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession();return yield $e({id:e},{authentication:t}).then((t=>Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return Te("removeItem")(e)}))}({id:e,owner:t.owner,authentication:c.SessionManager.getInstance().getMainSession()})}))))}))}function Ze(e,t,n){return Ee(this,void 0,void 0,(function*(){const i=c.SessionManager.getInstance().getMainSession(),o=c.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager,r=c.moduleLoader.getModuleSync("jimu-for-builder").appConfigUtils,s=(null==e?void 0:e.owner)||i.username,u=Object.assign({},r.getCleanAppConfig(t)),a=o.getInstance();u?yield a.upLoadAppConfig(e.id,u,s).then((()=>{const{imageResources:e,iconResources:t}=a.getResourcesInDraft();e&&a.upLoadImageResourceList(Se(e),n),t&&a.upLoadIconResourceList(Se(t),n)})).catch((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))):yield Promise.reject()}))}function ze(e){return Ee(this,void 0,void 0,(function*(){const t=yield me(e.id),n=yield Be(e),i=c.SessionManager.getInstance().getMainSession();if(t&&n){const o=function(e,t){let n=!1,i=!1;const o=e.map((e=>e.includes("status:")?(n=!0,`status: ${u.Published}`):e.includes("publishVersion:")&&t?(i=!0,`publishVersion:${t}`):e));if(!n){const e=`status: ${u.Published}`;o.push(e)}return!i&&t&&o.push(`publishVersion:${t}`),o}(null==e?void 0:e.typeKeywords,null==n?void 0:n.exbVersion);return c.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance().upLoadLocalResource(t).then((t=>Ee(this,void 0,void 0,(function*(){if(!t)return yield Promise.reject();t=function(e,t){return t.__not_publish||(e.historyLabels&&(be(e,"pages"),be(e,"views"),be(e,"dialogs")),Pe(e,t,"pages"),Pe(e,t,"views"),Pe(e,t,"dialogs")),e}(t=function(e,t){return Object.values(e.widgets).forEach((e=>{"widgets/common/text/"===e.uri&&function(e,t){if(t.type===s.TemplateType)return e;we(null==e?void 0:e.text)||delete e.placeholder}(e.config,t)})),e}(t,e),n);const r=function(e){const{type:t,id:n}=e,{isDevEdition:i,isInPortal:o,hostEnv:r}=window.jimuConfig,u=t===s.TemplateType,a=!i&&!o;if(i)return null;let d=c.urlUtils.getAppUrl({appId:n,isTemplate:u});if(a)switch(r){case"prod":d=`https://experience.arcgis.com${d}`;break;case"dev":d=`https://experiencedev.arcgis.com${d}`;break;case"qa":d=`https://experienceqa.arcgis.com${d}`}return o&&(d=`${window.location.origin}${d}`),d}(e);yield xe({item:{id:e.id,owner:e.owner||(null==i?void 0:i.username),data:t,typeKeywords:o,url:r},authentication:c.SessionManager.getInstance().getMainSession()}).then((()=>Ee(this,void 0,void 0,(function*(){yield Promise.resolve()}))),(()=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject()}))))}))),(()=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject()})))).catch((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}yield Promise.reject()}))}function et(e){return Ee(this,void 0,void 0,(function*(){return(t=e,function(e){return B(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=`${(0,c.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${null==t?void 0:t.username}`,i=Object.assign(Object.assign({},e.params),{f:"json",token:null==t?void 0:t.token});return yield q(n,i,"GET")}))}(t)).then((e=>Ee(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.folders)||[];return yield Promise.resolve(t)}))),(e=>Ee(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))));var t}))}function tt(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield function(e){return K(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=`${(0,c.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/share`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const i=Object.keys(e),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e[i[t]]);return e=o,yield q(n,e)}))}(e)}))}(e).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function nt(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield function(e){return V(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=`${(0,c.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/unshare`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const i=Object.keys(e),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e[i[t]]);return e=o,yield q(n,e)}))}(e)}))}(e).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function it(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield function(e){return J(this,void 0,void 0,(function*(){const t=c.SessionManager.getInstance().getMainSession(),n=`${(0,c.getAppStore)().getState().portalUrl}/sharing/rest/content/itemsgroups`,i={params:e,httpMethod:"GET",authentication:t};return yield c.esri.restRequest.request(n,i)}))}(e)}))}(e).then((e=>Ee(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function ot(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield c.esri.restPortal.moveItem(e)}))}(Object.assign(Object.assign({},e),{authentication:c.SessionManager.getInstance().getMainSession()}))}))}function rt(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield c.esri.restPortal.getUserTags(e)}))}({username:e,authentication:c.SessionManager.getInstance().getMainSession()})}))}function st(e){return Ee(this,void 0,void 0,(function*(){return yield function(e){return Oe(this,void 0,void 0,(function*(){return yield c.esri.restPortal.searchGroups(e)}))}(e)}))}function ut(e){return Ee(this,void 0,void 0,(function*(){return(0,Me.getTemplateConfig)(Me.TemplateType.App,e.template)}))}var ct=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function u(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((i=i.apply(e,t||[])).next())}))};const at=c.esri.restRequest.request;var dt;let lt,vt;function ft(e,t){return ct(this,void 0,void 0,(function*(){const n=c.SessionManager.getInstance().getMainSession(),{username:i}=n,o=(0,c.getAppStore)().getState().portalUrl,r=c.portalUrlUtils.getBaseUserUrl(o),s=yield Pt.getInstance().getToken();let u;switch(t=null!=t?t:bt(),e){case dt.Add:u=r+"/"+i+"/addResource/?token="+s;break;case dt.Remove:u=r+"/"+i+"/removeResource/?token="+s;break;case dt.Get:u=r+"/"+i+"/resources/"+t+"?token="+s;break;case dt.GetAll:u=r+"/"+i+"/resources/?token="+s}return yield Promise.resolve(u)}))}function ht(e,t){return ct(this,void 0,void 0,(function*(){t=null!=t?t:bt();const n={httpMethod:"POST",params:Object.assign(Object.assign({},e),{key:t,access:"UserPrivateAllApps"})};return yield ft(dt.Add).then((e=>ct(this,void 0,void 0,(function*(){return yield at(e,n).then((e=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed adding user resource:"+e.message))}))))}))}function pt(e){return ct(this,void 0,void 0,(function*(){return e=null!=e?e:bt(),yield ft(dt.Get,e).then((e=>ct(this,void 0,void 0,(function*(){return yield at(e,{params:{f:"json"}}).then((e=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource:"+e.message))}))))}))}function mt(){return ct(this,void 0,void 0,(function*(){return yield ft(dt.GetAll).then((e=>ct(this,void 0,void 0,(function*(){return yield at(e,{params:{f:"json"}}).then((e=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource list:"+e.message))}))))}))}function gt(e){return ct(this,void 0,void 0,(function*(){return e=null!=e?e:bt(),yield ft(dt.Remove).then((t=>ct(this,void 0,void 0,(function*(){const n={params:{key:e}};return yield at(t,n).then((e=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed removing user resource:"+e.message))}))))}))}function yt(e){return ct(this,void 0,void 0,(function*(){return yield pt().then((t=>ct(this,void 0,void 0,(function*(){const n=(0,c.Immutable)(null!=t?t:{}).merge(e,{deep:!0});return yield ht({text:JSON.stringify(Object.assign({},n))})})))).then((e=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed updating user resource:"+e.message))}))))}))}function St(){return ct(this,void 0,void 0,(function*(){return lt||(lt=mt().then((e=>ct(this,void 0,void 0,(function*(){if(0===e.total)return yield ht({text:"{}"});{const t=e.userResources[0],n=bt();return t.key===n?yield Promise.resolve({success:!0}):yield pt(t.key).catch((e=>null)).then((e=>ct(this,void 0,void 0,(function*(){return e&&(e.showGuides||0===Object.keys(e).length)?yield gt(t.key).then((()=>ct(this,void 0,void 0,(function*(){return yield ht({text:JSON.stringify(Object.assign({},e))})})))):yield ht({text:"{}"})}))))}})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed initializing user resource:"+e.message))}))))),lt}))}function bt(){if(!vt){const e=c.SessionManager.getInstance().getMainSession();vt=`${c.USER_SETTING_FILE_KEY}${(null==e?void 0:e.clientId)?`_${e.clientId}`:""}.json`}return vt}!function(e){e.Add="ADD",e.Remove="REMOVE",e.Get="GET",e.GetAll="GETALL"}(dt||(dt={}));class Pt{static getInstance(){return Pt.instance||(Pt.instance=new Pt),Pt.instance}constructor(){this.session=c.SessionManager.getInstance().getMainSession()}_shouldExchangeToken(){return ct(this,void 0,void 0,(function*(){if(!this.exchangedToken||this.session.tokenExpires<new Date){if(!this.portalSelfPromise){const e=(0,c.getAppStore)().getState().portalUrl;this.portalSelfPromise=at(`${e}/sharing/rest/community/self?token=${this.session.token}`).then((({appInfo:e})=>ct(this,void 0,void 0,(function*(){return yield Promise.resolve("experienceBuilder"!==(null==e?void 0:e.appId))})))).catch((e=>ct(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(e.message))}))))}return yield this.portalSelfPromise}return yield Promise.resolve(!1)}))}_exchangeToken(){return ct(this,void 0,void 0,(function*(){const e=(0,c.getAppStore)().getState().portalUrl+"/sharing/rest/oauth2/exchangeToken",t={params:{client_id:this.session.clientId,token:this.session.token}};return yield at(e,t)}))}getToken(){var e;return ct(this,void 0,void 0,(function*(){return(yield this._shouldExchangeToken())?yield this._exchangeToken().catch((e=>(console.warn("Failed exchanging token. Using default token from user sesion."),{token:this.session.token}))).then((e=>ct(this,void 0,void 0,(function*(){return this.exchangedToken=null==e?void 0:e.token,yield Promise.resolve(this.exchangedToken)})))):yield Promise.resolve(null!==(e=this.exchangedToken)&&void 0!==e?e:this.session.token)}))}}})(),r})())}}}));