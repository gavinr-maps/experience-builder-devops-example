System.register(["jimu-core","jimu-core/emotion","jimu-ui/basic/guide","jimu-for-builder","jimu-layouts/layout-runtime"],function(e,t){var n={},i={},o={},r={},d={};return{setters:[function(e){n.GuideLevels=e.GuideLevels,n.GuideManager=e.GuideManager,n.GuideTypes=e.GuideTypes,n.LayoutItemType=e.LayoutItemType,n.React=e.React,n.ReactRedux=e.ReactRedux,n.i18n=e.i18n,n.utils=e.utils},function(e){i.jsx=e.jsx},function(e){o.EVENTS=e.EVENTS,o.GuideComponent=e.GuideComponent,o.STATUS=e.STATUS,o.findLayoutItem=e.findLayoutItem,o.getTargetSelector=e.getTargetSelector},function(e){r.builderAppSync=e.builderAppSync,r.defaultMessages=e.defaultMessages,r.getAppConfigAction=e.getAppConfigAction},function(e){d.searchUtils=e.searchUtils}],execute:function(){e((()=>{"use strict";var e={108:e=>{e.exports=r},132:e=>{e.exports=JSON.parse('{"steps":[{"steps":[{"title":"${DSSelectionStep4Title}","content":"${DSSelectionStep4Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-button","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${DSSelectionStep1Title}","content":"${DSSelectionStep1Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-button","requiredAction":{"type":"click"},"disableNextButton":true}]},{"title":"${DSSelectionStep2Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/add-data.gif","alt":"${DSSelectionStep2Title}","width":400,"height":220},"text":"${DSSelectionStep2Content}"},"placement":"left-end","target":".component-data-source-list .ds-add-data","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${DSSelectionStep5Title}","content":"${DSSelectionStep5Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true},{"title":"${DSSelectionStep3Title}","content":"${DSSelectionStep3Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true}]}]}')},151:e=>{e.exports=o},244:e=>{e.exports=n},386:e=>{e.exports=i},496:e=>{e.exports=d}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};s.r(a),s.d(a,{registerCommonGuides:()=>h});var u=s(244),l=s(386),c=s(151),p=s(108),g=s(496);const{useState:S,useEffect:m,useMemo:f,useRef:v}=u.React;function I(e,t=""){return u.i18n.getIntl().formatMessage({id:e,defaultMessage:p.defaultMessages[e]},{widgetName:t})}const y=u.ReactRedux.connect(e=>{var t,n,i;return{appConfig:null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig,widgetSelection:null===(i=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appRuntimeInfo)||void 0===i?void 0:i.selection}})(e=>{const{params:t,appConfig:n,widgetSelection:i}=e,o=null==t?void 0:t.widgetName,[r,d]=S(!1),[s,a]=S(0),[y,T]=S(!1),b=v(null),x=v(null),h=f(()=>[{title:I("insertWidgetStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/insert-widget-guide.gif",alt:I("insertWidgetStep1Title"),border:!0,width:400,height:220,autoFlip:!0},text:I("insertWidgetStep1Content")},placement:"auto",target:`[data-sectionid='opts-section'] .widget-card-item[data-widget-name='${o}']`,spotlightClicks:!0,requiredAction:{type:"custom"},disableNextButton:!0}],[o]),w=()=>{document.body.removeEventListener("dragstart",b.current),document.body.removeEventListener("dragend",x.current)};return m(()=>{w(),d(e.run)},[e.run]),m(()=>{a(e.stepIndex)},[e.stepIndex]),m(()=>{if(!r){const e=g.searchUtils.findLayoutItem(n,i);let t;e&&e.type===u.LayoutItemType.Widget&&e.widgetId&&(t=null==n?void 0:n.widgets[e.widgetId]),y&&(null==t?void 0:t.manifest.name)===o&&(a(1),d(!0))}},[o,r,y,n,i]),(0,l.jsx)(c.GuideComponent,Object.assign({},e,{run:r,stepIndex:s,steps:h,onStepChange:t=>{const{index:n,event:i,step:o,status:r}=t,s=(0,c.getTargetSelector)(o),u=document.querySelector(s);if(u){(e=>{if(!e)return!1;const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;if(!(t.top>=0&&t.left>=0&&t.bottom<=n&&t.right<=i))return!1;const o=t.left+t.width/2,r=t.top+t.height/2,d=document.elementFromPoint(o,r);return d===e||e.contains(d)})(u)||u.scrollIntoView({behavior:"smooth",block:"center"}),0===n&&i===c.EVENTS.TOOLTIP&&(p.builderAppSync.publishChangeSelectionToApp(null),(0,p.getAppConfigAction)().setLockLayout(!1).exec(),((t,n)=>{b.current=e=>{var i,o;(null===(o=null===(i=e.target)||void 0===i?void 0:i.parentElement)||void 0===o?void 0:o.querySelector(n))===e.target?(d(!1),t.addEventListener("dragend",x.current)):w()},x.current=n=>{var i;"none"===(null===(i=null==n?void 0:n.dataTransfer)||void 0===i?void 0:i.dropEffect)?(a(0),d(!0)):(T(!0),e.onStepChange({isInjected:!0,status:c.STATUS.FINISHED})),t.removeEventListener("dragend",x.current),w()},t&&document.body.addEventListener("dragstart",b.current)})(u,s)),null==e||e.onStepChange(t)}else console.warn("insert widget target not found:",s);r!==c.STATUS.FINISHED&&r!==c.STATUS.SKIPPED||w()},isInjected:!0}))}),{useState:T,useEffect:b}=u.React;const x=u.ReactRedux.connect((e,t)=>{var n,i,o;const r=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appConfig,d=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo.selection;let s;if(d){const e=(0,c.findLayoutItem)(r,d);e&&e.type===u.LayoutItemType.Widget&&e.widgetId&&(s=r.widgets[e.widgetId])}return{dataSourcesInfo:null===(o=e.appStateInBuilder)||void 0===o?void 0:o.dataSourcesInfo,widgetDs:null==s?void 0:s.useDataSources,widgetJson:s}})(e=>{const t=u.utils.replaceI18nPlaceholdersInObject(s(132),u.i18n.getIntl(),p.defaultMessages),{dataSourcesInfo:n,widgetDs:i,widgetJson:o}=e,[r,d]=T(!1),[a,g]=T(0),[S,m]=T(!1),[f,v]=T({0:0,2:0}),I=function(e,t){if(!e||!t)return!1;const n=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>n}(function(e){const t=u.React.useRef(void 0);return b(()=>{t.current=e}),t.current}(n),n);return b(()=>{var t;0===e.stepIndex&&"arcgis-map"===(null===(t=null==o?void 0:o.manifest)||void 0===t?void 0:t.name)&&v({0:1,2:1})},[o,e.stepIndex]),b(()=>{d(e.run)},[e.run]),b(()=>{g(e.stepIndex)},[e.stepIndex]),b(()=>{r&&i&&m(!i.length),!r&&I&&(g(a+1),d(!0))},[i,I,r]),(0,l.jsx)(c.GuideComponent,Object.assign({},e,{run:r,stepIndex:a,steps:t.steps,conditionalStepIndexes:f,onActionTriggered:(t,n,i)=>{var o;0===i?g(1):1===i&&d(!1),null===(o=null==e?void 0:e.onActionTriggered)||void 0===o||o.call(e,t,n,i)},onStepChange:t=>{const{index:n,event:i}=t;2===n&&i===c.EVENTS.TOOLTIP&&m(!0),null==e||e.onStepChange(Object.assign(Object.assign({},t),{run:r}))},disabled:S,isInjected:!0}))});function h(){u.GuideManager.getInstance().registerGuide({id:"insert-widget",module:y,type:u.GuideTypes.Program,level:u.GuideLevels.Common,isInjected:!0}),u.GuideManager.getInstance().registerGuide({id:"ds-selection",module:x,type:u.GuideTypes.Program,level:u.GuideLevels.Common,isInjected:!0})}return a})())}}});