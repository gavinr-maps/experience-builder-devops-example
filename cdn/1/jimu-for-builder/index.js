System.register(["jimu-core","jimu-core/emotion","jimu-core/react","jimu-theme","jimu-layouts/layout-runtime","jimu-for-builder/templates","jimu-ui"],function(e,t){var i={},o={},n={},s={},a={},r={},l={};return{setters:[function(e){i.AjaxState=e.AjaxState,i.AppMode=e.AppMode,i.AppType=e.AppType,i.BrowserSizeMode=e.BrowserSizeMode,i.CONSTANTS=e.CONSTANTS,i.ContainerType=e.ContainerType,i.DataSourceManager=e.DataSourceManager,i.DialogMode=e.DialogMode,i.ExtensionManager=e.ExtensionManager,i.GuideLevels=e.GuideLevels,i.GuideManager=e.GuideManager,i.GuideTypes=e.GuideTypes,i.Immutable=e.Immutable,i.IntlProvider=e.IntlProvider,i.Keyboard=e.Keyboard,i.LayoutItemType=e.LayoutItemType,i.LayoutParentType=e.LayoutParentType,i.LayoutType=e.LayoutType,i.PageType=e.PageType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ResourceType=e.ResourceType,i.ScreenTransitionType=e.ScreenTransitionType,i.SessionManager=e.SessionManager,i.UrlGeneralConfig=e.UrlGeneralConfig,i.WidgetManager=e.WidgetManager,i.WidgetType=e.WidgetType,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.configTranslationUtils=e.configTranslationUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.extensionSpec=e.extensionSpec,i.getAppStore=e.getAppStore,i.i18n=e.i18n,i.injectIntl=e.injectIntl,i.jimuHistory=e.jimuHistory,i.keyboardUtils=e.keyboardUtils,i.loadDependencies=e.loadDependencies,i.lodash=e.lodash,i.moduleLoader=e.moduleLoader,i.observeStore=e.observeStore,i.portalUrlUtils=e.portalUrlUtils,i.portalUtils=e.portalUtils,i.queryString=e.queryString,i.translatedLocales=e.translatedLocales,i.urlManagerUtils=e.urlManagerUtils,i.urlUtils=e.urlUtils,i.utils=e.utils,i.uuidv1=e.uuidv1},function(e){o.jsx=e.jsx},function(e){n.PureComponent=e.PureComponent},function(e){s.colorUtils=e.colorUtils,s.getTheme2=e.getTheme2,s.withTheme=e.withTheme},function(e){a.searchUtils=e.searchUtils,a.utils=e.utils},function(e){r.getTemplateConfig=e.getTemplateConfig},function(e){l.defaultMessages=e.defaultMessages,l.imageUtils=e.imageUtils}],execute:function(){e((()=>{var e={153:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.333 0h4c.737 0 1.334.597 1.334 1.333v1.334h8C15.403 2.667 16 3.264 16 4v10.667c0 .736-.597 1.333-1.333 1.333H1.333A1.333 1.333 0 0 1 0 14.667V1.333C0 .597.597 0 1.333 0m0 7.333v7.334h13.334V7.333zm0-1.333h13.334V4H5.334V1.335h-4z" clip-rule="evenodd"></path></svg>'},201:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M17 2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM5 1h10a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m2 2h6v6H7zm0 8h1v2H7zm2 0h1v1H9zm4 2h-1v1h1zm-6 1h1v1H7zm4 2h-1v1h1zm1-1h1v2h-1zm-3 2v-1H7v1zm2-6h2v1h-2z" clip-rule="evenodd"></path></svg>'},218:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v12H2zM1 15V1h14v14zm4-9h6v4H5zm-1 5V5h8v6z" clip-rule="evenodd"></path></svg>'},244:e=>{"use strict";e.exports=i},321:e=>{"use strict";e.exports=l},341:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 7h6v6H3zM11 7h1v2h-1zM13 7h1v1h-1zM17 9h-1v1h1zM11 10h1v1h-1zM15 12h-1v1h1zM16 11h1v2h-1zM13 13v-1h-2v1zM15 7h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 4h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},386:e=>{"use strict";e.exports=o},490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m1.373 8 2.07-2.071.83.828L2.2 8.828a3.515 3.515 0 0 0 4.97 4.971l2.072-2.071.828.828L8 14.627A4.686 4.686 0 1 1 1.373 8M13.799 7.172l-2.071 2.07.828.83L14.627 8A4.686 4.686 0 1 0 8 1.373l-2.071 2.07.828.83L8.828 2.2a3.515 3.515 0 0 1 4.971 4.97"></path><path fill="#000" d="M5.515 9.657a.586.586 0 0 0 .828.828l4.142-4.142a.586.586 0 0 0-.828-.828z"></path></svg>'},496:e=>{"use strict";e.exports=a},528:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v4H2zM1 7V1h14v6zm1 3h12v4H2zm-1 5V9h14v6z" clip-rule="evenodd"></path></svg>'},546:e=>{"use strict";e.exports=JSON.parse('{"online":{"home":"#","get-started":{"prefix":"get-started/","what-is-arcgis-experience-builder":"what-is-arcgis-experience-builder.htm","whats-new":"whats-new.htm","faq":"faq.htm"},"build-apps":{"prefix":"build-apps/","add-a-page":"add-a-page.htm","add-a-dialog":"add-windows.htm","add-utility-services":"add-utility-services.htm","add-custom-widgets":"getting-started-widget.htm","add-screen-groups":"add-screen-groups.htm","express-mode":"express-mode.htm","select-data":"select-data.htm","change-app-theme":"change-app-theme.htm","general-settings":"general-settings.htm"},"widgets":{"prefix":"configure-widgets/","overview":"widgets-overview.htm","3d-toolbox":"3d-toolbox-widget.htm","accordion":"accordion-widget.htm","add-data":"add-data-widget.htm","advanced-formatting":"advanced-formatting.htm","analysis":"analysis-widget.htm","arcgis-map":"map-widget.htm","basemap-gallery":"basemap-gallery-widget.htm","ba-infographic":"business-analyst-widget.htm","bookmark":"bookmark-widget.htm","branch-version-management":"branch-version-management-widget.htm","button":"button-widget.htm","building-explorer":"building-explorer-widget.htm","card":"card-widget.htm","chart":"chart-widget.htm","column":"column-widget.htm","controller":"widget-controller-widget.htm","coordinates":"coordinates-widget.htm","coordinate-conversion":"coordinate-conversion-widget.htm","display-order":"display-order-widget.htm","document-explorer":"document-explorer-widget.htm","document-viewer":"document-viewer-widget.htm","divider":"divider-widget.htm","draw":"draw-widget.htm","directions":"directions-widget.htm","edit":"edit-widget.htm","elevation-profile":"elevation-profile-widget.htm","embed":"embed-widget.htm","feature-info":"feature-info-widget.htm","feature-report":"feature-report-widget.htm","filter":"filter-widget.htm","fixed":"fixed-panel-widget.htm","floor-filter":"floor-filter-widget.htm","flowrow":"flow-row-widget.htm","fly-controller":"fly-controller-widget.htm","grid":"grid-widget.htm","image":"image-widget.htm","image-collection-explorer":"image-collection-explorer-widget.htm","legend":"legend-widget.htm","link-explorer":"link-explorer-widget.htm","list":"list-widget.htm","login":"login-widget.htm","map-layers":"map-layers-widget.htm","measurement":"measurement-widget.htm","menu":"menu-widget.htm","navigator":"view-navigation-widget.htm","near-me":"near-me-widget.htm","classic-oriented-imagery":"classic-oriented-imagery-widget.htm","oriented-imagery-viewer":"oriented-imagery-viewer-widget.htm","placeholder":"placeholder-widget.htm","print":"print-widget.htm","processing-templates":"processing-templates-widget.htm","query":"query-widget.htm","row":"row-widget.htm","search":"search-widget.htm","section":"section-widget.htm","select":"select-widget.htm","share":"share-widget.htm","sidebar":"sidebar-widget.htm","suitability-modeler":"suitability-modeler-widget.htm","survey123":"survey-widget.htm","swipe":"swipe-widget.htm","table":"table-widget.htm","text":"text-widget.htm","timeline":"timeline-widget.htm","my-location":"my-location-widget.htm","utility-network-trace":"utility-network-trace-widget.htm"}},"portal":{"home":"120001864","get-started":{"what-is-arcgis-experience-builder":"120001877","whats-new":"120002535","faq":"120005517"},"build-apps":{"add-a-page":"120001863","add-a-dialog":"120002539","add-utility-services":"120003733","add-custom-widgets":"120003728","add-screen-groups":"120002592","express-mode":"120005009","select-data":"120002590","change-app-theme":"120004139","general-settings":"120004779"},"widgets":{"overview":"#","3d-toolbox":"120003734","accordion":"120004999","add-data":"120004128","advanced-formatting":"120005389","analysis":"120004647","arcgis-map":"120001851","basemap-gallery":"120004168","bookmark":"120002536","button":"120001841","building-explorer":"120004868","branch-version-management":"120002654","ba-infographic":"120003631","card":"120002537","chart":"120002727","column":"120001842","controller":"120001862","coordinates":"120003879","coordinate-conversion":"120002728","display-order":"120005390","document-explorer":"120005391","document-viewer":"120005392","divider":"120002538","draw":"120003632","directions":"120003635","edit":"120002844","elevation-profile":"120002905","embed":"120001843","feature-info":"120001844","feature-report":"120004895","filter":"120001845","fixed":"120001846","floor-filter":"120003634","flowrow":"120005055","fly-controller":"120001847","grid":"120003880","image":"120001848","image-collection-explorer":"120005639","legend":"120001849","link-explorer":"120005393","list":"120001850","login":"120005630","map-layers":"120001852","measurement":"120004869","menu":"120001853","navigator":"120001861","near-me":"120004170","classic-oriented-imagery":"120002843","oriented-imagery-viewer":"120005053","placeholder":"120001854","print":"120003716","processing-templates":"120005054","query":"120002729","row":"120001855","search":"120002845","section":"120001856","select":"120004732","share":"120001857","sidebar":"120001858","suitability-modeler":"120002906","survey123":"120001859","swipe":"120004169","table":"120002591","text":"120001860","timeline":"120003717","my-location":"120004870","utility-network-trace":"120003633","add-line-event":"120004827","add-point-event":"120004828","dynamic-segmentation":"120004989","identify":"120004829","merge-events":"120004830","search-by-route":"120004831","split-event":"120004832"}},"dev":{"home":"#","get-started":{"prefix":"guide/","what-is-arcgis-experience-builder":"getting-started-widget","whats-new":"whats-new","frequently-asked-questions":"frequently-asked-questions","install-guide":"install-guide"},"build-apps":{"prefix":"guide/","add-a-page":"add-a-page","add-a-dialog":"add-windows","add-utility-services":"add-utility-services","add-custom-widgets":"getting-started-widget","add-screen-groups":"add-screen-groups","express-mode":"express-mode","select-data":"select-data","change-app-theme":"change-app-theme","general-settings":"general-settings"},"widgets":{"prefix":"guide/","overview":"widgets-overview","3d-toolbox":"3d-toolbox-widget","accordion":"accordion-widget","add-data":"add-data-widget","advanced-formatting":"advanced-formatting","analysis":"analysis-widget","arcgis-map":"map-widget","basemap-gallery":"basemap-gallery-widget","ba-infographic":"business-analyst-widget","bookmark":"bookmark-widget","branch-version-management":"branch-version-management-widget","button":"button-widget","building-explorer":"building-explorer-widget","card":"card-widget","chart":"chart-widget","column":"column-widget","controller":"widget-controller-widget","coordinates":"coordinates-widget","coordinate-conversion":"coordinate-conversion-widget","display-order":"display-order-widget","document-explorer":"document-explorer-widget","document-viewer":"document-viewer-widget","divider":"divider-widget","draw":"draw-widget","directions":"directions-widget","edit":"edit-widget","elevation-profile":"elevation-profile-widget","embed":"embed-widget","feature-info":"feature-info-widget","feature-report":"feature-report-widget","filter":"filter-widget","fixed":"fixed-panel-widget","floor-filter":"floor-filter-widget","flowrow":"flow-row-widget","fly-controller":"fly-controller-widget","grid":"grid-widget","image":"image-widget","image-collection-explorer":"image-collection-explorer-widget","legend":"legend-widget","link-explorer":"link-explorer-widget","list":"list-widget","login":"login-widget","map-layers":"map-layers-widget","measurement":"measurement-widget","menu":"menu-widget","navigator":"view-navigation-widget","near-me":"near-me-widget","classic-oriented-imagery":"classic-oriented-imagery-widget","oriented-imagery-viewer":"oriented-imagery-viewer-widget","placeholder":"placeholder-widget","print":"print-widget","processing-templates":"processing-templates-widget","query":"query-widget","row":"row-widget","search":"search-widget","section":"section-widget","select":"select-widget","share":"share-widget","sidebar":"sidebar-widget","suitability-modeler":"suitability-modeler-widget","survey123":"survey-widget","swipe":"swipe-widget","table":"table-widget","text":"text-widget","timeline":"timeline-widget","my-location":"my-location-widget","utility-network-trace":"utility-network-trace-widget","add-line-event":"add-line-event-widget","add-point-event":"add-point-event-widget","dynamic-segmentation":"dynamic-segmentation-widget","identify":"identify-widget","merge-events":"merge-events-widget","search-by-route":"search-by-route-widget","split-event":"split-event-widget"}}}')},606:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.25 2.5h17.5v11.25H1.25zM0 2.5c0-.69.56-1.25 1.25-1.25h17.5c.69 0 1.25.56 1.25 1.25v11.25c0 .69-.56 1.25-1.25 1.25H1.25C.56 15 0 14.44 0 13.75zm3.75 16.25h2.5V17.5h-2.5zm7.5 0h-2.5V17.5h2.5zm2.5 0h2.5V17.5h-2.5z" clip-rule="evenodd"></path></svg>'},617:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M.007.883A1 1 0 0 1 1 0h10l.117.007A1 1 0 0 1 12 1v7l-.007.117A1 1 0 0 1 11 9H4l-4 3V1zM11 1H1v9l2.667-2H11zM3 3.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M3.5 5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},736:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M14 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM2 1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M20 8a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM8 7h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},850:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 3h7v7H3zM11 11h1v2h-1zM13 11h1v1h-1zM17 13h-1v1h1zM11 14h1v1h-1zM15 16h-1v1h1zM16 15h1v2h-1zM13 17v-1h-2v1zM15 11h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},884:e=>{"use strict";e.exports=r},886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},888:e=>{"use strict";e.exports=s},972:e=>{"use strict";e.exports=n}},t={};function d(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";d.r(u),d.d(u,{AppConfigAction:()=>Mi,AppDataActionManager:()=>xi,AppMessageManager:()=>P,AppResourceFilePath:()=>Wt,AppResourceManager:()=>Gt,AppStateHistoryActionKeys:()=>Ve,AppStateHistoryExtension:()=>Ke,AppStateReduxStoreExtension:()=>He,AppWidgetManager:()=>G,BaseLayoutService:()=>we,BaseWidgetSetting:()=>c,BuilderKeyboardComponent:()=>Uo,BuilderStateActionTypes:()=>p,BuilderStateReduxStoreExtension:()=>v,ContentServiceWrapper:()=>me,ExtActionKeys:()=>Ge,LayoutServiceProvider:()=>x,ToBuilderMessage:()=>Ye,UrlConfigManager:()=>Ri,WidgetSettingManager:()=>S,appBuilderSync:()=>n,appConfigUtils:()=>e,appStateActions:()=>Ne,appStateHistoryActions:()=>qe,builderActionKeys:()=>p,builderActions:()=>y,builderAppSync:()=>o,dataSourceService:()=>D,defaultMessages:()=>R,emptyContentService:()=>he,fullReplaceBlobUrl:()=>$t,getAppConfigAction:()=>Li,helpUtils:()=>a,init:()=>Bo,loadI18nMessage:()=>ko,makeSureTemplateConfig:()=>U,placeholderService:()=>$,screenGroupService:()=>ge,sectionService:()=>re,templateService:()=>ye,templateUtils:()=>i,utils:()=>s,widgetService:()=>te});var e={};d.r(e),d.d(e,{cleanAppStructure:()=>je,getCleanAppConfig:()=>Oe,getRealPageCount:()=>Te,getRealPageCountExcludeOnePage:()=>_e,getSizeModeOfALayout:()=>Ae,getSubRealPageCount:()=>xe,getUniqueId:()=>Se,getUniqueLabel:()=>be,isFirstLevelPage:()=>Le,isLabelDuplicated:()=>Ue,isPageHasSubPage:()=>Me,isRealPage:()=>Re,parseUniqueLabel:()=>Pe,replaceOldThemeVariables:()=>$e});var t={};d.r(t),d.d(t,{addItemResource:()=>Rt,checkItemVersion:()=>yt,createItem:()=>ht,getItem:()=>It,getItemData:()=>mt,getItemResource:()=>St,getItemResources:()=>Ct,getOriginUrl:()=>rt,getRequestMethod:()=>ct,getUserContentUrl:()=>dt,getUserName:()=>ut,getUserTags:()=>wt,importItem:()=>ft,removeItem:()=>At,removeItemResource:()=>Lt,request:()=>at,searchItems:()=>tt,searchItemsByPortalUrl:()=>ot,updateItem:()=>Tt,updateItemResource:()=>xt});var i={};d.r(i),d.d(i,{getExpressModeTemplateNames:()=>Vt,processForTemplate:()=>Ht});var o={};d.r(o),d.d(o,{listenAppEvents:()=>Pi,publishActivePagePartChangeToApp:()=>ri,publishAnimationPreviewToApp:()=>li,publishAppConfigChangeToApp:()=>qt,publishAppInfoChangeToApp:()=>Kt,publishAppModeChangeToApp:()=>Yt,publishChangeBrowserSizeModeToApp:()=>oi,publishChangeDynamicStyleStateToApp:()=>Si,publishChangeSelectionToApp:()=>Xt,publishChangeSessionToApp:()=>ni,publishChangeWidgetStatePropToApp:()=>ei,publishChangeZoomScaleToApp:()=>ai,publishDialogChangeToApp:()=>Zt,publishDialogInfosChangeToApp:()=>Jt,publishHoverPreviewToApp:()=>di,publishKeyboardToApp:()=>ii,publishNoPermissionResourceInfoListChangeToApp:()=>si,publishOpenCookieBannerByPrivacyPanelToApp:()=>fi,publishOpenCookieBannerToApp:()=>hi,publishOpenCookieSettingsWindowToApp:()=>yi,publishPageChangeToApp:()=>Qt,publishRuntimeThemeModeChangeToApp:()=>Ci,publishScreenGroupNavInfoToApp:()=>ci,publishSectionNavInfoToApp:()=>ui,publishSetClientIdAlertIsCancelled:()=>gi,publishSetWidgetIsInlineEditingStateToApp:()=>mi,publishTocHoverInfoToApp:()=>pi,publishUtilityStateChangeToApp:()=>ti,publishWidgetRuntimeInfoChangeToApp:()=>wi,publishWidgetStateChangeToApp:()=>Ii,publishWidgetToolbarStateChangeToApp:()=>vi});var n={};d.r(n),d.d(n,{letBuilderAddResource:()=>Wi,letBuilderResponseToKeyboard:()=>zi,listenBuilderEvents:()=>Oi,publishAppIsLoadedToBuilder:()=>Bi,publishAppSessionChangeToBuilder:()=>Ui,publishAppStateChangeToBuilder:()=>Di,publishCheck498ErrorToBuilder:()=>ki,publishClassificationBannerReadyToBuilder:()=>Hi,publishCloseBannerToBuilder:()=>Ni,publishConfirmDeleteToApp:()=>Fi,publishNoPermissionResourceInfoListChangeToBuilder:()=>Ei,publishPortalUrlNeedToRegisterClientId:()=>$i,publishShowTextArcadePanelBuilder:()=>Vi,publishSidePanelToApp:()=>Gi});var s={};d.r(s),d.d(s,{CUSTOM_GROUP:()=>Io,fetchCommonWidgetList:()=>lo,fetchRemoteCustomWidgetList:()=>co,getBuilderUrl:()=>vo,getDefaultSectionIcon:()=>so,getDefaultTocDialogIcon:()=>no,getDefaultTocPageIcon:()=>oo,getHomePageUrl:()=>mo,getPageListByDialogId:()=>ao,getPlaceholderItemForWidgetsList:()=>ho,getSectionItemForWidgetsList:()=>go,getWidgetsGroupLabel:()=>po,redo:()=>Co,showCustomWidgets:()=>yo,showRemoteCustomWidgets:()=>fo,undo:()=>wo});var a={};d.r(a),d.d(a,{getBuildAppsHelpLink:()=>Mo,getFAQLink:()=>_o,getHomeHelpLink:()=>To,getWhatsNewLink:()=>xo,getWidgetHelpLink:()=>Ro,isSupportLanguage:()=>Lo});var r=d(244);class l extends r.React.PureComponent{}const c=l;var p,g=d(386),h=d(972),f=d(888);!function(e){e.SelectTemplate="SELECT_TEMPLATE",e.WidgetSettingClassLoaded="WIDGET_SETTING_CLASS_LOADED",e.WidgetsRemoved="WIDGETS_REMOVED",e.WidgetsAdded="WIDGETS_ADDED",e.ChangeCurrentApp="CHANGE_CURRENT_APP",e.RefreshAppList="REFRSH_APPLIST",e.WidgetSettingI18nMessageLoaded="WIDGET_SETTING_I18N_MESSAGE_LOADED",e.ConfirmDeleteContentChanged="CONFIRM_DELETE_CONTENT_CHANGED",e.MessageActionSettingOpenStateChange="MESSAGE_ACTION_OPEN_STATE_CHANGE"}(p||(p={}));const y={selectTemplate:e=>({type:p.SelectTemplate,templateName:e}),refreshAppListAction:e=>({type:p.RefreshAppList,isRefresh:e}),widgetSettingClassLoaded:e=>({type:p.WidgetSettingClassLoaded,wigetUri:e}),changeMessageActionSettingOpenState:(e,t)=>({type:p.MessageActionSettingOpenStateChange,widgetId:e,open:t}),widgetsAdded:e=>({type:p.WidgetsAdded,widgets:e}),widgetsRemoved:e=>({type:p.WidgetsRemoved,widgetIds:e}),changeCurrentApp:e=>({type:p.ChangeCurrentApp,appId:e}),widgetSettingI18nMessageLoaded:(e,t)=>({type:p.WidgetSettingI18nMessageLoaded,widgetName:e,i18nMessages:t}),confirmDeleteContentChanged:e=>({type:p.ConfirmDeleteContentChanged,itemToDelete:e})};class v{constructor(){this.id="builder-state-redux-store-extension"}getActions(){return Object.keys(p).map(e=>p[e])}getInitLocalState(){return(0,r.Immutable)({templateName:null,currentAppId:null,refreshAppList:!1,isMobile:!1,widgetSettingI18nMessages:(0,r.Immutable)({}),widgetsSettingClassStatus:(0,r.Immutable)({})})}getReducer(){return(e,t,i)=>{switch(t.type){case p.SelectTemplate:return e.set("templateName",t.templateName);case p.WidgetSettingClassLoaded:return e=e.setIn(["widgetsSettingClassStatus",t.wigetUri],!0),function(e,t){var i,o;const n=(null===(o=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===o?void 0:o.widgets)||{};return Object.keys(n).filter(e=>n[e].uri===t)}(i,t.wigetUri).forEach(t=>{e=e.setIn(["widgetsSettingRuntimeInfo",t,"isClassLoaded"],!0)}),e;case p.WidgetsAdded:return t.widgets.forEach(t=>{e.widgetsSettingClassStatus[t.widgetUri]&&(e=e.setIn(["widgetsSettingRuntimeInfo",t.widgetId,"isClassLoaded"],!0))}),e;case p.WidgetsRemoved:return e.set("widgetsSettingRuntimeInfo",e.widgetsSettingRuntimeInfo.without(...t.widgetIds));case p.ChangeCurrentApp:return(e=this.getInitLocalState()).set("currentAppId",t.appId).set("widgetsSettingRuntimeInfo",{});case p.MessageActionSettingOpenStateChange:return(null==e?void 0:e.widgetMessageActionSettingStatus)||(e=e.set("widgetMessageActionSettingStatus",{})),e=e.setIn(["widgetMessageActionSettingStatus",t.widgetId],t.open);case p.RefreshAppList:return e.set("refreshAppList",t.isRefresh);case p.WidgetSettingI18nMessageLoaded:return e.setIn(["widgetSettingI18nMessages",t.widgetName],t.i18nMessages);case p.ConfirmDeleteContentChanged:{const{itemToDelete:i}=t;return e.set("contentToDelete",i)}default:return e}}}getStoreKey(){return"builder"}}var m=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const{getLocaleToLoad:I,loadLocaleMessages:w}=r.i18n;class C{static getInstance(){return C.instance||(C.instance=new C,window._widgetSettingManager=C.instance),C.instance}constructor(){this.settings={},(0,r.observeStore)(this.onStoreChange.bind(this),["appStateInBuilder","appConfig","widgets"])}getWidgetUri(e){var t,i,o;const n=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig;return null===(o=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e])||void 0===o?void 0:o.uri}getWidgetManifestByUri(e){var t,i,o;const n=null===(i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets,s=Object.keys(n||{}).find(t=>n[t].uri===e);return null===(o=n[s])||void 0===o?void 0:o.manifest}updateWidgetCache(e,t){if("__proto__"!==e&&"constructor"!==e&&"prototype"!==e){this.settings[e]||(this.settings[e]={});for(const i in t){if("__proto__"===i||"constructor"===i||"prototype"===i)return;this.settings[e][i]=t[i]}}}getWidgetSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.settingClazz}destroyWidgetSettingClass(e){const t=this.getWidgetUri(e);t&&delete this.settings[t]}destroyWidgetSettingClassByUri(e){this.checkWidgetUriInConfig(e)||delete this.settings[e]}getItemSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.itemSettingClazz}getSettingI18nMessagesByUri(e){var t;return null===(t=this.settings[e])||void 0===t?void 0:t.settingI18nMessage}destroyAllWidgetSettingClasses(){this.settings={}}loadWidgetSettingClass(e){return m(this,void 0,void 0,function*(){var t,i,o;const n=null===(o=null===(i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===o?void 0:o[e];if(!n)return yield Promise.resolve(null);if(!n.manifest)return yield Promise.resolve(null);const s=this.getWidgetUri(e);return this.loadWidgetSettingClassByUri(s)})}checkWidgetUriInConfig(e){var t,i;const o=(null===(i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||{};return!!Object.keys(o).find(t=>o[t].uri===e)}loadWidgetSettingClassByUri(e){return this.settings[e]||(this.settings[e]={}),this.settings[e].settingClazzPromise||(this.settings[e].settingClazzPromise=this.loadRawSettingClass(e).then(()=>m(this,void 0,void 0,function*(){return yield this.loadI18nMessagesForSetting(e)})).then(()=>{const t=this.injectWidgetSettingProps(e);return t?(this.settings[e].settingClazz=t,(0,r.getAppStore)().dispatch(y.widgetSettingClassLoaded(e)),t):(delete this.settings[e],null)})),this.settings[e].settingClazzPromise}loadRawSettingClass(e){return m(this,void 0,void 0,function*(){const t=this.getWidgetManifestByUri(e);let i=`${e}dist/setting/setting`;return t.properties.hasSettingPage||(i="jimu-for-builder/json-editor-setting"),yield this.loadWidgetSettingDependency(e).then(()=>m(this,void 0,void 0,function*(){return yield r.moduleLoader.loadModule(i)})).then(t=>{const i=t.default?t.default:t;return this.settings[e].rawSettingClazz=i,i})})}loadI18nMessagesForSetting(e){return m(this,void 0,void 0,function*(){if(this.settings[e]||(this.settings[e]={}),this.settings[e].settingI18nMessagePromise)return yield this.settings[e].settingI18nMessagePromise;const t=this.getWidgetManifestByUri(e);if(!t)return yield Promise.resolve({});if(t.translatedLocales){let i=(0,r.getAppStore)().getState().appContext.locale;i=I(i,t.translatedLocales),this.settings[e].settingI18nMessagePromise=i?w(`${e}dist/setting/translations`,i):Promise.resolve({})}else this.settings[e].settingI18nMessagePromise=Promise.resolve({});return yield this.settings[e].settingI18nMessagePromise.then((i={})=>((0,r.getAppStore)().dispatch(y.widgetSettingI18nMessageLoaded(t.name,i)),this.settings[e].settingI18nMessage=i,i))})}loadWidgetSettingDependency(e){return m(this,void 0,void 0,function*(){const t=this.getWidgetManifestByUri(e);if(!t.settingDependency)return void(yield Promise.resolve());const i="string"==typeof t.settingDependency?[t.settingDependency]:t.settingDependency;yield(0,r.loadDependencies)(i)})}loadItemSettingClass(e){return m(this,void 0,void 0,function*(){var t,i,o;const n=null===(o=null===(i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===o?void 0:o[e];return n&&n.manifest?yield this.loadItemSettingClassByUri(this.getWidgetUri(e)):yield Promise.resolve(null)})}loadItemSettingClassByUri(e){return m(this,void 0,void 0,function*(){return this.settings[e]||(this.settings[e]={}),this.settings[e].itemSettingClazzPromise||(this.settings[e].itemSettingClazzPromise=this.loadRawItemSettingClass(e).then(t=>(this.settings[e].itemSettingClazz=t,t))),this.settings[e].itemSettingClazzPromise})}loadRawItemSettingClass(e){return m(this,void 0,void 0,function*(){const t=`${e}dist/setting/item-setting`;return yield r.moduleLoader.loadModule(t).then(e=>e.default?e.default:e)})}injectWidgetSettingProps(e){if(!this.checkWidgetUriInConfig(e))return null;const t=this.settings[e].rawSettingClazz,i=(0,r.injectIntl)(t),o=(0,f.withTheme)(i,!0),n=this.getWidgetManifestByUri(e),s=n.name,a=this.settings[e].settingI18nMessage;class l extends h.PureComponent{constructor(e){super(e),this.state={fullConfig:null}}componentDidMount(){t.getFullConfig&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}componentDidUpdate(e){t.getFullConfig&&e.config!==this.props.config&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}getFullConfig(e){return t.getFullConfig?t.getFullConfig(e):e}render(){if(n.version!==this.props.version)return null;const e={messages:a,savedConfig:this.props.config};this.state.fullConfig?e.config=this.state.fullConfig:e.config=this.getFullConfig(this.props.config);const t=Object.assign({},a,this.props.appI18nMessages);return(0,g.jsx)(r.IntlProvider,{locale:this.props.locale,defaultLocale:this.props.locale,messages:t,children:(0,g.jsx)(o,Object.assign({},this.props,e))})}}l.displayName=`WidgetSettingWrapper(${s})`;return r.ReactRedux.connect((e,i)=>{const o={queryObject:e.queryObject,user:e.user,portalUrl:e.portalUrl,portalSelf:e.portalSelf,locale:e.appContext.locale,appI18nMessages:e.appI18nMessages},n=i.widgetId,s=e.appStateInBuilder.appConfig.widgets[n],a=e.appStateInBuilder.widgetsRuntimeInfo[n];if(!s)return{};const r=Object.assign(o,s,i,a);return Object.assign(r,t.mapExtraStateProps?t.mapExtraStateProps(e,r):{})})(l)}onStoreChange(e,t){e&&t&&Object.keys(e).forEach(e=>{t[e]})}}const S=C;var b=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};class P{constructor(){this.actionSettings={}}static getInstance(){return P.instance||(P.instance=new P),P.instance}getAllActions(){const e=this.getAppMessageManager();return e?e.getActions():[]}getAction(e,t){const i=this.getAppMessageManager();return i?i.getAction(e,t):null}getAppMessageManager(){if(window.jimuConfig.isBuilder){if(window._appWindow._messageManager)return window._appWindow._messageManager}else if(window._messageManager)return window._messageManager;return null}getActionSettingComponentUri(e,t,i){if(e.getSettingComponentUri)return e.getSettingComponentUri(t,i);if(e.widgetId){const t=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e.widgetId].manifest.messageActions.find(t=>t.name===e.name);return t?t.settingUri:null}return null}getFilteredActions(e,t){if(window._appWindow._messageManager){const i=window._appWindow._messageManager.getActions(),o=[],n={messageType:e,widgetId:t},s=(window.jimuConfig.isBuilder?(0,r.getAppStore)().getState().appStateInBuilder:(0,r.getAppStore)().getState()).appConfig.widgets[t].manifest.publishMessages.find(t=>"string"==typeof t?t===e:t.messageType===e);s&&"string"!=typeof s&&(n.messageCarryData=s.messageCarryData);for(let e=0;e<i.length;e++)i[e].filterMessageDescription(n)&&o.push(i[e]);return o}return[]}getConvertedSettingUri(e,t){const i=this.getAllActions();let o=null;for(let n=0;n<i.length;n++)if(e.includes(i[n].id)){const e=i[n].widgetId;if(e){const s=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e],a=s.manifest.messageActions;let l=null;if(a)for(let e=0;e<a.length;e++)a[e].name===i[n].name&&(l=a[e]);return l&&t?(o=s.uri+"dist/"+t,o):null}return t}return o}loadActionSettingClass(e,t){return b(this,void 0,void 0,function*(){var i;const o=t?this.getConvertedSettingUri(e.actionId,t):null;if(o||Promise.resolve(null),this.actionSettings[o]||(this.actionSettings[o]={}),null===(i=this.actionSettings[o])||void 0===i?void 0:i.clazzPromise)return yield this.actionSettings[o].clazzPromise;const n=e.widgetId,s=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[n];return n&&(yield this.loadDependency(n)),this.actionSettings[o].clazzPromise=this.loadRawSettingClass(o).then(e=>b(this,void 0,void 0,function*(){return S.getInstance().loadI18nMessagesForSetting(s&&s.uri).then(t=>this.injectActionSettingProps(e,t,s&&s.id))})).then(e=>(this.actionSettings[o].clazz=e,e)),this.actionSettings[o].clazzPromise})}loadRawSettingClass(e){return b(this,void 0,void 0,function*(){return this.actionSettings[e].rawClazzPromise?yield this.actionSettings[e].rawClazzPromise:(this.actionSettings[e].rawClazzPromise=r.moduleLoader.loadModule(e).then(t=>(t=t.default?t.default:t,this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazz)),this.actionSettings[e].rawClazzPromise)})}loadDependency(e){return b(this,void 0,void 0,function*(){var t;const i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===t?void 0:t.manifest;if(!(null==i?void 0:i.settingDependency))return Promise.resolve();const o="string"==typeof i.dependency?[i.dependency]:i.dependency.asMutable();return(0,r.loadDependencies)(o)})}injectActionSettingProps(e,t,i){const o=(0,r.injectIntl)(e),n=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i];let s=null;s=i&&n?(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i].manifest.name:"Framework";class a extends r.React.PureComponent{render(){const e={messages:t},i=(0,r.getAppStore)().getState().appI18nMessages,n=(0,r.getAppStore)().getState().appContext.locale,s=Object.assign({},t,i);return(0,g.jsx)(r.IntlProvider,{locale:n,defaultLocale:n,messages:s,children:(0,g.jsx)(o,Object.assign({},this.props,e))})}}a.displayName=`ActionSettingWrapper(${s})`;for(const t in e)a[t]||(a[t]=e[t]);return a}registerActionRawSettingClass(e,t){this.actionSettings[e]||(this.actionSettings[e]={}),this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazzPromise=Promise.resolve(t),this.actionSettings[e].settingI18nMessages={},this.actionSettings[e].settingI18nMessagesPromise=Promise.resolve({})}getActionRawSettingClass(e){return this.actionSettings[e].rawClazz}}var A=d(496);function L(e,t){return Object.values(null!=t?t:{}).forEach(t=>{e=function(e,t){var i;const o=e.layouts[t];return o?(delete o.parent,Object.keys(null!==(i=o.content)&&void 0!==i?i:{}).forEach(t=>{const i=o.content[t];switch(i.type){case r.LayoutItemType.Widget:{const t=e.widgets[i.widgetId];t&&(delete t.parent,t.layouts&&Object.values(t.layouts).forEach(t=>{e=L(e,t)}));break}case r.LayoutItemType.Section:{const t=e.sections[i.sectionId];delete t.parent,t.views.forEach(t=>{const i=e.views[t];delete i.parent,e=L(e,i.layout)});break}case r.LayoutItemType.ScreenGroup:{const t=e.screenGroups[i.screenGroupId];delete t.parent,t.screens.forEach(t=>{var i;const o=e.screens[t];delete o.parent,e=L(e,o.main.layout),(null===(i=o.panel)||void 0===i?void 0:i.layout)&&(e=L(e,o.panel.layout))});break}}}),e):e}(e,t)}),e}class M{addParentToList(e,t,i){if(!t||0===t.length)return[i];if(!t.some(e=>e.layoutId===i.layoutId&&e.layoutItemId===i.layoutItemId)){const o=t[0].layoutId,n=e.layouts[o],s=e.layouts[i.layoutId];if(o===i.layoutId||s.parent.id!==n.parent.id||s.parent.type!==n.parent.type)return[i];return[].concat(t,i)}return t}removeParentFromList(e,t){return e&&0!==e.length?e.filter(e=>e.layoutId!==t.layoutId||e.layoutItemId!==t.layoutItemId):[]}}const T=r.LayoutType.FixedLayout;class x{static getInstance(){return x.instance||(x.instance=new x),x.instance}static getService(e,t){var i;const o=e.layouts[t],n=x.getInstance().getServiceByType(null!==(i=null==o?void 0:o.type)&&void 0!==i?i:T);return n||x.getInstance().getServiceByType(T)}static getServiceFromSizeModeLayout(e,t){var i;const o=Object.values(t)[0],n=t[e.mainSizeMode];return null!==(i=x.getService(e,o))&&void 0!==i?i:x.getService(e,n)}constructor(){this.serviceMap=new Map}registerService(e,t){this.serviceMap.set(e,t)}getServiceByType(e){return this.serviceMap.get(null!=e?e:T)}}var _=d(884);const R={frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_UseRelationship:"Use layer's relationship",frameworkAction_CustomFields:"Set custom connection fields",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy",openingGuideStep1Title:"Getting started",openingGuideStep1Content:"This tour will show you how to navigate in Experience Builder",openingGuideStep2Title:"Canvas",openingGuideStep2Content:"You can interact with widgets in your experience visually on the canvas.",openingGuideStep3Title:"Sidebar",openingGuideStep3Content:"Allows you to open the widget, page, data, and theme panels.",openingGuideStep4Title:"Insert widget",openingGuideStep4Content:"Click on the Map widget and drag it onto the canvas.",openingGuideStep5Title:"Resize widget",openingGuideStep5Content:"You can change the size of widget on the canvas.",openingGuideStep7Title:"Style",openingGuideStep7Content:"Click the Style tab to switch to the style setting panel.",openingGuideStep8Title:"Size and position",openingGuideStep8Content:"Click the Full size button located at the top right hand corner.",openingGuideStep8Title2:"Style",openingGuideStep8Content2:"Allows you to customize properties such as size, position, background, animation, border, and transform.",openingGuideStep9Title:"Action",openingGuideStep9Content:"Click the Action tab to switch to the action setting panel.",openingGuideStep10Title:"Action",openingGuideStep10Content:"Interactions between widgets can be configured using triggers and actions. Widget actions are in response to linked trigger actions in other widgets.",openingGuideStep11Title:"Header",openingGuideStep11Content:"Click Live view to make your experience interactive inside the builder.",openingGuideStep12Title:"Page",openingGuideStep12Content:"Shows the structure of your experience. You can create and organize pages and folders and change page settings.",openingGuideStep13Title:"Data",openingGuideStep13Content:"Displays all the data listed in your experience and the widgets connected to the data.",openingGuideStep14Title:"Theme",openingGuideStep14Content:"Defines the color scheme for the appearance of your experience.",openingGuideStep15Title:"End of tour",openingGuideStep15Content:"You can always return if you need a refresher.",DSSelectionStep1Title:"Widget content",DSSelectionStep1Content:"Click on Select map to add a new data source.",DSSelectionStep2Title:"Add new data",DSSelectionStep2Content:"Click add new data and select a web map for a data source.",DSSelectionStep3Title:"Select data",DSSelectionStep3Content:"Click the web map in the select data panel.",DSSelectionStep4Title:"Widget content",DSSelectionStep4Content:"Click on Select data to add a new data source.",DSSelectionStep5Title:"Select data",DSSelectionStep5Content:"Click the feature layer in the select data panel.",insertWidgetStep1Title:"Insert widget",insertWidgetStep1Content:"Click on the widget and drag it onto the canvas.",welcomeStep1Content:"This tour will show you how to navigate in Experience Builder express mode.",mapWidgetTitle:"Configure Widget",mapWidgetContent:"<p>Activate a widget by clicking on it. Widget configuration will open on the right side panel. For example, please <b>click on the map</b>.</p>",expressSelectDataTitle:"Configure map",expressSelectDataContent:"Select map source, enable map tools and configure other settings.",expressMessageActionTitle:"Message action",expressMessageActionContent:"Configure message actions to communicate with other widgets.",widgetControllerTitle:"Widget controller",widgetControllerContent:"<p><b>Click at the Widget controller area,</b> managing buttons will show on the top bar. Configure Widget controller behaviors on the right side.</p>",expressWidgetControllerAddWidgetTitle:"Add or manage widgets in Widget controller",expressWidgetControllerAddWidgetContent:"Click the Add button on the top bar to add widgets to the Widget controller. Use the Manage widget button to reorder or group widgets. To remove a widget, click on it and a Delete button will show on the top bar.",expressTextTitle:"Configure title",expressTextContent:"Double click to change the title for your app.",expressSectionTitle:"Add or manage views",expressSectionContent:"<p><b>Click on the View navigation area</b>, managing buttons will show on the top bar. You can add new views, reorder or remove views. You can add a widget to each view.</p>",expressSidebarTitle:"Configure widget in Sidebar",expressSidebarContent:"<p><b>Click the expand button</b> to open the sidebar. Click the widget inside to configure.</p>",expressSidebarTitle1:"Configure Sidebar",expressSidebarContent1:"You can decide whether to show the sidebar by enabling or disabling the sidebar Collapse button.",expressGridTitle:"Managing grids",expressGridContent:"Click on a grid and managing buttons will show on the top bar. You can remove a grid or split it in a preferred way.",expressPlaceholderTitle:"Add or manage widget",expressPlaceholderContent:"<p>Click the Add button on Placeholder to add a widget and configure it on the right side. <br> To remove the widget, click on the widget and a delete button will show on the top bar.</p>",expressThemeTitle:"Theme & General settings",expressThemeContent:"Select a preferred theme from Theme tab. Configure app general settings from General tab.",expressWindowTitle:"Page or Window switch",expressWindowContent:"<p><b>Click the outline menu</b> to switch between page and window.</p>",expressWindowTitle1:"Configure window",expressWindowContent1:"Configure Window behaviors on the right side. Double click text to edit. For other widgets, click to activate configuration on the right side.",expressWindowTitle2:"Configure window",expressWindowContent2:"<p><b>Click Window option</b> to switch Window settings. Hover on the Window option and click the Set as splash icon beside it to set a splash window. You can choose window design from templates.</p>",expressTopBarTitle:"Top bar options",expressTopBarContent:"<ul><li>Review different screen sizes </li><li>Undo or Redo operations </li><li>Save, publish and preview the experience.</li><li>More</li></ul>",expressFullEditModeTitle:"Full mode",expressFullEditModeContent:"You can switch to full mode which allows advanced experience design.",expressEndGuideTitle:"Congratulations! You have completed the tour!",expressEndGuideContent:"Now start to build your experience. You can always return to the guide by clicking the Help button on the bottom left corner of the builder if you need a refresher."};var j=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function O(e,t,i){const[o]=r.appConfigUtils.parseUniqueLabel(i);let n=r.appConfigUtils.getUniqueLabel(e,t,o);return n===o&&(n=`${o} 1`),n}function U(e){return j(this,void 0,void 0,function*(){if(!e.config){const t=yield(0,_.getTemplateConfig)(e.type,e.name);r.appConfigUtils.fixLayoutIds(t),r.utils.replaceI18nPlaceholdersInObject(t,r.i18n.getIntl(),R),e.config=t}})}function E(e){return k().find(t=>t.widgetId===e)}function k(){let e;e=window.jimuConfig.isBuilder?window._appWindow._extensionManager:window._extensionManager;return(null==e?void 0:e.getExtensions(r.extensionSpec.ExtensionPoints.AppConfigOperations))||[]}const D=new class{removeDataSource(e,t){if(!e.dataSources||!e.dataSources[t])return e;console.debug("removeDataSource",t);let i=e;const o=k();try{o.forEach(e=>{if(e.dataSourceWillRemove){if(e.widgetId){const o=i.widgets[e.widgetId];if(!o||!o.useDataSources||!o.useDataSources.find(e=>e.dataSourceId===t||e.mainDataSourceId===t))return}i=e.dataSourceWillRemove(i,t)}})}catch(e){console.error("Error when calling dataSourceWillRemove",e)}return i=i.set("dataSources",i.dataSources.without(t)),i=this.removeUseDataSource(i,t),i}removeUseDataSource(e,t){var i,o;if(!t)return e;console.debug("removeUseDataSource",t);let n=e;return Object.entries(null!==(i=n.widgets)&&void 0!==i?i:{}).forEach(([e,i])=>{if(i.useDataSources&&i.useDataSources.find(e=>this.shouldBeRemoved(e,t))){const o=E(e);(null==o?void 0:o.useDataSourceWillChange)&&(n=o.useDataSourceWillChange(n,t,null)),n=n.setIn(["widgets",e,"useDataSources"],i.useDataSources.filter(e=>!this.shouldBeRemoved(e,t)))}i.outputDataSources&&i.outputDataSources.find(e=>e===t)&&(n=n.setIn(["widgets",e,"outputDataSources"],i.outputDataSources.filter(e=>e!==t)))}),Object.keys(null!==(o=n.messageConfigs)&&void 0!==o?o:{}).forEach(e=>{var i;const o=null===(i=n.messageConfigs[e].actions)||void 0===i?void 0:i.asMutable({deep:!0});null==o||o.forEach((i,s)=>{var a;if(null===(a=null==i?void 0:i.useDataSources)||void 0===a?void 0:a.find(e=>this.shouldBeRemoved(e,t))){if(!i.widgetId){k().filter(e=>!e.widgetId).forEach(e=>{(null==e?void 0:e.useDataSourceWillChange)&&(n=e.useDataSourceWillChange(n,t,null))})}o[s].useDataSources=i.useDataSources.filter(e=>!this.shouldBeRemoved(e,t)),n=n.setIn(["messageConfigs",e,"actions"],o)}})}),Object.entries(n.dataSources).forEach(([e,i])=>{i.originDataSources&&i.originDataSources.find(e=>this.shouldBeRemoved(e,t))&&(n=this.removeDataSource(n,e))}),n}duplicateDataSource(e,t,i,o,n){if(!e.dataSources||!e.dataSources[o])return null;console.debug("duplicate data source",o);const s=e.dataSources[o];let a=Se("dataSource");s.isOutputFromWidget&&(a=o.startsWith(`${t}_output`)?o.replace(`${t}_output`,`${i}_output`):`${i}_output_${a}`);const r=s.set("id",a).set("label",O(e,"dataSource",s.label)),l=this.addDataSource(e,r);return n&&(n[o]=r.id),[l,r]}addDataSource(e,t){return e.dataSources&&e.dataSources[t.id]?e:e.setIn(["dataSources",t.id],t)}updateAfterChangingLayout(e,t,i){if(!e.widgets[t])return e;console.debug(t,"update data source after move to",i);let o=e.widgets[t],n=e;const s=A.searchUtils.getWidgetIdThatUseTheLayoutId(n,i);if(s){const e=n.widgets[s];e.manifest.properties.passDataSourceToChildren&&(o=this.mergeUseDataSource(e,o),n=n.setIn(["widgets",o.id],o))}return n}mergeUseDataSource(e,t){if(!e.useDataSources)return t;const i=e.useDataSources.map(e=>e.without("fields"));return t.useDataSources?(i.forEach(e=>{e.dataViewId?t.useDataSources.find(t=>t.dataSourceId===e.dataSourceId&&t.dataViewId===e.dataViewId)||(t=t.set("useDataSources",t.useDataSources.concat([e]))):t.useDataSources.find(t=>t.dataSourceId===e.dataSourceId)||(t=t.set("useDataSources",t.useDataSources.concat([e])))}),t.set("useDataSourcesEnabled",!0)):t.set("useDataSources",i).set("useDataSourcesEnabled",!0)}shouldBeRemoved(e,t){return!e||e.dataSourceId===t||e.mainDataSourceId===t||e.rootDataSourceId===t}};const B=new class{duplicate(e,t,i,o){const n=e.messageConfigs;if(!n)return[e,null];console.debug("duplicate message configs from",t,"to",i);let s=e,a=null;return Object.keys(n).forEach(e=>{if(n[e].widgetId===t){const t=n[e].set("id",Se("messageConfig")).set("widgetId",i);a=t.id,s=s.setIn(["messageConfigs",t.id],t),o[e]=t.id}if(n[e].actions){const o=[];n[e].actions.forEach(e=>{if(e.widgetId===t){const t=e.set("widgetId",i);o.push(t)}}),o.length>0&&(s=s.setIn(["messageConfigs",n[e].id,"actions"],n[e].actions.concat(o)))}}),[s,a]}removeFromWidget(e,t){const i=e.messageConfigs;if(!i)return e;console.debug("remove message and action in",t);const o=Object.keys(i);let n=(0,r.Immutable)({});for(let e=0;e<o.length;e++)i[o[e]].widgetId!==t&&(n=n.setIn([i[o[e]].id],i[o[e]]));const s=Object.keys(n);for(let e=0;e<s.length;e++){const o=n[s[e]].actions;if(0===o.length)continue;const a=o.filter(e=>e.widgetId!==t),r=Object.assign([],a);n=n.setIn([i[s[e]].id,"actions"],r)}return e.set("messageConfigs",n)}removeFromSection(e,t){const i=e.messageConfigs;if(!i)return e;console.debug("remove message and action in",t);const o=Object.keys(i);let n=i;for(let e=0;e<o.length;e++){const s=n[o[e]].actions;if(0===s.length)continue;const a=s.filter(e=>e.sectionId!==t),r=Object.assign([],a);n=n.setIn([i[o[e]].id,"actions"],r)}return e.set("messageConfigs",n)}};const W=new class{removeFromWidget(e,t){var i;const o=e.widgets[t];if(!(null===(i=o.manifest)||void 0===i?void 0:i.dataActions)||0===o.manifest.dataActions.length)return e;console.debug("remove data action in",t);const n=o.manifest.dataActions.map(e=>e.name);let s=e;return Object.keys(e.widgets).forEach(i=>{let o=e.widgets[i];o.dataActions&&n.forEach(e=>{var n,a;const r=null===(n=o.dataActions)||void 0===n?void 0:n[e];if(r){const n=null===(a=r.actions)||void 0===a?void 0:a.without(t);0===Object.keys(n||{}).length?(o=o.set("dataActions",o.dataActions.without(e)),0===Object.keys(o.dataActions).length&&(o=o.without("dataActions"))):o=o.setIn(["dataActions",e,"actions"],n),s=s.setIn(["widgets",i],o)}})}),s}};const z=new class{remove(e,t){let i=e;return console.debug("remove used map widgets",t),Object.keys(i.widgets).forEach(e=>{var o;const n=i.widgets[e];if(null===(o=n.useMapWidgetIds)||void 0===o?void 0:o.includes(t)){const o=n.useMapWidgetIds.filter(e=>e!==t);i=i.setIn(["widgets",e,"useMapWidgetIds"],o)}}),i}};function F(e,t){return e.layoutId===t.layoutId&&e.layoutItemId===t.layoutItemId}const $=new class{isSupported(){var e,t,i;let o;window.jimuConfig.isInBuilder?o=(0,r.getAppStore)().getState():window.jimuConfig.isBuilder&&(o=(0,r.getAppStore)().getState().appStateInBuilder);const n=(null===(e=null==o?void 0:o.appInfo)||void 0===e?void 0:e.type)===r.AppType.Template,s=(null===(t=null==o?void 0:o.appRuntimeInfo)||void 0===t?void 0:t.appMode)===r.AppMode.Design,a=(null===(i=null==o?void 0:o.appRuntimeInfo)||void 0===i?void 0:i.appMode)===r.AppMode.Express;return n&&s||a}getNextPlaceholderId(e){var t;const i=Object.keys(null!==(t=e.placeholderInfos)&&void 0!==t?t:{}).map(e=>+e).sort((e,t)=>e-t);let o=1;for(let e=0;e<i.length&&o===i[e];e++)o++;return o}addAsSyncablePlaceholder(e,t){if(!this.isSupported())return e;const i=(0,r.getAppStore)().getState().appStateInBuilder.browserSizeMode;if(i!==e.mainSizeMode)return e;const o=A.searchUtils.getRootContainerInfoOfLayout(e,t.layoutId,i),n=this.getNextPlaceholderId(e);return e.setIn(["placeholderInfos",`${n}`,"id"],n).setIn(["placeholderInfos",`${n}`,"rootContainer"],o).setIn(["placeholderInfos",`${n}`,"layoutInfo"],t)}getPlaceholderInfo(e,t){var i;if(!this.isSupported())return null;let o=null;return Object.keys(null!==(i=e.placeholderInfos)&&void 0!==i?i:{}).some(i=>{var n;const s=e.placeholderInfos[i];return F(s.layoutInfo,t)?(o=s,!0):Object.keys(null!==(n=s.syncs)&&void 0!==n?n:{}).some(e=>!!F(s.syncs[e],t)&&(o=s,!0))}),o}afterLayoutItemMoved(e,t,i){var o;if(!this.isSupported())return e;let n=e;const s=this.getPlaceholderInfo(e,t);if(s){if(F(s.layoutInfo,t))return n=n.setIn(["placeholderInfos",s.id,"layoutInfo"],i),n;const e=Object.keys(null!==(o=s.syncs)&&void 0!==o?o:{});for(let o=0;o<e.length;o++){const a=e[o];if(F(s.syncs[a],t))return n=n.setIn(["placeholderInfos",s.id,"syncs",a],i),n}}return n}afterLayoutItemCopied(e,t,i){if(!this.isSupported())return e;const o=A.searchUtils.findLayoutItem(e,t);if(o.widgetId||o.sectionId)return e;const n=this.getPlaceholderInfo(e,t);return n&&F(n.layoutInfo,t)?this.addAsSyncablePlaceholder(e,i):e}afterLayoutItemRemoved(e,t){var i;if(!this.isSupported())return e;const o=this.getPlaceholderInfo(e,t);if(o){const n=e.placeholderInfos;if(F(o.layoutInfo,t))return e.set("placeholderInfos",n.without(o.id));const s=Object.keys(null!==(i=o.syncs)&&void 0!==i?i:{});for(let i=0;i<s.length;i++){const n=s[i];if(F(o.syncs[n],t))return 1===s.length?e.setIn(["placeholderInfos",o.id],o.without("syncs")):e.setIn(["placeholderInfos",o.id,"syncs"],o.syncs.without(n))}}return e}};class G extends r.WidgetManager{static getInstance(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._widgetManager:r.WidgetManager.getInstance()}}var N=d(859),H=d.n(N),V=d(850),q=d.n(V),K=d(341),J=d.n(K),Y=d(201),Q=d.n(Y),Z=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function X(e){var t,i;return(null==e?void 0:e.widgetType)===r.WidgetType.Layout||null!==(i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.hasEmbeddedLayout)&&void 0!==i&&i}function ee(e){switch(e){case r.LayoutType.FixedLayout:return q();case r.LayoutType.RowLayout:return J();case r.LayoutType.ColumnLayout:return Q();default:return null}}const te=new class extends M{constructor(){super(),this.dsService=D,this.messageActionService=B,this.dataActionService=W,this.useMapService=z}createFromTemplate(e,t,i,o,n,s){return Z(this,void 0,void 0,function*(){var a,l;if(n[i]){const s=e.widgets[n[i]];if(!s.layouts)return[e,n[i]];let a=e;const l=t.config.widgets[i];for(let e=0;e<o.length;e++){const d=o[e],u=Object.keys(l.layouts).filter(e=>{var t;return Object.keys(null!==(t=l.layouts[e])&&void 0!==t?t:{}).length>0});for(let e=0;e<u.length;e++){const o=u[e];if(s.layouts[o][d])continue;const c=l.layouts[o][d],p=x.getService(t.config,c),g=yield p.createLayoutFromTemplate(a,t,c,d,r.LayoutParentType.Widget,n[i],n);a=g[0];const h=g[1];null!=h&&(a=a.setIn(["widgets",n[i],"layouts",o,d],h))}}return[a,n[i]]}const d=null!==(a=null==s?void 0:s.isBlock)&&void 0!==a&&a;yield U(t);const u=t.config,c=Object.keys(u.widgets).find(e=>"widgets/layout/row/"===u.widgets[e].uri);i=null!=i?i:c;const p=u.widgets[i],g=yield G.getInstance().handleNewWidgetJson({uri:p.uri});g.label=be(e,"widget",g.manifest?g.manifest.i18nMessages._widgetLabel||g.manifest.label||g.manifest.name:"");const h=this.createWidget(e,g,o,!1);let f=h[0];const y=h[1];if(yield G.getInstance().registerManifestProps(f.widgets[y]),d){const e=r.i18n.getIntl().formatMessage({id:"block"}),t=be(f,"widget",e);f=f.setIn(["widgets",y,"label"],t)}return n[i]=y,(null===(l=p.useMapWidgetIds)||void 0===l?void 0:l.length)>0&&(f=f.setIn(["widgets",y,"useMapWidgetIds"],p.useMapWidgetIds)),f=yield this.updateWidgetByTemplate(f,t,y,i,o,n),[f,y]})}updateWidgetByTemplate(e,t,i,o,n,s){return Z(this,void 0,void 0,function*(){var a,l,d;const u=null===(a=null==e?void 0:e.widgets)||void 0===a?void 0:a[i];if(!u)return e;yield U(t);let c=e;u.layouts&&Object.keys(u.layouts).forEach(e=>{const t=u.layouts[e];Object.keys(t).forEach(e=>{const i=t[e],o=x.getService(c,i);c=o.removeLayout(c,i,e)})}),c=c.setIn(["widgets",i],u.without("layouts"));const p=null==t?void 0:t.config,g=null===(l=null==p?void 0:p.widgets)||void 0===l?void 0:l[o],h=[];if(g&&(g.config&&(c=c.setIn(["widgets",i,"config"],g.config)),g.style&&(c=c.setIn(["widgets",i,"style"],g.style)),g.layouts)){const i=g.layouts,o=[];Object.keys(i).forEach(t=>{var s,a;const r=i[t]||{},l=(null!==(a=null===(s=u.manifest)||void 0===s?void 0:s.layouts)&&void 0!==a?a:[]).find(e=>e.name===t);n.forEach(i=>{var n;const s=null!==(n=r[i])&&void 0!==n?n:r[e.mainSizeMode];s&&o.push({layoutName:t,sizeMode:i,layoutId:s,layoutLabel:null==l?void 0:l.label})})});for(let e=0;e<o.length;e+=1){const{layoutName:i,sizeMode:n,layoutId:a,layoutLabel:l}=o[e],g=x.getService(p,a),f=yield g.createLayoutFromTemplate(c,t,a,n,r.LayoutParentType.Widget,u.id,s);c=f[0];const y=f[1];h.push(y),c=c.setIn(["widgets",u.id,"layouts",i,n],y).setIn(["layouts",y,"label"],(null===(d=null==u?void 0:u.manifest)||void 0===d?void 0:d.i18nMessages[`_layout_${i}_label`])||l||i)}}return c})}createWidget(e,t,i,o=!0){let n=e;const s=Se("widget");if(console.debug("createWidget",t),n=n.setIn(["widgets",s],t).setIn(["widgets",s,"id"],s),o&&X(t.manifest)){(t.manifest.layouts||[]).forEach(e=>{i.forEach(i=>{const o=x.getInstance().getServiceByType(e.type).createBlankLayout(n,e.type);n=o[0];const a=o[1];console.debug("embed layout",e.name,a,e.type,"created in",i),n=n.setIn(["layouts",a,"label"],t.manifest.i18nMessages[`_layout_${e.name}_label`]||e.label).setIn(["layouts",a,"parent"],{id:s,type:r.LayoutParentType.Widget}).setIn(["widgets",s,"layouts",e.name,i],a)})})}return[n,s]}duplicateEmbedLayout(e,t,i,o,n){var s;const a=e.widgets[t];if(!a||!a.layouts)return[e,null];let l=e;if(console.debug("duplicate layout of widget",t),(null===(s=a.manifest)||void 0===s?void 0:s.widgetType)===r.WidgetType.Layout&&i!==o){console.debug("deuplicate layout widget and its layout from",i,"to",o);const e=a.set("id",Se("widget")).without("layouts").without("parent");return l=l.setIn(["widgets",e.id],e),Object.keys(a.layouts).forEach(t=>{const s=a.layouts[t];if(s[i]){const a=x.getService(l,s[i]).duplicateLayout(l,s[i],i,o,n,!1);l=a[0];const d=a[1];null!=d&&(n[s[i]]=d,l=l.setIn(["layouts",d,"parent"],{type:r.LayoutParentType.Widget,id:e.id}).setIn(["widgets",e.id,"layouts",t,o],d))}}),[l,e.id]}return console.debug("duplicate widget layout only from",i,"to",o),Object.keys(a.layouts).forEach(e=>{const s=a.layouts[e];if(s[i]&&i!==o){const a=x.getService(l,s[i]);s[o]&&(l=a.removeLayout(l,s[o],o));const d=a.duplicateLayout(l,s[i],i,o,n,!1);l=d[0];const u=d[1];null!=u&&(n[s[i]]=u,l=l.setIn(["layouts",u,"parent"],{type:r.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,o],u))}}),[l,null]}duplicate(e,t,i,o){console.debug("duplicate a widget",t);const n=e.widgets[t];if(!n)return[e,null];if(null==o?void 0:o[t]){const n=e.widgets[o[t]];if(!n.layouts)return[e,o[t]];const s=Object.keys(n.layouts)[0];if(n.layouts[s][i])return[e,o[t]];const a=e.widgets[t];let l=e;return Object.keys(a.layouts).forEach(e=>{const n=a.layouts[e][i],s=x.getService(l,n).duplicateLayout(l,n,i,i,o,!0);l=s[0];const d=s[1];null!=d&&(l=l.setIn(["widgets",o[t],"layouts",e,i],d).setIn(["layouts",d,"parent"],{type:r.LayoutParentType.Widget,id:o[t]}))}),[l,o[t]]}const s=n.set("id",Se("widget")).set("label",O(e,"widget",n.label)),a=this.beforeDuplicated(e,t,s,i,o);return o&&(o[t]=s.id),[a,s.id]}tryRemove(e,t,i,o){var n,s,a;const l=null===(n=e.widgets)||void 0===n?void 0:n[t];if(!l)return e;const d=[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small].filter(e=>e!==o).some(e=>{var t,i;return(null===(i=null===(t=l.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0}),u=(null===(a=null===(s=l.parent)||void 0===s?void 0:s[o])||void 0===a?void 0:a.length)>1;if(d||u){let n=this.removeParent(e,t,i,o);return l.layouts&&Object.keys(l.layouts).forEach(e=>{const i=l.layouts[e];if(i[o]){const s=x.getServiceFromSizeModeLayout(n,i);n=s.removeSizeModeLayouts(n,{[o]:i[o]}),n=n.setIn(["widgets",t,"layouts",e],i.without(o))}}),n}return this.remove(e,t)}remove(e,t){var i;if(!(null===(i=e.widgets)||void 0===i?void 0:i[t]))return e;console.debug("remove a widget",t);const o=this.beforeRemoved(e,t);return o.set("widgets",o.widgets.without(t))}toTocNode(e,t,i,o){var n,s,a,l;const{layoutId:d,layoutItemId:u}=i,c={label:"",layoutId:d,layoutItemId:u,type:"widget",id:t},p=null===(n=e.widgets)||void 0===n?void 0:n[t];if(!p)return null==t&&(c.label=r.i18n.getIntl().formatMessage({id:"placeholder"}),c.icon=H(),c.flipIcon=!1,c.isLabelReadOnly=!0),c;if(c.label=p.label,c.icon=p.icon,c.flipIcon=null!==(l=null===(a=null===(s=p.manifest)||void 0===s?void 0:s.properties)||void 0===a?void 0:a.flipIcon)&&void 0!==l&&l,!(null==p?void 0:p.layouts))return c;const g=[],h=1===Object.keys(p.layouts).length;return Object.keys(p.layouts).forEach(t=>{var i,n,s,a;const r=null!==(i=p.layouts[t][o])&&void 0!==i?i:p.layouts[t][e.mainSizeMode],l=x.getService(e,r).getTocStructure(e,r);if(l.length>0){const i=e.layouts[r].type,o=null===(s=null===(n=p.manifest)||void 0===n?void 0:n.layouts)||void 0===s?void 0:s.find(e=>e.name===t);g.push({label:h?"":null!=o?null!==(a=p.manifest.i18nMessages[`_layout_${t}_label`])&&void 0!==a?a:o.label:t,icon:ee(i),type:"layout",id:r,isLabelReadOnly:!0,children:l})}}),1===g.length?c.children=g[0].children:g.length>1&&(c.children=g),c}afterMoved(e,t,i,o){return e.widgets[t]?(console.debug("update widget",t,"ds after moved to a new layout",o),this.dsService.updateAfterChangingLayout(e,t,o)):e}afterAdded(e,t,i,o,n){var s;const a=e.widgets[t];if(!a)return e;console.debug("after added, update widget",t,"added to a new layout",i,"from",o,"to",n);let l=this.dsService.updateAfterChangingLayout(e,t,i);return Object.keys(null!==(s=a.layouts)&&void 0!==s?s:{}).forEach(e=>{const i=a.layouts[e];if(i[o]&&!i[n]){const s=l.layouts[i[o]],a=x.getService(l,i[o]).duplicateLayout(l,s.id,o,n,null);l=a[0];const d=a[1];null!=d&&(l=l.setIn(["layouts",d,"parent"],{type:r.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,n],d))}}),l}beforeRemoved(e,t){var i,o,n,s;const a=e.widgets[t];let l=e;console.debug("clear widget resource before removing",t);k().forEach(e=>{if(e.anyWidgetWillRemove)try{l=e.anyWidgetWillRemove(l,t)}catch(e){console.error("Error when calling anyWidgetWillRemove",e)}});const d=r.utils.isExpressMode(),u=Object.keys(null!==(i=a.parent)&&void 0!==i?i:{}).length;if(d&&u>1){const t=a.parent[e.mainSizeMode][0];if(l.layouts[t.layoutId].type!==r.LayoutType.FlexRowLayout){l=$.addAsSyncablePlaceholder(l,t);const i=$.getPlaceholderInfo(l,t);[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small].filter(t=>t!==e.mainSizeMode).forEach(e=>{var t;if((null===(t=a.parent[e])||void 0===t?void 0:t.length)>0){const t=a.parent[e][0];l=l.setIn(["placeholderInfos",i.id,"syncs",e],t)}})}else{const e=$.getPlaceholderInfo(l,t);e&&l.placeholderInfos[e.id]&&(l=l.set("placeholderInfos",l.placeholderInfos.without(e.id)))}}if(Object.keys(null!==(o=a.parent)&&void 0!==o?o:{}).forEach(e=>{a.parent[e].length>0&&a.parent[e].forEach(t=>{if(l.layouts[t.layoutId]){const i=x.getService(l,t.layoutId);l=i.removeItem(l,t,e,!1)}})}),a.outputDataSources&&a.outputDataSources.forEach(e=>{l=this.dsService.removeDataSource(l,e)}),l=this.messageActionService.removeFromWidget(l,t),l=this.dataActionService.removeFromWidget(l,t),a.layouts&&Object.keys(a.layouts).forEach(e=>{const t=a.layouts[e],i=x.getServiceFromSizeModeLayout(l,t);l=i.removeSizeModeLayouts(l,t)}),null===(s=null===(n=a.manifest)||void 0===n?void 0:n.properties)||void 0===s?void 0:s.canCreateMapView){const e=k();try{e.forEach(e=>{if(!e.mapWidgetWillRemove)return;if(e.widgetId===t)return;const i=l.widgets[e.widgetId];i&&i.useMapWidgetIds&&i.useMapWidgetIds.find(e=>e===t)&&(l=e.mapWidgetWillRemove(l,t))})}catch(e){console.error("Error when calling mapWidgetWillRemove",e)}l=this.useMapService.remove(l,a.id)}const c=E(t);if(c&&c.widgetWillRemove)try{l=c.widgetWillRemove(l)}catch(e){console.error("Error when calling widgetWillRemove",e)}return l}beforeDuplicated(e,t,i,o,n){var s,a;let l=e;if(console.debug("process before duplicate widget",t),X(i.manifest)&&(l=l.setIn(["widgets",i.id],i),Object.keys(null!==(s=i.layouts)&&void 0!==s?s:{}).forEach(t=>{var s;const a=i.layouts[t],d=null!=n?n:{},u=x.getServiceFromSizeModeLayout(l,a).duplicateSizeModeLayouts(l,{[o]:null!==(s=a[o])&&void 0!==s?s:a[e.mainSizeMode]},r.LayoutParentType.Widget,i.id,d);l=u[0],i=i.setIn(["layouts",t],u[1])})),(null===(a=i.outputDataSources)||void 0===a?void 0:a.length)>0){const e=i.outputDataSources.map(e=>{const o=this.dsService.duplicateDataSource(l,t,i.id,e,n);l=o[0];return o[1].id});i=i.set("outputDataSources",e)}return l=l.setIn(["widgets",i.id],i),l}replaceUseDataSource(e,t){const{mainDataSourceId:i,dataSourceId:o}=e;if(t[i]){const n=o.replace(i,t[i]);return e.set("mainDataSourceId",t[i]).set("dataSourceId",n)}return e}afterBatchCopied(e,t,i){let o=e;return t.messageConfigs&&Object.keys(t.messageConfigs).forEach(n=>{var s;const a=t.messageConfigs[n];if(i[a.widgetId]){let n=a.set("id",Se("messageConfig")).set("widgetId",i[a.widgetId]);if((null===(s=a.actions)||void 0===s?void 0:s.length)>0){const s=a.actions.map(o=>{var n;let s=o.set("messageWidgetId",i[o.messageWidgetId]);if(i[o.widgetId]&&(s=s.set("widgetId",i[o.widgetId]).set("actionId",o.actionId.replace(o.widgetId,i[o.widgetId]))),i[o.sectionId]){s=s.set("sectionId",i[o.sectionId]).set("actionId",o.actionId.replace(o.sectionId,i[o.sectionId]));let n=o.config;if(n.sectionId&&n.viewId){const a=t.sections[n.sectionId].views.indexOf(n.viewId),r=e.sections[i[o.sectionId]].views[a];n=n.set("sectionId",i[o.sectionId]).set("viewId",r),s=s.set("config",n)}}if((null===(n=o.useDataSources)||void 0===n?void 0:n.length)>0){const e=o.useDataSources.map(e=>this.replaceUseDataSource(e,i));s=s.set("useDataSources",e)}return s});n=n.set("actions",s),o=o.setIn(["messageConfigs",n.id],n)}}}),Object.keys(null!=i?i:{}).forEach(n=>{var s,a;const r=i[n];if(t.widgets[n]&&o.widgets[r]){const l=o.widgets[r];if((null===(s=l.useMapWidgetIds)||void 0===s?void 0:s.length)>0){const e=l.useMapWidgetIds.map(e=>{var t;return null!==(t=i[e])&&void 0!==t?t:e});o=o.setIn(["widgets",r,"useMapWidgetIds"],e)}if((null===(a=l.useDataSources)||void 0===a?void 0:a.length)>0){const e=l.useDataSources.map(e=>this.replaceUseDataSource(e,i));o=o.setIn(["widgets",r,"useDataSources"],e)}let d;l.dataActions&&Object.keys(l.dataActions).forEach(e=>{const t=l.dataActions[e];if(t.actions){const n={};Object.keys(t.actions).forEach(e=>{const o=t.actions[e];if(i[e]){let t=o;o.widgetId&&i[o.widgetId]&&(t=t.set("widgetId",i[o.widgetId])),n[i[e]]=t}else n[e]=o}),o=o.setIn(["widgets",r,"dataActions",e,"actions"],n)}}),d=e===t?n:r;const u=E(d);if(u&&u.afterWidgetCopied)try{o=u.afterWidgetCopied(n,t,r,o,i)}catch(e){console.error("Error when calling afterWidgetCopied",e)}}}),o}addParent(e,t,i,o){var n;const s=e.widgets[t];if(!s)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to widget",t,"in",o);const a=this.addParentToList(e,null===(n=s.parent)||void 0===n?void 0:n[o],i);return e.setIn(["widgets",t,"parent",o],a)}removeParent(e,t,i,o){const n=e.widgets[t];if(!n||null==n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from widget",t,"in",o),o){const s=n.parent[o],a=this.removeParentFromList(s,i);return 0===a.length?e.setIn(["widgets",t,"parent"],n.parent.without(o)):e.setIn(["widgets",t,"parent",o],a)}let s=e;return Object.keys(n.parent).forEach(e=>{const o=n.parent[e],a=this.removeParentFromList(o,i);s=0===a.length?s.setIn(["widgets",t,"parent"],n.parent.without(e)):s.setIn(["widgets",t,"parent",e],a)}),s}clearParent(e,t){const i=e.widgets[t];return i&&null!=i.parent?e.setIn(["widgets",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.widgets[t];return n&&null!=(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["widgets",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o,n;const s=e.widgets[t];if(!s||!s.parent)return null;const a=null!==(o=s.parent[i])&&void 0!==o?o:s.parent[e.mainSizeMode];if(!a)return null;if(1===a.length)return a[0];const r=a[0].layoutId,l=e.layouts[r];return this.findParent(e,null===(n=l.parent)||void 0===n?void 0:n.id,i)}hasParent(e,t,i){var o,n;const s=e.widgets[t];return!(!s||!s.parent)&&(null===(n=null===(o=s.parent)||void 0===o?void 0:o[i])||void 0===n?void 0:n.length)>0}hasMultipleParents(e,t,i){var o,n;const s=e.widgets[t];return!(!s||!s.parent)&&(null===(n=null===(o=s.parent)||void 0===o?void 0:o[i])||void 0===n?void 0:n.length)>1}};var ie=d(736),oe=d.n(ie),ne=d(606),se=d.n(ne),ae=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const re=new class extends M{constructor(){super(),this.messageActionService=B}createFromTemplate(e,t,i,o,n){return ae(this,void 0,void 0,function*(){if(n[i]){const s=e.sections[n[i]],a=e.views[s.views[0]],l=t.config.sections[i];let d=e;for(let e=0;e<o.length;e++){const i=o[e];if(!a.layout[i])for(let e=0;e<l.views.length;e++){const o=l.views[e],s=t.config.views[o].layout[i],a=x.getService(t.config,s),u=yield a.createLayoutFromTemplate(d,t,s,i,r.LayoutParentType.View,n[o],n);d=u[0];const c=u[1];null!=c&&(d=d.setIn(["views",n[o],"layout",i],c))}}return[d,n[i]]}yield U(t);let s=e;const a=t.config.sections[i],l=Se("section");s=s.setIn(["sections",l],a).setIn(["sections",l,"id"],l).setIn(["sections",l,"label"],be(e,"section",r.i18n.getIntl().formatMessage({id:"section"})));const d=[];for(let e=0;e<a.views.length;e+=1){const i=a.views[e],r=yield this.createViewFromTemplate(s,t,i,o,n);s=r[0],d.push(r[1]),s=s.setIn(["views",r[1],"parent"],l)}return s=s.setIn(["sections",l,"views"],d),n[i]=l,[s,l]})}createViewFromTemplate(e,t,i,o,n){return ae(this,void 0,void 0,function*(){let o=e;yield U(t);const s=t.config,a=s.views[i],l=Se("view");o=o.setIn(["views",l],a).setIn(["views",l,"id"],l).setIn(["views",l,"label"],be(e,"view",r.i18n.getIntl().formatMessage({id:"view"})));const d=[];Object.keys(a.layout||{}).forEach(e=>{d.push({sizeMode:e,layoutId:a.layout[e]})});for(let e=0;e<d.length;e+=1){const{sizeMode:i,layoutId:a}=d[e],u=x.getService(s,a),c=yield u.createLayoutFromTemplate(o,t,a,i,r.LayoutParentType.View,l,n);o=c[0];const p=c[1];o=o.setIn(["views",l,"layout",i],p)}return n&&(n[i]=l),[o,l]})}duplicateEmbedLayout(e,t,i,o,n){var s;const a=null===(s=e.sections)||void 0===s?void 0:s[t];if(!a)return[e,null];let l=e;return console.debug(`duplicate section ${t} from ${i} to ${o}`),a.views.forEach(e=>{const t=l.views[e].layout;if(t[i]&&!t[o]){const s=x.getService(l,t[i]).duplicateLayout(l,t[i],i,o,n,!1);l=s[0];const a=s[1];null!=a&&(n[t[i]]=a,l=l.setIn(["layouts",a,"parent"],{type:r.LayoutParentType.View,id:e}).setIn(["views",e,"layout",o],a))}}),[l,null]}duplicate(e,t,i,o){var n;console.debug("dplicate section",t,"in",i);const s=null===(n=e.sections)||void 0===n?void 0:n[t];if(!s)return[e,null];if(null==o?void 0:o[t]){const n=e.sections[o[t]];if(e.views[n.views[0]].layout[i])return[e,o[t]];const s=e.sections[t];let a=e;return s.views.forEach(e=>{const t=a.views[e].layout[i],n=x.getService(a,t).duplicateLayout(a,t,i,i,o,!0);a=n[0];const s=n[1];null!=s&&(a=a.setIn(["views",o[e],"layout",i],s).setIn(["layouts",s,"parent"],{type:r.LayoutParentType.View,id:o[e]}))}),[a,o[t]]}let a=s.set("id",Se("section")).set("label",O(e,"section",s.label)),l=e.setIn(["sections",a.id],a);const d=s.views.map(e=>{const t=this.duplicateView(l,s.id,e,[i],!1,o);l=t[0];const n=t[1];return l=l.setIn(["views",n,"parent"],a.id),n});return a=a.set("views",d),l=l.setIn(["sections",a.id],a),o&&(o[t]=a.id),[l,a.id]}removeDirectly(e,t){var i;const o=null===(i=e.sections)||void 0===i?void 0:i[t];let n=e;return o.views.forEach(e=>{const t=n.views[e],i=x.getServiceFromSizeModeLayout(n,t.layout);n=i.removeSizeModeLayouts(n,t.layout),n=n.set("views",n.views.without(e))}),n=n.set("sections",n.sections.without(t)),n}tryRemove(e,t,i,o){var n;const s=null===(n=e.sections)||void 0===n?void 0:n[t];if(!s)return e;console.debug(`remove section ${t} from ${i.layoutId} ${i.layoutItemId}`,o);const a=[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small].filter(e=>e!==o).some(e=>{var t,i;return(null===(i=null===(t=s.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0});if(a){let n=this.removeParent(e,t,i,o);return s.views.forEach(e=>{const t=n.views[e];if(t.layout[o]){const i=x.getServiceFromSizeModeLayout(n,t.layout);n=i.removeSizeModeLayouts(n,{[o]:t.layout[o]}),n=n.setIn(["views",e,"layout"],t.layout.without(o))}}),n}return this.remove(e,t)}remove(e,t){var i,o;const n=null===(i=e.sections)||void 0===i?void 0:i[t];if(!n)return e;console.debug("remove section",t);let s=e;return s=this.messageActionService.removeFromSection(s,t),Object.keys(null!==(o=n.parent)&&void 0!==o?o:{}).forEach(e=>{n.parent[e].length>0&&n.parent[e].forEach(t=>{if(s.layouts[t.layoutId]){const i=x.getService(s,t.layoutId);s=i.removeItem(s,t,e,!1)}})}),this.removeDirectly(s,t)}toTocNode(e,t,i,o){var n,s;const{layoutId:a,layoutItemId:r}=i,l={label:"",layoutId:a,layoutItemId:r,type:"section",id:t,children:[]},d=null===(n=e.sections)||void 0===n?void 0:n[t];return d?(l.label=d.label,l.icon=null!==(s=d.icon)&&void 0!==s?s:oe(),l.flipIcon=!0,d.views.forEach(t=>{var i,n;const s=e.views[t],a=null!==(i=s.layout[o])&&void 0!==i?i:s.layout[e.mainSizeMode],r=x.getService(e,a).getTocStructure(e,a);l.children.push({label:s.label,icon:null!==(n=s.icon)&&void 0!==n?n:se(),flipIcon:!1,type:"view",id:t,children:r})}),l):l}afterMoved(e,t,i,o){return e}afterAdded(e,t,i,o,n){var s;const a=null===(s=e.sections)||void 0===s?void 0:s[t];if(!a)return e;let l=e;return a.views.forEach(e=>{const t=l.views[e];if(t.layout[o]&&!t.layout[n]){const i=l.layouts[t.layout[o]],s=x.getService(l,t.layout[o]).duplicateLayout(l,i.id,o,n,null);l=s[0];const a=s[1];null!=a&&(l=l.setIn(["layouts",a,"parent"],{type:r.LayoutParentType.View,id:e}).setIn(["views",e,"layout",n],a))}}),l}addParent(e,t,i,o){var n;const s=e.sections[t];if(!s)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to section",t,"in",o);const a=this.addParentToList(e,null===(n=s.parent)||void 0===n?void 0:n[o],i);return e.setIn(["sections",t,"parent",o],a)}removeParent(e,t,i,o){const n=e.sections[t];if(!n||null==n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from section",t,"in",o),o){const s=n.parent[o],a=this.removeParentFromList(s,i);return 0===a.length?e.setIn(["sections",t,"parent"],n.parent.without(o)):e.setIn(["sections",t,"parent",o],a)}let s=e;return Object.keys(n.parent).forEach(e=>{const o=n.parent[e],a=this.removeParentFromList(o,i);s=0===a.length?s.setIn(["sections",t,"parent"],n.parent.without(e)):s.setIn(["sections",t,"parent",e],a)}),s}clearParent(e,t){const i=e.sections[t];return i&&null!=i.parent?e.setIn(["sections",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.sections[t];return n&&null!=(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["sections",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o,n;const s=e.sections[t];if(!s.parent)return null;const a=null!==(o=s.parent[i])&&void 0!==o?o:s.parent[e.mainSizeMode];if(!a)return null;if(1===a.length)return a[0];const r=a[0].layoutId,l=e.layouts[r];return te.findParent(e,null===(n=l.parent)||void 0===n?void 0:n.id,i)}hasParent(e,t,i){var o;const n=e.sections[t];return!!n.parent&&(null===(o=n.parent[i])||void 0===o?void 0:o.length)>0}hasMultipleParents(e,t,i){var o;const n=e.sections[t];return!!n.parent&&(null===(o=n.parent[i])||void 0===o?void 0:o.length)>0}createSection(e,t){console.debug("create a blank section",t);const i=Se("section"),o={id:i,label:be(e,"section",r.i18n.getIntl().formatMessage({id:"section"})),views:[]};let n=e.setIn(["sections",o.id],o);return n=this.addView(n,i,t)[0],[n,i]}createBlankView(e,t){return{id:Se("view"),parent:t,label:be(e,"view",r.i18n.getIntl().formatMessage({id:"view"}))}}addView(e,t,i){var o;const n=null===(o=e.sections)||void 0===o?void 0:o[t];if(!n)return[e,null];let s;const a=this.createBlankView(e,t);n.views?(s=n.views.asMutable(),s.push(a.id)):s=[a.id];let l=e.setIn(["views",a.id],a).setIn(["sections",t,"views"],s);return i.forEach(e=>{const t={id:Se("layout"),type:r.LayoutType.FixedLayout,content:{},parent:{id:a.id,type:r.LayoutParentType.View}};l=l.setIn(["layouts",t.id],t).setIn(["views",a.id,"layout",e],t.id)}),[l,a.id]}duplicateView(e,t,i,o,n,s){if(!e.views||!e.views[i])return[e,null];console.debug("duplicate a view",i,"in",o);let a=e.views[i].set("id",Se("view"));a=a.set("label",O(e,"view",a.label)),n||(a=a.without("parent"));let l=e.setIn(["views",a.id],a);const d={};o.forEach(e=>{d[e]=a.layout[e]});const u=null!=s?s:{},c=x.getServiceFromSizeModeLayout(l,d).duplicateSizeModeLayouts(l,d,r.LayoutParentType.View,a.id,u);if(l=c[0],a=a.set("layout",c[1]),l=l.setIn(["views",a.id],a),n){const e=l.sections[t].views.asMutable(),o=e.indexOf(i);e.splice(o,1,i,a.id),l=l.setIn(["sections",t,"views"],e)}return s&&(s[i]=a.id),[l,a.id]}removeView(e,t,i){var o,n;const s=null===(o=e.sections)||void 0===o?void 0:o[t],a=null===(n=e.views)||void 0===n?void 0:n[i];if(!a||!s||1===s.views.length||!s.views.includes(i))return e;console.debug("remove a view",i,"from",t);const r=s.views.filter(e=>e!==i);let l=e.setIn(["sections",t,"views"],r);return l=x.getServiceFromSizeModeLayout(l,a.layout).removeSizeModeLayouts(l,a.layout),l=l.set("views",l.views.without(i)),l}};var le=d(218),de=d.n(le),ue=d(528),ce=d.n(ue),pe=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const ge=new class extends M{createFromTemplate(e,t,i,o,n){return pe(this,void 0,void 0,function*(){if(n[i])return[e,n[i]];let s=e;console.debug("create screen group",i,"from template in",o),yield U(t);const a=t.config;i=null!=i?i:Object.keys(a.screenGroups)[0];const l=a.screenGroups[i],d=Se("screenGroup");n[i]=d,s=s.setIn(["screenGroups",d],l).setIn(["screenGroups",d,"id"],d).setIn(["screenGroups",d,"label"],be(e,"screenGroup",r.i18n.getIntl().formatMessage({id:"screenGroup"})));const u=[];for(let e=0;e<l.screens.length;e+=1){const i=l.screens[e],a=yield this.createScreenFromTemplate(s,t,i,o,n);s=a[0],u.push(a[1]),s=s.setIn(["screens",a[1],"parent"],d)}return s=s.setIn(["screenGroups",d,"screens"],u),n[i]=d,[s,d]})}createScreenFromTemplate(e,t,i,o,n){return pe(this,void 0,void 0,function*(){var s,a,l;let d=e;console.debug("create screen",i,"from template in",o),yield U(t);const u=t.config;i=null!=i?i:Object.keys(u.screens)[0];const c=u.screens[i],p=Se("screen");n[i]=p,d=d.setIn(["screens",p],c).setIn(["screens",p,"id"],p).setIn(["screens",p,"label"],be(e,"screen",r.i18n.getIntl().formatMessage({id:"screen"})));const g=[];Object.keys(null!==(a=null===(s=c.panel)||void 0===s?void 0:s.layout)&&void 0!==a?a:{}).forEach(e=>{g.push({sizeMode:e,isSide:!0,layoutId:c.panel.layout[e]})}),Object.keys(null!==(l=c.main.layout)&&void 0!==l?l:{}).forEach(e=>{g.push({sizeMode:e,isSide:!1,layoutId:c.main.layout[e]})});for(let e=0;e<g.length;e+=1){const{sizeMode:i,layoutId:o,isSide:s}=g[e],a=x.getService(u,o),l=yield a.createLayoutFromTemplate(d,t,o,i,r.LayoutParentType.Screen,p,n);d=l[0];const c=l[1];d=d.setIn(["layouts",c,"parent"],{type:r.LayoutParentType.Screen,id:p}),d=s?d.setIn(["screens",p,"panel","layout",i],c):d.setIn(["screens",p,"main","layout",i],c)}return[d,p]})}duplicateEmbedLayout(e,t,i,o,n){var s;const a=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!a)return[e,null];let l=e;return a.screens.forEach(e=>{var t;const s=l.screens[e],a=s.main.layout;if(a[i]&&!a[o]){const t=x.getService(l,a[i]).duplicateLayout(l,a[i],i,o,n,!1);l=t[0];const s=t[1];null!=t[1]&&(n[a[i]]=s,l=l.setIn(["layouts",s,"parent"],{type:r.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",o],s))}const d=null===(t=s.panel)||void 0===t?void 0:t.layout;if(d&&d[i]&&!d[o]){const t=x.getService(l,d[i]).duplicateLayout(l,d[i],i,o,n,!1);l=t[0];const s=t[1];null!=t[1]&&(n[d[i]]=s,l=l.setIn(["layouts",s,"parent"],{type:r.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",o],s))}}),[l,null]}duplicate(e,t,i,o){var n;const s=null===(n=e.screenGroups)||void 0===n?void 0:n[t];if(!s)return[e,null];if(null==o?void 0:o[t]){const n=e.screenGroups[o[t]];if(e.screens[n.screens[0]].main.layout[i])return[e,o[t]];{const n=e.screenGroups[t];let s=e;return n.screens.forEach(e=>{var t;const n=s.screens[e],a=n.main.layout[i],l=x.getService(s,a).duplicateLayout(s,a,i,i,o,!0);s=l[0];const d=l[1];if(null!=d&&(s=s.setIn(["screens",o[e],"main","layout",i],d).setIn(["layouts",d,"parent"],{type:r.LayoutParentType.Screen,id:o[e]})),null===(t=n.panel)||void 0===t?void 0:t.layout){const t=n.panel.layout[i],a=x.getService(s,t).duplicateLayout(s,t,i,i,o,!0);s=a[0];const l=a[1];null!=l&&(s=s.setIn(["screens",o[e],"panel","layout",i],l).setIn(["layouts",l,"parent"],{type:r.LayoutParentType.Screen,id:o[e]}))}}),[s,o[t]]}}console.debug("duplicate screen group",t,"to",i);let a=s.set("id",Se("screenGroup")).set("label",O(e,"screenGroup",s.label)),l=e.setIn(["screenGroups",a.id],a);const d=s.screens.map(e=>{const t=this.duplicateScreen(l,s.id,e,[i],!1,o);l=t[0];const n=t[1];return l=l.setIn(["screens",n,"parent"],a.id),n});return a=a.set("screens",d),l=l.setIn(["screenGroups",a.id],a),o&&(o[t]=a.id),[l,a.id]}tryRemove(e,t,i,o){var n;const s=null===(n=e.screenGroups)||void 0===n?void 0:n[t];if(!s)return e;console.debug(`try remove screenGroup ${t} from ${i.layoutId} ${i.layoutItemId}`,o);const a=[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small].filter(e=>e!==o).some(e=>{var t;return null!=(null===(t=s.parent)||void 0===t?void 0:t[e])});if(a){let n=this.removeParent(e,t,i,o);return s.screens.forEach(e=>{var t;const i=n.screens[e];if(i.main.layout[o]){const t=x.getServiceFromSizeModeLayout(n,i.main.layout);n=t.removeSizeModeLayouts(n,{[o]:i.main.layout[o]}),n=n.setIn(["screens",e,"main","layout"],i.main.layout.without(o))}if(null===(t=i.panel)||void 0===t?void 0:t.layout[o]){const t=x.getServiceFromSizeModeLayout(n,i.panel.layout);n=t.removeSizeModeLayouts(n,{[o]:i.panel.layout[o]}),n=n.setIn(["screens",e,"panel","layout"],i.panel.layout.without(o))}}),n}return this.remove(e,t)}remove(e,t){var i,o;const n=null===(i=e.screenGroups)||void 0===i?void 0:i[t];if(!n)return e;let s=e;return console.debug("remove screen group",t),Object.keys(null!==(o=n.parent)&&void 0!==o?o:{}).forEach(e=>{const{layoutId:t}=n.parent[e];if(s.layouts[t]){const i=x.getService(s,t);s=i.removeItem(s,n.parent[e],e,!1)}}),n.screens.forEach(e=>{var t;const i=s.screens[e],o=x.getServiceFromSizeModeLayout(s,i.main.layout);if(s=o.removeSizeModeLayouts(s,i.main.layout),null===(t=i.panel)||void 0===t?void 0:t.layout){const e=x.getServiceFromSizeModeLayout(s,i.panel.layout);s=e.removeSizeModeLayouts(s,i.panel.layout)}s=s.set("screens",s.screens.without(e))}),s=s.set("screenGroups",s.screenGroups.without(t)),s}toTocNode(e,t,i,o){var n,s;const{layoutId:a,layoutItemId:l}=i,d={label:"",layoutId:a,layoutItemId:l,type:"screenGroup",id:t,children:[]},u=null===(n=e.screenGroups)||void 0===n?void 0:n[t];return u?(d.label=u.label,d.icon=null!==(s=u.icon)&&void 0!==s?s:ce(),d.flipIcon=!1,u.screens.forEach(t=>{var i,n,s;const a=e.screens[t],l={label:a.label,icon:de(),flipIcon:!1,type:"screen",id:t,children:[]},u=null!==(i=a.main.layout[o])&&void 0!==i?i:a.main.layout[e.mainSizeMode],c=x.getService(e,u).getTocStructure(e,u);if(l.children.push({label:r.i18n.getIntl().formatMessage({id:"mainStage"}),isLabelReadOnly:!0,type:"layout",id:u,children:c}),null===(n=a.panel)||void 0===n?void 0:n.layout){const t=null!==(s=a.panel.layout[o])&&void 0!==s?s:a.panel.layout[e.mainSizeMode],i=x.getService(e,t).getTocStructure(e,t);l.children.push({label:r.i18n.getIntl().formatMessage({id:"scrollingPanel"}),isLabelReadOnly:!0,type:"layout",id:t,children:i})}d.children.push(l)}),d):d}afterMoved(e,t,i,o){return e}afterAdded(e,t,i,o,n){var s;const a=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!a)return e;let l=e;return a.screens.forEach(e=>{var t,i;const s=l.screens[e];if(s.main.layout[o]&&!s.main.layout[n]){const t=l.layouts[s.main.layout[o]],i=x.getService(l,s.main.layout[o]).duplicateLayout(l,t.id,o,n,null);l=i[0];const a=i[1];null!=a&&(l=l.setIn(["layouts",a,"parent"],{type:r.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",n],a))}if((null===(i=null===(t=s.panel)||void 0===t?void 0:t.layout)||void 0===i?void 0:i[o])&&!s.panel.layout[n]){const t=l.layouts[s.panel.layout[o]],i=x.getService(l,s.panel.layout[o]).duplicateLayout(l,t.id,o,n,null);l=i[0];const a=i[1];null!=a&&(l=l.setIn(["layouts",a,"parent"],{type:r.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",n],a))}}),l}addParent(e,t,i,o){return e.screenGroups[t]?(console.debug("add parent",i.layoutId,i.layoutItemId,"to",t,"in",o),e.setIn(["screenGroups",t,"parent",o],i)):e}removeParent(e,t,i,o){const n=e.screenGroups[t];if(!n||!n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from",t),o){const s=n.parent[o];return(null==s?void 0:s.layoutId)===i.layoutId&&(null==s?void 0:s.layoutItemId)===i.layoutItemId?e.setIn(["screenGroups",t,"parent"],n.parent.without(o)):e}let s=e;return Object.keys(n.parent).forEach(o=>{const a=n.parent[o];a.layoutId===i.layoutId&&a.layoutItemId===i.layoutItemId&&(s=e.setIn(["screenGroups",t,"parent"],n.parent.without(o)))}),s}clearParent(e,t){const i=e.screenGroups[t];return i?e.setIn(["screenGroups",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.screenGroups[t];return n&&(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["screenGroups",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o;const n=e.screenGroups[t];if(!n||!n.parent)return null;return null!==(o=n.parent[i])&&void 0!==o?o:n.parent[e.mainSizeMode]}hasParent(e,t,i){const o=e.screenGroups[t];return!(!o||!o.parent)&&null!=o.parent[i]}hasMultipleParents(){return!1}duplicateScreen(e,t,i,o,n,s){var a,l,d;const u=null===(a=e.screenGroups)||void 0===a?void 0:a[t],c=null===(l=e.screens)||void 0===l?void 0:l[i];if(!c||!u||!u.screens.includes(i))return[e,null];console.debug("duplicate screen",i,"in",o,"to",t);let p=c.set("id",Se("screen")).set("label",O(e,"screen",c.label));n||(p=p.without("parent"));let g=e.setIn(["screens",p.id],p);const h={};o.forEach(e=>{h[e]=p.main.layout[e]});const f=null!=s?s:{},y=x.getServiceFromSizeModeLayout(g,h).duplicateSizeModeLayouts(g,h,r.LayoutParentType.Screen,p.id,f);if(g=y[0],p=p.setIn(["main","layout"],y[1]),null===(d=p.panel)||void 0===d?void 0:d.layout){const e={};o.forEach(t=>{e[t]=p.panel.layout[t]});const t=x.getServiceFromSizeModeLayout(g,e).duplicateSizeModeLayouts(g,e,r.LayoutParentType.Screen,p.id,f);g=t[0],p=p.setIn(["panel","layout"],t[1])}if(g=g.setIn(["screens",p.id],p),n){const e=u.screens.asMutable(),o=e.indexOf(i);e.splice(o,1,i,p.id),g=g.setIn(["screenGroups",t,"screens"],e)}return s&&(s[i]=p.id),[g,p.id]}removeScreen(e,t,i){var o,n;const s=null===(o=e.screenGroups)||void 0===o?void 0:o[t],a=null===(n=e.screens)||void 0===n?void 0:n[i];if(!a||!s||1===s.screens.length||!s.screens.includes(i))return e;console.debug("remove screen",i,"in",t);const r=s.screens.filter(e=>e!==i);let l=e.setIn(["screenGroups",t,"screens"],r);if(l=x.getServiceFromSizeModeLayout(l,a.main.layout).removeSizeModeLayouts(l,a.main.layout),a.panel){l=x.getServiceFromSizeModeLayout(l,a.panel.layout).removeSizeModeLayouts(l,a.panel.layout)}return l=l.set("screens",l.screens.without(i)),l}};const he=new class{setContentId(e,t,i,o){if(!i)return e;const{layoutId:n,layoutItemId:s}=t,a=A.searchUtils.findLayoutItem(e,t);if(a){let l=e;switch(a.type){case r.LayoutItemType.Widget:l=l.setIn(["layouts",n,"content",s,"widgetId"],i),l=te.addParent(l,i,t,o);break;case r.LayoutItemType.Section:l=l.setIn(["layouts",n,"content",s,"sectionId"],i),l=re.addParent(l,i,t,o);break;case r.LayoutItemType.ScreenGroup:l=l.setIn(["layouts",n,"content",s,"screenGroupId"],i),l=ge.addParent(l,i,t,o);break;default:return l}return l}return e}};var fe=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const ye=new class{syncPlaceholderInfo(e,t,i,o){let n=i;return e.placeholderInfos&&Object.keys(e.placeholderInfos).forEach(i=>{var s;let a=(0,r.Immutable)(e.placeholderInfos[i]);const l=$.getNextPlaceholderId(n);a=a.set("id",l).setIn(["rootContainer","id"],o[t]).setIn(["layoutInfo","layoutId"],o[a.layoutInfo.layoutId]);Object.keys(null!==(s=a.syncs)&&void 0!==s?s:{}).forEach(e=>{a=a.setIn(["syncs",e,"layoutId"],o[a.syncs[e].layoutId])}),n=n.setIn(["placeholderInfos",l],a)}),n}createPageFromTemplate(e,t,i){return fe(this,void 0,void 0,function*(){var o;let n=e;yield U(t);const s=t.config,a=Object.keys(s.pages)[0],l=s.pages[a],d=r.appConfigUtils.getUniqueId("page"),u=r.appConfigUtils.getUniqueLabel(e,"page",r.i18n.getIntl().formatMessage({id:"page"})),c=Object.keys(null!==(o=l.layout)&&void 0!==o?o:{});i[a]=d,n=n.setIn(["pages",d],l).setIn(["pages",d,"id"],d).setIn(["pages",d,"isVisible"],!0).setIn(["pages",d,"isDefault"],!1).setIn(["pages",d,"label"],u).setIn(["pages",d,"header"],!1).setIn(["pages",d,"footer"],!1);for(let e=0;e<c.length;e+=1){const o=c[e],a=l.layout[o],u=x.getService(s,a),p=yield u.createLayoutFromTemplate(n,t,a,o,r.LayoutParentType.Page,d,i);n=p[0];const g=p[1];n=n.setIn(["pages",d,"layout",o],g).setIn(["layouts",g,"parent"],{id:d,type:r.LayoutParentType.Page})}return n=this.syncPlaceholderInfo(s,a,n,i),[n,d]})}createDialogFromTemplate(e,t,i){return fe(this,void 0,void 0,function*(){var o;let n=e;yield U(t);const s=t.config,a=Object.keys(s.dialogs)[0],l=s.dialogs[a],d=r.appConfigUtils.getUniqueId("dialog"),u=r.appConfigUtils.getUniqueLabel(e,"dialog",r.i18n.getIntl().formatMessage({id:"dialog"})),c=Object.keys(null!==(o=l.layout)&&void 0!==o?o:{});i[a]=d;const p=Object.keys(Object.keys(n.dialogs).filter(e=>n.dialogs[e].mode===l.mode)).length;n=n.setIn(["dialogs",d],l).setIn(["dialogs",d,"id"],d).setIn(["dialogs",d,"label"],u).setIn(["dialogs",d,"index"],p).setIn(["dialogs",d,"isSplash"],!1).setIn(["dialogs",d,"closeWhenClickOverlay"],l.closeWhenClickOverlay).setIn(["dialogs",d,"sizeMode"],l.sizeMode);for(let e=0;e<c.length;e+=1){const o=c[e],a=l.layout[o],u=x.getService(s,a),p=yield u.createLayoutFromTemplate(n,t,a,o,r.LayoutParentType.Dialog,d,i);n=p[0];const g=p[1];n=n.setIn(["dialogs",d,"layout",o],g).setIn(["layouts",g,"parent"],{id:d,type:r.LayoutParentType.Dialog})}return n=this.syncPlaceholderInfo(s,a,n,i),[n,d]})}applyTemplateToHeader(e,t,i,o){return fe(this,void 0,void 0,function*(){var n,s,a,l;if(yield U(t),!(null===(n=null==t?void 0:t.config)||void 0===n?void 0:n.header))return e;const d=t.config.header.layout,u=Object.values(d)[0],c=null===(s=null==e?void 0:e.header)||void 0===s?void 0:s.layout;if(c){const n=x.getService(t.config,u),s=yield n.replaceSizeModeLayout(e,c,t,(0,r.Immutable)(null===(l=null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.header)||void 0===l?void 0:l.layout),i,r.LayoutParentType.Header,"header",o);let d=s[0];return Object.keys(s[1]).forEach(e=>{const t=s[1][e];d=d.setIn(["header","layout",e],t).setIn(["layouts",t,"parent"],{id:"header",type:r.LayoutParentType.Header})}),Object.keys(t.config.header).forEach(e=>{"layout"!==e&&null!=t.config.header[e]&&(d=d.setIn(["header",e],t.config.header[e]))}),d}return e})}applyTemplateToFooter(e,t,i,o){return fe(this,void 0,void 0,function*(){var n,s,a,l;if(yield U(t),!(null===(n=null==t?void 0:t.config)||void 0===n?void 0:n.footer))return e;const d=t.config.footer.layout,u=Object.values(d)[0],c=null===(s=null==e?void 0:e.footer)||void 0===s?void 0:s.layout;if(c){const n=x.getService(t.config,u),s=yield n.replaceSizeModeLayout(e,c,t,(0,r.Immutable)(null===(l=null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.footer)||void 0===l?void 0:l.layout),i,r.LayoutParentType.Footer,"footer",o);let d=s[0];return Object.keys(s[1]).forEach(e=>{const t=s[1][e];d=d.setIn(["footer","layout",e],t).setIn(["layouts",t,"parent"],{id:"footer",type:r.LayoutParentType.Footer})}),Object.keys(t.config.footer).forEach(e=>{"layout"!==e&&null!=t.config.footer[e]&&(d=d.setIn(["footer",e],t.config.footer[e]))}),d}return e})}applyTemplateToBody(e,t,i,o,n){return fe(this,void 0,void 0,function*(){var s,a;if(yield U(i),!i.config){const t=yield(0,_.getTemplateConfig)(i.type,i.name);if(i.config=t,!i.config)return e;r.appConfigUtils.fixLayoutIds(i.config),r.utils.replaceI18nPlaceholdersInObject(i.config,r.i18n.getIntl(),R)}const l=Object.keys(i.config.pages)[0],d=i.config.pages[l].layout,u=Object.values(d)[0],c=null===(a=null===(s=null==e?void 0:e.pages)||void 0===s?void 0:s[t])||void 0===a?void 0:a.layout;if(c){const s=x.getService(i.config,u),a=yield s.replaceSizeModeLayout(e,c,i,(0,r.Immutable)(d),o,r.LayoutParentType.Page,t,n);let p=a[0];Object.keys(a[1]).forEach(e=>{const i=a[1][e];p=p.setIn(["pages",t,"layout",e],i).setIn(["layouts",i,"parent"],{id:t,type:r.LayoutParentType.Page})});return["mode","maxWidth","bodyBackgroundColor","bodyBackgroundIMage","bodyBackgroundPosition"].forEach(e=>{const o=i.config.pages[l][e];"layout"!==e&&null!=o&&(p=p.setIn(["pages",t,e],o))}),p=this.syncPlaceholderInfo(i.config,l,p,n),p}return e})}applyTemplateToDialog(e,t,i,o,n){return fe(this,void 0,void 0,function*(){var s,a,l,d;yield U(i);const u=Object.keys(i.config.dialogs)[0],c=null===(s=null==e?void 0:e.dialogs)||void 0===s?void 0:s[t],p=null==c?void 0:c.layout,g=null===(l=null===(a=null==i?void 0:i.config)||void 0===a?void 0:a.dialogs)||void 0===l?void 0:l[u];if(p&&(null==g?void 0:g.layout)){const s=g.layout,a=Object.values(s)[0],l=x.getService(i.config,a),u=yield l.replaceSizeModeLayout(e,p,i,(0,r.Immutable)(s),o,r.LayoutParentType.Dialog,t,n);let h=u[0];const f=c.mode===g.mode,y=f?c.index:Object.keys(Object.keys(h.dialogs).filter(e=>h.dialogs[e].mode===g.mode)).length;let v;h=h.setIn(["dialogs",t,"index"],y),window.jimuConfig.isInBuilder?v=(0,r.getAppStore)().getState():window.jimuConfig.isBuilder&&(v=(0,r.getAppStore)().getState().appStateInBuilder);const m=(null===(d=null==v?void 0:v.appRuntimeInfo)||void 0===d?void 0:d.appMode)===r.AppMode.Express;Object.keys(u[1]).forEach(e=>{const i=u[1][e];h=h.setIn(["dialogs",t,"layout",e],i).setIn(["layouts",i,"parent"],{id:t,type:r.LayoutParentType.Dialog}),h=m?h.setIn(["dialogs",t,"sizeMode",e],g.sizeMode[e]):h.setIn(["dialogs",t,"sizeMode",o],g.sizeMode[o]||g.sizeMode[r.BrowserSizeMode.Large])});return["mode","overlayColor","dialogBackground","border","blockPage","interactionType","interactionStyles","confirmBeforeClose","alwaysShowConfirmation","closeWhenClickOverlay"].forEach(e=>{h=h.setIn(["dialogs",t,e],g[e])}),f||Object.keys(h.dialogs).forEach(e=>{const t=h.dialogs[e];t.mode===c.mode&&t.index>c.index&&(h=h.setIn(["dialogs",t.id,"index"],t.index-1))}),h}return e})}applyGridTemplate(e,t,i,o,n){return fe(this,void 0,void 0,function*(){var s,a;yield U(i);const l=null===(a=null===(s=null==e?void 0:e.widgets)||void 0===s?void 0:s[t])||void 0===a?void 0:a.layouts,d=Object.values(i.config.widgets).find(e=>"widgets/layout/grid/"===e.uri),u="DEFAULT",c=l[u],p=x.getInstance().getServiceByType(r.LayoutType.GridLayout),g=yield p.replaceSizeModeLayout(e,c,i,(0,r.Immutable)(d.layouts[u]),o,r.LayoutParentType.Widget,t,n);let h=g[0];return Object.keys(g[1]).forEach(e=>{const i=g[1][e];h=h.setIn(["widgets",t,"layouts",u,e],i).setIn(["layouts",i,"parent"],{id:t,type:r.LayoutParentType.Widget})}),h})}};var ve=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};class me{constructor(e,t){switch(this.appConfig=e,this.layoutItem=t,t.type){case r.LayoutItemType.Widget:this.service=te,this.contentId=t.widgetId;break;case r.LayoutItemType.Section:this.service=re,this.contentId=t.sectionId;break;case r.LayoutItemType.ScreenGroup:this.service=ge,this.contentId=t.screenGroupId}}getConfig(){return this.appConfig}getContentId(){return this.contentId}createFromTemplate(e,t,i,o){return ve(this,void 0,void 0,function*(){if(this.contentId&&this.service){const n=yield this.service.createFromTemplate(this.appConfig,e,this.contentId,t,i,o);return this.appConfig=n[0],n}return[this.appConfig,null]})}duplicateEmbedLayout(e,t,i){if(this.service){const o=this.service.duplicateEmbedLayout(this.appConfig,this.contentId,e,t,i);return this.appConfig=o[0],o}return[this.appConfig,null]}duplicate(e,t){if(this.service){const i=this.service.duplicate(this.appConfig,this.contentId,e,t);return this.appConfig=i[0],i}return[this.appConfig,null]}tryRemove(e,t){return this.service&&(this.appConfig=this.service.tryRemove(this.appConfig,this.contentId,e,t)),this.appConfig}remove(){return this.service&&(this.appConfig=this.service.remove(this.appConfig,this.contentId)),this.appConfig}toTocNode(e,t){return this.service?this.service.toTocNode(this.appConfig,this.contentId,e,t):null}afterMoved(e,t){return this.service&&(this.appConfig=this.service.afterMoved(this.appConfig,this.contentId,e,t)),this.appConfig}afterAdded(e,t,i){return this.service&&(this.appConfig=this.service.afterAdded(this.appConfig,this.contentId,e,t,i)),this.appConfig}addParent(e,t){return this.service&&(this.appConfig=this.service.addParent(this.appConfig,this.contentId,e,t)),this.appConfig}removeParent(e,t){return this.service&&(this.appConfig=this.service.removeParent(this.appConfig,this.contentId,e,t)),this.appConfig}clearParent(){return this.service&&(this.appConfig=this.service.clearParent(this.appConfig,this.contentId)),this.appConfig}removeSizeModeParent(e){return this.service&&(this.appConfig=this.service.removeSizeModeParent(this.appConfig,this.contentId,e)),this.appConfig}findParent(e){var t;return null===(t=this.service)||void 0===t?void 0:t.findParent(this.appConfig,this.contentId,e)}hasParent(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasParent(this.appConfig,this.contentId,e))&&void 0!==i&&i}hasMultipleParents(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasMultipleParents(this.appConfig,this.contentId,e))&&void 0!==i&&i}}var Ie=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};class we{createBlankLayout(e,t){const i=Se("layout"),o={id:i,content:{},type:t};console.debug("create a blank layout with type",t);return[e.setIn(["layouts",i],o),i]}duplicateLayout(e,t,i,o,n,s){var a,l,d;const u=e.layouts[t];if(!u)return[e,null];const c=u.set("id",Se("layout"));let p=e.setIn(["layouts",c.id],c);if(console.debug("duplicate layout",t,", from size mode",i,", to size mode",o),Object.keys(null!==(a=c.content)&&void 0!==a?a:{}).forEach(e=>{var a;const l=c.content[e];if(l.isPending){const t=p.layouts[c.id];if(p=p.setIn(["layouts",t.id,"content"],t.content.without(e)),null===(a=t.order)||void 0===a?void 0:a.includes(e)){const i=t.order.filter(t=>t!==e);p=p.setIn(["layouts",t.id,"order"],i)}}else if(s)p=this.duplicateAndReplaceContent(p,{layoutId:t,layoutItemId:e},{layoutId:c.id,layoutItemId:e},i,o,n);else{const t=new me(p,l);if(i!==o&&!t.hasMultipleParents(i)&&t.hasParent(o)){const t=l.set("type",r.LayoutItemType.Widget).without("widgetId");p=p.setIn(["layouts",c.id,"content",e],t)}else{const s=t.duplicateEmbedLayout(i,o,n);if(p=s[0],s[1]){const t=l.set("widgetId",s[1]);p=p.setIn(["layouts",c.id,"content",e],t);const i=new me(p,t);p=i.addParent({layoutId:c.id,layoutItemId:e},o)}else p=t.addParent({layoutId:c.id,layoutItemId:e},o)}}}),o===r.BrowserSizeMode.Large&&c.type===r.LayoutType.GridLayout&&(null===(l=c.setting)||void 0===l?void 0:l.mainItemId)){const e=null!==(d=null==n?void 0:n[u.setting.mainItemId])&&void 0!==d?d:u.setting.mainItemId;p=p.setIn(["layouts",c.id,"setting","mainItemId"],e)}if(i!==o){const e=this.transformLayout(p,p.layouts[c.id],i,o);p=p.setIn(["layouts",c.id],e)}return n&&(n[t]=c.id),[p,c.id]}duplicateSizeModeLayouts(e,t,i,o,n){let s=e;const a={};return Object.keys(null!=t?t:{}).forEach(e=>{const r=t[e],l=this.duplicateLayout(s,r,e,e,n,!0);s=l[0],a[e]=l[1],null!=l[1]&&(s=s.setIn(["layouts",l[1],"parent"],{type:i,id:o}))}),[s,a]}duplicateAndReplaceContent(e,t,i,o,n,s){const{layoutId:a,layoutItemId:r}=t,{layoutId:l,layoutItemId:d}=i;if(!e.layouts||!e.layouts[a]||!e.layouts[l])return e;const u=A.searchUtils.findLayoutItem(e,{layoutId:a,layoutItemId:r}),c=new me(e,u).duplicate(n,s);let p=c[0];const g=c[1];p=p.setIn(["layouts",l,"content",d,"type"],u.type),p=he.setContentId(p,{layoutId:l,layoutItemId:d},g,n);const h=A.searchUtils.findLayoutItem(p,i),f=new me(p,h);return f.removeParent({layoutId:a,layoutItemId:r},o),p=f.getConfig(),o===n&&n===e.mainSizeMode&&(p=$.afterLayoutItemCopied(p,t,i)),p}addContent(e,t,i,o,n){const s=this.createBlankItem(e,t);let a=s[0];const r=s[1];console.debug(`add ${i} to ${t}`),a=a.setIn(["layouts",t,"content",r,"type"],o);const l={layoutId:t,layoutItemId:r};return a=he.setContentId(a,l,i,n),a=this.afterItemAdded(a,l,n,n),[a,r]}removeLayout(e,t,i){var o;const n=e.layouts[t];if(!n)return e;let s=e;return console.debug("remove layout",t,"in size mode",i),Object.keys(null!==(o=n.content)&&void 0!==o?o:{}).forEach(e=>{s=this.removeItem(s,{layoutId:t,layoutItemId:e},i,!0,!1)}),s=this.removeLayoutIdFromParent(s,t,i),s=s.setIn(["layouts"],s.layouts.without(t)),s}removeSizeModeLayouts(e,t){let i=e;return Object.keys(t).forEach(e=>{const o=t[e];i=this.removeLayout(i,o,e)}),i}removeLayoutIdFromParent(e,t,i){var o,n,s,a;const l=e.layouts[t];if(!l)return e;let d=e;const u=null===(o=l.parent)||void 0===o?void 0:o.id;switch(null===(n=l.parent)||void 0===n?void 0:n.type){case r.LayoutParentType.Header:d.header.layout[i]===t&&(console.debug("remove layout",t,"from header, in size mode",i),d=d.setIn(["header","layout"],d.header.layout.without(i)));break;case r.LayoutParentType.Footer:d.footer.layout[i]===t&&(console.debug("remove layout",t,"from footer, in size mode",i),d=d.setIn(["footer","layout"],d.footer.layout.without(i)));break;case r.LayoutParentType.Dialog:d.dialogs[u].layout[i]===t&&(console.debug("remove layout",t,"from dialog",u,", in size mode",i),d=d.setIn(["dialogs",u,"layout"],d.dialogs[u].layout.without(i)));break;case r.LayoutParentType.Page:d.pages[u].layout[i]===t&&(console.debug("remove layout",t,"from page",u,", in size mode",i),d=d.setIn(["pages",u,"layout"],d.pages[u].layout.without(i)));break;case r.LayoutParentType.View:d.views[u].layout[i]===t&&(console.debug("remove layout",t,"from view",u,", in size mode",i),d=d.setIn(["views",u,"layout"],d.views[u].layout.without(i)));break;case r.LayoutParentType.Screen:d.screens[u].main.layout[i]===t&&(console.debug("remove layout",t,"from screen main",u,", in size mode",i),d=d.setIn(["screens",u,"main","layout"],d.screens[u].main.layout.without(i))),(null===(s=d.screens[u].panel)||void 0===s?void 0:s.layout)&&d.screens[u].panel.layout[i]===t&&(console.debug("remove layout",t,"from screen panel",u,", in size mode",i),d=d.setIn(["screens",u,"panel","layout"],d.screens[u].panel.layout.without(i)));break;case r.LayoutParentType.Widget:const e=d.widgets[u];Object.keys(null!==(a=null==e?void 0:e.layouts)&&void 0!==a?a:{}).forEach(o=>{const n=e.layouts[o];n[i]===t&&(console.debug("remove layout",t,"from widget",u,", in size mode",i),d=d.setIn(["widgets",u,"layouts",o],n.without(i)))})}return d}replaceLayoutIdInParent(e,t,i,o,n){let s=e;switch(console.debug("replace layout",i,"with new one",o,"in parent",t.id,n),t.type){case r.LayoutParentType.Header:s.header.layout[n]===i&&(s=s.setIn(["header","layout",n],o));break;case r.LayoutParentType.Footer:s.footer.layout[n]===i&&(s=s.setIn(["footer","layout",n],o));break;case r.LayoutParentType.Dialog:s.dialogs[t.id].layout[n]===i&&(s=s.setIn(["dialogs",t.id,"layout",n],o));break;case r.LayoutParentType.Page:s.pages[t.id].layout[n]===i&&(s=s.setIn(["pages",t.id,"layout",n],o));break;case r.LayoutParentType.Widget:const e=s.widgets[t.id];e&&Object.keys(e.layouts).some(a=>e.layouts[a][n]===i&&(s=s.setIn(["widgets",t.id,"layouts",a,n],o),!0))}return s}transformLayout(e,t,i,o){let n;n=window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._extensionManager:r.ExtensionManager.getInstance();const s=n.getExtensions(r.extensionSpec.ExtensionPoints.LayoutTransformer);if(s.length>0){const n=s.find(e=>e.layoutType===t.type);n&&n.transformLayout&&(t=n.transformLayout(t,i,o,e))}return t}createBlankItem(e,t){const i=`${A.utils.getMaximumId(e.layouts[t])+1}`,o={id:i};return[e.setIn(["layouts",t,"content",i],o),i]}duplicateItemInSameLayout(e,t,i,o){const{layoutId:n,layoutItemId:s}=t;if(!e.layouts||!e.layouts[n])return[e,null];console.debug("duplicate layout item",n,s,"in size mode",i);const a=A.searchUtils.findLayoutItem(e,t),r=`${A.utils.getMaximumId(e.layouts[n])+1}`,l=a.set("id",r);let d=e.setIn(["layouts",n,"content",l.id],l);d=this.duplicateAndReplaceContent(d,{layoutId:n,layoutItemId:s},{layoutId:n,layoutItemId:l.id},i,i,o);const u=A.searchUtils.findLayoutItem(d,{layoutId:n,layoutItemId:l.id}),c=new me(d,u);return c.hasMultipleParents(i)&&(c.removeSizeModeParent(i),c.addParent({layoutId:n,layoutItemId:l.id},i),d=c.getConfig()),[d,l.id]}pendItem(e,t){const i=A.searchUtils.findLayoutItem(e,t),{layoutId:o,layoutItemId:n}=t;let s=e;return i&&(s=e.setIn(["layouts",o,"content",n,"isPending"],!0)),s}removeItem(e,t,i,o,n,s){var a,l;const{layoutId:d,layoutItemId:u}=t,c=A.searchUtils.findLayoutItem(e,t);if(!c)return e;console.debug(`remove layout item, ${d} ${u}, removeContent=${o}, force=${n}`);const p=$.getPlaceholderInfo(e,t),g=null!==(l=null===(a=e.forBuilderAttributes)||void 0===a?void 0:a.lockLayout)&&void 0!==l&&l,h=r.utils.isExpressMode(),f=e.layouts[d],y=g||h&&f.type!==r.LayoutType.FlexRowLayout||p&&!s&&(c.widgetId||c.sectionId),v=f.type===r.LayoutType.GridLayout&&c.type===r.LayoutItemType.Widget&&!c.widgetId;let m=e;(!y||h&&v)&&(m=this.beforeItemRemoved(m,t));const I=new me(m,c);if(o?n?I.remove():I.tryRemove(t,i):I.removeParent(t,i),m=I.getConfig(),y)c.type===r.LayoutItemType.Widget&&c.widgetId?m=m.setIn(["layouts",d,"content",u],c.without("widgetId")):c.type===r.LayoutItemType.Section&&c.sectionId&&(m=m.setIn(["layouts",d,"content",u],c.without("sectionId").set("type",r.LayoutItemType.Widget)));else{const e=m.layouts[d];e&&(m=m.setIn(["layouts",d,"content"],e.content.without(u))),s||(m=$.afterLayoutItemRemoved(m,t)),m=this.afterItemRemoved(m,t)}return m}replaceSizeModeLayout(e,t,i,o,n,s,a,r){return Ie(this,void 0,void 0,function*(){if(!o)return[e,t];const l=n===e.mainSizeMode;let d,u=e,c=t;d=l?Object.keys(o).filter(e=>e===n||null==t[e]):[n];for(let e=0;e<d.length;e+=1){const t=d[e],n=yield this.replaceLayout(u,c[t],i,o[t],t,s,a,r);n[1]&&(u=n[0],c=c.set(t,n[1]))}if(null==o[n]){const e=yield this.replaceLayout(u,c[n],i,o[u.mainSizeMode],n,s,a,r);u=e[0],c=c.set(n,e[1])}return[u,c]})}replaceLayout(e,t,i,o,n,s,a,l){return Ie(this,void 0,void 0,function*(){var d,u,c;if(null==(null===(u=null===(d=i.config)||void 0===d?void 0:d.layouts)||void 0===u?void 0:u[o]))return[e,null];console.debug(`replace ${t} with template ${o} in ${n}`);let p=e;const g=[];if(null===(c=e.layouts)||void 0===c?void 0:c[t]){const i=e.layouts[t];let o=!0;if((null==i?void 0:i.content)&&Object.keys(i.content).length>0&&(Object.keys(i.content).forEach(e=>{const t=i.content[e];t.isPending?g.push({type:t.type,id:t.widgetId||t.sectionId||t.screenGroupId}):o=!1}),!o))return[e,null];p=p.set("layouts",p.layouts.without(t))}const h=yield this.createLayoutFromTemplate(p,i,o,n,s,a,l);p=h[0];const f=h[1];return p=this.replaceLayoutIdInParent(p,{type:s,id:a},t,f,n),g.length>0&&g.forEach(e=>{const t=this.createBlankItem(p,f);p=t[0];const i=t[1];switch(p=p.setIn(["layouts",f,"content",i,"type"],e.type).setIn(["layouts",f,"content",i,"isPending"],!0),e.type){case r.LayoutItemType.Widget:p=p.setIn(["layouts",f,"content",i,"widgetId"],e.id);break;case r.LayoutItemType.Section:p=p.setIn(["layouts",f,"content",i,"sectionId"],e.id);break;case r.LayoutItemType.ScreenGroup:p=p.setIn(["layouts",f,"content",i,"screenGroupId"],e.id)}}),[p,f]})}createLayoutFromTemplate(e,t,i,o,n,s,a){return Ie(this,void 0,void 0,function*(){var l,d;let u=e;yield U(t),console.debug("create layout",i,"from template");const c=t.config.layouts[i],p=Se("layout");a[i]=p,u=u.setIn(["layouts",p],c).setIn(["layouts",p,"id"],p).setIn(["layouts",p,"parent"],{type:n,id:s});const g=c.type===r.LayoutType.GridLayout?Object.keys(c.content||{}):null!==(l=c.order)&&void 0!==l?l:[];for(let e=0;e<g.length;e++){const i=g[e],n=c.content[i],s=new me(u,n),l=yield s.createFromTemplate(t,[o],a,{isBlock:c.type===r.LayoutType.FlowLayout});u=l[0];const d=l[1];u=he.setContentId(u,{layoutId:p,layoutItemId:i},d,o)}if(o===r.BrowserSizeMode.Large&&c.type===r.LayoutType.GridLayout&&(null===(d=c.setting)||void 0===d?void 0:d.mainItemId)){const e=a[c.setting.mainItemId];u=u.setIn(["layouts",p,"setting","mainItemId"],e)}return[u,p]})}getTocStructure(e,t){return null}moveLayoutItem(e,t,i,o,n){var s,a,l,d;const u=A.searchUtils.findLayoutItem(e,t);if(!u)return[e,null];let c=e;const p=e.layouts[t.layoutId],g=A.searchUtils.findLayoutItem(c,t);if(p.type===r.LayoutType.GridLayout&&!g.isPending&&o===n){const e=x.getInstance().getServiceByType(r.LayoutType.GridLayout);c=e.beforeItemRemoved(c,t)}if(console.debug("move layout item from",t.layoutId,t.layoutItemId,"to",i,n),g.isPending&&o===n&&(c=c.setIn(["layouts",t.layoutId,"content",t.layoutItemId],g.without("isPending"))),t.layoutId!==i){const e=x.getService(c,t.layoutId);if(o===n){let i=[t];if(g.type===r.LayoutItemType.Widget){const e=c.widgets[g.widgetId];e&&(null===(a=null===(s=e.parent)||void 0===s?void 0:s[o])||void 0===a?void 0:a.length)>1&&(i=e.parent[o])}else if(g.type===r.LayoutItemType.Section){const e=c.sections[g.sectionId];(null===(d=null===(l=e.parent)||void 0===l?void 0:l[o])||void 0===d?void 0:d.length)>1&&(i=e.parent[o])}i.forEach(t=>{c=e.removeItem(c,t,o,!1,!1,!0)})}const p=this.createBlankItem(c,i);c=p[0];const h=p[1];c=c.setIn(["layouts",i,"content",h,"type"],u.type),u.type===r.LayoutItemType.Widget?c=c.setIn(["layouts",i,"content",h,"widgetId"],u.widgetId):u.type===r.LayoutItemType.Section&&(c=c.setIn(["layouts",i,"content",h,"sectionId"],u.sectionId));const f={layoutId:i,layoutItemId:h},y=A.searchUtils.findLayoutItem(c,f),v=new me(c,y);return v.addParent(f,n),o===n?v.afterMoved(t.layoutId,i):v.afterAdded(i,o,n),c=v.getConfig(),c=$.afterLayoutItemMoved(c,t,f),[c,f]}return[c,t]}afterItemAdded(e,t,i,o,n){const s=A.searchUtils.findLayoutItem(e,t),a=new me(e,s);return a.afterAdded(t.layoutId,i,o),a.getConfig()}afterItemMoved(e,t,i){return e}beforeItemRemoved(e,t){return e}afterItemRemoved(e,t){return e}}var Ce=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const{getUniqueId:Se,getUniqueLabel:be,parseUniqueLabel:Pe,getSizeModeOfALayout:Ae}=r.appConfigUtils;function Le(e,t){return!!e.pageStructure.find(e=>!!e[t])}function Me(e,t){const i=e.pageStructure.find(e=>!!e[t]);return i&&i[t].length>0}function Te(e){let t=0;return Object.keys(e.pages).forEach((i,o)=>{Re(e,i)&&t++}),t}function xe(e,t){if(!Le(e,t))return 0;let i=0;return e.pageStructure.forEach((o,n)=>{const s=Object.keys(o)[0];s===t&&o[s].forEach(t=>{Re(e,t)&&i++})}),i}function _e(e,t){let i=0;return Re(e,t)&&(i=1),Te(e)-xe(e,t)-i}function Re(e,t){const i=e.pages[t];return!!i&&i.type===r.PageType.Normal}function je(e){var t,i,o,n;return Object.values(null!==(t=e.pages)&&void 0!==t?t:{}).forEach(t=>{e=L(e,t.layout)}),Object.values(null!==(i=e.dialogs)&&void 0!==i?i:{}).forEach(t=>{e=L(e,t.layout)}),(null===(o=e.header)||void 0===o?void 0:o.layout)&&(e=L(e,e.header.layout)),(null===(n=e.footer)||void 0===n?void 0:n.layout)&&(e=L(e,e.footer.layout)),e}function Oe(e){const t=function(e){var t,i;let o=e;return Object.keys(null!==(t=o.layouts)&&void 0!==t?t:{}).forEach(e=>{var t;const i=o.layouts[e];if(i&&!i.parent){const n=x.getService(o,e);Object.keys(null!==(t=i.content)&&void 0!==t?t:{}).forEach(t=>{o=n.removeItem(o,{layoutId:e,layoutItemId:t},null,!0,!0)}),o=o.set("layouts",o.layouts.without(e))}}),Object.keys(null!==(i=o.widgets)&&void 0!==i?i:{}).forEach(e=>{const t=o.widgets[e];t&&!t.parent&&(o=te.remove(o,e))}),o}(e);let i=t.asMutable({deep:!0});var o;return delete i.translationJsons,Object.keys(i.widgets).forEach(e=>{var t,o,n;const s=i.widgets[e];s.label===(null===(t=s.manifest)||void 0===t?void 0:t.name)&&delete s.label,s.icon===s.context.folderUrl+"icon.svg"&&delete s.icon,"object"==typeof s.icon&&(s.icon.svg!==s.context.folderUrl+"icon.svg"||"#fff"!==(null===(o=s.icon.properties)||void 0===o?void 0:o.color)&&(null===(n=s.icon.properties)||void 0===n?void 0:n.color)||delete s.icon),s.itemId&&delete s.uri,delete s.context,delete s.manifest,delete s.originVersion}),i.layouts=(o=i.layouts,Object.keys(o).forEach(e=>{const t=o[e];delete t.id,t.content&&Object.keys(t.content).forEach(e=>{delete t.content[e].id})}),o),i=je(i),delete i.originExbVersion,i}function Ue(e,t,i,o){let n;return"page"===t?n=e.pages:"view"===t?n=e.views:"dialog"===t&&(n=e.dialogs),!!n&&Object.keys(n).some(e=>e!==i&&n[e].label===o)}const Ee=/var\(--\b(primary|secondary|danger|warning|info|success|light|dark)-\b(100|200|300|400|500|600|700|800|900)\)/,ke=/var\(--\b(primary|secondary|danger|warning|info|success|white|black|light|dark|transparent)\)/,De=/var\(--\borg-\b(body|header|button)-\b(color|bg|link)\)/,Be=/^(shadow|shadow-[0-3])$/,We={border:{color:"var(--sys-color-divider-secondary)"},boxShadow:{presetStyle:"shadow-3",color:"var(--ref-palette-neutral-500)"},dialogBackground:{color:"var(--sys-color-surface-overlay)"},overlayColor:"#000000"},ze={"var(--primary-100)":"color-mix(in srgb, var(--sys-color-primary-main) 15%, #FFFFFF 85%)","var(--primary-200)":"color-mix(in srgb, var(--sys-color-primary-main) 25%, #FFFFFF 75%)","var(--primary-300)":"color-mix(in srgb, var(--sys-color-primary-main) 35%, #FFFFFF 65%)","var(--primary-500)":"color-mix(in srgb, var(--sys-color-primary-main) 55%, #FFFFFF 45%)","var(--primary-600)":"color-mix(in srgb, var(--sys-color-primary-main) 65%, #FFFFFF 35%)","var(--light-100)":"color-mix(in srgb, var(--sys-color-secondary-main) 15%, #FFFFFF 85%)","var(--light-300)":"color-mix(in srgb, var(--sys-color-secondary-main) 25%, #FFFFFF 75%)","var(--light-500)":"color-mix(in srgb, var(--sys-color-secondary-main) 35%, #FFFFFF 65%)","var(--light-700)":"var(--sys-color-surface-paper)","var(--primary)":"var(--sys-color-primary-main)","var(--secondary)":"var(--sys-color-secondary-main)","var(--danger)":"var(--sys-color-error-main)","var(--warning)":"var(--sys-color-warning-main)","var(--info)":"var(--sys-color-info-main)","var(--success)":"var(--sys-color-success-main)","var(--light)":"var(--sys-color-surface-paper)","var(--dark)":"var(--sys-color-surface-paper-text)"},Fe={"var(--primary-200)":"color-mix(in srgb, var(--sys-color-primary-main) 60%, #FFFFFF 40%)","var(--primary-400)":"color-mix(in srgb, var(--sys-color-primary-main) 80%, #FFFFFF 20%)","var(--primary-600)":"color-mix(in srgb, var(--sys-color-primary-main) 100%, #FFFFFF 0%)","var(--light-300)":"color-mix(in srgb, var(--sys-color-secondary-main) 60%, #FFFFFF 40%)","var(--light-600)":"color-mix(in srgb, var(--sys-color-secondary-main) 40%, #FFFFFF 80%)","var(--light-900)":"color-mix(in srgb, var(--sys-color-secondary-main) 100%, #FFFFFF 0%)","var(--dark-300)":"var(--sys-color-divider-primary)","var(--primary)":"var(--sys-color-primary-main)","var(--secondary)":"var(--sys-color-secondary-main)","var(--danger)":"var(--sys-color-error-main)","var(--warning)":"var(--sys-color-warning-main)","var(--info)":"var(--sys-color-info-main)","var(--success)":"var(--sys-color-success-main)","var(--light)":"var(--sys-color-surface-paper)","var(--dark)":"var(--sys-color-surface-paper-text)"};function $e(e){return Ce(this,void 0,void 0,function*(){let t=e;return yield r.utils.iterateDeepObject(e,(i,o)=>Ce(this,void 0,void 0,function*(){var n;const s="string"!=typeof i||!i.startsWith("var(--")||!Ee.test(i)&&!ke.test(i)&&!De.test(i),a=!Be.test(i);if(s&&a)return;let l="";const d=o.length-1;"style"===o[d-2]&&"background"===o[d-1]&&"color"===o[d]&&ze[i]&&(l=ze[i]);"style"===o[d-2]&&"border"===o[d-1]&&"color"===o[d]&&Fe[i]&&(l=Fe[i]);if("widgets"===o[0]&&"config"===o[2]&&o.length>3)try{const t=null===(n=e.widgets[o[1]])||void 0===n?void 0:n.uri;if("widgets/common/chart/"===t)l=function(e){const t=(0,f.getTheme2)();return f.colorUtils.parseThemeVariable(e,t)||"rgba(0,0,0,0)"}(i);else{const e=yield G.getInstance().loadWidgetDefaultConfig(t),n=r.lodash.getValue(e,o.slice(3).join("."));n&&i!==n&&(l=n)}}catch(e){console.error(e)}if("dialogs"===o[0]&&o.length>2){const e=r.lodash.getValue(We,o.slice(2).join("."));e&&i!==e&&(l=e)}const u=o.map(e=>"string"==typeof e?e:e.toString());t=t.setIn(u,l)}),{isAsync:!0}),t})}var Ge;window._getCleanAppConfig=Oe,function(e){e.InAppAppStateChanged="IN_APP_APP_STATE_CHANGED",e.InBuilderAppConfigChanged="IN_BUILDER_APP_CONFIG_CHANGED"}(Ge||(Ge={}));const Ne={inAppAppStateChanged:e=>({type:Ge.InAppAppStateChanged,appState:e}),inBuilderAppConfigChanged:e=>({type:Ge.InBuilderAppConfigChanged,appConfig:e})};class He{constructor(){this.id="builder-app-state-redux-store-extension"}getActions(){return Object.keys(Ge).map(e=>Ge[e])}getInitLocalState(){return null}getReducer(){return(e,t,i)=>{switch(t.type){case Ge.InAppAppStateChanged:return t.appState;case Ge.InBuilderAppConfigChanged:return r.appConfigUtils.updateStateWhenAppConfigChange(e,t.appConfig);default:return e}}}getStoreKey(){return"appStateInBuilder"}}var Ve;!function(e){e.InBuilderPutAppConfigIntoHistory="IN_BUILDER_PUT_APPCONFIG_INTO_HISTORY",e.InBuilderRemoveLastAppConfigFromHistory="IN_BUILDER_REMOVE_LAST_APPCONFIG_FROM_HISTORY",e.InBuilderReplaceLastAppConfigInHistory="IN_BUILDER_REPLACE_LAST_APPCONFIG_IN_HISTORY",e.InBuilderAppConfigUndo="IN_BUILDER_APPCONFIG_UNDO",e.InBuilderAppConfigRedo="IN_BUILDER_APPCONFIG_REDO",e.InBuilderAppConfigRedoClear="IN_BUILDER_APPCONFIG_REDOCLEAR",e.InBuilderAppConfigClear="IN_BUILDER_APPCONFIG_CLEAR"}(Ve||(Ve={}));const qe={InBuilderAppConfigUndo:()=>({type:Ve.InBuilderAppConfigUndo}),InBuilderAppConfigRedo:()=>({type:Ve.InBuilderAppConfigRedo}),InBuilderPutAppConfigIntoHistory:e=>({type:Ve.InBuilderPutAppConfigIntoHistory,appState:e}),InBuilderRemoveLastAppConfigFromHistory:()=>({type:Ve.InBuilderRemoveLastAppConfigFromHistory}),InBuilderReplaceLastAppConfigInHistory:e=>({type:Ve.InBuilderReplaceLastAppConfigInHistory,appState:e}),InBuilderAppConfigRedoClear:()=>({type:Ve.InBuilderAppConfigRedoClear}),InBuilderAppConfigClear:()=>({type:Ve.InBuilderAppConfigClear})};class Ke{constructor(){this.id="app-state-history-extension"}getActions(){return[Ve.InBuilderPutAppConfigIntoHistory,Ve.InBuilderRemoveLastAppConfigFromHistory,Ve.InBuilderReplaceLastAppConfigInHistory,Ve.InBuilderAppConfigUndo,Ve.InBuilderAppConfigRedo,Ve.InBuilderAppConfigRedoClear,Ve.InBuilderAppConfigClear]}getInitLocalState(){return{past:[],future:[]}}getReducer(){return(e,t,i)=>{switch(t.type){case Ve.InBuilderAppConfigUndo:return this.handleAppStateUndo(e);case Ve.InBuilderAppConfigRedo:return this.handleAppStateRedo(e);case Ve.InBuilderPutAppConfigIntoHistory:return this.handleAppStateAdd(e,t.appState);case Ve.InBuilderRemoveLastAppConfigFromHistory:return this.handleAppStateRemoveLast(e);case Ve.InBuilderReplaceLastAppConfigInHistory:return this.handleAppStateReplaceLast(e,t.appState);case Ve.InBuilderAppConfigRedoClear:return this.handleAppStateRedoClear(e);case Ve.InBuilderAppConfigClear:return this.handleAppStateClear(e);default:return e}}}handleAppStateUndo(e){if(e.past.length<2)return console.warn("Can not undo since no history there"),e;const t=e.past[e.past.length-2],i=e.past[e.past.length-1],o=e.past.slice(0,e.past.length-1),n=[i].concat(e.future);return qt(t.appConfig),Kt(t.appInfo),e.merge({past:o,future:n})}handleAppStateRedo(e){if(e.future.length<1)return console.warn("Can not redo since no history there"),e;const t=e.future[0],i=e.future.slice(1),o=e.past.concat([t]);return qt(t.appConfig),Kt(t.appInfo),e.merge({past:o,future:i})}handleAppStateAdd(e,t){const i=e.past[e.past.length-1];if(null!==t&&(e.past.length>0&&(i.appConfig!==t.appConfig||i.appInfo!==t.appInfo)||0===e.past.length)){const i=e.past.concat([t]);return e.set("past",i).set("future",[])}return e}handleAppStateRemoveLast(e){if(e.past.length>0){const t=e.past.slice(0,e.past.length-1);return e.set("past",t)}return e}handleAppStateReplaceLast(e,t){let i=e.past;return e.past.length>0?(i=i.slice(0,e.past.length-1).concat(t),e.set("past",i)):e}handleAppStateRedoClear(e){return e.set("future",[])}handleAppStateClear(e){return e.set("future",[]).set("past",[])}getStoreKey(){return"appStateHistory"}}var Je,Ye,Qe,Ze,Xe;!function(e){e.AppConfigChanged="app_config_changed",e.AppInfoChanged="app_info_changed",e.PortalSelfChanged="portal_self_changed",e.DialogInfosChanged="dialog_infos_changed",e.UserSignIn="user_sign_in",e.SetMainPortal="set_main_portal",e.ChangeAppMode="change_app_mode",e.ChangePage="change_page",e.ChangeDialog="change_dialog",e.ChangeSelection="change_selection",e.ChangeWidgetStateProp="change_widget_state_prop",e.ChangeZoomScale="change_zoom_scale",e.BuilderTriggerKeyboard="builder_trigger_keyboard",e.ChangeBrowserSizeMode="change_browser_size_mode",e.BuilderSessionChanged="builder_session_changed",e.BuilderNoPermissionResourceInfoListChanged="builder_no_permission_resource_info_list_changed",e.ActivePagePartChanged="active_page_part_changed",e.AnimationPreview="animation_preview",e.HoverPreview="hover_preview",e.SectionNavInfoChanged="section_navinfo_changed",e.ScreenGroupNavInfoChanged="screengroup_navinfo_changed",e.TocHoverInfoChanged="toc_hover_info_changed",e.SetClientIdAlertIsCancelled="set_client_id_alert_is_cancelled",e.UtilityStateChanged="utility_state_changed",e.OpenCookieBanner="open_cookie_banner",e.OpenCookieBannerByPrivacyPanel="open_cookie_banner_by_privacy_panel",e.OpenCookieSettingsWindow="open_cookie_settings_window",e.WidgetToolbarStateChange="widget_toolbar_state_change",e.SetWidgetIsInlineEditingState="set__widget_is_inline_editing_state",e.WidgetStateChange="widget_state_change",e.WidgetRuntimeInfoChange="widget_runtime_info_change",e.RuntimeThemeModeChange="runtime_theme_mode_change",e.ChangeDynamicStylePreviewConditionInfo="change_dynamic_style_preview_condition_info"}(Je||(Je={})),function(e){e.AppStateChanged="app_state_changed",e.AppSessionChanged="app_session_changed",e.AppNoPermissionResourceInfoListChanged="app_no_permission_resource_info_list_changed",e.NeedToCheck498Error="need_to_check_498_error",e.AppAddResource="app_add_resource",e.AppTriggerKeyboard="app_trigger_keyboard",e.AppIsLoaded="app_is_loaded",e.ConfirmDelete="confirm_delete",e.NeedToRegisterClinetId="need_to_register_client_id",e.SetSidePanel="app_side_panel",e.CloseBannerInLiveView="close_banner_in_live_view",e.ClassificationBannerReady="classification_banner_ready",e.ShowTextArcadePanel="show_text_arcade_panel"}(Ye||(Ye={})),function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(Qe||(Qe={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(Ze||(Ze={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(Xe||(Xe={}));var et=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function tt(e){return et(this,arguments,void 0,function*(e,t=Qe.Other){return yield it(e,"item",t)})}function it(e,t){return et(this,arguments,void 0,function*(e,t,i=Qe.Other){let o,n;return o=`${i===Qe.AGOL?"https://www.arcgis.com/":`${window.location.origin}${window.jimuConfig.mountPath}`}sharing/rest/search`,n="string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:r.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f","categories"]),at(o,n,"GET").then(i=>(i.nextStart&&-1!==i.nextStart&&(i.nextPage=function(){return et(this,void 0,void 0,function*(){let o;return"string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?o={q:e,start:i.nextStart}:(o=e,o.start=i.nextStart),yield it(o,t)})}),i))})}function ot(e,t){return et(this,void 0,void 0,function*(){return yield nt(e,t)})}function nt(e,t){return et(this,void 0,void 0,function*(){let i,o;i||Promise.resolve(null),i=`${t}/sharing/rest/search`,o="string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:r.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f"]);const n=null==o?void 0:o.authentication,s={params:null==o?void 0:o.params,httpMethod:"GET"};return n&&(s.authentication=n),r.esri.restRequest.request(i,s).then(t=>(t.nextStart&&-1!==t.nextStart&&(t.nextPage=function(){return et(this,void 0,void 0,function*(){let i;return"string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?i={q:e,start:t.nextStart}:(i=e,i.start=t.nextStart),yield nt(i,"item")})}),t))})}var st=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function at(e){return st(this,arguments,void 0,function*(e,t={params:{f:"json"}},i="POST"){if("GET"===i){const i=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"):""}(t.params);return yield fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>st(this,void 0,void 0,function*(){return yield e.json()})).then(e=>st(this,void 0,void 0,function*(){return yield Promise.resolve(e)}))}return"POST"===i?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then(e=>st(this,void 0,void 0,function*(){return yield e.json()})).then(e=>st(this,void 0,void 0,function*(){return yield Promise.resolve(e)})):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then(e=>st(this,void 0,void 0,function*(){return yield e.json()})).then(e=>st(this,void 0,void 0,function*(){return yield Promise.resolve(e)})):yield Promise.reject(new Error(null))})}function rt(e=!1){var t;if(e)return r.urlUtils.getArcgisOnlineUrl();{const e=(null===(t=window.jimuConfig.mountPath)||void 0===t?void 0:t.slice(0,-1))||"";return`${window.location.origin}${e}`}}const lt=r.esri.restRequest.request;function dt(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}function ut(){var e;return null===(e=(0,r.getAppStore)().getState().user)||void 0===e?void 0:e.username}function ct(e=!1){return e?lt:at}function pt(e){const t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}var gt=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function ht(e){return gt(this,void 0,void 0,function*(){const t=Object.assign({folderId:null},e);return yield function(e){return gt(this,void 0,void 0,function*(){var t,i;if(e.file&&!e.multipart)return yield Promise.reject(new Error("The request must be a multipart request for file uploading."));if(e.multipart&&!e.filename)return yield Promise.reject(new Error("The file name is required for a multipart request."));const o=ut(),n=`${rt()}${dt()}addItem`;e.params=Object.assign(Object.assign(Object.assign({},e.params),pt(e.item)),{portalUrl:null===(i=null===(t=(0,r.getAppStore)())||void 0===t?void 0:t.getState())||void 0===i?void 0:i.portalUrl});const s=r.esri.restRequest.appendCustomParams(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return s.params.username=o,yield at(n,s)})}(t)})}function ft(e,t){return gt(this,void 0,void 0,function*(){const i=`${rt()}${dt()}importItem`;if(!(null==e?void 0:e.appZip))return Promise.reject(new Error("No app files"));t.params=Object.assign(Object.assign({},t.params),e);const o=Object.keys(t.params),n=new FormData;for(let e=0;e<o.length;e++)n.append(o[e],t.params[o[e]]);return t.params=n,yield at(i,t)})}function yt(e,t){return gt(this,void 0,void 0,function*(){const i=`${rt()}${dt()}checkItemVersion`;if(!(null==e?void 0:e.appZip))return Promise.reject(new Error("No app files"));t.params=Object.assign(Object.assign({},t.params),e);const o=Object.keys(t.params),n=new FormData;for(let e=0;e<o.length;e++)n.append(o[e],t.params[o[e]]);return t.params=n,yield at(i,t)})}var vt=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function mt(e,t){return vt(this,arguments,void 0,function*(e,t,i=!1){const o=`${rt(i)}${dt(i)}items/${e}/data`,n=Object.assign({params:{}},t);n.file&&(n.params.f=null),i&&!bt()&&delete n.authentication;const s=ct(i);return yield s(o,n,"GET").catch(e=>{if(!/Unexpected end of (JSON input|data at line 1 column 1)/i.test(e.message))throw new Error(e)})})}function It(e,t){return vt(this,arguments,void 0,function*(e,t,i=!1){const o=`${rt(i)}${dt(i)}items/${e}`,n=Object.assign({},t);i&&!bt()&&delete n.authentication;const s=ct(i);return yield s(o,n,"GET")})}function wt(e){return vt(this,void 0,void 0,function*(){const t=`${rt()}/community/users/${e.username}/tags`,i=Object.assign({},e);delete i.authentication;const o=ct();return yield o(t,i,"GET")})}function Ct(e,t){return vt(this,arguments,void 0,function*(e,t,i=!1){const o=`${rt(i)}${dt(i)}items/${e}/resources`;t.params=Object.assign(Object.assign({},t.params),{num:1e3}),i&&!bt()&&delete t.authentication;const n=ct(i);return yield n(o,t,"GET")})}function St(e,t){return vt(this,arguments,void 0,function*(e,t,i=!1){const o=t.fileName,n=`${rt(i)}${dt(i)}items/${e}/resources/${o}`;i&&!bt()&&delete t.authentication;const s=ct(i);return yield s(n,t,"GET")})}function bt(){const e=(0,r.getAppStore)().getState().portalUrl;return r.portalUrlUtils.isAGOLDomain(e)}var Pt=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function At(e){return Pt(this,void 0,void 0,function*(){const t=ut(),i=rt();e.userName=t;const o=`${i}${dt()}items/${e.id}/delete`;return yield at(o,e)})}function Lt(e){return Pt(this,void 0,void 0,function*(){const t=`${rt()}${dt()}items/${e.id}/removeResources`;return e.params=Object.assign(Object.assign({},e.params),{resource:e.resource}),yield at(t,e)})}var Mt=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function Tt(e){return Mt(this,void 0,void 0,function*(){const t=ut(),i=rt();e.userName=t;const o=`${i}${dt()}items/${e.item.id}/update`;if(e.params=Object.assign(Object.assign({},e.params),pt(e.item)),e.item.thumbnail&&"string"!=typeof e.item.thumbnail){e.params=Object.assign(Object.assign({},e.params),e.item);const t=Object.keys(e.params),i=new FormData;for(let o=0;o<t.length;o++)i.append(t[o],e.params[t[o]]);e.params=i}return yield at(o,e)})}function xt(e){return Mt(this,void 0,void 0,function*(){const t=`${rt()}${dt()}items/${e.id}/updateResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource,void 0!==e.private&&(e.params.access=e.private?"private":"inherit");const i=Object.keys(e.params),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e.params[i[t]]);return e.params=o,yield at(t,e)})}var _t=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function Rt(e){return _t(this,void 0,void 0,function*(){const t=`${rt()}${dt()}items/${e.id}/addResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content,access:e.private?"private":"inherit"},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource;const i=Object.keys(e.params),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e.params[i[t]]);return e.params=o,yield at(t,e)})}function jt(e){var t,i;if(!(null==e?void 0:e.portalUrl))return!window.jimuConfig.isDevEdition;const o=(null==e?void 0:e.portalUrl)||"",n=(null===(i=null===(t=(0,r.getAppStore)())||void 0===t?void 0:t.getState())||void 0===i?void 0:i.portalUrl)||"",s=(null==n?void 0:n.includes(o))||(null==o?void 0:o.includes(n));return(r.portalUrlUtils.isAGOLDomain(o)&&r.portalUrlUtils.isAGOLDomain(n)||s)&&!Ot(e)}function Ot(e){return!!((null==e?void 0:e.portalUrl)||"").endsWith("localhost:")||e.isLocalApp}function Ut(e){if(!(null==e?void 0:e.portalUrl))return!1;const t=(null==e?void 0:e.portalUrl)||"",i=r.portalUrlUtils.isAGOLDomain(t),o=!jt(e),n=!Ot(e);return o&&n&&i}r.SessionManager.getInstance().isTrustedServer((0,r.getAppStore)().getState().portalUrl);var Et=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const{importItem:kt,checkItemVersion:Dt}=t;function Bt(e,i,o){const n=o?t[o]:t[e],s=r.esri.restPortal[e];return i?jt(i)?s:n:window.jimuConfig.isDevEdition?n:s}var Wt,zt=d(321),Ft=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};!function(e){e.Config="config/config.json",e.Image="images/image-resources-list.json",e.Icon="images/icon-resources-list.json"}(Wt||(Wt={}));const $t=(e="",t={})=>{let i=e;const o=[];try{for(const[e,{id:n,resourceUrl:s}]of Object.entries(t))i.includes(e)&&(i=i.replace(new RegExp(e,"g"),s),!o.includes(n)&&o.push(n))}catch(e){console.error(e)}return{newValue:i,replaceIds:o}};class Gt{constructor(){this.resourceMap={},this.blobToResourceMap={},this.resources={},this.getResourcesInDraft=()=>this.resources,this.setResourcesInDraft=e=>{this.resources=Object.assign(Object.assign({},this.getResourcesInDraft()),e)},this.getImageResourceListFromDraft=e=>Ft(this,void 0,void 0,function*(){const t=this.getResourcesInDraft();if(t.imageResources)return yield Promise.resolve(t.imageResources);{const{resources:t}=yield this.fetchAppResourceInfoList(e);if((null==t?void 0:t.some(({resource:e})=>e===Wt.Image))||!1){const t=(yield this.fetchAppResource(e,{fileName:Wt.Image,readAs:"json"}))||{};return yield Promise.resolve(t)}return yield this.uploadImageResourceList({},e)}}),this.getIconResourceListFromDraft=e=>Ft(this,void 0,void 0,function*(){const{iconResources:t}=this.getResourcesInDraft();if(t)return yield Promise.resolve(t);const{resources:i}=yield this.fetchAppResourceInfoList(e);if((null==i?void 0:i.some(({resource:e})=>e===Wt.Icon))||!1){const t=yield this.fetchAppResource(e,{fileName:Wt.Icon,readAs:"json"});if(t)return yield Promise.resolve(t)}return yield this.uploadIconResourceList({},e)}),this.getInUseImageResources=e=>{var t;const i=Oe(null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig),{configSourceMap:o,fullMatchString:n}=this.replaceBlobAndMatchResource(i),s=[];Object.values(e).forEach(e=>{const t=`${r.appConfigUtils.APP_RESOURCE_URL}/${e.resourcesPrefix}/${e.fileName}`;(o[t]||n.includes(t))&&s.push(e)});return this.formatRelatedImageResources(e,s)},this.getInUseIconResources=e=>{var t;const i=Oe(null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig),{configSourceMap:o,fullMatchString:n}=this.replaceBlobAndMatchResource(i),s=[];return Object.values(e).forEach(e=>{const t=`${r.appConfigUtils.APP_RESOURCE_URL}/images/icon_picker_in_setting/${e.properties.filename}`;(o[t]||n.includes(t))&&s.push(e)}),s},this.uploadAppConfig=(e,t,i)=>Ft(this,void 0,void 0,function*(){const o=yield this.uploadLocalResource(t),n=new Blob([JSON.stringify(o)],{type:"application/json"}),s={appId:e,file:n,fileName:"config.json",type:r.ResourceType.Config,owner:i};return yield this.uploadAppResource(s).then(()=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(t)})).catch(e=>Ft(this,void 0,void 0,function*(){return yield Promise.reject(new Error(e))}))}),this.uploadImageResourceList=(e,t)=>Ft(this,void 0,void 0,function*(){const i=Object.assign({},e);return yield this.uploadResourceList(Wt.Image,i,t)}),this.uploadIconResourceList=(e,t)=>Ft(this,void 0,void 0,function*(){return yield this.uploadResourceList(Wt.Icon,e,t)}),this.updateConfigTranslationResourceList=(e,t)=>Ft(this,void 0,void 0,function*(){var i;const o=null===(i=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===i?void 0:i.appConfig,n=(yield this.getConfigTranslationResourceLocaleList(t)).filter(t=>!Object.keys(e).includes(t)&&t!==o.mainLocale),s=Object.keys(e).filter(e=>e!==o.mainLocale).map(i=>this.uploadConfigTranslationResource(e[i],i,t)),a=n.map(e=>this.removeConfigTranslationResource(e,t));return Promise.all([...s,...a])}),this.getConfigTranslationResourceLocaleList=e=>Ft(this,void 0,void 0,function*(){const t=this.getAppId();try{const{resources:i}=yield this.fetchAppResourceInfoList(t),o=i.filter(t=>t.resource&&r.configTranslationUtils.isTranslationFile(t.resource,e));return o.map(t=>r.configTranslationUtils.getLocaleFromTranslationFile(t.resource,e)).filter(e=>e&&e.length>0)}catch(e){return console.error(e),[]}}),this.getConfigTranslationResource=(e,t)=>Ft(this,void 0,void 0,function*(){const i=this.getAppId(),o=r.configTranslationUtils.getTranslationFullFileName(e,t);try{const t=yield this.fetchAppResource(i,{fileName:o,readAs:"json"});return{locale:e,translationJson:t}}catch(e){return console.error(e),null}}),this.uploadConfigTranslationResource=(e,t,i)=>Ft(this,void 0,void 0,function*(){const o=r.configTranslationUtils.getTranslationFilePath(i),n=r.configTranslationUtils.getTranslationFileName(t),s={file:new Blob([JSON.stringify(e)],{type:"application/json"}),fileName:n,resourcesPrefix:o,type:r.ResourceType.Translation};try{return yield this.uploadAppResource(s)}catch(e){return Promise.reject(new Error("error uploading config translation resource: "+e))}}),this.removeConfigTranslationResource=(e,t)=>Ft(this,void 0,void 0,function*(){const i={fileName:r.configTranslationUtils.getTranslationFullFileName(e,t)};try{return yield this.removeAppResource(i)}catch(e){return Promise.reject(new Error("error removing config translation resource: "+e))}}),this.uploadAppResource=e=>Ft(this,void 0,void 0,function*(){e.resourcesPrefix=Gt.getResourcePrefix(e);const{appId:t=this.getAppId(),fileName:i,originalName:o,resourcesPrefix:n}=e,s=(n?n+"/":"")+i,a=`${r.appConfigUtils.APP_RESOURCE_URL}/${s}`,l=(0,r.uuidv1)(),d={id:l,appId:t,fileName:i,originalName:o,resourcesPrefix:n,url:e.url,blobUrl:e.blobUrl,resourceUrl:a,type:e.type,status:r.AjaxState.Fetching,widgetId:e.widgetId,owner:e.owner},u=Object.assign({},d);u.file=e.file;const c=this.fetchAppResourceInfoList(t).then(e=>Ft(this,[e],void 0,function*({resources:e}){if(0===(null==e?void 0:e.length))return yield this.addAppResource(u);if((null==e?void 0:e.length)>0)return e.some(({resource:e})=>e===s)?yield this.updateAppResource(u):yield this.addAppResource(u);throw new Error("return value from fetchAppResourceInfoList is not right")})).catch(e=>Ft(this,void 0,void 0,function*(){return console.error(e),this.setResourceItemInfoStatus(u,r.AjaxState.Error),yield Promise.reject(new Error(e))}));return u.promise=c,this.setResourceMap(l,d),yield c}),this.uploadLocalResource=e=>Ft(this,void 0,void 0,function*(){const t=[],i=r.utils.iterateDeepObject(e,(i,o,n,s)=>{if("string"!=typeof i)return;const a=r.appConfigUtils.isFullReplace(e,o);if(a?r.appConfigUtils.fullMatchBlobUrl(i):r.appConfigUtils.matchBlobUrl(i))if(a){const{newValue:e,replaceIds:o}=$t(i,this.blobToResourceMap);for(const e of o)!t.includes(e)&&t.push(e);s[n]=e}else{const e=this.blobToResourceMap[i];!t.includes(e.id)&&t.push(e.id),s[n]=e.resourceUrl}});return yield this.checkResourcesUploadStatus(t).then(e=>Ft(this,void 0,void 0,function*(){return e===r.AjaxState.Success?yield Promise.resolve(i):yield Promise.reject(new Error(null))}))}),this.fetchAppResourceInfoList=(e,t)=>Ft(this,void 0,void 0,function*(){const i=this.getSession();return yield function(e,t){return Et(this,void 0,void 0,function*(){return Bt("getItemResources",e)(e.id,t,Ut(e))})}({id:e,isLocalApp:window.jimuConfig.isDevEdition},Object.assign({authentication:i},t)).catch(e=>Ft(this,void 0,void 0,function*(){return console.log(e),yield Promise.reject(new Error(e))}))}),this.fetchAppResource=(e,t)=>Ft(this,void 0,void 0,function*(){const i=this.getSession();return yield function(e,t){return Et(this,void 0,void 0,function*(){return Bt("getItemResource",e)(e.id,t,Ut(e))})}({id:e,isLocalApp:window.jimuConfig.isDevEdition},Object.assign({authentication:i},t)).catch(e=>Ft(this,void 0,void 0,function*(){return console.log(e),yield Promise.reject(new Error(null))}))}),this.clearResources=(e,t)=>{this.clearResourceMap(),this.clearResourcesWithoutSaved(e,t)},this.updateImageResourceItemInfo=e=>{const t=this.getAppId();this.getImageResourceListFromDraft(t).then(t=>{const i=Object.assign({},e);delete i.blobUrl,delete i.type,t[i.fileName.split(".")[0]]=i,this.setResourcesInDraft({imageResources:t})})}}static getInstance(){return Gt._instance||(Gt._instance=new Gt,window._appResourceManager=Gt._instance),window._appResourceManager}static assignBlobUrlToResourceItem(e){return Ft(this,void 0,void 0,function*(){try{const t=window.URL.createObjectURL(e.file),{width:i,height:o}=yield zt.imageUtils.getImageOriginalSizeByUrl(t).catch(()=>({width:0,height:0}));return e.url=t,e.blobUrl=t,e.originalWidth=i,e.originalHeight=o,yield Promise.resolve(e)}catch(e){return yield Promise.reject(new Error(e))}})}static getBlobByBlobUrl(e){return Ft(this,void 0,void 0,function*(){return yield new Promise((t,i)=>{const o=new XMLHttpRequest;o.responseType="blob",o.open("GET",e,!0),o.onerror=i,o.onload=()=>{200===o.status?t(o.response):i(new Error(null))},o.send()})})}static getResourcePrefix(e,t){const{resourcesPrefix:i,widgetId:o,type:n}=e;if(i)return i;return new Map([[r.ResourceType.Config,"config"],[r.ResourceType.Image,o?`images/${o}`:"images/templates"],[r.ResourceType.Translation,r.configTranslationUtils.getTranslationFilePath(t)]]).get(n)||"templates"}replaceBlobAndMatchResource(e){const t={};let i="";return r.utils.iterateDeepObject(e,(o,n,s,a)=>{var l;if("string"!=typeof o)return;const d=r.appConfigUtils.isFullReplace(e,n);let u=o;(d?r.appConfigUtils.fullMatchBlobUrl(o):r.appConfigUtils.matchBlobUrl(o))&&(u=d?$t(o,this.blobToResourceMap).newValue:(null===(l=this.blobToResourceMap[o])||void 0===l?void 0:l.resourceUrl)||o,a[s]=u);(d?r.appConfigUtils.fullMatchResourceUrl(u):r.appConfigUtils.matchResourceUrl(u))&&(d?i+=u:t[u]=u)}),{configSourceMap:t,fullMatchString:i}}addAppResource(e){return Ft(this,void 0,void 0,function*(){const t=this.getSession();return yield this.getAppInfo({id:e.appId,isLocalApp:window.jimuConfig.isDevEdition}).then(i=>Ft(this,void 0,void 0,function*(){return yield function(e){return Et(this,void 0,void 0,function*(){return Bt("addItemResource")(e)})}({id:e.appId,resource:e.file,name:e.fileName,owner:i.owner,params:{resourcesPrefix:e.resourcesPrefix},authentication:t}).then(t=>Ft(this,void 0,void 0,function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Success),yield Promise.resolve(t)}),t=>Ft(this,void 0,void 0,function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Error),yield Promise.reject(new Error(t))}))}))})}updateAppResource(e){return Ft(this,void 0,void 0,function*(){const t=this.getSession();return yield this.getAppInfo({id:e.appId,isLocalApp:window.jimuConfig.isDevEdition}).then(i=>Ft(this,void 0,void 0,function*(){return yield function(e){return Et(this,void 0,void 0,function*(){return Bt("updateItemResource")(e)})}({id:e.appId,resource:e.file,name:e.fileName,owner:i.owner,params:{resourcesPrefix:e.resourcesPrefix},authentication:t}).then(t=>Ft(this,void 0,void 0,function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Success),yield Promise.resolve(t)}),t=>Ft(this,void 0,void 0,function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Error),yield Promise.reject(new Error(t))}))}))})}removeAppResource(e){return Ft(this,void 0,void 0,function*(){const t=this.getSession(),i=e.appId?e.appId:this.getAppId();return yield this.getAppInfo({id:i,isLocalApp:window.jimuConfig.isDevEdition}).then(o=>Ft(this,void 0,void 0,function*(){return yield function(e){return Et(this,void 0,void 0,function*(){return Bt("removeItemResource")(e)})}({id:i,owner:o.owner,resource:e.fileName,authentication:t}).then(e=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(e)}),e=>Ft(this,void 0,void 0,function*(){return yield Promise.reject(new Error(e))}))}))})}getAppId(){var e;return null===(e=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appId}getSession(){return r.SessionManager.getInstance().getMainSession()}getPortalUrlWithFull(e){return function(e){const t=Ut(e)?r.urlUtils.getArcgisOnlineUrl():(0,r.getAppStore)().getState().portalUrl;return(null==e?void 0:e.isLocalApp)?rt()+"/apps/":r.portalUrlUtils.getPlatformUrlByOrgUrl(t)+"/sharing/rest/content/items/"}({isLocalApp:window.jimuConfig.isDevEdition})+e+"/resources"}setResourceMap(e,t){const{id:i,resourceUrl:o}=t;this.resourceMap[e]=Object.assign(Object.assign({},this.resourceMap[e]),t),this.blobToResourceMap[t.blobUrl]={id:i,resourceUrl:o}}setResourceItemInfoStatus(e,t){this.resourceMap&&this.resourceMap[e.id]&&(e.status=t,delete e.file,this.setResourceMap(e.id,e))}clearResourceMap(){for(const e in this.resourceMap)this.resourceMap[e]&&window.URL.revokeObjectURL(this.resourceMap[e].blobUrl);this.resourceMap={},this.blobToResourceMap={}}clearValueWithoutInResourcesInDraft(e,t){return Ft(this,void 0,void 0,function*(){if(this.getAppId()!==e&&Object.keys(this.resources).forEach(e=>{this.resources[e]=null}),t.length>0){const i=yield this.getImageResourceListFromDraft(e),o=yield this.getIconResourceListFromDraft(e),n=[...Object.values(i).map(({resourcesPrefix:e,fileName:t})=>`${e}/${t}`),...Object.values(o).map(({properties:{filename:e}})=>`images/icon_picker_in_setting/${e}`)],s=t.filter(e=>!n.includes(e));return yield Promise.resolve(s)}return yield Promise.resolve(t)})}clearResourcesWithoutSaved(e,t){return Ft(this,void 0,void 0,function*(){if(e)try{const i=this.getPortalUrlWithFull(e),o=`${r.appConfigUtils.APP_RESOURCE_URL}/`,{resources:n}=yield this.fetchAppResourceInfoList(e,{httpMethod:"GET"}),s=Oe(t),a=new RegExp("^"+i),l={};r.utils.iterateDeepObject(s,(e,t,i,o)=>{if("string"!=typeof e)return;const n=r.appConfigUtils.isFullReplace(s,t);if(n?r.appConfigUtils.fullMatchResourceUrl(e):r.appConfigUtils.matchResourceUrl(e)||a.test(e))if(n){const t=r.appConfigUtils.getResourceUrlsInString(e);for(const e of t)l[e]=e}else l[e]=e});const d=[];null==n||n.forEach(({resource:e})=>{e===Wt.Config||e===Wt.Image||e===Wt.Icon||l[o+e.replace("_compress","")]||l[i+e.replace("_compress","")]||r.configTranslationUtils.isTranslationFile(e,!0)||r.configTranslationUtils.isTranslationFile(e,!1)||d.push(e)});const u=(yield this.clearValueWithoutInResourcesInDraft(e,d)).map(t=>this.removeAppResource({appId:e,fileName:t}));Promise.all(u)}catch(e){console.error(e)}})}formatRelatedImageResources(e,t){const i={},o={},n=[];for(let e=0;e<t.length;e++){const i=t[e].fileName.split(".")[0];n.push(i)}return Object.keys(e).forEach(t=>{e[t].referredIds=[];const i=e[t].originId;n.includes(t)&&(o[t]=e[t]),n.includes(i)&&(o[i]=e[i])}),Object.keys(o).forEach(e=>{o[e].referredIds=[];const t=o[e].originId;t!==e&&(i[t]?i[t].referredIds.push(e):(i[t]=Object.assign({},o[t]),i[t].referredIds=[e]))}),Object.keys(i).forEach(e=>{o[e]&&(o[e].referredIds=i[e].referredIds)}),o}checkResourcesUploadStatus(e){return Ft(this,void 0,void 0,function*(){if(e.length>0){const t=e.map(e=>this.resourceMap[e].promise);return yield Promise.all(t).then(()=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(r.AjaxState.Success)}),()=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(r.AjaxState.Error)})).catch(e=>Ft(this,void 0,void 0,function*(){return console.error(e),yield Promise.reject(new Error(null))}))}return yield Promise.resolve(r.AjaxState.Success)})}uploadResourceList(e){return Ft(this,arguments,void 0,function*(e,t={},i){const o=i||this.getAppId(),n=yield this.uploadLocalResource(t),s=new Blob([JSON.stringify(n)],{type:"application/json"}),[a,l]=e.split("/"),d={appId:o,file:s,resourcesPrefix:a,fileName:l,type:r.ResourceType.Image};return yield this.uploadAppResource(d).then(()=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(n)})).catch(e=>Ft(this,void 0,void 0,function*(){return yield Promise.reject(new Error(e))}))})}getAppInfo(e){return Ft(this,void 0,void 0,function*(){const t=function(e){if(Ot(e))return{};const t=r.SessionManager.getInstance().getMainSession();return jt(e)?t:{}}(e);return yield function(e,t){return Et(this,void 0,void 0,function*(){return Bt("getItem",e)(e.id,t,Ut(e))})}(e,{authentication:t}).then(e=>Ft(this,void 0,void 0,function*(){return yield Promise.resolve(e)}))})}}var Nt=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function Ht(e,t,i){(null==e?void 0:e.config)&&r.appConfigUtils.fixLayoutIds(e.config);const o=t?r.i18n.getIntl(t,"setting"):r.i18n.getIntl();return e=r.utils.replaceI18nPlaceholdersInObject(e,o,i)}const Vt=e=>Nt(void 0,void 0,void 0,function*(){const t=r.moduleLoader.resolveModuleFullPath("templates/"),i=yield fetch(`${t}templates-info.json`).then(e=>e.json());if(i[e]){const t=i[e].filter(e=>e.tags&&e.tags.includes("WAB classic")).map(e=>e.name);return Promise.resolve(t)}return Promise.resolve([])});function qt(e){bi(`to_app.${Je.AppConfigChanged}`,e)}function Kt(e){bi(`to_app.${Je.AppInfoChanged}`,e)}function Jt(e){bi(`to_app.${Je.DialogInfosChanged}`,e)}function Yt(e){bi(`to_app.${Je.ChangeAppMode}`,e)}function Qt(e){bi(`to_app.${Je.ChangePage}`,e)}function Zt(e){bi(`to_app.${Je.ChangeDialog}`,e)}function Xt(e){bi(`to_app.${Je.ChangeSelection}`,e)}function ei(e){bi(`to_app.${Je.ChangeWidgetStateProp}`,e)}function ti(e,t,i){bi(`to_app.${Je.UtilityStateChanged}`,{utilityId:e,state:t,isSignInError:i})}function ii(e){bi(`to_app.${Je.BuilderTriggerKeyboard}`,e)}function oi(e){bi(`to_app.${Je.ChangeBrowserSizeMode}`,e)}function ni(){bi(`to_app.${Je.BuilderSessionChanged}`,r.SessionManager.getInstance().getSessions())}function si(){bi(`to_app.${Je.BuilderNoPermissionResourceInfoListChanged}`,r.SessionManager.getInstance().getNoPermissionResourceInfoList())}function ai(e){bi(`to_app.${Je.ChangeZoomScale}`,e)}function ri(e){bi(`to_app.${Je.ActivePagePartChanged}`,e)}function li(e){bi(`to_app.${Je.AnimationPreview}`,e)}function di(e){bi(`to_app.${Je.HoverPreview}`,e)}function ui(e,t){bi(`to_app.${Je.SectionNavInfoChanged}`,{sectionId:e,navInfo:t})}function ci(e,t){bi(`to_app.${Je.ScreenGroupNavInfoChanged}`,{screenGroupId:e,activeIndex:t})}function pi(e,t){bi(`to_app.${Je.TocHoverInfoChanged}`,{layoutInfo:e,hovered:t})}function gi(e){bi(`to_app.${Je.SetClientIdAlertIsCancelled}`,{portalUrl:e})}function hi(e){bi(`to_app.${Je.OpenCookieBanner}`,{isOpen:e})}function fi(e){bi(`to_app.${Je.OpenCookieBannerByPrivacyPanel}`,{isOpen:e})}function yi(e){bi(`to_app.${Je.OpenCookieSettingsWindow}`,{isOpen:e})}function vi(e,t){bi(`to_app.${Je.WidgetToolbarStateChange}`,{widgetId:e,toolNames:t})}function mi(e,t){bi(`to_app.${Je.SetWidgetIsInlineEditingState}`,{widgetId:e,isInlineEditing:t})}function Ii(e,t,i){bi(`to_app.${Je.WidgetStateChange}`,{widgetId:e,prop:t,value:i})}function wi(e,t,i){bi(`to_app.${Je.WidgetRuntimeInfoChange}`,{widgetId:e,prop:t,value:i})}function Ci(e){bi(`to_app.${Je.RuntimeThemeModeChange}`,e)}function Si(e,t){bi(`to_app.${Je.ChangeDynamicStylePreviewConditionInfo}`,{widgetId:e,value:t})}function bi(e,t){window._builderPubsub.publishSync(e,t)}function Pi(){window._builderPubsub.subscribe(`to_builder.${Ye.AppSessionChanged}`,(e,t)=>{r.SessionManager.getInstance().syncSessionsFromOtherWindow(t)}),window._builderPubsub.subscribe(`to_builder.${Ye.AppNoPermissionResourceInfoListChanged}`,(e,t)=>{r.SessionManager.getInstance().syncNoPermissionResourceInfoListFromOtherWindow(t)}),window._builderPubsub.subscribe(`to_builder.${Ye.NeedToCheck498Error}`,(e,t)=>{r.SessionManager.getInstance().handleInvalidToken(t)}),window._builderPubsub.subscribe("to_builder",function(e,t){console.debug(e,t)}),window._builderPubsub.subscribe(`to_builder.${Ye.AppStateChanged}`,(e,t)=>{var i;if((0,r.getAppStore)().getState().builder.currentAppId!==t.appId&&((0,r.getAppStore)().dispatch(y.changeCurrentApp(t.appId)),(0,r.getAppStore)().dispatch(qe.InBuilderAppConfigClear()),(0,r.getAppStore)().getState().queryObject.id!==t.appId&&r.jimuHistory.changeQueryObject({id:t.appId})),!(0,r.getAppStore)().getState().appStateInBuilder||(0,r.getAppStore)().getState().appStateInBuilder.appConfig!==t.appConfig){const e=t.appConfig,o=null===(i=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===i?void 0:i.appConfig;if(e&&o){if(Object.keys(e.widgets||{}).find(t=>e.widgets[t]&&o.widgets[t]&&e.widgets[t].version!==o.widgets[t].version))return void(0,r.getAppStore)().dispatch(Ne.inAppAppStateChanged(t));const i=Object.keys(o.widgets).filter(t=>!e.widgets[t]);(0,r.getAppStore)().dispatch(y.widgetsRemoved(i));const n=Object.keys(e.widgets).filter(e=>!o.widgets[e]).map(t=>({widgetId:t,widgetUri:e.widgets[t].uri}));(0,r.getAppStore)().dispatch(y.widgetsAdded(n))}if(e&&!o)if(r.GuideManager.getInstance().showTemplateGuide(),r.utils.isExpressMode()){const t=e.template;Vt("app").then(e=>{e.includes(t)&&r.GuideManager.getInstance().startGuide({id:`general-express-mode-${t}`,type:r.GuideTypes.Program,level:r.GuideLevels.Builder},!0)})}else r.GuideManager.getInstance().startGuide({id:"opening-tour",type:r.GuideTypes.Program,level:r.GuideLevels.Builder},!0);t.appConfig&&(0,r.getAppStore)().dispatch(qe.InBuilderPutAppConfigIntoHistory({appConfig:t.appConfig,appInfo:t.appInfo}))}(0,r.getAppStore)().dispatch(Ne.inAppAppStateChanged(t))}),window._builderPubsub.subscribe(`to_builder.${Ye.AppAddResource}`,(e,t)=>{const i=Gt.getInstance();Gt.getBlobByBlobUrl(t.file).then(e=>{t.file=e,i.uploadAppResource(t),t.type===r.ResourceType.Image&&t.originId&&Gt.getInstance().updateImageResourceItemInfo(t)})}),window._builderPubsub.subscribe(`to_builder.${Ye.AppTriggerKeyboard}`,(e,t)=>{r.keyboardUtils.triggerEvent(t)}),window._builderPubsub.subscribe(`to_builder.${Ye.ConfirmDelete}`,(e,t)=>{(0,r.getAppStore)().dispatch(y.confirmDeleteContentChanged(t))}),window._builderPubsub.subscribe(`to_builder.${Ye.NeedToRegisterClinetId}`,(e,t)=>{(0,r.getAppStore)().dispatch(r.appActions.addToRegisterClientIdList(t.portalUrl,t.needToSignIn,t.serviceUrl,t.forceLogin))}),window._builderPubsub.subscribe(`to_builder.${Ye.AppIsLoaded}`,(e,t)=>{var i;const o=(0,r.getAppStore)().getState(),n={portalUrl:o.portalUrl,clientId:o.clientId,isWebTier:o.isWebTier};bi(`to_app.${Je.SetMainPortal}`,n),(0,r.observeStore)((e,t)=>{bi(`to_app.${Je.SetMainPortal}`,{portalUrl:t})},["portalUrl"]),(0,r.getAppStore)().getState().portalSelf&&bi(`to_app.${Je.PortalSelfChanged}`,(0,r.getAppStore)().getState().portalSelf),(0,r.observeStore)((e,t)=>{bi(`to_app.${Je.PortalSelfChanged}`,t)},["portalSelf"]),r.portalUtils.getAppInfo(null===(i=(0,r.getAppStore)().getState().queryObject)||void 0===i?void 0:i.id).then(e=>{if(window.isExpressBuilder&&!e.typeKeywords.includes(r.CONSTANTS.TYPE_KEYWORDS_OF_EXPRESS_APP)){const e=(0,r.getAppStore)().getState().queryObject.without("mode"),t=new URL(window.location.href);t.search=r.queryString.stringify(e),window.location.href=t.toString()}else if(!window.isExpressBuilder&&e.typeKeywords.includes(r.CONSTANTS.TYPE_KEYWORDS_OF_EXPRESS_APP)){const e=(0,r.getAppStore)().getState().queryObject.set("mode","express"),t=new URL(window.location.href);t.search=r.queryString.stringify(e),window.location.href=t.toString()}bi(`to_app.${Je.AppInfoChanged}`,e)}),(0,r.getAppStore)().getState().user&&bi(`to_app.${Je.UserSignIn}`,(0,r.getAppStore)().getState().user),ni()})}var Ai=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function Li(e=void 0){return window.jimuConfig.isInBuilder?window.parent._getAppConfigAction(e):(e||(e=function(){const e=(0,r.getAppStore)().getState();return window.jimuConfig.isBuilder?e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig:e&&e.appConfig}()),new Mi(e))}window._getAppConfigAction=Li;class Mi{constructor(e){this.clearDeletedWidgetMessageAction=(e,t)=>{this.getDeletedWidgetsMessageConfigs(e,t).forEach(e=>{this.removeMessageAction(e)})},this.getDeletedWidgetsMessageConfigs=(e,t)=>{const i=e.messageConfigs,o=t.messageConfigs,n=[];if(!i)return n;const s=Object.keys(i),a=Object.keys(o);for(let e=0;e<s.length;e++)a.includes(s[e])||n.push(i[s[e]]);return n},this.removeMessageAction=e=>{var t;null===(t=null==e?void 0:e.actions)||void 0===t||t.forEach(t=>{const i=P.getInstance().getAction(t.widgetId,t.actionName);i&&i.onRemoveListen(e.messageType,e.widgetId)})},this.appConfig=e}setAppConfig(e){return this.appConfig=e,this}exec(e=!1){if(!window.jimuConfig.isBuilder&&!window.jimuConfig.isInBuilder)return void(0,r.getAppStore)().dispatch(r.appActions.appConfigChanged(this.appConfig));r.ExtensionManager.getInstance().getExtensions(r.extensionSpec.ExtensionPoints.AppConfigOperations).sort((e,t)=>e.index-t.index).forEach(e=>{if(e.appConfigWillChange)try{this.appConfig=e.appConfigWillChange(this.appConfig)}catch(e){console.error("Error in appConfigWillChange.",e)}}),(0,r.getAppStore)().dispatch({type:"IN_BUILDER_APPCONFIG_REDOCLEAR"}),e&&(0,r.getAppStore)().dispatch(qe.InBuilderRemoveLastAppConfigFromHistory()),qt(this.appConfig);const t=(0,r.getAppStore)().getState().appStateInBuilder.appConfig,i=this.appConfig,o=Object.keys(t.widgets).filter(e=>!i.widgets[e]);(0,r.getAppStore)().dispatch(y.widgetsRemoved(o)),this.clearDeletedWidgetMessageAction(t,i);const n=Object.keys(i.widgets).filter(e=>!t.widgets[e]).map(e=>({widgetId:e,widgetUri:i.widgets[e].uri}));(0,r.getAppStore)().dispatch(y.widgetsAdded(n));const s=(0,r.getAppStore)().getState().appStateInBuilder.appInfo;return(0,r.getAppStore)().dispatch(Ne.inBuilderAppConfigChanged(this.appConfig)),(0,r.getAppStore)().dispatch(qe.InBuilderPutAppConfigIntoHistory({appConfig:this.appConfig,appInfo:s})),this}editWidgetConfig(e,t){return this.appConfig.widgets[e]?(this.appConfig=this.appConfig.setIn(["widgets",e,"config"],t),this):this}editWidget(e,t){if(!this.appConfig.widgets[e.id])return this;this.handleWidgetUseDataSourceChange(this.appConfig.widgets[e.id],e);const i=this.appConfig.widgets[e.id];let o=i;return t&&(t.forEach(e=>{e.isOutputFromWidget||(e.isOutputFromWidget=!0)}),o=o.set("outputDataSources",t.map(e=>e.id))),Object.keys(e).forEach(t=>{null===e[t]&&("outputDataSourcesJson"===t&&e.outputDataSources&&e.outputDataSources.forEach(e=>this.removeDataSource(e)),o=o.without(t),delete e[t])}),i.outputDataSources&&i.outputDataSources.forEach(e=>{o.outputDataSources&&o.outputDataSources.includes(e)||this.removeDataSource(e)}),o.outputDataSources&&o.outputDataSources.forEach(e=>{const o=t&&t.find(t=>t.id===e);if(o)if(i.outputDataSources&&i.outputDataSources.includes(e)){let t=this.appConfig.dataSources[e];if(!t)return void console.error("Unknown error. Widget output data source is not in data source json.",e);Object.keys(o).forEach(e=>{null===o[e]&&(t=t.without(e),delete o[e])}),this.editDataSource(t.merge(o))}else this.addDataSource((0,r.Immutable)(o))}),o=o.merge(e),this.appConfig=this.appConfig.setIn(["widgets",e.id],o),e.useDataSources&&o.layouts&&o.manifest.properties.passDataSourceToChildren&&this.copyUseDataSourceToAllChildWidgets(i,o),this}editWidgetProperty(e,t,i){if(!this.appConfig.widgets||!this.appConfig.widgets[e])return this;if("outputDataSources"===t)return console.error("Please use editWidget to update outputDataSources."),this;const o=this.appConfig.widgets[e],n=this.editJsonProperty(o,t,i);return o===n?this:(this.appConfig=this.appConfig.setIn(["widgets",e],n),t.includes(".")?this:this.editWidget({id:e,[t]:i}))}createWidget(e){return Ai(this,arguments,void 0,function*(e,t=!0){try{const i=yield G.getInstance().handleNewWidgetJson(e),o=te.createWidget(this.appConfig,i,[A.utils.getCurrentSizeMode()],t);this.appConfig=o[0];const n=o[1];return this.appConfig.widgets[n]}catch(e){console.error(e)}return null})}removeWidget(e){return this.appConfig=te.remove(this.appConfig,e),this}editControllerPanel(e,t){return this.appConfig=this.appConfig.setIn(["controllerPanels",e],t),this}removeControllerPanel(e){var t;return(null===(t=this.appConfig.controllerPanels)||void 0===t?void 0:t[e])&&(this.appConfig=this.appConfig.set("controllerPanels",this.appConfig.controllerPanels.without(e))),this}removeLayoutFromWidget(e,t){var i,o,n;return(null===(i=this.appConfig.widgets[e])||void 0===i?void 0:i.layouts)&&(null===(o=this.appConfig.widgets[e])||void 0===o?void 0:o.layouts[t])?(Object.keys(null===(n=this.appConfig.widgets[e])||void 0===n?void 0:n.layouts[t]).forEach(i=>{var o;const n=null===(o=this.appConfig.widgets[e])||void 0===o?void 0:o.layouts[t][i];this.removeLayout(n)}),this.appConfig=this.appConfig.setIn(["widgets",e,"layouts"],this.appConfig.widgets[e].layouts.without(t)),this):this}createSection(){const e=re.createSection(this.appConfig,[A.utils.getCurrentSizeMode()]);this.appConfig=e[0];const t=e[1];return this.appConfig.sections[t]}editSectionProperty(e,t,i){let o=this.appConfig.sections[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["sections",e],o),this):this}editViewProperty(e,t,i){let o=this.appConfig.views[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["views",e],o),this):this}addView(e){var t;let i;const o=this.appConfig.sections[e];if((null===(t=o.views)||void 0===t?void 0:t.length)>0){const e=o.views[0],t=this.appConfig.views[e];i=Object.keys(t.layout)}else{const{type:t,id:o}=A.searchUtils.getContentRootContainerInfo(this.appConfig,e,r.LayoutItemType.Section,A.utils.getCurrentSizeMode());t===r.ContainerType.Header||t===r.ContainerType.Footer?i=Object.keys(this.appConfig[o].layout):t===r.ContainerType.Page?i=Object.keys(this.appConfig.pages[o].layout):t===r.ContainerType.Dialog&&(i=Object.keys(this.appConfig.dialogs[o].layout))}const n=re.addView(this.appConfig,e,i);return this.appConfig=n[0],n[1]}duplicateView(e,t,i){const o={},n=this.appConfig.sections[t],s=this.appConfig.views[n.views[0]],a=Object.keys(s.layout),r=re.duplicateView(this.appConfig,t,e,a,i,o);this.appConfig=r[0];const l=r[1];return this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,o),this.appConfig.views[l]}removeView(e,t){return this.appConfig=re.removeView(this.appConfig,t,e),this}moveViewInSection(e,t,i,o){if(!(this.appConfig.sections&&this.appConfig.sections[e]&&this.appConfig.views&&this.appConfig.views[t]&&this.appConfig.views[i]))return this;if(i===t)return console.error("viewId is same to targetViewId."),this;let n=this.appConfig.sections[e].views.asMutable();n=n.filter(e=>e!==t);let s=n.indexOf(i);return"below"===o&&s++,n=n.slice(0,s).concat(t).concat(n.slice(s)),this.appConfig=this.appConfig.setIn(["sections",e,"views"],n),this}createScreenGroup(){const e=Se("screenGroup"),t=be(this.appConfig,"screenGroup",r.i18n.getIntl().formatMessage({id:"screenGroup"})),i=(0,r.Immutable)({id:e,label:t,screens:[],transitionType:r.ScreenTransitionType.Fade});return this.appConfig=this.appConfig.setIn(["screenGroups",i.id],i),i}editScreenGroupProperty(e,t,i){let o=this.appConfig.screenGroups[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["screenGroups",e],o),this):this}editScreenProperty(e,t,i){let o=this.appConfig.screens[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["screens",e],o),this):this}moveScreenInGroup(e,t,i,o){var n;if(!(null===(n=this.appConfig.screenGroups)||void 0===n?void 0:n[e])||t===i)return this;const s=this.appConfig.screenGroups[e].screens.asMutable(),a=s[t],r=s[i];s.splice(t,1);const l=s.indexOf(r);return"below"===o?s.splice(l,1,r,a):s.splice(l,1,a,r),this.appConfig=this.appConfig.setIn(["screenGroups",e,"screens"],s),this}removeScreenByIndex(e,t){var i,o;const n=null===(o=null===(i=this.appConfig.screenGroups)||void 0===i?void 0:i[t])||void 0===o?void 0:o.screens,s=null==n?void 0:n[e];return this.removeScreen(s,t)}removeScreen(e,t,i=!1){return this.appConfig=ge.removeScreen(this.appConfig,t,e),this}duplicateScreenByIndex(e,t,i=!0){var o,n;const s=null===(n=null===(o=this.appConfig.screenGroups)||void 0===o?void 0:o[t])||void 0===n?void 0:n.screens,a=null==s?void 0:s[e];return this.duplicateScreen(a,t,i)}duplicateScreen(e,t,i=!0){const o={},n=this.appConfig.screenGroups[t],s=this.appConfig.screens[n.screens[0]],a=Object.keys(s.main.layout),r=ge.duplicateScreen(this.appConfig,t,e,a,i,o);this.appConfig=r[0];const l=r[1];return this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,o),this.appConfig.screens[l]}editPageProperty(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;let o=this.appConfig.pages[e];return o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["pages",e],o),this}addPage(e){return this.appConfig.pages&&this.appConfig.pages[e.id]||(this.appConfig=this.appConfig.setIn(["pages",e.id],e),this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[e.id]:[]}]))),this}duplicatePage(e,t=!1){if(!this.appConfig.pages||!this.appConfig.pages[e])return null;let i=this.appConfig.pages[e].set("id",Se("page"));if(i=i.set("label",this.getDuplicateLabel("page",i.label)),this.appConfig=this.appConfig.setIn(["pages",i.id],i),i.isDefault&&(i=i.set("isDefault",!1)),i.type!==r.PageType.Link&&i.type!==r.PageType.Folder){const t={},o=x.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,r.LayoutParentType.Page,i.id,t);this.appConfig=o[0],i=i.set("layout",o[1]),t[e]=i.id,this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,t)}const o=this.appConfig.pageStructure.find(t=>!!t[e]),n=[];if(o&&o[e].forEach(e=>{const t=this.duplicatePage(e,!0);n.push(t.id)}),!t)if(o){if(this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[i.id]:[]}])),n.length>0){const e=i.id;let t=this.appConfig.pageStructure.length-1;t<0&&(t=0),this.appConfig=this.appConfig.setIn(["pageStructure",t+"",e],n)}}else this.appConfig.pageStructure.some((t,o)=>{const n=Object.keys(t).find(i=>t[i].includes(e));return!!n&&(this.appConfig=this.appConfig.setIn(["pageStructure",o+"",n],this.appConfig.pageStructure[o][n].concat(i.id)),!0)});return this.appConfig=this.appConfig.setIn(["pages",i.id],i),i}movePageIntoPage(e,t){return this.appConfig.pages&&this.appConfig.pages[e]&&this.appConfig.pages[t]?e===t?(console.error("SubPage is same to ParentPage."),this):Le(this.appConfig,t)?Me(this.appConfig,e)?(console.error("SubPage has sub page(s)."),this):(this.removePageFromPageStructure(e),this.movePageIntoPageForPageStructure(e,t),this):(console.error("ParentPage is not on the first aspect."),this):this}orderPageToPage(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[t]||!this.appConfig.pages[e])return this;if(t===e)return console.error("pageId is same to targetPageId."),this;const o=!Le(this.appConfig,t);if((Me(this.appConfig,e)||this.appConfig.pages[e].type===r.PageType.Folder)&&o)return console.error("page structure allow two aspects only"),this;const n=this.appConfig.pageStructure.find(t=>!!t[e]);return this.removePageFromPageStructure(e),o?this.appConfig.pageStructure.some((o,n)=>{const s=Object.keys(o)[0];let a=o[s].indexOf(t);if(a>-1){let t=this.appConfig.pageStructure[n][s];return"bottom"===i&&(a+=1),t=t.slice(0,a).concat([e]).concat(t.slice(a)),this.appConfig=this.appConfig.setIn(["pageStructure",n+"",s],t),!0}return!1}):this.appConfig.pageStructure.some((o,s)=>{if(Object.keys(o)[0]===t){"bottom"===i&&(s+=1);const t=this.appConfig.pageStructure.slice(0,s).concat([n||{[e]:[]}]).concat(this.appConfig.pageStructure.slice(s));return this.appConfig=this.appConfig.set("pageStructure",t),!0}return!1}),this}updatePageRestrictionsAfterRemovePage(){var e;const t=this.appConfig.getIn(["permission","restrictions"])||(0,r.Immutable)([]),i=Object.keys(this.appConfig.pages||{});let o=t.map(e=>{var t;const o=null===(t=e.pageIds)||void 0===t?void 0:t.filter(e=>i.some(t=>e===t));return o.length>0?e.set("pageIds",o):null});o=o.filter(e=>e),this.appConfig=null===(e=this.appConfig)||void 0===e?void 0:e.setIn(["permission","restrictions"],o)}removePage(e,t){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;const i=this.appConfig.pages[e];if(i.type!==r.PageType.Folder&&i.type!==r.PageType.Link){const e=x.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=e.removeSizeModeLayouts(this.appConfig,i.layout)}const{pageStructure:o}=this.appConfig,n=o&&o.find(t=>!!t[e]);return n&&n[e].length>0&&n[e].forEach(e=>{this.removePage(e)}),this.removePageFromPageStructure(e),this.appConfig=this.appConfig.set("pages",this.appConfig.pages.without(e)),this.updatePageRestrictionsAfterRemovePage(),t&&this.setHomePage(t),this}setHomePage(e){return this.editPageProperty(e,"isDefault",!0)}setUseAutoSortInFixedLayout(e){return this.appConfig=this.appConfig.set("useAutoSortInFixedLayout",e),this}replaceHomePage(e){return Object.keys(this.appConfig.pages).some((e,t)=>{const i=this.appConfig.pages[e];return!!i.isDefault&&(this.editPageProperty(i.id,"isDefault",!1),!0)}),this.editPageProperty(e,"isDefault",!0)}editDialog(e){const t=this.appConfig.dialogs[e.id].mode;if(t!==e.mode){const i=this.appConfig.dialogs.asMutable({deep:!0});Object.keys(i).forEach(o=>{const n=i[o];n.id===e.id?i[o]=Object.assign({},e.asMutable({deep:!0}),{index:Object.keys(i).filter(e=>i[e].mode!==t).length}):n.mode===t&&n.index>e.index&&(n.index=n.index-1)}),this.appConfig=this.appConfig.set("dialogs",(0,r.Immutable)(i))}else this.appConfig=this.appConfig.setIn(["dialogs",e.id],e);return this}editDialogProperty(e,t,i){if(!this.appConfig.dialogs||!this.appConfig.dialogs[e])return this;let o=this.appConfig.dialogs[e];return o=this.editJsonProperty(o,t,i),this.editDialog(o)}removeDialog(e){var t;const i=null===(t=this.appConfig.dialogs)||void 0===t?void 0:t[e];if(!i)return this;const o=x.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=o.removeSizeModeLayouts(this.appConfig,i.layout);const n=i.mode,s=i.index,a=this.appConfig.dialogs.without(e).asMutable({deep:!0});return Object.keys(a).forEach(e=>{const t=a[e];t.mode===n&&t.index>s&&(t.index=t.index-1)}),this.appConfig=this.appConfig.set("dialogs",(0,r.Immutable)(a)),this}duplicateDialog(e){const t=this.appConfig.dialogs;let i=t[e];if(!t||!i)return null;const o=Se("dialog"),n={},s=x.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,r.LayoutParentType.Dialog,o,n);this.appConfig=s[0];const a=s[1];n[e]=o,this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,n);const l=Object.keys(Object.keys(t).filter(e=>t[e].mode===i.mode)).length;return i=i.set("id",o).set("index",l).set("isSplash",!1).set("label",this.getDuplicateLabel("dialog",i.label)).set("layout",a),this.appConfig=this.appConfig.setIn(["dialogs",i.id],i),i}orderDialogToDialog(e,t,i){const o=this.appConfig.dialogs.asMutable({deep:!0}),n=o[e],s=o[t];if(!o||!n||!s)return this;if(t===e)return console.error("dialogId is same to targetDialogId."),this;let a;return s.index>n.index?(a="top"===i?s.index-1:s.index,Object.keys(o).forEach(t=>{const i=o[t];i.mode===s.mode&&i.id!==e&&i.index>n.index&&i.index<=a&&(i.index=i.index-1)})):(a="top"===i?s.index:s.index+1,Object.keys(o).forEach(t=>{const i=o[t];i.mode===s.mode&&i.id!==e&&i.index>=a&&i.index<n.index&&(i.index=i.index+1)})),o[e]=Object.assign({},n,{index:a,mode:s.mode}),this.appConfig=this.appConfig.set("dialogs",(0,r.Immutable)(o)),this}replaceSplashDialog(e,t){return t&&this.editDialogProperty(t,"isSplash",!1),e!==t?this.editDialogProperty(e,"isSplash",!0):this}createLayoutForSizeMode(e,t,i,o,n,s){var a;if(!i||!i[t]||i[e])return null;const l=i[t],d=x.getService(this.appConfig,l).duplicateLayout(this.appConfig,i[t],t,e,{},!1);if(d[1]){this.appConfig=d[0];const t=d[1];this.appConfig=this.appConfig.setIn(["layouts",t,"parent"],{id:n,type:o});const l=i.set(e,t);switch(o){case r.LayoutParentType.Dialog:this.appConfig=this.appConfig.setIn(["dialogs",n,"layout"],l);break;case r.LayoutParentType.Page:this.appConfig=this.appConfig.setIn(["pages",n,"layout"],l);break;case r.LayoutParentType.Header:this.appConfig=this.appConfig.setIn(["header","layout"],l);break;case r.LayoutParentType.Footer:this.appConfig=this.appConfig.setIn(["footer","layout"],l);break;case r.LayoutParentType.Screen:this.appConfig=this.appConfig.setIn(["screens",n,"layout"],l);break;case r.LayoutParentType.View:this.appConfig=this.appConfig.setIn(["views",n,"layout"],l);break;case r.LayoutParentType.Widget:{const e=this.appConfig.widgets[n];(null===(a=null==e?void 0:e.layouts)||void 0===a?void 0:a[s])&&(this.appConfig=this.appConfig.setIn(["widgets",n,"layouts",s],l));break}}return l}return null}removeSizeModeLayout(e,t){const i=x.getService(this.appConfig,e);return this.appConfig=i.removeLayout(this.appConfig,e,t),this}addNewSectionToLayout(e){const t=this.createSection(),i=x.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=i[0];const o=i[1],n={layoutId:e,layoutItemId:o};return this.editLayoutItemProperty(n,"type",r.LayoutItemType.Section).editLayoutItemProperty(n,"sectionId",t.id),this.appConfig=re.addParent(this.appConfig,t.id,n,A.utils.getCurrentSizeMode()),o}addPlaceholderToLayout(e){const t=x.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],o={layoutId:e,layoutItemId:i};return this.editLayoutItemProperty(o,"type",r.LayoutItemType.Widget),this.appConfig=$.addAsSyncablePlaceholder(this.appConfig,o),i}addNewWidgetToLayout(e,t){return Ai(this,arguments,void 0,function*(e,t,i=!1){if(!i&&r.utils.isExpressMode())return;const o=yield this.createWidget(t,!0);if(o){const t=x.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],n={layoutId:e,layoutItemId:i};this.editLayoutItemProperty(n,"type",r.LayoutItemType.Widget,!0).editLayoutItemProperty(n,"widgetId",o.id,!0);const s=A.utils.getCurrentSizeMode();return this.appConfig=te.addParent(this.appConfig,o.id,n,s),this.appConfig=te.afterAdded(this.appConfig,o.id,e,s,s),i}return null})}addTemplateContentToLayout(e,t,i){const o=x.getService(this.appConfig,e).addContent(this.appConfig,e,i,t,A.utils.getCurrentSizeMode());return this.appConfig=o[0],{layoutId:e,layoutItemId:o[1]}}addContentToPlaceholder(e,t,i){var o;let n=[{layoutInfo:e,sizeMode:A.utils.getCurrentSizeMode()}];const s=$.getPlaceholderInfo(this.appConfig,e);return s&&(n=[{layoutInfo:s.layoutInfo,sizeMode:this.appConfig.mainSizeMode}],Object.keys(null!==(o=s.syncs)&&void 0!==o?o:{}).forEach(e=>{n.push({layoutInfo:s.syncs[e],sizeMode:e})})),n.forEach(o=>{var n;const{layoutInfo:s,sizeMode:a}=o,{layoutId:r}=s;this.editLayoutItemProperty(s,"type",t),this.appConfig=he.setContentId(this.appConfig,s,i,a);const l=A.searchUtils.findLayoutItem(this.appConfig,s),d=new me(this.appConfig,l);this.appConfig=d.afterAdded(r,a,a),(null===(n=l.setting)||void 0===n?void 0:n.placeholderStyle)&&this.editLayoutItemProperty(e,"setting",l.setting.without("placeholderStyle"))}),this}removeParentsOfOtherSizeModes(e,t,i){const o=A.searchUtils.findLayoutItem(this.appConfig,e);let n=[];const s=[];if(o.type===r.LayoutItemType.Widget){const e=o.widgetId,t=this.appConfig.widgets[e];(null==t?void 0:t.layouts)&&Object.keys(t.layouts).forEach(e=>{const o=t.layouts[e][i];s.push(o)})}else if(o.type===r.LayoutItemType.Section){const e=o.sectionId;this.appConfig.sections[e].views.forEach(e=>{const t=this.appConfig.views[e];s.push(t.layout[i])})}else if(o.type===r.LayoutItemType.ScreenGroup){const e=o.screenGroupId;this.appConfig.screenGroups[e].screens.forEach(e=>{const t=this.appConfig.screens[e];s.push(t.main.layout[i]),t.panel&&s.push(t.panel.layout[i])})}s.length>0&&s.forEach(e=>{const t=A.searchUtils.getContentsInLayoutRecursive(this.appConfig,e,r.LayoutItemType.Widget,i);n=n.concat(t)}),n.length>0&&n.forEach(e=>{t.forEach(t=>{t!==i&&(this.appConfig=te.removeSizeModeParent(this.appConfig,e,t))})})}duplicateLayoutItemInSameLayout(e){const{layoutId:t}=e,i=x.getService(this.appConfig,t),o={},n=A.utils.getCurrentSizeMode(),s=i.duplicateItemInSameLayout(this.appConfig,e,n,o);this.appConfig=s[0];const a=s[1];this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,o);const l=A.searchUtils.findLayoutItem(this.appConfig,{layoutId:t,layoutItemId:a}),d=new me(this.appConfig,l),u=[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small];return u.forEach(e=>{e!==n&&d.removeSizeModeParent(e)}),this.appConfig=d.getConfig(),this.removeParentsOfOtherSizeModes({layoutId:t,layoutItemId:a},u,n),s[1]}duplicateLayoutItemToOtherLayout(e,t){const i=A.searchUtils.findLayoutItem(this.appConfig,e),o=new me(this.appConfig,i),n={},s=A.utils.getCurrentSizeMode(),a=o.duplicate(s,n);this.appConfig=a[0];const l=a[1];this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,n),this.appConfig=te.removeParent(this.appConfig,l,e);const d=x.getService(this.appConfig,t).createBlankItem(this.appConfig,t);this.appConfig=d[0];const u=d[1],c={layoutId:t,layoutItemId:u};switch(this.editLayoutItemProperty(c,"type",i.type),i.type){case r.LayoutItemType.Widget:this.editLayoutItemProperty(c,"widgetId",l);break;case r.LayoutItemType.Section:this.editLayoutItemProperty(c,"sectionId",l);break;case r.LayoutItemType.ScreenGroup:this.editLayoutItemProperty(c,"screenGroupId",l)}const p=A.searchUtils.findLayoutItem(this.appConfig,c),g=new me(this.appConfig,p);g.addParent(c,s);const h=[r.BrowserSizeMode.Large,r.BrowserSizeMode.Medium,r.BrowserSizeMode.Small];h.forEach(e=>{e!==s&&g.removeSizeModeParent(e)}),this.appConfig=g.getConfig(),this.removeParentsOfOtherSizeModes(c,h,s);return Ae(this.appConfig,e.layoutId)===s&&s===this.appConfig.mainSizeMode&&(this.appConfig=$.afterLayoutItemCopied(this.appConfig,e,c)),u}syncPlaceholder(e,t,i){var o,n;const s=$.getPlaceholderInfo(this.appConfig,e);if(null===(o=null==s?void 0:s.syncs)||void 0===o?void 0:o[i]){const{layoutId:t,layoutItemId:o}=s.syncs[i];t===e.layoutId&&o===e.layoutItemId&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",s.id,"syncs"],s.syncs.without(i)))}return t>0&&(null===(n=this.appConfig.placeholderInfos)||void 0===n?void 0:n[t])&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",t,"syncs",i],e)),this}moveLayoutItem(e,t,i,o){const n=x.getService(this.appConfig,t).moveLayoutItem(this.appConfig,e,t,i,o);return this.appConfig=n[0],n[1]}setLayoutItemToPending(e,t){if(!A.searchUtils.findLayoutItem(this.appConfig,e))return this;if(t){const t=x.getService(this.appConfig,e.layoutId);this.appConfig=t.pendItem(this.appConfig,e)}else this.appConfig=this.appConfig.setIn(["layouts",e.layoutId,"content",e.layoutItemId,"isPending"],t);return this}removeLayoutItem(e,t,i){const o=x.getService(this.appConfig,e.layoutId);return this.appConfig=o.removeItem(this.appConfig,e,A.utils.getCurrentSizeMode(),t,i),this}removeLayout(e){return this.removeSizeModeLayout(e,A.utils.getCurrentSizeMode())}clearLayoutContent(e){var t;const i=this.appConfig.layouts[e];return i?(Object.keys(null!==(t=i.content)&&void 0!==t?t:{}).forEach(t=>{this.removeLayoutItem({layoutId:e,layoutItemId:t},!0,!1)}),this):this}duplicateLayout(e,t){if(!this.appConfig.layouts[e])return null;const i=x.getService(this.appConfig,e),o=A.utils.getCurrentSizeMode(),n={},s=i.duplicateLayout(this.appConfig,e,o,o,n,t);this.appConfig=s[0];const a=s[1];return t&&(this.appConfig=te.afterBatchCopied(this.appConfig,this.appConfig,n)),this.appConfig.layouts[a]}editLayoutProperty(e,t,i){let o=this.appConfig.layouts[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["layouts",e],o),this):this}editLayoutItemProperty(e,t,i,o=!1){if(!o&&r.utils.isExpressMode())return this;const{layoutId:n,layoutItemId:s}=e;let a=A.searchUtils.findLayoutItem(this.appConfig,e);return a?(a=this.editJsonProperty(a,t,i),this.appConfig=this.appConfig.setIn(["layouts",n,"content",s],a),this):this}editLabelOfTocNode(e,t){switch(e.type){case"view":return this.editViewProperty(e.id,"label",t);case"screen":return this.editScreenProperty(e.id,"label",t);case"widget":return this.editWidgetProperty(e.id,"label",t);case"section":return this.editSectionProperty(e.id,"label",t);case"screenGroup":return this.editScreenGroupProperty(e.id,"label",t);case"layoutItem":return this.editLayoutItemProperty({layoutId:e.layoutId,layoutItemId:e.layoutItemId},"label",t);default:return this}}editLayoutItemSize(e,t,i,o=!1){var n;if(!o&&r.utils.isExpressMode())return this;const{layoutId:s,layoutItemId:a}=e,l=this.appConfig.layouts[s],d=null===(n=null==l?void 0:l.content)||void 0===n?void 0:n[a];if(!l||!d)return this;let u=d.setting||(0,r.Immutable)({}),c=d.bbox;const p={width:t,height:i};return Object.keys(p).forEach(e=>{const t=p[e];"number"==typeof t?c=c.set(e,`${t}px`):"auto"===t?u=u.setIn(["autoProps",e],!1):c=c.set(e,t)}),this.editLayoutItemProperty(e,"bbox",c).editLayoutItemProperty(e,"setting",u)}exchangeWidthAndHeight(e=!1){var t,i,o,n,s;if(!e&&r.utils.isExpressMode())return this;let a;const l=(0,r.getAppStore)().getState();if(a=window.jimuConfig.isBuilder?null===(i=null===(t=null==l?void 0:l.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.selection:null===(o=null==l?void 0:l.appRuntimeInfo)||void 0===o?void 0:o.selection,!a)return this;const{layoutId:d}=a,u=this.appConfig.layouts[d];if((null==u?void 0:u.type)===r.LayoutType.FixedLayout){const e=A.searchUtils.findLayoutItem(this.appConfig,a);if(e){let t=e.bbox,i=!1,o=null!==(n=e.setting)&&void 0!==n?n:(0,r.Immutable)({});const l=null!==(s=o.autoProps)&&void 0!==s?s:{right:!0,bottom:!0};t=t.set("width",t.height).set("height",t.width),["left","right","top","bottom"].forEach(e=>{l[e]&&(t=t.without(e))}),this.editLayoutItemProperty(a,"bbox",t),null==l.width&&null==l.height||(o=o.setIn(["autoProps","width"],l.height).setIn(["autoProps","height"],l.width),i=!0),"ratio"===o.heightMode&&(o=o.set("heightMode","fixed"),i=!0),i&&this.editLayoutItemProperty(a,"setting",o)}}return this}adjustOrderOfItem(e,t,i=!1){if(!i&&r.utils.isExpressMode())return this;const{layoutId:o,layoutItemId:n}=e,s=this.appConfig.layouts[o];let a=[].concat(s.order||[]);if(null!=t&&t>=0&&t<=a.length){const e=a.indexOf(n);e>=0&&a.splice(e,1),a.splice(t,0,n)}else a.includes(n)&&(a=a.filter(e=>e!==n)),a.push(n);return this.appConfig=this.appConfig.setIn(["layouts",o,"order"],a),this}createLayout(e){const t=x.getInstance().getServiceByType(e).createBlankLayout(this.appConfig,e);return this.appConfig=t[0],t[1]}createPageFromTemplate(e){return Ai(this,void 0,void 0,function*(){const t={},i=yield ye.createPageFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const o=i[1];return this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(e.config),t),o})}createDialogFromTemplate(e){return Ai(this,void 0,void 0,function*(){const t={},i=yield ye.createDialogFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const o=i[1];return this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(e.config),t),o})}applyHeaderTemplate(e){return Ai(this,void 0,void 0,function*(){const t={};this.appConfig=yield ye.applyTemplateToHeader(this.appConfig,e,A.utils.getCurrentSizeMode(),t),this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(e.config),t)})}applyFooterTemplate(e){return Ai(this,void 0,void 0,function*(){const t={};this.appConfig=yield ye.applyTemplateToFooter(this.appConfig,e,A.utils.getCurrentSizeMode(),t),this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(e.config),t)})}applyPageBodyTemplate(e,t){return Ai(this,void 0,void 0,function*(){const i={};this.appConfig=yield ye.applyTemplateToBody(this.appConfig,e,t,A.utils.getCurrentSizeMode(),i),this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(t.config),i)})}applyDialogTemplate(e,t){return Ai(this,arguments,void 0,function*(e,t,i=A.utils.getCurrentSizeMode()){const o={};this.appConfig=yield ye.applyTemplateToDialog(this.appConfig,e,t,i,o),this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(t.config),o)})}applyGridTemplate(e,t){return Ai(this,void 0,void 0,function*(){const i={};this.appConfig=yield ye.applyGridTemplate(this.appConfig,e,t,A.utils.getCurrentSizeMode(),i),this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(t.config),i)})}createScreenFromTemplate(e,t){return Ai(this,void 0,void 0,function*(){const i={},o=yield ge.createScreenFromTemplate(this.appConfig,t,e,[A.utils.getCurrentSizeMode()],i);return this.appConfig=o[0],this.appConfig=te.afterBatchCopied(this.appConfig,(0,r.Immutable)(t.config),i),o[1]})}copyUseDataSourceToAllChildWidgets(e,t){const i=A.searchUtils.getChildrenContents(this.appConfig,t.id,r.LayoutItemType.Widget,!0),o=t.useDataSources&&t.useDataSources.map(e=>e.set("fields",[]))[0],n=e.useDataSources&&e.useDataSources.map(e=>e.set("fields",[]))[0];return o&&n&&o.dataSourceId===n.dataSourceId||i.forEach(e=>{let t=this.appConfig.widgets[e];const i=n&&t.useDataSources?t.useDataSources.find(e=>e.dataSourceId===n.dataSourceId):null,s=E(t.id);if((null==s?void 0:s.useDataSourceWillChange)&&(this.appConfig=s.useDataSourceWillChange(this.appConfig,null==n?void 0:n.dataSourceId,null==o?void 0:o.dataSourceId)),i&&(t=this.appConfig.widgets[e],t=t.set("useDataSources",t.useDataSources.filter(e=>e.dataSourceId!==n.dataSourceId))),o){let e=o;i&&(null==n?void 0:n.mainDataSourceId)===o.mainDataSourceId&&Object.keys(i).forEach(t=>{"dataViewId"===t||(Array.isArray(e[t])?0!==e[t].length:e[t])||(e=e.set(t,i[t]))}),t=t.set("useDataSources",t.useDataSources?t.useDataSources.concat(e):[e]).set("useDataSourcesEnabled",!0)}this.appConfig=this.appConfig.setIn(["widgets",e],t)}),this}addDataSource(e){return this.appConfig=D.addDataSource(this.appConfig,e),this}addDataSources(e){return e.forEach(e=>{this.appConfig.dataSources&&this.appConfig.dataSources[e.id]||(this.appConfig=this.appConfig.setIn(["dataSources",e.id],e))}),this}addUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,r.Immutable)({});return i=i.set(e.id,e),this.appConfig=this.appConfig.set("utilities",i),this}removeUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,r.Immutable)({});const o=k();try{o.forEach(t=>{if(!t.utilityWillRemove)return;const i=this.appConfig.widgets[t.widgetId];i&&i.useUtilities&&i.useUtilities.find(t=>t.utilityId===e)&&(this.appConfig=t.utilityWillRemove(this.appConfig,e))})}catch(e){console.error("Error when calling utilityWillRemove",e)}return i=i.without(e),this.appConfig=this.appConfig.set("utilities",i),this}updateUtilities(e){return this.appConfig=this.appConfig.set("utilities",e),this}removeDataSource(e){return this.appConfig=D.removeDataSource(this.appConfig,e),this}removeUseDataSource(e){return this.appConfig=D.removeUseDataSource(this.appConfig,e),this}editDataSource(e){var t;const i=(e,t)=>{var o,n;const s=(null==e?void 0:e.id)||(null==t?void 0:t.id);if(!s)return;const a=null!==(o=null==t?void 0:t.dataViews)&&void 0!==o?o:{},l=null!==(n=null==e?void 0:e.dataViews)&&void 0!==n?n:{};Object.keys(a).forEach(e=>{l[e]||this.removeUseDataSource(r.DataSourceManager.getInstance().getDataViewDataSourceId(s,e))}),(null==t?void 0:t.childDataSourceJsons)&&Object.keys(t.childDataSourceJsons).forEach(o=>{var n;i(null===(n=null==e?void 0:e.childDataSourceJsons)||void 0===n?void 0:n[o],t.childDataSourceJsons[o])})};return i(e,null===(t=this.appConfig.dataSources)||void 0===t?void 0:t[e.id]),this.appConfig=this.appConfig.setIn(["dataSources",e.id],e),this}addAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e.id]||(this.appConfig=this.appConfig.setIn(["appProxies",e.id],e)),this}editAppProxy(e){return this.appConfig=this.appConfig.setIn(["appProxies",e.id],e),this}removeAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e]?(this.appConfig=this.appConfig.set("appProxies",this.appConfig.appProxies.without(e)),this):this}addMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}editMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}removeMessage(e){return this.appConfig.messageConfigs&&this.appConfig.messageConfigs[e.id]?(this.appConfig=this.appConfig.set("messageConfigs",this.appConfig.messageConfigs.without(e.id)),this):this}editTheme(e){return this.appConfig=this.appConfig.set("theme",e),this}editCustomTheme(e){return this.appConfig=this.appConfig.set("customTheme",e),this}editCustomThemeOption(e){return this.appConfig=this.appConfig.set("customThemeOptions",e),this}replaceOldThemeVariables(){return Ai(this,void 0,void 0,function*(){return this.appConfig=yield $e(this.appConfig),this})}initHeaderLayout(){const e=this.createLayout(r.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:r.LayoutParentType.Header}).setIn(["header","layout",this.appConfig.mainSizeMode],e),this}editHeaderProperty(e,t){let i=this.appConfig.header;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("header",i),this):this}initFooterLayout(){const e=this.createLayout(r.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:r.LayoutParentType.Footer}).setIn(["footer","layout",this.appConfig.mainSizeMode],e),this}editFooterProperty(e,t){let i=this.appConfig.footer;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("footer",i),this):this}setViewportSize(e,t){var i,o;return t?this.appConfig=this.appConfig.setIn(["forBuilderAttributes","viewPortSize",e],t):(null===(o=null===(i=this.appConfig.forBuilderAttributes)||void 0===i?void 0:i.viewPortSize)||void 0===o?void 0:o[e])&&(this.appConfig=this.appConfig.setIn(["forBuilderAttributes","viewPortSize"],this.appConfig.forBuilderAttributes.viewPortSize.without(e))),this}setLockLayout(e){return this.appConfig=this.appConfig.setIn(["forBuilderAttributes","lockLayout"],e),this}editAttributes(e){return this.appConfig=this.appConfig.setIn(["attributes"],e),this}updateAnalyticsConfig(e){return this.appConfig=this.appConfig.setIn(["analytics"],e),this}updateCookieBannerConfig(e){return this.appConfig=this.appConfig.setIn(["cookieBanner"],e),this}editCookieBannerConfig(e,t){return this.appConfig="string"==typeof e?this.appConfig.setIn(["cookieBanner",e],t):this.appConfig.setIn(["cookieBanner",...e],t),this}removeCookieBannerConfig(){return this.appConfig=this.appConfig.without("cookieBanner"),this}updateAppStateConfig(e){this.appConfig.appStateConfig||(this.appConfig=this.appConfig.set("appStateConfig",{}));const t=this.appConfig.appStateConfig.merge(e);return this.appConfig=this.appConfig.set("appStateConfig",t),this}updateUrlParamsConfig(e){this.appConfig.urlParams||(this.appConfig=this.appConfig.set("urlParams",{}));const t=this.appConfig.urlParams.merge(e);return this.appConfig=this.appConfig.set("urlParams",t),this}updateTranslationJsons(e){return this.appConfig=this.appConfig.set("translationJsons",e),this}getDuplicateLabel(e,t){const[i]=Pe(t);let o=be(this.appConfig,e,i);return o===i&&(o=`${i} 1`),o}removePageFromPageStructure(e){if(!this.appConfig.pageStructure)return this;return this.appConfig.pageStructure.find(t=>!!t[e])?this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.flatMap(t=>t[e]?[]:[t])):this.appConfig.pageStructure.forEach((t,i)=>{const o=Object.keys(t).find(i=>t[i].includes(e));if(o)return this.appConfig=this.appConfig.setIn(["pageStructure",i+"",o],t[o].flatMap(t=>t===e?[]:[t])),!0}),this}movePageIntoPageForPageStructure(e,t){return this.appConfig.pageStructure?(this.appConfig.pageStructure.some((i,o)=>{const n=Object.keys(i).find(e=>e===t);return!!n&&(this.appConfig=this.appConfig.setIn(["pageStructure",o+"",n],this.appConfig.pageStructure[o][n].concat([e])),!0)}),this):this}editJsonProperty(e,t,i){if(!e)return e;const o=t.split(".").filter(e=>""!==e);if(o.length>0){if(e.getIn(o)===i)return e;if(null==i){if(1===o.length)return e.without(o[0]);const t=o.pop(),i=e.getIn(o);return e.setIn(o,i.without(t))}return e.setIn(o,i)}return e}handleWidgetUseDataSourceChange(e,t){var i,o,n,s;if(void 0===t.useDataSources||r.lodash.isDeepEqual(e.useDataSources,t.useDataSources))return;const a=[];a[0]=null===(o=null===(i=e.useDataSources)||void 0===i?void 0:i.find(e=>{var i;return!(null===(i=t.useDataSources)||void 0===i?void 0:i.find(t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId)))}))||void 0===o?void 0:o.dataSourceId,a[1]=null===(s=null===(n=t.useDataSources)||void 0===n?void 0:n.find(t=>{var i;return!(null===(i=e.useDataSources)||void 0===i?void 0:i.find(e=>(null==e?void 0:e.dataSourceId)===(null==t?void 0:t.dataSourceId)))}))||void 0===s?void 0:s.dataSourceId;const l=E(t.id);(null==l?void 0:l.useDataSourceWillChange)&&(this.appConfig=l.useDataSourceWillChange(this.appConfig,a[0],a[1]))}}var Ti=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};class xi{constructor(){this.actionSettings={}}static getInstance(){return xi.instance||(xi.instance=new xi),xi.instance}loadAllActionSettingClasses(){var e;const t=Li();return Object.keys((null===(e=t.appConfig)||void 0===e?void 0:e.widgets)||{}).forEach(e=>{var i;const o=t.appConfig.widgets[e],n=[].concat(null===(i=o.manifest)||void 0===i?void 0:i.dataActions).filter(e=>e);n.length>0&&n.forEach(t=>{if(t.settingUri){const i=`${o.uri}dist/${t.settingUri}`;this.actionSettings[i]||(this.actionSettings[i]=this.loadDependency(e).then(()=>r.moduleLoader.loadModule(i).then(e=>{const t=e.default;return S.getInstance().loadI18nMessagesForSetting(o.uri).then(e=>this.injectActionSettingProps(t,e,o.id))})))}})}),this.actionSettings}loadDependency(e){return Ti(this,void 0,void 0,function*(){var t;const i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===t?void 0:t.manifest;if(!(null==i?void 0:i.settingDependency))return Promise.resolve();const o="string"==typeof i.dependency?[i.dependency]:i.dependency.asMutable();return(0,r.loadDependencies)(o)})}injectActionSettingProps(e,t,i){const o=(0,r.injectIntl)(e),n=(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i];let s=null;s=i&&n?(0,r.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i].manifest.name:"Framework";class a extends r.React.PureComponent{render(){const e={messages:t},i=(0,r.getAppStore)().getState().appI18nMessages,n=(0,r.getAppStore)().getState().appContext.locale,s=Object.assign({},t,i);return(0,g.jsx)(r.IntlProvider,{locale:n,defaultLocale:n,messages:s,children:(0,g.jsx)(o,Object.assign({},this.props,e))})}}a.displayName=`ActionSettingWrapper(${s})`;for(const t in e)a[t]||(a[t]=e[t]);return a}}class _i{constructor(){this.isGeneralUrlConfigEnable=e=>{var t;const i=r.urlManagerUtils.getAppConfig(),o=null===(t=null==i?void 0:i.urlParams)||void 0===t?void 0:t.getIn(["general",e]);let n=null==o?void 0:o.isEnable;return void 0===n&&e===r.UrlGeneralConfig.DataSelection&&(n=!0),n},this.isZoomToSelectionEnable=()=>{var e,t;const i=r.urlManagerUtils.getAppConfig(),o=null===(e=null==i?void 0:i.urlParams)||void 0===e?void 0:e.getIn(["general",r.UrlGeneralConfig.DataSelection]);return null!==(t=null==o?void 0:o.zoomToSelection)&&void 0!==t&&t}}static getInstance(){return _i.instance||(_i.instance=new _i),_i.instance}getWidgetsUseUrlParamsInManifest(){const e=r.urlManagerUtils.getAppConfig();let t=null;if(null==e?void 0:e.widgets){t=r.Immutable.from({});for(const i of Object.keys(e.widgets)){const o=e.widgets[i],n=o.manifest.urlParameters;if((null==n?void 0:n.length)>0){t=t.set(i,o);const e=n.map(e=>{var t,i;const n=e.name,s=null!==(t=o.manifest.i18nMessages[`_url_params_${n}_label`])&&void 0!==t?t:e.label;if((e=e.set("label",s)).tooltip){const t=null!==(i=o.manifest.i18nMessages[`_url_params_${n}_tooltip`])&&void 0!==i?i:e.tooltip;e=e.set("tooltip",t)}return e});t=t.setIn([i,"manifest","urlParameters"],e)}}}return t}updateGeneralUrlConfigEnable(e,t){var i,o;let n=r.urlManagerUtils.getAppConfig(),s=null===(i=n.urlParams)||void 0===i?void 0:i.getIn(["general",e]);s||(s=r.Immutable.from({isEnable:!1})),s=null==s?void 0:s.merge({isEnable:t}),n.urlParams||(n=n.setIn(["urlParams"],r.Immutable.from({general:{}})));const a=null===(o=n.urlParams)||void 0===o?void 0:o.setIn(["general",e],s);this.updateUrlParamsConfig(a)}updateZoomToSelectionEnable(e){var t,i;let o=r.urlManagerUtils.getAppConfig(),n=null===(t=o.urlParams)||void 0===t?void 0:t.getIn(["general",r.UrlGeneralConfig.DataSelection]);n||(n=r.Immutable.from({isEnable:!0})),n=null==n?void 0:n.merge({zoomToSelection:e}),o.urlParams||(o=o.setIn(["urlParams"],r.Immutable.from({general:{}})));const s=null===(i=o.urlParams)||void 0===i?void 0:i.setIn(["general",r.UrlGeneralConfig.DataSelection],n);this.updateUrlParamsConfig(s)}isWidgetParamEnable(e,t,i){var o;let n=!0;const s=null===(o=r.urlManagerUtils.getAppConfig().urlParams)||void 0===o?void 0:o.getIn(["widgets",e]);return n=null==s?void 0:s.getIn(["params",t]),void 0===n&&(n=!0,i&&(n=!1)),n}updateWidgetEnable(e,t){let{appConfig:i,widgetUrlConfig:o}=this.getWidgetsUrlParamsConfig(e);o=null==o?void 0:o.merge({isEnable:t}),this._setWidgetUrlConfig(e,o,i,Li())}updateWidgetParamEnable(e,t,i){let{appConfig:o,widgetUrlConfig:n}=this.getWidgetsUrlParamsConfig(e);n=n.setIn(["params",t],i),this._setWidgetUrlConfig(e,n,o,Li())}getFlatPageInfos(e){let t=[];return null==e||e.forEach(e=>{var i;const o=Object.keys(e)[0];t.push(o),(null===(i=e[o])||void 0===i?void 0:i.length)>0&&(t=t.concat(e[o].flat()))}),t}getWidgetsInPages(e,t){const i=[],o=r.urlManagerUtils.getAppConfig(),n=this.getFlatPageInfos(null==o?void 0:o.pageStructure);return null==n||n.forEach(n=>{const s={type:r.ContainerType.Page,id:n},a=A.searchUtils.getContentsInContainerRecursive(o,s,r.LayoutItemType.Widget,e),l=this._findCommonWidgetsInManifest(a),d={id:n,label:this._getPageLabel(n)};let u=[];l.forEach(e=>{u.push({id:e,label:this._getWidgetLabel(e)})}),t&&(u=u.filter(e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})),i.push({pageInfo:d,widgetsInfo:u})}),i}getWidgetsInHeaderFooter(e,t){const i=[],o=r.urlManagerUtils.getAppConfig();let n={type:r.ContainerType.Header,id:null};const s=A.searchUtils.getContentsInContainerRecursive(o,n,r.LayoutItemType.Widget,e);let a=this._findCommonWidgetsInManifest(s),l=[];a.forEach(e=>{l.push({id:e,label:this._getWidgetLabel(e)})}),t&&(l=l.filter(e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})),i.push({mode:"Header",widgetsInfo:l}),n={type:r.ContainerType.Footer,id:null};const d=A.searchUtils.getContentsInContainerRecursive(o,n,r.LayoutItemType.Widget,e);return a=this._findCommonWidgetsInManifest(d),l=[],a.forEach(e=>{l.push({id:e,label:this._getWidgetLabel(e)})}),t&&(l=l.filter(e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})),i.push({mode:"Footer",widgetsInfo:l}),i}getWidgetsInDialogs(e,t){const i=[],o=r.urlManagerUtils.getAppConfig(),n=null==o?void 0:o.dialogs;Object.keys(n).filter((e,t)=>n[e].mode===r.DialogMode.Fixed).forEach(s=>{const a=n[s],l={type:r.ContainerType.Dialog,id:s},d=A.searchUtils.getContentsInContainerRecursive(o,l,r.LayoutItemType.Widget,e),u=this._findCommonWidgetsInManifest(d),c={mode:r.DialogMode.Fixed,id:s,label:a.label};let p=[];u.forEach(e=>{p.push({id:e,label:this._getWidgetLabel(e)})}),t&&(p=p.filter(e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})),i.push({dialogInfo:c,widgetsInfo:p})});return Object.keys(n).filter((e,t)=>n[e].mode===r.DialogMode.Anchored).forEach(s=>{const a=n[s],l={type:r.ContainerType.Dialog,id:s},d=A.searchUtils.getContentsInContainerRecursive(o,l,r.LayoutItemType.Widget,e),u=this._findCommonWidgetsInManifest(d),c={mode:r.DialogMode.Anchored,id:s,label:a.label};let p=[];u.forEach(e=>{p.push({id:e,label:this._getWidgetLabel(e)})}),t&&(p=p.filter(e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})),i.push({dialogInfo:c,widgetsInfo:p})}),i}_findCommonWidgetsInManifest(e){const t=this.getWidgetsUseUrlParamsInManifest(),i=Object.keys(t),o=[];return e.forEach(e=>{i.includes(e)&&o.push(e)}),o}_getWidgetLabel(e){const t=r.urlManagerUtils.getAppConfig().widgets.getIn([e]);return(null==t?void 0:t.label)||e}_getPageLabel(e){const t=r.urlManagerUtils.getAppConfig().pages.getIn([e]);return(null==t?void 0:t.label)||e}getWidgetsUrlParamsConfig(e){var t;const i=r.urlManagerUtils.getAppConfig();let o=null===(t=i.urlParams)||void 0===t?void 0:t.getIn(["widgets",e]);return o||(o=r.Immutable.from({isEnable:!0})),{appConfig:i,widgetUrlConfig:o}}_setWidgetUrlConfig(e,t,i,o){var n;i.urlParams||(i=i.setIn(["urlParams"],r.Immutable.from({widgets:{}})));const s=null===(n=i.urlParams)||void 0===n?void 0:n.setIn(["widgets",e],t);this.updateUrlParamsConfig(s)}updateUrlParamsConfig(e){Li().updateUrlParamsConfig(e).exec()}}const Ri=_i;let ji;try{const e=r.utils.getParentWindow();ji=null==e?void 0:e._builderPubsub}catch(e){console.error("Can access parent.")}function Oi(){if(!ji)return;ji.unsubscribe("to_app");const e=(0,r.getAppStore)();ji.subscribe("to_app",function(e,t){console.debug(e,t)}),ji.subscribe(`to_app.${Je.AppConfigChanged}`,function(t,i){const o=e.getState();if(o.appRuntimeInfo.currentPageId&&!i.pages[o.appRuntimeInfo.currentPageId]){const e=Object.keys(i.pages).find(e=>i.pages[e].isDefault);r.jimuHistory.changePage(e)}e.dispatch(r.appActions.appConfigChanged(i))}),ji.subscribe(`to_app.${Je.AppInfoChanged}`,function(t,i){e.dispatch(r.appActions.appInfoChanged(i))}),ji.subscribe(`to_app.${Je.PortalSelfChanged}`,function(t,i){if(e.dispatch(r.appActions.setPortalSelf(i)),i&&!i.isPortal){const t=`https://${i.urlKey}.${i.customBaseUrl}`;i.urlKey&&!r.portalUrlUtils.isSamePortalUrl(e.getState().portalUrl,t)&&e.dispatch(r.appActions.setPortalInfo({portalUrl:t}))}}),ji.subscribe(`to_app.${Je.UserSignIn}`,function(t,i){e.dispatch(r.appActions.userSignIn(i))}),ji.subscribe(`to_app.${Je.SetMainPortal}`,function(t,i){const o=Object.assign({portalUrl:e.getState().portalUrl,clientId:e.getState().clientId,isWebTier:e.getState().isWebTier},i);e.dispatch(r.appActions.setPortalInfo(o))}),ji.subscribe(`to_app.${Je.DialogInfosChanged}`,function(t,i){e.dispatch(r.appActions.dialogInfosChanged(i))}),ji.subscribe(`to_app.${Je.ChangeAppMode}`,function(t,i){e.dispatch(r.appActions.appModeChanged(i))}),ji.subscribe(`to_app.${Je.ChangeWidgetStateProp}`,function(t,i){e.dispatch(r.appActions.widgetStatePropChange(i.widgetId,i.propKey,i.value))}),ji.subscribe(`to_app.${Je.ChangePage}`,function(e,t){const i=(0,r.getAppStore)().getState().appConfig.pages[t];i.type===r.PageType.Link||i.type===r.PageType.Folder||r.urlUtils.parseAppPath(location.pathname,(0,r.getAppStore)().getState().appConfig).pageId===t?(0,r.getAppStore)().dispatch(r.appActions.currentPageChanged(t)):r.jimuHistory.changePage(t)}),ji.subscribe(`to_app.${Je.ChangeDialog}`,function(t,i){r.jimuHistory.changeDialog(i),e.dispatch(r.appActions.currentDialogChanged(i))}),ji.subscribe(`to_app.${Je.ChangeSelection}`,function(t,i){e.dispatch(r.appActions.selectionChanged(i))}),ji.subscribe(`to_app.${Je.BuilderTriggerKeyboard}`,function(e,t){r.keyboardUtils.triggerEvent(t)}),ji.subscribe(`to_app.${Je.ChangeBrowserSizeMode}`,function(t,i){e.dispatch(r.appActions.browserSizeModeChanged(i))}),ji.subscribe(`to_app.${Je.BuilderSessionChanged}`,function(e,t){r.SessionManager.getInstance().syncSessionsFromOtherWindow(t)}),ji.subscribe(`to_app.${Je.BuilderNoPermissionResourceInfoListChanged}`,function(e,t){r.SessionManager.getInstance().syncNoPermissionResourceInfoListFromOtherWindow(t)}),ji.subscribe(`to_app.${Je.ChangeZoomScale}`,function(t,i){e.dispatch(r.appActions.zoomScaleChange(i))}),ji.subscribe(`to_app.${Je.ActivePagePartChanged}`,function(t,i){e.dispatch(r.appActions.activePagePartChanged(i))}),ji.subscribe(`to_app.${Je.AnimationPreview}`,function(t,i){e.dispatch(r.appActions.setupAnimationPreview(i))}),ji.subscribe(`to_app.${Je.HoverPreview}`,function(t,i){e.dispatch(r.appActions.setupHoverPreview(i))}),ji.subscribe(`to_app.${Je.SectionNavInfoChanged}`,function(t,i){e.dispatch(r.appActions.sectionNavInfoChanged(i.sectionId,i.navInfo)),r.jimuHistory.changeViewBySectionNavInfo(i.sectionId,i.navInfo)}),ji.subscribe(`to_app.${Je.ScreenGroupNavInfoChanged}`,function(t,i){e.dispatch(r.appActions.screenGroupNavInfoChanged(i.screenGroupId,i.activeIndex))}),ji.subscribe(`to_app.${Je.TocHoverInfoChanged}`,function(e,t){const{layoutInfo:i,hovered:o}=t,{layoutId:n,layoutItemId:s}=i,a=document.querySelector(`div.builder-layout-item[data-layoutid="${n}"][data-layoutitemid="${s}"]`);a&&(o?a.classList.add("hovered"):a.classList.remove("hovered"))}),ji.subscribe(`to_app.${Je.SetClientIdAlertIsCancelled}`,function(e,t){r.SessionManager.getInstance().onClientIdDialogFinished(null==t?void 0:t.portalUrl,null,new Error("setting clientId is cancelled."))}),ji.subscribe(`to_app.${Je.UtilityStateChanged}`,function(t,i){e.dispatch(r.appActions.utilityStateChange(i.utilityId,i.state,i.isSignInError))}),ji.subscribe(`to_app.${Je.OpenCookieBannerByPrivacyPanel}`,function(t,i){const{isOpen:o}=i;e.dispatch(r.appActions.OpenCookieBannerByPrivacyPanel(o))}),ji.subscribe(`to_app.${Je.OpenCookieSettingsWindow}`,function(t,i){const{isOpen:o}=i;e.dispatch(r.appActions.OpenCookieSettingsWindow(o))}),ji.subscribe(`to_app.${Je.WidgetToolbarStateChange}`,function(t,i){const{widgetId:o,toolNames:n}=i;e.dispatch(r.appActions.widgetToolbarStateChange(o,n))}),ji.subscribe(`to_app.${Je.WidgetStateChange}`,function(t,i){const{widgetId:o,prop:n,value:s}=i;e.dispatch(r.appActions.widgetStatePropChange(o,n,s))}),ji.subscribe(`to_app.${Je.WidgetRuntimeInfoChange}`,function(t,i){const{widgetId:o,prop:n,value:s}=i;e.dispatch(r.appActions.widgetRuntimeInfoChange(o,n,s))}),ji.subscribe(`to_app.${Je.RuntimeThemeModeChange}`,function(t,i){e.dispatch(r.appActions.ThemeModeChanged(i))}),ji.subscribe(`to_app.${Je.SetWidgetIsInlineEditingState}`,function(t,i){const{widgetId:o,isInlineEditing:n}=i;e.dispatch(r.appActions.setWidgetIsInlineEditingState(o,n))}),ji.subscribe(`to_app.${Je.ChangeDynamicStylePreviewConditionInfo}`,function(t,i){const{widgetId:o,value:n}=i;e.dispatch(r.appActions.changeDynamicStylePreviewConditionInfo(o,n))})}function Ui(){qi(`to_builder.${Ye.AppSessionChanged}`,r.SessionManager.getInstance().getSessions())}function Ei(){qi(`to_builder.${Ye.AppNoPermissionResourceInfoListChanged}`,r.SessionManager.getInstance().getNoPermissionResourceInfoList())}function ki(e){qi(`to_builder.${Ye.NeedToCheck498Error}`,e)}function Di(){qi(`to_builder.${Ye.AppStateChanged}`,(0,r.getAppStore)().getState())}function Bi(){qi(`to_builder.${Ye.AppIsLoaded}`)}function Wi(e){qi(`to_builder.${Ye.AppAddResource}`,e)}function zi(e){qi(`to_builder.${Ye.AppTriggerKeyboard}`,e)}function Fi(e){qi(`to_builder.${Ye.ConfirmDelete}`,e)}function $i(e,t,i,o){qi(`to_builder.${Ye.NeedToRegisterClinetId}`,{portalUrl:e,needToSignIn:t,serviceUrl:i,forceLogin:o})}function Gi(e){qi(`to_builder.${Ye.SetSidePanel}`,e)}function Ni(){qi(`to_builder.${Ye.CloseBannerInLiveView}`)}function Hi(){qi(`to_builder.${Ye.ClassificationBannerReady}`)}function Vi(e){qi(`to_builder.${Ye.ShowTextArcadePanel}`,e)}function qi(e,t){ji&&ji.publishSync(e,t)}var Ki=d(886),Ji=d.n(Ki),Yi=d(490),Qi=d.n(Yi),Zi=d(153),Xi=d.n(Zi),eo=d(617),to=d.n(eo),io=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function oo(e,t,i){let o;return o=e.type===r.PageType.Folder?{svg:Xi(),properties:{filename:"folder",originalName:"outlined/application/folder.svg",path:["general","folder"],color:"var(--ref-palette-neutral-1100)",inlineSvg:!0}}:e.type===r.PageType.Link?{svg:Qi(),properties:{filename:"link",originalName:"outlined/data/link-tilted.svg",path:["general","link"],color:"var(--ref-palette-neutral-1100)",inlineSvg:!0}}:{svg:Ji(),properties:{filename:i||(null==t?void 0:t("page"))||"",originalName:"outlined/data/page.svg",color:"var(--ref-palette-neutral-1100)",inlineSvg:!0}},o}function no(){return to()}function so(){return oe()}function ao(e,t){if(!e)return[];const i=[];return Object.keys(e).forEach(o=>{e[o].autoOpenDialogId===t&&i.push({id:o,label:e[o].label})}),i}let ro=null;function lo(){return ro||(ro=fetch(`${r.moduleLoader.resolveModuleFullPath("widgets/")}/widgets-info.json`).then(e=>io(this,void 0,void 0,function*(){return yield e.json()})).then(e=>e.filter(e=>{const t=(0,r.getAppStore)().getState().portalUrl;return!e.manifest.notAllowAdd&&(!r.portalUrlUtils.isAGOLDomain(t)||!e.manifest.notSupportAGOL)}).map(e=>{var t,i;e.manifest=r.appConfigUtils.addWidgetManifestProperties(e.manifest);const o=r.i18n.findLocale((0,r.getAppStore)().getState().appContext.locale,e.manifest.translatedLocales);return{itemType:r.LayoutItemType.Widget,name:e.name,label:(null===(t=e.i18nLabel)||void 0===t?void 0:t[o])||e.manifest.label||e.name,description:(null===(i=e.i18nDescription)||void 0===i?void 0:i[o])||e.manifest.desription||e.name,uri:e.uri,manifest:e.manifest,icon:"../"+e.icon,group:e.group,order:e.order}})).catch(e=>(console.error("Failed to fetch common widget list. ",e),[]))),ro}let uo=null;function co(){if(!fo())return Promise.resolve([]);if(!uo){const e='type:"Experience Builder Widget" AND typekeywords:"Widget"';uo=r.esri.restPortal.searchItems({q:e,num:100,start:0,authentication:r.SessionManager.getInstance().getSessionByUrl((0,r.getAppStore)().getState().portalUrl)}).then(e=>e.results).then(e=>{let t=[];return e.forEach((e,i)=>{if(!e.url)return;const o=function(e){let t;t=/manifest\.json$/.test(e)?e.substring(0,e.length-13):/\/$/.test(e)?e:e+"/";return t=t.replace(/^http:\/\//,"https://"),t}(e.url),n=r.appConfigUtils.getWidgetContext(o),s={itemType:r.LayoutItemType.Widget,name:e.url,label:e.title,itemId:e.id,manifest:{},icon:`${n.folderUrl}icon.svg`,uri:n.folderUrl,group:Io,order:i};t=t.concat(s)}),Promise.allSettled(t.map(e=>fetch(`${e.uri}manifest.json`).then(e=>e.json()))).then(e=>e.map(e=>"fulfilled"===e.status?e.value:null)).then(e=>t.map((t,i)=>Object.assign(Object.assign({},t),{manifest:e[i]||{defaultSize:{width:400,height:400}}})))}).catch(e=>(console.error("Failed to fetch custom widget list. ",e),[]))}return uo}function po(e,t){if(!e||!t)return"";switch(e){case 1:return t.formatMessage({id:"mapCentric",defaultMessage:zt.defaultMessages.mapCentric});case 2:return t.formatMessage({id:"dataCentric",defaultMessage:zt.defaultMessages.dataCentric});case 3:return t.formatMessage({id:"pageElements",defaultMessage:zt.defaultMessages.pageElements});case 4:return t.formatMessage({id:"menuAndTools",defaultMessage:zt.defaultMessages.menuAndTools});case 8:return t.formatMessage({id:"layout",defaultMessage:r.defaultMessages.layout});case 9:return t.formatMessage({id:"section",defaultMessage:r.defaultMessages.section});case 10:return t.formatMessage({id:"locationReferencing",defaultMessage:r.defaultMessages.locationReferencing});case Io:return t.formatMessage({id:"custom",defaultMessage:zt.defaultMessages.custom});default:return""}}function go(e){return{itemType:r.LayoutItemType.Section,label:null==e?void 0:e.formatMessage({id:"section",defaultMessage:r.defaultMessages.section}),uri:"",manifest:{properties:{},defaultSize:{width:500,height:500}},icon:oe(),name:"section",group:9,order:900}}function ho(e){return{itemType:r.LayoutItemType.Widget,label:null==e?void 0:e.formatMessage({id:"placeholder",defaultMessage:zt.defaultMessages.placeholder}),uri:null,manifest:{defaultSize:{width:300,height:300}},icon:H(),name:"placeholder",group:8,order:899}}function fo(){return!r.portalUrlUtils.isAGOLDomain((0,r.getAppStore)().getState().portalUrl)}function yo(e){return fo()||(null==e?void 0:e.some(e=>e.group===Io))}function vo(e,t=!1){const i=(0,r.getAppStore)().getState().queryObject;let o=`${window.jimuConfig.mountPath}builder/?id=${e}`;return i.locale&&(o=r.urlUtils.appendQueryParam(o,"locale",i.locale)),i.__env__&&(o=r.urlUtils.appendQueryParam(o,"__env__",i.__env__)),t&&(o=r.urlUtils.appendQueryParam(o,"mode","express")),o}function mo(e,t){const i=(0,r.getAppStore)().getState().queryObject;let o=window.jimuConfig.mountPath;return i.locale&&(o=r.urlUtils.appendQueryParam(o,"locale",i.locale)),i.__env__&&(o=r.urlUtils.appendQueryParam(o,"__env__",i.__env__)),e&&(o=r.urlUtils.appendQueryParam(o,"express","true")),t&&(o=r.urlUtils.appendQueryParam(o,"views",t)),o}const Io=7;function wo(){const e=(0,r.getAppStore)().getState().appStateHistory,t=e.past[e.past.length-2];So((0,r.getAppStore)().getState().appStateInBuilder.appConfig,t.appConfig),(0,r.getAppStore)().dispatch(Ne.inBuilderAppConfigChanged(t.appConfig)),(0,r.getAppStore)().dispatch(qe.InBuilderAppConfigUndo())}function Co(){const e=(0,r.getAppStore)().getState().appStateHistory.future[0];So((0,r.getAppStore)().getState().appStateInBuilder.appConfig,e.appConfig),(0,r.getAppStore)().dispatch(Ne.inBuilderAppConfigChanged(e.appConfig)),(0,r.getAppStore)().dispatch(qe.InBuilderAppConfigRedo())}function So(e,t){const i=Object.keys(e.widgets).filter(e=>!t.widgets[e]);(0,r.getAppStore)().dispatch(y.widgetsRemoved(i));const o=Object.keys(t.widgets).filter(t=>!e.widgets[t]).map(e=>({widgetId:e,widgetUri:t.widgets[e].uri}));(0,r.getAppStore)().dispatch(y.widgetsAdded(o))}var bo=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};const Po=d(546),Ao=["en","de","es","fr","ja","ru","zh-cn"];function Lo(){const e=window.locale.toLowerCase();let t=!1;if(Ao.includes(e))t=!0;else{const i=e.split("-")[0];for(let e=0;e<Ao.length;e++)if(i===Ao[e].split("-")[0]){t=!0;break}}return t}function Mo(e){return bo(this,void 0,void 0,function*(){return yield jo("build-apps",e,!1)})}function To(){return bo(this,void 0,void 0,function*(){return window.jimuConfig.isDevEdition?yield jo(void 0,"home",!0):yield jo("get-started","what-is-arcgis-experience-builder",!0)})}function xo(){return bo(this,void 0,void 0,function*(){return yield jo("get-started","whats-new",!0)})}function _o(){return window.jimuConfig.isDevEdition?jo("get-started","frequently-asked-questions",!0):jo("get-started","faq",!0)}function Ro(e,t){return bo(this,void 0,void 0,function*(){return yield jo("widgets",e,!1,t)})}function jo(e,t,i,o){return bo(this,void 0,void 0,function*(){let n,s=null;if(t=t.toLowerCase(),window.jimuConfig.isDevEdition){n="https://developers.arcgis.com/experience-builder/";const i=Po.dev;if(e){if(s=i[e][t]&&`${i[e].prefix}${i[e][t]}`,!s&&o){const e=window.location.origin+"/"+o+"doc";return yield Promise.resolve(e)}}else s=i[t]&&`${i[t]}`;let a=n+"#";return s?(a=n+s,yield Promise.resolve(a)):yield Promise.resolve(a)}{const o=(0,r.getAppStore)().getState().portalUrl;if(window.jimuConfig.isInPortal){const n=Lo()?r.i18n.findLocale(window.locale,Ao):"en",a=Po.portal;s=e?`${a[e][t]}`:`${a[t]}`;const l={"Content-Type":"text/json"},d=function(e,t){let i="";const o=(0,r.getAppStore)().getState().portalSelf,n=null==o?void 0:o.helpBase.split("/");i=(null==n?void 0:n.includes("https:"))?n.slice(0,3).join("/")+"/"+t:e+"/"+(null==n?void 0:n[2])+"/"+t;return i}(o,n),u=d.includes("https:")?d+"/experience-builder":d;return yield fetch(o+"/sharing/rest/portals/helpmap?f=json",{method:"get",headers:l}).then(e=>bo(this,void 0,void 0,function*(){return yield e.json()})).then(e=>bo(this,void 0,void 0,function*(){if(e&&e.helpMap&&e.helpMap.m&&s&&e.helpMap.m[s]){const t=d+"/"+e.helpMap.m[s];return yield Promise.resolve(t)}return i?yield Promise.resolve(u):yield To()})).catch(e=>bo(this,void 0,void 0,function*(){return console.warn(e),i?yield Promise.resolve(u):yield To()}))}{const i=Po.online;s=e?i[e][t]&&`${i[e].prefix}${i[e][t]}`:i[t]&&`${i[t]}`;const a=function(e){const t=r.urlUtils.getUrlHost(e),i=t.split(".");i.splice(0,1);const o=i.join(".");return"www.arcgis.com"===t||"maps.arcgis.com"===o}(o)?"doc":"docdev";n="https://"+a+".arcgis.com/en/experience-builder/";let l=n+"#";if(!s)return yield Promise.resolve(l);if(l=n+s,Lo()){r.portalUrlUtils.getPortalSelfInfoUrl(o);const e=function(e,t,i){let o;const n=(0,r.getAppStore)().getState().portalSelf;if(n&&n.helpBase){try{o=n.helpBase.split("/").slice(0,4).join("/")+"/experience-builder/"}catch(e){return i}return o?o+t:i}return i}(0,s,l);return yield Promise.resolve(e)}return yield Promise.resolve(l)}}})}class Oo extends r.React.PureComponent{constructor(){super(...arguments),this.isSupportKeyboard=()=>{let e=!1;return window.jimuConfig.isBuilder&&"home"!==this.props.currentPageId&&"template"!==this.props.currentPageId?(e=!0,e):e},this.switchAppMode=()=>{var e,t;(null===(t=null===(e=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode)===r.AppMode.Run?Yt(r.AppMode.Design):Yt(r.AppMode.Run)},this.undo=()=>{this.props.stateHistory.past.length<=1||wo()},this.redo=()=>{this.props.stateHistory.future.length<=0||Co()},this.onKeyboardTrigger=e=>{e.key.includes("-manual")||ii(e)},this.isMac=()=>{var e,t;return"macOS"===(null===(t=null===(e=window.jimuUA)||void 0===e?void 0:e.os)||void 0===t?void 0:t.name)}}render(){return this.isMac()?this.isSupportKeyboard()?(0,g.jsx)(r.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"command+keyz":()=>{this.undo()},"command+shift+keyz":()=>{this.redo()}}}):null:this.isSupportKeyboard()?(0,g.jsx)(r.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"ctrl+keyz":()=>{this.undo()},"ctrl+shift+keyz":()=>{this.redo()}}}):null}}const Uo=r.ReactRedux.connect(e=>({currentPageId:e.appRuntimeInfo.currentPageId,stateHistory:e.appStateHistory}))(Oo);var Eo=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function ko(){return Eo(this,void 0,void 0,function*(){const e=(0,r.getAppStore)().getState().appContext.locale;return yield function(e,t){return Eo(this,void 0,void 0,function*(){return(e=r.i18n.getLocaleToLoad(e,t))?yield r.i18n.loadLocaleMessages("jimu-for-builder/lib/translations",e).then(e=>e):Promise.resolve(R)})}(e,r.translatedLocales).then(e=>(e&&(0,r.getAppStore)().dispatch(r.appActions.i18nMessagesLoaded("jimu-for-builder",e)),r.i18n.resetIntls(),e))})}var Do=function(e,t,i,o){return new(i||(i=Promise))(function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};function Bo(){return Do(this,void 0,void 0,function*(){return yield ko(),yield Promise.resolve({})})}})(),u})())}}});