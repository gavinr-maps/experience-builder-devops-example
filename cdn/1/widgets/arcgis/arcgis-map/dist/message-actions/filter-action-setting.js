System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-arcgis","jimu-theme","jimu-ui/advanced/sql-expression-builder"],(function(e,t){var a={},o={},s={},i={},r={},n={},c={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.Immutable=e.Immutable,a.MessageActionConnectionType=e.MessageActionConnectionType,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.SqlExpressionMode=e.SqlExpressionMode,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished},function(e){o.Button=e.Button,o.Collapse=e.Collapse,o.Icon=e.Icon,o.Label=e.Label,o.Radio=e.Radio,o.Switch=e.Switch},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){i.DataSourceSelector=e.DataSourceSelector,i.FieldSelector=e.FieldSelector},function(e){r.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes},function(e){n.withTheme=e.withTheme},function(e){c.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup}],execute:function(){e((()=>{var e={74587:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 40"><path fill="#A8A8A8" fill-rule="evenodd" d="M6 30v10H0v-1h5v-9zM3.162 18.582a.5.5 0 0 1 0 .71l-1.416 1.421a2.497 2.497 0 0 0-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 0 1 .712.713L6 24.968a3.5 3.5 0 0 1-4.967 0 3.5 3.5 0 0 1 0-4.967l1.416-1.422a.504.504 0 0 1 .713.003m4.967-.71a.5.5 0 0 1 0 .71L4.58 22.129a.504.504 0 0 1-.713-.712l3.548-3.548a.504.504 0 0 1 .713.003m2.838-2.838a3.5 3.5 0 0 1 0 4.967l-1.42 1.419a.504.504 0 0 1-.713-.712l1.423-1.417a2.5 2.5 0 0 0 0-3.547 2.5 2.5 0 0 0-3.547 0l-1.42 1.419a.504.504 0 0 1-.713-.712l1.42-1.42a3.506 3.506 0 0 1 4.97.003M6 0v10H5V1H0V0z"></path></svg>'},62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=o},13089:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=s},71442:e=>{"use strict";e.exports=c}},t={};function l(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,l),s.exports}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";l.r(u),l.d(u,{default:()=>C});var e=l(79244),t=l(14321),a=l(79298),o=l(13089),s=l(62686),i=l(1888),r=l(71442);const n="Trigger data",c="Action data",d="Conditions",p="Trigger / action connection",S="Select a trigger field",g="Select an action field",h="More conditions",m="Please set your expression first.",D="Auto bound.";function f(t,a){var o,s;const i=v(),r=null===(o=null==i?void 0:i.widgets)||void 0===o?void 0:o[t],n=null===(s=null==r?void 0:r.manifest)||void 0===s?void 0:s.publishMessages;let c=e.MessageCarryData.UseDataSource;return null==n||n.forEach((e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(c=null==t?void 0:t.messageCarryData)})),c}function I(t,a){var o;const s=f(t,a),i=v(),r=null===(o=null==i?void 0:i.widgets)||void 0===o?void 0:o[t],n=(null==r?void 0:r.useDataSources)||(0,e.Immutable)([]),c=function(t){var a;const o=null!==(a=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==a?a:[];return(0,e.Immutable)(o)}(null==r?void 0:r.outputDataSources)||(0,e.Immutable)([]),l=null==n?void 0:n.asMutable({deep:!0}).concat(null==c?void 0:c.asMutable({deep:!0}));switch(s){case e.MessageCarryData.OutputDataSource:return c;case e.MessageCarryData.UseDataSource:return n;case e.MessageCarryData.BothDataSource:return(0,e.Immutable)(l)}}function y(t,a,o){const s=f(null==t?void 0:t.id,a),i=(null==t?void 0:t.outputDataSources)||[],r=(null==t?void 0:t.useDataSources)||[];if(o)return!1;switch(s){case e.MessageCarryData.OutputDataSource:return 1===(null==i?void 0:i.length);case e.MessageCarryData.UseDataSource:return 1===(null==r?void 0:r.length);case e.MessageCarryData.BothDataSource:return 1===i.length+r.length}}function v(){var t,a,o;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig}const x={frameworkAction_TriggerLayer:"Trigger data",frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_UseRelationship:"Use layer's relationship",frameworkAction_CustomFields:"Set custom connection fields",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy"},b=a=>{const{messageDataSource:o,actionDataSource:s,connectionType:i,onUseLayersRelationship:r,onSetCustomFields:n}=a,[c,l]=e.React.useState(!1);e.React.useEffect((()=>{if(!o||!s)return;const t=e.dataSourceUtils.getMainOriginDataSource(o),a=e.dataSourceUtils.getMainOriginDataSource(s);(null==t?void 0:t.createRelatedDataSources)?t.createRelatedDataSources().then(((e=[])=>{e.includes(a)?l(!0):l(!1)})):l(!1)}),[o,s]);const u=e.hooks.useLatest(i);e.React.useEffect((()=>{u.current||(c?r():n())}),[c,u,n,r]);const d=e.hooks.useTranslation(x);return c?(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.Label,{className:"justify-content-start",onClick:r},(0,e.jsx)(t.Radio,{className:"mr-2",role:"radio",checked:i===e.MessageActionConnectionType.UseLayersRelationship}),d("frameworkAction_UseRelationship")),(0,e.jsx)(t.Label,{className:"mt-3 justify-content-start",onClick:n},(0,e.jsx)(t.Radio,{className:"mr-2",role:"radio",checked:!i||i===e.MessageActionConnectionType.SetCustomFields}),d("frameworkAction_CustomFields"))):null},w=(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.SceneLayer,e.AllDataSourceTypes.BuildingComponentSubLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer]);class A extends e.React.PureComponent{constructor(t){super(t),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.initOutputDataSources=t=>{var a;const o=null!==(a=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==a?a:[];return(0,e.Immutable)(o)},this.getInitConfig=()=>{const t=this.props.messageWidgetId,a=(0,e.getAppStore)().getState().appStateInBuilder.appConfig;let o=null,i=null;if(this.props.config.messageUseDataSource)o=this.checkAndGetInitUseDataSource(this.props.messageWidgetId,this.props.config.messageUseDataSource);else{const i=I(t,this.props.messageType);if((null==i?void 0:i[0])&&1===(null==i?void 0:i.length)){const t=a.dataSources[i[0].dataSourceId];o=!t||t.type!==s.ArcGISDataSourceTypes.WebMap&&t.type!==s.ArcGISDataSourceTypes.WebScene?(0,e.Immutable)({dataSourceId:i[0].dataSourceId,mainDataSourceId:i[0].mainDataSourceId,dataViewId:i[0].dataViewId,rootDataSourceId:i[0].rootDataSourceId}):null}}const r=this.props.widgetId,n=a.widgets[r];if(this.props.config.actionUseDataSource)i=this.checkAndGetInitUseDataSource(this.props.widgetId,this.props.config.actionUseDataSource);else if(n&&n.useDataSources&&n.useDataSources[0]&&1===n.useDataSources.length){const t=a.dataSources[n.useDataSources[0].dataSourceId];i=!t||t.type!==s.ArcGISDataSourceTypes.WebMap&&t.type!==s.ArcGISDataSourceTypes.WebScene?(0,e.Immutable)({dataSourceId:n.useDataSources[0].dataSourceId,mainDataSourceId:n.useDataSources[0].mainDataSourceId,dataViewId:n.useDataSources[0].dataViewId,rootDataSourceId:n.useDataSources[0].rootDataSourceId}):null}const c=this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.dataSourceId;return(i&&i.dataSourceId)!==c?{messageUseDataSource:o,actionUseDataSource:i,sqlExprObj:null}:{messageUseDataSource:o,actionUseDataSource:i,sqlExprObj:this.props.config.sqlExprObj}},this.checkAndGetInitUseDataSource=(t,a)=>{var o,i,r,n;const c=(0,e.getAppStore)().getState().appStateInBuilder.appConfig;let l=null,u=!1;const d=null===(i=null===(o=e.DataSourceManager.getInstance().getDataSource(a.dataSourceId))||void 0===o?void 0:o.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget,p=I(t,this.props.messageType),S=p&&p[0]&&p[0].dataSourceId;if(!S)return null;const g=c.dataSources[S];if(!g||g.type!==s.ArcGISDataSourceTypes.WebMap&&g.type!==s.ArcGISDataSourceTypes.WebScene||(u=!0),u){let e=!1;if(p)for(let t=0;t<p.length;t++)if(p[t].dataSourceId===a.rootDataSourceId){e=!0;break}l=e?a:null}else{let t=!1;if(p)for(let e=0;e<p.length;e++){const o=d?null==a?void 0:a.mainDataSourceId:null==a?void 0:a.dataSourceId;if((d?null===(r=p[e])||void 0===r?void 0:r.mainDataSourceId:null===(n=p[e])||void 0===n?void 0:n.dataSourceId)===o){t=!0;break}}l=t?a:1===(null==p?void 0:p.length)?(0,e.Immutable)({dataSourceId:null==p?void 0:p[0].dataSourceId,mainDataSourceId:null==p?void 0:p[0].mainDataSourceId,dataViewId:null==p?void 0:p[0].dataViewId,rootDataSourceId:null==p?void 0:p[0].rootDataSourceId}):null}return l},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleActionLayerChange=e=>{e&&e.length>0?this.handleActionLayerSelected(e[0]):this.handleRemoveLayerForActionLayer()},this.handleTriggerLayerSelected=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",e)})},this.handleActionLayerSelected=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",e).set("sqlExprObj",null)})},this.handleRemoveLayerForTriggerLayer=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",null)})},this.handleRemoveLayerForActionLayer=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",null).set("sqlExprObj",null)})},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("sqlExprObj",e)})},this.onMessageFieldSelected=(e,t)=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",{dataSourceId:this.props.config.messageUseDataSource.dataSourceId,mainDataSourceId:this.props.config.messageUseDataSource.mainDataSourceId,dataViewId:this.props.config.messageUseDataSource.dataViewId,rootDataSourceId:this.props.config.messageUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))})})},this.onActionFieldSelected=(e,t)=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",{dataSourceId:this.props.config.actionUseDataSource.dataSourceId,mainDataSourceId:this.props.config.actionUseDataSource.mainDataSourceId,dataViewId:this.props.config.actionUseDataSource.dataViewId,rootDataSourceId:this.props.config.actionUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))})})},this.swicthEnabledDataRelationShip=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("enabledDataRelationShip",e)})},this.checkTrigerLayerIsSameToActionLayer=()=>!(!this.props.config.messageUseDataSource||!this.props.config.actionUseDataSource)&&(this.props.config.messageUseDataSource.mainDataSourceId===this.props.config.actionUseDataSource.mainDataSourceId&&this.props.config.messageUseDataSource.rootDataSourceId===this.props.config.actionUseDataSource.rootDataSourceId),this.getDsRootIdsByWidgetId=t=>{var a,o,i,r;const n=null===(o=null===(a=(0,e.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===o?void 0:o.appConfig,c=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[t],l=[],u=e.DataSourceManager.getInstance();return null===(r=null==c?void 0:c.useDataSources)||void 0===r||r.forEach((e=>{const t=u.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==s.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==s.ArcGISDataSourceTypes.WebScene||l.push(e.dataSourceId)})),l.length>0?(0,e.Immutable)(l):void 0},this.getDsIdsByWidgetId=t=>{const a=I(t,this.props.messageType),o=null==a?void 0:a.map((e=>null==e?void 0:e.mainDataSourceId));return(0,e.Immutable)(null!=o?o:[])},this.getDsSelectorSourceData=(t,a)=>{var o,s,i;const r=null===(s=null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===s?void 0:s.appConfig,n=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[t],c=this.getDsRootIdsByWidgetId(t);return{isReadOnly:y(n,this.props.messageType,c),useDataSources:a&&a.dataSourceId?(0,e.Immutable)([a]):(0,e.Immutable)([]),fromRootDsIds:c,fromDsIds:c?void 0:this.getDsIdsByWidgetId(t)}},this.checkIsDisableDataView=t=>{var a,o,s,i;if(this.props.messageType===e.MessageType.DataRecordsSelectionChange)return!0;const r=null===(o=null===(a=(0,e.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===o?void 0:o.appConfig,n=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[t];if(n){return"Map"===(null===(i=null==n?void 0:n.manifest)||void 0===i?void 0:i.label)}return!1},this.onUseLayersRelationship=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",e.MessageActionConnectionType.UseLayersRelationship)})},this.onSetCustomFields=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",e.MessageActionConnectionType.SetCustomFields)})},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){const e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj)})}getStyle(t){return e.css`
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${t.ref.palette.neutral[900]};
        border: 1px solid ${t.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        .action-select-chooser {
          margin-top: ${e.polished.rem(12)};
        }
      }
    `}render(){var s,i,u,f,I;const{config:y}=this.props,v=y.messageUseDataSource&&e.DataSourceManager.getInstance().getDataSource(y.messageUseDataSource.dataSourceId),x=y.actionUseDataSource&&e.DataSourceManager.getInstance().getDataSource(y.actionUseDataSource.dataSourceId),A=!y.connectionType||y.connectionType===e.MessageActionConnectionType.SetCustomFields,{theme:C}=this.props,U=this.getDsSelectorSourceData(this.props.messageWidgetId,this.props.config.messageUseDataSource),T=this.getDsSelectorSourceData(this.props.widgetId,this.props.config.actionUseDataSource),M=null===(u=null===(i=null===(s=null==C?void 0:C.ref)||void 0===s?void 0:s.palette)||void 0===i?void 0:i.neutral)||void 0===u?void 0:u[900];return(0,e.jsx)("div",{css:this.getStyle(this.props.theme)},(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:n})},(0,e.jsx)(o.DataSourceSelector,{types:w,useDataSources:U.useDataSources,fromRootDsIds:U.fromRootDsIds,fromDsIds:U.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>U.isReadOnly,disableDataSourceList:U.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})),(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_ActionLayer",defaultMessage:c})},(0,e.jsx)(o.DataSourceSelector,{types:w,useDataSources:T.useDataSources,fromRootDsIds:T.fromRootDsIds,fromDsIds:T.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>T.isReadOnly,disableDataSourceList:T.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),this.props.config&&this.props.config.messageUseDataSource&&this.props.config.actionUseDataSource&&(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_Conditions",defaultMessage:d})},(0,e.jsx)(a.SettingRow,{label:this.props.intl.formatMessage({id:"mapAction_RelateMessage",defaultMessage:p})},(0,e.jsx)(t.Switch,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.swicthEnabledDataRelationShip(e.target.checked)}})),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Collapse,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},(0,e.jsx)(b,{messageDataSource:v,actionDataSource:x,connectionType:y.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),this.checkTrigerLayerIsSameToActionLayer()&&(0,e.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"mapAction_AutoBind",defaultMessage:D})),!this.checkTrigerLayerIsSameToActionLayer()&&A&&(0,e.jsx)("div",{className:"w-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"d-flex flex-column relate-panel-left mt-3"},(0,e.jsx)(o.FieldSelector,{className:"w-100",useDataSources:(0,e.Immutable)([null===(f=this.props.config.messageUseDataSource)||void 0===f?void 0:f.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"mapAction_TriggerLayerField",defaultMessage:S}),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,e.Immutable)([])}),(0,e.jsx)(o.FieldSelector,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"mapAction_ActionLayerField",defaultMessage:g}),useDataSources:(0,e.Immutable)([null===(I=this.props.config.actionUseDataSource)||void 0===I?void 0:I.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,e.Immutable)([])})),(0,e.jsx)(t.Icon,{className:"flex-none",width:12,height:40,color:M,icon:l(74587)})))),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Button,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},(0,e.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"mapAction_MoreConditions",defaultMessage:h}))),this.props.config.actionUseDataSource&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(t=>(0,e.jsx)(r.SqlExpressionBuilderPopup,{dataSource:t,mode:e.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)}})))),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&x?e.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,x).displaySQL:this.props.intl.formatMessage({id:"mapAction_SetExpression",defaultMessage:m})))))}}A.defaultProps={config:(0,e.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})};const C=(0,i.withTheme)(A)})(),u})())}}}));