System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var o={},a={},s={},i={},r={},n={};return{setters:[function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.CONSTANTS=e.CONSTANTS,o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.MessageCarryData=e.MessageCarryData,o.MessageType=e.MessageType,o.React=e.React,o.css=e.css,o.getAppStore=e.getAppStore,o.jsx=e.jsx,o.polished=e.polished},function(e){a.NumericInput=e.NumericInput,a.Radio=e.Radio},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){i.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,i.DataSourceSelector=e.DataSourceSelector},function(e){r.withTheme=e.withTheme},function(e){n.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes}],execute:function(){e((()=>{"use strict";var e={62686:e=>{e.exports=n},79244:e=>{e.exports=o},1888:e=>{e.exports=r},14321:e=>{e.exports=a},13089:e=>{e.exports=i},79298:e=>{e.exports=s}},t={};function u(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,u),s.exports}u.d=(e,t)=>{for(var o in t)u.o(t,o)&&!u.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{u.r(c),u.d(c,{default:()=>v});var e=u(79244),t=u(14321),o=u(79298),a=u(13089);const s="Trigger data",i="Zoom scale",r="Automatic",n="Custom",l="Type a scale";var d=u(1888),p=u(62686);function g(t,o){var a,s;const i=I(),r=null===(a=null==i?void 0:i.widgets)||void 0===a?void 0:a[t],n=null===(s=null==r?void 0:r.manifest)||void 0===s?void 0:s.publishMessages;let u=e.MessageCarryData.UseDataSource;return null==n||n.forEach((e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===o&&(u=null==t?void 0:t.messageCarryData)})),u}function S(t,o){if(o===e.MessageType.DataSourceFilterChange){const o=e.DataSourceManager.getInstance().getDataSource(t);if(o&&o.type===e.DataSourceTypes.ImageryLayer)return!1}return!0}function m(t,o,a){var s,i,r,n;const u=I(),c=D(t,a);let l=null,d=!1;const g=c&&c[0]&&c[0].dataSourceId;if(!g)return null;const S=u.dataSources[g];!S||S.type!==p.ArcGISDataSourceTypes.WebMap&&S.type!==p.ArcGISDataSourceTypes.WebScene||(d=!0);const m=null===(i=null===(s=e.DataSourceManager.getInstance().getDataSource(o.dataSourceId))||void 0===s?void 0:s.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget;if(d){let e=!1;if(c)for(let t=0;t<c.length;t++)if(c[t].dataSourceId===o.rootDataSourceId){e=!0;break}l=e?o:null}else{let t=!1;if(c)for(let e=0;e<c.length;e++){const a=m?null==o?void 0:o.mainDataSourceId:null==o?void 0:o.dataSourceId;if((m?null===(r=c[e])||void 0===r?void 0:r.mainDataSourceId:null===(n=c[e])||void 0===n?void 0:n.dataSourceId)===a){t=!0;break}}l=t?o:c&&1===c.length?(0,e.Immutable)({dataSourceId:c[0].dataSourceId,mainDataSourceId:c[0].mainDataSourceId,rootDataSourceId:c[0].rootDataSourceId}):null}return l}function h(t,o,a,s){var i;const r=I(),n=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[t];let u=!1;const c=function(t){var o,a;const s=I(),i=null===(o=null==s?void 0:s.widgets)||void 0===o?void 0:o[t],r=[],n=e.DataSourceManager.getInstance();return null===(a=null==i?void 0:i.useDataSources)||void 0===a||a.forEach((e=>{const t=n.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==p.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==p.ArcGISDataSourceTypes.WebScene||r.push(e.dataSourceId)})),r.length>0?(0,e.Immutable)(r):void 0}(t);let l;if(c&&0!==(null==c?void 0:c.length)||(u=function(t,o,a){const s=g(null==t?void 0:t.id,o),i=(null==t?void 0:t.outputDataSources)||[],r=(null==t?void 0:t.useDataSources)||[];if(a)return!1;switch(s){case e.MessageCarryData.OutputDataSource:return 1===(null==i?void 0:i.length);case e.MessageCarryData.UseDataSource:return 1===(null==r?void 0:r.length);case e.MessageCarryData.BothDataSource:return 1===i.length+r.length}}(n,s,c)),c)l=void 0;else{const o=function(t,o){var a;const s=D(t,o);return(0,e.Immutable)(null!==(a=s.map((t=>{const o=e.DataSourceManager.getInstance().getDataSource(t.dataSourceId);let a;return a=o&&o.isDataView?null==o?void 0:o.getMainDataSource():o,null==a?void 0:a.id})))&&void 0!==a?a:[])}(t,s);l=o.filter((e=>S(e,s)))}return{isReadOnly:u,useDataSource:o,useDataSources:a||(0,e.Immutable)([]),fromRootDsIds:c,fromDsIds:l}}function D(t,o){var a;const s=g(t,o),i=I(),r=null===(a=null==i?void 0:i.widgets)||void 0===a?void 0:a[t],n=(null==r?void 0:r.useDataSources)||(0,e.Immutable)([]),u=function(t){var o;const a=null!==(o=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==o?o:[];return(0,e.Immutable)(a)}(null==r?void 0:r.outputDataSources)||(0,e.Immutable)([]),c=null==n?void 0:n.asMutable({deep:!0}).concat(null==u?void 0:u.asMutable({deep:!0}));switch(s){case e.MessageCarryData.OutputDataSource:return u;case e.MessageCarryData.UseDataSource:return n;case e.MessageCarryData.BothDataSource:return(0,e.Immutable)(c)}}function I(){var t,o,a;return window.jimuConfig.isBuilder?null===(o=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(a=(0,e.getAppStore)().getState())||void 0===a?void 0:a.appConfig}const f=(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.SceneLayer,e.AllDataSourceTypes.BuildingComponentSubLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer]);class y extends e.React.PureComponent{constructor(t){super(t),this.NoLockTriggerLayerWidgets=["Map"],this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=t=>{const o=D(this.props.messageWidgetId,this.props.messageType);let a=null;const s=I(),i=null==s?void 0:s.widgets,r=i&&i[this.props.messageWidgetId];a=this.props.messageType===e.MessageType.DataRecordsSelectionChange&&r&&r.uri&&r.uri.includes("arcgis-map")?t:o.filter((o=>!!t.find((t=>{var a;return t.dataViewId&&t.dataViewId!==e.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(a=this.props.config.useDataSources)||void 0===a?void 0:a.find((e=>t.mainDataSourceId===e.mainDataSourceId)))?t.dataSourceId===o.dataSourceId:t.mainDataSourceId===o.mainDataSourceId}))));let n=this.props.config.set("useDataSource",a[0]);n=n.set("useDataSources",a),this.props.onSettingChange({actionId:this.props.actionId,config:n})},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.props.onSettingChange({actionId:this.props.actionId,config:e})},this.handleIsUseCustomZoomToOption=e=>{!e||this.props.config.zoomToOption&&this.props.config.zoomToOption.scale?this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("isUseCustomZoomToOption",e)}):this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3)})},this.handleSetCustomZoomScale=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.setIn(["zoomToOption","scale"],e)})},this.onZoomToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const o=this.props.config.set("zoomToInitialMapExtentWhenSelectionCleared",t);this.props.onSettingChange({actionId:this.props.actionId,config:o})},this.getTriggerLayerContent=()=>{const t=h(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let o;o=this.checkIsSupportMultipleTriggerDataSources(this.props.messageWidgetId)||t.useDataSources?(0,e.Immutable)(t.useDataSources):t.useDataSource?(0,e.Immutable)([t.useDataSource]):(0,e.Immutable)([]);const s=this.checkIsDisableDataView(this.props.messageWidgetId),i=t.isReadOnly&&s;return(0,e.jsx)(a.DataSourceSelector,{types:f,useDataSources:o,fromRootDsIds:t.fromRootDsIds,fromDsIds:t.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>t.isReadOnly,disableDataSourceList:i,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!1,hideDataView:(e,t)=>!D(this.props.messageWidgetId,this.props.messageType).filter((e=>e.mainDataSourceId===t)).find((t=>{let o;return o=t.dataViewId?t.dataViewId:a.DEFAULT_DATA_VIEW_ID,o===e.id})),isMultiple:this.checkIsSupportMultipleTriggerDataSources(this.props.messageWidgetId),isMultipleDataView:!0,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0})},this.checkIsSupportMultipleTriggerDataSources=t=>{var o,a,s,i;const r=null===(a=null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===a?void 0:a.appConfig,n=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[t],u=D(this.props.messageWidgetId,this.props.messageType);return"Map"===(null===(i=null==n?void 0:n.manifest)||void 0===i?void 0:i.label)||u.length>1&&(this.props.messageType===e.MessageType.DataSourceFilterChange||this.props.messageType===e.MessageType.DataRecordsSelectionChange)},this.checkIsDisableDataView=t=>{if(this.props.messageType===e.MessageType.DataRecordsSelectionChange)return!0},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,disableDataTrigger:t.messageType===e.MessageType.DataRecordSetChange}}componentDidMount(){const t=function(t,o,a){const s=I();let i=null;const r=[];if(t.useDataSource)i=m(o,t.useDataSource,a),t.useDataSources&&t.useDataSources.forEach((e=>{const t=m(o,e,a);t&&r.push(t)}));else{let t=D(o,a);t=t.filter((e=>S(e.dataSourceId,a))),t.length>0&&t.forEach(((t,o)=>{const a=s.dataSources[t.dataSourceId];let n;!a||a.type!==p.ArcGISDataSourceTypes.WebMap&&a.type!==p.ArcGISDataSourceTypes.WebScene?(n=(0,e.Immutable)({dataSourceId:t.dataSourceId,mainDataSourceId:t.mainDataSourceId,rootDataSourceId:t.rootDataSourceId,dataViewId:t.dataViewId}),i||(i=n),r.push(n)):n=null}))}return{useDataSource:i,useDataSources:r}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let o=this.props.config.set("useDataSource",t.useDataSource);o=o.set("useDataSources",t.useDataSources),this.props.onSettingChange({actionId:this.props.actionId,config:o})}getStyle(t){return e.css`
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}render(){return(0,e.jsx)("div",{css:this.getStyle(this.props.theme)},!this.state.disableDataTrigger&&(0,e.jsx)(o.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:s})},this.getTriggerLayerContent()),(0,e.jsx)(o.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:i})},(0,e.jsx)(o.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,e.jsx)("div",{className:"align-items-center d-flex"},(0,e.jsx)(t.Radio,{style:{cursor:"pointer"},checked:!this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!1)}}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:r}))))),(0,e.jsx)(o.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,e.jsx)("div",{className:"align-items-center d-flex"},(0,e.jsx)(t.Radio,{style:{cursor:"pointer"},checked:this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!0)}}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:n}))))),this.props.config.isUseCustomZoomToOption&&(0,e.jsx)(o.SettingRow,null,(0,e.jsx)(t.NumericInput,{className:"w-100",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:l}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:this.handleSetCustomZoomScale}))))}}y.defaultProps={config:(0,e.Immutable)({useDataSource:null})};const v=(0,d.withTheme)(y)})(),c})())}}}));