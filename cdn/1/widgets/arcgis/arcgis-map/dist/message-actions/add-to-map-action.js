System.register(["jimu-core","jimu-arcgis"],(function(e,t){var a={},r={};return{setters:[function(e){a.AbstractMessageAction=e.AbstractMessageAction,a.DataSourceTypes=e.DataSourceTypes,a.DataSourcesChangeType=e.DataSourcesChangeType,a.MessageType=e.MessageType,a.MutableStoreManager=e.MutableStoreManager,a.getAppStore=e.getAppStore},function(e){r.ADD_TO_MAP_DATA_ID_PREFIX=e.ADD_TO_MAP_DATA_ID_PREFIX,r.ActionType=e.ActionType,r.DataChangeType=e.DataChangeType,r.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{"use strict";var e={26826:e=>{e.exports=r},48891:e=>{e.exports=a}},t={};function i(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{i.r(n),i.d(n,{default:()=>a});var e=i(48891),t=i(26826);class a extends e.AbstractMessageAction{filterMessageDescription(t){return t.messageType===e.MessageType.DataSourcesChange}filterMessage(e){return!0}onRemoveListen(t,a){var r;const i=(null===(r=e.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===r?void 0:r.addToMapDatas)||{},n={};Object.entries(i).forEach((e=>{var t;(null===(t=e[1])||void 0===t?void 0:t.messageWidgetId)!==a&&(n[e[0]]=e[1])})),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"addToMapDatas",n)}onExecute(a,r){var i;const n=this._getActiveViewId(this.widgetId,(0,e.getAppStore)().getState().jimuMapViewsInfo),o=this._getDefaultViewId(this.widgetId,(0,e.getAppStore)().getState().jimuMapViewsInfo),s=n||o,d=(null===(i=e.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===i?void 0:i.addToMapDatas)||{};return a.dataSources.forEach((r=>{var i;const g=r;if(!g.supportSpatialInfo||!g.supportSpatialInfo())return;const p=n&&t.MapViewManager.getInstance().getJimuMapViewById(n);if((g.type===e.DataSourceTypes.SceneLayer||g.type===e.DataSourceTypes.SceneService)&&"2d"===(null===(i=null==p?void 0:p.view)||void 0===i?void 0:i.type))return;const u=`${t.ADD_TO_MAP_DATA_ID_PREFIX}messageAction_${this.widgetId}_${g.id}_`,c=`${u}???`,M=n?`${u}${n}`:c;o&&o===n&&d[c]&&e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,`addToMapDatas.${c}.dataChangeType`,t.DataChangeType.Remove),d[M]={mapWidgetId:this.widgetId,messageWidgetId:a.widgetId,jimuMapViewId:s,dataSourceId:g.id,type:t.ActionType.MessageAction,dataChangeType:a.changeType===e.DataSourcesChangeType.Remove?t.DataChangeType.Remove:t.DataChangeType.Create,title:M}})),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"addToMapDatas",d),Promise.resolve(!0)}_getActiveViewId(e,t){return Object.keys(t||{}).find((a=>t[a].mapWidgetId===e&&t[a].isActive))}_getDefaultViewId(e,t){return Object.keys(t||{}).find((a=>t[a].mapWidgetId===e))}}})(),n})())}}}));