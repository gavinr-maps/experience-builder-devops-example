System.register(["jimu-core","jimu-arcgis"],function(e,t){var a={},n={};return{setters:[function(e){a.AbstractMessageAction=e.AbstractMessageAction,a.AppMode=e.AppMode,a.DataSourceManager=e.DataSourceManager,a.DataSourcesChangeType=e.DataSourcesChangeType,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.MutableStoreManager=e.MutableStoreManager,a.RecordSetChangeType=e.RecordSetChangeType,a.getAppStore=e.getAppStore},function(e){n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=a},88217:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAABsklEQVRYCe2WP0vDUBTFz2sLuggZHASX4ORYd4eIi07WybVuOhTrF5BXv0CHIrjVUae2U12EDO7t6CRdBAeHgBR0aJ/vJkUi5OXlplOxB9qG++/8cptXCvx3CdYCZMuDKh4BUw9QLiCcqF8F+noIFIYQkx5kzY/i9vdsALLtQI07epxnH0kV4g6i0IA8H9nqC7aCMK/GA/3pZaqNGqpQkw5kc7Yhc6cdQN5UdbtrHmHMlDEt1Y3ZWcIOoNSFbYgxL4R+XtJlBwDK6SNSs9beUmq7Iek6a2hX9lHeWIezuoLuyysuH58xCj4NHeZwlg386SbzwdkJPHczNKdkZXsrjFGOKzZA82D31zhuRpugrXDFBqC7NYm+Eq7YAMHXt9GDtsAVG2D4/mH06OmHkSs2wGn3CUlboFhdnwSu2AB01HZuH8KjR2Zk7I/ewlieY5jrd4CMju/73JtNrGdvIHHKHMElwHIDC7ABoRq5H3Jl7y1ah/t9H3uH+s+r8Ky18QIyv67JeCjp2g5AXVyIjOY0OhsAB4JhzgPIAsE05wOkQeQwzweQBJHTnEbNJ9mSuNKvRdYP0GGJ/zuVb/EAAAAASUVORK5CYII="}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var s={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(s),o.d(s,{default:()=>A});var e=o(79244),t=o(62686);o(88217);function a(e,t){let a=null;return e.clone?a=e.clone():(a=t.fromJSON(Object.assign({},e)),a.attributes=Object.assign({},e.attributes)),a}function n(t,a,n){if(t&&a){const o=(0,e.getAppStore)().getState().appConfig.messageConfigs;if(o){return r(t,a,o,n,["zoomToFeature"])}}return!1}function r(e,t,a,n,o){if(a){const s=Object.values(a);for(let a=0;a<s.length;a++){const r=s[a];if(r.widgetId===e&&r.messageType===n){const e=r.actions;for(let a=0;a<e.length;a++){const n=e[a];if(n.widgetId===t&&o.includes(n.actionName))return!0}}}}return!1}function i(t,a){var n,o;const s=d(),r=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[t],i=null===(o=null==r?void 0:r.manifest)||void 0===o?void 0:o.publishMessages;let u=e.MessageCarryData.UseDataSource;return null==i||i.forEach(e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(u=null==t?void 0:t.messageCarryData)}),u}function u(t,a){var n;const o=i(t,a),s=d(),r=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[t],u=(null==r?void 0:r.useDataSources)||(0,e.Immutable)([]),c=function(t){var a;const n=null!==(a=null==t?void 0:t.map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null})))&&void 0!==a?a:[];return(0,e.Immutable)(n)}(null==r?void 0:r.outputDataSources)||(0,e.Immutable)([]),g=function(t){const a=[],n=l(t),o=null==n?void 0:n.useMapWidgetIds,s={};(null==o?void 0:o.length)>0&&o.forEach(e=>{if(e){const t=l(e),n=null==t?void 0:t.useDataSources;n&&n.forEach(e=>{var t;const n=null===(t=null==e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});n&&n.dataSourceId&&!s[n.dataSourceId]&&(s[n.dataSourceId]=!0,a.push(n))})}});return(0,e.Immutable)(a)}(t),p=c,A=(null==r?void 0:r.useDataSources)?u:g,S=(0,e.Immutable)(A.asMutable({deep:!0}).concat(p.asMutable({deep:!0})));switch(o){case e.MessageCarryData.OutputDataSource:return p;case e.MessageCarryData.UseDataSource:return A;case e.MessageCarryData.BothDataSource:return S}}function l(e){var t;if(!e)return null;const a=d();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function d(){var t,a,n;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig}function c(){var t;const a=function(){var t;return(null===(t=window.jimuConfig)||void 0===t?void 0:t.isBuilder)?(0,e.getAppStore)().getState().appStateInBuilder:(0,e.getAppStore)().getState()}();return(null===(t=null==a?void 0:a.appRuntimeInfo)||void 0===t?void 0:t.appMode)===e.AppMode.Express}function g(t){const a=(0,e.getAppStore)().getState().appRuntimeInfo.appMode;if(t.messageType===e.MessageType.ExtentChange)return a!==e.AppMode.Express;if(t.messageType===e.MessageType.DataSourcesChange)return!0;if(t.messageType!==e.MessageType.DataRecordSetChange&&t.messageType!==e.MessageType.DataRecordsSelectionChange&&t.messageType!==e.MessageType.DataSourceFilterChange)return!1;{const a=e.DataSourceManager.getInstance(),n=u(t.widgetId,t.messageType);return!(0!==n.length||!function(t){var a;const n=t.widgetId;if((t.messageType===e.MessageType.DataRecordSetChange||t.messageType===e.MessageType.DataRecordsSelectionChange)&&n){const e=l(n);if(e&&"widgets/common/search/"===e.uri&&(null===(a=e.useMapWidgetIds)||void 0===a?void 0:a.length)>0)return!0}return!1}(t))||n.some(e=>{const t=a.getDataSource(e.dataSourceId);return!!t&&("WEB_MAP"===t.type||"WEB_SCENE"===t.type||!!t.getGeometryType())})}}function p(e){const t=c(),a=null==e?void 0:e.useAnyTriggerData;return t||a}class A extends e.AbstractMessageAction{constructor(){super(...arguments),this.NoLockTriggerLayerWidgets=["Map"]}filterMessageDescription(e){return g(e)}filterMessage(e){return!0}getDefaultMessageActionConfig(t){const a={useDataSource:null,useDataSources:[],goToInitialMapExtentWhenSelectionCleared:!1};return t.type!==e.MessageType.DataRecordsSelectionChange&&t.type!==e.MessageType.DataSourceFilterChange||(a.useAnyTriggerData=!0),a}getSettingComponentUri(t,a){const n=(0,e.getAppStore)().getState().appRuntimeInfo.appMode;return t===e.MessageType.DataRecordsSelectionChange||t===e.MessageType.DataSourceFilterChange?n===e.AppMode.Express?null:"message-actions/pan-to-action-setting":null}onExecute(o,s){return(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then(t=>{let r=null;switch([r]=t,o.type){case e.MessageType.DataRecordSetChange:if(n(o.widgetId,this.widgetId,e.MessageType.DataRecordSetChange))break;const t=o;if(t.changeType===e.RecordSetChangeType.CreateUpdate){const n=[];t.dataRecordSets.forEach(e=>{if(e&&e.records)for(let t=0;t<e.records.length;t++){const o=e.records[t].feature;if(o){const e=a(o,r);n.push(e.geometry)}}});const o={type:"pan-to-geometries",geometries:n};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue.value",o)}break;case e.MessageType.DataRecordsSelectionChange:if(n(o.widgetId,this.widgetId,e.MessageType.DataRecordsSelectionChange))break;const i=o.records,u=[];if(i){if(i[0]){const e=function(e,t){var a,n;if(p(t))return!0;if(0===e.length)return!!(null==t?void 0:t.goToInitialMapExtentWhenSelectionCleared);const o=[],s=e[0],r=null===(a=null==s?void 0:s.dataSource)||void 0===a?void 0:a.getMainDataSource();if(r){o.push(r.id);const e=r.getAssociatedDataSource&&r.getAssociatedDataSource();e&&o.push(e.id)}return 0!==o.length&&(null===(n=null==t?void 0:t.useDataSources)||void 0===n?void 0:n.some(e=>(null==e?void 0:e.mainDataSourceId)&&o.includes(null==e?void 0:e.mainDataSourceId)))}(i,s);if(!e)break}for(let e=0;e<i.length;e++){const t=i[e].feature;if(t){const e=a(t,r);u.push(e.geometry)}}}if(u.length>0){const t={type:"pan-to-geometries",geometries:u};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue.value",t)}else if(null==s?void 0:s.goToInitialMapExtentWhenSelectionCleared){const t={type:"pan-to-map-initial-extent"};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue.value",t)}break;case e.MessageType.ExtentChange:if(n(o.widgetId,this.widgetId,e.MessageType.ExtentChange))break;const l=o,d=l.getRelatedWidgetIds();if(d.includes(this.widgetId))break;const c={value:{type:"pan-to-extent",geometries:[l.extent],stationary:l.stationary,publishTime:l.publishTime,publishWidgetId:l.widgetId},relatedWidgets:d};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue",c);break;case e.MessageType.DataSourceFilterChange:if(n(o.widgetId,this.widgetId,e.MessageType.DataSourceFilterChange))break;const g=o,{validChangedDataSourceIds:A,useDataSourceIds:S}=function(e,t){var a,n;let o=[],s=[];const r=e.dataSourceIds||[];return p(t)?(o=r.slice(),s=r.slice()):((null===(a=null==t?void 0:t.useDataSources)||void 0===a?void 0:a.length)>0&&(null===(n=null==t?void 0:t.useDataSources)||void 0===n||n.forEach(e=>{const t=null==e?void 0:e.dataSourceId;t&&s.push(t)})),o=r.filter(e=>s.includes(e))),{validChangedDataSourceIds:o,useDataSourceIds:s}}(g,s);if(0===A.length)break;const h={type:"pan-to-query-params",filterChangedDataSourceIds:A,useDataSourceIds:S};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue.value",h);break;case e.MessageType.DataSourcesChange:if(n(o.widgetId,this.widgetId,e.MessageType.DataSourcesChange))break;const v=o;if(v.changeType===e.DataSourcesChangeType.Create){const t=[];v.dataSources.forEach(e=>{t.push(e.id)});const a={type:"pan-to-layers",dataSourceIds:t};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"panToActionValue.value",a)}}return!0})}}})(),s})())}}});