System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme"],function(e,t){var a={},o={},s={},r={},i={},n={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.CONSTANTS=e.CONSTANTS,o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.MessageCarryData=e.MessageCarryData,o.MessageType=e.MessageType,o.React=e.React,o.classNames=e.classNames,o.css=e.css,o.getAppStore=e.getAppStore,o.polished=e.polished},function(e){s.Checkbox=e.Checkbox,s.Label=e.Label,s.Radio=e.Radio},function(e){r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){i.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,i.DataSourceSelector=e.DataSourceSelector},function(e){n.withTheme=e.withTheme}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=n},13089:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=r}},t={};function u(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,u),s.exports}u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{default:()=>C});var e=u(67386),t=u(79244),a=u(14321),o=u(79298),s=u(13089);const r="Trigger data",i="All data",n="Customized data",l="Return to the initial map extent when selection is cleared";var d=u(1888);function p(e,a){var o,s;const r=f(),i=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[e],n=null===(s=null==i?void 0:i.manifest)||void 0===s?void 0:s.publishMessages;let u=t.MessageCarryData.UseDataSource;return null==n||n.forEach(e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(u=null==t?void 0:t.messageCarryData)}),u}function g(e,a){if(a===t.MessageType.DataSourceFilterChange){const a=t.DataSourceManager.getInstance().getDataSource(e);if(a&&a.type===t.DataSourceTypes.ImageryLayer)return!1}return!0}function S(e,a,o,s){var r,i;let n=null;const u=h(e,o);if(!(u&&u.length>0))return null;let c=!1;if(a){const e=null===(i=null===(r=t.DataSourceManager.getInstance().getDataSource(a.dataSourceId))||void 0===r?void 0:r.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget;c=u.some(t=>!!t&&(v(t.dataSourceId)?t.dataSourceId===a.rootDataSourceId:e||s?a.mainDataSourceId===t.mainDataSourceId:a.dataSourceId===t.dataSourceId))}if(c)n=a;else if(n=null,u&&1===u.length){const e=u[0];e&&e.dataSourceId&&!v(e.dataSourceId)&&(n=(0,t.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,dataViewId:e.dataViewId,rootDataSourceId:e.rootDataSourceId}))}return n}function h(e,a){var o;const s=p(e,a),r=f(),i=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[e],n=(null==i?void 0:i.useDataSources)||(0,t.Immutable)([]),u=function(e){var a;const o=null!==(a=null==e?void 0:e.map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null})))&&void 0!==a?a:[];return(0,t.Immutable)(o)}(null==i?void 0:i.outputDataSources)||(0,t.Immutable)([]),c=function(e){const a=[],o=m(e),s=null==o?void 0:o.useMapWidgetIds,r={};(null==s?void 0:s.length)>0&&s.forEach(e=>{if(e){const t=m(e),o=null==t?void 0:t.useDataSources;o&&o.forEach(e=>{var t;const o=null===(t=null==e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});o&&o.dataSourceId&&!r[o.dataSourceId]&&(r[o.dataSourceId]=!0,a.push(o))})}});return(0,t.Immutable)(a)}(e),l=u,d=(null==i?void 0:i.useDataSources)?n:c,g=(0,t.Immutable)(d.asMutable({deep:!0}).concat(l.asMutable({deep:!0})));switch(s){case t.MessageCarryData.OutputDataSource:return l;case t.MessageCarryData.UseDataSource:return d;case t.MessageCarryData.BothDataSource:return g}}function m(e){var t;if(!e)return null;const a=f();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function D(e,a,o){const s=p(null==e?void 0:e.id,a),r=(null==e?void 0:e.outputDataSources)||[],i=(null==e?void 0:e.useDataSources)||[];if(o)return!1;switch(s){case t.MessageCarryData.OutputDataSource:return 1===(null==r?void 0:r.length);case t.MessageCarryData.UseDataSource:return 1===(null==i?void 0:i.length);case t.MessageCarryData.BothDataSource:return 1===r.length+i.length}}function f(){var e,a,o;return window.jimuConfig.isBuilder?null===(a=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(o=(0,t.getAppStore)().getState())||void 0===o?void 0:o.appConfig}function I(e,a){let o=[];const s=h(e,a);return s&&s.forEach(e=>{const t=null==e?void 0:e.dataSourceId;t&&v(t)&&o.push(t)}),o=Array.from(new Set(o)),o.length>0?(0,t.Immutable)(o):void 0}function y(e,a){const o=h(e,a),s=[];return o&&o.forEach(e=>{const t=null==e?void 0:e.mainDataSourceId;t&&!v(t)&&s.push(t)}),(0,t.Immutable)(s)}function v(e){const a=f();if(e&&a.dataSources){const o=a.dataSources[e];if(o&&(o.type===t.DataSourceTypes.WebMap||o.type===t.DataSourceTypes.WebScene))return!0}return!1}const T=(0,t.Immutable)([t.AllDataSourceTypes.FeatureLayer,t.AllDataSourceTypes.SceneLayer,t.AllDataSourceTypes.BuildingComponentSubLayer,t.AllDataSourceTypes.ImageryLayer,t.AllDataSourceTypes.OrientedImageryLayer,t.AllDataSourceTypes.SubtypeGroupLayer,t.AllDataSourceTypes.SubtypeSublayer]);class b extends t.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.onAllDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!0);this.updateMessageActionConfigAndUseDataSources(e)},this.onCustomizeDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!1);this.updateMessageActionConfigAndUseDataSources(e)},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=e=>{let a=null;if(this.fromRootDsIds)a=e;else{a=h(this.props.messageWidgetId,this.props.messageType).filter(a=>!!e.find(e=>{var o;return e.dataViewId&&e.dataViewId!==t.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(o=this.props.config.useDataSources)||void 0===o?void 0:o.find(t=>e.mainDataSourceId===t.mainDataSourceId))?e.dataSourceId===a.dataSourceId:e.mainDataSourceId===a.mainDataSourceId}))}let o=this.props.config.set("useDataSource",a[0]);o=o.set("useDataSources",a),this.updateMessageActionConfigAndUseDataSources(o)},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.updateMessageActionConfigAndUseDataSources(e)},this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const a=this.props.config.set("goToInitialMapExtentWhenSelectionCleared",t);this.updateMessageActionConfigAndUseDataSources(a)},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const e=function(e,a,o){let s=null;const r=[];if(e.useDataSource){const t=!1;s=S(a,e.useDataSource,o,t),e.useDataSources&&e.useDataSources.forEach(e=>{const s=S(a,e,o,t);s&&r.push(s)})}else{let e=h(a,o);e=e.filter(e=>g(e.dataSourceId,o)),e.length>0&&e.forEach((e,a)=>{let o;v(e.dataSourceId)?o=null:(o=(0,t.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,rootDataSourceId:e.rootDataSourceId,dataViewId:e.dataViewId}),s||(s=o),r.push(o))})}return{useDataSource:s,useDataSources:r}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let a=this.props.config.set("useDataSource",e.useDataSource);a=a.set("useDataSources",e.useDataSources),this.updateMessageActionConfigAndUseDataSources(a)}getStyle(e){return t.css`
      .setting-header {
        padding: ${t.polished.rem(10)} ${t.polished.rem(16)} ${t.polished.rem(0)} ${t.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}updateMessageActionConfigAndUseDataSources(e){const a=function(e){const a=[];return e&&e.useDataSources&&e.useDataSources.forEach(e=>{if(e){const o=(0,t.Immutable)(e).asMutable({deep:!0});a.push(o)}}),a}(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:a})}render(){const u=this.props.messageType===t.MessageType.DataRecordsSelectionChange,c=function(e,a,o,s){var r;const i=f(),n=null===(r=null==i?void 0:i.widgets)||void 0===r?void 0:r[e],u=I(e,s);let c,l=!1;l=!(u&&u.length>0)&&D(n,s,u),c=u&&u.length>0?void 0:y(e,s).filter(e=>g(e,s));return{isReadOnly:l,useDataSource:a,useDataSources:o||(0,t.Immutable)([]),fromRootDsIds:u,fromDsIds:c}}(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let d;d=c.useDataSources?(0,t.Immutable)(c.useDataSources):c.useDataSource?(0,t.Immutable)([c.useDataSource]):(0,t.Immutable)([]);const p=this.props.config.goToInitialMapExtentWhenSelectionCleared||!1,S=!c.isReadOnly;let m,v,b=null;u?(b=!0,m=!1,v=!0):(b=(e,t)=>!h(this.props.messageWidgetId,this.props.messageType).filter(e=>e.mainDataSourceId===t).find(t=>{let a;return a=t.dataViewId?t.dataViewId:s.DEFAULT_DATA_VIEW_ID,a===e.id}),m=!0,v=!1),this.fromRootDsIds=c.fromRootDsIds;const C=!!this.props.config.useAnyTriggerData,A=this.props.intl.formatMessage({id:"mapAction_AllData",defaultMessage:i}),M=this.props.intl.formatMessage({id:"mapAction_CustomizeData",defaultMessage:n});return(0,e.jsxs)("div",{css:this.getStyle(this.props.theme),children:[(0,e.jsxs)(o.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:r}),children:[(0,e.jsx)(o.SettingRow,{children:(0,e.jsxs)(a.Label,{className:"d-flex align-items-center",children:[(0,e.jsx)(a.Radio,{className:"mr-2",checked:C,onChange:()=>{this.onAllDataRadioChecked()}}),A]})}),(0,e.jsx)(o.SettingRow,{children:(0,e.jsxs)(a.Label,{className:"d-flex align-items-center",children:[(0,e.jsx)(a.Radio,{className:"mr-2",checked:!C,onChange:()=>{this.onCustomizeDataRadioChecked()}}),M]})}),(0,e.jsx)(o.SettingRow,{children:(0,e.jsx)(s.DataSourceSelector,{className:(0,t.classNames)([{"d-none":C}]),types:T,useDataSources:d,fromRootDsIds:c.fromRootDsIds,fromDsIds:c.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>c.isReadOnly,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,isMultiple:S,hideDataView:b,isMultipleDataView:m,disableDataView:v,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0})})]}),u&&(0,e.jsx)(o.SettingSection,{children:(0,e.jsxs)(a.Label,{className:"d-flex align-items-center",children:[(0,e.jsx)(a.Checkbox,{checked:p,className:"mr-2",onChange:this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged}),this.props.intl.formatMessage({id:"mapAction_ReturnToInitialMapExtent",defaultMessage:l})]})})]})}}b.defaultProps={config:(0,t.Immutable)({useDataSource:null})};const C=(0,d.withTheme)(b)})(),c})())}}});