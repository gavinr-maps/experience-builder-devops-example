System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-ui","jimu-layouts/layout-runtime","jimu-theme"],function(e,t){var i={},o={},s={},a={},n={},l={};return{setters:[function(e){i.Fragment=e.Fragment,i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){o.AppMode=e.AppMode,o.AppStateManager=e.AppStateManager,o.BaseVersionManager=e.BaseVersionManager,o.CONSTANTS=e.CONSTANTS,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceSelectionMode=e.DataSourceSelectionMode,o.DataSourceTypes=e.DataSourceTypes,o.ErrorBoundary=e.ErrorBoundary,o.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties,o.ExtentChangeMessage=e.ExtentChangeMessage,o.Immutable=e.Immutable,o.JSAPILayerTypes=e.JSAPILayerTypes,o.LocationChangeMessage=e.LocationChangeMessage,o.MessageManager=e.MessageManager,o.MessageType=e.MessageType,o.MutableStoreManager=e.MutableStoreManager,o.PageVisibilityContext=e.PageVisibilityContext,o.React=e.React,o.ReactDOM=e.ReactDOM,o.ReactRedux=e.ReactRedux,o.ReactResizeDetector=e.ReactResizeDetector,o.ServiceManager=e.ServiceManager,o.SessionManager=e.SessionManager,o.TimezoneConfig=e.TimezoneConfig,o.UrlManager=e.UrlManager,o.ViewVisibilityContext=e.ViewVisibilityContext,o.WIDGET_PREFIX_FOR_A11Y_SKIP=e.WIDGET_PREFIX_FOR_A11Y_SKIP,o.appActions=e.appActions,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.geometryUtils=e.geometryUtils,o.getAppStore=e.getAppStore,o.i18n=e.i18n,o.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,o.loadArcGISMapComponents=e.loadArcGISMapComponents,o.lodash=e.lodash,o.observeStore=e.observeStore,o.polished=e.polished,o.portalUrlUtils=e.portalUrlUtils,o.serviceUrlUtils=e.serviceUrlUtils},function(e){s.ActionType=e.ActionType,s.DataChangeStatus=e.DataChangeStatus,s.DataChangeType=e.DataChangeType,s.JimuMapViewComponent=e.JimuMapViewComponent,s.MapViewManager=e.MapViewManager,s.basemapUtils=e.basemapUtils,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,s.portalUtils=e.portalUtils,s.zoomToUtils=e.zoomToUtils},function(e){a.Button=e.Button,a.DataActionList=e.DataActionList,a.DataActionListStyle=e.DataActionListStyle,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Icon=e.Icon,a.Image=e.Image,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.MobilePanel=e.MobilePanel,a.MobilePanelManager=e.MobilePanelManager,a.Nav=e.Nav,a.NavItem=e.NavItem,a.NavLink=e.NavLink,a.Paper=e.Paper,a.Popper=e.Popper,a.Progress=e.Progress,a.Radio=e.Radio,a.SVG=e.SVG,a.defaultMessages=e.defaultMessages},function(e){n.LayoutEntry=e.LayoutEntry,n.ViewportVisibilityContext=e.ViewportVisibilityContext},function(e){l.Global=e.Global}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},3737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M13.43 3H5.298L7.95 5.652 3 10.602 5.83 13.43l4.95-4.95 2.65 2.652zm-7.601 9.016L4.414 10.6l4.95-4.95L7.712 4h4.718v4.718l-1.652-1.652z" clip-rule="evenodd"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},9206:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M0 9v6h16V9zm15 3h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-3H8v3H7v-2H6v2H5v-3H4v3H3v-2H2v2H1v-4h14zm.18-7.5-2.85 2.85-.71-.7L13.23 5H9V4h4.32l-1.7-1.69.71-.7zM2.68 4H7v1H2.77l1.61 1.65-.71.7L.82 4.5l2.85-2.85.71.7z"></path></svg>'},10272:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#363636" fill-rule="nonzero" d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM16 0v11H8.5v-1H15V1H6v2.5H5V0z"></path></svg>'},14321:e=>{"use strict";e.exports=a},15181:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M3 3v8.132L5.652 8.48l4.95 4.95L13.43 10.6l-4.95-4.95L11.132 3zm9.016 7.601L10.6 12.015l-4.95-4.95L4 8.719V4h4.718L7.066 5.652z" clip-rule="evenodd"></path></svg>'},19086:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 10"><path fill="#000" fill-rule="nonzero" d="M0 10h15V4H0zm1-5h13v4h-1V6h-1v3h-1V7h-1v2H9V6H8v3H7V7H6v2H5V6H4v3H3V7H2v2H1zm11-5v1H3V0H0v3h3V2h9v1h3V0zM2 2H1V1h1zm12 0h-1V1h1z"></path></svg>'},20561:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#363636" fill-rule="nonzero" d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM12 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4"></path></svg>'},22459:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="#363636" fill-rule="nonzero"><path d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM9.72 1.11l.588-.808 5.082 3.7-4.577 2.656L14.61 9.49l-.598.801L9 6.555l4.56-2.649z"></path></g></svg>'},32945:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="m14.376 10.573 1.647.927-8 4.5-8-4.5 1.648-.927 1.02.574-.628.353 5.96 3.353 5.96-3.353-.627-.353zm-.999-2.414.606.341-5.96 3.353L2.063 8.5l.607-.341-1.02-.574L.023 8.5l8 4.5 8-4.5-1.626-.915zM8.023 1.023l-8 4.5 8 4.5 8-4.5zm-5.96 4.5 5.96-3.352 5.96 3.352-5.96 3.353z"></path></svg>'},37175:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1zM6.318 13.682a4.5 4.5 0 0 0 5.991.334l1.848 1.848.707-.707-1.847-1.848a4.5 4.5 0 1 0-6.699.373m.707-.707a3.5 3.5 0 1 1 4.95-4.95 3.5 3.5 0 0 1-4.95 4.95M9 13v-2H7v-1h2V8h1v2h2v1h-2v2z" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=n},43058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M.4 8 8 1.92V5.5h7v5H8v3.58zM7 9.5h7v-3H7V4L2 8l5 4z" clip-rule="evenodd"></path></svg>'},47717:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39 32"><path d="M38.784 9.778v2.962H3.236V9.778h.074L13.086.002l2.111 2.111-7.702 7.665zM3.236 21.628h31.327l-7.702 7.702 2.111 2.111 9.776-9.813h.037v-2.962H3.237v2.962z"></path></svg>'},49798:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M1 11v4.001L5 15v1H0v-5zm15 0v5h-5v-1l4 .001V11zM5 0v1L1 .999V5H0V0zm11 0v5h-1V.999L11 1V0z"></path></svg>'},50045:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16"><g fill="#363636" fill-rule="nonzero"><path d="m.75 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z"></path><path d="M8.721 0c1.82 0 2.865 1.556 2.865 4.35 0 .462.12.66.385.774.219.093.473.126.99.131h.551l.397.009c1.251.05 1.807.336 2.04 1.333.41 1.76-1.62 3.114-5.904 4.313l-.326.09-.245-.999.64-.18c3.516-1.02 5.088-2.089 4.88-2.979-.094-.407-.382-.535-1.304-.553l-.787-.002c-.62-.008-.943-.055-1.3-.207-.648-.276-.998-.859-.998-1.73 0-2.286-.694-3.318-1.884-3.318-.731 0-1.68.55-2.815 1.685l-.215.22L5 2.203C6.398.748 7.626 0 8.721 0"></path></g></svg>'},53089:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#050505" d="m12.687 9.074.073-.133a.15.15 0 0 0 .017-.078l-.012-.142c-.002-.033-.042-.051-.068-.028l-.205.175a.1.1 0 0 1-.019.01l-.092.017a.04.04 0 0 0-.033.051l.019.077a.14.14 0 0 0 .093.097l.07.02a.134.134 0 0 0 .157-.066M13.8 9.389a.13.13 0 0 0 .058-.014l.141-.069q.002 0 .003.002l.104.13q.008.01.023.01h.069a.028.028 0 0 0 .023-.046l-.108-.141-.047-.04-.382-.191-.092.036h-.07v-.001l-.026-.084a.027.027 0 0 0-.025-.019h-.093a.027.027 0 0 0-.027.028v.082h.06v.024c0 .03.023.055.052.06l.136.016h.001l.074.093c.023.028.019.097-.006.125v.001h.131zM13.878 6.775l-.048.043a.3.3 0 0 0-.094.187.3.3 0 0 1-.082.178.5.5 0 0 1-.246.136l-.018.004-.076.062s-.022.11 0 .135c.009.012.049.01.061 0 .016-.012.017-.08.017-.08l.242-.087s.06.08.09.083c.012.002.042-.013.05-.025.032-.045.068-.208.068-.208a.6.6 0 0 0 .024-.113l.013-.143.108-.007.043-.087-.112-.011zM9.427 10.12a.141.141 0 0 0 .245 0v-.334a.122.122 0 0 0-.187-.105.13.13 0 0 0-.058.105zM6.698 4.315l.144-.084.002-.006a.065.065 0 0 0-.026-.085.1.1 0 0 0-.031-.008h-.328l-.035-.038a.22.22 0 0 0-.157-.074L5.778 4l-.048.009-.048.009-.289.122a.2.2 0 0 1-.076.018l-.464.023a.2.2 0 0 0-.099.028l-.26.148a.03.03 0 0 0-.015.024.03.03 0 0 0 .012.026c.02.015.014.047-.01.053l-.203.051a.03.03 0 0 0-.019.044l.068.112a.03.03 0 0 0 .02.014l.364.063c.056.01.106.04.14.086l.251.333.074.102a.094.094 0 0 1-.007.118l-.056.06a.09.09 0 0 0-.015.105l.183.37a.13.13 0 0 0 .081.068.223.223 0 0 0 .274-.142l.048-.137a.1.1 0 0 1 .04-.05l.204-.175a.24.24 0 0 1 .085-.046l.32-.088a.22.22 0 0 0 .148-.133l.151-.378a.23.23 0 0 0-.001-.172l-.03-.07a.23.23 0 0 1 .097-.28M4.03 4.643l.061-.11a.2.2 0 0 1 .088-.087l.504-.282-.057-.066-.572-.035a.2.2 0 0 0-.05.003l-.557.09a.232.232 0 0 0-.137.377l.125.148c.043.051.107.08.172.08h.224a.23.23 0 0 0 .199-.118M4.666 5.672l.052-.061c.013-.016.01-.04-.007-.051l-.162-.116-.569-.425a.14.14 0 0 0-.081-.027h-.224a.13.13 0 0 0-.095.04l-.118.115a.034.034 0 0 0-.003.047l.067.085q.01.015.03.014l.064-.006a.035.035 0 0 1 .038.033l.002.038q0 .007-.002.016l-.03.073a.04.04 0 0 0 .006.036l.07.084a.03.03 0 0 0 .028.012l.068-.003a.035.035 0 0 0 .034-.035v-.147c0-.019.014-.034.032-.035l.094-.007q.014 0 .024.007l.174.133c.013.011.017.029.01.044l-.057.116a.03.03 0 0 1-.03.018l-.054.004a.04.04 0 0 0-.032.027.036.036 0 0 0 .032.044l.117.009q.037.002.069.024l.206.146q.022.014.043-.003l.065-.055a.03.03 0 0 0 .011-.018l.021-.083a.04.04 0 0 0-.004-.029l-.07-.11.022-.004a.04.04 0 0 1 .024.004l.091.054a.035.035 0 0 0 .044-.008M2.08 5.137h.07l.104.146q.02.027.05.044l.136.068q.028.015.061.015h.422V5.27l-.156-.056-.18-.097A.14.14 0 0 1 2.52 5.1l-.288-.166a.13.13 0 0 0-.067-.018h-.173a.14.14 0 0 0-.13.095l-.014.047a.14.14 0 0 0 .033.14l.061.062h.138zM2.679 5.022l.11-.058a.14.14 0 0 1 .063-.015h.06c.052 0 .1.03.123.078l.044.092v.094h-.2v-.12l-.084-.043-.1.003zM3.061 4.95l.1.164.08.047h.115l.116-.124-.088-.116-.225.028zM2.414 4.698l.158.057a.1.1 0 0 1 .03.015l.109.073q.027.019.06.021l.2.02-.024-.124-.238-.132a.14.14 0 0 0-.065-.017h-.122zM7.46 5.712l.058.092a.03.03 0 0 1-.001.028l-.044.06q-.007.013-.004.022l.017.061a.02.02 0 0 0 .008.012l.092.072c.063.048.07.141.017.2l-.001.002a.14.14 0 0 1-.101.046h-.11a.025.025 0 0 1-.024-.031l.028-.11a.02.02 0 0 1 .014-.017l.049-.024q.015-.008.013-.026l-.002-.03a.03.03 0 0 0-.02-.021l-.071-.015a.024.024 0 0 0-.027.014l-.016.035v.002l-.001.002-.035.118q-.006.017-.024.018l-.11-.003a.02.02 0 0 1-.018-.007.02.02 0 0 1-.007-.017v-.127c0-.013.011-.024.024-.024l.058-.002q.012 0 .02-.01l.053-.079A.03.03 0 0 0 7.3 5.94V5.82q0-.012.01-.019l.115-.094a.024.024 0 0 1 .037.005"></path><path fill="#050505" fill-rule="evenodd" d="M15.073 5.1H14.7a.04.04 0 0 1-.04-.03l-.358-.069a.16.16 0 0 1-.088-.027l-.081-.055a.16.16 0 0 0-.088-.027s-.832-.43-1.922-.388c-.41.016-.77.222-.77.222a.03.03 0 0 0-.02.026l-.004.034a.033.033 0 0 1-.033.028l-.164-.004a.033.033 0 0 0-.034.032l-.459.016c-.04 0-.077.02-.1.053l-.041.06c-.03.045-.441.06-.441.06a.06.06 0 0 1-.036-.055v-.049q0-.026.02-.044l.218-.2a.16.16 0 0 1 .087-.04l.136-.018a.06.06 0 0 0 .04-.024l.016-.024a.06.06 0 0 0-.028-.09l-.01-.005a.06.06 0 0 0-.047.004l-.104.061a.1.1 0 0 1-.03.008h-.101a.16.16 0 0 0-.114.049l-.244.252a.17.17 0 0 0-.042.08l-.023.11.016.047-.096.135-.087.087h-.081v-.087H9.45l-.028.11a.16.16 0 0 1-.098.11l-.081.032a.16.16 0 0 1-.156-.026l-.106-.086.284.015.032-.062S9 5.18 8.828 5.084c-.14-.08-.324-.013-.388.016a.2.2 0 0 0-.042.027l-.62.565a.16.16 0 0 0-.006.231l.058.061.083-.069a.06.06 0 0 1 .076.003l.155.146h.04l.146-.176a.06.06 0 0 0 .002-.072l-.019-.026a.06.06 0 0 1-.004-.066l.204-.334a.04.04 0 0 1 .052-.017l.036.018c.022.01.03.035.019.057l-.14.268a.13.13 0 0 0-.01.104l.023.071a.18.18 0 0 1-.03.146l-.087.12a.16.16 0 0 1-.134.064l-.254-.01a.05.05 0 0 1-.031-.013.05.05 0 0 1-.013-.032v-.042a.045.045 0 0 0-.046-.046.046.046 0 0 0-.045.042l-.007.074a.046.046 0 0 1-.045.042h-.024a.04.04 0 0 0-.03.012l-.414.386.06.088v.093a.057.057 0 0 1-.056.056h-.132c-.071 0-.127.06-.123.132l.001.018a.124.124 0 0 0 .119.116l.141.004a.16.16 0 0 0 .135-.068l.101-.144a.16.16 0 0 1 .13-.067h.097q.05 0 .09.028l.157.11c.03.022.033.068.004.092l-.088.077a.16.16 0 0 1-.104.04h-.55a.16.16 0 0 0-.126.064l-.425.573a.17.17 0 0 0-.032.096v.38q0 .054.032.097l.148.198q.018.025.027.055c.01.033.036.08.1.08h.686s.172.005.172.12q0 .061-.003.116a.16.16 0 0 0 .083.148c.048.028.099.077.099.155v.21a.2.2 0 0 1-.007.049.8.8 0 0 1-.079.178c-.036.054.015.135.052.182a.17.17 0 0 1 .035.102v.21s.016.076.088.109a.6.6 0 0 1 .097.05v.084c0 .09.071.16.16.16h.207s.094.008.155-.087l.28-.437s.04-.043 0-.12c-.04-.076-.021-.145-.021-.145l.19-.11s.09-.016.09-.141v-.136a.1.1 0 0 0-.018-.062l-.033-.057a.16.16 0 0 1 .021-.191l.395-.424s.104-.156.104-.235H9.49a.16.16 0 0 1-.136-.077l-.346-.576a.087.087 0 0 1 .033-.121.084.084 0 0 1 .112.03l.335.552-.001.05c0 .016.012.028.028.028.083 0 .327-.01.463-.13a.6.6 0 0 0 .143-.181.16.16 0 0 0-.038-.19l-.085-.076-.11.025-.197-.199a.063.063 0 0 1 .016-.1.06.06 0 0 1 .065.007l.307.238s.063.056.127.056h.18c.056 0 .108.03.136.078l.402.683s.06.056.094.054c.035-.003.082-.15.082-.15 0-.136.065-.266.176-.344l.138-.098a.16.16 0 0 1 .202.015l.085.083v.09c0 .014.012.027.028.027h.038l.036-.036h.042v.359c0 .04.015.08.043.109l.267.288v-.103a.16.16 0 0 0-.035-.1l-.125-.158a.16.16 0 0 1-.035-.1v-.109c0-.017.021-.026.033-.013l.162.167.004.105c.001.02.025.03.038.015l.229-.25s.066-.083 0-.152a5 5 0 0 0-.158-.154.05.05 0 0 1-.016-.039.05.05 0 0 1 .019-.038l.044-.037.11.002s-.023.052-.058.112c0 0 .017.096.123-.083.008-.007.036-.003.067.002.04.006.084.014.1-.002.06-.064.309-.407.309-.407s.032-.126-.043-.192c-.076-.066-.043-.147-.043-.147l.094-.082v-.058h-.244s.02-.13.194-.139l.031-.001q.016 0 .03-.002a.13.13 0 0 1 .127.083q.01.024.01.052v.243l.036.004s.068.007.093-.084c0 0 .046-.013.046-.068v-.066l-.066-.08.107-.138a.12.12 0 0 1 .075-.045l.054-.011a.13.13 0 0 0 .08-.053l.247-.373a.17.17 0 0 0 .027-.09v-.102a.05.05 0 0 0-.05-.05h-.144s-.06-.07.022-.12c.057-.035.169-.128.232-.18a.16.16 0 0 1 .101-.038h.29a.16.16 0 0 0 .093-.03l.19-.137a.04.04 0 0 1 .025-.008c.082 0 .125.1.07.162l-.198.214a.16.16 0 0 0-.043.106l-.003.173c0 .032.026.06.059.06h.048l.259-.268a.13.13 0 0 0 .033-.066l.01-.056a.16.16 0 0 1 .155-.134h.114a.15.15 0 0 0 .104-.039l.159-.14a.04.04 0 0 1 .028-.01h.082a.042.042 0 0 0 .043-.044v-.08q0-.02.013-.032l.062-.058a.16.16 0 0 1 .181-.024l.104.055a.06.06 0 0 0 .076-.016l.051-.065a.06.06 0 0 0 .012-.052.06.06 0 0 0-.033-.042l-.503-.25a5 5 0 0 0-.39-.014M8.141 7.024l.09-.078zl-.133-.163a.1.1 0 0 1-.01-.019.1.1 0 0 0 .01.018zm.755.493h-.081a.1.1 0 0 1-.032-.004 9 9 0 0 1-.61-.186.06.06 0 0 1-.035-.045.06.06 0 0 1 .015-.055l.11-.117a.094.094 0 0 1 .13.005l.1.107.087-.016-.024-.064s-.01-.03-.021-.056.048-.061.048-.061.06-.006.06.088c0 .093.097.163.097.163h.332c.021 0 .035.023.024.04l-.059.113a.16.16 0 0 1-.141.088m.417-.503H9.2l-.083-.065a.06.06 0 0 0-.032-.01h-.108a.07.07 0 0 0-.044.017l-.078.07-.078.012a.05.05 0 0 1-.056-.026.1.1 0 0 1-.006-.02l-.011-.087a.1.1 0 0 1 .021-.069l.128-.145.058-.005-.003.026a.05.05 0 0 0 .05.058h.029a.07.07 0 0 0 .064-.042l.026-.058.12.02.01.087a.08.08 0 0 0 .026.048l.133.112v.025c0 .03-.023.052-.053.052m.574.093v.099h-.205l-.018-.099a.05.05 0 0 1 .008-.039l.011-.015a.05.05 0 0 0-.008-.069l-.096-.089v-.163l.14-.06h.072c.028 0 .052.019.06.046l.001.004q.008.031-.013.056a.1.1 0 0 0-.015.031l-.013.085.113.105-.08.054z" clip-rule="evenodd"></path><path fill="#050505" d="M12.945 7.8q-.008-.022-.017-.021t-.036.025a.11.11 0 0 0-.039.08q0 .03.012.062c.007.018.02.032.028.032.025 0 .066-.14.052-.178M12.894 8.108l.024.005.014.004q.026.008.033.015.006.007.013.03l.004.014c.008.027.002.053-.018.07-.046.037-.038.057.03.072.047.01.061.024.061.062 0 .046-.003.046-.055.019-.03-.016-.06-.023-.065-.016q-.009.012.014.021c.055.02.086.071.074.12-.014.057.014.066.059.02.048-.049.089.023.078.136-.004.038-.038.055-.09.043a.1.1 0 0 1-.022-.012.04.04 0 0 1-.013-.027c0-.024-.013-.029-.051-.02s-.05.006-.05-.018a.05.05 0 0 1 .03-.044q.02-.006.02-.017 0-.01-.02-.038a.2.2 0 0 1-.03-.08c0-.02-.008-.037-.019-.037-.027 0-.088-.193-.063-.201q.007-.004.012-.016a.2.2 0 0 0 .009-.053c0-.04.003-.054.021-.052M12.8 8.567c.047-.044.072-.116.04-.116-.014 0-.082.079-.11.129-.03.052.009.045.07-.013M12.912 8.698a.02.02 0 0 1 .021.02q0 .018-.008.02s-.005 0-.007-.003a.1.1 0 0 1-.015-.017q-.01-.018.01-.02M13.254 8.913q-.021-.045-.044-.043t-.03.05a.1.1 0 0 1-.01.026c.013.052.052.06.064.063h.004l.025-.029.014-.015zM13.082 8.894c.026-.004.035.015.011.043l-.008.015-.057.01-.036.005c-.038.006-.077.011-.1.037q0 .006.01.009t.032-.001l.006-.003.005-.003.02-.002.064.008-.004.006h-.002l-.005.004-.013.008c-.03.026-.044.054-.034.067.008.012.015.04.015.062-.002.053-.066.067-.079.017q-.009-.035-.012.021c-.001.044-.011.057-.038.051-.02-.004-.035-.025-.035-.047a.14.14 0 0 0-.016-.065c-.008-.013-.006-.048.006-.078.007-.019.009-.028.01-.036l.002-.006.012-.032.018-.05-.003.001c.028-.026.056-.032.1-.022l.032.004a.15.15 0 0 0 .068-.012q.015-.009.031-.011M13.36 9.136c0-.027-.034-.042-.092-.042a1 1 0 0 0-.064.006c-.08.012-.103.027-.08.051.02.02.236.007.236-.015M5.866 9.362l-.35-.185a.2.2 0 0 0-.102-.026h-.101a.04.04 0 0 1-.037-.033.22.22 0 0 0-.218-.201h-.032a.22.22 0 0 1-.173-.088l-.048-.065a.22.22 0 0 0-.155-.086l-.262-.023a.03.03 0 0 1-.017-.007l-.043-.03q-.019-.012-.038 0l-.187.106a.2.2 0 0 1-.108.028h-.192a.04.04 0 0 1-.017-.004.15.15 0 0 1-.071-.133v-.112a.04.04 0 0 0-.023-.035l-.014-.003h-.122a.04.04 0 0 1-.032-.019.04.04 0 0 1 0-.038l.057-.1a.04.04 0 0 0 .006-.02V8.2q0-.016-.011-.027a.04.04 0 0 0-.027-.011h-.066a.04.04 0 0 0-.03.017l-.038.06a.22.22 0 0 1-.184.1h-.054s-.086-.015-.086-.108v-.339a.1.1 0 0 1 .045-.067c.032-.02.107-.061.144-.081a.04.04 0 0 1 .043.005l.07.066q.01.01.024.01h.015c.022 0 .051 0 .057-.003q.005-.003.003-.014c0-.017 0-.046.045-.06.066-.019.109.04.109.04l.165.199a.04.04 0 0 0 .05.006l.023-.016a.04.04 0 0 0 .012-.05l-.002-.005a.22.22 0 0 1 .048-.28l.137-.118s.016-.01.024-.071c.005-.037.015-.09.021-.128l.021-.036.02-.036.297-.252a.036.036 0 0 1 .055.008c.014.022.038.046.069.045a.8.8 0 0 0 .208-.093.04.04 0 0 0 .019-.033v-.047l-.143.03a.04.04 0 0 1-.044-.031l-.016-.095a.04.04 0 0 0-.036-.03l-.143.015.018-.043a.04.04 0 0 1 .034-.027l.352-.037.056-.023.056-.023.071-.056a.04.04 0 0 0 .004-.055l-.396-.41a.04.04 0 0 0-.043-.008l-.118.057a.04.04 0 0 1-.038-.003L4.1 5.91a.036.036 0 0 0-.05.008l-.051.07a.03.03 0 0 0-.007.02l-.01.174q0 .016.011.029l.048.05a.04.04 0 0 1-.005.056l-.07.051a.04.04 0 0 1-.034.006l-.16.027a.22.22 0 0 0-.133-.13l-.08-.028a.222.222 0 0 1-.098-.35l.156-.19a.04.04 0 0 0 .007-.038l-.044-.115-.008-.012-.176-.19a.122.122 0 0 0-.21.065l-.001.01a.12.12 0 0 1-.12.104H2.54l-.05-.01-.04-.009-.358-.162-.075-.018-.33-.022-.092.015-.148.058a.2.2 0 0 1-.124.01L.591 5.23a.2.2 0 0 0-.132.013l-.346.15a.038.038 0 0 0-.009.063l.09.077c.026.021.011.065-.022.066l-.136.003c-.02 0-.036.017-.036.037v.02c0 .02.016.036.036.037l.117.001c.04.002.051.056.015.072l-.101.046a.04.04 0 0 0-.022.037l.01.103a.22.22 0 0 0 .184.198l.072.012c.034.006.042.051.013.069l-.023.013c-.024.015-.024.05 0 .064l.012.006a.04.04 0 0 0 .035.003l.618-.282a.22.22 0 0 1 .237.04l.588.543a.22.22 0 0 1 .071.152l.02.415a.22.22 0 0 0 .048.128l.579.728c.01.014.03.018.045.01a.04.04 0 0 0 .014-.055s.365.383.4.399l.296.148a.2.2 0 0 0 .097.023h.147q.024 0 .033.021l.05.108V8.7l.001.001.002.003c.015.025.088.143.165.148.087.005.243 0 .243 0s.056-.001.056.06v.095a.04.04 0 0 1-.019.032c-.048.027-.172.107-.172.197v.212q0 .014.008.024c.016.019.05.06.08.084.027.022.072.073.098.103l.013.014a.04.04 0 0 1 .008.024v.122l.001.006.001.007c.007.016.024.057.055.072.019.009.065.047.108.085a.22.22 0 0 1 .076.186l-.027.345-.003.02-.003.02-.119.45-.007.08.012.185a.2.2 0 0 1-.01.095l-.044.126a.24.24 0 0 0-.007.125l.056.233a.12.12 0 0 0 .044.07l.057.045c.022.018.054.042.076.026.077-.054.12-.218.155-.353.015-.06.03-.115.044-.15.01-.023.067-.105.134-.202.11-.156.245-.35.244-.389l-.003-.09c0-.022.016-.038.037-.038h.114q.016 0 .026-.012l.266-.294a.04.04 0 0 0 .01-.026v-.12c0-.021.017-.037.038-.037.045.002.12.002.145-.02.027-.021.097-.103.138-.15l.021-.024a.04.04 0 0 0 .01-.025v-.19c0-.055.02-.108.057-.15l.133-.148a.137.137 0 0 0-.043-.215M14.916 10.7l-.008.001c-.006.005.005.036.024.067.031.051.033.062.016.086-.017.025-.016.03.004.044q.054.035-.022.03c-.038-.004-.049.002-.07.039a.3.3 0 0 1-.078.074c-.071.044-.108.109-.06.109q.02.001.012.026c-.01.032-.006.032.065-.002.041-.02.06-.038.066-.065a.07.07 0 0 1 .041-.048c.018-.006.032-.015.03-.019-.007-.018.033-.082.048-.077.02.006.08-.06.07-.076q-.006-.01.012-.011c.022 0 .043-.048.03-.067-.004-.006-.023-.007-.043-.003q-.035.008-.035-.01c0-.02-.075-.089-.102-.097M12.885 9.274l-.486-.057a.1.1 0 0 1-.035-.01l-.118-.048a.14.14 0 0 1-.048-.032l-.39-.414a.05.05 0 0 0-.042-.015.047.047 0 0 0-.028.078l.41.466a.15.15 0 0 0 .063.04l.232.07a.1.1 0 0 0 .04.005h.397zM13.85 9.535l-.02.057a.255.255 0 0 1-.27.17.05.05 0 0 1-.038-.027.05.05 0 0 1 .001-.047l.1-.186-.26.01a.3.3 0 0 0-.1.023l-.098.046a.3.3 0 0 0-.07.049l-.18.178a.2.2 0 0 1-.075.051l-.123.055a.26.26 0 0 0-.152.236v.02q0 .052.02.1l.096.228q.004.008.005.015a.11.11 0 0 0 .143.077l.245-.088a.25.25 0 0 1 .108-.013l.294.027c.08.006.15.05.193.12l.02.03a.25.25 0 0 0 .218.122h.118a.26.26 0 0 0 .182-.076l.13-.132a.26.26 0 0 0 .075-.183v-.173a.26.26 0 0 0-.082-.19l-.268-.248a.24.24 0 0 1-.06-.082l-.08-.175c-.017-.027-.06-.026-.071.006M13.322 9.25c.017.001.029.014.028.037 0 .015-.029.043-.064.063a.3.3 0 0 1-.068.032c-.016.004-.019-.005-.019-.027 0-.017.006-.031.014-.031.007 0 .03-.02.051-.043q.031-.033.058-.03M13.079 9.272c.16 0 .149.04-.013.048-.095.004-.12 0-.115-.021.005-.018.045-.027.128-.027M6.117 5.52h.09l.067.046.182-.047.033.081v.115l-.175.021a.13.13 0 0 1-.1-.028l-.153-.121zM8.12 4.551h-.23l-.056.04.197.25h.09l.082-.152.202.103.032-.048-.24-.169a.13.13 0 0 0-.076-.024M8.611 4.372h-.298l-.028.046.086.064a.13.13 0 0 0 .08.027h.16l.076-.08zM3.042 4.379l-.197.074-.19.048.273.13.216-.07.072-.013-.057-.109zM3.415 4.78h-.086v.043l.046.017.01.044.071.01.048.055.424-.014.024-.05-.037-.056h-.456zM3.03 4.884l-.033-.096.033-.018.127.01.03.029-.07.082zM3.216 4.725l.016-.054.035-.024.034.013.058.025v.024h-.03l-.046.038z"></path><path fill="#050505" d="m3.844 8.095-.083.037c-.01.005-.01.021 0 .024l.088.037.103-.017.167.115h.119s.081-.01.081-.032-.081-.033-.081-.033l-.172-.13zM4.4 8.272s-.074.045-.065.066c.016.038.16 0 .16 0s.052-.048.043-.066c-.018-.031-.138 0-.138 0M14.162 10.93h-.28l.074.164h.066z"></path></svg>'},56113:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M13.43 13.43V5.298L10.778 7.95 5.828 3 3 5.828l4.95 4.95-2.652 2.652zM4.414 5.828l1.414-1.414 4.95 4.95 1.652-1.652v4.718H7.712l1.652-1.652z" clip-rule="evenodd"></path></svg>'},60308:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><g fill="#000" fill-rule="nonzero"><path d="M4 8h1v3H4zM2 9h1v2H2zm6-1h1v3H8zm4 0h1v3h-1z"></path><path d="M15 12V6h-2V5h1V2h-3v1L4 1.05V0H1v3h1v3H0v6h2v1H1v3h3v-1h7v1h3v-3h-1v-1zm-3-9h1v1h-1zm-8-.92L11 4v1h1v1H3V3h1zM2 1h1v1H2zm1 14H2v-1h1zm8-1H4v-1H3v-1h9v1h-1zm2 1h-1v-1h1zM1 11V7h13v4z"></path><path d="M6 9h1v2H6zm4 0h1v2h-1z"></path></g></svg>'},60670:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><g fill="none" fill-rule="nonzero"><path fill="#000" d="m7.745 7 4.1 4.1a.527.527 0 0 1-.745.746L7 7.746l-4.1 4.1a.527.527 0 0 1-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 0 1 .746-.746l4.1 4.1 4.1-4.1a.527.527 0 0 1 .746.746z"></path><path d="M1 1h12v12H1z"></path></g></svg>'},62686:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=i},69881:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M5 11v5H4v-4.001L0 12v-1zm11 0v1l-4-.001V16h-1v-5zM5 0v5H0V4l4 .001V0zm7 0v4.001L16 4v1h-5V0z"></path></svg>'},71525:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M3 13.43h8.132L8.48 10.778l4.95-4.95L10.6 3l-4.95 4.95L3 5.298zm7.601-9.016 1.415 1.414-4.95 4.95 1.652 1.652H4V7.712l1.652 1.652z" clip-rule="evenodd"></path></svg>'},78313:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m16 8-7.6 6.08V10.5h-7v-5h7V1.92zM9.4 6.5h-7v3h7V12l5-4-5-4z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=o},81146:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="none" fill-rule="nonzero"><path fill="#000" d="M13 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0m-6.5 0a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0M0 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0"></path><path d="M0 0h16v16H0z"></path></g></svg>'},82009:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M.1 6.9h6.8V.1H.1zm6-.8H3.985c.077-.403.25-.78.506-1.102a4.6 4.6 0 0 0 1.609.805zm0-1.128a3.8 3.8 0 0 1-1.006-.523c.31-.203.65-.358 1.006-.459zM6.1.9v2.266a4.2 4.2 0 0 0-1.613.73 6 6 0 0 1-1.1-1.767l.002-.004-.004-.001A8 8 0 0 1 2.99.9zM.9.9h1.266a9 9 0 0 0 .359 1.249A1.93 1.93 0 0 1 .9 3.188zm0 3.09a2.83 2.83 0 0 0 2.006-.966c.262.519.594 1 .987 1.428A3.37 3.37 0 0 0 3.17 6.1H.9zM9.1.1v6.8h6.8V.1zm.8.8h4.063a.37.37 0 0 1-.045.2.6.6 0 0 1-.438.176 1.64 1.64 0 0 0-1.175.49.9.9 0 0 0-.203.708c-.001.007-.114.736-.607.742a.74.74 0 0 0-.719.384.83.83 0 0 0-.026.6H9.9zm5.2 5.2H9.9V5h2.296l-.474-.639a1.6 1.6 0 0 1-.192-.346c1.041-.03 1.37-1.188 1.365-1.587a.2.2 0 0 1 .028-.154c.031-.037.166-.162.624-.2.419 0 .81-.205 1.049-.549a1.13 1.13 0 0 0 .16-.625h.344zm-15 9.8h6.8V9.1H.1zm.8-6h5.2v.46l-2 1.973v.867l-3.2-.089zm0 4.01 4 .112v-1.355l1.2-1.182V15.1H.9zm8.2 1.99h6.8V9.1H9.1zm6-.8h-1.792l-1.27-1.572 1.468-1.468 1.594 1.605zm0-5.2v2.628L12.49 9.9zm-5.2 0h1.46l1.581 1.592-1.978 1.98 1.316 1.628H9.9z"></path></svg>'},88217:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAABsklEQVRYCe2WP0vDUBTFz2sLuggZHASX4ORYd4eIi07WybVuOhTrF5BXv0CHIrjVUae2U12EDO7t6CRdBAeHgBR0aJ/vJkUi5OXlplOxB9qG++/8cptXCvx3CdYCZMuDKh4BUw9QLiCcqF8F+noIFIYQkx5kzY/i9vdsALLtQI07epxnH0kV4g6i0IA8H9nqC7aCMK/GA/3pZaqNGqpQkw5kc7Yhc6cdQN5UdbtrHmHMlDEt1Y3ZWcIOoNSFbYgxL4R+XtJlBwDK6SNSs9beUmq7Iek6a2hX9lHeWIezuoLuyysuH58xCj4NHeZwlg386SbzwdkJPHczNKdkZXsrjFGOKzZA82D31zhuRpugrXDFBqC7NYm+Eq7YAMHXt9GDtsAVG2D4/mH06OmHkSs2wGn3CUlboFhdnwSu2AB01HZuH8KjR2Zk7I/ewlieY5jrd4CMju/73JtNrGdvIHHKHMElwHIDC7ABoRq5H3Jl7y1ah/t9H3uH+s+r8Ky18QIyv67JeCjp2g5AXVyIjOY0OhsAB4JhzgPIAsE05wOkQeQwzweQBJHTnEbNJ9mSuNKvRdYP0GGJ/zuVb/EAAAAASUVORK5CYII="},88721:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="#363636" fill-rule="nonzero"><path d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z"></path><path d="M10.318 0C13.456 0 16 2.462 16 5.5S13.456 11 10.318 11a5.8 5.8 0 0 1-3.023-.842l-.22-.142.54-.752c.788.53 1.722.82 2.703.82 2.615 0 4.735-2.053 4.735-4.584S12.933.917 10.318.917c-1.916 0-3.617 1.112-4.354 2.779l-.078.187L5 3.56C5.827 1.435 7.933 0 10.318 0"></path></g></svg>'},91340:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M20.889 1.333h6.222a3.556 3.556 0 0 1 3.556 3.556v6.222a3.556 3.556 0 0 1-3.556 3.556h-6.222a3.556 3.556 0 0 1-3.556-3.556V4.889a3.556 3.556 0 0 1 3.556-3.556M20 4v8h8V4zM4.889 17.333h6.222a3.556 3.556 0 0 1 3.556 3.556v6.222a3.556 3.556 0 0 1-3.556 3.556H4.889a3.556 3.556 0 0 1-3.556-3.556v-6.222a3.556 3.556 0 0 1 3.556-3.556M4 20v8h8v-8zm20 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8m0 2.667a6.667 6.667 0 1 1 0-13.334 6.667 6.667 0 0 1 0 13.334M4.981 12h6.037L7.999 5.963zm4.212-9.615 5.176 10.352a1.334 1.334 0 0 1-1.192 1.93H2.825a1.333 1.333 0 0 1-1.192-1.929L6.809 2.386a1.332 1.332 0 0 1 2.385 0z"></path></svg>'},98018:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M7 1a6 6 0 1 0 0 12A6 6 0 0 0 7 1m0 13a7 7 0 1 1 5.621-2.828l-.222.284 3.405 3.404a.668.668 0 0 1-.944.944L11.456 12.4A6.97 6.97 0 0 1 7 14"></path></svg>'},99973:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 5"><path fill="#000" fill-rule="evenodd" d="M4.128 4.587.751.834A.5.5 0 0 1 1.123 0h6.754a.5.5 0 0 1 .372.834L4.872 4.587a.5.5 0 0 1-.744 0"></path></svg>'}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var p={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(p),r.d(p,{__set_webpack_public_path__:()=>Rt,default:()=>Ot});var e,t=r(67386),i=r(79244);!function(e){e.auto="auto",e.low="low",e.medium="medium",e.high="high"}(e||(e={}));var o=r(62686),s=r(14321),a=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const n=r(88217);function l(){return{type:"esriPMS",height:24,width:24,angle:0,xoffset:0,yoffset:12,url:n}}var c=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};function d(e,t){const i=e.wkid===t.wkid||e.equals(t),o=(e.isWebMercator||e.isWGS84)&&(t.isWebMercator||t.isWGS84);return!i&&!o}function h(e,t){return c(this,void 0,void 0,function*(){var i;const o=e.clone(),s=o.targetGeometry,a=null===(i=o.camera)||void 0===i?void 0:i.position,n=[];let l=!1,r=!1;if(s&&d(s.spatialReference,t)&&(l=!0,n.push(s)),a&&d(a.spatialReference,t)&&(r=!0,n.push(a)),n.length>0){const e=yield S(n,t);l&&(o.targetGeometry=e[0]),r&&(o.camera.position=e[e.length-1])}return o})}function u(e,t){return c(this,void 0,void 0,function*(){return new Promise((i,o)=>{setTimeout(()=>{e.goTo(t).then(()=>{i()}).catch(()=>{o(new Error(null))})},400)})})}function m(e){return c(this,void 0,void 0,function*(){return yield(0,o.loadArcGISJSAPIModules)(["esri/geometry/Extent"]).then(t=>c(this,void 0,void 0,function*(){let i;if([i]=t,!e||!e.length)return yield Promise.resolve(null);let o,s=null;const a=e.length;for(o=0;o<a;o++){const t=e[o];if(!t)continue;let a=t.extent;if(!a&&"point"===t.type){const e=t;e.x&&e.y&&(a=new i({xmax:e.x,xmin:e.x,ymax:e.y,ymin:e.y,zmax:e.z,zmin:e.z,spatialReference:e.spatialReference}))}a&&(s=s?s.union(a):a)}return s.width<0&&s.height<0?yield Promise.resolve(null):yield Promise.resolve(s)}))})}function g(e,t){return"esri.layers.support.SubtypeSublayer"===e.declaredClass?function(e,t){const i=e.parent;if(i){const o=t.clone(),s=function(e){if(!e)return null;const t=e.subtypeField;if(t){const i=e.getField(t);if(i&&i.name)return i.name}return t}(e),a=`${s} = ${e.subtypeCode}`;return o.where?o.where=`(${o.where}) AND (${a})`:o.where=a,i.queryExtent(o)}return null}(e,t):e.queryExtent(t)}function v(e,t,i,s){return(0,o.loadArcGISJSAPIModules)(["esri/rest/support/Query"]).then(o=>{var a,n;let l;[l]=o;const r=new l;r.where=i,r.outFields=s||[],r.returnGeometry=!0;const p=null===(n=null===(a=null==e?void 0:e.view)||void 0===a?void 0:a.spatialReference)||void 0===n?void 0:n.clone();return p&&(r.outSpatialReference=p),t.queryFeatures(r).then(e=>e)})}function w(e,t,s){return c(this,void 0,void 0,function*(){var a;const n=e.view,l=s.layer;if(!l)return;let r=null;if("function"==typeof l.queryFeatures)r=l;else{const[e]=yield(0,o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]);let t=new e({url:i.dataSourceUtils.getUrlByLayer(l)});yield t.load(),r=t}if(r){const i=yield v(e,r,t,[]);if(i&&i.features&&i.features.length>0){let e=r.geometryType;e||(e=null===(a=i.features[0].geometry)||void 0===a?void 0:a.type);const t=function(e){return["point","multipoint"].includes(e)?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].includes(e)?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].includes(e)?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].includes(e)?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}(e);!function(e,t,i){(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then(o=>{let s;[s]=o;const a=function(t,o){const a=[];let n=0;for(let e=0;e<t.length;e++){const o=new s({geometry:t[e].geometry,symbol:i,attributes:t[e].attributes});a.push(o)}const l=function(){e.graphics.addMany(a),setTimeout(()=>{e.graphics.removeMany(a),n+=1,n<o&&setTimeout(()=>{l()},500)},500)};l()};a(t,3)})}(n,i.features,t)}}})}function f(e,t,s){return c(this,void 0,void 0,function*(){if(!t)return;const a=i.DataSourceManager.getInstance().getDataSource(t);if(!a)return;let n=null;try{n=yield e.whenJimuLayerViewLoadedByDataSource(a)}catch(e){n=null,console.error("can't get jimuLayerView by dataSource",a,e)}if(n&&n.layer){const t=n.type,a=[i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.ImageryLayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.SubtypeGroupLayer,i.JSAPILayerTypes.SubtypeSublayer],l=[i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer];a.includes(t)?w(e,s,n):l.includes(t)&&function(e,t,i){let s=null;const a=i.view;if(a){const i=a.layer||a.sublayer;if(!i)return;const n=i.associatedLayer;if(!n)return;const l=i.objectIdField;if(!l)return;v(e,n,t,[l]).then(t=>c(this,void 0,void 0,function*(){if(t&&t.features&&t.features.length>0){const[i]=yield(0,o.loadArcGISJSAPIModules)(["esri/Color"]),n=t.features.map(e=>e.attributes[l]);let r=0;const p=6;let c=!0;const d=M(null==e?void 0:e.view);if(!d)return void console.error(`can't get the default HighlightOptions for map ${null==e?void 0:e.id}`);const h=d.color,u=function(){r<p?(r++,c?(d.color=new i([0,0,0,0]),s&&s.remove(),s=a.highlight(n)):(d.color=new i([255,255,0,.8]),s&&s.remove(),s=a.highlight(n)),c=!c,setTimeout(u,500)):(d.color=h,s&&s.remove())};setTimeout(u,500)}}))}}(e,s,n)}})}function y(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}function M(e){let t=null;const i=null==e?void 0:e.highlights;return(null==i?void 0:i.length)>0&&(t=i.find(e=>"default"===e.name)),t}function S(e,t){return c(this,void 0,void 0,function*(){return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?t.isWebMercator&&e[0].spatialReference.isWGS84||t.isWGS84&&e[0].spatialReference.isWebMercator?yield Promise.resolve(e):yield i.geometryUtils.projectToSpatialReference(e,t):yield Promise.resolve(e)})}function b(e,t){return c(this,void 0,void 0,function*(){const o=yield function(e,t){return c(this,void 0,void 0,function*(){if(!e||0===e.length)return[];const o=e.map(e=>c(this,void 0,void 0,function*(){const o=yield i.geometryUtils.projectToSpatialReference([e],t);return o&&o.length>0?o[0]:null}));return yield Promise.all(o)})}(e,t),s=o.filter(e=>!!e);if(0===s.length)return null;let a=null;return s.forEach(e=>{a=a?a.union(e):e}),a})}function x(e){return!window.jimuConfig.isInBuilder||e!==i.AppMode.Design}function I(e){const t=[];return e.forEach(e=>{const o=i.DataSourceManager.getInstance().getDataSource(e);let s;s=(null==o?void 0:o.layer)?Promise.resolve(o.layer):(null==o?void 0:o.createJSAPILayerByDataSource)?o.createJSAPILayerByDataSource():Promise.resolve(null),t.push(s)}),Promise.all(t)}function C(e,t){return`${e}-${t||""}`}function T(e,t){if(e&&t){const o=(0,i.getAppStore)().getState().appConfig.messageConfigs;if(o){const s=["panTo","zoomToFeature"],a=i.MessageType.ExtentChange;if(V(e,t,o,a,s)&&V(t,e,o,a,s))return!0}}return!1}function V(e,t,i,o,s){if(i){const a=Object.values(i);for(let i=0;i<a.length;i++){const n=a[i];if(n.widgetId===e&&n.messageType===o){const e=n.actions;for(let i=0;i<e.length;i++){const o=e[i];if(o.widgetId===t&&s.includes(o.actionName))return!0}}}}return!1}function P(e,t,i){if(!t)return!1;if(!i)return!1;if(t.targetGeometry&&"esri.geometry.Point"===t.targetGeometry.declaredClass&&i.targetGeometry&&"esri.geometry.Point"===i.targetGeometry.declaredClass){const o=e.toScreen(t.targetGeometry),s=e.toScreen(i.targetGeometry),a=o.x-s.x,n=o.y-s.y;if(Math.sqrt(a*a+n*n)>=5)return!1}const o=t.camera,s=i.camera;if(o&&s){if(parseFloat(o.heading.toFixed(2))!==parseFloat(s.heading.toFixed(2)))return!1;if(parseFloat(o.tilt.toFixed(2))!==parseFloat(s.tilt.toFixed(2)))return!1;if(o.position.distance(s.position)>=1)return!1}else{if(parseFloat(t.rotation.toFixed(2))!==parseFloat(i.rotation.toFixed(2)))return!1;const e=t.scale-i.scale;if(Math.abs(e)>=1)return!1}return!0}function L(e,t){if(e.viewpointHistory.length>0){const i=e.viewpointHistory.length-1;if(t>=0&&t<=i){return e.viewpointHistory[t].clone()}}return null}function E(e){e&&e.isActive&&e.view&&!e.view.destroyed&&e.updatePersistentMapState(!0,!1)}function A(e){var t;if(e&&e.isActive&&e.view&&!e.view.destroyed){const o=e.view,s=i.UrlManager.getInstance(),a=o.viewpoint?o.viewpoint.toJSON():null;let n=null,l=null,r=null,p=null,c=null;if(a&&(n=JSON.stringify(a)),"2d"===o.type){const e=null===(t=o.spatialReference)||void 0===t?void 0:t.wkid;if(e){const t=o.center;t&&(l=`${t.x},${t.y},${e}`)}r=String(o.scale),p=String(o.zoom),c=String(o.rotation)}o.lastViewpointToUpdateUrlParams=o.viewpoint?o.viewpoint.clone():null,o.lastViewpointUrlParamUpdateTimestamp=Date.now();const d={active_datasource_id:e.dataSourceId||null,center:l,scale:r,level:p,rotation:c,viewpoint:n};s.setWidgetUrlParams(e.mapWidgetId,d)}}function D(e,t,i,o,s,a,n,l,r,p){var c;let d=null;const h=null===(c=e.viewpoint)||void 0===c?void 0:c.clone(),u="2d"===e.type;u||(o=!1,s=!1,a=!1,n=!1);const m=N(t,u,l,r,p);if(m&&(i||delete m.viewpoint,o||delete m.center,s||delete m.scale,a||delete m.rotation,n||delete m.level,Object.keys(m).length>0))if(u){if(d=m.viewpoint||h,d){if(m.center&&(d.targetGeometry=m.center),"scale"in m)d.scale=m.scale;else if("level"in m){const t=function(e,t){var i;let o=null;const s=null===(i=null==e?void 0:e.constraints)||void 0===i?void 0:i.effectiveLODs;if((null==s?void 0:s.length)>0){const e=s.filter(e=>e.level<=t).pop(),i=s.find(e=>e.level>=t);if(e&&i)if(e.level===i.level)o=e.level;else{const i=e.scale,s=e.level;o=i/Math.pow(2,t-s)}else e&&e.level===t&&(o=e.scale),i&&i.level===t&&(o=i.scale);if(!e||!i||e.level===i.level)return e?e.scale:i.scale;const a=e.scale,n=e.level;o=a/Math.pow(2,t-n)}return o}(e,m.level);"number"==typeof t&&t>0&&(d.scale=t)}"rotation"in m&&(d.rotation=m.rotation)}}else d=m.viewpoint;return d}function N(e,t,i,o,s){let a={},n=null,l=null,r=null,p=null,c=null;if(e){try{if(e.viewpoint){const t=JSON.parse(e.viewpoint);t&&(n=i.fromJSON(t))}}catch(e){console.error("parse viewpoint from url hash params error",e),n=null}if(t){try{if(e.center){const t=e.center.split(",");if(t.length>=3){const e=parseFloat(t[0]),i=parseFloat(t[1]),a=parseFloat(t[2]);if(k(e)&&k(i)&&k(a)){l=new o({x:e,y:i,spatialReference:new s({wkid:a})})}}}}catch(e){console.error("parse center from url hash params error",e),l=null}try{if("scale"in e){const t=parseFloat(e.scale);k(t)&&t>=0&&(r=t)}}catch(e){r=null,console.error("parse scale from url hash params error",e)}try{if("level"in e){const t=parseFloat(e.level);k(t)&&t>=0&&(p=t)}}catch(e){p=null,console.error("parse level from url hash params error",e)}try{if("rotation"in e){const t=parseFloat(e.rotation);k(t)&&t>=0&&t<=360&&(c=t)}}catch(e){c=null,console.error("parse rotation from url hash params error",e)}}}return n&&(a.viewpoint=n),t&&(l&&(a.center=l),k(r)&&(a.scale=r),!("scale"in a)&&k(p)&&p>=0&&(a.level=p),k(c)&&(a.rotation=c)),0===Object.keys(a).length&&(a=null),a}function j(e){return c(this,void 0,void 0,function*(){let t=[];const i=(null==e?void 0:e.marker)||"";try{if(i){let e=null;try{e=JSON.parse(i)}catch(t){e=null}if(Array.isArray(e))t=e;else{const e=i.split(";");if(e.length>0&&e[0]){const[i,o,s,a,n]=e,l=i.split(",");if(l.length>=2){const e=l.map(e=>parseFloat(e)),i=o?parseInt(o):null;let r=null;"number"!=typeof i||isNaN(i)?"string"==typeof o&&(r=decodeURIComponent(o)):r=i;const p=s?decodeURIComponent(s):"",c=a?decodeURIComponent(a):"";let d=null;if(n){const e=decodeURIComponent(n);try{d=JSON.parse(e)}catch(e){}}const h={wkid:r,symbol:d,points:[{coordinates:e,title:p,label:c}]};t.push(h)}}}}}catch(e){console.error("parse marker param error",e),t=[]}const s=[];if(t.length>0){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils","esri/geometry/SpatialReference","esri/geometry/Point","esri/geometry/Multipoint","esri/Graphic"]),[i,n,r,p,c]=e,d=yield function(){return a(this,void 0,void 0,function*(){const e=(yield(0,o.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]))[0],t=l();return e.fromJSON(t)})}();t.forEach(e=>{var t;if(e&&(null===(t=e.points)||void 0===t?void 0:t.length)>0){let t=e.wkid;t&&("number"==typeof t||"string"==typeof t)||(t=4326);const o=new n("string"==typeof t?{wkt:t}:{wkid:t});let a=null,l=e.symbol;if(l)try{a=i.fromJSON(l)}catch(e){}a||(l=null,a=d);const h=[];if(e.points.forEach(e=>{var t;if(e&&(null===(t=e.coordinates)||void 0===t?void 0:t.length)>=2){const t=e.coordinates,i=Math.floor(t.length/2);let s=null;if(1===i)s=new r({x:t[0],y:t[1],spatialReference:o});else if(i>1){const e=[];for(let o=0;o<i;o++){const i=2*o,s=t[i],a=t[i+1];e.push([s,a])}s=new p({points:e,spatialReference:o})}if(s){const t=e.title||"",i=e.label||"",o=new c({geometry:s,attributes:{title:t,label:i}});h.push(o)}}}),h.length>0){const e={configSymbolJson:l,symbol:a,graphics:h};s.push(e)}}})}return s})}function k(e){return"number"==typeof e&&!isNaN(e)}function O(){if(!document)return null;return document.fullscreenElement||document.webkitFullscreenElement||document.webkitFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement}const R=i.React.createContext({mapWidgetId:null,mapWidgetHeight:null,isShowMapSwitchBtn:!1,isFullScreen:!1,dataSourceIds:[],activeDataSourceId:null,switchMap:()=>null,fullScreenMap:()=>null,initialMapState:null,mobilePanelContainer:null,onMobilePanelContentChange:e=>null,theme:null}),W=["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right"];function U(e){let t=null;return e&&e.popupDockPosition&&("auto"===e.popupDockPosition||W.includes(e.popupDockPosition))&&(t=e.popupDockPosition),t}function F(e,t){let i=null;if("2d"===e.type&&t){const o=function(e){var t;let i=null,o=null;const s=null===(t=null==e?void 0:e.constraintsInfo)||void 0===t?void 0:t.lods;if(s&&s.length>0){const e=[];s.forEach(t=>{const i=null==t?void 0:t.scale;"number"==typeof i&&i>0&&e.push(i)}),e.length>0&&(i=Math.max(...e),o=Math.min(...e))}return{minScale:i,maxScale:o}}(e),s=null==o?void 0:o.minScale,a=null==o?void 0:o.maxScale;i=function(e,t,i,o){const s={isScaleRangeValid:!0,finalMinScale:0,finalMaxScale:0};if(o){const a=o.minScale,n=o.maxScale,l=B(a)?a:1/0,r=B(n)?n:0,p=B(t)?t:1/0,c=function(e,t){const i=Math.min(...e),o=Math.max(...e),s=Math.min(...t),a=Math.max(...t),n=Math.max(i,s),l=Math.min(o,a);if(n>l)return null;return[n,l]}([r,l],[B(i)?i:0,p]);if(c){const[e,o]=c;s.isScaleRangeValid=!0,s.finalMinScale=H(o),s.finalMaxScale=H(e),s.finalMinScale===t&&(s.finalMinScale=0),s.finalMaxScale===i&&(s.finalMaxScale=0)}else s.isScaleRangeValid=!1,s.finalMinScale=e,s.finalMaxScale=e}return s}(e.scale,s,a,t)}return i||(i={isScaleRangeValid:!0,finalMinScale:0,finalMaxScale:0}),i}function B(e){return"number"==typeof e&&isFinite(e)&&e>0}function H(e){return isFinite(e)?e:0}const z={_widgetLabel:"Map",_action_displayFeatureSet_label:"Display feature set",_action_panTo_label:"Pan to",_action_zoomToFeature_label:"Zoom to",_action_selectFeature_label:"Select feature",_action_flash_label:"Flash",_action_filter_label:"Filter",_action_showOnMap_label:"Show on map",_action_addToMap_label:"Add to map",_action_showPopup_label:"Show pop-up",_action_addMarker_label:"Add marker",showOnMapData:"Show on map data",addedData:"added data",failToAddTheDataOnMap:"Fail to add the data.",addToMapData:"Add to map data",mapCurrentRecord:"{layerName} map current record",switchTo:"Switch to {webMapName}",_url_params_viewpoint_label:"Viewpoint",_url_params_viewpoint_tooltip:"Viewpoint describes the point of view for a web map or web scene.",_url_params_center_label:"Center",_url_params_scale_label:"Scale",_url_params_level_label:"Level",_url_params_rotation_label:"Rotation",_url_params_layer_visibility_label:"Layer visibility",_url_params_marker_label:"Marker"};var J=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const G=r(47717);var _;!function(e){e.Loading="LOADING",e.Loadok="LOADOK",e.LoadError="LOADERROR"}(_||(_={}));const $="__exbQualityProfile";class K extends i.React.PureComponent{constructor(e){super(e),this.dsManager=i.DataSourceManager.getInstance(),this.isFirstReceiveMessage=!0,this.__unmount=!1,this.debounceUpdateViewUrlParamsAndPersistentMapState=()=>null,this.getInitViewPointForDefaultWebMap=()=>{const e=this.props.defaultMapInfo&&this.props.defaultMapInfo.defaultExtent;let t=null;return t=this.props.baseWidgetProps.config.initialMapState&&this.props.baseWidgetProps.config.initialMapState.viewPoint?this.generateViewPointFromInitialMapState(this.props.baseWidgetProps.config.initialMapState):new this.Viewpoint({targetGeometry:new this.Extent({xmin:e&&e.xmin,ymin:e&&e.ymin,xmax:e&&e.xmax,ymax:e&&e.ymax,spatialReference:{wkid:e.spatialReference.wkid}})}),t},this.onDataSourceCreated=e=>{e.id===this.props.dataSourceId&&(delete this.createFailedDataSourceIds[this.props.dataSourceId],this.mapDs=e,this.isReadyToCreateJimuMapView()&&this.createJimuMapView())},this.onCreateDataSourceFailed=e=>{console.warn("onCreateDataSourceFailed",e),this.mapDs=null;const t=this.props.dataSourceId;this.createFailedDataSourceIds[t]=!0,this.setState({mapLoadStatus:_.LoadError},()=>{this.props.onMapLoaded(t,_.LoadError)})},this.setViewPoint=e=>{this.view&&e&&(this.view.viewpoint=e.clone())},this.getViewPoint=()=>this.view&&this.view.viewpoint?this.view.viewpoint.clone():null,this.getMapLoadStatus=()=>this.state.mapLoadStatus,this.getViewType=()=>this.getDsJsonFromDsId(this.props.dataSourceId).type,this.queryExtentFromSingleLayerQueryParams=e=>J(this,void 0,void 0,function*(){const t=this.dsManager.getDataSource(e),i=t.getCurrentQueryParams();let s;s=(null==t?void 0:t.layer)?Promise.resolve(t.layer):t.createJSAPILayerByDataSource().then(e=>Promise.resolve(e));const a=yield(0,o.loadArcGISJSAPIModules)(["esri/rest/support/Query","esri/Graphic","esri/geometry/Point"]),[n,l,r]=a,p=new n;p.where=null==i?void 0:i.where;const c=yield s,d=yield g(c,p),h=null==d?void 0:d.extent;let u=null;if(h&&"number"==typeof h.xmin&&"number"==typeof h.xmax&&"number"==typeof h.ymin&&"number"==typeof h.ymax){const e=null==h?void 0:h.center;let t=null;if(1===(null==d?void 0:d.count)&&"point"===c.geometryType&&e){t=new l({geometry:new r({x:e.x,y:e.y,spatialReference:h.spatialReference})})}u={extent:h,singlePointGraphic:t,count:null==d?void 0:d.count,layer:c}}else u={extent:null,singlePointGraphic:null,count:0,layer:c};return u}),this.queryExtentFromQueryParams=(e,t,i)=>J(this,void 0,void 0,function*(){if(!i.some(e=>{const t=this.dsManager.getDataSource(e).getRuntimeQueryParams();return!!((null==t?void 0:t.where)&&"1=1"!==t.where)})){return{viewpoint:this.getMapBaseInitViewPoint(),extent:null,useDefaultExtentOfCurrentView:!0,singlePointGraphic:null,count:2,layer:null}}const o=[];t.forEach(e=>{o.push(this.queryExtentFromSingleLayerQueryParams(e))});let s=yield Promise.all(o);if(s||(s=[]),s=s.filter(e=>!!(null==e?void 0:e.extent)),0===s.length)return null;if(1===s.length)return s[0];{let t=0;const i=[];s.forEach(e=>{e.extent&&i.push(e.extent),t+=e.count});return{extent:yield b(i,e.spatialReference),singlePointGraphic:null,count:t,layer:null}}}),this.debounceUpdateViewUrlParamsAndPersistentMapState=i.lodash.debounce(()=>{this.updateViewUrlParamsAndPersistentMapState()},500),this.restored=!1,this.createFailedDataSourceIds={},this.mapViewCreateFailedUniqueIdsInfo={},this.updateExpectedDataSourceInfo();const t=this.getRestoreDataFromMS();t&&t.expectedDataSourceInfo.uniqueId===this.expectedDataSourceInfo.uniqueId?(!function(e,t){const i=Object.keys(t);for(const o of i)e[o]=t[o]}(this,t),this.updateRestoreDataToMS(null),this.bindMapBaseViewEvent(this.view),this.view&&(this.view.isInCaching=!1,this.view.mapbase=this,this.restored=!0,this.tryFatalErrorRecovery(this.view),this.view.isMapToolsHidden?this.view.hideMapTools():this.view.showMapTools())):this.state={dataSourceId:null,isBasicModulesLoaded:!1,mapLoadStatus:_.Loading},this.unsubscribeResourceSessions(),this.resourceSessionsUnsubscribe=(0,i.observeStore)(this.onStoreResourceSessionsChange.bind(this),["resourceSessions"])}unsubscribeResourceSessions(){this.resourceSessionsUnsubscribe&&(this.resourceSessionsUnsubscribe(),this.resourceSessionsUnsubscribe=null)}static getDerivedStateFromProps(e,t){return e.dataSourceId!==t.dataSourceId?{dataSourceId:e.dataSourceId,mapLoadStatus:_.Loading}:null}getStyle(){return i.css`
      .esri-view .esri-view-surface:focus::after {
        display: none;
      }
    `}render(){let e=null;return this.props.baseWidgetProps.useDataSources&&(e=this.props.baseWidgetProps.useDataSources.find(e=>e.dataSourceId===this.props.dataSourceId)),(0,t.jsxs)("div",{className:"w-100 h-100 map-base",style:{position:"relative"},css:this.getStyle(),ref:e=>{this.widgetContainer=e},children:[this.state.mapLoadStatus===_.Loading&&(0,t.jsx)("div",{className:"w-100 h-100 widget-map-background",children:(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})}),this.state.mapLoadStatus===_.LoadError&&(0,t.jsxs)("div",{className:"w-100 h-100 widget-map-background",children:[this.getMapSwitchForErrorMap(),(0,t.jsx)("div",{className:"w-100 h-100 d-flex justify-content-center align-items-center",children:this.formatMessage("mapFailure")})]}),!this.props.isDefaultMap&&(0,t.jsx)("div",{style:{position:"absolute",display:"none"},children:(0,t.jsx)(i.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})})]})}componentDidMount(){if(this.__unmount=!1,0===this.widgetContainer.getElementsByClassName("widget-map").length&&(this.mapContainer||(this.mapContainer=document&&document.createElement("div"),this.mapContainer.className="w-100 h-100 widget-map mapview-container"),this.widgetContainer.appendChild(this.mapContainer)),this.props.startLoadModules&&this.loadCommonModules(),this.restored){const e=this.getJimuMapViewFoView(this.view);e&&!e.isCached()&&e.onRestore()}}componentDidUpdate(e){this.tryCreateMapViewWhenDidUpdate(e),this.tryHandleUrlParamsChangeWhenDidUpdate(e),this.tryUpdateViewpointWhenInitialMapStateChanged(e)}tryCreateMapViewWhenDidUpdate(e){var t;if(this.updateExpectedDataSourceInfo(),!this.state.isBasicModulesLoaded)return;this.view&&e.isMapInVisibleArea!==this.props.isMapInVisibleArea&&this.props.baseWidgetProps.useDataSources&&2===this.props.baseWidgetProps.useDataSources.length&&(this.props.isMapInVisibleArea?(this.view.isInCaching=!1,this.tryFatalErrorRecovery(this.view)):this.view.isInCaching=!0);let i=!1;if(this.view){if(this.isViewExpected(this.view))return i=!1,this.tryUpdateCurrentViewByConfigProps(!1,e),void this.checkAndHandleMutableStateProps();i=!0}else{if(this.isCreatingExpectedView())return void(i=!1);{const e=null===(t=this.expectedDataSourceInfo)||void 0===t?void 0:t.uniqueId;i=!e||!this.mapViewCreateFailedUniqueIdsInfo[e]}}if(i){this.destroyCurrentMapbaseView();const e=!0;this.cacheLoadModulesAndCreateMapbaseView(this.expectedDataSourceInfo,e)}}tryHandleUrlParamsChangeWhenDidUpdate(e){var t,i,o,s;try{if(!this.view)return;const a=null===(t=null==e?void 0:e.baseWidgetProps)||void 0===t?void 0:t.realRuntimeUrlHashParams,n=null===(o=null===(i=this.props)||void 0===i?void 0:i.baseWidgetProps)||void 0===o?void 0:o.realRuntimeUrlHashParams;if(n&&n!==a&&n.active_datasource_id){const e=this.getJimuMapViewFoView(this.view);if(e&&e.isActive&&e.dataSourceId===n.active_datasource_id){const e=this.view.lastViewpointUrlParamUpdateTimestamp>0&&Date.now()-this.view.lastViewpointUrlParamUpdateTimestamp<=100;if(!e){const e=n.viewpoint&&n.viewpoint!==(null==a?void 0:a.viewpoint),t=n.center&&n.center!==(null==a?void 0:a.center),i=n.scale&&n.scale!==(null==a?void 0:a.scale),o=n.rotation&&n.rotation!==(null==a?void 0:a.rotation),l="level"in n&&n.level!==(null==a?void 0:a.level);if(e||t||i||o){const a=D(this.view,n,e,t,i,o,l,this.Viewpoint,this.Point,this.SpatialReference),r=null===(s=this.view.viewpoint)||void 0===s?void 0:s.clone();a&&!P(this.view,a,r)&&(this.view.viewpoint=a)}}}}}catch(e){console.error("handleUrlParamsChange error",e)}}tryUpdateViewpointWhenInitialMapStateChanged(e){var t,i,o,s,a,n,l,r,p,c;try{const d=(null===(i=null===(t=null==e?void 0:e.baseWidgetProps)||void 0===t?void 0:t.config)||void 0===i?void 0:i.initialMapState)||null,h=(null===(a=null===(s=null===(o=this.props)||void 0===o?void 0:o.baseWidgetProps)||void 0===s?void 0:s.config)||void 0===a?void 0:a.initialMapState)||null;if(h!==d){const e=null===(l=null===(n=null==h?void 0:h.viewPoint)||void 0===n?void 0:n.asMutable)||void 0===l?void 0:l.call(n,{deep:!0});if(this.view&&!this.view.destroyed&&this.state.mapLoadStatus===_.Loadok&&this.Viewpoint)if(e){const t=this.Viewpoint.fromJSON(e);t&&this.view.goTo(t)}else{const e=null===(c=null===(p=null===(r=this.view.map)||void 0===r?void 0:r.initialViewProperties)||void 0===p?void 0:p.viewpoint)||void 0===c?void 0:c.clone();e&&this.view.goTo(e)}}}catch(e){console.error("tryUpdateViewpointWhenInitialMapStateChanged error",e)}}componentWillUnmount(){this.__unmount=!0,this.unsubscribeResourceSessions(),this.view&&(this.view.mapbase=null);const e=(0,i.getAppStore)().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].useDataSources===this.props.baseWidgetProps.useDataSources&&this.state.mapLoadStatus!==_.Loading){const e=function(e){const{mapContainer:t,state:i,Geometry:o,InitialViewProperties:s,TileLayer:a,Basemap:n,MapView:l,SceneView:r,Extent:p,Viewpoint:c,PortalItem:d,Portal:h,WebMap:u,WebScene:m,Color:g,SpatialReference:v,Point:w,reactiveUtils:f,expectedDataSourceInfo:y,mapCreatingInfo:M,view:S,lastUpdateViewConfig:b,mapDs:x,dsManager:I,isFirstReceiveMessage:C}=e;return{mapContainer:t,state:i,Geometry:o,InitialViewProperties:s,TileLayer:a,Basemap:n,MapView:l,SceneView:r,Extent:p,Viewpoint:c,PortalItem:d,Portal:h,WebMap:u,WebScene:m,Color:g,SpatialReference:v,Point:w,reactiveUtils:f,expectedDataSourceInfo:y,mapCreatingInfo:M,view:S,lastUpdateViewConfig:b,mapDs:x,dsManager:I,isFirstReceiveMessage:C}}(this);if(this.view&&(this.view.isInCaching=!0),this.updateRestoreDataToMS(e),this.view){const e=this.getJimuMapViewFoView(this.view);e&&e.onCache()}}else this.destroyCurrentMapbaseView(),this.mapCreatingInfo=null,this.view&&!this.view.destroyed&&(this.view.container=null,this.view=null),this.mapDs=null}createDataSourceInfo(e){let t=null;const o=this.getDsJsonFromDsId(e);if(o&&o.id){const e=o.type||"",s=o.itemId||"",a=o.id,n=this.getJimuMapViewId(a);t=e===i.DataSourceTypes.WebScene?{isDefaultMap:!1,isWebMap:!1,uniqueId:`webscene-${a}-${s}`,dataSourceId:a,jimuMapViewId:n,dataSourceJson:o}:{isDefaultMap:!1,isWebMap:!0,uniqueId:`webmap-${a}-${s}`,dataSourceId:a,jimuMapViewId:n,dataSourceJson:o}}else{const e="";t={isDefaultMap:!0,isWebMap:!0,uniqueId:"webmap-default",dataSourceId:e,jimuMapViewId:this.getJimuMapViewId(e),dataSourceJson:o}}return t}getJimuMapViewId(e){return C(this.props.baseWidgetProps.id,e)}getDsJsonFromDsId(e){let t=null;return e&&(t=(0,i.getAppStore)().getState().appConfig.dataSources[e]),t||(t={}),t}getCurrentDataSourceJson(){return this.getDsJsonFromDsId(this.props.dataSourceId)}updateExpectedDataSourceInfo(){this.expectedDataSourceInfo=this.createDataSourceInfo(this.props.dataSourceId)}isCurrentViewExpected(){return this.isViewExpected(this.view)}isViewExpected(e){return e&&e.dataSourceInfo.uniqueId===this.expectedDataSourceInfo.uniqueId}isCreatingExpectedView(){return this.mapCreatingInfo&&this.isDataSourceInfoExpected(this.mapCreatingInfo.dataSourceInfo)}isDataSourceInfoExpected(e){return e&&e.uniqueId===this.expectedDataSourceInfo.uniqueId}tryUpdateCurrentViewByConfigProps(t,i){var o,s;if(!this.view)return;const a=this.props.baseWidgetProps.config,n=this.lastUpdateViewConfig;this.lastUpdateViewConfig=a;const l=!a.disablePopUp;if(t)this.view.popupEnabled=l;else{const e=!(null==n?void 0:n.disablePopUp),t=!a.disablePopUp;e!==t&&(this.view.popupEnabled=t,t||this.view.closePopup())}if(!t&&a.popupDockPosition!==(null==n?void 0:n.popupDockPosition)&&this.view.popup){const e=U(a);this.updatePopupDockParams(this.view.popup,e)}const r=M(this.view);if(r&&(a.selectionHighlightColor!==(null==n?void 0:n.selectionHighlightColor)||a.selectionHighlightHaloColor!==(null==n?void 0:n.selectionHighlightHaloColor))){const e=this.createDefaultHighlightOptionsByConfig(a,this.Color);r.color=e.color,r.haloColor=e.haloColor}const p=!a.disableScroll,c=this.view.navigation;if(c){const e=c.actionMap;if(e){const t=p?"zoom":"none";e.mouseWheel!==t&&(e.mouseWheel=t)}c.browserTouchPanEnabled!==p&&(c.browserTouchPanEnabled=p)}if(this.view.ui&&(this.view.ui.components=[]),this.isSceneView(this.view)){const t=this.view,i=t[$]||e.auto,o=a.sceneQualityMode||e.auto;if(i!==o)if(t[$]=o,o===e.auto){const e=/iPhone/i.test(navigator.userAgent);t.qualityProfile=e?"low":"medium"}else t.qualityProfile=o}if("2d"===this.view.type){const e=this.view;if(this.updateMapViewTimeZone(this.view),n){const t=(null==n?void 0:n.scaleRange)||null,i=((null==a?void 0:a.scaleRange)||null)!==t,o=(null==n?void 0:n.customLODs)||null,s=(null==a?void 0:a.customLODs)||null;if(i||s!==o){this.applyFinalMinMaxScaleLODsFor2dMapView(e);const t=e.constraints;t&&(t.snapToZoom=this.getFinalSnapToZoomByConfig())}}}let d=!1;const h=(null===(o=this.props.baseWidgetProps)||void 0===o?void 0:o.a11yLabel)||"";if(t)d=!0;else{const e=(null===(s=null==i?void 0:i.baseWidgetProps)||void 0===s?void 0:s.a11yLabel)||"";d=h!==e}d&&setTimeout(()=>{const e=this.props.baseWidgetProps.intl.formatMessage({id:"_widgetLabel",defaultMessage:z._widgetLabel}),t=h?`${e}.${h}`:e;!function(e,t){t||(t=""),e.aria={label:t}}(this.view,t)},100)}getFinalSnapToZoomByConfig(){const e=this.props.baseWidgetProps.config;return!!(null==e?void 0:e.customLODs)}applyFinalMinMaxScaleLODsFor2dMapView(e){var t,i;let o=!1;if("2d"===e.type){const n=null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.config,l=null==n?void 0:n.scaleRange,r=null==n?void 0:n.customLODs,p=e.constraints;if(p)if(r){0!==p.minScale&&(o=!0,p.minScale=0),0!==p.maxScale&&(o=!0,p.maxScale=0);const t=function(e,t){let i=null;if("2d"===(null==e?void 0:e.type)){const e=null==t?void 0:t.customLODs;if(e){const t=e.lods;i=(null==t?void 0:t.length)>0?t.asMutable({deep:!0}):null}}return i&&0===i.length&&(i=null),i}(e,n);((s=p.lods)||(s=null),(a=t)||(a=null),Array.isArray(s)&&Array.isArray(a)?s.length===a.length&&(0===s.length||s.every((e,t)=>{const i=a[t];return(null==e?void 0:e.level)===(null==i?void 0:i.level)&&(null==e?void 0:e.resolution)===(null==i?void 0:i.resolution)&&(null==e?void 0:e.scale)===(null==i?void 0:i.scale)})):s===a)||(o=!0,p.lods=t)}else{null!==p.lods&&(o=!0,p.lods=null);const t=F(e,l);if(t){const{finalMinScale:e,finalMaxScale:i}=t;p.minScale!==e&&(o=!0,p.minScale=e),p.maxScale!==i&&(o=!0,p.maxScale=i)}}}var s,a;return o}updatePopupDockParams(e,t){e&&(t?(e.dockEnabled=!0,e.dockOptions={breakpoint:!1,buttonEnabled:!0,position:()=>{let e=t;return this.view&&(e="xsmall"===this.view.widthBreakpoint?["top-left","top-center","top-right"].includes(t)?"top-center":"bottom-center":t),e||(e="auto"),e}}):(e.dockEnabled=!1,e.dockOptions={breakpoint:!0,buttonEnabled:!0,position:"auto"}))}checkAndHandleMutableStateProps(){if(this.view&&this.props.baseWidgetProps.mutableStateProps){const e=this.view.dataSourceInfo.jimuMapViewId,t=o.MapViewManager.getInstance().getJimuMapViewById(e);t&&t.whenJimuMapViewLoaded().then(()=>{setTimeout(()=>{this.handleAction(this.props.baseWidgetProps.mutableStateProps,this.view,t),this.isFirstReceiveMessage=!1},this.isFirstReceiveMessage?500:0)})}}isMapView(e){return e&&"esri.views.MapView"===e.declaredClass}isSceneView(e){return e&&"esri.views.SceneView"===e.declaredClass}diffProps(e){const t=[],i=[],o=[],s=Object.keys(this.props),a=Object.keys(e),n={};a.forEach(e=>{n[e]=!0});const l={};return s.forEach(e=>{l[e]=!0}),s.forEach(i=>{n[i]?e[i]!==this.props[i]&&o.push(i):t.push(i)}),a.forEach(e=>{l[e]||i.push(e)}),{addedKeys:t,removeKeys:i,updatedKeys:o}}loadCommonModules(){return J(this,void 0,void 0,function*(){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/geometry/Extent","esri/Viewpoint","esri/portal/Portal","esri/portal/PortalItem","esri/Color","esri/geometry/SpatialReference","esri/geometry/Point","esri/core/reactiveUtils"]);[this.Extent,this.Viewpoint,this.Portal,this.PortalItem,this.Color,this.SpatialReference,this.Point,this.reactiveUtils]=e,this.__unmount||this.setState({isBasicModulesLoaded:!0})})}cacheLoadModulesAndCreateMapbaseView(e,t){return J(this,void 0,void 0,function*(){var i;if(this.__unmount||this.isCurrentViewExpected()||this.isCreatingExpectedView())return;const s=null==e?void 0:e.uniqueId;if(s){if(t&&this.mapViewCreateFailedUniqueIdsInfo[s])return void console.log("do not create map because it failed before",s);delete this.mapViewCreateFailedUniqueIdsInfo[s]}this.setState({mapLoadStatus:_.Loading});const a={dataSourceInfo:e};this.mapCreatingInfo=a;const n=this.props.dataSourceId||"";try{if((null===(i=this.state)||void 0===i?void 0:i.isBasicModulesLoaded)||(yield this.loadCommonModules()),e.isWebMap){if(!this.MapView){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/geometry/Geometry","esri/webmap/InitialViewProperties","esri/Basemap","esri/layers/TileLayer","esri/views/MapView","esri/WebMap"]);[this.Geometry,this.InitialViewProperties,this.Basemap,this.TileLayer,this.MapView,this.WebMap]=e}}else if(!this.SceneView){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/views/SceneView","esri/WebScene"]);[this.SceneView,this.WebScene]=e}if(this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(a.dataSourceInfo))return;yield this.createMapbaseView(a),s&&delete this.mapViewCreateFailedUniqueIdsInfo[s]}catch(e){console.error("cacheLoadModulesAndCreateMapbaseView error",e),s&&(this.mapViewCreateFailedUniqueIdsInfo[s]=!0),this.mapCreatingInfo===a&&this.setState({mapLoadStatus:_.LoadError},()=>{this.props.onMapLoaded&&this.props.onMapLoaded(n,_.LoadError)})}this.mapCreatingInfo===a&&(this.mapCreatingInfo=null)})}createMapbaseView(e){return J(this,void 0,void 0,function*(){var t,i;const o=e.dataSourceInfo;if(this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(o))return;const s=o.uniqueId;let a=null,n=null;o.isWebMap?a=this.getMapViewOptionToCreateMapView(o):n=this.getSceneViewOptionToCreateSceneView(o);const l=a&&a.map||n&&n.map;if(!l||"failed"===l.loadStatus)return void console.log("webmap load failed, so can't create mapbase view,",s);const r={defaultPopupTemplateEnabled:!0},p=this.props.baseWidgetProps.config;if(p){const e=U(p);e&&this.updatePopupDockParams(r,e)}if(a&&(a.popup=r),n&&(n.popup=r),this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(o))return;let c=null,d=!1;if(this.props.baseWidgetProps.isRunAppMode&&(c=this.getMapOptionsByUrlHashParams(o.isWebMap),c)){d=!!(null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.runtimePersistentMapState);const e=c.viewpoint;if(a){let t=!1;e&&(a.viewpoint=e,t=!0),c.center&&(a.center=c.center),"scale"in c&&(a.scale=c.scale,t=!0),!("scale"in a)&&"level"in c&&(a.zoom=c.level),"rotation"in c&&(a.rotation=c.rotation,t=!0);!this.getFinalSnapToZoomByConfig()&&t&&(a.constraints.snapToZoom=!1)}n&&e&&(n.viewpoint=e)}let h=null;o.isWebMap?h=new this.MapView(a):(h=new this.SceneView(n),h[$]=null==p?void 0:p.sceneQualityMode),this.afterCreateView(h,o,p,c,d),this.view&&(this.destroyCurrentMapbaseView(),this.view=null),this.view=h,this.isReadyToCreateJimuMapView()&&this.createJimuMapView();const u=h.map,m=new Promise((e,t)=>{u.when(()=>{e()},e=>{console.error("map when error callback",e),t(e)})}),g=new Promise((e,t)=>{h.when(()=>{this.viewWhen(h),e()},e=>{console.error("view when error callback",e),t(e)})});this.bindMapBaseViewEvent(h),this.tryUpdateCurrentViewByConfigProps(!0),this.checkAndHandleMutableStateProps();try{yield Promise.all([m,g])}catch(e){console.error("map or view when error",e);const t=h===this.view;throw this.destroyMapbaseView(h),t&&(this.view=null),e}})}afterCreateView(e,t,i,o,s){var a,n;const l=this.createDefaultHighlightOptionsByConfig(i,this.Color);if(l){const t=M(e);t?(l.color&&(t.color=l.color),l.haloColor&&(t.haloColor=l.haloColor)):null===(a=e.highlights)||void 0===a||a.unshift(l)}e.initUrlHashMapOptions=o,e.runtimeUrlHashParams=null===(n=this.props.baseWidgetProps)||void 0===n?void 0:n.runtimeUrlHashParams,e.isPersistentMapStateUsed=s;const r=e.map,p=()=>{if(r.originalBasemap)return;const e=r.basemap;if(e){if(!e.thumbnailUrl){const t=r.thumbnailUrl;t&&(e.thumbnailUrl=t)}r.originalBasemap=e}};if(r.basemap)p();else{let e=null;e=this.reactiveUtils.watch(()=>null==r?void 0:r.basemap,()=>{e&&e.remove(),e=null,r.basemap&&p()})}e.mapbase=this,e.highLightHandles={},e.mapBaseViewEventHandles={},e.extentChangeRelatedWidgetIds=[],e.publishExtentChangeMessage=function(t,i){try{if(e&&!e.destroyed){const o=e.mapbase;o&&!o.__unmount&&o.props&&o.props.onExtentChanged&&o.publishExtentChangeMessage(e,t,i)}}catch(e){console.error("view publish extent change message error",e)}},e.hideMapTools=function(){try{if(e.isMapToolsHidden=!0,e&&!e.destroyed){const t=e.mapbase;if(t&&!t.__unmount&&t.props){t.props.onActiveToolInfoChange&&t.props.onActiveToolInfoChange(null);const e=t.props.multiSourceMapDom;e&&e.classList.add("hide-map-tools-layout")}}}catch(e){console.error("view hide map tools error",e)}},e.viewpointHistory=[],e.viewpointIndex=-1,e.showMapTools=function(){try{if(e.isMapToolsHidden=!1,e&&!e.destroyed){const t=e.mapbase;if(t&&!t.__unmount&&t.props){const e=t.props.multiSourceMapDom;e&&e.classList.remove("hide-map-tools-layout")}}}catch(e){console.error("view show map tools error",e)}},e.dataSourceInfo=t;const c=this.props.baseWidgetProps.runtimeUrlHashParams;e.parseMarkerGroupUrlParam=function(){return j(c)}}viewWhen(e){var t,i,o,s;if(e.isViewWhenReady=!0,e.originalBasemapLODs=null===(t=e.constraintsInfo)||void 0===t?void 0:t.lods,this.initViewTimeZone(e),e.viewpoint?e.lastViewpointToUpdateUrlParams=e.viewpoint.clone():e.lastViewpointToUpdateUrlParams=null,"2d"===e.type){this.applyFinalMinMaxScaleLODsFor2dMapView(e)&&setTimeout(()=>{e.viewpoint&&(e.lastViewpointToUpdateUrlParams=e.viewpoint.clone())},100)}e.viewWhenTimestamp=Date.now();!e.destroyed&&this.view===e&&this.isViewExpected(e)&&(setTimeout(()=>{e.destroyed||this.publishExtentChangeMessage(e,!0)},1e3),e.watchInteractingHandle=this.reactiveUtils.watch(()=>null==e?void 0:e.interacting,()=>{e.interacting&&(K.lastInteractiveView=e,this.setExtentChangeRelatedWidgetIdsForView(e,[]))}),e.extentWatchHandle=this.reactiveUtils.watch(()=>null==e?void 0:e.extent,t=>{t&&(this.publishExtentChangeMessage(e,!1),e.stationaryTimerId&&(clearTimeout(e.stationaryTimerId),e.stationaryTimerId=null),e.stationaryTimerId=setTimeout(()=>{e.stationaryTimerId=null,this.publishExtentChangeMessage(e,!0),this.setExtentChangeRelatedWidgetIdsForView(e,[]),setTimeout(()=>{e!==K.lastInteractiveView||e.interacting||(K.lastInteractiveView=null)},1e3)},200))}),"2d"===e.type&&(e.watchLodsHandle=this.reactiveUtils.watch(()=>{var t;return null===(t=e.constraintsInfo)||void 0===t?void 0:t.lods},()=>{this.applyFinalMinMaxScaleLODsFor2dMapView(e)})),e.fatalErrorWatchHandle||(e.fatalErrorWatchHandle=this.reactiveUtils.watch(()=>null==e?void 0:e.fatalError,t=>{var i,o;if(t){const t=!e.isInCaching&&e.container&&e.container.clientWidth>0&&e.container.clientHeight>0,s=(null===(o=null===(i=this.props)||void 0===i?void 0:i.baseWidgetProps)||void 0===o?void 0:o.id)||"";t?(console.error(`${s} Fatal Error! View has lost its WebGL context. Attempting to recover it because the view is visible.`),this.tryFatalErrorRecovery(e)):console.error(`${s} Fatal Error! View has lost its WebGL context. Don't recover it because the view is not visible.`)}})),this.setState({mapLoadStatus:_.Loadok},()=>{this.props.onMapLoaded(this.props.dataSourceId,_.Loadok)}),(null===(s=null===(o=null===(i=this.props.baseWidgetProps)||void 0===i?void 0:i.mutableStateProps)||void 0===o?void 0:o.zoomToFeatureActionValue)||void 0===s?void 0:s.value)||e.initUrlHashMapOptions||this.goHome(!1),this.isMapView(e)&&setTimeout(()=>{const t=e.constraints;t&&(t.snapToZoom=this.getFinalSnapToZoomByConfig())},0))}publishExtentChangeMessage(e,t,o){if(!e)return;const s=Date.now();e.firstPublishExtentChangeTime||(e.firstPublishExtentChangeTime=s);const a=e.extent.clone(),n=e.viewpoint.clone(),l=new i.ExtentChangeMessage(this.props.baseWidgetProps.id,a,n,t);l.publishTime=s,l.interactive=o||e.interacting;const r=this.getExtentChangeRelatedWidgetIdsOfView(e);if(l.setRelatedWidgetIds(r),l.addRelatedWidgetId(this.props.baseWidgetProps.id),this.props.onExtentChanged(this.props.dataSourceId,l),t){const t=e.viewpoint.clone();if(e.viewpointHistory.length>0){const i=[e.viewpointIndex,e.viewpointIndex-1,e.viewpointIndex+1];let o=!1;const s=e.viewpointHistory.length-1;for(let a=0;a<i.length;a++){const n=i[a];if(n>=0&&n<=s){const i=L(e,n);if(i&&P(e,t,i)){o=!0;break}}}o||(e.viewpointHistory.splice(e.viewpointIndex+1),e.viewpointHistory.push(t),e.viewpointIndex+=1)}else e.viewpointHistory.push(t),e.viewpointIndex=0;e.stationaryCallback&&e.stationaryCallback()}this.debounceUpdateViewUrlParamsAndPersistentMapState()}updateViewUrlParamsAndPersistentMapState(){if(this.view){const e=this.getJimuMapViewFoView(this.view);if(e&&e.isActive){!P(this.view,this.view.viewpoint,this.view.lastViewpointToUpdateUrlParams)&&(A(e),E(e))}}}generateViewPointFromInitialMapState(e){return"2d"===e.viewType?new this.Viewpoint({targetGeometry:this.Extent.fromJSON(e.extent),rotation:e.rotation}):this.Viewpoint.fromJSON(e.viewPoint)}getMapOptionsByUrlHashParams(e){let t=null;try{const i=this.props.baseWidgetProps.isRunAppMode,o=this.props.baseWidgetProps.runtimeUrlHashParams;i&&o&&(t=N(o,e,this.Viewpoint,this.Point,this.SpatialReference))}catch(e){console.error("parse map options from url hash params error",e),t=null}return t}initViewTimeZone(e){return J(this,void 0,void 0,function*(){try{if(!e)return;const t=e.map;if(!t)return;const i=yield t.resourceInfo;i&&(t.originalItemTimeZone=i.timeZone)}catch(e){console.error("can not get MapViewer timeZone",e)}this.updateMapViewTimeZone(e)})}updateMapViewTimeZone(e){if("2d"===(null==e?void 0:e.type)){const t=this.calMapViewTimeZone(e.map),i=e;i.timeZone!==t&&(i.timeZone=t)}}calMapViewTimeZone(e){var t,i;let o="";const s=null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.mapTimeZone,a=null==e?void 0:e.originalItemTimeZone;return o=s||(a||"system"),o}createWebMapOrWebSceneByDataSource(e){let t=null;const o=e.isWebMap?this.WebMap:this.WebScene,s=e.dataSourceJson;if(s.portalUrl){const e=new this.Portal({url:i.portalUrlUtils.getPlatformUrlByOrgUrl(s.portalUrl)});t=new o({portalItem:new this.PortalItem({id:s.itemId,portal:e})})}else t=new o({portalItem:new this.PortalItem({id:s.itemId})});return t}getDefaultWebMap(){const e=this.props.defaultMapInfo&&this.props.defaultMapInfo.defaultExtent,t=new this.Viewpoint({targetGeometry:new this.Extent({xmin:e&&e.xmin,ymin:e&&e.ymin,xmax:e&&e.xmax,ymax:e&&e.ymax,spatialReference:{wkid:e.spatialReference.wkid}})});return new this.WebMap({portalItem:{id:this.props.defaultMapInfo.defaultMapId,portal:{url:this.props.baseWidgetProps.portalUrl}},initialViewProperties:new this.InitialViewProperties({spatialReference:e&&e.spatialReference,viewpoint:t})})}getMapViewOptionToCreateMapView(e){var t;let i;const o=this.props.baseWidgetProps.config,s=o.initialMapState,a=o.customLODs;let n=null;this.props.isDefaultMap?(n=this.getDefaultWebMap(),i={map:n,container:this.mapContainer,viewpoint:this.getInitViewPointForDefaultWebMap()}):(n=this.createWebMapOrWebSceneByDataSource(e),i=s?{map:n,container:this.mapContainer,viewpoint:s&&this.generateViewPointFromInitialMapState(s)}:{map:n,container:this.mapContainer});const l={snapToZoom:!0};if((null===(t=null==a?void 0:a.lods)||void 0===t?void 0:t.length)>0){const e=a.lods.asMutable({deep:!0});l.lods=e}if(i.constraints=l,!window.jimuConfig.isInBuilder&&this.props.baseWidgetProps.queryObject[this.props.baseWidgetProps.id]){const e=this.props.baseWidgetProps.queryObject[this.props.baseWidgetProps.id].substr(7);let t;try{t=new this.Extent(JSON.parse(e))}catch(e){console.error("Bad extent URL parameter.")}t&&(i.extent=t)}return i}getSceneViewOptionToCreateSceneView(t){const i={map:this.createWebMapOrWebSceneByDataSource(t),container:this.mapContainer},o=this.props.baseWidgetProps.config,s=o.initialMapState;s&&(i.viewpoint=s&&this.generateViewPointFromInitialMapState(s));const a=o.sceneQualityMode;return a&&a!==e.auto&&(i.qualityProfile=a),i}createDefaultHighlightOptionsByConfig(e,t){const i=(null==e?void 0:e.selectionHighlightColor)||"#00FFFF",o=(null==e?void 0:e.selectionHighlightHaloColor)||"#00FFFF";return{name:"default",color:new t(i),haloColor:new t(o)}}bindMapBaseViewEvent(e){e&&(this.releaseMapbaseViewEventHandles(e),e.mapBaseViewEventHandles.click=e.on("click",()=>{this.releaseHighLightHandles(e)}))}isReadyToCreateJimuMapView(){return!!this.view&&(!!this.props.isDefaultMap||this.mapDs&&this.mapDs.id===this.props.dataSourceId)}getJimuMapViewFoView(e){var t;const i=null===(t=null==e?void 0:e.dataSourceInfo)||void 0===t?void 0:t.jimuMapViewId;if(i){return o.MapViewManager.getInstance().getJimuMapViewById(i)}return null}createJimuMapView(){var e;if(!this.isReadyToCreateJimuMapView())return;const t=o.MapViewManager.getInstance(),i=this.view,s=null===(e=i.dataSourceInfo)||void 0===e?void 0:e.jimuMapViewId;if(s){const e=t.getJimuMapViewById(s);(null==e?void 0:e.view)&&(null==e?void 0:e.view)!==i&&t.destroyJimuMapView(s)}const a=this.props.dataSourceId||"",n=this.props.baseWidgetProps.isRunAppMode;t.createJimuMapView({mapWidgetId:this.props.baseWidgetProps.id,dataSourceId:a,view:i,isEnablePopup:this.props.baseWidgetProps.config&&!this.props.baseWidgetProps.config.disablePopUp,mapViewManager:t,useUrlHashLayersVisibility:n}),i.when(()=>{const e=i.dataSourceInfo.jimuMapViewId,o=t.getJimuMapViewById(e);o&&(o.view?o.whenJimuMapViewLoaded().then(()=>{o.view?this.isViewExpected(i)&&this.props.onJimuMapViewCreated&&this.props.onJimuMapViewCreated(o):t.destroyJimuMapView(e)}):t.destroyJimuMapView(e))})}destroyCurrentMapbaseView(){this.view&&this.destroyMapbaseView(this.view),this.view=null}destroyMapbaseView(e){e&&(e.watchInteractingHandle&&(e.watchInteractingHandle.remove(),e.watchInteractingHandle=null),e.extentWatchHandle&&(e.extentWatchHandle.remove(),e.extentWatchHandle=null),e.watchLodsHandle&&(e.watchLodsHandle.remove(),e.watchLodsHandle=null),e.fatalErrorWatchHandle&&(e.fatalErrorWatchHandle.remove(),e.fatalErrorWatchHandle=null),e.stationaryTimerId&&(clearTimeout(e.stationaryTimerId),e.stationaryTimerId=null),this.releaseHighLightHandles(e),this.releaseMapbaseViewEventHandles(e));const t=e.dataSourceInfo.jimuMapViewId;t&&o.MapViewManager.getInstance().destroyJimuMapView(t),e.destroyed||e.destroy()}releaseHighLightHandles(e){if(e.highLightHandles){const t=Object.keys(e.highLightHandles);for(const i of t)e.highLightHandles[i].remove()}e.highLightHandles={}}releaseMapbaseViewEventHandles(e){if(e.mapBaseViewEventHandles){const t=Object.keys(e.mapBaseViewEventHandles);for(const i of t)e.mapBaseViewEventHandles[i].remove()}e.mapBaseViewEventHandles={}}onStoreResourceSessionsChange(e,t){e&&i.lodash.defer(()=>{var o,s,a,n,l,r;if(!this.expectedDataSourceInfo)return;if(this.mapCreatingInfo)return;if(this.view){if(!this.view.isViewWhenReady)return;if(this.view.isInCaching)return}let p=!1,c="";c=this.expectedDataSourceInfo.isDefaultMap?null===(o=this.props.baseWidgetProps)||void 0===o?void 0:o.portalUrl:null===(s=this.expectedDataSourceInfo.dataSourceJson)||void 0===s?void 0:s.portalUrl,c&&(c=i.portalUrlUtils.getPlatformUrlByOrgUrl(c));const d=c?i.portalUrlUtils.getStandardPortalUrl(c):"";if(d){p=((null==e?void 0:e[d])||"")!==((null==t?void 0:t[d])||"")}let h=!1;if(this.view&&this.view.isViewWhenReady&&this.isViewExpected(this.view)){const o=(null===(n=null===(a=this.view.map)||void 0===a?void 0:a.allLayers)||void 0===n?void 0:n.toArray())||[];if(o.length>0){const s=i.ServiceManager.getInstance(),a=o.some(o=>{var a;const n=null==o?void 0:o.url;if(!n)return!1;const l=null===(a=s.getServerInfoByServiceUrl(n))||void 0===a?void 0:a.owningSystemUrl,r=i.serviceUrlUtils.getServerRootUrl(n),p=i.portalUrlUtils.getStandardPortalUrl(l||r);if(!p)return!1;return((null==e?void 0:e[p])||"")!==((null==t?void 0:t[p])||"")});h=a}}const u=this.view?this.getJimuMapViewFoView(this.view):null,m=null==u?void 0:u.id;if(p||h){const e=null===(r=null===(l=this.props)||void 0===l?void 0:l.baseWidgetProps)||void 0===r?void 0:r.widgetId;console.log(`create map because resource session changed, mapWidgetId: ${e}, jimuMapViewId: ${m}`),this.destroyCurrentMapbaseView();const t=!1;this.cacheLoadModulesAndCreateMapbaseView(this.expectedDataSourceInfo,t)}})}destroyCurrentMapbaseViewIfMapLoadFailed(){if(this.view){const e=this.view.map;(null==e?void 0:e.loadError)&&"failed"===(null==e?void 0:e.loadStatus)&&this.destroyCurrentMapbaseView()}}getRestoreDataFromMS(){const e=this.getRestoreDataKey();return i.MutableStoreManager.getInstance().getStateValue([this.props.baseWidgetProps.id,"restoreData",e])}updateRestoreDataToMS(e){const t=this.getRestoreDataKey();i.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${t}`,e)}getRestoreDataKey(){return`${this.props.baseWidgetProps.id}-restoreData-${this.props.dataSourceId}`}goHome(e){return J(this,void 0,void 0,function*(){if(!this.getDsJsonFromDsId(this.props.dataSourceId))return;const t=(0,i.getAppStore)().getState().appConfig.widgets;if(this.view&&t[this.props.baseWidgetProps.id]){const t=this.getMapBaseInitViewPoint();if(t)return this.view.goTo(t,{animate:e})}})}getMapBaseInitViewPoint(){var e,t;if(this.props.isDefaultMap)return this.getInitViewPointForDefaultWebMap();{const i=this.props.baseWidgetProps.config.initialMapState;if(i)return this.generateViewPointFromInitialMapState(i);if(this.view){const i=this.view.map;return null===(t=null===(e=null==i?void 0:i.initialViewProperties)||void 0===e?void 0:e.viewpoint)||void 0===t?void 0:t.clone()}}}formatMessage(e){return this.props.baseWidgetProps.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}handleDisableWheel(){this.widgetContainer.style.pointerEvents="none",setTimeout(()=>{this.widgetContainer.style.pointerEvents="auto"},50)}getMapSwitchForErrorMap(){return(0,t.jsx)(R.Consumer,{children:({isShowMapSwitchBtn:e,dataSourceIds:i,activeDataSourceId:o,switchMap:a})=>(0,t.jsx)("div",{className:"mapswitch-container",style:{display:e?"block":"none",marginBottom:"xsmall"===this.props.widthBreakpoint?10:0},children:(0,t.jsx)("div",{onClick:e=>{e.preventDefault(),a()},className:"w-100 h-100 esri-widget--button-like",children:(0,t.jsx)(s.Icon,{icon:G,width:16,height:16,className:"mapswitch-icon"})})})})}handleAction(e,t,i){t&&!t.destroyed&&(this.handleActionForZoomToFeatureActionValue(e,t),this.handleActionForPanToActionValue(e,t),this.handleActionForFlashActionValueAndFilterActionValue(e,t),this.handleActionForShowOnMapDatas(e,i),this.handleActionForAddToMapDatas(e,i),this.handleActionForAddMarker(e,i))}getExtentChangeRelatedWidgetIdsOfView(e){let t=[];if(e){t=(e.extentChangeRelatedWidgetIds||[]).slice()}return t}setExtentChangeRelatedWidgetIdsForView(e,t){if(e){const i=t||[];e.extentChangeRelatedWidgetIds=i.slice()}}tryFatalErrorRecovery(e){e&&e.tryFatalErrorRecovery()}handleActionForZoomToFeatureActionValue(e,t){return J(this,void 0,void 0,function*(){var i;if(!e.zoomToFeatureActionValue)return;const s=Date.now(),a=this.getJimuMapViewFoView(t),n=e.zoomToFeatureActionValue,l=e.zoomToFeatureActionValue.relatedWidgets||[];if(l&&l.includes(this.props.baseWidgetProps.id))this.props.onMutableStatePropsChanged(this.props.dataSourceId,"zoomToFeatureActionValue",null);else{const e=n.value;if("zoom-to-extent"===e.type){const i=Date.now();t.lastZoomToExtentTime=i;let o=!1;if(t.firstPublishExtentChangeTime&&i-t.firstPublishExtentChangeTime<=2e3&&t.firstPublishExtentChangeTime<=e.publishTime&&(e.interactive||T(this.props.baseWidgetProps.id,e.publishWidgetId)&&(o=!0)),!o&&t!==K.lastInteractiveView){const i=e.viewpoint,o=e.extent,a=e.stationary;this.setExtentChangeRelatedWidgetIdsForView(t,l);const n=t.spatialReference;i?!function(e,t){var i,o,s;const a=null===(i=e.targetGeometry)||void 0===i?void 0:i.spatialReference;if(a&&d(a,t))return!0;const n=null===(s=null===(o=e.camera)||void 0===o?void 0:o.position)||void 0===s?void 0:s.spatialReference;return!(!n||!d(n,t))}(i,n)?t.viewpoint=i:a&&h(i,n).then(e=>{t.receiveMessageTimeOfLastViewUpdate&&t.receiveMessageTimeOfLastViewUpdate>s||(t.viewpoint=e)}):d(o.spatialReference,n)?a&&S([o],n).then(e=>{const i=e[0];t.goTo(i)}):t.goTo(o,{animate:!1})}}else if("zoom-to-query-params"===e.type)this.queryExtentFromQueryParams(t,e.filterChangedDataSourceIds,e.useDataSourceIds).then(i=>{if(!i)return;let s;0!==i.count&&(s=1===i.count&&(null==i?void 0:i.singlePointGraphic)?{graphics:[null==i?void 0:i.singlePointGraphic],layer:null==i?void 0:i.layer}:null==i?void 0:i.extent,this.setExtentChangeRelatedWidgetIdsForView(t,l),i.useDefaultExtentOfCurrentView?t.goTo(i.viewpoint):o.zoomToUtils.zoomTo(t,s,e.zoomToOption))});else if("zoom-to-array-graphics"===e.type)this.setExtentChangeRelatedWidgetIdsForView(t,l),o.zoomToUtils.zoomTo(t,e.arrayFeatures,e.zoomToOption);else if("zoom-to-layers"===e.type){I(e.dataSourceIds).then(i=>{this.setExtentChangeRelatedWidgetIdsForView(t,l),o.zoomToUtils.zoomTo(t,i,e.zoomToOption)})}else if("zoom-to-map-initial-extent"===e.type){const e=this.getMapBaseInitViewPoint();e&&(this.setExtentChangeRelatedWidgetIdsForView(t,l),t.goTo(e))}else if("zoom-to-features-extent"===e.type){const s=e.extent;if(s){let n=null;if("function"==typeof s)try{a&&(n=yield s(a))}catch(e){console.error("can not get extent by extent function",e)}else n=s;if(n){const s="esri.geometry.Extent"===(null==n?void 0:n.declaredClass),a="esri.Graphic"===(null==n?void 0:n.declaredClass);if(s||a){let r=null;if(s?r=n:a&&(r=[n]),r){this.setExtentChangeRelatedWidgetIdsForView(t,l);const s=null===(i=e.zoomToOption)||void 0===i?void 0:i.scale;let a=null;"number"==typeof s&&s>=0&&(a={scale:s}),o.zoomToUtils.zoomTo(t,r,a)}}}}}else if("zoom-to-graphics"===e.type){const i=e.features||[];if(i.length>0||e.dataSourceId){const s=this.dsManager.getDataSource(e.dataSourceId);let a=null;s&&(s.layer?a=s.layer:s.createJSAPILayerByDataSource&&(a=yield s.createJSAPILayerByDataSource()));const n=yield function(e,t,i){return c(this,void 0,void 0,function*(){return e&&"3d"===e.type&&t&&t.queryFeatures&&i?yield(0,o.loadArcGISJSAPIModules)(["esri/rest/support/Query"]).then(e=>{const[o]=e,s=new o;return s.returnGeometry=!0,s.outFields=["*"],s.objectIds=i.map(e=>e.attributes[t.objectIdField]),t.queryFeatures(s).then(e=>c(this,void 0,void 0,function*(){return e&&e.features&&e.features.length===i.length?yield Promise.resolve(e.features):yield Promise.resolve(i)}),()=>c(this,void 0,void 0,function*(){return yield Promise.resolve(i)}))}):yield Promise.resolve(i)})}(t,a,i);let r=null;r=a?{layer:a,graphics:n}:n,e.zoomToOption||(e.zoomToOption={}),this.setExtentChangeRelatedWidgetIdsForView(t,l),e.zoomToOption.queryParams=(null==s?void 0:s.getCurrentQueryParams)&&s.getCurrentQueryParams()||"",o.zoomToUtils.zoomTo(t,r,e.zoomToOption)}}this.props.onMutableStatePropsChanged(this.props.dataSourceId,"zoomToFeatureActionValue",null)}})}handleActionForPanToActionValue(e,t){var i;if(!e.panToActionValue)return;const s=e.panToActionValue.relatedWidgets||[],a=null===(i=e.panToActionValue.value)||void 0===i?void 0:i.type;if(s&&s.includes(this.props.baseWidgetProps.id))this.props.onMutableStatePropsChanged(this.props.dataSourceId,"panToActionValue",null);else if("pan-to-query-params"===a){const i=e.panToActionValue.value;this.queryExtentFromQueryParams(t,i.filterChangedDataSourceIds,i.useDataSourceIds).then(e=>{var i,o,a;if(e)if(e.useDefaultExtentOfCurrentView){const n=(null===(o=null===(i=null==e?void 0:e.viewpoint)||void 0===i?void 0:i.camera)||void 0===o?void 0:o.position)||(null===(a=null==e?void 0:e.viewpoint)||void 0===a?void 0:a.targetGeometry);this.panToGeometry([n],t,s)}else this.panToGeometry([null==e?void 0:e.extent],t,s)})}else if("pan-to-layer"===a){const i=e.panToActionValue.value,s=this.dsManager.getDataSource(i.dataSourceId);let a;a=(null==s?void 0:s.layer)?Promise.resolve(s.layer):(null==s?void 0:s.createJSAPILayerByDataSource)?s.createJSAPILayerByDataSource():Promise.resolve(null),a.then(e=>{let i=null;s&&s.getCurrentQueryParams&&(i=s.getCurrentQueryParams()),o.zoomToUtils.layerExtent(t,e,i).then(e=>{e&&this.panToGeometry([e],t,[])})})}else if("pan-to-layers"===a){I(e.panToActionValue.value.dataSourceIds).then(e=>{const i=[];e.forEach(e=>{e&&i.push(o.zoomToUtils.layerExtent(t,e))});let s=null;return Promise.all(i).then(e=>{e.forEach(e=>{e&&(s=s?s.union(e):e)}),s&&this.panToGeometry([s],t,[])})})}else if("pan-to-geometries"===a){const i=e.panToActionValue.value;this.panToGeometry(i.geometries,t,s)}else if("pan-to-map-initial-extent"===a){const e=this.getMapBaseInitViewPoint();e&&(this.setExtentChangeRelatedWidgetIdsForView(t,s),t.goTo(e))}else if("pan-to-extent"===a){let i=!1;const o=Date.now();t.firstPublishExtentChangeTime&&o-t.firstPublishExtentChangeTime<=2e3&&t.firstPublishExtentChangeTime<=e.panToActionValue.value.publishTime&&T(this.props.baseWidgetProps.id,e.panToActionValue.value.publishWidgetId)&&(i=!0);let a=!1;if(t.lastZoomToExtentTime&&o-t.lastZoomToExtentTime<=500&&(a=!0),!i&&!a&&t!==K.lastInteractiveView){this.setExtentChangeRelatedWidgetIdsForView(t,s);const i=e.panToActionValue.value,o=i.geometries[0].center,a=i.stationary,n=t.spatialReference;d(o.spatialReference,n)?a&&S([o],n).then(e=>{const i=e[0];t.goTo(i)}):t.center=o}}this.props.onMutableStatePropsChanged(this.props.dataSourceId,"panToActionValue",null)}panToGeometry(e,t,i){S(e,t.spatialReference).then(e=>{this.setExtentChangeRelatedWidgetIdsForView(t,i),function(e,t){c(this,void 0,void 0,function*(){const i=t,o=e;if(!(i instanceof Array)){if(i.geometry){const e=i.geometry;return u(o,y(e))}return u(o,y(i))}if(0!==i.length){if(!i[0].geometry)return m(i).then(e=>u(o,e.center));{const e=[];for(let t=0;t<i.length;t++)e.push(i[t].geometry);yield m(e).then(e=>u(o,e.center))}}else yield Promise.resolve()})}(t,e)})}handleActionForFlashActionValueAndFilterActionValue(e,t){Object.keys(e).some(s=>{var a;const n=t.dataSourceInfo.jimuMapViewId,l=o.MapViewManager.getInstance().getJimuMapViewById(n);return 0===s.indexOf("flashActionValue-")&&e[s]&&(e[s].querySQL&&f(l,e[s].layerDataSourceId,e[s].querySQL),this.props.onMutableStatePropsChanged(this.props.dataSourceId,s,null)),0===s.indexOf("filterActionValue-")&&e[s]&&((null===(a=e[s].querySQL)||void 0===a?void 0:a.length)>=0&&function(e,t,o){c(this,void 0,void 0,function*(){if(!t)return;const s=i.DataSourceManager.getInstance().getDataSource(t);if(!s)return;let a=null;try{a=yield e.whenJimuLayerViewLoadedByDataSource(s)}catch(e){a=null,console.error("can't get jimuLayerView by dataSource",s,e)}const n=[i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer,i.JSAPILayerTypes.ImageryLayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.SubtypeGroupLayer,i.JSAPILayerTypes.SubtypeSublayer];a&&a.layer&&n.includes(a.type)&&a.setDefinitionExpression&&a.setDefinitionExpression(o)})}(l,e[s].layerDataSourceId,e[s].querySQL),this.props.onMutableStatePropsChanged(this.props.dataSourceId,s,null)),!1})}handleActionForShowOnMapDatas(e,t){e.showOnMapDatas&&t.handleShowOnMapAction(e.showOnMapDatas)}handleActionForAddToMapDatas(e,t){e.addToMapDatas&&t.handleAddToMapAction(e.addToMapDatas)}handleActionForAddMarker(e,t){return J(this,void 0,void 0,function*(){var s;const a=null==e?void 0:e.addMarkerData;if(t&&t.isActive&&a){const e=t.view;if(!(null==e?void 0:e.map))return;const n=(null==a?void 0:a.graphics)||[],l=this.props.baseWidgetProps.id,r=i.MutableStoreManager.getInstance();if(r.updateStateValue(l,"addMarkerData",null),(null==n?void 0:n.length)>0){yield t.addMarkers([a]),t.updateMarkerUrlParamIfActive();const i=null===(s=n[0])||void 0===s?void 0:s.geometry;1===n.length&&"point"===(null==i?void 0:i.type)?e.goTo(i):o.zoomToUtils.zoomTo(e,n,{padding:{left:50,right:50,top:50,bottom:50}}),r.updateStateValue(l,"updateRender",Date.now())}}})}}K.runtimeInitedJimuMapViews={};const q=K;var Z=r(41496);class Q extends i.React.PureComponent{constructor(e){super(e),this.getMapFixedLayout=()=>{if(window.jimuConfig.isInBuilder){const e=this.props.LayoutEntry,o=this.props.layouts&&this.props.layouts.MapFixedLayout;return(0,t.jsx)(e,{layouts:o||null,isInWidget:!0,className:(0,i.classNames)("w-100 h-100 map-fix-layout",{"widget-map-usemask":!x(this.props.appMode),"map-is-live-mode":x(this.props.appMode)})})}{const e=this.props.layouts&&this.props.layouts.MapFixedLayout;return(0,t.jsx)(Z.LayoutEntry,{layouts:e?(0,i.Immutable)(e):null,className:"w-100 h-100 map-is-live-mode map-fix-layout"})}},this.state={}}render(){return this.getMapFixedLayout()}}class Y extends i.React.PureComponent{}class X extends i.React.PureComponent{constructor(){super(...arguments),this.moveY=0,this.startY=0,this.isRegisted=!1,this.registerTouchEvent=e=>{e&&!this.isRegisted&&(e.addEventListener("touchstart",e=>{this.moveY=0;const t=e.touches[0];this.startY=t.clientY},{passive:!1}),e.addEventListener("touchmove",t=>{const i=t.touches[0];this.moveY=-1*(i.clientY-this.startY),this.startY=i.clientY,e.scrollTop=e.scrollTop+this.moveY},{passive:!1}),e.addEventListener("touchend",e=>{this.moveY=0,this.startY=0},{passive:!1}),this.isRegisted=!0)}}getStyle(){return i.css`
      overflow: auto;
      pointer-events: auto;
      `}render(){return(0,t.jsx)("div",{css:this.getStyle(),className:this.props.className,style:this.props.style,ref:e=>{this.registerTouchEvent(e)},children:this.props.children})}}class ee extends i.React.PureComponent{componentWillUnmount(){this.props.onDestroyed&&this.props.onDestroyed()}render(){return(0,t.jsx)(t.Fragment,{children:this.props.children})}}const te=r(91340),ie=r(60670);class oe extends Y{constructor(e){super(e),this.toolName=null,this.isContainedToMobilePanel=!1,this.generation=0,this.exbMapUiExpandContentRef=i.React.createRef(),this._onKeyDown=e=>{var t;"Enter"!==e.key&&" "!==e.key||((null===(t=this.props.activeToolInfo)||void 0===t?void 0:t.activeToolName)!==this.toolName?this._onIconClick():this.focusDefaultElement())},this._getContent=()=>this.props.toolJson.isOnlyExpanded?(0,t.jsx)("div",{css:this._cssStyle(),className:"exbmap-ui exbmap-ui-tool-panel",children:(0,t.jsx)(i.ErrorBoundary,{children:this.getExpandPanel()})}):this.props.isMobile?this._renderMobileTool():this._renderPCTool(),this.onResize=({width:e,height:t})=>{e&&t&&(this.generation=t,this.forceUpdate())},this.onMouseOverPopper=()=>{this.props.onMouseOverPopper&&this.props.onMouseOverPopper()},this.onMouseOutPopper=()=>{this.props.onMouseOutPopper&&this.props.onMouseOutPopper()},this.handleToggleMobilePanel=()=>{this.props.onActiveToolInfoChange(null)};const o=this.props.jimuMapView&&this.props.jimuMapView.view&&this.props.jimuMapView.view.container;s.MobilePanelManager.getInstance().checkDomIsContained(o)&&(this.isContainedToMobilePanel=!0),this.shiftOptions={boundary:o},this.flipOptions={padding:0},this._onKeyDown=this._onKeyDown.bind(this),this.onPopperToggle=this.onPopperToggle.bind(this)}_cssStyle(){const e=this.getExtendCssStyle();return i.css`
      ${e}
    `}getExtendCssStyle(){return""}focusDefaultElement(){}onShowPanel(){}onClosePanel(){}destroy(){}static getIsNeedSetting(){return!0}static isAvailable(e){return!0}onPopperToggle(e){e&&"keydown"===e.type&&"Escape"===e.key&&(this._onIconClick(),(0,i.focusElementInKeyboardMode)(this.iconContainer))}_onIconClick(e){const t=this.getIcon()&&this.getIcon().onIconClick;t&&t(e),this.getExpandPanel()&&(this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName===this.toolName?this.props.onActiveToolInfoChange(null):(this.props.onActiveToolInfoChange({activeToolName:this.toolName,activeToolTitle:this.getTitle()}),this.onShowPanel()))}_initIconContainer(e){e&&!this.iconContainer&&(this.iconContainer=e,this.forceUpdate())}_renderPCTool(){let e=this.getIcon();e||(e={icon:te,onIconClick:()=>null});const o=this.getExpandPanel(),a=this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName;this.generation=this.generation+1;const n=this.getTitle()||"",l=this.props.toolJson.isShowIconTitle?n:"",r=this.getAttributesForBtnRole()||{};return(0,t.jsxs)("div",{className:"exbmap-ui exbmap-ui-tool",css:this._cssStyle(),style:{width:"32px",height:"32px"},children:[(0,t.jsx)("div",Object.assign({style:{},ref:e=>{this._initIconContainer(e)},className:(0,i.classNames)("exbmap-ui-tool esri-widget--button-like",{selected:this.toolName===a&&o}),title:l,"aria-label":l,onClick:e=>{this._onIconClick(e)}},r,{role:"button",tabIndex:0,onKeyDown:this._onKeyDown,children:(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:16,height:16,className:"exbmap-ui-tool-icon",icon:e.icon})})),this.iconContainer&&this.toolName===a&&o&&(0,t.jsx)(ee,{onDestroyed:()=>{this.onClosePanel()},children:(0,t.jsx)(s.Popper,{className:`map-tool-popper exbmap-ui-popper ${this.props.mapRootClassName}`,reference:this.iconContainer,open:!(this.toolName!==a||!o),placement:this.props.toolJson.panelPlacement,shiftOptions:this.shiftOptions,flipOptions:this.flipOptions,version:this.generation,offsetOptions:4,toggle:this.onPopperToggle,forceLatestFocusElements:!0,onMouseEnter:this.onMouseOverPopper,onMouseLeave:this.onMouseOutPopper,children:(0,t.jsx)(R.Consumer,{children:({mapWidgetHeight:e})=>(0,t.jsx)("div",{css:this._cssStyle(),className:this.getExpandPanelPlacementClassName(),children:(0,t.jsxs)("div",{className:"exbmap-ui-expand-content",ref:this.exbMapUiExpandContentRef,children:[(0,t.jsxs)("div",{className:"w-100 justify-content-between d-flex exbmap-ui-expand-content-header",children:[(0,t.jsx)("div",{className:"panel-title text-truncate",style:{maxWidth:"210px"},title:n,children:n}),(0,t.jsx)("div",{onClick:()=>{this.props.onActiveToolInfoChange(null)},style:{cursor:"pointer"},tabIndex:0,role:"button","aria-label":this.props.intl.formatMessage({id:"close",defaultMessage:"close"}),children:(0,t.jsx)(s.Icon,{width:20,height:20,icon:ie})})]}),(0,t.jsx)(i.ErrorBoundary,{children:(0,t.jsx)("div",{style:{maxHeight:e-55+"px",overflowY:"Search"!==this.toolName?"auto":"inherit",borderBottomLeftRadius:"var(--sys-shape-2)",borderBottomRightRadius:"var(--sys-shape-2)"},children:o})}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.exbMapUiExpandContentRef,handleHeight:!0,onResize:this.onResize})]})})})})})]})}getAttributesForBtnRole(){var e;return{"aria-expanded":(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)===this.toolName}}_renderMobileTool(){let e=this.getIcon();e||(e={icon:te,onIconClick:()=>null});const o=this.getExpandPanel(),a=this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName;return(0,t.jsx)(R.Consumer,{children:({mobilePanelContainer:n})=>(0,t.jsxs)("div",{className:"exbmap-ui exbmap-ui-tool",css:this._cssStyle(),children:[(0,t.jsx)("div",{style:{},ref:e=>{this.iconContainer=e},className:(0,i.classNames)("exbmap-ui-tool esri-widget--button-like",{selected:this.toolName===a&&o}),role:"button",tabIndex:0,onKeyDown:this._onKeyDown,title:this.props.toolJson.isShowIconTitle?this.getTitle():"",onClick:e=>{this._onIconClick(e)},children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:e.icon})}),this.toolName===a&&o&&i.ReactDOM.createPortal((0,t.jsx)(ee,{onDestroyed:()=>{this.onClosePanel()},children:(0,t.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:this._cssStyle(),children:(0,t.jsx)(X,{className:"w-100 h-100",children:(0,t.jsx)(i.ErrorBoundary,{children:this.getExpandPanel()})})})}),n)]})})}getExpandPanelPlacementClassName(){return this.props.toolJson.panelPlacement?`expand-placement-${this.props.toolJson.panelPlacement.split("-")[0]}`:null}render(){return this._getContent()}}class se extends i.React.PureComponent{constructor(e){super(e),this.state={}}onRef(e){e&&(this.container=e,this.tryUpdateZoomElement())}componentDidUpdate(){this.tryUpdateZoomElement()}tryUpdateZoomElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.zoomElement&&(this.zoomElement.view===t&&this.zoomElement.parentNode===this.container||this.destroyZoomElement()),!this.zoomElement&&this.props.mapComponentsLoaded&&this.container&&t&&(this.zoomElement=document.createElement("arcgis-zoom"),this.zoomElement.view=t,this.container.appendChild(this.zoomElement),e.deleteJimuMapTool("Zoom"),e.addJimuMapTool({name:"Zoom",instance:this.zoomElement}))}destroyZoomElement(){if(this.zoomElement){this.zoomElement.destroy(),this.zoomElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("Zoom")}}componentWillUnmount(){this.destroyZoomElement()}getStyle(){return i.css`
      .esri-widget--button {
        appearance: none !important;
      }

      arcgis-zoom {
        box-shadow: none;

        div.arcgis-zoom {
          box-shadow: none;
        }

        calcite-button {
          border: none;
        }
      }
    `}render(){return(0,t.jsx)("div",{className:"zoom-map-tool",css:this.getStyle(),ref:e=>{this.onRef(e)}})}}var ae=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};class ne extends i.React.PureComponent{constructor(e){super(e),this.generateViewPointFromInitialMapState=e=>"2d"===e.viewType?new this.Viewpoint({targetGeometry:this.Extent.fromJSON(e.extent),rotation:e.rotation}):this.Viewpoint.fromJSON(e.viewPoint),this.homeBtnGoToOverride=(e,t)=>ae(this,void 0,void 0,function*(){const i="2d"===e.type;let o=!1;i&&e.constraints&&!e.constraints.snapToZoom&&(e.constraints.snapToZoom=!0,o=!0);try{yield e.goTo(t.target,t.options)}catch(e){console.error("home btn goto error",e)}i&&e.constraints&&o&&(e.constraints.snapToZoom=!1)}),this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/geometry/Extent","esri/Viewpoint"]).then(e=>{[this.Extent,this.Viewpoint]=e,this.setState({apiLoaded:!0})})}componentDidUpdate(e){var t;const i=this.props.mapComponentsLoaded&&this.state.apiLoaded;if(!i||!this.container)return;const o=(null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view)||null,s=((null==e?void 0:e.initialMapState)||null)!==(this.props.initialMapState||null);if(this.homeElement&&(this.homeElement.view!==o||this.homeElement.parentNode!==this.container||s)&&this.destroyHomeElement(),!this.homeElement&&this.props.mapComponentsLoaded&&i&&this.container&&o){let e=this.props.initialMapState?this.generateViewPointFromInitialMapState(this.props.initialMapState):this.props.jimuMapView.view.map.initialViewProperties.viewpoint;e&&(e=e.clone()),this.homeElement=document.createElement("arcgis-home"),this.homeElement.view=this.props.jimuMapView.view,this.homeElement.viewpoint=e,this.homeElement.goToOverride=this.homeBtnGoToOverride,this.container.appendChild(this.homeElement),this.props.jimuMapView.deleteJimuMapTool("Home"),this.props.jimuMapView.addJimuMapTool({name:"Home",instance:this.homeElement})}}destroyHomeElement(){if(this.homeElement){this.homeElement.destroy(),this.homeElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("Home")}}componentWillUnmount(){this.destroyHomeElement()}getStyle(){return i.css`
      .esri-widget--button {
        appearance: none !important;
      }
    `}render(){return(0,t.jsx)("div",{className:"home-map-tool",css:this.getStyle(),ref:e=>{this.container=e}})}}class le extends i.React.PureComponent{constructor(e){super(e),this.state={}}onRef(e){e&&(this.container=e,this.tryUpdateCompassElement())}componentDidUpdate(){this.tryUpdateCompassElement()}tryUpdateCompassElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.compassElement&&(this.compassElement.view===t&&this.compassElement.parentNode===this.container||this.destroyCompassElement()),!this.compassElement&&this.props.mapComponentsLoaded&&this.container&&t&&(this.compassElement=document.createElement("arcgis-compass"),this.compassElement.view=t,this.container.appendChild(this.compassElement),e.deleteJimuMapTool("Compass"),e.addJimuMapTool({name:"Compass",instance:this.compassElement}))}destroyCompassElement(){if(this.compassElement){const e=this.compassElement.view;e&&!e.destroyed?this.compassElement.destroy():this.compassElement.parentNode&&this.compassElement.parentNode.removeChild(this.compassElement),this.compassElement=null;const t=this.props.jimuMapView;t&&t.deleteJimuMapTool("Compass")}}componentWillUnmount(){this.destroyCompassElement()}render(){return(0,t.jsx)("div",{className:"compass-map-tool",ref:e=>{this.onRef(e)}})}}class re extends i.React.PureComponent{constructor(e){super(e),this.onLocateArcgisSuccess=e=>{var t,o;const s=null===(o=null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.position)||void 0===o?void 0:o.coords;if(s){const{longitude:e,latitude:t}=s,o={x:e,y:t,spatialReference:{wkid:4326}},a=new i.LocationChangeMessage(this.props.mapWidgetId,o);i.MessageManager.getInstance().publishMessage(a)}},this.state={}}onRef(e){e&&(this.container=e,this.tryUpdateLocateElement())}componentDidUpdate(){this.tryUpdateLocateElement()}tryUpdateLocateElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.locateElement&&(this.locateElement.view===t&&this.locateElement.parentNode===this.container||this.destroyLocateElement()),!this.locateElement&&this.props.mapComponentsLoaded&&this.container&&t&&(this.locateElement=document.createElement("arcgis-locate"),this.locateElement.view=t,this.locateElement.addEventListener("arcgisSuccess",this.onLocateArcgisSuccess),this.container.appendChild(this.locateElement),e.deleteJimuMapTool("Locate"),e.addJimuMapTool({name:"Locate",instance:this.locateElement}))}destroyLocateElement(){if(this.locateElement){this.locateElement.removeEventListener("arcgisSuccess",this.onLocateArcgisSuccess),this.locateElement.destroy(),this.locateElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("Locate")}}componentWillUnmount(){this.destroyLocateElement()}getStyle(){return i.css`
      .esri-widget--button {
        appearance: none !important;
      }
    `}render(){return(0,t.jsx)("div",{className:"locate-map-tool",css:this.getStyle(),ref:e=>{this.onRef(e)}})}}const pe="__exb_root_layer";class ce extends i.React.PureComponent{constructor(e){super(e),this.state={apiLoaded:!1}}onRef(e){e&&(this.container=e,this.tryUpdateNavigationToggleElement())}componentDidUpdate(){this.tryUpdateNavigationToggleElement()}tryUpdateNavigationToggleElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.navigationToggleElement&&(this.navigationToggleElement.view===t&&this.navigationToggleElement.parentNode===this.container||this.destroyNavigationToggleElement()),!this.navigationToggleElement&&this.props.mapComponentsLoaded&&this.container&&t&&"3d"===t.type&&(this.navigationToggleElement=document.createElement("arcgis-navigation-toggle"),this.navigationToggleElement.view=t,this.container.appendChild(this.navigationToggleElement),e.deleteJimuMapTool("Navigation"),e.addJimuMapTool({name:"Navigation",instance:this.navigationToggleElement}))}destroyNavigationToggleElement(){var e,t;if(this.navigationToggleElement){if("function"==typeof this.navigationToggleElement.destroy)null===(t=(e=this.navigationToggleElement).destroy)||void 0===t||t.call(e);else{const e=this.navigationToggleElement.parentNode;e&&e.removeChild(this.navigationToggleElement)}this.navigationToggleElement=null;const i=this.props.jimuMapView;i&&i.deleteJimuMapTool("Navigation")}}componentWillUnmount(){this.destroyNavigationToggleElement()}render(){return(0,t.jsx)("div",{className:"navigation-map-tool",ref:e=>{this.onRef(e)}})}}class de extends i.React.PureComponent{constructor(e){super(e),this.state={apiLoaded:!1}}getStyle(){const e=this.props.isMobile?"height: 32px;":"height: 48px; padding: 0px 16px 16px 16px;";return i.css`
      arcgis-search {
        /* Use height and overflow to avoid arcgis-search flickering during initialization */
        ${e}
        width: 100%;
      }
    `}componentDidMount(){this.state.apiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/portal/Portal","esri/core/reactiveUtils"]).then(e=>{[this.Portal,this.reactiveUtils]=e,this.setState({apiLoaded:!0})})}onRef(e){e&&(this.container=e,this.tryUpdateSearchElement())}componentDidUpdate(){this.tryUpdateSearchElement()}tryUpdateSearchElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.searchElement&&(this.searchElement.view===t&&this.searchElement.parentNode===this.container||this.destroySearchElement()),!this.searchElement&&this.props.mapComponentsLoaded&&this.state.apiLoaded&&this.container&&t&&(this.searchElement=document.createElement("arcgis-search"),this.searchElement.view=t,this.searchElement.portal=new this.Portal({url:(0,i.getAppStore)().getState().portalUrl}),this.searchElement.position="manual",this.container.appendChild(this.searchElement),this.updateSearchPopupEnabled(),t&&(this.popupEnabledWatchHandle=this.reactiveUtils.watch(()=>null==t?void 0:t.popupEnabled,()=>{this.updateSearchPopupEnabled()})),e.deleteJimuMapTool("Search"),e.addJimuMapTool({name:"Search",instance:this.searchElement}))}updateSearchPopupEnabled(){if(this.searchElement){const e=this.searchElement.view;e&&(this.searchElement.popupDisabled=!e.popupEnabled)}}destroySearchElement(){if(this.searchElement){this.searchElement.destroy(),this.searchElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("Search")}this.releasePopupEnabledWatchHandle()}releasePopupEnabledWatchHandle(){this.popupEnabledWatchHandle&&(this.popupEnabledWatchHandle.remove(),this.popupEnabledWatchHandle=null)}componentWillUnmount(){this.destroySearchElement()}render(){const e=this.props.mapComponentsLoaded&&this.state.apiLoaded;return(0,t.jsx)("div",{css:this.getStyle(),className:"w-100 search-map-tool",ref:e=>{this.onRef(e)},children:!e&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"})})}}class he extends i.React.PureComponent{constructor(e){super(e),this.state={}}onRef(e){e&&(this.container=e,this.tryUpdateLayerListElement())}componentDidUpdate(){this.tryUpdateLayerListElement()}tryUpdateLayerListElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.props.mapComponentsLoaded&&this.container&&t?(this.layerListElement&&this.layerListElement.parentNode!==this.container&&this.destroyLayerListElement(),this.layerListElement?this.layerListElement.view!==t&&(this.layerListElement.view=t):(this.layerListElement=document.createElement("arcgis-layer-list"),this.layerListElement.view=t,this.container.appendChild(this.layerListElement),e.deleteJimuMapTool("LayerList"),e.addJimuMapTool({name:"LayerList",instance:this.layerListElement}))):this.destroyLayerListElement()}destroyLayerListElement(){if(this.layerListElement){this.layerListElement.destroy(),this.layerListElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("LayerList")}}componentWillUnmount(){this.destroyLayerListElement()}getStyle(){return i.css`
      width: 100%;
      min-height: 32px;
      position: relative;

      arcgis-layer-list {
        width: 100%;
      }
    `}render(){return(0,t.jsx)("div",{className:"layers-map-tool",ref:e=>{this.onRef(e)},css:this.getStyle()})}}class ue extends i.React.PureComponent{constructor(e){super(e),this.state={}}onRef(e){e&&(this.container=e,this.tryUpdateLegendElement())}componentDidUpdate(){this.tryUpdateLegendElement()}tryUpdateLegendElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.props.mapComponentsLoaded&&this.container&&t?(this.legendElement&&this.legendElement.parentNode!==this.container&&this.destroyLegendElement(),this.legendElement?this.legendElement.view!==t&&(this.legendElement.view=t):(this.legendElement=document.createElement("arcgis-legend"),this.legendElement.view=t,this.container.appendChild(this.legendElement),e.deleteJimuMapTool("Legend"),e.addJimuMapTool({name:"Legend",instance:this.legendElement}))):this.destroyLegendElement()}destroyLegendElement(){if(this.legendElement){this.legendElement.destroy(),this.legendElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("Legend")}}componentWillUnmount(){this.destroyLegendElement()}getStyle(){return i.css`
      width: 100%;
      min-height: 32px;
      position: relative;

      arcgis-legend {
        width: 100%;
      }
    `}render(){return(0,t.jsx)("div",{className:"legend-map-tool",ref:e=>{this.onRef(e)},css:this.getStyle()})}}class me extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.state={apiLoaded:!1,sourceLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/widgets/BasemapGallery/support/LocalBasemapsSource","esri/widgets/BasemapGallery/BasemapGalleryViewModel"]).then(e=>{this.__unmount||([this.LocalBasemapsSource,this.BasemapGalleryViewModel]=e,this.setState({apiLoaded:!0}))}),this.state.sourceLoaded||o.basemapUtils.getOrgBasemaps().then(e=>{this.__unmount||(this.orgBasemaps=e,this.setState({sourceLoaded:!0}))}).catch(e=>{console.error(`load basemap gallery source error: ${e}`)})}onRef(e){e&&(this.container=e,this.tryUpdateBasemapGalleryElement())}componentDidUpdate(){this.tryUpdateBasemapGalleryElement()}tryUpdateBasemapGalleryElement(){if(!this.container)return;const e=this.props.jimuMapView,t=(null==e?void 0:e.view)||null;this.props.mapComponentsLoaded&&this.state.apiLoaded&&this.state.sourceLoaded&&this.container&&t?(this.basemapGalleryElement&&this.basemapGalleryElement.parentNode!==this.container&&this.destroyBasemapGalleryElement(),this.basemapGalleryElement?this.basemapGalleryElement.view!==t&&(this.basemapGalleryElement.view=t,this.basemapGalleryElement.source=this.getFinalBasemapGallerySource(this.orgBasemaps,t)):(this.basemapGalleryElement=document.createElement("arcgis-basemap-gallery"),this.basemapGalleryElement.view=t,this.container.appendChild(this.basemapGalleryElement),this.basemapGalleryElement.source=this.getFinalBasemapGallerySource(this.orgBasemaps,t),e.deleteJimuMapTool("BaseMap"),e.addJimuMapTool({name:"BaseMap",instance:this.basemapGalleryElement}))):this.destroyBasemapGalleryElement()}getFinalBasemapGallerySource(e,t){var i;let s=[];if(t){s="2d"===t.type?e.filter(e=>!o.basemapUtils.isBasemap3D(e)):e.slice();const a=t.map.originalBasemap||t.map.basemap,n=new this.BasemapGalleryViewModel({view:t});if(a&&n){if(!s.some(e=>n.basemapEquals(a,e))){if(!a.thumbnailUrl){const e=null===(i=t.map)||void 0===i?void 0:i.thumbnailUrl;e&&(a.thumbnailUrl=e)}s.unshift(a)}}}return new this.LocalBasemapsSource({basemaps:s})}destroyBasemapGalleryElement(){if(this.basemapGalleryElement){this.basemapGalleryElement.destroy(),this.basemapGalleryElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("BaseMap")}}componentWillUnmount(){this.__unmount=!0,this.destroyBasemapGalleryElement()}getStyle(){const e=this.props.isMobile?"width: 100%; max-width: none; max-height: none; overflow-y: auto;":"width: 250px;";return i.css`
      min-height: 32px;
      position: relative;
      ${e}

      arcgis-basemap-gallery {
        width: 100%;
      }
    `}render(){const e=this.props.mapComponentsLoaded&&this.state.apiLoaded,o=this.getStyle();return(0,t.jsx)("div",{ref:e=>{this.onRef(e)},className:(0,i.classNames)("basemap-map-tool",{"exbmap-ui-pc-expand-maxheight":!this.props.isMobile}),css:o,children:!e&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"})})}}var ge=r(53089),ve=r.n(ge),we=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const fe=e=>{const o=window.SVG,{className:s}=e,a=we(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",s);return o?(0,t.jsx)(o,Object.assign({className:n,src:ve()},a)):(0,t.jsx)("svg",Object.assign({className:n},a))};class ye extends i.React.PureComponent{constructor(e){super(e),this.unmount=!1,this.setMapThumbUrl=e=>{var t;e||this.setState({mapThumbUrl:null});const o=(null===(t=this.props)||void 0===t?void 0:t.portUrl)||(0,i.getAppStore)().getState().portalUrl,s=i.SessionManager.getInstance().getSessionByUrl(o)||null;i.esri.restPortal.searchItems({q:`id:${e}`,authentication:s,portal:o+"/sharing/rest"}).then(e=>{var t;if(!this.unmount)if(null===(t=e.results[0])||void 0===t?void 0:t.thumbnail){const t=i.SessionManager.getInstance().getSessionByUrl(o);let s=null;s=t&&t.token?`${o}/sharing/rest/content/items/${e.results[0].id}/info/${e.results[0].thumbnail}?token=${t.token}`:`${o}/sharing/rest/content/items/${e.results[0].id}/info/${e.results[0].thumbnail}`;const a=document.createElement("img");a.onerror=()=>{this.setState({mapThumbUrl:null})},a.src=s,this.setState({mapThumbUrl:s})}else this.setState({mapThumbUrl:null})})},this.state={mapThumbUrl:null}}componentDidMount(){this.unmount=!1,this.setMapThumbUrl(this.props.mapItemId)}componentDidUpdate(e,t){e.mapItemId!==this.props.mapItemId&&this.setMapThumbUrl(this.props.mapItemId)}componentWillUnmount(){this.unmount=!0}render(){var e,i,o;const a=(null===(e=this.props)||void 0===e?void 0:e.label)||"",n=this.state.mapThumbUrl;if(n)return(0,t.jsx)(s.Image,{src:n,alt:a});{const e=null===(i=this.props)||void 0===i?void 0:i.theme;let s=null==e?void 0:e.sys.color.surface.overlay,a=null==e?void 0:e.sys.color.surface.overlayHint;return(null===(o=this.props)||void 0===o?void 0:o.usedInSetting)&&(s=null==e?void 0:e.ref.palette.neutral[300],a=null==e?void 0:e.ref.palette.neutral[600]),(0,t.jsx)("div",{style:{backgroundColor:s,height:"100%"},children:(0,t.jsx)(fe,{color:a,size:"100%"})})}}}var Me=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const Se=i.css`
/* scalebar should use static colors */
--calcite-color-foreground-1: white; /* used as --color-ruler-foreground */
--calcite-color-inverse: #363636; /* used as --color-ruler-background */
--calcite-color-text-1: black;
--calcite-font-size-sm: 12px;
--calcite-spacing-xs: 6px;
font-size: 12px;

.number-label {
  background-color: color-mix(in srgb,var(--calcite-color-foreground-1) 50%, transparent);
  color: var(--calcite-color-text-1);
  padding: 0 7px;
  font-weight: 600;
}
`;class be extends i.React.PureComponent{constructor(e){super(e),this.debounceUpdateScale=e=>null,this.state={reactiveUtilsLoaded:!1,displayScale:""},this.intl=i.i18n.getIntl(),this.debounceUpdateScale=i.lodash.debounce(e=>{let t="";const i=null==e?void 0:e.scale;if("number"==typeof i&&i>0&&this.intl){const[e,o]=this.getThousandSeparatorAndDecimalPlace(this.props),s=this.intl.formatNumber(i,{useGrouping:e,minimumFractionDigits:o,maximumFractionDigits:o});s&&(t=`1: ${s}`)}this.setState(()=>({displayScale:t}))},500)}onRef(e){e&&e!==this.container&&(this.container=e,this.tryUpdateScaleBarElement())}componentDidMount(){this.loadReactiveUtils()}loadReactiveUtils(){return Me(this,void 0,void 0,function*(){this.reactiveUtils=yield(0,i.loadArcGISJSAPIModule)("esri/core/reactiveUtils"),this.reactiveUtils&&this.setState({reactiveUtilsLoaded:!0})})}componentDidUpdate(e){this.prevProps=e,this.tryUpdateScaleBarElement()}tryUpdateScaleBarElement(){var e,t,i,o;if(!this.container)return;const s=(null===(t=null===(e=this.prevProps)||void 0===e?void 0:e.jimuMapView)||void 0===t?void 0:t.view)||null,a=this.props.jimuMapView,n=(null==a?void 0:a.view)||null,l=this.getScalebarStyle()||"line";if(n!==s&&this.releaseScaleHandle(),"number"===l){this.scaleBarElement&&this.destroyScaleBarElement(),!this.scaleHandle&&n&&this.state.reactiveUtilsLoaded&&this.reactiveUtils&&(this.releaseScaleHandle(),this.scaleHandle=this.reactiveUtils.watch(()=>null==n?void 0:n.scale,()=>{this.debounceUpdateScale(n)}),this.debounceUpdateScale(n));const e=null===(o=null===(i=this.prevProps)||void 0===i?void 0:i.scalebarOptions)||void 0===o?void 0:o.style,[t,a]=this.getThousandSeparatorAndDecimalPlace(this.props),[r,p]=this.getThousandSeparatorAndDecimalPlace(this.prevProps);l===e&&n===s&&t===r&&a===p||this.debounceUpdateScale(n)}else{this.releaseScaleHandle();const e=this.getScalebarUnit()||"metric";this.scaleBarElement&&(this.scaleBarElement.view===n&&this.scaleBarElement.parentNode===this.container&&this.scaleBarElement.barStyle===l&&this.scaleBarElement.unit===e||this.destroyScaleBarElement()),!this.scaleBarElement&&this.props.mapComponentsLoaded&&this.container&&n&&"2d"===n.type&&(this.scaleBarElement=document.createElement("arcgis-scale-bar"),this.scaleBarElement.view=n,this.scaleBarElement.barStyle=l,this.scaleBarElement.unit=e,this.container.appendChild(this.scaleBarElement),a.deleteJimuMapTool("ScaleBar"),a.addJimuMapTool({name:"ScaleBar",instance:this.scaleBarElement}))}}getScalebarStyle(){let e=null;const t=this.props.scalebarOptions;return e=t?t.style:"line","line"!==e&&"ruler"!==e&&"number"!==e&&(e="line"),e}getScalebarUnit(){let e=null;const t=this.props.scalebarOptions;return e=t?t.unit:this.getScalebarUnitByPortal(),"metric"!==e&&"imperial"!==e&&"dual"!==e&&(e="metric"),e}getScalebarUnitByPortal(){let e="";const t=(0,i.getAppStore)().getState();t&&(t.user&&t.user.units?e=t.user.units:t.portalSelf&&t.portalSelf.units&&(e=t.portalSelf.units));let o=null;return o="metric"===e?"metric":"english"===e?"imperial":"dual",o}getThousandSeparatorAndDecimalPlace(e){const t=null==e?void 0:e.scalebarOptions,i=(null==t?void 0:t.thousandSeparator)||!1;let o=(null==t?void 0:t.decimalPlace)||0;return o>=0||(o=0),[i,o]}destroyScaleBarElement(){if(this.scaleBarElement){this.scaleBarElement.destroy(),this.scaleBarElement=null;const e=this.props.jimuMapView;e&&e.deleteJimuMapTool("ScaleBar")}}releaseScaleHandle(){this.scaleHandle&&(this.scaleHandle.remove(),this.scaleHandle=null)}componentWillUnmount(){this.destroyScaleBarElement(),this.releaseScaleHandle()}render(){var e;const i="number"===(null===(e=this.props.scalebarOptions)||void 0===e?void 0:e.style)&&this.state.displayScale;return(0,t.jsx)("div",{className:"scalebar-map-tool",ref:e=>{this.onRef(e)},css:Se,children:i&&(0,t.jsx)("span",{className:"number-label",children:this.state.displayScale})})}}class xe extends i.React.PureComponent{constructor(e){super(e),this.Attribution=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/widgets/Attribution"]).then(e=>{[this.Attribution]=e,this.setState({apiLoaded:!0})})}componentDidUpdate(e){this.state.apiLoaded&&this.container&&(e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id?this.AttributionBtn&&!this.AttributionBtn.destroy&&(this.AttributionBtn.view=this.props.jimuMapView.view,this.AttributionBtn.renderNow(),this.props.jimuMapView.addJimuMapTool({name:"Attribution",instance:this.AttributionBtn})):(this.AttributionBtn=new this.Attribution({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Attribution"),this.props.jimuMapView.addJimuMapTool({name:"Attribution",instance:this.AttributionBtn})))}componentWillUnmount(){this.AttributionBtn&&(this.AttributionBtn.destroy(),this.AttributionBtn=null,this.props.jimuMapView.deleteJimuMapTool("Attribution"))}render(){return(0,t.jsx)("div",{className:"attribution-map-tool",style:{position:"relative"},ref:e=>{this.container=e}})}}class Ie extends i.React.PureComponent{constructor(e){super(e),this.toolName="measurement",this.checkContainer=()=>{"0"!==this.container.style.opacity&&0!==this.container.style.opacity||(this.container.style.opacity=1,this.container.style.height="")},this.id=`${this.props.mapWidgetId}-measure-tool`,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/widgets/Measurement","esri/core/reactiveUtils"]).then(e=>{[this.MeasureClass,this.reactiveUtils]=e,this.setState({apiLoaded:!0})})}componentDidUpdate(e){if(this.state.apiLoaded&&this.parentContainer&&this.container){if(this.props.measureInstance){const e=this.props.jimuMapView;this.props.measureInstance.view!==e.view&&(this.restoreClickHighlightEnabledForCurrentJimuMapView(),this.setCurrentJimuMapView(e),this.props.measureInstance.clear(),this.props.measureInstance.view=e.view,this.props.measureInstance.activeTool=this.props.measureModule.activeTool,Ce(e,this.props.measureInstance,this.reactiveUtils))}else{const e=this.props.jimuMapView,t=new this.MeasureClass({container:this.container,view:e.view});t.activeTool=this.props.measureModule.activeTool,this.setCurrentJimuMapView(e),this.currentJimuMapView.deleteJimuMapTool(this.toolName),this.currentJimuMapView.addJimuMapTool({name:this.toolName,instance:t}),this.props.onMeasurceInstanceCreated(t),Ce(e,t,this.reactiveUtils);const o=i.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,i.getAppStore)().dispatch(o)}this.checkContainer()}((null==e?void 0:e.autoControlWidgetId)||"")===this.id&&this.props.autoControlWidgetId!==this.id&&this.props.onRequestClosePanel()}componentWillUnmount(){if(this.restoreClickHighlightEnabledForCurrentJimuMapView(),this.props.autoControlWidgetId===this.id){const e=i.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,i.getAppStore)().dispatch(e)}}setCurrentJimuMapView(e){this.currentJimuMapView=e,this.originalClickHighlightEnabled=e.isClickHighlightEnabled(),this.currentJimuMapView.disableClickHighlight()}restoreClickHighlightEnabledForCurrentJimuMapView(){this.currentJimuMapView&&(this.originalClickHighlightEnabled?this.currentJimuMapView.enableClickHighlight():this.currentJimuMapView.disableClickHighlight())}render(){return(0,t.jsxs)("div",{className:"w-100",style:{width:"250px",position:"relative",minHeight:"32px"},ref:e=>{this.parentContainer=e},children:[(0,t.jsx)("div",{className:"measure-container measure-map-tool",ref:e=>{this.container=e}}),!this.state.apiLoaded&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"})]})}}function Ce(e,t,i){t&&(Ve(t),t.activeWidget&&Te(e,t),t._exbWatchActiveWidgetHandle=i.watch(()=>null==t?void 0:t.activeWidget,()=>{(null==t?void 0:t.activeWidget)&&Te(e,t)}))}function Te(e,t){if(!e||!t)return;const i=t.activeWidget;if(!i)return;if(!["esri.widgets.AreaMeasurement2D","esri.widgets.DistanceMeasurement2D"].includes(i.declaredClass))return;let o=e.view===t.view?e.getSnappingLayers():[];o||(o=[]);const s=o.map(e=>({layer:e,enabled:!0}));i.snappingOptions={enabled:!0,distance:10,featureEnabled:!0,featureSources:s,gridEnabled:!1,selfEnabled:!1}}function Ve(e){const t=e,i=t._exbWatchActiveWidgetHandle;i&&(i.remove(),t._exbWatchActiveWidgetHandle=null)}class Pe extends i.React.PureComponent{constructor(e){super(e),this.state={}}getStyle(){const e=this.props.theme.sys.color.action.selected.text;return i.css`
      position: relative;

      .select-circle-progress {
        position: absolute;
        left: 6px;
        top: 6px;

        .jimu-circular-progress-track {
          stroke: ${e};
          opacity: 0.3;
        }

        .jimu-circular-progress-runner {
          stroke: ${e};
          transition: none !important;
        }
      }

      .progress-stop {
        width: 6px;
        height: 6px;
        background: ${e};
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `}render(){var e;const i=100*this.props.progress,o=parseFloat(i.toFixed(2)),a=s.defaultMessages.selectingFeaturesTip,n=(null===(e=this.props.intl)||void 0===e?void 0:e.formatMessage({id:"selectingFeaturesTip",defaultMessage:a}))||a;return(0,t.jsxs)("button",{css:this.getStyle(),onClick:this.props.onClick,className:"esri-widget--button-like selected border-0 select-tool-btn d-flex align-items-center justify-content-center select-progress",children:[(0,t.jsx)(s.Progress,{className:"select-circle-progress",type:"circular",value:o,circleSize:20}),(0,t.jsx)("div",{className:"progress-stop"}),(0,t.jsx)("div",{className:"progress-mask",title:n})]})}}var Le=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const Ee={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},Ae={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},De={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}},Ne=r(99973),je=r(10272),ke=r(50045),Oe=r(88721),Re=r(22459),We=r(20561),Ue=r(4583);class Fe extends i.React.PureComponent{constructor(e){var t,o;super(e),this.currentActiveTool="rectangle",this.jsonUtils=null,this.resultGraphics=[],this.toggleIsSelectActive=()=>{this.setState({isActive:!this.state.isActive})},this.toggleSelectTypePopup=()=>{this.setState({isShowSelectTypePopup:!this.state.isShowSelectTypePopup})},this.onClickLoadingProgress=()=>{const e=this.activeJimuMapView;if(e){const t=!0;e.cancelSelectByQuery(t)}},this.clearSelect=()=>Le(this,void 0,void 0,function*(){const e=this.props.jimuMapView;if(e){try{const t=!1;yield e.cancelSelectByQuery(t)}catch(t){console.error(`jimuMapView.cancelSelectByQuery() error, jimuMapViewId: ${e.id}`,t)}setTimeout(()=>{e.clearSelectedFeatures()},200)}}),this.getSelectToolIcon=()=>"Point"===this.state.currentSelectType?We:"Rectangle"===this.state.currentSelectType?je:"Lasso"===this.state.currentSelectType?ke:"Circle"===this.state.currentSelectType?Oe:"Line"===this.state.currentSelectType?Re:je,this.setCurrentSelectType=e=>{this.initialSketchTool(),"Point"===e&&(this.setActiveToolForSketchViewModel("point"),this.currentActiveTool="point"),"Rectangle"===e&&(this.setActiveToolForSketchViewModel("rectangle"),this.currentActiveTool="rectangle"),"Lasso"===e&&(this.setActiveToolForSketchViewModel("polygon"),this.currentActiveTool="polygon"),"Circle"===e&&(this.setActiveToolForSketchViewModel("circle"),this.currentActiveTool="circle"),"Line"===e&&(this.setActiveToolForSketchViewModel("polyline"),this.currentActiveTool="polyline"),this.setState({currentSelectType:e,isShowSelectTypePopup:!1,isActive:!0})},this.onJimuMapViewSelectProgressChange=e=>{this.setState({selectProgress:e})},this.onKeyDown=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!0}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!0})},this.onKeyUp=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!1}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!1})},this.onPopperToggle=e=>{this.toggleSelectTypePopup(),e&&"keydown"===e.type&&"Escape"===e.key&&(0,i.focusElementInKeyboardMode)(this.btnSelectTypeContainer)},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.setCurrentSelectType(t)},this.isMac="macOS"===(null===(o=null===(t=window.jimuUA)||void 0===t?void 0:t.os)||void 0===o?void 0:o.name),this.id=`${this.props.mapWidgetId}-select-tool`,this.sketChCreateOptions={polygon:{mode:"hybrid"}},this.state={sketchInitialed:!1,isActive:!1,isShowSelectTypePopup:!1,currentSelectType:"Rectangle",spatialRelationship:"intersects",selectProgress:0},this.bindShiftCtrlKeysEventListeners()}getCSSStyle(){const e=this.props.theme;return i.css`
      .select-tool-btn {
        width: 32px;
        height: 32px;
      }

      .content-title {
        font-size: ${i.polished.rem(13)};
        font-weight: bold;
      }

      .select-tool-type-mobile-container-shell {
        overflow-x: auto;
      }

      .select-tool-type-mobile-container-shell::-webkit-scrollbar {
        height: 0 !important;
        display: none;
      }

      .select-tool-type-mobile-container {
        width: 400px;
      }

      .select-tool-type {
        width: 64px;
        height: 64px;
        border: 1px solid ${e.sys.color.divider.secondary};
        cursor: pointer;
      }

      .select-tool-type-choosed {
        border: 1px solid ${e.sys.color.primary.main};
        position: relative;
      }

      .select-tool-type-choosed:after {
        width: 0;
        height: 0;
        border-top: 8px solid ${e.sys.color.primary.main};
        border-left: 8px solid transparent;
        position: absolute;
        top: 0;
        right: 0;
        content: "";
      }

      .select-tool-type-text {
        font-size: ${i.polished.rem(12)};
      }

      .select-tool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .select-tool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .select-tool-loader:after {
        background-color: ${e.sys.color.primary.main};
        width: 20%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }
    `}componentDidMount(){this.state.sketchInitialed||(0,o.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/rest/support/Query","esri/symbols/support/jsonUtils","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then(e=>{[this.SketchViewModel,this.GraphicsLayer,this.Query,this.jsonUtils]=e,this.props.jimuMapView.view.when(()=>{this.initialSketchTool(),this.setState({sketchInitialed:!0})})})}componentDidUpdate(e,t){return t.sketchInitialed!==this.state.sketchInitialed&&this.state.sketchInitialed?(this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.sketchInitialed?(this.destroySketchViewModelAndReleaseHandles(),this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):(t.isActive!==this.state.isActive&&(this.initialSketchTool(),this.state.isActive?this.setActiveToolForSketchViewModel(this.currentActiveTool):this.destroySketchViewModelAndReleaseHandles()),this.tryUpdateActiveToolInfoWhenStateChange(t),void this.tryUpdateActiveToolInfoWhenPropsChange(e))}tryUpdateActiveToolInfoWhenStateChange(e){if(!e)return;const t=!(!e.isActive&&!e.isShowSelectTypePopup),i=!(!this.state.isActive&&!this.state.isShowSelectTypePopup);!t&&i?this.setCurrentToolAsActiveTool():t&&!i&&(this.setState({isActive:!1,isShowSelectTypePopup:!1}),this.setActiveToolToNull())}tryUpdateActiveToolInfoWhenPropsChange(e){var t,i;let o=!1;const s=(null===(t=null==e?void 0:e.activeToolInfo)||void 0===t?void 0:t.activeToolName)||"",a=(null===(i=this.props.activeToolInfo)||void 0===i?void 0:i.activeToolName)||"";if(s!==a){const e=this.props.toolName;s===e&&!(a===e)&&(o=!0)}e.autoControlWidgetId===this.id&&this.props.autoControlWidgetId&&this.props.autoControlWidgetId!==this.id&&(o=!0),o&&(this.state.isActive||this.state.isShowSelectTypePopup)&&this.setState({isActive:!1,isShowSelectTypePopup:!1})}componentWillUnmount(){this.destroySketchViewModelAndReleaseHandles(),this.releaseShiftCtrlKeysEventListeners()}destroySketchViewModelAndReleaseHandles(){if(this.releaseViewHandles(),this.sketchViewModel&&(this.sketchViewModel.destroy(),this.sketchViewModel=null),this.activeJimuMapView=null,this.props.autoControlWidgetId===this.id){const e=i.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,i.getAppStore)().dispatch(e)}}releaseViewHandles(){this.activeJimuMapView&&this.activeJimuMapView.removeSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange),this.viewKeyDownHandle&&(this.viewKeyDownHandle.remove(),this.viewKeyDownHandle=null),this.viewKeyUpHandle&&(this.viewKeyUpHandle.remove(),this.viewKeyUpHandle=null)}setCurrentToolAsActiveTool(){this.isSelectIsActiveTool()||this.props._onIconClick()}setActiveToolToNull(){this.isSelectIsActiveTool()&&this.props._onIconClick()}isSelectIsActiveTool(){var e;return this.props.toolName&&this.props.toolName===(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)}getSelectIconTitle(){let e="";e="Point"===this.state.currentSelectType?this.formatMessage("SelectionByPoint"):"Rectangle"===this.state.currentSelectType?this.formatMessage("SelectionByRectangle"):"Lasso"===this.state.currentSelectType?this.formatMessage("SelectionByLasso"):"Circle"===this.state.currentSelectType?this.formatMessage("SelectionByCircle"):"Line"===this.state.currentSelectType?this.formatMessage("SelectionByLine"):this.formatMessage("SelectLabel");const t=this.formatMessage("newSelection"),i=this.formatMessage("addToCurrentSelection"),o=this.formatMessage("removeFromCurrentSelection"),s=this.formatMessage("selectFromCurrentSelection"),a=this.formatMessage("drawShape"),n=this.formatMessage("draw"),l=this.isMac?"Cmd":"Ctrl";return`${e}\n${`\u2219 ${t} (${a})`}\n${`\u2219 ${i} (Shift + ${n})`}\n${`\u2219 ${o} (${l} + ${n})`}\n${`\u2219 ${s} (Shift + ${l} + ${n})`}\n    `}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}useShiftKey(e){return this.useKey(this.lastShiftKeyEventInfo,e)}useCtrlKey(e){return this.useKey(this.lastCtrlKeyEventInfo,e)}useKey(e,t){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=t}return!1}bindShiftCtrlKeysEventListeners(){document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp,!0)}releaseShiftCtrlKeysEventListeners(){document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp,!0)}initialSketchTool(){if(this.SketchViewModel&&!this.sketchViewModel){this.releaseViewHandles();const e=this.props.jimuMapView;this.activeJimuMapView=e,this.activeJimuMapView.addSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange);const t=e.view;this.viewKeyDownHandle=t.on("key-down",e=>{"Shift"===e.key&&e.stopPropagation()}),this.viewKeyDownHandle=t.on("key-up",e=>{"Shift"===e.key&&e.stopPropagation()}),this.sketchViewModel=new this.SketchViewModel({view:t,layer:new this.GraphicsLayer,pointSymbol:this.jsonUtils.fromJSON(Ee),polylineSymbol:this.jsonUtils.fromJSON(Ae),polygonSymbol:this.jsonUtils.fromJSON(De)}),this.sketchViewModel.on("create",e=>{if("complete"===e.state){this.setActiveToolForSketchViewModel(this.currentActiveTool);const t=this.props.jimuMapView;t.view.closePopup();const o=e.graphic;if(!o)return void console.log("sketch graphic is null");if(!o.geometry)return void console.log("sketch graphic.geometry is null");const s=500,a=this.useShiftKey(s),n=this.useCtrlKey(s);let l=i.DataSourceSelectionMode.New;l=a?n?i.DataSourceSelectionMode.SelectFromCurrent:i.DataSourceSelectionMode.AddToCurrent:n?i.DataSourceSelectionMode.RemoveFromCurrent:i.DataSourceSelectionMode.New,t.selectFeaturesByGraphic(o,this.state.spatialRelationship,l)}})}}setActiveToolForSketchViewModel(e){if(this.sketchViewModel){const t=this.sketChCreateOptions[e];if(t?this.sketchViewModel.create(e,t):this.sketchViewModel.create(e),this.props.autoControlWidgetId!==this.id){const e=i.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,i.getAppStore)().dispatch(e)}}}render(){const e=this.getSelectIconTitle(),o=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:s.defaultMessages.clearSelection}),a=this.state.selectProgress>0&&this.state.selectProgress<1;return(0,t.jsxs)("div",{css:this.getCSSStyle(),children:[(0,t.jsx)("div",{className:"d-flex align-items-center justify-content-center select-tool-container",ref:e=>{this.btnContainer=e},children:(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsxs)("div",{className:"d-flex",children:[!a&&(0,t.jsx)("button",{title:e,"aria-label":e,onClick:this.toggleIsSelectActive,className:(0,i.classNames)("esri-widget--button-like  border-0 select-tool-btn d-flex align-items-center justify-content-center",{selected:this.state.isActive}),disabled:!this.state.sketchInitialed,children:(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:16,height:16,icon:this.getSelectToolIcon()})}),a&&(0,t.jsx)(Pe,{progress:this.state.selectProgress,intl:this.props.intl,theme:this.props.theme,onClick:this.onClickLoadingProgress}),(0,t.jsx)("button",{"aria-label":this.formatMessage("moreSelectionTools"),onClick:this.toggleSelectTypePopup,style:{width:18},className:(0,i.classNames)("esri-widget--button-like border-0 pl-1 pr-1 select-tool-btn d-flex align-items-center justify-content-center",{selected:this.state.isShowSelectTypePopup}),disabled:!this.state.sketchInitialed,ref:e=>{this.btnSelectTypeContainer=e},children:(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:8,height:8,icon:Ne})})]}),(0,t.jsx)("button",{"aria-label":o,title:o,className:"select-tool-btn d-flex align-items-center justify-content-center select-tool-btn-hover esri-widget--button-like border-0",ref:e=>{this.selectResultContainer=e},onClick:this.clearSelect,disabled:!this.state.sketchInitialed,children:(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ue})}),(0,t.jsx)(s.Popper,{className:"map-tool-popper",css:this.getCSSStyle(),reference:this.btnContainer,open:this.state.isShowSelectTypePopup,placement:"bottom-start",toggle:this.onPopperToggle,children:(0,t.jsxs)("div",{className:"p-4",style:{display:"flex",flexDirection:"column"},children:[(0,t.jsx)("div",{className:"content-title",children:this.props.intl.formatMessage({id:"SelectionTool",defaultMessage:s.defaultMessages.SelectionTool})}),(0,t.jsxs)("div",{className:"mt-2 mb-2",children:[(0,t.jsxs)("div",{className:"d-flex mb-2",children:[(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Rectangle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Rectangle")},onKeyDown:e=>{this.handleKeyDown(e,"Rectangle")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:je}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle}),children:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Lasso"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Lasso")},onKeyDown:e=>{this.handleKeyDown(e,"Lasso")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:ke}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso}),children:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Circle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Circle")},onKeyDown:e=>{this.handleKeyDown(e,"Circle")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:Oe}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle}),children:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle})})]})]}),(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Line"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Line")},onKeyDown:e=>{this.handleKeyDown(e,"Line")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:Re}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine}),children:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Point"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Point")},onKeyDown:e=>{this.handleKeyDown(e,"Point")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:We}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint}),children:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint})})]})]})]}),(0,t.jsx)("div",{className:"content-title",children:this.props.intl.formatMessage({id:"SelectionMode",defaultMessage:s.defaultMessages.SelectionMode})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"d-flex align-items-center mt-2",children:[(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"intersects"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"intersects"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"intersects"})},children:this.props.intl.formatMessage({id:"SelectionWithin",defaultMessage:s.defaultMessages.SelectionWithin})})]}),(0,t.jsxs)("div",{className:"d-flex align-items-center mt-2",children:[(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"contains"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"contains"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"contains"})},children:this.props.intl.formatMessage({id:"SelectionContain",defaultMessage:s.defaultMessages.SelectionContain})})]})]})]})})]})}),!this.state.sketchInitialed&&(0,t.jsx)("div",{className:"select-tool-loader"})]})}}const Be={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},He={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},ze={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}},Je=r(10272),Ge=r(50045),_e=r(88721),$e=r(22459),Ke=r(20561),qe=r(81146);class Ze extends i.React.PureComponent{constructor(e){var o,a;super(e),this.jsonUtils=null,this.currentActiveTool="rectangle",this.toggleIsSelectActive=()=>{this.setState({isActive:!this.state.isActive})},this.toggleSelectTypePopup=()=>{this.setState({isShowSelectTypePopup:!this.state.isShowSelectTypePopup})},this.onJimuMapViewSelectProgressChange=e=>{this.setState({selectProgress:e})},this.onKeyDown=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!0}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!0})},this.onKeyUp=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!1}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!1})},this.setCurrentSelectType=e=>{this.initialSketchTool(),e!==this.state.currentSelectType&&("Point"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("point"),this.currentActiveTool="point"),"Rectangle"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("rectangle"),this.currentActiveTool="rectangle"),"Lasso"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("polygon"),this.currentActiveTool="polygon"),"Circle"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("circle"),this.currentActiveTool="circle"),"Line"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("polyline"),this.currentActiveTool="polyline"),this.setState({currentSelectType:e,isActive:!0}))},this.onClickLoadingProgress=()=>{if(this.activeJimuMapView){const e=!0;this.activeJimuMapView.cancelSelectByQuery(e)}},this.getSelectToolIcon=()=>"Point"===this.state.currentSelectType?Ke:"Rectangle"===this.state.currentSelectType?Je:"Lasso"===this.state.currentSelectType?Ge:"Circle"===this.state.currentSelectType?_e:"Line"===this.state.currentSelectType?$e:Je,this.getMobilePanelForSelectSetting=()=>(0,t.jsx)(R.Consumer,{children:({mapWidgetId:e})=>(0,t.jsx)(s.MobilePanel,{className:"map-tool-mobile-panel",mapWidgetId:`${e}-with-select-container`,title:"",open:this.state.isShowSelectTypePopup,onClose:()=>{this.toggleSelectTypePopup()},children:(0,t.jsx)("div",{className:"w-100",children:this.getMobilePanelSettingContent()})})}),this.getMobilePanelSettingContent=()=>(0,t.jsxs)("div",{css:this.getCSSStyle(),children:[(0,t.jsx)("div",{className:"content-title mt-1 mb-2",children:this.props.intl.formatMessage({id:"SelectionTool",defaultMessage:s.defaultMessages.SelectionTool})}),(0,t.jsx)("div",{className:"w-100 select-tool-type-mobile-container-shell",children:(0,t.jsxs)("div",{className:"select-tool-type-mobile-container d-flex",children:[(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Rectangle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Rectangle")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Rectangle")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:Je}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle}),children:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Lasso"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Lasso")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Lasso")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ge}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso}),children:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Circle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Circle")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Circle")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:_e}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle}),children:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Line"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Line")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Line")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:$e}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine}),children:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine})})]}),(0,t.jsxs)("div",{className:(0,i.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Point"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Point")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Point")},role:"button",tabIndex:0,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ke}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint}),children:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint})})]})]})}),(0,t.jsx)("div",{className:"content-title mt-1 mb-2",children:this.props.intl.formatMessage({id:"SelectionMode",defaultMessage:s.defaultMessages.SelectionMode})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"d-flex align-items-center mt-2",children:[(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"intersects"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"intersects"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"intersects"})},children:this.props.intl.formatMessage({id:"SelectionWithin",defaultMessage:s.defaultMessages.SelectionWithin})})]}),(0,t.jsxs)("div",{className:"d-flex align-items-center mt-2",children:[(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"contains"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"contains"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"contains"})},children:this.props.intl.formatMessage({id:"SelectionContain",defaultMessage:s.defaultMessages.SelectionContain})})]})]})]}),this.handleSelectTypeKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.setCurrentSelectType(t)},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||("toggleIsSelectActive"===t?this.toggleIsSelectActive():"showSelectSetting"===t?this.toggleSelectTypePopup():"onClickLoadingProgress"===t&&this.onClickLoadingProgress())},this.isMac="macOS"===(null===(a=null===(o=window.jimuUA)||void 0===o?void 0:o.os)||void 0===a?void 0:a.name),this.id=`${this.props.mapWidgetId}-select-tool`,this.sketChCreateOptions={polygon:{mode:"hybrid"}},this.state={sketchInitialed:!1,isActive:!1,isShowSelectTypePopup:!1,currentSelectType:"Rectangle",spatialRelationship:"intersects",selectProgress:0},this.bindShiftCtrlKeysEventListeners()}getCSSStyle(){const e=this.props.theme;return i.css`
      .select-tool-btn-hover:hover {
        background-color: ${i.polished.rgba(e.sys.color.primary.main,.1)};
      }

      .content-title {
        font-size: ${i.polished.rem(13)};
        font-weight: bold;
      }

      .select-tool-type-mobile-container-shell {
        overflow-x: auto;
        padding: 4px;
      }

      .select-tool-type-mobile-container-shell::-webkit-scrollbar {
        height: 0 !important;
        display: none;
      }

      .select-tool-type-mobile-container {
        width: 400px;
      }

      .select-tool-type {
        width: 64px;
        height: 64px;
        border: 1px solid ${e.sys.color.divider.secondary};
        cursor: pointer;
      }

      .select-tool-type-choosed {
        border: 1px solid ${e.sys.color.primary.main};
        position: relative;
      }

      .select-tool-type-choosed:after {
        width: 0;
        height: 0;
        border-top: 8px solid ${e.sys.color.primary.main};
        border-left: 8px solid transparent;
        position: absolute;
        top: 0;
        right: 0;
        content: "";
      }

      .select-tool-type-text {
        font-size: ${i.polished.rem(12)};
      }

      .select-tool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .select-tool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .select-tool-loader:after {
        background-color: ${e.sys.color.primary.main};
        width: 40%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }
    `}componentDidMount(){this.state.sketchInitialed||(0,o.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/rest/support/Query","esri/symbols/support/jsonUtils","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then(e=>{[this.SketchViewModel,this.GraphicsLayer,this.Query,this.jsonUtils]=e,this.props.jimuMapView.view.when(()=>{this.initialSketchTool(),this.setState({sketchInitialed:!0})})})}componentDidUpdate(e,t){return t.sketchInitialed!==this.state.sketchInitialed&&this.state.sketchInitialed?(this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.sketchInitialed?(this.destroySketchViewModelAndReleaseHandles(),this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):(t.isActive!==this.state.isActive&&(this.initialSketchTool(),this.state.isActive?this.setActiveToolForSketchViewModel(this.currentActiveTool):this.destroySketchViewModelAndReleaseHandles()),this.tryUpdateActiveToolInfoWhenStateChange(t),void this.tryUpdateActiveToolInfoWhenPropsChange(e))}tryUpdateActiveToolInfoWhenStateChange(e){if(!e)return;const t=!(!e.isActive&&!e.isShowSelectTypePopup),i=!(!this.state.isActive&&!this.state.isShowSelectTypePopup);!t&&i?this.setCurrentToolAsActiveTool():t&&!i&&(this.setState({isActive:!1,isShowSelectTypePopup:!1}),this.setActiveToolToNull())}tryUpdateActiveToolInfoWhenPropsChange(e){var t,i;let o=!1;const s=(null===(t=null==e?void 0:e.activeToolInfo)||void 0===t?void 0:t.activeToolName)||"",a=(null===(i=this.props.activeToolInfo)||void 0===i?void 0:i.activeToolName)||"";if(s!==a){const e=this.props.toolName;s===e&&!(a===e)&&(o=!0)}e.autoControlWidgetId===this.id&&this.props.autoControlWidgetId&&this.props.autoControlWidgetId!==this.id&&(o=!0),o&&(this.state.isActive||this.state.isShowSelectTypePopup)&&this.setState({isActive:!1,isShowSelectTypePopup:!1})}componentWillUnmount(){this.destroySketchViewModelAndReleaseHandles(),this.releaseShiftCtrlKeysEventListeners()}destroySketchViewModelAndReleaseHandles(){if(this.releaseViewHandles(),this.sketchViewModel&&(this.sketchViewModel.destroy(),this.sketchViewModel=null),this.activeJimuMapView=null,this.props.autoControlWidgetId===this.id){const e=i.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,i.getAppStore)().dispatch(e)}}releaseViewHandles(){this.activeJimuMapView&&this.activeJimuMapView.removeSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange),this.viewKeyDownHandle&&(this.viewKeyDownHandle.remove(),this.viewKeyDownHandle=null),this.viewKeyUpHandle&&(this.viewKeyUpHandle.remove(),this.viewKeyUpHandle=null)}setCurrentToolAsActiveTool(){this.isSelectIsActiveTool()||this.props._onIconClick()}setActiveToolToNull(){this.isSelectIsActiveTool()&&this.props._onIconClick()}isSelectIsActiveTool(){var e;return this.props.toolName&&this.props.toolName===(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)}useShiftKey(e){return this.useKey(this.lastShiftKeyEventInfo,e)}useCtrlKey(e){return this.useKey(this.lastCtrlKeyEventInfo,e)}useKey(e,t){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=t}return!1}bindShiftCtrlKeysEventListeners(){document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp,!0)}releaseShiftCtrlKeysEventListeners(){document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp,!0)}initialSketchTool(){if(this.SketchViewModel&&!this.sketchViewModel){this.releaseViewHandles();const e=this.props.jimuMapView;this.activeJimuMapView=e,this.activeJimuMapView.addSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange);const t=e.view;this.viewKeyDownHandle=t.on("key-down",e=>{"Shift"===e.key&&e.stopPropagation()}),this.viewKeyDownHandle=t.on("key-up",e=>{"Shift"===e.key&&e.stopPropagation()}),this.sketchViewModel=new this.SketchViewModel({view:t,layer:new this.GraphicsLayer,pointSymbol:this.jsonUtils.fromJSON(Be),polylineSymbol:this.jsonUtils.fromJSON(He),polygonSymbol:this.jsonUtils.fromJSON(ze)}),this.sketchViewModel.on("create",e=>{if("complete"===e.state){this.setActiveToolForSketchViewModel(this.currentActiveTool);const t=this.props.jimuMapView;t.view.closePopup();const o=e.graphic;if(!o)return void console.log("sketch graphic is null");if(!o.geometry)return void console.log("sketch graphic.geometry is null");const s=500,a=this.useShiftKey(s),n=this.useCtrlKey(s);let l=i.DataSourceSelectionMode.New;l=a?n?i.DataSourceSelectionMode.SelectFromCurrent:i.DataSourceSelectionMode.AddToCurrent:n?i.DataSourceSelectionMode.RemoveFromCurrent:i.DataSourceSelectionMode.New,t.selectFeaturesByGraphic(o,this.state.spatialRelationship,l)}})}}setActiveToolForSketchViewModel(e){if(this.sketchViewModel){const t=this.sketChCreateOptions[e];if(t?this.sketchViewModel.create(e,t):this.sketchViewModel.create(e),this.props.autoControlWidgetId!==this.id){const e=i.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,i.getAppStore)().dispatch(e)}}}getSelectIconTitle(){let e="";e="Point"===this.state.currentSelectType?this.formatMessage("SelectionByPoint"):"Rectangle"===this.state.currentSelectType?this.formatMessage("SelectionByRectangle"):"Lasso"===this.state.currentSelectType?this.formatMessage("SelectionByLasso"):"Circle"===this.state.currentSelectType?this.formatMessage("SelectionByCircle"):"Line"===this.state.currentSelectType?this.formatMessage("SelectionByLine"):this.formatMessage("SelectLabel");const t=this.formatMessage("newSelection"),i=this.formatMessage("addToCurrentSelection"),o=this.formatMessage("removeFromCurrentSelection"),s=this.formatMessage("selectFromCurrentSelection"),a=this.formatMessage("drawShape"),n=this.formatMessage("draw"),l=this.isMac?"Cmd":"Ctrl";return`${e}\n${`\u2219 ${t} (${a})`}\n${`\u2219 ${i} (Shift + ${n})`}\n${`\u2219 ${o} (${l} + ${n})`}\n${`\u2219 ${s} (Shift + ${l} + ${n})`}\n    `}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}render(){const e=this.getSelectIconTitle(),o=this.formatMessage("moreSelectionTools"),a=this.state.selectProgress>0&&this.state.selectProgress<1;return(0,t.jsxs)("div",{css:this.getCSSStyle(),children:[this.state.sketchInitialed&&!a&&(0,t.jsx)("div",{onClick:this.toggleIsSelectActive,style:{},title:e,className:(0,i.classNames)("exbmap-ui-tool border-0 esri-widget--button-like",{selected:this.state.isActive}),onKeyDown:e=>{this.handleKeyDown(e,"toggleIsSelectActive")},role:"button",tabIndex:0,children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getSelectToolIcon()})}),this.state.sketchInitialed&&a&&(0,t.jsx)(Pe,{progress:this.state.selectProgress,intl:this.props.intl,theme:this.props.theme,onClick:this.onClickLoadingProgress}),!this.state.sketchInitialed&&(0,t.jsx)("div",{style:{},className:(0,i.classNames)("exbmap-ui-tool border-0 esri-widget--button-like"),children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getSelectToolIcon()})}),(0,t.jsx)("div",{className:"border border-top-0 w-100",style:{height:"1px"}}),this.state.sketchInitialed&&(0,t.jsx)("div",{onClick:this.toggleSelectTypePopup,title:o,"aria-label":o,style:{},className:(0,i.classNames)("exbmap-ui-tool border-0 esri-widget--button-like"),onKeyDown:e=>{this.handleKeyDown(e,"showSelectSetting")},role:"button",tabIndex:0,children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:qe})}),!this.state.sketchInitialed&&(0,t.jsx)("div",{style:{},title:o,className:(0,i.classNames)("exbmap-ui-tool border-0 esri-widget--button-like"),children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:qe})}),this.state.isShowSelectTypePopup&&this.getMobilePanelForSelectSetting()]})}}class Qe extends i.React.PureComponent{constructor(){super(...arguments),this.onJimuLayerViewSelectedFeaturesChange=()=>{this.computerSelectedGraphicCount()}}componentDidMount(){this.setCurrentJimuMapView(this.props.jimuMapView),this.computerSelectedGraphicCount()}componentDidUpdate(e){const t=(null==e?void 0:e.jimuMapView)||null,i=this.props.jimuMapView||null;t!==i&&this.setCurrentJimuMapView(i),this.computerSelectedGraphicCount()}componentWillUnmount(){this.setCurrentJimuMapView(null)}setCurrentJimuMapView(e){this.currentJimuMapView&&this.currentJimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),this.currentJimuMapView=e,this.currentJimuMapView&&this.currentJimuMapView.addJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange)}computerSelectedGraphicCount(){if(this.props.onSelectedGraphicsChanged){const e=this.props.jimuMapView.getSelectedFeatureCount();this.props.onSelectedGraphicsChanged(e)}}render(){return null}}const Ye=i.ReactRedux.connect((e,t)=>{if(e.appStateInBuilder){return{dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo,viewInfos:e.appStateInBuilder&&e.appStateInBuilder.jimuMapViewsInfo}}return{dataSourcesInfo:e&&e.dataSourcesInfo,viewInfos:e&&e.jimuMapViewsInfo}})(Qe);var Xe=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const et=r(37175),tt=r(4583);var it=r(43058),ot=r.n(it),st=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const at=e=>{const o=window.SVG,{className:s}=e,a=st(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",s);return o?(0,t.jsx)(o,Object.assign({className:n,src:ot()},a)):(0,t.jsx)("svg",Object.assign({className:n},a))};var nt=r(78313),lt=r.n(nt),rt=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i};const pt=e=>{const o=window.SVG,{className:s}=e,a=rt(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",s);return o?(0,t.jsx)(o,Object.assign({className:n,src:lt()},a)):(0,t.jsx)("svg",Object.assign({className:n},a))};var ct=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const dt=r(15181),ht=r(56113),ut=r(71525),mt=r(3737);var gt;!function(e){e.Initial="Initial",e.Creating="Creating",e.Created="Created",e.CreateError="CreateError"}(gt||(gt={}));const vt={Zoom:class extends oe{constructor(){super(...arguments),this.toolName="Zoom"}getTitle(){return this.props.intl.formatMessage({id:"ZoomLabel",defaultMessage:s.defaultMessages.ZoomLabel})}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(se,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded})}},Home:class extends oe{constructor(){super(...arguments),this.toolName="Home",this.getHomeContent=e=>(0,t.jsx)(ne,{jimuMapView:this.props.jimuMapView,initialMapState:e,mapComponentsLoaded:this.props.mapComponentsLoaded})}getTitle(){return this.props.intl.formatMessage({id:"HomeLabel",defaultMessage:s.defaultMessages.HomeLabel})}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(R.Consumer,{children:({initialMapState:e})=>this.getHomeContent(e)})}},Navigation:class extends oe{constructor(){super(...arguments),this.toolName="Navigation"}getTitle(){return"Navigation"}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(ce,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded})}static isAvailable(e){var t,i;return"3d"===(null===(i=null===(t=e.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.type)}},Locate:class extends oe{constructor(){super(...arguments),this.toolName="Locate"}getTitle(){return"Locate"}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(re,{mapWidgetId:this.props.mapWidgetId,jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded})}},ClearActionData:class extends oe{constructor(e){super(e),this.toolName="ClearActionData",this.onJimuLayerViewRemoved=e=>{const t=null==e?void 0:e.layer,i=this.props.mapWidgetId;if(i&&t&&t[pe]){const e=t.id;if(e){const t=this.getListItems(i).find(t=>t.layerId===e);t&&this.onItemClick(t,i),this.forceUpdate()}}},this.onIconClick=()=>null,this.onDropDownToggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.onItemClick=(e,t)=>{var s,a;this.setState({isOpen:!1});const n=e.layerId,l=i.MutableStoreManager.getInstance().getStateValue([t])||{};if(e.isAction){const e=n,a=l.showOnMapDatas,r=l.addToMapDatas;a&&(delete a[e],i.MutableStoreManager.getInstance().updateStateValue(t,"showOnMapDatas",a)),r&&(null===(s=r[e])||void 0===s?void 0:s.dataChangeType)===o.DataChangeType.Created&&i.MutableStoreManager.getInstance().updateStateValue(t,`addToMapDatas.${e}.dataChangeType`,o.DataChangeType.Remove)}else{const e=this.props.jimuMapView,t=null===(a=null==e?void 0:e.view)||void 0===a?void 0:a.map;if(t)if(n===i.CONSTANTS.ADD_MARKER_LAYER_ID)e.removeMarkerLayer(),e.updateMarkerUrlParamIfActive();else{const e=t.findLayerById(n);e&&t.remove(e)}}},this.getContent=e=>{const i=this.getListItems(e).map((t,i)=>this.createDropdownItem(t,e,i));return i.length>0?(0,t.jsx)("div",{css:this.getStyle(),title:this.getTitle(),children:(0,t.jsxs)(s.Dropdown,{direction:"down",size:"sm",toggle:this.onDropDownToggle,isOpen:this.state.isOpen,children:[(0,t.jsx)(s.DropdownButton,{icon:!0,arrow:!1,size:"sm",type:"default",children:(0,t.jsx)(s.Icon,{size:16,className:"exbmap-ui-tool-icon",icon:this.getIcon().icon})}),(0,t.jsx)(s.DropdownMenu,{children:i})]})}):null},this.state={isOpen:!1}}componentDidMount(){this.removeLayerListener(),this.addLayerListener()}componentDidUpdate(e){var t;((null==e?void 0:e.jimuMapView)||null)!==((null===(t=this.props)||void 0===t?void 0:t.jimuMapView)||null)&&(this.removeLayerListener(),this.addLayerListener())}componentWillUnmount(){this.removeLayerListener()}addLayerListener(){var e,t,o;if(this.removeLayerListener(),this.jimuMapViewForListener=this.props.jimuMapView,this.jimuMapViewForListener){const s=null===(o=null===(t=null===(e=this.jimuMapViewForListener)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===o?void 0:o.layers;s&&(this.handle=s.on("before-remove",e=>{const t=null==e?void 0:e.item;if(t){t[pe]=!1;const e=t.parent;!e||"esri.WebMap"!==e.declaredClass&&"esri.WebScene"!==e.declaredClass||(t[pe]=!0),t.id===i.CONSTANTS.ADD_MARKER_LAYER_ID&&this.forceUpdate()}})),this.jimuMapViewForListener.addJimuLayerViewRemovedListener(this.onJimuLayerViewRemoved)}}removeLayerListener(){this.handle&&(this.handle.remove(),this.handle=null),this.jimuMapViewForListener&&(this.jimuMapViewForListener.removeJimuLayerViewRemovedListener(this.onJimuLayerViewRemoved),this.jimuMapViewForListener=null)}static getIsNeedSetting(){return!1}getStyle(){return i.css`
      .jimu-dropdown {
        display: flex;
        .icon-btn {
          padding: 7px;
          border-radius: 0;
        }

        > button {
          border: 0;
          width: 32px;
          height: 32px;
        }
      }
    `}getTitle(){return this.props.intl.formatMessage({id:"clearResults",defaultMessage:s.defaultMessages.clearResults})}getIcon(){return{icon:r(9044),onIconClick:()=>{this.onIconClick()}}}getListItems(e){const t=i.MutableStoreManager.getInstance().getStateValue([e])||{},o=this.getListItemsByAddOrShowOnMapDatas(e,t),s=o.map(e=>e.layerId);let a=this.getListItemsByRemoveableLayerIdsInfo(t);a=a.filter(e=>!s.includes(e.layerId));const n=this.getListItemForMarkerLayer(),l=o.concat(a);return n&&l.push(n),l}getListItemsByAddOrShowOnMapDatas(e,t){const s=(null==t?void 0:t.showOnMapDatas)||{},a=(null==t?void 0:t.addToMapDatas)||{},n=Object.entries(s).map(e=>({id:e[0],title:e[1].title,jimuMapViewId:e[1].jimuMapViewId,mapWidgetId:e[1].mapWidgetId,needToRemove:!0,type:e[1].type})),l=Object.entries(a).map(e=>({id:e[0],title:e[1].title,jimuMapViewId:e[1].jimuMapViewId,mapWidgetId:e[1].mapWidgetId,needToRemove:e[1].dataChangeType===o.DataChangeType.Created,type:e[1].type}));return n.concat(l).filter(t=>{let s=t.jimuMapViewId;if(!s&&t.mapWidgetId===e){const t=(0,i.getAppStore)().getState().jimuMapViewsInfo;s=Object.keys(t||{}).find(i=>t[i].mapWidgetId===e)}return s===this.props.jimuMapView.id&&t.type===o.ActionType.DataAction&&t.needToRemove}).map(e=>({layerId:e.id,title:e.title,isAction:!0}))}getListItemsByRemoveableLayerIdsInfo(e){var t;const i=[],o=(null==e?void 0:e.removeableLayerIdsInfo)||{},s=this.props.jimuMapView;if(s){const e=null===(t=s.view)||void 0===t?void 0:t.map;if(e){(o[s.id]||[]).forEach(t=>{const o=e.findLayerById(t);if(o){const e={layerId:t,title:o.title||t,isAction:!1};i.push(e)}})}}return i}getListItemForMarkerLayer(){var e,t;let o=null;const s=null===(t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map;if(s){const e=s.findLayerById(i.CONSTANTS.ADD_MARKER_LAYER_ID);e&&(o={layerId:e.id,title:e.title,isAction:!1})}return o}createDropdownItem(e,i,o){const a=`${e.layerId}-index-${o}`;return(0,t.jsx)(s.DropdownItem,{header:!1,onClick:()=>{this.onItemClick(e,i)},children:e.title},a)}getExpandPanel(){return(0,t.jsx)(R.Consumer,{children:({mapWidgetId:e})=>this.getContent(e)})}},Compass:class extends oe{constructor(){super(...arguments),this.toolName="Compass"}getTitle(){return this.props.intl.formatMessage({id:"CompassLabel",defaultMessage:s.defaultMessages.CompassLabel})}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(le,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded})}},Search:class extends oe{constructor(){super(...arguments),this.toolName="Search"}getTitle(){return this.props.intl.formatMessage({id:"SearchLabel",defaultMessage:s.defaultMessages.SearchLabel})}getIcon(){return{icon:r(98018)}}getExpandPanel(){return this.props.isMobile?(0,t.jsx)("div",{style:{position:"relative",width:"100%",minHeight:"32px"},children:(0,t.jsx)(de,{jimuMapView:this.props.jimuMapView,mapWidgetId:this.props.mapWidgetId,mapComponentsLoaded:this.props.mapComponentsLoaded,isMobile:this.props.isMobile})}):(0,t.jsx)("div",{style:{position:"relative",width:"283px",minHeight:"32px"},children:(0,t.jsx)(de,{jimuMapView:this.props.jimuMapView,mapWidgetId:this.props.mapWidgetId,mapComponentsLoaded:this.props.mapComponentsLoaded,isMobile:this.props.isMobile})})}},Layers:class extends oe{constructor(e){super(e),this.toolName="Layers",this.handleTabIndexChange=e=>{this.setState({activeTabIndex:e})},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.handleTabIndexChange(t)},this.state={activeTabIndex:0}}getTitle(){return this.props.intl.formatMessage({id:"LayersLabel",defaultMessage:s.defaultMessages.LayersLabel})}getIcon(){return{icon:r(32945)}}getExpandPanel(){return(0,t.jsxs)("div",{style:{width:this.props.isMobile?"100%":"250px",minHeight:"32px",position:"relative"},className:(0,i.classNames)({"exbmap-ui-pc-expand-maxheight":!this.props.isMobile}),children:[(0,t.jsxs)(s.Nav,{tabs:!0,style:{borderRadius:0},children:[(0,t.jsx)(s.NavItem,{children:(0,t.jsx)(s.NavLink,{style:{borderBottomLeftRadius:0,borderBottomRightRadius:0},active:0===this.state.activeTabIndex,onClick:()=>{this.handleTabIndexChange(0)},onKeyDown:e=>{this.handleKeyDown(e,0)},children:this.props.intl.formatMessage({id:"LayersLabelLayer",defaultMessage:s.defaultMessages.LayersLabelLayer})})}),(0,t.jsx)(s.NavItem,{children:(0,t.jsx)(s.NavLink,{style:{borderBottomLeftRadius:0,borderBottomRightRadius:0},active:1===this.state.activeTabIndex,onClick:()=>{this.handleTabIndexChange(1)},onKeyDown:e=>{this.handleKeyDown(e,1)},children:this.props.intl.formatMessage({id:"LayersLabelLegend",defaultMessage:s.defaultMessages.LayersLabelLegend})})})]}),(0,t.jsx)("div",{className:"mt-1"}),0===this.state.activeTabIndex&&(0,t.jsx)(he,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded}),1===this.state.activeTabIndex&&(0,t.jsx)(ue,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded})]})}},BaseMap:class extends oe{constructor(){super(...arguments),this.toolName="BaseMap"}getTitle(){return this.props.intl.formatMessage({id:"BaseMapLabel",defaultMessage:s.defaultMessages.BaseMapLabel})}getIcon(){return{icon:r(82009)}}getExpandPanel(){return(0,t.jsx)(me,{jimuMapView:this.props.jimuMapView,isMobile:this.props.isMobile,mapComponentsLoaded:this.props.mapComponentsLoaded})}},Measure:class extends oe{constructor(e){super(e),this.toolName="Measure",this.measureModules2D=[{name:"Line",title:"Line",activeTool:"distance",src:r(19086)},{name:"Polygon",title:"Polygon",activeTool:"area",src:r(60308)}],this.measureModules3D=[{name:"Line",title:"Line",activeTool:"direct-line",src:r(19086)},{name:"Polygon",title:"Polygon",activeTool:"area",src:r(60308)}],this.destroy=()=>{const e=this.state.measureInstance;e&&(Ve(e),e.destroyed||(e.destroy(),this.setState({measureInstance:null,activeTabIndex:0})))},this.handleMeasurceInstanceCreated=e=>{const t=this.state.measureInstance;t&&Ve(t),this.setState({measureInstance:e})},this.onTabClick=e=>{this.state.activeTabIndex!==e&&(this.state.measureInstance.clear(),this.setState({activeTabIndex:e}),0===e?this.state.measureInstance.activeTool="2d"===this.props.jimuMapView.view.type?"distance":"direct-line":1===e&&(this.state.measureInstance.activeTool="area"))},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.onTabClick(t)},this.onRequestClosePanel=()=>{this.props.activeToolInfo.activeToolName===this.toolName&&this.props.onActiveToolInfoChange(null)},this.onClosePanel=()=>{this.destroy()},this.onShowPanel=()=>{this.state.measureInstance&&(0===this.state.activeTabIndex?this.state.measureInstance.activeTool="2d"===this.props.jimuMapView.view.type?"distance":"direct-line":1===this.state.activeTabIndex&&(this.state.measureInstance.activeTool="area"))},this.getNavTab=()=>"2d"===this.props.jimuMapView.view.type?(0,t.jsx)(s.Nav,{tabs:!0,style:{borderRadius:0},children:this.measureModules2D.map((e,i)=>{const o=0===i?"drawModeLine":"drawModePolygon";return(0,t.jsx)(s.NavItem,{children:(0,t.jsx)(s.NavLink,{style:{borderBottomLeftRadius:0,borderBottomRightRadius:0},active:this.state.activeTabIndex===i,ref:e=>{this.state.activeTabIndex===i&&(this.activeTabRef=e)},onClick:()=>{this.onTabClick(i)},onKeyDown:e=>{this.handleKeyDown(e,i)},"aria-label":this.props.intl.formatMessage({id:o,defaultMessage:s.defaultMessages[o]}),children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"m-0",icon:e.src})})},i)})}):"3d"===this.props.jimuMapView.view.type?(0,t.jsx)(s.Nav,{tabs:!0,children:this.measureModules3D.map((e,i)=>{const o=0===i?"drawModeLine":"drawModePolygon";return(0,t.jsx)(s.NavItem,{children:(0,t.jsx)(s.NavLink,{active:this.state.activeTabIndex===i,ref:e=>{this.state.activeTabIndex===i&&(this.activeTabRef=e)},onClick:()=>{this.onTabClick(i)},onKeyDown:e=>{this.handleKeyDown(e,i)},"aria-label":this.props.intl.formatMessage({id:o,defaultMessage:s.defaultMessages[o]}),children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"m-0",icon:e.src})})},i)})}):null,this.getMeasureModule=()=>"2d"===this.props.jimuMapView.view.type?this.measureModules2D[this.state.activeTabIndex]:this.measureModules3D[this.state.activeTabIndex],this.state={activeTabIndex:0,measureInstance:null}}getTitle(){return this.props.intl.formatMessage({id:"MeasureLabel",defaultMessage:s.defaultMessages.MeasureLabel})}getIcon(){return{icon:r(9206)}}focusDefaultElement(){(0,i.focusElementInKeyboardMode)(this.activeTabRef)}getExpandPanel(){return(0,t.jsxs)("div",{style:{width:this.props.isMobile?"100%":"250px",position:"relative"},className:(0,i.classNames)({"exbmap-ui-pc-expand-maxheight":!this.props.isMobile}),children:[this.getNavTab(),(0,t.jsx)(Ie,{mapWidgetId:this.props.mapWidgetId,activeTabIndex:this.state.activeTabIndex,jimuMapView:this.props.jimuMapView,measureModule:this.getMeasureModule(),measureInstance:this.state.measureInstance,onMeasurceInstanceCreated:this.handleMeasurceInstanceCreated,autoControlWidgetId:this.props.autoControlWidgetId,onRequestClosePanel:this.onRequestClosePanel})]})}},MapSwitch:class extends oe{constructor(){super(...arguments),this.toolName="MapSwitch",this.switchMap=()=>null,this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||(null==e||e.preventDefault(),t())},this.getContent=(e,o,a,n,l,r)=>{const p=()=>{(0,i.getAppStore)().dispatch(i.appActions.requestAutoControlMapWidget(l,l)),n()},c=(0,i.getAppStore)().getState().appConfig.dataSources,d="switchTo",h=o[0],u=h?c[h]:null,m=(null==u?void 0:u.portalUrl)||null,g=(null==u?void 0:u.itemId)||null,v=(null==u?void 0:u.label)||(null==u?void 0:u.sourceLabel)||"",w=v?this.props.intl.formatMessage({id:d,defaultMessage:z[d]},{webMapName:v}):"",f=o[1],y=f?c[f]:null,M=(null==y?void 0:y.portalUrl)||null,S=(null==y?void 0:y.itemId)||null,b=(null==y?void 0:y.label)||(null==y?void 0:y.sourceLabel)||"",x=b?this.props.intl.formatMessage({id:d,defaultMessage:z[d]},{webMapName:b}):"";let I="",C="";return h!==a?(I=v,C=w):f!==a&&(I=b,C=x),C||(C=this.props.intl.formatMessage({id:"SwitchMap",defaultMessage:s.defaultMessages.SwitchMap})),e?this.props.isMobile?(0,t.jsx)("div",{className:"exbmap-ui-tool esri-widget--button-like",onClick:p,role:"button",tabIndex:0,onKeyDown:e=>{this.handleKeyDown(e,p)},title:I,"aria-label":C,children:(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getIcon().icon})}):(0,t.jsxs)("div",{className:"mapswitch-map-tool",css:this.getStyle(),onClick:p,role:"button",tabIndex:0,onKeyDown:e=>{this.handleKeyDown(e,p)},"aria-label":C,children:[(0,t.jsx)("div",{title:v,className:(0,i.classNames)("mapthumb-item",{front:h!==a},{back:h===a}),children:(0,t.jsx)(ye,{usedInSetting:!1,mapItemId:g,portUrl:m,label:w,theme:r})}),(0,t.jsx)("div",{title:b,className:(0,i.classNames)("mapthumb-item",{front:f!==a},{back:f===a}),children:(0,t.jsx)(ye,{usedInSetting:!1,mapItemId:S,portUrl:M,label:x,theme:r})})]}):null},this.getIconContent=(e,t,i,o)=>e?(this.switchMap=o,super.render()):null}static getIsNeedSetting(){return!1}static isAvailable(e){if(e.isMobile){const t=e.mapWidgetId;if(t){const e=(0,i.getAppStore)().getState().appConfig.widgets[t];if(e)return e.useDataSources&&e.useDataSources.length>=2}return!1}return!0}getStyle(){return i.css`
      width: ${i.polished.rem(68)};
      height: ${i.polished.rem(52)};
      cursor: pointer;
      position: relative;

      .mapthumb-item {
        position: absolute;
        width: ${i.polished.rem(64)};
        height: ${i.polished.rem(48)};
        transition: bottom 0.5s, left 0.5s, top 0.5s, right 0.5s, z-index 0.5s;
      }

      .front {
        z-index: 1;
        bottom: 0;
        left: 0;
      }

      .back {
        z-index: 0;
        top: 0;
        right: 0;
      }
    `}getTitle(){return"MapSwitch"}getIcon(){return{icon:r(47717),onIconClick:()=>{this.switchMap()}}}getExpandPanel(){return this.props.toolJson.isOnlyExpanded?(0,t.jsx)(R.Consumer,{children:({isShowMapSwitchBtn:e,dataSourceIds:t,activeDataSourceId:i,switchMap:o,mapWidgetId:s,theme:a})=>this.getContent(e,t,i,o,s,a)}):null}render(){return this.props.toolJson.isOnlyExpanded?super.render():(0,t.jsx)(R.Consumer,{children:({isShowMapSwitchBtn:e,dataSourceIds:t,activeDataSourceId:i,switchMap:o})=>this.getIconContent(e,t,i,o)})}},FullScreen:class extends oe{constructor(){super(...arguments),this.toolName="Fullscreen",this.isFullScreen=!1,this.fullScreenMap=()=>null,this.getContent=(e,t)=>(this.fullScreenMap=e,this.isFullScreen=t,super.render())}getTitle(){return this.props.intl.formatMessage({id:"FullScreenLabel",defaultMessage:s.defaultMessages.FullScreenLabel})}getIcon(){return{icon:this.isFullScreen?r(69881):r(49798),onIconClick:e=>{this.fullScreenMap()}}}getExpandPanel(){return null}getAttributesForBtnRole(){return{"aria-pressed":this.isFullScreen||!1}}render(){return(0,t.jsx)(R.Consumer,{children:({fullScreenMap:e,isFullScreen:t})=>this.getContent(e,t)})}},ScaleBar:class extends oe{constructor(){super(...arguments),this.toolName="ScaleBar"}getTitle(){return"ScaleBar"}getIcon(){return null}getExpandPanel(){const e=this.props.selfToolOptions;return(0,t.jsx)(be,{jimuMapView:this.props.jimuMapView,mapComponentsLoaded:this.props.mapComponentsLoaded,scalebarOptions:e})}static isAvailable(e){var t,i;return"2d"===(null===(i=null===(t=e.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.type)}},Attribution:class extends oe{constructor(){super(...arguments),this.toolName="Attribution"}static getIsNeedSetting(){return!1}getTitle(){return"Attribution"}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(xe,{jimuMapView:this.props.jimuMapView})}},Select:class extends oe{constructor(e){super(e),this.toolName="Select",this.state={}}getTitle(){return this.props.intl.formatMessage({id:"SelectLabel",defaultMessage:s.defaultMessages.SelectLabel})}getIcon(){return{icon:r(10272)}}getExpandPanel(){return this.props.isMobile?(0,t.jsx)(Ze,{mapWidgetId:this.props.mapWidgetId,autoControlWidgetId:this.props.autoControlWidgetId,activeToolInfo:this.props.activeToolInfo,toolName:this.toolName,onActiveToolInfoChange:this.props.onActiveToolInfoChange,_onIconClick:()=>{this._onIconClick()},theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView}):(0,t.jsx)(Fe,{mapWidgetId:this.props.mapWidgetId,autoControlWidgetId:this.props.autoControlWidgetId,theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView,activeToolInfo:this.props.activeToolInfo,toolName:this.toolName,onActiveToolInfoChange:this.props.onActiveToolInfoChange,_onIconClick:()=>{this._onIconClick()}})}},SelectState:class extends oe{constructor(e){super(e),this.toolName="SelectState",this.handleSelectedGraphicsChanged=e=>{this.setState({selectedGraphicCount:e})},this.zoomToSelectedFeatures=()=>Xe(this,void 0,void 0,function*(){var e;const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;if(t){const e=yield this.getSelectedGraphics();e.length>0&&t.goTo(e)}}),this.clearSelectedFeatures=()=>Xe(this,void 0,void 0,function*(){const e=this.props.jimuMapView;if(e){try{const t=!1;yield e.cancelSelectByQuery(t)}catch(t){console.error(`jimuMapView.cancelSelectByQuery() error, jimuMapViewId: ${e.id}`,t)}setTimeout(()=>{e.clearSelectedFeatures()},200)}}),this.state={selectedGraphicCount:0}}getMobileStyle(){return i.css`
      background-color: var(--sys-color-surface-overlay);
      color: var(--sys-color-surface-overlay-text);
    `}getTitle(){return""}getIcon(){return null}getSelectedGraphics(){return Xe(this,void 0,void 0,function*(){let e=[];return this.props.jimuMapView&&(e=yield this.props.jimuMapView.getSelectedFeatures()),e})}getExpandPanel(){const e=this.props.intl.formatMessage({id:"SelectionSelectedFeatures",defaultMessage:s.defaultMessages.SelectionSelectedFeatures}),o=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:s.defaultMessages.clearSelection}),a=this.props.intl.formatMessage({id:"SelectionZoomToSelectedFeatures",defaultMessage:s.defaultMessages.SelectionZoomToSelectedFeatures});return this.props.isMobile?(0,t.jsxs)("div",{css:this.getMobileStyle(),className:"w-100 d-flex justify-content-between align-items-center",style:{height:"40px"},children:[(0,t.jsx)("div",{className:"ml-2",children:`${e}: ${this.state.selectedGraphicCount}`}),(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsx)("div",{title:a,className:"h-100 border border-top-0 border-bottom-0 d-flex justify-content-center align-items-center",style:{width:"40px",cursor:"pointer"},onClick:this.zoomToSelectedFeatures,children:(0,t.jsx)(s.Icon,{width:18,height:18,icon:et})}),(0,t.jsx)("div",{className:"h-100 d-flex justify-content-center align-items-center",style:{width:"40px",cursor:"pointer"},onClick:this.clearSelectedFeatures,title:o,children:(0,t.jsx)(s.Icon,{width:18,height:18,icon:tt})})]}),(0,t.jsx)(Ye,{jimuMapView:this.props.jimuMapView,onSelectedGraphicsChanged:this.handleSelectedGraphicsChanged})]}):(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsxs)(s.Button,{className:"border-0",style:{borderRadius:0},onClick:this.zoomToSelectedFeatures,title:a,children:[(0,t.jsx)(s.Icon,{width:16,height:16,icon:et,className:"mr-2"}),`${e}: ${this.state.selectedGraphicCount}`]}),(0,t.jsx)(Ye,{jimuMapView:this.props.jimuMapView,onSelectedGraphicsChanged:this.handleSelectedGraphicsChanged})]})}},ExtentNavigate:class extends oe{constructor(){super(...arguments),this.toolName="ExtentNavigate",this.onViewStationary=()=>{this.updateByCurrentView()},this.onClickPrevBtn=()=>{if(!this.isPrevBtnEnabled())return;this.view.viewpointIndex--;const e=L(this.view,this.view.viewpointIndex);e&&this.view.goTo(e),this.updateByCurrentView()},this.onPrevBtnKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||this.onClickPrevBtn()},this.onClickNextBtn=()=>{if(!this.isNextBtnEnabled())return;this.view.viewpointIndex++;const e=L(this.view,this.view.viewpointIndex);e&&this.view.goTo(e),this.updateByCurrentView()},this.onNextBtnKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||this.onClickNextBtn()}}getTitle(){return"ExtentNavigate"}getIcon(){return{icon:null}}getExtendCssStyle(){return"\n      .extent-navigate-btn {\n        width: 32px;\n        height: 32px;\n        text-align: center;\n        line-height: 32px;\n        cursor: default;\n      }\n\n      .extent-navigate-prev-btn {\n        border-bottom: 1px solid #ccc;\n      }\n    "}getExpandPanel(){const e=!this.isPrevBtnEnabled(),o=!this.isNextBtnEnabled(),s=(0,i.classNames)("esri-widget--button-like extent-navigate-btn extent-navigate-prev-btn",{disabled:e}),a=(0,i.classNames)("esri-widget--button-like extent-navigate-btn extent-navigate-next-btn",{disabled:o}),n=this.formatMessage("prevExtent"),l=this.formatMessage("nextExtent");return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{role:"button",tabIndex:0,className:s,title:n,"aria-label":n,onClick:this.onClickPrevBtn,onKeyDown:this.onPrevBtnKeyDown,children:(0,t.jsx)(at,{color:e?"var(--sys-color-action-disabled-text)":"var(--sys-color-action-text)"})}),(0,t.jsx)("div",{role:"button",tabIndex:0,className:a,title:l,"aria-label":l,onClick:this.onClickNextBtn,onKeyDown:this.onNextBtnKeyDown,children:(0,t.jsx)(pt,{color:o?"var(--sys-color-action-disabled-text)":"var(--sys-color-action-text)"})})]})}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}componentDidMount(){this.bindView()}componentDidUpdate(){this.bindView()}bindView(){var e;const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;this.view!==t&&(this.view&&(this.view.stationaryCallback=null),this.view=t,this.view&&(this.view.stationaryCallback=this.onViewStationary),this.updateByCurrentView())}updateByCurrentView(){this.forceUpdate()}isPrevBtnEnabled(){return this.view&&this.view.viewpointHistory.length>=2&&this.view.viewpointIndex>=1}isNextBtnEnabled(){return this.view&&this.view.viewpointHistory.length>=2&&this.view.viewpointIndex<this.view.viewpointHistory.length-1}},OverviewMap:class extends oe{constructor(e){super(e),this.toolName="OverviewMap",this.mouseDownOffsetXY=null,this.onSetRootDom=e=>{this.rootDom=e},this.onClickArrowIcon=()=>{this.setState({isOpened:!this.state.isOpened},()=>{this.tryCreateNewSmallView()})},this.onMouseDownOverviewFocusDom=e=>{this.boundMainJimuMapView&&this.smallView&&(this.mouseDownOffsetXY=this.getMouseEventRelativePosition(e,this.rootDom))},this.onBodyMouseMove=e=>{if(!this.mouseDownOffsetXY)return;const t=this.getMouseEventRelativePosition(e,this.rootDom),i=t[0]-this.mouseDownOffsetXY[0],o=t[1]-this.mouseDownOffsetXY[1];this.mixinUpdateOverviewFocusDomStyle({transform:`translate(${i}px, ${o}px)`})},this.onBodyMouseUp=e=>{var t,i;if(!this.mouseDownOffsetXY)return;if(!this.boundMainJimuMapView||!this.smallView)return;const o=this.boundMainJimuMapView.view,s=this.smallView,a=this.getMouseEventRelativePosition(e,this.rootDom),n=a[0]-this.mouseDownOffsetXY[0],l=a[1]-this.mouseDownOffsetXY[1];if(this.mouseDownOffsetXY=null,0===n&&0===l)this.mixinUpdateOverviewFocusDomStyle({transform:"none"});else{const e=s.resolution,a=e*n,r=-e*l,p=this.focusExtent.clone(),c=p.xmin+a,d=p.xmax+a,h=p.ymin+r,u=p.ymax+r;p.xmin=c,p.xmax=d,p.ymin=h,p.ymax=u,this.tempFixedFocusExtent=p;const m=this.tempFixedFocusExtent.center.clone();(null===(i=null===(t=o.map.ground)||void 0===t?void 0:t.layers)||void 0===i?void 0:i.length)>0?(o.center=m,this.tempFixedFocusExtent=null,this.onMainViewExtentChange()):o.goTo(m).finally(()=>{this.tempFixedFocusExtent=null,this.onMainViewExtentChange()})}},this.state={apiLoaded:!1,isOpened:!1,smallViewStatus:gt.Initial,overviewFocusDomStyle:{}}}getStyle(){let e="left",t="right";return this.props.isRTL&&(e="right",t="left"),i.css`
      position: relative;
      overflow: visible;

      .overview-window {
        box-sizing: content-box;
        position: absolute;
        width: 200px;
        height: 200px;
        overflow: hidden;
        background: white;
        border: 1px solid var(--ref-palette-neutral-1200, #050505);

        .overview-map-container {
          pointer-events: none;
          width: 100%;
          height: 100%;
        }

        .overview-mask {
          position: absolute;
          left: 0;
          right: 0;
          top: 0;
          bottom: 0;
          width: 100%;
          height: 100%;

          .overview-focus {
            position: absolute;
            box-sizing: border-box;
            ${e}: 0;
            top: 0;
            width: 0;
            height: 0;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--ref-palette-neutral-1200, #050505);
            cursor: move;
          }
        }
      }

      .overview-map-arrow-icon-btn {
        position: absolute;
        width: 14px !important;
        height: 14px !important;
        margin: 0 !important;
        padding: 0 !important;
        border: 0 !important;
        border-radius: 0 !important;

        .icon-btn-sizer {
          min-width: 0;
          min-height: 0;
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
          border: 0;
        }
      }

      &.small-view-not-created {
        .overview-focus {
          display: none !important;
        }
      }

      &.right-bottom-corner {
        .overview-window {
          ${t}: 0;
          bottom: 0;
        }

        .overview-map-arrow-icon-btn {
          ${t}: 1px;
          bottom: 1px;
        }
      }

      &.right-top-corner {
        .overview-window {
          ${t}: 0;
          top: 0;
        }

        .overview-map-arrow-icon-btn {
          ${t}: 1px;
          top: 1px;
        }
      }

      &.overview-map-tool-not-opened {
        .overview-window {
          visibility: hidden;
          pointer-events: none;
        }

        &.right-bottom-corner {
          .overview-map-arrow-icon-btn {
            ${t}: 0;
            bottom: 0;
          }
        }

        &.right-top-corner {
          .overview-map-arrow-icon-btn {
            ${t}: 0;
            top: 0;
          }
        }
      }
    `}getTitle(){return""}getIcon(){return null}getExpandPanel(){var e,o;const a=this.state.overviewFocusDomStyle||{},n=null===(e=this.props.toolJson)||void 0===e?void 0:e.isSecondLayout,l=this.state.smallViewStatus===gt.Created,r=(0,i.classNames)(["overview-map-tool",{"right-bottom-corner":!n},{"right-top-corner":n},{"overview-map-tool-not-opened":!this.state.isOpened},{"small-view-created":l},{"small-view-not-created":!l}]);let p="";p=n?this.state.isOpened?mt:ut:this.state.isOpened?ht:dt;let c=s.defaultMessages.OverviewMapLabel||"";return this.props.intl&&(c=null===(o=this.props.intl)||void 0===o?void 0:o.formatMessage({id:"OverviewMapLabel",defaultMessage:c})),c||(c=""),(0,t.jsxs)("div",{className:r,css:this.getStyle(),children:[(0,t.jsx)("div",{className:"overview-window",ref:this.onSetRootDom,children:(0,t.jsx)("div",{className:"overview-mask",children:(0,t.jsx)("div",{className:"overview-focus",style:a,onMouseDown:this.onMouseDownOverviewFocusDom})})}),(0,t.jsx)(s.Button,{className:"overview-map-arrow-icon-btn",title:c,icon:!0,onClick:this.onClickArrowIcon,children:(0,t.jsx)(s.SVG,{className:"overview-map-arrow-icon",src:p,size:14,color:"var(--sys-color-action-text)"})})]})}componentDidMount(){document.body.addEventListener("mousemove",this.onBodyMouseMove,!1),document.body.addEventListener("mouseup",this.onBodyMouseUp,!1),this.loadAPIModules()}componentDidUpdate(e,t){const i=(null==t?void 0:t.apiLoaded)!==this.state.apiLoaded,o=(null==e?void 0:e.jimuMapView)||null,s=this.props.jimuMapView||null;(i||o!==s)&&this.tryCreateNewSmallView()}componentWillUnmount(){this.unmounted=!0,document.body.removeEventListener("mousemove",this.onBodyMouseMove,!1),document.body.removeEventListener("mouseup",this.onBodyMouseUp,!1),this.destroySmallView()}loadAPIModules(){return ct(this,void 0,void 0,function*(){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/Map","esri/views/MapView","esri/Basemap","esri/core/reactiveUtils"]);this.Map=e[0],this.MapView=e[1],this.Basemap=e[2],this.reactiveUtils=e[3],this.setState({apiLoaded:!0})})}tryCreateNewSmallView(){return ct(this,void 0,void 0,function*(){var e,t;if(!this.rootDom)return;if(!this.state.apiLoaded)return;const i=this.props.jimuMapView;if(!i)return void this.destroySmallView();const o=null===(t=null===(e=i.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.basemap;if(!o)return console.warn(`jimuMapView ${i.id} doesn't have basemap`),void this.destroySmallView();if(this.isMainJimuMapViewExpected(this.boundMainJimuMapView)&&this.isMainBasemapExpected(this.boundMainBasemap)&&this.state.smallViewStatus!==gt.Initial)return;if(this.destroySmallView(),!this.state.isOpened)return;const s=document.createElement("div");s.className="overview-map-container",this.rootDom.firstChild?this.rootDom.insertBefore(s,this.rootDom.firstChild):this.rootDom.appendChild(s),this.setState({smallViewStatus:gt.Creating}),this.boundMainJimuMapView=i,this.boundMainBasemap=o,yield i.whenJimuMapViewLoaded();const a=o.toJSON(),n=this.Basemap.fromJSON(a),l=new this.Map({basemap:n}),r=this.calSmallViewExtentByMainViewExtent(i.view),p=new this.MapView({container:s,map:l,extent:r,popupEnabled:!1,constraints:{rotationEnabled:!1,snapToZoom:!1},navigation:{browserTouchPanEnabled:!1,momentumEnabled:!1,actionMap:{mouseWheel:"none"}}});p.ui.components=[];let c=null;try{yield p.when()}catch(e){c=e,console.error("can not create MapView for OverviewMap tool",e)}this.isMainJimuMapViewExpected(i)&&this.isMainBasemapExpected(o)?c?(this.smallView=null,this.setState({smallViewStatus:gt.CreateError})):(this.smallView=p,this.bindEventsToUpdateOverview(),this.setState({smallViewStatus:gt.Created})):s.parentElement&&s.parentElement.removeChild(s)})}isMainJimuMapViewExpected(e){return e&&e===this.props.jimuMapView}isMainBasemapExpected(e){var t,i,o;return e&&e===(null===(o=null===(i=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.map)||void 0===o?void 0:o.basemap)}destroySmallView(){if(this.releaseHandles(),this.focusExtent=null,this.tempFixedFocusExtent=null,this.boundMainJimuMapView=null,this.boundMainBasemap=null,this.unmounted||this.setState({smallViewStatus:gt.Initial}),this.smallView){const e=this.smallView.container;this.smallView.destroyed||this.smallView.destroy(),e&&e.parentElement&&e.parentElement.removeChild(e),this.smallView=null}}releaseHandles(){this.watchMainViewBasemapChangeHandle&&(this.watchMainViewBasemapChangeHandle.remove(),this.watchMainViewBasemapChangeHandle=null),this.watchMainViewExtentChangeHandle&&(this.watchMainViewExtentChangeHandle.remove(),this.watchMainViewExtentChangeHandle=null),this.watchSmallViewExtentChangeHandle&&(this.watchSmallViewExtentChangeHandle.remove(),this.watchSmallViewExtentChangeHandle=null)}bindEventsToUpdateOverview(){this.releaseHandles();const e=this.boundMainJimuMapView.view,t=this.smallView;this.watchMainViewBasemapChangeHandle=this.reactiveUtils.watch(()=>{var t;return null===(t=null==e?void 0:e.map)||void 0===t?void 0:t.basemap},()=>{this.tryCreateNewSmallView()}),this.watchMainViewExtentChangeHandle=this.reactiveUtils.watch(()=>null==e?void 0:e.extent,()=>{this.onMainViewExtentChange()}),this.watchSmallViewExtentChangeHandle=this.reactiveUtils.watch(()=>null==t?void 0:t.extent,()=>{this.updateOverviewFocusByMainViewExtent()}),this.onMainViewExtentChange(),this.updateOverviewFocusByMainViewExtent()}onMainViewExtentChange(){if(!this.boundMainJimuMapView||!this.smallView)return;if(this.mouseDownOffsetXY)return;const e=this.calSmallViewExtentByMainViewExtent(this.boundMainJimuMapView.view);this.smallView.extent=e,this.updateOverviewFocusByMainViewExtent()}calSmallViewExtentByMainViewExtent(e){return this.getHandledMainViewExtent(e).clone().expand(3)}getHandledMainViewExtent(e){let t=null;if("2d"===e.type&&0!==e.rotation){const[i,o]=e.size,s=e.toMap({x:0,y:0}),a=e.toMap({x:i,y:0}),n=e.toMap({x:i,y:o}),l=e.toMap({x:0,y:o}),r=[s.x,a.x,n.x,l.x],p=[s.y,a.y,n.y,l.y],c=Math.min(...r),d=Math.max(...r),h=Math.min(...p),u=Math.max(...p);t=e.extent.clone(),t.xmin=c,t.xmax=d,t.ymin=h,t.ymax=u}else t=e.extent.clone();return t}mixinUpdateOverviewFocusDomStyle(e){const t=Object.assign({},this.state.overviewFocusDomStyle,e);this.setState({overviewFocusDomStyle:t})}updateOverviewFocusByMainViewExtent(){const e=this.boundMainJimuMapView.view,t=(this.tempFixedFocusExtent||this.getHandledMainViewExtent(e)).clone();this.updateOverviewFocusDomPosition(t)}updateOverviewFocusDomPosition(e){const t=this.smallView;this.focusExtent=e.clone();const i=this.focusExtent.center.clone(),o=i.clone();o.x=this.focusExtent.xmin,o.y=this.focusExtent.ymax;const s=i.clone();s.x=this.focusExtent.xmax,s.y=this.focusExtent.ymin;const a=t.toScreen(o),n=t.toScreen(s);let l=!1;const[r,p]=t.size;if(a&&n){const e=a.x<n.x,t=a.y<n.y;if(e&&t){l=!(a.x<0&&n.x>r&&a.y<0&&n.y>p)}}const c={transform:"none"};if(l){const e=n.x-a.x,t=n.y-a.y;c.left=`${a.x}px`,c.top=`${a.y}px`,c.width=`${e}px`,c.height=`${t}px`,c.display="block"}else c.display="none";this.mixinUpdateOverviewFocusDomStyle(c)}getMouseEventRelativePosition(e,t){const{offsetX:i,offsetY:o}=e;if(e.target===t)return[i,o];const s=t.getBoundingClientRect();return[e.clientX-s.x,e.clientY-s.y]}}},wt=vt;class ft extends Y{render(){const e=wt[this.props.toolName];let o=!0;if(o=!!e&&(!e.isAvailable||e.isAvailable(this.props)),o){const o=this.props.toolName,s=`exbmap-ui exbmap-ui-tool-shell divitem exbmap-ui-tool-shell-${o}`,a=this.props.layoutConfig.elements[o],n=a.style||{},l=this.props.toolOptions&&this.props.toolOptions[o]||null;return(0,t.jsx)("div",{className:(0,i.classNames)(this.props.className,s,a.className,{"exbmap-ui-hidden-element":this.props.isHidden,"rounded-pill":["Compass"].includes(o)}),style:n,children:(0,t.jsx)(e,{mapWidgetId:this.props.mapWidgetId,toolJson:a,toolName:o,selfToolOptions:l,isMobile:this.props.isMobile,jimuMapView:this.props.jimuMapView,activeToolInfo:this.props.activeToolInfo,onActiveToolInfoChange:this.props.onActiveToolInfoChange,intl:this.props.intl,theme:this.props.theme,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper})})}return this.props.isMobile?(0,t.jsx)("span",{}):null}}class yt extends Y{getStyle(){const e=this.props.layoutConfig.elements[this.props.groupName],t=e.direction,o=this.props.isRTL,s="vertical"===t;let a="";a=s?"column":o?"row-reverse":"row";let n="flex-start";return s&&(e.isVerticalRrlAlignItemsStart&&(n=o?"flex-end":"flex-start"),e.isVerticalRrlAlignItemsEnd&&(n=o?"flex-start":"flex-end")),i.css`

      display: flex;
      flex-flow: ${a};
      align-items: ${n};

      .exbmap-ui-group-expand-icon {
        fill: black;
        left: 8px;
        top: 8px;
        position: absolute;
        display: block;
      }

      .expand-mobile-panel {
        box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 2px;
        border-radius: 10px 10px 0px 0px;
      }

      .expand-mobile-panel-transition {
        transition: height 0.3s;
      }

      .expand-mobile-panel-touch-container {
        top: 0;
        position: absolute;
        width: 100%;
        height: 31px;
      }

      .expand-mobile-panel-bar {
        width: 36px;
        height: 4px;
        background-color: #434343;
        border-radius: 2px;
      }
      `}constructor(e){super(e),this.reactResizeDetectorRef=i.React.createRef(),this.groupConRef=i.React.createRef(),this.checkIsHiddenElement=e=>!!this.props.hiddenElementNames&&!!this.props.hiddenElementNames.includes(e),this.checkResponsive=()=>{if(!this.props.onSetHiddenElementNames)return;if(!this.props.isMainGroup||!this.props.isMobile)return void this.props.onSetHiddenElementNames([]);const e=this.props.layoutConfig.mobileResponsiveStrategy,t=this.state.widgetHeight;let i=[];t>=465?i=[]:t>=400&&t<465?i=(null==e?void 0:e.stage1)||[]:t>=320&&t<400?i=(null==e?void 0:e.stage2)||[]:t>=250&&t<320?i=(null==e?void 0:e.stage3)||[]:t>=160&&t<250?i=(null==e?void 0:e.stage4)||[]:t>=54&&t<160?i=(null==e?void 0:e.stage5)||[]:t<54&&(i=(null==e?void 0:e.stage6)||[]),this.props.onSetHiddenElementNames(i)},this.onResize=({width:e,height:t})=>{e&&t&&this.setState({widgetWidth:e,widgetHeight:t},()=>{this.checkResponsive()})},this.returnNullNode=e=>this.props.isMobile?(0,t.jsx)("span",{},e):null,this.checkIsLastElement=(e,t)=>{const i=t.toolName,o=this.props.layoutConfig,s=o.layout[e.groupName].children,a=s.indexOf(i);if(a===s.length-1)return!0;if(a<s.length-1){let e=!0;for(let t=a+1;t<s.length;t++){const i=s[t];if("GROUP"!==o.elements[s[t]].type&&(!wt[i].getIsNeedSetting()||this.props.toolConfig&&this.props.toolConfig[`can${i}`]||o.lockToolNames&&o.lockToolNames.includes(i))){e=!1;break}}return e}},this.handleToggleMobilePanel=()=>{this.props.onActiveToolInfoChange(null)},this.handlePanelHeightChange=({width:e,height:t})=>{this.setState({bottomPanelHeight:t},()=>{this.checkResponsive()})},this.getMobilePanelInContext=()=>(0,t.jsx)(R.Consumer,{children:({mobilePanelContainer:e,mapWidgetId:i})=>(0,t.jsx)(s.MobilePanel,{className:`map-tool-mobile-panel ${this.props.mapRootClassName}`,mapWidgetId:i,title:this.props.activeToolInfo&&this.props.activeToolInfo.activeToolTitle,open:!!this.props.activeToolInfo,onClose:()=>{this.handleToggleMobilePanel()},children:(0,t.jsx)("div",{className:"w-100 h-100",ref:t=>{e&&t&&t.appendChild(e)}})})}),this.getGroupContent=e=>{if(e){const o=e.layout[this.props.groupName]&&e.layout[this.props.groupName].children;if(this.checkIsShowGroup(e,o)){const s=(0,i.classNames)(`exbmap-ui exbmap-ui-group exbmap-ui-group-${this.props.groupName}`,this.props.className,{"exbmap-ui-hidden-element":this.props.isHidden}),a=this.props.layoutConfig.elements[this.props.groupName].style||{};return(0,t.jsxs)("div",{id:this.props.isMainGroup?this.props.mapWidgetId:void 0,css:this.getStyle(),className:s,style:a,ref:this.groupConRef,children:[o.map((i,o)=>{var s,a;if(!e.elements[i])return this.returnNullNode(o);if("GROUP"===e.elements[i].type)return(0,t.jsx)(yt,{mapWidgetId:this.props.mapWidgetId,isHidden:this.checkIsHiddenElement(i),className:e.elements[i].className,style:e.elements[i].style,layoutConfig:e,toolConfig:this.props.toolConfig,toolOptions:this.props.toolOptions,isMobile:this.props.isMobile,intl:this.props.intl,jimuMapView:this.props.jimuMapView,groupName:i,activeToolInfo:this.props.activeToolInfo,hiddenElementNames:this.props.hiddenElementNames,onActiveToolInfoChange:this.props.onActiveToolInfoChange,theme:this.props.theme,isThumbMap:this.props.isMainGroup?this.state.isThumbMap:this.props.isThumbMap,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper},o);if("TOOL"===e.elements[i].type){const n=e.elements[i].toolName,l=null===(a=null===(s=this.props.jimuMapView)||void 0===s?void 0:s.view)||void 0===a?void 0:a.type;return"Navigation"===n&&"2d"===l||"ScaleBar"===n&&"3d"===l?this.returnNullNode(o):!wt[i].getIsNeedSetting()||this.props.toolConfig&&this.props.toolConfig[`can${i}`]||e.lockToolNames&&e.lockToolNames.includes(i)?(0,t.jsx)(ft,{mapWidgetId:this.props.mapWidgetId,isHidden:this.checkIsHiddenElement(i),layoutConfig:e,activeToolInfo:this.props.activeToolInfo,toolConfig:this.props.toolConfig,toolOptions:this.props.toolOptions,jimuMapView:this.props.jimuMapView,toolName:i,theme:this.props.theme,onActiveToolInfoChange:this.props.onActiveToolInfoChange,intl:this.props.intl,isMobile:this.props.isMobile,isLastElement:this.checkIsLastElement(e.elements[this.props.groupName],e.elements[i]),autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper},o):this.returnNullNode(o)}return this.returnNullNode(o)}),this.props.isMainGroup&&this.props.isMobile&&(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.groupConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize}),this.props.isMainGroup&&this.props.isMobile&&this.props.activeToolInfo&&"Select"!==this.props.activeToolInfo.activeToolName&&this.getMobilePanelInContext(),this.props.isMainGroup&&(0,t.jsx)("div",{className:"exbmap-ui w-100",style:{position:"relative",pointerEvents:"auto",overflow:"hidden",touchAction:"none",display:!this.props.isMobile||this.state.isThumbMap||this.props.isThumbMap?"none":"block"},children:(0,t.jsx)("div",{className:`${this.props.mapWidgetId}-bottom-panel exbmap-ui w-100 expand-mobile-panel`,style:{overflow:"hidden",pointerEvents:"auto",position:"relative",touchAction:"none"},children:(0,t.jsx)("div",{className:"w-100 h-100",ref:this.reactResizeDetectorRef,children:(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.reactResizeDetectorRef,handleHeight:!0,onResize:this.handlePanelHeightChange})})})})]})}return this.returnNullNode()}return this.returnNullNode()},this.checkIsShowGroup=(e,t)=>{if(t&&0!==t.length){const i=[];this.findAllToolNames(e,t,i);let o=!1;for(let t=0;t<i.length;t++)if(this.props.toolConfig[`can${i[t]}`]||!wt[i[t]].getIsNeedSetting()||e.lockToolNames&&e.lockToolNames.includes(i[t])){o=!0;break}return o}return!1},this.findAllToolNames=(e,t,i)=>{if(t&&0!==t.length)for(let o=0;o<t.length;o++){const s=t[o],a=e.elements[s];if("GROUP"===a.type){const t=a.groupName;this.findAllToolNames(e,e.layout[t]&&e.layout[t].children,i)}else i.push(t[o])}},this.state={bottomPanelHeight:0,isThumbMap:!!this.props.isMobile}}componentDidMount(){this.checkResponsive()}render(){return this.props.isMainGroup&&this.props.isMobile&&this.props.toolConfig&&this.props.toolConfig.canSelect?(0,t.jsx)("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:0},children:(0,t.jsx)("div",{id:`${this.props.mapWidgetId}-with-select-container`,style:{position:"absolute",top:0,left:0,bottom:0,right:0},children:(0,t.jsx)("div",{className:"w-100 h-100",style:{position:"relative"},children:this.getGroupContent(this.props.layoutConfig)})})}):this.getGroupContent(this.props.layoutConfig)}}class Mt extends i.React.PureComponent{constructor(e){super(e),this.getMaxHeightForPcExpand=e=>{if(e){if(e<65)return null;{const t=e-65;return t<300?t:300}}return null},this.handSetHiddenElementNames=e=>{this.setState({hiddenElementNames:e})},this.state={toolsContentInMobileExpandPanel:null,hiddenElementNames:[]}}getStyle(){return i.css`
      z-index: 8;
      pointer-events: none;

      .expand-panel-transition {
        transition: opacity 0.3s, right 0.3s;
      }

      .scale-attribution-xy-group {
        > div:first-of-type:nth-last-of-type(1) {
          width: 100%;
          max-width: 100% !important;
        }
      }

      .exbmap-ui-hidden-element {
        display: none !important;
      }

      .exbmap-ui-pc-expand-maxheight {
        max-height: ${this.getMaxHeightForPcExpand(this.props.widgetHeight)}px;
        overflow: auto
      }
      `}getLayoutContent(e){return e&&this.props.toolConfig?(0,t.jsx)("div",{className:"exbmap-ui esri-ui-inner-container map-tool-layout",css:this.getStyle(),children:Object.keys(e.layout).map((o,s)=>{var a;const n=e.elements[o],l=e.layout[o];if(!n||"GROUP"!==n.type||!l.isMainGroup)return null;const r=(0,i.getAppStore)().getState(),p=(null===(a=null==r?void 0:r.appContext)||void 0===a?void 0:a.isRTL)||!1;return(0,t.jsx)(yt,{mapWidgetId:this.props.mapWidgetId,className:n.className,style:n.style,isMobile:this.props.isMobile,isMainGroup:!0,layoutConfig:e,toolConfig:this.props.toolConfig,toolOptions:this.props.toolOptions,activeToolInfo:this.props.activeToolInfo,jimuMapView:this.props.jimuMapView,groupName:o,onActiveToolInfoChange:this.props.onActiveToolInfoChange,hiddenElementNames:e.mobileResponsiveStrategy&&this.state.hiddenElementNames,intl:this.props.intl,onSetHiddenElementNames:this.handSetHiddenElementNames,theme:this.props.theme,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:p,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper},s)})}):null}componentDidUpdate(e){e.appMode!==this.props.appMode&&this.props.appMode===i.AppMode.Design&&this.props.onActiveToolInfoChange(null)}render(){return this.getLayoutContent(this.props.layoutConfig)}}const St=[{elements:{leftTopContainer:{type:"GROUP",groupName:"leftTopContainer",direction:"horizontal",style:{position:"absolute",top:"15px",left:"15px"}},navigator:{type:"GROUP",groupName:"navigator",direction:"vertical",style:{marginRight:"10px"}},interact:{type:"GROUP",groupName:"interact",direction:"vertical",isResponsive:!0,style:{position:"absolute",top:"15px",right:"15px"}},bottom:{type:"GROUP",groupName:"bottom",direction:"vertical",className:"w-100",style:{position:"absolute",bottom:"0px",left:"0px"}},"bottom-line1":{type:"GROUP",groupName:"bottom-line1",direction:"horizontal",className:"d-flex align-items-center justify-content-between w-100 scale-attribution-xy-group",style:{marginBottom:"0px",marginTop:"0px"}},"bottom-line2":{type:"GROUP",groupName:"bottom-line2",direction:"horizontal",className:"d-flex align-items-end justify-content-between w-100",style:{paddingLeft:"15px",paddingRight:"15px",marginBottom:"10px"}},"SelectState-FullScreen-Container":{type:"GROUP",groupName:"SelectState-FullScreen-Container",direction:"vertical",isVerticalRrlAlignItemsEnd:!0},attributionGroup:{type:"GROUP",groupName:"attributionGroup",direction:"horizontal",style:{maxWidth:"60%"}},overviewMapContainer:{type:"GROUP",groupName:"overviewMapContainer",direction:"horizontal",style:{position:"absolute",right:"0px",bottom:"16px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1},Navigation:{type:"TOOL",toolName:"Navigation",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!0},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginBottom:"10px"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start"},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginLeft:"6px"}},Attribution:{type:"TOOL",toolName:"Attribution",isOnlyExpanded:!0,isShowIconTitle:!1,className:"w-100"},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},OverviewMap:{type:"TOOL",toolName:"OverviewMap",isOnlyExpanded:!0,isShowIconTitle:!1,isSecondLayout:!1}},layout:{leftTopContainer:{isMainGroup:!0,children:["navigator","Select"]},navigator:{children:["Zoom","Home","Navigation","ExtentNavigate","Locate","Compass"]},interact:{isMainGroup:!0,children:["Search","Layers","BaseMap","Measure"]},"bottom-line1":{children:["ScaleBar","attributionGroup"]},"bottom-line2":{children:["MapSwitch","SelectState-FullScreen-Container"]},"SelectState-FullScreen-Container":{children:["FullScreen","ClearActionData","SelectState"]},bottom:{isMainGroup:!0,children:["bottom-line2","bottom-line1"]},attributionGroup:{children:["Attribution"]},overviewMapContainer:{isMainGroup:!0,children:["OverviewMap"]}}},{elements:{navigator:{type:"GROUP",groupName:"navigator",direction:"vertical",isVerticalRrlAlignItemsEnd:!0},interact:{type:"GROUP",groupName:"interact",direction:"horizontal",isResponsive:!0,style:{position:"absolute",top:"15px",left:"15px"}},fullScreenGroup:{type:"GROUP",groupName:"fullScreenGroup",direction:"horizontal",style:{position:"absolute",top:"15px",right:"15px"}},bottom:{type:"GROUP",groupName:"bottom",direction:"vertical",className:"w-100",style:{position:"absolute",bottom:"0px",left:"0px"}},"bottom-line1":{type:"GROUP",groupName:"bottom-line1",direction:"horizontal",className:"d-flex align-items-center justify-content-between w-100 scale-attribution-xy-group",style:{marginBottom:"0px",marginTop:"0px"}},"bottom-line2":{type:"GROUP",groupName:"bottom-line2",direction:"horizontal",className:"d-flex align-items-end justify-content-between w-100",style:{paddingLeft:"15px",paddingRight:"15px",marginBottom:"10px"}},attributionGroup:{type:"GROUP",groupName:"attributionGroup",direction:"horizontal",style:{maxWidth:"60%"},className:"attibute-group"},overviewMapContainer:{type:"GROUP",groupName:"overviewMapContainer",direction:"horizontal",style:{position:"absolute",right:"0px",top:"0px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1},Navigation:{type:"TOOL",toolName:"Navigation",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginTop:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!0},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginLeft:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginLeft:"6px"}},Attribution:{type:"TOOL",toolName:"Attribution",isOnlyExpanded:!0,isShowIconTitle:!1,className:"w-100"},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},OverviewMap:{type:"TOOL",toolName:"OverviewMap",isOnlyExpanded:!0,isShowIconTitle:!1,isSecondLayout:!0}},layout:{navigator:{children:["Compass","Locate","ExtentNavigate","Navigation","Zoom","Home","SelectState"]},interact:{isMainGroup:!0,children:["Search","Layers","BaseMap","Measure","Select"]},fullScreenGroup:{isMainGroup:!0,children:["FullScreen","ClearActionData"]},"bottom-line1":{children:["ScaleBar","attributionGroup"]},"bottom-line2":{children:["MapSwitch","navigator"]},bottom:{isMainGroup:!0,children:["bottom-line2","bottom-line1"]},attributionGroup:{children:["Attribution"]},overviewMapContainer:{isMainGroup:!0,children:["OverviewMap"]}}}],bt=[{elements:{mainGroup:{type:"GROUP",groupName:"mainGroup",direction:"vertical",className:"d-flex flex-column",style:{position:"absolute",top:"0px",left:"0px",bottom:"0px",right:"0px"}},topGroup:{type:"GROUP",groupName:"topGroup",direction:"horizontal",className:"d-flex w-100 align-items-center justify-content-between",style:{padding:"10px 10px 0 10px"}},midGroup:{type:"GROUP",groupName:"midGroup",direction:"horizontal",className:"flex-grow-1 d-flex w-100 justify-content-between",style:{position:"relative"}},bottomGroup:{type:"GROUP",groupName:"bottomGroup",direction:"horizontal",className:"d-flex w-100 align-items-center justify-content-between"},"midGroup-left-top":{type:"GROUP",groupName:"midGroup-left-top",direction:"vertical",style:{position:"absolute",left:"0px",top:"0px"}},"midGroup-left-bottom":{type:"GROUP",groupName:"midGroup-left-bottom",direction:"vertical",className:"d-flex flex-column",isVerticalRrlAlignItemsStart:!0,style:{position:"absolute",left:"0px",bottom:"0px"}},"midGroup-right-content-top":{type:"GROUP",groupName:"midGroup-right-content-top",direction:"vertical",style:{position:"absolute",top:"0px",right:"10px"}},"midGroup-right-content-bottom":{type:"GROUP",groupName:"midGroup-right-content-bottom",direction:"vertical",style:{position:"absolute",bottom:"10px",right:"10px"}},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!0,isShowIconTitle:!1,className:"flex-grow-1"},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0,style:{marginLeft:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1,className:"mb-0",style:{marginLeft:"10px",marginTop:"10px"}},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginLeft:"10px",marginBottom:"10px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginLeft:"10px",marginBottom:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{width:"100%"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginLeft:"6px"}}},layout:{mainGroup:{isMainGroup:!0,children:["topGroup","midGroup","bottomGroup"]},topGroup:{children:["Search","FullScreen"]},midGroup:{children:["midGroup-left-top","midGroup-left-bottom","midGroup-right-content-top","midGroup-right-content-bottom"]},"midGroup-left-top":{children:["Compass"]},"midGroup-left-bottom":{children:["ExtentNavigate","MapSwitch","ScaleBar"]},"midGroup-right-content-top":{children:["Layers","BaseMap","Measure","Select"]},"midGroup-right-content-bottom":{children:["Zoom","Home","Locate","ClearActionData"]},bottomGroup:{children:["SelectState"]}},mobileResponsiveStrategy:{stage1:["Measure","Locate"],stage2:["Measure","Select","Locate","bottomGroup"],stage3:["ExtentNavigate","midGroup-right-content-top","Locate","bottomGroup"],stage4:["MapSwitch","midGroup-right-content-top","Home","Locate","ClearActionData","bottomGroup"],stage5:["midGroup","bottomGroup"],stage6:["topGroup","midGroup","bottomGroup"]},lockToolNames:[]}];var xt=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const It={firstMapVisible:[{zIndex:"unset",opacity:1},{zIndex:-1,opacity:0}],secondMapVisible:[{zIndex:-1,opacity:0},{zIndex:"unset",opacity:1}]};class Ct extends i.React.PureComponent{constructor(e){super(e),this.mutableStatePropsMap={},this.__unmount=!1,this.dateOfMouseOverPopper=null,this.dateOfMouseOutPopper=null,this.onPageChange=(e,t)=>{e&&t&&e!==t&&this.setState({activeToolInfo:null})},this.onResize=({width:e,height:t})=>{let i=!1;const o=Date.now();if(this.dateOfMouseOverPopper){o-this.dateOfMouseOverPopper.getTime()<=100&&(i=!0)}if(this.dateOfMouseOutPopper){o-this.dateOfMouseOutPopper.getTime()<=100&&(i=!0)}i&&e>0&&t>0||this.setState({activeToolInfo:null})},this.onMouseOverPopper=()=>{this.dateOfMouseOverPopper=new Date},this.onMouseOutPopper=()=>{this.dateOfMouseOutPopper=new Date},this.reInitWidgetInstance=e=>{this.state=e,this.isReIniting=!0},this.changeInitialMapDataSourceID=(e,t)=>{var i,o;if(this.props.baseWidgetProps.useDataSources&&this.props.baseWidgetProps.useDataSources.length>1){const s=null===(i=this.firstMapInstance)||void 0===i?void 0:i.current,a=null===(o=this.secondMapInstance)||void 0===o?void 0:o.current;if(!s||!a)return void(t&&t());this.state.currentMapIndex?this.state.firstMapDsId&&this.state.firstMapDsId===e?(this.startChangeInitialMapAnimation(t),s.goHome(!1)):a.goHome(!1):this.state.secondMapDsId&&this.state.secondMapDsId===e?(this.startChangeInitialMapAnimation(t),a.goHome(!1)):s.goHome(!1)}},this.startChangeInitialMapAnimation=e=>{var t,i;const o=null===(t=this.firstMapInstance)||void 0===t?void 0:t.current,s=null===(i=this.secondMapInstance)||void 0===i?void 0:i.current;if(!o||!s)return void(e&&e());const a=Object.assign({},this.state);if(this.state.currentMapIndex){a.currentMapIndex=0,a.multiMapStyle=It.firstMapVisible;const t=s.getViewPoint();t&&o.setViewPoint(t),this.setState(a,()=>{e&&e()})}else{a.currentMapIndex=1,a.multiMapStyle=It.secondMapVisible;const t=o.getViewPoint();t&&s.setViewPoint(t),this.setState(a,()=>{e&&e()})}},this.switchMap=(...e)=>xt(this,[...e],void 0,function*(e=!1){var t,i;if(!this.props.baseWidgetProps.useDataSources||this.props.baseWidgetProps.useDataSources.length<2)return void(yield Promise.resolve());const s=null===(t=this.firstMapInstance)||void 0===t?void 0:t.current,a=null===(i=this.secondMapInstance)||void 0===i?void 0:i.current;if(!s||!a)return;const n=Object.assign({},this.state);if(n.useAnimation=!e,this.state.currentMapIndex){n.currentMapIndex=0,n.multiMapStyle=It.firstMapVisible;const e=a.getViewPoint();e&&s.setViewPoint(e)}else{n.currentMapIndex=1,n.multiMapStyle=It.secondMapVisible;const e=s.getViewPoint();e&&a.setViewPoint(e)}return new Promise((e,t)=>{this.setState(n,()=>{var t;const i=o.MapViewManager.getInstance(),s=null===(t=this.props.baseWidgetProps)||void 0===t?void 0:t.widgetId,a=s&&i.getJimuMapViewGroup(s),n=a&&a.getActiveJimuMapView()||null;this.confirmJimuMapViewIsActive();const l=a&&a.getActiveJimuMapView()||null;l&&l!==n&&E(l),setTimeout(()=>{this.setState({useAnimation:!1},()=>{e(null)})},500)})})}),this.handleMutableStatePropsChanged=(e,t,o)=>{var s,a;this.mutableStatePropsMap[t]?this.mutableStatePropsMap[t].includes(e)||this.mutableStatePropsMap[t].push(e):this.mutableStatePropsMap[t]=[e];const n=[],l=null===(s=this.firstMapInstance)||void 0===s?void 0:s.current,r=null===(a=this.secondMapInstance)||void 0===a?void 0:a.current;l&&l.getViewType()&&n.push(this.state.firstMapDsId),r&&r.getViewType()&&n.push(this.state.secondMapDsId);let p=!0;for(let e=0;e<n.length;e++)if(!this.mutableStatePropsMap[t].includes(n[e])){p=!1;break}p&&(delete this.mutableStatePropsMap[t],i.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,t,o))},this.onMapbaseExtentChanged=(e,t)=>{var o,s;if(this.getCurrentVisibleDsId()===e){const a=t.viewpoint.clone();i.MessageManager.getInstance().publishMessage(t);let n=null;this.state.firstMapDsId&&this.state.firstMapDsId!==e?n=null===(o=this.firstMapInstance)||void 0===o?void 0:o.current:this.state.secondMapDsId&&this.state.secondMapDsId!==e&&(n=null===(s=this.secondMapInstance)||void 0===s?void 0:s.current),n&&n.setViewPoint(a)}},this.handleMapLoaded=(e,t)=>{this.forceUpdate()},this.handleJimuMapViewCreated=e=>{this.props.onJimuMapViewCreated&&this.props.onJimuMapViewCreated(e),this.__unmount||this.confirmJimuMapViewIsActive()},this.confirmJimuMapViewIsActive=()=>{if(this.props.isDefaultMap){const e=this.getJimuMapViewByDataSourceId(null);return void(e&&this.setActiveJimuMapView(e,!0))}const e=[];this.state.firstMapDsId&&e.push(this.state.firstMapDsId),this.state.secondMapDsId&&e.push(this.state.secondMapDsId);const t=this.getCurrentVisibleDsId();for(let i=0;i<e.length;i++){const o=this.getJimuMapViewByDataSourceId(e[i]);o&&(e[i]===t?this.setActiveJimuMapView(o,!0):this.setActiveJimuMapView(o,!1))}},this.isShowMapSwitchBtn=()=>{var e,t;const i=null===(e=this.firstMapInstance)||void 0===e?void 0:e.current,o=null===(t=this.secondMapInstance)||void 0===t?void 0:t.current;return!(!i||!o)&&(i.getMapLoadStatus()!==_.Loading&&o.getMapLoadStatus()!==_.Loading||void 0)},this.getCurrentVisibleDsId=()=>1===this.state.multiMapStyle[0].opacity?this.state.firstMapDsId:this.state.secondMapDsId,this.handleViewGroupCreate=e=>{this.props.onViewGroupCreate&&this.props.onViewGroupCreate(e)},this.handleMobilePanelContentChange=e=>{this.setState({mobilePanelContent:e})},this.handleActiveToolInfoChange=e=>{this.setState({activeToolInfo:e})},this.domRef=i.React.createRef(),this.firstMapInstance=i.React.createRef(),this.secondMapInstance=i.React.createRef();const t=this.props.baseWidgetProps.id;"number"==typeof Ct.runtimeInitedMapWidgets[t]?Ct.runtimeInitedMapWidgets[t]+=1:Ct.runtimeInitedMapWidgets[t]=1;const s=i.MutableStoreManager.getInstance().getStateValue([this.props.baseWidgetProps.id,"restoreData",`${this.props.baseWidgetProps.id}-restoreData-multimap`]);if(s){const e=document.createElement("div");e.id=`${this.props.baseWidgetProps.id}-bottom-panel`,e.className="w-100 h-100",s.mobilePanelContainer=e,this.reInitWidgetInstance(s),i.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${this.props.baseWidgetProps.id}-restoreData-multimap`,null)}else{const e=document.createElement("div");e.id=`${this.props.baseWidgetProps.id}-bottom-panel`,e.className="w-100 h-100",this.state={currentMapIndex:0,multiMapStyle:It.firstMapVisible,firstMapDsId:null,secondMapDsId:null,useAnimation:!1,useDataSources:null,currentJimuMapViewId:null,mobilePanelContent:null,mobilePanelContainer:e,activeToolInfo:null}}this.mutableStatePropsMap={},this.useMapWidgetIds=this.props.baseWidgetProps.id?(0,i.Immutable)([this.props.baseWidgetProps.id]):(0,i.Immutable)([]),(0,i.observeStore)(this.onPageChange,["appRuntimeInfo","currentPageId"])}componentDidMount(){if((0,i.getAppStore)().getState().mapWidgetsInfo&&((0,i.getAppStore)().getState().mapWidgetsInfo[this.props.baseWidgetProps.id]||(0,i.getAppStore)().dispatch(i.appActions.MapWidgetInfoAdded(this.props.baseWidgetProps.id,(0,i.Immutable)({mapWidgetId:this.props.baseWidgetProps.id})))),this.__unmount=!1,this.isReIniting)return;const e=this.props.baseWidgetProps.useDataSources;if(e){let t=this.props.baseWidgetProps.config.initialMapDataSourceID;if(this.props.baseWidgetProps.isRunAppMode){const i=this.props.baseWidgetProps.id;if(1===Ct.runtimeInitedMapWidgets[i]){const i=this.props.baseWidgetProps.runtimeUrlHashParams;if(i&&i.active_datasource_id){e.map(e=>e.dataSourceId).includes(i.active_datasource_id)&&(t=i.active_datasource_id)}}}t?t===(e[0]&&e[0].dataSourceId)?this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId}):t===(e[1]&&e[1].dataSourceId)?this.setState({firstMapDsId:e[1]&&e[1].dataSourceId,secondMapDsId:e[0]&&e[0].dataSourceId}):this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId}):this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId})}}componentWillUnmount(){this.__unmount=!0;const e=(0,i.getAppStore)().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].useDataSources===this.props.baseWidgetProps.useDataSources){const e={currentMapIndex:this.state.currentMapIndex,multiMapStyle:this.state.multiMapStyle,firstMapDsId:this.state.firstMapDsId,secondMapDsId:this.state.secondMapDsId,useAnimation:this.state.useAnimation,currentJimuMapViewId:this.state.currentJimuMapViewId};i.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${this.props.baseWidgetProps.id}-restoreData-multimap`,e)}e[this.props.baseWidgetProps.id]||(0,i.getAppStore)().dispatch(i.appActions.MapWidgetInfoRemoved(this.props.baseWidgetProps.id))}static getDerivedStateFromProps(e,t){if(e.baseWidgetProps.useDataSources!==t.useDataSources){return Ct.getChangedState(t.firstMapDsId,t.secondMapDsId,e.baseWidgetProps.useDataSources)}return null}componentDidUpdate(e,t,o){var s,a;if(this.props.baseWidgetProps.stateProps&&this.props.baseWidgetProps.stateProps.initialMapDataSourceID){const e=this.props.baseWidgetProps.stateProps.initialMapDataSourceID;if(this.state.firstMapDsId===e){const e=null===(s=this.firstMapInstance)||void 0===s?void 0:s.current;e&&e.goHome(!1)}if(this.state.secondMapDsId===e){const e=null===(a=this.secondMapInstance)||void 0===a?void 0:a.current;e&&e.goHome(!1)}this.props.baseWidgetProps.dispatch(i.appActions.widgetStatePropChange(this.props.baseWidgetProps.id,"initialMapDataSourceID",null))}this.isReIniting?this.isReIniting=!1:(this.props.baseWidgetProps.config.initialMapDataSourceID!==e.baseWidgetProps.config.initialMapDataSourceID&&this.changeInitialMapDataSourceID(this.props.baseWidgetProps.config.initialMapDataSourceID,this.confirmJimuMapViewIsActive),this.props.baseWidgetProps.useDataSources!==e.baseWidgetProps.useDataSources&&this.confirmJimuMapViewIsActive())}getJimuMapViewByDataSourceId(e){const t=C(this.props.baseWidgetProps.id,e);return o.MapViewManager.getInstance().getJimuMapViewById(t)}setActiveJimuMapView(e,t){var o,s;if(t){e.setIsActive(t),this.setState({currentJimuMapViewId:e.id}),this.props.onActiveJimuMapViewChange&&this.props.onActiveJimuMapViewChange(e);const i=null===(o=this.props)||void 0===o?void 0:o.baseWidgetProps;if(i){let t=(null===(s=i.runtimeUrlHashParams)||void 0===s?void 0:s.active_datasource_id)||i.config.initialMapDataSourceID;if(!t){const e=i.useDataSources;e&&1===e.length&&(t=e[0].dataSourceId)}t||(t="");(e.dataSourceId||"")!==t&&A(e)}}else e.setIsActive(t);const a=function(e){let t=null;return(null==e?void 0:e.container)&&(t=e.container.querySelector(".esri-view-surface")),t}(null==e?void 0:e.view);if(a){const e=t?"0":"-1";if(a.setAttribute("tabindex",e),t){const e=`${i.WIDGET_PREFIX_FOR_A11Y_SKIP}${this.props.baseWidgetProps.widgetId}`;a.setAttribute("id",e)}else a.removeAttribute("id")}}getLayoutConfig(){return"xsmall"===this.props.widthBreakpoint?bt[0]:this.props.baseWidgetProps.config.layoutIndex?St[this.props.baseWidgetProps.config.layoutIndex]:St[0]}render(){var e;const s=this.domRef.current,a=o.MapViewManager.getInstance().getJimuMapViewById(this.state.currentJimuMapViewId);return(0,t.jsx)(R.Provider,{value:{mapWidgetId:this.props.baseWidgetProps.id,mapWidgetHeight:this.props.widgetHeight,isShowMapSwitchBtn:this.props.baseWidgetProps.useDataSources&&this.props.baseWidgetProps.useDataSources.length>1&&this.isShowMapSwitchBtn(),dataSourceIds:[this.state.firstMapDsId,this.state.secondMapDsId],activeDataSourceId:this.getCurrentVisibleDsId(),switchMap:this.switchMap,fullScreenMap:this.props.fullScreenMap,isFullScreen:this.props.isFullScreen,mobilePanelContainer:this.state.mobilePanelContainer,onMobilePanelContentChange:this.handleMobilePanelContentChange,initialMapState:this.props.baseWidgetProps.config&&this.props.baseWidgetProps.config.initialMapState,theme:this.props.baseWidgetProps.theme},children:(0,t.jsxs)("div",{ref:this.domRef,className:"w-100 h-100 multi-source-map",children:[!this.props.isDefaultMap&&(0,t.jsxs)("div",{className:"w-100 h-100 multi-map-container",style:{position:"relative"},children:[(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100 map1",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[0].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[0].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[0].zIndex},children:this.state.firstMapDsId&&this.props.isMapInVisibleArea&&(0,t.jsx)(q,{ref:this.firstMapInstance,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.firstMapDsId,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,multiSourceMapDom:s})}),(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100 map2",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[1].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[1].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[1].zIndex},children:this.state.secondMapDsId&&this.props.isMapInVisibleArea&&(0,t.jsx)(q,{ref:this.secondMapInstance,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.secondMapDsId,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,multiSourceMapDom:s})})]}),this.props.isDefaultMap&&(0,t.jsx)("div",{className:"w-100 h-100 default-map-container",style:{position:"relative"},children:(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100 multisourcemap-item-appear-noanimate default-map-mapbase-container"),style:{position:"absolute",zIndex:"unset"},children:this.props.isMapInVisibleArea&&(0,t.jsx)(q,{ref:this.firstMapInstance,isDefaultMap:this.props.isDefaultMap,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,dataSourceId:null,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,defaultMapInfo:this.props.defaultMapInfo,multiSourceMapDom:s})})}),this.state.currentJimuMapViewId&&(0,t.jsx)(Q,{jimuMapView:a,appMode:this.props.baseWidgetProps.appMode,layouts:this.props.baseWidgetProps.layouts,LayoutEntry:this.props.baseWidgetProps.builderSupportModules&&this.props.baseWidgetProps.builderSupportModules.LayoutEntry,widgetManifestName:this.props.baseWidgetProps.manifest.name}),this.state.currentJimuMapViewId&&a&&(0,t.jsx)(Mt,{mapWidgetId:this.props.baseWidgetProps.id,isMobile:"xsmall"===this.props.widthBreakpoint,jimuMapView:a,appMode:this.props.baseWidgetProps.appMode,layouts:this.props.baseWidgetProps.layouts,intl:this.props.baseWidgetProps.intl,LayoutEntry:this.props.baseWidgetProps.builderSupportModules&&this.props.baseWidgetProps.builderSupportModules.LayoutEntry,layoutConfig:this.getLayoutConfig(),toolConfig:this.props.baseWidgetProps.config.toolConfig?this.props.baseWidgetProps.config.toolConfig:{},toolOptions:this.props.baseWidgetProps.config.toolOptions,activeToolInfo:this.state.activeToolInfo,onActiveToolInfoChange:this.handleActiveToolInfoChange,theme:this.props.baseWidgetProps.theme,widgetManifestName:this.props.baseWidgetProps.manifest.name,widgetHeight:"xsmall"===this.props.widthBreakpoint?null:this.props.widgetHeight,autoControlWidgetId:this.props.autoControlWidgetId,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName,onMouseOverPopper:this.onMouseOverPopper,onMouseOutPopper:this.onMouseOutPopper}),(0,t.jsx)(o.JimuMapViewComponent,{useMapWidgetId:null===(e=this.useMapWidgetIds)||void 0===e?void 0:e[0],onViewGroupCreate:this.handleViewGroupCreate}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.domRef,handleHeight:!0,handleWidth:!0,onResize:this.onResize})]})})}}Ct.runtimeInitedMapWidgets={},Ct.getChangedState=(e,t,i)=>{const o={};if(i&&i[0]){const s=[],a=[];for(let t=0;t<i.length;t++)e!==i[t].dataSourceId?s.push(i[t].dataSourceId):a.push(i[t].dataSourceId);a.length>0?(o.firstMapDsId=e,o.secondMapDsId=s[0]):0===a.length&&(s.includes(t)?(s.splice(s.indexOf(t),1),o.firstMapDsId=s[0],o.secondMapDsId=t):(o.firstMapDsId=s[0],o.secondMapDsId=s[1]))}else o.firstMapDsId=null,o.secondMapDsId=null;return o.firstMapDsId!==e?o.firstMapDsId?(o.multiMapStyle=It.firstMapVisible,o.currentMapIndex=0):o.secondMapDsId?(o.multiMapStyle=It.secondMapVisible,o.currentMapIndex=1):(o.multiMapStyle=It.firstMapVisible,o.currentMapIndex=0):o.secondMapDsId?o.secondMapDsId!==t&&(o.multiMapStyle=It.secondMapVisible,o.currentMapIndex=1):(o.multiMapStyle=It.firstMapVisible,o.currentMapIndex=0),o};const Tt=Ct;class Vt extends i.React.PureComponent{constructor(e){super(e),this.state={defaultMapInfo:null}}componentDidMount(){o.portalUtils.getDefaultWebMap(this.props.baseWidgetProps.portalUrl).then(e=>{this.setState({defaultMapInfo:e})})}render(){return(0,t.jsxs)("div",{className:"w-100 h-100",children:[!this.state.defaultMapInfo&&(0,t.jsx)("div",{className:"widget-map w-100 h-100 widget-map-background",children:(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})}),this.state.defaultMapInfo&&(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100",{"map-is-design-mode":!x(this.props.baseWidgetProps.appMode)}),children:(0,t.jsx)(Tt,{fullScreenMap:this.props.fullScreenMap,baseWidgetProps:this.props.baseWidgetProps,startLoadModules:this.props.startLoadModules,isDefaultMap:!0,ref:this.props.setMultiSourceMapInstance,onViewGroupCreate:this.props.onViewGroupCreate,onJimuMapViewCreated:this.props.onJimuMapViewCreated,onActiveJimuMapViewChange:this.props.onActiveJimuMapViewChange,widgetHeight:this.props.widgetHeight,widthBreakpoint:this.props.widthBreakpoint,isFullScreen:this.props.isFullScreen,isMapInVisibleArea:this.props.isMapInVisibleArea,defaultMapInfo:this.state.defaultMapInfo,autoControlWidgetId:this.props.autoControlWidgetId,mapComponentsLoaded:this.props.mapComponentsLoaded,mapRootClassName:this.props.mapRootClassName},0)})]})}}class Pt extends i.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"1.10.0",upgrader:e=>{let t;return e.toolConifg&&(t=i.Immutable.without(e,"toolConifg"),t=t.set("toolConfig",e.toolConifg)),t||(t=e),t}},{version:"1.16.0",description:'update config.popupDockPosition to "auto" if value is "top-right" for Map widget',upgrader:e=>{let t=e;return"top-right"===e.popupDockPosition&&(t=e.set("popupDockPosition","auto")),t||(t=e),t}}]}}const Lt=new Pt;var Et=r(1888);function At(e,t){var i;if(e||(e=""),!t)return"";const o=t.sys.color.primary.main,s=t.sys.spacing(2),a=t.sys.spacing(4);return`\n    ${e}.exbmap-ui-popper {\n      .exbmap-ui-expand-content {\n        transition: opacity 250ms ease-in-out, margin 250ms ease-in-out;\n        min-height: 10px;\n\n        .exbmap-ui-expand-content-header {\n          padding: ${s} ${a} ${s};\n        }\n\n        .panel-title {\n          font-weight: ${null===(i=null==t?void 0:t.ref.typeface)||void 0===i?void 0:i.fontWeightRegular};\n        }\n\n        .panel-icon { /* <-- Need To use the tertiary button */\n          cursor: pointer;\n          &:hover {\n            color: ${o};\n          }\n        }\n\n        .esri-search {\n          padding: 0 ${a} ${a};\n        }\n\n        .esri-widget {\n          font-family: inherit;\n          background-color: transparent;\n          color: inherit;\n        }\n      }\n\n      [data-popper-placement^='bottom'] {\n        margin-top: 4px !important;\n      }\n\n      [data-popper-placement^='left'] {\n        margin-right: 4px !important;\n      }\n\n      [data-popper-placement^='right'] {\n        margin-left: 4px !important;\n      }\n\n      [data-popper-placement^='top'] {\n        margin-bottom: 4px !important;\n      }\n    }\n  `}var Dt,Nt=function(e,t,i,o){return new(i||(i=Promise))(function(s,a){function n(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,l)}r((o=o.apply(e,t||[])).next())})};const jt="fake-fullscreen-map";class kt extends i.React.PureComponent{constructor(e){super(e),this.container=i.React.createRef(),this.multiSourceMapInstance=null,this.activeJimuMapView=null,this.watchSelectedFeatureHandle=null,this.dataActionListContainer=null,this.reactiveUtils=null,this.popupDomNodeObserver=null,this.startRenderMap=()=>{setTimeout(()=>{this.setState({startLoadModules:!0})},100)},this.getPlaceHolderImage=()=>{let e=this.props.config.placeholderImage;const t=i.SessionManager.getInstance().getMainSession();if(e){new RegExp("^(.)+/sharing/rest/content/items/(.)+/info/(.)+").test(e)&&t&&(e+=`?token=${t.token}`)}return e},this.onFullscreenChangeHandler=e=>{const t=O(),i=t&&t===this.container.current;this.setState({isFullScreen:i})},this.fullScreenMap=()=>{if(!!document&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.webkitFullScreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){O()===this.container.current?function(){try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitExitFullScreen?document.webkitExitFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){console.error("exitFullscreen error",e)}}():function(e){try{e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}catch(e){console.error("requestFullscreen error",e)}}(this.container.current)}else this.container.current.classList.contains(jt)?(this.container.current.classList.remove(jt),this.setState({isFullScreen:!1})):(this.container.current.classList.add(jt),this.setState({isFullScreen:!0}))},this.handleViewGroupCreate=e=>{e&&e.setMapWidgetInstance(this)},this.onJimuMapViewCreated=e=>{e.setMapWidgetState(this.props.state),this.setShowPopupUponSelectionForJimuMapView(e)},this.onActiveJimuMapViewChange=e=>{this.activeJimuMapView=e,this.watchPopupSelectedFeatureChange()},this.switchMap=(...e)=>Nt(this,[...e],void 0,function*(e=!1){if(this.multiSourceMapInstance)return yield this.multiSourceMapInstance.switchMap(e);yield Promise.resolve()}),this.setMultiSourceMapInstance=e=>{this.multiSourceMapInstance=e},this.onResize=({width:e,height:t})=>{e&&t&&(e<=545&&e>0?this.setState({widthBreakpoint:"xsmall",widgetHeight:t}):this.setState({widthBreakpoint:"other",widgetHeight:t}))},this.isLoadingDisplayed=()=>{var e;const t=(null===(e=this.props.mutableStateProps)||void 0===e?void 0:e.addToMapDatas)||{};return Object.values(t).some(e=>(null==e?void 0:e.dataChangeStatus)===o.DataChangeStatus.Pending)},this.isWarningDisplayed=()=>{var e;const t=(null===(e=this.props.mutableStateProps)||void 0===e?void 0:e.addToMapDatas)||{};return Object.values(t).some(e=>(null==e?void 0:e.dataChangeStatus)===o.DataChangeStatus.Rejected)},this.getInnerContent=e=>this.state.startLoadModules?this.props.useDataSources&&this.props.useDataSources[0]&&this.props.useDataSources[0].dataSourceId?(0,t.jsx)("div",{className:"w-100 h-100",ref:e=>{this.parentContainer=e},children:(0,t.jsxs)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100 map-component-container",ref:this.container,children:[(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100",{"map-is-design-mode":!x(this.props.appMode)}),children:this.props.useDataSources.length>=1&&(0,t.jsx)(Tt,{fullScreenMap:this.fullScreenMap,baseWidgetProps:this.props,startLoadModules:this.state.startLoadModules,ref:this.setMultiSourceMapInstance,onViewGroupCreate:this.handleViewGroupCreate,onJimuMapViewCreated:this.onJimuMapViewCreated,onActiveJimuMapViewChange:this.onActiveJimuMapViewChange,widgetHeight:this.state.widgetHeight,widthBreakpoint:this.state.widthBreakpoint,isFullScreen:this.state.isFullScreen,isMapInVisibleArea:e,autoControlWidgetId:this.props.autoControlWidgetId,mapComponentsLoaded:this.state.mapComponentsLoaded,mapRootClassName:this.mapRootClassName},1)}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.container,handleWidth:!0,handleHeight:!0,onResize:this.onResize})]})}):(0,t.jsx)("div",{className:"w-100 h-100",ref:e=>{this.parentContainer=e},children:(0,t.jsxs)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100 map-component-container",ref:this.container,children:[(0,t.jsx)("div",{className:(0,i.classNames)("w-100 h-100",{"map-is-design-mode":!x(this.props.appMode)}),children:(0,t.jsx)(Vt,{fullScreenMap:this.fullScreenMap,baseWidgetProps:this.props,startLoadModules:this.state.startLoadModules,isDefaultMap:!0,setMultiSourceMapInstance:this.setMultiSourceMapInstance,onViewGroupCreate:this.handleViewGroupCreate,onJimuMapViewCreated:this.onJimuMapViewCreated,onActiveJimuMapViewChange:this.onActiveJimuMapViewChange,widgetHeight:this.state.widgetHeight,widthBreakpoint:this.state.widthBreakpoint,isFullScreen:this.state.isFullScreen,isMapInVisibleArea:e,autoControlWidgetId:this.props.autoControlWidgetId,mapComponentsLoaded:this.state.mapComponentsLoaded,mapRootClassName:this.mapRootClassName})}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.container,handleWidth:!0,handleHeight:!0,onResize:this.onResize})]})}):(0,t.jsx)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100",children:(0,t.jsx)("div",{className:"widget-map w-100 h-100",children:(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})})}),this.warningIcon='<svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M7.09926 5.37004C7.04598 4.83729 7.46434 4.375 7.99975 4.375C8.53516 4.375 8.95353 4.83728 8.90025 5.37004L8.5495 8.87748C8.52126 9.15992 8.2836 9.375 7.99975 9.375C7.71591 9.375 7.47825 9.15992 7.45 8.87748L7.09926 5.37004Z" fill="#938500"/>\n                        <path d="M7.99975 12.375C8.55204 12.375 8.99975 11.9273 8.99975 11.375C8.99975 10.8227 8.55204 10.375 7.99975 10.375C7.44747 10.375 6.99975 10.8227 6.99975 11.375C6.99975 11.9273 7.44747 12.375 7.99975 12.375Z" fill="#938500"/>\n                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.66642 14.375C0.9115 14.375 0.428811 13.5705 0.784067 12.9044L7.1174 1.02941C7.49387 0.323529 8.50564 0.323529 8.88211 1.02941L15.2154 12.9044C15.5707 13.5705 15.088 14.375 14.3331 14.375H1.66642ZM1.66642 13.375L7.99975 1.5L14.3331 13.375H1.66642Z" fill="#938500"/>\n                        </svg>',this.state={startLoadModules:!1,widthBreakpoint:null,widgetHeight:null,isFullScreen:!1,dataActionDataSet:null,mapComponentsLoaded:!1},this.mapRootClassName=`map-widget-root-${e.widgetId}`,this.dataActionListContainer=document.createElement("div"),this.dataActionListContainer.className="data-action-list-wrapper",this.loadReactiveUtils()}getWidgetGlobalStyle(){const e=((e,t)=>{var i;if(!e)return"";const o=`.${t}`,s=e.sys.color.primary.main,a=e.sys.color.action.default,n=null===(i=e.sys.color.action.selected)||void 0===i?void 0:i.default,l=e.sys.color.action.hover,r=e.sys.color.action.text,p=e.sys.color.action.disabled.default,c=e.sys.color.action.disabled.text,d=e.sys.color.action.selected.default,h=e.sys.color.action.selected.hover,u=e.sys.color.action.selected.text,m=e.sys.color.surface.overlay,g=e.sys.color.surface.overlayText,v="rgba(0, 0, 0, 0.2)";return`\n    ${o} {\n      /* Zoom, Home, Locate, Compass */\n      arcgis-zoom, arcgis-home, arcgis-locate, arcgis-compass {\n        --calcite-color-foreground-1: ${a};\n        --calcite-color-text-3: ${r};\n\n        &:hover {\n          --calcite-color-transparent-hover: ${l};\n          --calcite-color-text-1: ${r};\n        }\n      }\n\n      arcgis-zoom[state="disabled"], arcgis-home[state="disabled"], arcgis-locate[state="disabled"], arcgis-compass[state="disabled"] {\n        --calcite-color-foreground-1: ${p};\n        --calcite-color-text-3: ${c};\n\n        &:hover {\n          --calcite-color-transparent-hover: ${p};\n          --calcite-color-text-1: ${c};\n        }\n      }\n\n      /* remove the unexpected focus ring of whole component when child button gets focus */\n      arcgis-zoom, arcgis-compass, arcgis-navigation-toggle, arcgis-search {\n        &:focus, &:focus-visible {\n          outline-width: 0;\n        }\n      }\n\n      arcgis-zoom, arcgis-home, arcgis-locate {\n        --calcite-button-corner-radius: 0px;\n      }\n\n      arcgis-compass {\n        --calcite-button-corner-radius: 50%;\n      }\n\n      /* Toggle */\n      arcgis-navigation-toggle {\n        --calcite-action-corner-radius: 0;\n        --calcite-color-text-3: ${r};\n        --calcite-action-text-color: ${r};\n\n        /* normal */\n        --calcite-color-foreground-1: ${a};\n\n        /* hover */\n        --calcite-action-background-color-hover: ${l};\n\n        /* active */\n        --calcite-color-foreground-3: ${n};\n\n        /* focus */\n        --calcite-offset-invert-focus: 1;\n      }\n\n      /* Search */\n      arcgis-search {\n        /* Use overflow to avoid arcgis-search flickering during initialization */\n        overflow: hidden;\n\n        /* corder radius */\n        --calcite-button-corner-radius: 0;\n        --calcite-corner-radius-sharp: 0;\n        --calcite-corner-radius-round: 0;\n\n        /* left dropdown button with arrow */\n        --calcite-button-background-color: var(--sys-color-action);\n        --calcite-button-text-color: var(--sys-color-action-text);\n\n        /* calcite-autocomplete: input */\n        --calcite-autocomplete-input-background-color: var(--sys-color-action-input-field);\n        --calcite-autocomplete-input-text-color: var(--sys-color-action-input-field-text);\n        --calcite-autocomplete-input-placeholder-text-color: var(--sys-color-action-input-field-text);\n        --calcite-autocomplete-input-actions-background-color: var(--sys-color-action);\n\n        /* calcite-autocomplete: input left search icon */\n        --calcite-autocomplete-input-icon-color: var(--sys-color-action-input-field-text);\n\n        /* calcite-autocomplete: input right clear button */\n        --calcite-autocomplete-input-actions-background-color-hover: var(--sys-color-action-hover);\n        --calcite-autocomplete-input-actions-icon-color: var(--sys-color-action-text);\n        --calcite-autocomplete-input-actions-icon-color-hover: var(--sys-color-action-text);\n\n        /* geocoding service list */\n        --calcite-dropdown-background-color: var(--sys-color-surface-overlay);\n        --calcite-dropdown-item-background-color-hover: ${v};\n        --calcite-dropdown-group-title-text-color: var(--sys-color-surface-overlay-text);\n        --calcite-dropdown-item-text-color-press: var(--sys-color-surface-overlay-text);\n\n        /* search suggestion list */\n        /* --calcite-autocomplete-background-color: var(--sys-color-surface-overlay); */ /* can't used, it also affects list item background color */\n        --calcite-color-foreground-1: ${m}; /* used as list item background color */\n        --calcite-color-foreground-2: ${v}; /* used as list item hover background color */\n        --calcite-autocomplete-text-color: var(--sys-color-surface-overlay-text);\n        --calcite-autocomplete-heading-text-color: var(--sys-color-surface-overlay-text);\n\n        /* focus */\n        &:focus {\n          /* the focus ring of left dropdown button is cut off if arcgisSearch.style.overflow is hidden */\n          overflow: visible;\n        }\n      }\n\n      /* Layers */\n      arcgis-layer-list {\n        --calcite-corner-radius-sharp: 0;\n        --calcite-list-background-color: ${m};\n        --calcite-list-background-color-hover: ${v};\n        --calcite-list-background-color-press: ${v};\n        --calcite-list-label-text-color: ${g};\n      }\n\n      /* Attribution */\n      .esri-attribution.esri-widget {\n        font-size: 12px;\n        color: #323232; /* Original color from API is used here */\n        background-color: rgba(255,255,255,0.65); /* Original color from API is used here */\n      }\n\n      /* Popup */\n      .esri-popup__main-container {\n        /* popup background color */\n        background-color: ${m};\n        --calcite-ui-foreground-1: ${m};\n        --calcite-color-foreground-1: ${m};\n\n        /* popup title color */\n        --calcite-ui-text-2: ${g};\n        --calcite-color-text-2: ${g};\n        --calcite-color-text-1: ${g};\n        .esri-widget__heading.esri-features__heading {\n          color: ${g};\n        }\n\n        /* popup icon color */\n        --calcite-ui-text-3: ${g};\n        --calcite-color-text-3: ${g};\n\n        /* override popup table color */\n        .esri-widget__table {\n          color: ${g};\n        }\n\n        /* select feature list & search result list */\n        --calcite-list-background-color: ${m};\n        --calcite-list-background-color-hover: ${v};\n        --calcite-list-background-color-press: ${v};\n\n        /* search result collapse title */\n        arcgis-search-result-renderer {\n          --calcite-block-header-background-color-hover: ${v};\n          --calcite-block-header-background-color-press: ${v};\n        }\n\n        /* buttons */\n        --calcite-button-text-color: ${g};\n        --calcite-action-background-color-hover: ${v};\n        --calcite-color-foreground-2: ${v};\n        --calcite-action-background-color-press: ${v};\n        --calcite-action-background-color-pressed: ${v};\n        --calcite-action-text-color-press: ${g};\n        --calcite-action-text-color-pressed: ${g};\n\n        .esri-widget {\n          font-family: inherit;\n          background-color: transparent;\n          color: inherit;\n        }\n      }\n      .esri-popup__pointer-direction {\n        background-color: ${m};\n      }\n      .esri-popup__navigation {\n        background: transparent;\n      }\n\n      /* similar like calcite-button.esri-widget--button of esri-widget */\n      .esri-widget--button-like {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin: 0;\n        padding: 0;\n        overflow: hidden;\n        width: 32px;\n        height: 32px;\n        cursor: pointer;\n        text-decoration: none;\n        font-style: normal;\n\n        background-color: ${a};\n        color: ${r};\n\n        &:hover {\n          background-color: ${l};\n          color: ${r};\n        }\n\n        &.selected {\n          color: ${u};\n          background-color: ${d};\n        }\n\n        &.selected:hover {\n          color: ${u};\n          background-color: ${h};\n        }\n\n        &.disabled {\n          background-color: ${p};\n          color: ${c};\n        }\n      }\n\n      /* exbmap-ui */\n      .exbmap-ui-tool-shell {\n        box-shadow: 0 1px 2px 0 ${v};\n      }\n      .exbmap-ui-tool,\n      .exbmap-ui-tool-panel {\n        pointer-events: auto;\n        position: relative;\n      }\n\n      /* exbmap-basetool-loader */\n      .exbmap-basetool-loader {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        width: 100%;\n        animation: esri-fade-in 500ms ease-in-out;\n      }\n\n      .exbmap-basetool-loader:before {\n        background-color: transparent;\n        width: 100%;\n        z-index: 0;\n        content: "";\n        opacity: 1;\n        position: absolute;\n        height: 2px;\n        top: 0;\n        transition: opacity 500ms ease-in-out;\n      }\n\n      .exbmap-basetool-loader:after {\n        background-color: ${s};\n        width: 20%;\n        z-index: 0;\n        animation: looping-progresss-bar-ani 1500ms linear infinite;\n        content: "";\n        opacity: 1;\n        position: absolute;\n        height: 2px;\n        top: 0;\n        transition: opacity 500ms ease-in-out;\n      }\n    }\n\n    /* Map widget places map tool popper (both pc popper and mobile panel) at document.body */\n    ${At(o,e)}\n\n    /* JimuMap places map tool popper (both pc popper and fake mobile panel) at JimuMap */\n    ${o} {\n      ${At("",e)}\n    }\n`})(this.props.theme,this.mapRootClassName);return i.css`
     ${e}

    /*
      Position fixed doesn't work when using transform
      https://stackoverflow.com/questions/2637058/position-fixed-doesnt-work-when-using-webkit-transform
      Need to clear the transform of this.container's all ancestors.
      We also need  to make sure all ancestors have fixed position, otherwise strange behavior may occur on iPhone browsers of iOS 17.7.1.
    */
    *:has(.fake-fullscreen-map) {
      transform: none !important;
      position: fixed !important;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 1;
    }

    /*
      Put the map widget into a widget controller and open the map widget from widget controller on mobile devices, you can see the map widget is placed at a MobilePanel.
      After click the full screen map tool, you can see the close button of MobilePanel overlaps the map widget.
      To solve the above case, we need to update the z-index of widget-content.
    */
    .widget-renderer > .widget-content:has(.fake-fullscreen-map) {
      z-index: 1;
    }

    body.jimu-keyboard-nav .esri-view-surface:focus {
      outline-offset: -2px;
    }
    `}getWidgetStyle(){return i.css`
      /* overflow-hidden is needed, otherwise map canvas doesn't show round corder when widget uses border radius */
      overflow: hidden;

      /*
        If the initial zoom of map is small (e.g. zoom is 0), map tiles can't cover all the map widget.
        When the above map enter real full screen mode, the blank area of map shows black. So we need to update the map's background color for full screen mode.
        https://stackoverflow.com/questions/16163089/background-element-goes-black-when-entering-fullscreen-with-html5
      */
      .map-component-container:fullscreen {
        background: white;

        /*
          case1: When map is not in real full screen mode, document.fullscreenElement is null and popper is placed into document.body. So, the popper of map tool is above map popup as expected.
          case2: When map is in real full screen mode, document.fullscreenElement is this.container and popper is placed into this.container.
                 The default z-index of popper is 1, but z-index of .esri-popup is 9, so the popper of map tool is below .esri-popup. This is not expected.
          We need to add the following css to fix case2 for both pc layout tool (.map-tool-popper), mobile layout tool (.map-tool-mobile-panel) and other widget's Popper or MobilePanel (.popper[role="dialog"]).
          If fact, if we set .popper[role="dialog"], we don't need to set .map-tool-popper and .map-tool-mobile-panel, but we can still keep it here.
          The className of normal Popper is 'popper' and the className of MobilePanel is 'popper mobile-panel-popper'. The role attribute of both normal Popper and MobilePanel is 'dialog'.
        */
        .map-tool-popper, .map-tool-mobile-panel, .popper[role="dialog"], .popper.jimu-dropdown-menu {
          z-index: 9 !important;
        }
      }

      /*
        .fake-fullscreen-map is used to support the fake full screen for iPhone browsers.
      */
      .fake-fullscreen-map {
        position: fixed !important;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: white;
      }

      /*
        Put map widget2 into map widget1. Both map widgets enable full screen tool. After click the full screen tool of map widget2, you can see the map tools of map widget1 overlap map widget2.
        To solve the above case, we need to hide the map-tool-layout of map widget1.
      */
      .multi-source-map:has(.fake-fullscreen-map) > .map-tool-layout {
        display: none;
      }

      .map-loading-bar {
        z-index: 8;
      }

      .map-warning-bar {
        z-index: 8;
        position: absolute;
        bottom: 4px;
        left: 4px;
        right: 4px;
        height: 35px;
        background: #fffdeb;
        border: 1px solid #fff592;
        display: flex;
        align-items: center;
        justify-content: flex-start;

        .warning-icon {
          width: 14px;
          margin: 0 12px 0 12px;
        }
      }

      .map-fix-layout {
        position: absolute !important;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        z-index: 7;
        pointer-events: none;
      }

      .hide-map-tools-layout .map-tool-layout{
        display: none;
      }

      /*
        API 4.31 original css for .esri-ui
        z-index: 0;
        container-name: none; // not set, use browser default value
        container-type: normal; // not set, use browser default value

        API 4.32 original css for .esri-ui
        z-index: 0;
        container-name: esri-view-canvas;
        container-type: size;
        contain: layout;
      */

      /* make sure only popup (exclude other components in esri-ui, like swipe) over map tools and other widgets */
      .esri-view-root > .esri-ui:has(.esri-popup) {
        /*
        In API 4.31 and earlier versions, contain has a default value of 'none', and .esri-ui .esri-popup { z-index: 9; } can make the popup appear above the widget and map tool.
        However, starting from API 4.32, the value of contain is set to 'layout' by API to improve the layout performance of .esri-ui,
        but this makes .esri-ui .esri-popup { z-index: 9; } invalid. In order to solve the popup z-index problem, we need to reset the value of contain to 'none' and set z-index to unset.
        Note, both z-index:unset and z-index:9 work, but z-index:9 causes the entire .esri-ui to overlap the map tools div, causing issue 27306. z-index:unset does not cause this issue.
        */
        contain: none;
        z-index: unset;

        /* In API 4.32, API adds css .esri-ui{ container: esri-view-canvas/size; }.
        This results in the .esri-ui .esri-popup { z-index: 9; } not taking effect on some old browsers (iPad 18.31 Safari/Chrome, Xiaomi browser, Android Chrome 105, etc.) and the above css (contain: none; z-index: unset;) doesn't work,
        causing the popup to be covered by map tools and widgets on these older browsers.
        In order to adapt to these old browsers, we must also need to reset container-name and container-type. */
        container-name: none;
        container-type: normal;
      }

      .esri-ui-manual-container .esri-swipe {
        z-index: 0;
      }

      /* make sure only popup (exclude other components in esri-ui, like swipe) over map tools and other widgets */
      .esri-ui .esri-popup {
        z-index: 9;
      }

      /* The z-index of inactive map is -1. So the inactive map is covered by Paper widget background color. In most cases, it works fine.
         But when enable Swipe widget between two webmaps, the inactive map is not visible. This is not expected.
         To solve this issue, we need to set widget background to transparent for this case.
       */
      :has(.jimu-widget-swipe-handle-container) {
        background: transparent;
      }

      .esri-features .esri-feature-content a[href] {
        text-decoration-line: underline;
      }

      .data-action-list-wrapper {
        margin: 3px;
      }
    `}getInnerContentStyle(){const e=this.props.theme;return i.css`
      position: relative;

      .map-is-live-mode {
        .exbmap-ui {
          pointer-events: auto !important;
        }

        .is-widget {
          pointer-events: auto !important;
        }
      }

      .widget-map-usemask {
        pointer-events: auto !important;
      }

      .map-is-design-mode {
        .exbmap-ui,
        .exbmap-ui-tool {
          pointer-events: none !important;
        }

        .is-widget {
          pointer-events: auto !important;
        }
      }

      .widget-map{
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        z-index: -1;
        .overview-container{
          position: absolute;
          top: 12px;
          right: 12px;
          width: 300px;
          height: 200px;
          border: 1px solid black;
          z-index: 1;
        }

        .extent-container{
          background-color: rgba(0, 0, 0, 0.5);
          position: absolute;
          z-index: 2;
        }

        .extent-btn-container{
          button{
            outline: none;
          }
          .previous-extent-btn{
            color: #111;
          }
          .next-extent-btn{
            color: #222;
          }
        }
      }

      .mapswitch-container {
        position: absolute;
        z-index: 7;
        width: 32px;
        height: 32px;
        bottom: 10px;
        left: 10px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3)
      }

      .mapswitch-icon {
        fill: black;
        left: 8px;
        top: 8px;
        position: absolute;
        display: block;
      }

      .widget-map-background {
        background-color: ${e.sys.color.surface.paper};
        position: absolute;
        z-index: 1;
      }

      @keyframes appear {
        0%{opacity:0}
        25%{opacity:.25}
        50%{opacity:.5;}
        75%{opacity:.75}
        100%{opacity:1;}
      }

      @keyframes disappear {
        0%{opacity:1}
        25%{opacity:.75}
        50%{opacity:.5;}
        75%{opacity:.25}
        100%{opacity:0;}
      }

      .multisourcemap-item-appear {
        animation: appear 300ms;
        -webkit-animation: appear 300ms;
        -moz-animation: appear 300ms;
        animation-fill-mode: forwards;
        -webkit-animation-fill-mode: forwards;
        -moz-animation-fill-mode: forwards;
        animation-timing-function: ease-in;
        -webkit-animation-timing-function: ease-in;
        -moz-animation-timing-function: ease-in;
      }

      .multisourcemap-item-disappear {
        animation: disappear 300ms;
        -webkit-animation: disappear 300ms;
        -moz-animation: disappear 300ms;
        animation-fill-mode: forwards;
        -webkit-animation-fill-mode: forwards;
        -moz-animation-fill-mode: forwards;
        animation-timing-function: ease-in;
        -webkit-animation-timing-function: ease-in;
        -moz-animation-timing-function: ease-in;
      }

      .multisourcemap-item-appear-noanimate {
        opacity: 1;
      }

      .multisourcemap-item-disappear-noanimate {
        opacity: 0;
      }
      `}componentDidMount(){this.state.startLoadModules||!window.jimuConfig.isInBuilder&&this.props.config.canPlaceHolder||this.startRenderMap(),document.addEventListener("webkitfullscreenchange",this.onFullscreenChangeHandler),document.addEventListener("fullscreenchange",this.onFullscreenChangeHandler),setTimeout(()=>{var e,t;const o=null===(e=this.props)||void 0===e?void 0:e.runtimePersistentMapState,s=null===(t=this.props)||void 0===t?void 0:t.id;if(o&&s){i.UrlManager.getInstance().setWidgetUrlParams(s,o)}},10),(0,i.loadArcGISMapComponents)().then(()=>{this.setState({mapComponentsLoaded:!0})}).catch(e=>{console.error("loadArcGISMapComponents error",e),this.setState({mapComponentsLoaded:!1})})}componentDidUpdate(e,t){var i,o,s;const a=e.state,n=this.props.state;if(a!==n){this.getJimuMapViews().forEach(e=>{e.setMapWidgetState(n)})}if(!!(null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.showPopupUponSelection)!==!!(null===(s=null===(o=this.props)||void 0===o?void 0:o.config)||void 0===s?void 0:s.showPopupUponSelection)){this.getJimuMapViews().forEach(e=>{this.setShowPopupUponSelectionForJimuMapView(e)})}(null==e?void 0:e.enableDataAction)!==this.props.enableDataAction&&this.handleDataActionWhenPopupSelectedFeatureChange(this.activeJimuMapView)}componentWillUnmount(){document.removeEventListener("webkitfullscreenchange",this.onFullscreenChangeHandler),document.removeEventListener("fullscreenchange",this.onFullscreenChangeHandler);(0,i.getAppStore)().getState().appConfig.widgets[this.props.id]||i.MutableStoreManager.getInstance().updateStateValue(this.props.id,"restoreData",null)}getJimuMapViews(){let e=[];const t=o.MapViewManager.getInstance().getJimuMapViewGroup(this.props.id);return t&&(e=t.getAllJimuMapViews()),e}setShowPopupUponSelectionForJimuMapView(e){e&&e.setShowPopupUponSelection(!!this.props.config.showPopupUponSelection)}getCurrentPopupSelectedFeature(){var e,t,i;return null===(i=null===(t=null===(e=this.activeJimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.popup)||void 0===i?void 0:i.selectedFeature}loadReactiveUtils(){return Nt(this,void 0,void 0,function*(){[this.reactiveUtils]=yield(0,o.loadArcGISJSAPIModules)(["esri/core/reactiveUtils"]),this.watchPopupSelectedFeatureChange()})}watchPopupSelectedFeatureChange(){this.watchSelectedFeatureHandle&&(this.watchSelectedFeatureHandle.remove(),this.watchSelectedFeatureHandle=null);const e=this.activeJimuMapView;e&&this.reactiveUtils&&(this.getCurrentPopupSelectedFeature()&&this.handleDataActionWhenPopupSelectedFeatureChange(e),this.watchSelectedFeatureHandle=this.reactiveUtils.watch(()=>{var t,i;return null===(i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.popup)||void 0===i?void 0:i.selectedFeature},()=>{this.handleDataActionWhenPopupSelectedFeatureChange(e)}))}handleDataActionWhenPopupSelectedFeatureChange(e){return Nt(this,void 0,void 0,function*(){var t;const i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.popup,o=null==i?void 0:i.selectedFeature;this.dataActionListContainer.parentNode&&this.dataActionListContainer.parentNode.removeChild(this.dataActionListContainer),this.releasePopupDomNodeObserver(),yield this.updateDataActionDataSet(null);if(this.isDataActionEnabled()&&o){const t=yield this.getDataActionDataSet(e,o);if(this.getCurrentPopupSelectedFeature()!==o)return;if(yield this.updateDataActionDataSet(t),this.getCurrentPopupSelectedFeature()!==o)return;this.watchPopupDomNodeChange(i)}})}updateDataActionDataSet(e){return new Promise(t=>{this.setState({dataActionDataSet:e},()=>{t()})})}releasePopupDomNodeObserver(){this.popupDomNodeObserver&&(this.popupDomNodeObserver.disconnect(),this.popupDomNodeObserver=null)}watchPopupDomNodeChange(e){this.releasePopupDomNodeObserver();const t=e.domNode||e.container;this.tryAppendDataActionListDomNodeToPopup(t);const i=new MutationObserver(e=>{for(const i of e)"childList"===i.type&&this.tryAppendDataActionListDomNodeToPopup(t)});i.observe(t,{childList:!0,subtree:!0}),this.popupDomNodeObserver=i}tryAppendDataActionListDomNodeToPopup(e){const t=e.querySelector('calcite-action-bar[slot="action-bar"]');t&&!t.contains(this.dataActionListContainer)&&this.state.dataActionDataSet&&(this.dataActionListContainer.parentNode&&this.dataActionListContainer.parentNode.removeChild(this.dataActionListContainer),t.firstChild?t.insertBefore(this.dataActionListContainer,t.firstChild):t.appendChild(this.dataActionListContainer))}getDataActionDataSet(e,t){return Nt(this,void 0,void 0,function*(){var o;let s=null;if("esri.geometry.Mesh"===(null===(o=null==t?void 0:t.geometry)||void 0===o?void 0:o.declaredClass)){const e=t;(t=e.clone()).geometry=null,t.layer=e.layer,t.sourceLayer=e.sourceLayer}try{s=yield this.getLayerDataSourceBySelectedFeature(e,t)}catch(e){s=null,console.error("getLayerDataSourceBySelectedFeature error",e)}if(!s){const e=t.layer;e&&(s=e[i.ExBAddedJSAPIProperties.EXB_DATA_SOURCE])}if(s){const e=s.getLabel()||"",i="mapCurrentRecord",o=this.props.intl.formatMessage({id:i,defaultMessage:z[i]},{layerName:e}),a=s.buildRecord(t);a.hasFullGeometry=!1;return{dataSource:s,name:o,type:"current",records:[a]}}return null})}getLayerDataSourceBySelectedFeature(e,t){return Nt(this,void 0,void 0,function*(){let o=null;if(t){const s=t[i.ExBAddedJSAPIProperties.EXB_DATA_SOURCE_ID];if(s&&(o=i.DataSourceManager.getInstance().getDataSource(s)),!o){const i=this.getJimuLayerViewBySelectedFeature(e,t);i&&(o=i.getLayerDataSource(),o||(o=yield i.createLayerDataSource()))}}return o})}getJimuLayerViewBySelectedFeature(e,t){let i=null;const o=t.jimuLayerViewId;if(o&&(i=e.jimuLayerViews[o]),!i){const o=Object.values(e.jimuLayerViews);if(t.layer&&"esri.layers.BuildingSceneLayer"!==t.layer.declaredClass&&(i=o.find(e=>e.layer===t.layer)),!i){const e=t.sourceLayer;e&&(i=o.find(t=>t.layer===e))}}return i}isDataActionEnabled(){return!1!==this.props.enableDataAction}renderDataActionList(){return this.isDataActionEnabled()&&this.state.dataActionDataSet?i.ReactDOM.createPortal((0,t.jsx)(s.DataActionList,{widgetId:this.props.id,dataSets:[this.state.dataActionDataSet],buttonType:"tertiary",disableDataSourceLevelActions:!0,listStyle:s.DataActionListStyle.Dropdown,hideGroupTitle:!0}),this.dataActionListContainer):null}render(){const e=this.renderDataActionList(),o=`jimu-widget arcgis-map ${this.mapRootClassName}`;return(0,t.jsxs)(s.Paper,{shape:"none",className:o,css:this.getWidgetStyle(),children:[(0,t.jsx)(Et.Global,{styles:this.getWidgetGlobalStyle()}),this.isLoadingDisplayed()&&(0,t.jsx)(s.Loading,{className:"map-loading-bar",type:s.LoadingType.Bar}),this.isWarningDisplayed()&&(0,t.jsxs)("div",{className:"map-warning-bar",children:[(0,t.jsx)(s.Icon,{className:"warning-icon",icon:this.warningIcon,size:26,currentColor:!1}),(0,t.jsx)("span",{children:this.props.intl.formatMessage({id:"failToAddTheDataOnMap",defaultMessage:"Fail to add the data."})})]}),e,(0,t.jsx)(i.PageVisibilityContext.Consumer,{children:e=>(0,t.jsx)(Z.ViewportVisibilityContext.Consumer,{children:o=>(0,t.jsx)(i.ViewVisibilityContext.Consumer,{children:t=>{const i=!t.isInView||t.isInCurrentView,s=e&&(o||this.props.isPrintPreview)&&i;return this.getInnerContent(s)}})})})]})}}Dt=kt,kt.versionManager=Lt,kt.cachedInitPersistentMapStates={},kt.mapExtraStateProps=(e,t)=>{var o,s,a;let n="";const l=t.id;e.mapWidgetsInfo&&l&&(n=(null===(o=e.mapWidgetsInfo[l])||void 0===o?void 0:o.autoControlWidgetId)||"");const r=e&&e.appRuntimeInfo&&e.appRuntimeInfo.appMode,p=r===i.AppMode.Run;let c=null;if(p&&e.urlHashObject&&(c=e.urlHashObject[l]),Dt.cachedInitPersistentMapStates||(Dt.cachedInitPersistentMapStates={}),!(l in Dt.cachedInitPersistentMapStates)){let e=null;const t=i.AppStateManager.getInstance();p&&t.isLocalStateRestored()&&(e=t.getLastLocalState(l)||null),Dt.cachedInitPersistentMapStates[l]=e}const d=Dt.cachedInitPersistentMapStates[l]||null,h=d||c;let u="";const m=null===(a=null===(s=e.appConfig)||void 0===s?void 0:s.attributes)||void 0===a?void 0:a.timezone;return m?m.type===i.TimezoneConfig.Device?u="system":m.type===i.TimezoneConfig.Specific?u=m.value:m.type===i.TimezoneConfig.Data&&(u=""):u="system",{appMode:r,isPrintPreview:e.appRuntimeInfo.isPrintPreview,queryObject:e.queryObject,autoControlWidgetId:n,isRunAppMode:p,runtimePersistentMapState:d,realRuntimeUrlHashParams:c,runtimeUrlHashParams:h,mapTimeZone:u}};const Ot=kt;function Rt(e){r.p=e}})(),p})())}}});