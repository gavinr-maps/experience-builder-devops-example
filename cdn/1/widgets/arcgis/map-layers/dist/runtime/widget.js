System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-theme"],(function(e,t){var i={},a={},r={},n={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceTypes=e.DataSourceTypes,i.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties,i.MutableStoreManager=e.MutableStoreManager,i.React=e.React,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.classNames=e.classNames,i.css=e.css,i.focusElementInKeyboardMode=e.focusElementInKeyboardMode,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.isKeyboardMode=e.isKeyboardMode,i.jsx=e.jsx,i.lodash=e.lodash,i.portalUrlUtils=e.portalUrlUtils},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent,a.MapViewManager=e.MapViewManager,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.zoomToUtils=e.zoomToUtils},function(e){r.Button=e.Button,r.DataActionList=e.DataActionList,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.FloatingPanel=e.FloatingPanel,r.Loading=e.Loading,r.Popper=e.Popper,r.Slider=e.Slider,r.TextInput=e.TextInput,r.Tooltip=e.Tooltip,r.WidgetPlaceholder=e.WidgetPlaceholder,r.defaultMessages=e.defaultMessages,r.getFocusableElements=e.getFocusableElements},function(e){n.styled=e.styled}],execute:function(){e((()=>{var e={88775:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M10.226.054a.5.5 0 0 0-.451 0L.25 4.942a.446.446 0 0 0 .025.813L9.8 9.958a.5.5 0 0 0 .4 0l9.524-4.203a.446.446 0 0 0 .025-.813zM10 9.044 1.542 5.313 10 .97l8.458 4.34z" clip-rule="evenodd"></path><path fill="#000" d="M.676 10.04a.493.493 0 0 0-.632.216c-.11.22-.006.482.232.585L10 15l9.724-4.16c.238-.102.342-.363.232-.584a.493.493 0 0 0-.632-.215L10 14.029z"></path><path fill="#000" fill-rule="evenodd" d="M.676 15.04a.493.493 0 0 0-.632.216c-.11.22-.006.482.232.585L10 20l9.724-4.16c.238-.102.342-.363.232-.584a.493.493 0 0 0-.632-.215L10 19.029zM10 19.03l.2.085h-.4z" clip-rule="evenodd"></path></svg>'},43052:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#100" fill-rule="evenodd" d="M1 9H0V8h1zm2-1H2v1h1zm10 1h1V8h-1zm3-1h-1v1h1zM5 9h6v1h1V7h-1v1H5V7H4v3h1zm4-5.5a2.5 2.5 0 1 1 3 2.45v.55h-1v-.55A2.5 2.5 0 0 1 9 3.5m1 0a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0m-8 10a2.5 2.5 0 0 1 2-2.45v-.55h1v.55a2.5 2.5 0 1 1-3 2.45m1 0a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},85643:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><mask id="a" width="14" height="14" x="1" y="1" maskUnits="userSpaceOnUse" style="mask-type:alpha"><path fill="#6A6A6A" fill-rule="evenodd" d="M4 11V4h7V1H1v10zm1-6v10h10V5zm9 9H6V6h8z" clip-rule="evenodd"></path><path fill="#6A6A6A" d="M6 6h5v5H6z" opacity=".5"></path></mask><g mask="url(#a)"><path fill="#000" d="M0 0h16v16H0z"></path></g></svg>'},18249:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h14v12H1zm13 1H2v4h12zm0 5h-3v2h3zm0 3h-3v2h3zm-4 2v-2H6v2zm-5 0v-2H2v2zm-3-3h3V8H2zm8-2v2H6V8z" clip-rule="evenodd"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},62686:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=i},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=r}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var o={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(o),s.d(o,{LoadStatus:()=>Ke,Widget:()=>qe,__set_webpack_public_path__:()=>Ze,default:()=>Ye});var e=s(79244),t=s(62686),i=s(14321);function a(t,i){var a,r,n,s,o,l;let c,p;i.setVisibility&&i.useMapWidget?(c="block",p=""):(c="none",p="unset");const d=t.sys.color.surface.paper;return e.css`
    overflow: auto;
    .widget-layerlist {
      width: 100%;
      height: 100%;
      min-height: 32px;
      overflow-x: hidden;
      background-color: var(--calcite-color-foreground-1);

      .data-action-list-loading {
        height: 32px;
        border: 1px solid rgba(0,0,0,0);
        border-top: 2px solid ${t.sys.color.secondary.light};
        padding-left: 16px;

        display: flex;
        align-items: center;
        @keyframes ball-fall {
          0%{
            opacity: 0;
            transform: translateY(-145%);
          }
          10%{
            opacity: .5;
          }
          20%{
            opacity: 1;
            transform: translateY(0);
          }
          80%{
            opacity: 1;
            transform: translateY(0);
          }
          90%{
            opacity: .5;
          }
          100%{
            opacity: 0;
            transform:translateY(145%);
          }
        }
        &:before,
        &:after,
        .dot-loading {
          width: 0.25rem;
          height: 0.25rem;
          border-radius: 0.25rem;
          box-sizing: border-box;
          opacity:0;
          animation: ball-fall 1s ease-in-out infinite;
        }
        &:before,
        &:after {
          content: '';
          display: inline-block;
        }
        &:before {
          left: -0.375rem;
          animation-delay: -200ms;
        }
        .dot-loading {
          display: inline-block;
          margin: 0 0.125rem;
          animation-delay: -100ms;
        }
        &:after {
          left: 0.375rem;
          animation-delay: 0ms;
        }
        .dot-loading, &:before, &:after {
          background: ${t.sys.color.secondary.main};
        }
      }

      .esri-layer-list__item-label:focus {
        outline: ${p};
      }

      .esri-layer-list__item-toggle {
        display: ${c};
      }

      .esri-layer-list {
        background-color: ${d};
      }

      .esri-layer-list__list {
        padding: 0px 2px;
      }

      .esri-list-item-panel {
        .esri-legend.esri-widget {
          background-color: var(--calcite-color-foreground-1);
        }
      }

      .esri-layer-list__item {
        background-color: var(--calcite-color-foreground-1);
        .data-action-list-wrapper {
          padding: 0;

          .jimu-dropdown, .jimu-dropdown-item {
            font-size: 12px;
            color: ${null===(o=null===(s=null===(n=null===(r=null===(a=null==t?void 0:t.arcgis)||void 0===a?void 0:a.widgets)||void 0===r?void 0:r.layerlist)||void 0===n?void 0:n.icon)||void 0===s?void 0:s.default)||void 0===o?void 0:o.color};
          }

          .jimu-dropdown-item {
            padding: 6px 15px;
            border: 1px solid rgba(0,0,0,0);
            border-top: 2px solid ${null===(l=null==t?void 0:t.sys.color.divider)||void 0===l?void 0:l.primary};
          }

          .dropdown-item:hover {
            .jimu-icon-auto-color {
              color: ${t.sys.color.primary.main} !important;
            }
            background: transparent;
            color: ${t.sys.color.primary.main} !important;
          }
        }
        .ml-2 {
          margin-left: 5px !important;
        }
      }

      .esri-layer-list__item-action {
        outline-offset: -2px;
      }

      .invalid-ds-message {
        font-size: 12px;
        padding: 6px 15px;
        border: 1px solid rgba(0,0,0,0);
        border-top: 2px solid #d5d5d5;
        color: ${t.ref.palette.neutral[1e3]};
      }

      .table-list-divider {
        background-color: var(--calcite-color-foreground-1);
        color: var(--calcite-color-text-2);
        border-block-start: 1px solid var(--calcite-color-border-3);
        font-size: var(--calcite-font-size--1);
        padding-left: 12px;
        height: 28px;
      }
    }
  `}const r={_widgetLabel:"Map Layers",goto:"Zoom to",information:"Details",showLabels:"Show labels",hideLabels:"Hide labels",emptyListTip:"There are currently no items to display",enablePopup:"Enable pop-up",disablePopup:"Disable pop-up",tables:"Tables",visibilityRange:"Visibility range"};var n=s(88775),l=s.n(n);class c extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.12.0",description:"disable old app data-action, delete unused config prop selectedJimuLayerIds",upgrader:e=>{let t=e;return t=t.without("selectedJimuLayerIds"),t}}]}}const p=new c;var d=s(1888),u=function(e,t,i,a){return new(i||(i=Promise))((function(r,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((a=a.apply(e,t||[])).next())}))};const f=d.styled.div`
  min-width: 120px;
  min-height: 20px;
`,h=e.css`
  .jimu-dropdown-item.jimu-dropdown-item-header {
    display: flex;
    justify-content: center;
  }
  .jimu-dropdown {
    .jimu-dropdown-item {
      display: flex;
      justify-content: center;
    }
  }
`;function g(t){const{icon:a,title:r,onClick:n}=t;return(0,e.jsx)(i.DropdownItem,{onClick:n},(0,e.jsx)("div",{className:"d-flex align-items-center"},"string"==typeof a?(0,e.jsx)("div",{className:`jimu-icon-auto-color ${a}`}):a,(0,e.jsx)("span",{className:"ml-2"},r)))}function m(t){const{widgetId:a,actionObjects:r,listItem:n,onActionListItemClick:s,jimuMapView:o,shouldHideEmptyList:l,enableDataAction:c=!0,mapDataSource:p,optionBtnRef:d}=t,[m,y]=e.React.useState(null),b=e.React.useRef(null),v=(t,i)=>{const a=(null==t?void 0:t.icon)||t.className,r=t.title;return(0,e.jsx)(g,{key:i,icon:a,title:r,onClick:()=>{t.execute(n),s()}})};return e.React.useEffect((()=>{c&&function(){u(this,void 0,void 0,(function*(){let t=[];try{let e=null;if(p)e=p.getDataSourceByLayer(n.layer);else if(o){const t=null==o?void 0:o.getJimuLayerViewByAPILayer(n.layer);e=t?yield t.getOrCreateLayerDataSource():o.getMapDataSource().getDataSourceByLayer(n.layer)}t=e?[{dataSource:e,records:[],name:null==e?void 0:e.getLabel()}]:[]}catch(e){console.error("DataSource create error:",e)}finally{if(b.current){const r=(0,e.jsx)("div",{className:"data-action-list-wrapper",css:h},(0,e.jsx)(i.DataActionList,{key:Math.random(),widgetId:a,dataSets:t,hideGroupTitle:!0,shouldHideEmptyList:l,onActionListItemClick:s,actionPanelRefDOM:d.current}));y(r)}}}))}()}),[c,n.layer,s,l,a,o,p,d]),(0,e.jsx)(f,{ref:b},r.map(((e,t)=>v(e,t))),c&&m)}var y=s(18249),b=s.n(y),v=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]])}return i};const w=t=>{const i=window.SVG,{className:a}=t,r=v(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:b()},r)):e.React.createElement("svg",Object.assign({className:n},r))};class L{constructor(){this.id="id",this.title="title",this.className="esri-icon",this.group=0,this.widget=null,this.icon=null,this.isValid=(e,t=!1)=>!1,this.execute=e=>{}}useMapWidget(){return this.widget.props.config.useMapWidget}}class x extends L{constructor(e,i){super(),this.isValid=(e,t)=>!t&&("esri.layers.GroupLayer"!==e.layer.declaredClass&&((!e.parent||"esri.layers.GroupLayer"===e.parent.layer.declaredClass)&&!(!this.useMapWidget()||!this.widget.props.config.goto))),this.execute=e=>{this.widget.viewFromMapWidget&&t.zoomToUtils.zoomTo(this.widget.viewFromMapWidget,e.layer,{})},this.id="goto",this.title=i,this.className="esri-icon-zoom-out-fixed",this.group=0,this.widget=e}}class S extends L{constructor(e,t,i){super(),this.isValid=(e,t)=>{var i;return!t&&(("string"!=typeof e.layer.id||!e.layer.id.startsWith("jimu-draw"))&&(this.title=e.layer.labelsVisible?this.titleHide:this.titleShow,!!(this.useMapWidget()&&this.widget.props.config.label&&(null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.labelingInfo))))},this.execute=e=>{e.layer.labelsVisible=!e.layer.labelsVisible},this.id="label",this.className="esri-icon-labels label-action-title",this.group=0,this.widget=e,this.titleShow=t,this.titleHide=i}}function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)({}).hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},M.apply(null,arguments)}function j(e,t){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},j(e,t)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function O(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(O=function(){return!!e})()}function R(e){var t="function"==typeof Map?new Map:void 0;return R=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return function(e,t,i){if(O())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var r=new(e.bind.apply(e,a));return i&&j(r,i.prototype),r}(e,arguments,I(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),j(i,e)},R(e)}var P=function(e){var t,i;function a(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,j(t,i),a}(R(Error));function A(e,t){return e.substr(-t.length)===t}var V=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function k(e){return"string"!=typeof e?e:e.match(V)?parseFloat(e):e}var N=function(e){return function(t,i){void 0===i&&(i="16px");var a=t,r=i;if("string"==typeof t){if(!A(t,"px"))throw new P(69,e,t);a=k(t)}if("string"==typeof i){if(!A(i,"px"))throw new P(70,e,i);r=k(i)}if("string"==typeof a)throw new P(71,t,e);if("string"==typeof r)throw new P(72,i,e);return""+a/r+e}};N("em");var C=N("rem");function T(e){return Math.round(255*e)}function D(e,t,i){return T(e)+","+T(t)+","+T(i)}function E(e,t,i,a){if(void 0===a&&(a=D),0===t)return a(i,i,i);var r=(e%360+360)%360/60,n=(1-Math.abs(2*i-1))*t,s=n*(1-Math.abs(r%2-1)),o=0,l=0,c=0;r>=0&&r<1?(o=n,l=s):r>=1&&r<2?(o=s,l=n):r>=2&&r<3?(l=n,c=s):r>=3&&r<4?(l=s,c=n):r>=4&&r<5?(o=s,c=n):r>=5&&r<6&&(o=n,c=s);var p=i-n/2;return a(o+p,l+p,c+p)}var F={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var W=/^#[a-fA-F0-9]{6}$/,B=/^#[a-fA-F0-9]{8}$/,z=/^#[a-fA-F0-9]{3}$/,_=/^#[a-fA-F0-9]{4}$/,J=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,H=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,$=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,G=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function U(e){if("string"!=typeof e)throw new P(3);var t=function(e){if("string"!=typeof e)return e;var t=e.toLowerCase();return F[t]?"#"+F[t]:e}(e);if(t.match(W))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(B)){var i=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:i}}if(t.match(z))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(_)){var a=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:a}}var r=J.exec(t);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var n=H.exec(t.substring(0,50));if(n)return{red:parseInt(""+n[1],10),green:parseInt(""+n[2],10),blue:parseInt(""+n[3],10),alpha:parseFloat(""+n[4])>1?parseFloat(""+n[4])/100:parseFloat(""+n[4])};var s=$.exec(t);if(s){var o="rgb("+E(parseInt(""+s[1],10),parseInt(""+s[2],10)/100,parseInt(""+s[3],10)/100)+")",l=J.exec(o);if(!l)throw new P(4,t,o);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=G.exec(t.substring(0,50));if(c){var p="rgb("+E(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",d=J.exec(p);if(!d)throw new P(4,t,p);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new P(5)}function K(e){return function(e){var t,i=e.red/255,a=e.green/255,r=e.blue/255,n=Math.max(i,a,r),s=Math.min(i,a,r),o=(n+s)/2;if(n===s)return void 0!==e.alpha?{hue:0,saturation:0,lightness:o,alpha:e.alpha}:{hue:0,saturation:0,lightness:o};var l=n-s,c=o>.5?l/(2-n-s):l/(n+s);switch(n){case i:t=(a-r)/l+(a<r?6:0);break;case a:t=(r-i)/l+2;break;default:t=(i-a)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:o,alpha:e.alpha}:{hue:t,saturation:c,lightness:o}}(U(e))}var q=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function Y(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function Z(e){return Y(Math.round(255*e))}function X(e,t,i){return q("#"+Z(e)+Z(t)+Z(i))}function Q(e,t,i){return E(e,t,i,X)}function ee(e,t,i){if("number"==typeof e&&"number"==typeof t&&"number"==typeof i)return Q(e,t,i);if("object"==typeof e&&void 0===t&&void 0===i)return Q(e.hue,e.saturation,e.lightness);throw new P(1)}function te(e,t,i,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof a)return a>=1?Q(e,t,i):"rgba("+E(e,t,i)+","+a+")";if("object"==typeof e&&void 0===t&&void 0===i&&void 0===a)return e.alpha>=1?Q(e.hue,e.saturation,e.lightness):"rgba("+E(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new P(2)}function ie(e,t,i){if("number"==typeof e&&"number"==typeof t&&"number"==typeof i)return q("#"+Y(e)+Y(t)+Y(i));if("object"==typeof e&&void 0===t&&void 0===i)return q("#"+Y(e.red)+Y(e.green)+Y(e.blue));throw new P(6)}function ae(e,t,i,a){if("string"==typeof e&&"number"==typeof t){var r=U(e);return"rgba("+r.red+","+r.green+","+r.blue+","+t+")"}if("number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof a)return a>=1?ie(e,t,i):"rgba("+e+","+t+","+i+","+a+")";if("object"==typeof e&&void 0===t&&void 0===i&&void 0===a)return e.alpha>=1?ie(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new P(7)}function re(e){if("object"!=typeof e)throw new P(8);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha}(e))return ae(e);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return ie(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha}(e))return te(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return ee(e);throw new P(8)}function ne(e,t,i){return function(){var a=i.concat(Array.prototype.slice.call(arguments));return a.length>=t?e.apply(this,a):ne(e,t,a)}}function se(e){return ne(e,e.length,[])}se((function(e,t){if("transparent"===t)return t;var i=K(t);return re(M({},i,{hue:i.hue+parseFloat(e)}))}));function oe(e,t,i){return Math.max(e,Math.min(t,i))}se((function(e,t){if("transparent"===t)return t;var i=K(t);return re(M({},i,{lightness:oe(0,1,i.lightness-parseFloat(e))}))}));se((function(e,t){if("transparent"===t)return t;var i=K(t);return re(M({},i,{saturation:oe(0,1,i.saturation-parseFloat(e))}))}));se((function(e,t){if("transparent"===t)return t;var i=K(t);return re(M({},i,{lightness:oe(0,1,i.lightness+parseFloat(e))}))}));var le=se((function(e,t,i){if("transparent"===t)return i;if("transparent"===i)return t;if(0===e)return i;var a=U(t),r=M({},a,{alpha:"number"==typeof a.alpha?a.alpha:1}),n=U(i),s=M({},n,{alpha:"number"==typeof n.alpha?n.alpha:1}),o=r.alpha-s.alpha,l=2*parseFloat(e)-1,c=((l*o==-1?l:l+o)/(1+l*o)+1)/2,p=1-c;return ae({red:Math.floor(r.red*c+s.red*p),green:Math.floor(r.green*c+s.green*p),blue:Math.floor(r.blue*c+s.blue*p),alpha:r.alpha*parseFloat(e)+s.alpha*(1-parseFloat(e))})}));se((function(e,t){if("transparent"===t)return t;var i=U(t);return ae(M({},i,{alpha:oe(0,1,(100*("number"==typeof i.alpha?i.alpha:1)+100*parseFloat(e))/100)}))}));se((function(e,t){if("transparent"===t)return t;var i=K(t);return re(M({},i,{saturation:oe(0,1,i.saturation+parseFloat(e))}))}));se((function(e,t){return"transparent"===t?t:re(M({},K(t),{hue:parseFloat(e)}))}));se((function(e,t){return"transparent"===t?t:re(M({},K(t),{lightness:parseFloat(e)}))}));se((function(e,t){return"transparent"===t?t:re(M({},K(t),{saturation:parseFloat(e)}))}));se((function(e,t){return"transparent"===t?t:le(parseFloat(e),"rgb(0, 0, 0)",t)}));se((function(e,t){return"transparent"===t?t:le(parseFloat(e),"rgb(255, 255, 255)",t)}));se((function(e,t){if("transparent"===t)return t;var i=U(t);return ae(M({},i,{alpha:oe(0,1,+(100*("number"==typeof i.alpha?i.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))}));const{useState:ce,useCallback:pe}=e.React,de=(e,t)=>["ar","tr"].includes(e)?`%${t}`:`${t}%`;function ue(t){const{widget:a,listItem:r}=t,[n,s]=ce(!0),[o,l]=ce((100*(1-r.layer.opacity)).toFixed(0)+"%"),{isRTL:c,locale:p}=(0,e.getAppStore)().getState().appContext,d=pe((()=>{s(!1),a.setState({nativeActionPopper:null})}),[a]);return(0,e.jsx)(i.FloatingPanel,{toggle:(e,t)=>{"clickOutside"!==t&&d()},headerTitle:a.translate("transparency"),reference:a.optionBtnRef.current,open:n,className:"transparency-panel",onHeaderClose:d,css:e.css`
    .transparency-panel-container {
      width: 320px;
      .transparency-panel-title {
        display: block;
        -webkit-box-orient: vertical;
        word-break: break-all;
        white-space: normal;
        -webkit-line-clamp: 1;
        font-size: ${C(14)};
        padding: 1rem 1rem 0 1rem;
      }
      .transparency-slider.ltr {
        padding: 1.5rem 1rem 0.3rem 1rem;
      }
      .transparency-slider.rtl {
        padding: 0.3rem 1rem 1.5rem 1rem;
      }
      .transparency-slider-meters {
        padding: 0 1rem;
        span {
          font-size: 5px;
        }
      }
      .transparency-slider-label {
        padding: 0 1rem 1rem 1rem;
      }
    }
  `,autoSize:!0},(0,e.jsx)("div",{className:"transparency-panel-container"},(0,e.jsx)("span",{title:r.layer.title,className:"transparency-panel-title"},r.layer.title),(0,e.jsx)(i.Slider,{className:(0,e.classNames)("transparency-slider",c?"rtl":"ltr"),defaultValue:1-r.layer.opacity,min:0,max:1,step:.01,title:o,onChange:e=>{const t=Number.parseFloat(e.target.value);r.layer.opacity=1-t,l((100*t).toFixed(0)+"%")}}),(0,e.jsx)("div",{className:"d-flex justify-content-center transparency-slider-meters"},(0,e.jsx)("span",null,"|")),(0,e.jsx)("div",{className:"d-flex justify-content-between transparency-slider-label",dir:"ltr"},(0,e.jsx)("span",{style:{width:"28px",textAlign:"left"}},"0"),(0,e.jsx)("span",null,de(p,"50")),(0,e.jsx)("span",null,de(p,"100")))))}var fe=s(85643),he=s.n(fe),ge=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]])}return i};const me=t=>{const i=window.SVG,{className:a}=t,r=ge(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:he()},r)):e.React.createElement("svg",Object.assign({className:n},r))};class ye extends L{constructor(t,i){super(),this.isValid=(e,t)=>!t&&((!e.parent||"esri.layers.GroupLayer"===e.parent.layer.declaredClass)&&!(!this.useMapWidget()||!this.widget.props.config.opacity)),this.execute=t=>{const i=e.React.createElement(ue,{widget:this.widget,listItem:t});this.widget.setState({nativeActionPopper:i})},this.id="transparency",this.title=i,this.className="esri-icon-sliders-horizontal",this.group=1,this.widget=t,this.icon=e.React.createElement(me,null)}}class be extends L{constructor(t,i){super(),this.isValid=e=>!(!e.layer.url||!this.widget.props.config.information),this.execute=t=>{var i;const a=t.layer,r=null==a?void 0:a.portalItem;if((null===(i=null==r?void 0:r.portal)||void 0===i?void 0:i.url)&&r.id){const t=e.portalUrlUtils.getStandardPortalUrl(r.portal.url)+`/home/item.html?id=${r.id}`;window.open(t)}else{const e="feature"===(null==a?void 0:a.type)?`${a.url}/${a.layerId}`:a.url;window.open(e)}},this.id="information",this.title=i,this.className="esri-icon-description",this.group=3,this.widget=t}}class ve extends L{constructor(e,t){super(),this.isValid=e=>!0,this.execute=e=>{},this.id="option-action",this.title=t,this.className="esri-icon-handle-horizontal",this.group=100,this.widget=e}}const we=[e.SupportedJSAPILayerTypes.FeatureLayer,e.SupportedJSAPILayerTypes.CSVLayer,e.SupportedJSAPILayerTypes.ImageryLayer,e.SupportedJSAPILayerTypes.ImageryTileLayer,e.SupportedJSAPILayerTypes.GeoJSONLayer,e.SupportedJSAPILayerTypes.SubtypeSublayer,"sublayer"];class Le extends L{constructor(t,i,a){super(),this.isValid=t=>{var i;const a=t.layer;if("string"==typeof a.id&&a.id.startsWith("jimu-draw"))return!1;const r=this.widget.jmvFromMap,n=this.widget.props.widgetId,s=e.MutableStoreManager.getInstance().getStateValue([n,"popup",a.id]);if(a&&(null===(i=this.widget.props.config)||void 0===i?void 0:i.popup)&&we.includes(a.type)){const e=a.popupEnabled&&r.isClickOpenPopupEnabled()||(null==s?void 0:s.popupEnabled);return this.title=e?this.disableTitle:this.enableTitle,!0}return!1},this.execute=t=>{const i=t.layer,a=this.widget.jmvFromMap,r=this.widget.props.widgetId,n=e.MutableStoreManager.getInstance(),s=n.getStateValue([r,"popup",i.id]),o=s||{};void 0===(null==s?void 0:s.initialValue)&&(o.initialValue=i.popupEnabled,o.layer=i),this.title===this.disableTitle?(i.popupEnabled=!1,a.disableLayerPopup(i),o.popupEnabled=!1):(i.popupEnabled=!0,a.enableLayerPopup(i,!0),o.popupEnabled=!0),n.updateStateValue(r,`popup.${i.id}`,o)},this.id="popup",this.className="esri-icon-configure-popup",this.group=6,this.widget=t,this.enableTitle=i,this.disableTitle=a}}const{useState:xe,useCallback:Se,useRef:Me,useEffect:je}=e.React;function Ie(t){const{widget:a,listItem:r,scaleRangeSliderClass:n}=t,[s,o]=xe(!0),[l,c]=xe(null),p=Me(null);je((()=>{var t,i;if(!l){const s=null===(i=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appContext)||void 0===i?void 0:i.locale;let o="US";if(s){const e=s.split("-");if((null==e?void 0:e.length)>0){const t=e[e.length-1];if(t){const e=t.toUpperCase();["AE","AR","AT","AU","BE","BG","BO","BR","CA","CH","CI","CL","CN","CO","CR","CZ","DE","DK","EE","EG","ES","FI","FR","GB","GL","GR","GT","HK","ID","IE","IL","IN","IQ","IS","IT","JP","KE","KR","KW","LI","LT","LU","LV","MA","MG","ML","MO","MX","MY","NI","NL","NO","NZ","PE","PL","PR","PT","RO","RU","RW","SE","SG","SK","SR","SV","TH","TN","TW","US","VE","VI","ZA"].includes(e)&&(o=e)}}}const l=new n({view:a.jmvFromMap.view,layer:r.layer,region:o,container:p.current});c(l),l.watch(["minScale","maxScale"],(function(e,t,i){r.layer[i]=e}))}}),[r.layer,l,n,a.jmvFromMap.view]);const d=Se((()=>{o(!1),a.setState({nativeActionPopper:null})}),[a]);return(0,e.jsx)(i.FloatingPanel,{toggle:(e,t)=>{"clickOutside"!==t&&d()},headerTitle:a.translate("visibilityRange"),reference:a.optionBtnRef.current,open:s,className:"visibility-range-panel",autoSize:!0,onHeaderClose:d,css:e.css`
    .visibility-range-container {
      min-width: 342px;
      .visibility-range-panel-title {
        display: block;
        -webkit-box-orient: vertical;
        word-break: break-all;
        white-space: normal;
        -webkit-line-clamp: 1;
        font-size: ${C(14)};
        padding: 1rem 1rem 0 1rem;
      }
      .scale-range-slider-container {
        padding: 1rem;
      }
    }
  `},(0,e.jsx)("div",{className:"visibility-range-container"},(0,e.jsx)("span",{title:r.layer.title,className:"visibility-range-panel-title"},r.layer.title),(0,e.jsx)("div",{className:"scale-range-slider-container"},(0,e.jsx)("div",{ref:p,className:"scale-range-slider"}))))}var Oe=s(43052),Re=s.n(Oe),Pe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]])}return i};const Ae=t=>{const i=window.SVG,{className:a}=t,r=Pe(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:Re()},r)):e.React.createElement("svg",Object.assign({className:n},r))};class Ve extends L{constructor(t,i){super(),this.isValid=(e,t)=>!t&&(!(!this.useMapWidget()||!this.widget.props.config.visibilityRange)&&(this.widget.getModule("esri/widgets/ScaleRangeSlider",(()=>this.ScaleRangeSlider),(e=>{this.ScaleRangeSlider=e})),!0)),this.execute=t=>{const i=e.React.createElement(Ie,{widget:this.widget,listItem:t,scaleRangeSliderClass:this.ScaleRangeSlider});this.widget.setState({nativeActionPopper:i})},this.id="visibility-range",this.title=i,this.className="esri-icon-sliders-horizontal",this.group=7,this.widget=t,this.ScaleRangeSlider=null,this.icon=e.React.createElement(Ae,null)}}var ke=s(50170),Ne=s.n(ke),Ce=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]])}return i};const Te=t=>{const i=window.SVG,{className:a}=t,r=Ce(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:Ne()},r)):e.React.createElement("svg",Object.assign({className:n},r))};var De=s(13424),Ee=s.n(De),Fe=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(i[a[r]]=e[a[r]])}return i};const We=t=>{const i=window.SVG,{className:a}=t,r=Fe(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:Ee()},r)):e.React.createElement("svg",Object.assign({className:n},r))},Be=t=>e.css`
    background-color: ${t.sys.color.surface.paper};
    .map-layers-header-title{
      span {
        font-size: 16px;
        font-weight: 500;
      }
    }
  `,{useState:ze,useCallback:_e,useEffect:Je}=e.React,He=e=>t=>!t||!e||t.layer.title.toLowerCase().includes(e.toLowerCase());function $e(a){const{theme:n,jimuMapViewId:s,layerListRef:o,tableListRef:l,enableSearch:c,enableBatchOption:p,isMapWidgetMode:d}=a,u=e.hooks.useTranslation(r),[f,h]=ze(!1),[g,m]=ze(""),y=e.lodash.throttle((e=>{const t=e.target.value;m(t)}),200),b=_e((e=>()=>{!function(e,t){for(const i of e){i.layer.visible=t}}(t.MapViewManager.getInstance().getJimuMapViewById(s).getAllJimuLayerViews(),e)}),[s]),v=_e((e=>()=>{!function e(t,i){if(t)for(const a of t)a.open=i,a.children&&e(a.children,i)}(o.current.operationalItems,e)}),[o]);return Je((()=>{o.current&&(o.current.filterPredicate=He(g)),l.current&&(l.current.filterPredicate=He(g))}),[o,g,l]),p||c?(0,e.jsx)("div",{className:"map-layers-header d-flex justify-content-between p-1",css:Be(n)},f?(0,e.jsx)(i.TextInput,{className:"w-100 mr-1",type:"text",onChange:y,autoFocus:!0,allowClear:!0}):(0,e.jsx)("div",{className:"map-layers-header-title d-flex align-items-center"},(0,e.jsx)("span",{className:"ml-2"},u("layers"))),(0,e.jsx)("div",{className:"map-layers-header-icons d-flex"},p&&!f&&(0,e.jsx)(i.Dropdown,{className:"map-layers-batch-action-dropdown","aria-label":u("batchOptions")},(0,e.jsx)(i.Tooltip,{role:"tooltip",title:u("batchOptions"),enterDelay:1e3,enterNextDelay:1e3,placement:"top"},(0,e.jsx)(i.DropdownButton,{icon:!0,arrow:!1,variant:"text"},(0,e.jsx)(We,null))),(0,e.jsx)(i.DropdownMenu,null,d&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.DropdownItem,{onClick:b(!0)},u("turnOnAllLayers")),(0,e.jsx)(i.DropdownItem,{onClick:b(!1)},u("turnOffAllLayers")),(0,e.jsx)(i.DropdownItem,{divider:!0})),(0,e.jsx)(i.DropdownItem,{onClick:v(!0)},u("expandAllLayers")),(0,e.jsx)(i.DropdownItem,{onClick:v(!1)},u("collapseAllLayers")))),c&&(0,e.jsx)(i.Tooltip,{role:"tooltip",title:u("SearchLabel"),enterDelay:1e3,enterNextDelay:1e3,placement:"top"},(0,e.jsx)(i.Button,{variant:"text",className:"map-layers-search-btn",icon:!0,onClick:()=>{h(!f)},"aria-label":u("SearchLabel")},(0,e.jsx)(Te,null))))):null}var Ge=function(e,t,i,a){return new(i||(i=Promise))((function(r,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((a=a.apply(e,t||[])).next())}))};const Ue=Object.assign({},r,i.defaultMessages);var Ke;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(Ke||(Ke={}));class qe extends e.React.PureComponent{constructor(t){super(t),this.translate=e=>this.props.intl.formatMessage({id:e,defaultMessage:Ue[e]}),this.defineLayerListActionsGenerator=(e=!1)=>t=>Ge(this,void 0,void 0,(function*(){var i,a,r,n,s,o,l,c,p;const d=t.item;let u={};d.actionsSections=[],!e&&(null===(i=this.props.config)||void 0===i?void 0:i.useMapWidget)&&(null===(a=this.props.config)||void 0===a?void 0:a.enableLegend)&&d.layer.legendEnabled&&("string"==typeof(null===(r=d.layer)||void 0===r?void 0:r.id)&&d.layer.id.startsWith("jimu-draw")||(d.panel={content:"legend",open:d.layer.visible&&(null===(n=this.props.config)||void 0===n?void 0:n.showAllLegend)})),this.layerListActions.forEach((t=>{if(t.isValid(d,e)){let e=u[t.group];e||(e=[],u[t.group]=e),e.push({id:t.id,title:t.title,className:t.className})}}));const f=null===(s=this.props.enableDataAction)||void 0===s||s,h=Object.keys(u).length-1;!f&&h<=1&&!u[1]&&!u[7]?delete u[100]:u={OPTION_ACTION_INDEX:u[100]};const g=null===(c=null===(l=null===(o=this.props)||void 0===o?void 0:o.config)||void 0===l?void 0:l.customizeLayerOptions)||void 0===c?void 0:c[this.state.jimuMapViewId];if(g&&g.isEnabled){const e=new Set(null==g?void 0:g.hiddenJimuLayerViewIds),t=new Set(null==g?void 0:g.showJimuLayerViewIds),i=this.jimuMapView.getJimuLayerViewIdByAPILayer(d.layer);e.has(i)&&(d.hidden=!0),(null==g?void 0:g.showJimuLayerViewIds)&&(d.hidden=!t.has(i)),this.isLayerFromRuntime(d.layer)&&(d.hidden=!(null===(p=null==g?void 0:g.showRuntimeAddedLayers)||void 0===p||p)),this.isSpecialLayer(d.layer)&&(d.hidden=!1)}Object.entries(u).sort(((e,t)=>Number(e[0])-Number(t[0]))).forEach((([e,t])=>{d.actionsSections.push(t)}))})),this.onLayerListActionsTriggered=(t,i=!1)=>{var a;const r=t.action,n=t.item,s=this.layerListActions.find((e=>e.id===r.id));if("option-action"===s.id){const t=this.layerListActions.filter((e=>e.isValid(n,i)&&"option-action"!==e.id)),r=t.length>0,s=null===(a=this.props.enableDataAction)||void 0===a||a;setTimeout((()=>{const i=(0,e.jsx)(m,{widgetId:this.props.id,jimuMapView:this.jimuMapView,mapDataSource:this.dataSource,actionObjects:t,listItem:n,onActionListItemClick:()=>{this.onActionListItemClick()},enableDataAction:s,shouldHideEmptyList:r,optionBtnRef:this.optionBtnRef});this.setState({actionListDOM:i})}),0)}else{const e=s.execute(n);e&&this.setState({nativeActionPopper:e})}},this.onActiveViewChange=e=>{const t=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];e&&e.view||!t?(this.jmvFromMap=e,this.viewFromMapWidget=e&&e.view,this.setState({nativeActionPopper:null},(function(){this.setState({mapWidgetId:t,jimuMapViewId:e.id})}))):this.destroyLayerList()},this.onDataSourceCreated=e=>{this.dataSource=e,this.setState({mapDataSourceId:e.id})},this.isLayerFromRuntime=t=>!this.isSpecialLayer(t)&&t[e.ExBAddedJSAPIProperties.EXB_LAYER_FROM_RUNTIME],this.onToggleActionsPopper=()=>{if(this.setState({isActionListPopperOpen:!1,actionListDOM:null}),(0,e.isKeyboardMode)()){const t=(0,i.getFocusableElements)(this.optionBtnRef.current);(0,e.focusElementInKeyboardMode)(t[0])}},this.toggleExpand=(e,t)=>{for(const i of e)i.open=t,i.children&&this.toggleExpand(i.children,t)},this.state={mapWidgetId:null,mapDataSourceId:null,jimuMapViewId:null,listLoadStatus:Ke.Pending,isActionListPopperOpen:!1,actionListDOM:null,tableLoadStatus:Ke.Pending,nativeActionPopper:null},this.renderPromise=Promise.resolve(),this.layerListActions=function(e){const t=e.translate;return[new x(e,t("goto")),new S(e,t("showLabels"),t("hideLabels")),new ye(e,t("transparency")),new be(e,t("information")),new ve(e,t("options")),new Le(e,t("enablePopup"),t("disablePopup")),new Ve(e,t("visibilityRange"))]}(this),this.mapContainerRef=e.React.createRef(),this.layerListContainerRef=e.React.createRef(),this.tableListContainerRef=e.React.createRef(),this.optionBtnRef=e.React.createRef(),this.layerListRef=e.React.createRef(),this.tableListRef=e.React.createRef()}componentDidMount(){this.bindClickHandler()}componentDidUpdate(e,t){var i,a;this.props.isDesignMode&&this.props.isDesignMode!==e.isDesignMode&&this.setState({nativeActionPopper:null}),this.needToPreventRefreshList(e,t)||(this.props.enableDataAction===e.enableDataAction&&this.props.config===e.config||(this.optionBtnRef.current=null,this.setState({isActionListPopperOpen:!1})),this.bindClickHandler(),(null===(i=this.props.config)||void 0===i?void 0:i.showTables)===(null===(a=e.config)||void 0===a?void 0:a.showTables)?((this.props.config.useMapWidget&&this.state.mapWidgetId===this.currentUseMapWidgetId||!this.props.config.useMapWidget&&this.state.mapDataSourceId===this.currentUseDataSourceId)&&this.syncRenderer(this.renderPromise),!this.props.config.popup&&e.config.popup&&this.restoreLayerPopupField()):this.renderTableList())}restoreLayerPopupField(){const t=e.MutableStoreManager.getInstance().getStateValue([this.props.widgetId,"popup"])||{};for(const e of Object.values(t))e.layer.popupEnabled=e.initialValue;t&&e.MutableStoreManager.getInstance().updateStateValue(this.props.widgetId,"popup",null)}bindClickHandler(){const e=e=>{e&&!e.onclick&&(e.onclick=e=>{const t=e.target;"CALCITE-ACTION"===t.nodeName&&t.title===this.translate("options")&&(this.optionBtnRef.current!==t?(this.optionBtnRef.current=t,this.setState({isActionListPopperOpen:!0,nativeActionPopper:null})):this.setState({isActionListPopperOpen:!this.state.isActionListPopperOpen,nativeActionPopper:null}))})};e(this.layerListContainerRef.current),e(this.tableListContainerRef.current)}needToPreventRefreshList(e,t){return t.isActionListPopperOpen!==this.state.isActionListPopperOpen||t.nativeActionPopper!==this.state.nativeActionPopper||t.listLoadStatus!==this.state.listLoadStatus||t.tableLoadStatus!==this.state.tableLoadStatus||(t.actionListDOM!==this.state.actionListDOM||(t.tableLoadStatus!==this.state.tableLoadStatus||this.props.isDesignMode!==e.isDesignMode))}createView(){return Ge(this,void 0,void 0,(function*(){return this.props.config.useMapWidget?this.viewFromMapWidget:yield this.createViewByDataSource()}))}createViewByDataSource(){return Ge(this,void 0,void 0,(function*(){return yield this.loadViewModules(this.dataSource),this.dataSource.type===e.DataSourceTypes.WebMap?yield new Promise(((e,t)=>{this.createWebMapView(this.MapView,e,t)})):this.dataSource.type===e.DataSourceTypes.WebScene?new Promise(((e,t)=>{this.createSceneView(this.SceneView,e,t)})):Promise.reject(new Error(null))}))}createWebMapView(e,t,i){if(this.mapView)this.mapView.map=this.dataSource.map;else{const t={map:this.dataSource.map,container:this.mapContainerRef.current};this.mapView=new e(t)}this.mapView.when((()=>{t(this.mapView)}),(e=>i(e)))}createSceneView(e,t,i){if(this.sceneView)this.sceneView.map=this.dataSource.map;else{const t={map:this.dataSource.map,container:this.mapContainerRef.current};this.sceneView=new e(t)}this.sceneView.when((()=>{t(this.sceneView)}),(e=>i(e)))}destroyView(){this.mapView&&!this.mapView.destroyed&&this.mapView.destroy(),this.sceneView&&!this.sceneView.destroyed&&this.sceneView.destroy()}getModule(e,i,a){return Ge(this,void 0,void 0,(function*(){const r=i();if(r)return r;const n=yield(0,t.loadArcGISJSAPIModules)([e]);return a(n[0]),n[0]}))}loadViewModules(t){return Ge(this,void 0,void 0,(function*(){let i=null;return t.type===e.DataSourceTypes.WebMap?i=yield this.getModule("esri/views/MapView",(()=>this.MapView),(e=>{this.MapView=e})):t.type===e.DataSourceTypes.WebScene&&(i=yield this.getModule("esri/views/SceneView",(()=>this.SceneView),(e=>{this.SceneView=e}))),i}))}destroyTableList(){this.tableListRef.current&&!this.tableListRef.current.destroyed&&this.tableListRef.current.destroy()}destroyLayerList(){this.layerListRef.current&&!this.layerListRef.current.destroyed&&this.layerListRef.current.destroy()}createTableList(e){return Ge(this,void 0,void 0,(function*(){var t;this.setState({tableLoadStatus:Ke.Pending}),yield this.getModule("esri/widgets/TableList",(()=>this.TableList),(e=>{this.TableList=e}));const i=document&&document.createElement("div");return i.className="table-list",this.tableListContainerRef.current.appendChild(i),this.destroyTableList(),this.tableListRef.current=new this.TableList({container:i,map:e.map,dragEnabled:null===(t=this.props.config)||void 0===t?void 0:t.reorderLayers,listItemCreatedFunction:this.defineLayerListActionsGenerator(!0)}),this.tableListRef.current.on("trigger-action",(e=>{this.onLayerListActionsTriggered(e,!0)})),this.tableListRef.current}))}createLayerList(e){return Ge(this,void 0,void 0,(function*(){var i,a,r;if(this.setState({listLoadStatus:Ke.Pending}),!this.LayerList){const e=yield(0,t.loadArcGISJSAPIModules)(["esri/widgets/LayerList"]);this.LayerList=e[0]}const n=document&&document.createElement("div");n.className="jimu-widget",this.layerListContainerRef.current.appendChild(n),this.destroyLayerList();let s={view:e,listItemCreatedFunction:this.defineLayerListActionsGenerator(!1),container:n};this.props.config.useMapWidget&&(s=Object.assign(Object.assign({},s),{dragEnabled:null!==(a=null===(i=this.props.config)||void 0===i?void 0:i.reorderLayers)&&void 0!==a&&a,visibilityAppearance:(null===(r=this.props.config)||void 0===r?void 0:r.useTickBoxes)?"checkbox":"default"}));const o=new this.LayerList(s);o.on("trigger-action",(e=>{this.onLayerListActionsTriggered(e)})),o.when((()=>{this.props.config.expandAllLayers&&this.toggleExpand(o.operationalItems,!0)})),this.layerListRef.current=o}))}onActionListItemClick(){setTimeout((()=>{this.setState({isActionListPopperOpen:!1})}),100)}renderLayerList(){return Ge(this,void 0,void 0,(function*(){var e;try{const t=yield this.createView();(null===(e=this.props.config)||void 0===e?void 0:e.showTables)&&(yield this.renderTableList()),yield this.createLayerList(t),this.setState({listLoadStatus:Ke.Fulfilled})}catch(e){console.error(e)}}))}renderTableList(){return Ge(this,void 0,void 0,(function*(){var e;try{const t=yield this.createView();(null===(e=this.props.config)||void 0===e?void 0:e.showTables)?(yield this.createTableList(t),this.setState({tableLoadStatus:Ke.Fulfilled})):this.destroyTableList()}catch(e){console.error(e)}}))}syncRenderer(e){return Ge(this,void 0,void 0,(function*(){this.jimuMapView=t.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId),this.jimuMapView&&(yield this.jimuMapView.whenJimuMapViewLoaded()),yield e,this.renderPromise=this.renderLayerList()}))}isSpecialLayer(e){let t=e.parent;const i=["esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.KMLLayer","esri.layers.CatalogLayer"];for(;t;){if(i.includes(t.declaredClass))return!0;t=t.parent}return!1}render(){var r,n,s,o;const c=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],p=this.props.useDataSources&&this.props.useDataSources[0];this.currentUseMapWidgetId=c,this.currentUseDataSourceId=p&&p.dataSourceId;let d=null;this.props.config.useMapWidget?d=(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(r=this.props.useMapWidgetIds)||void 0===r?void 0:r[0],onActiveViewChange:this.onActiveViewChange}):p&&(d=(0,e.jsx)(e.DataSourceComponent,{useDataSource:p,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:e=>{console.error(e)}}));let u=null;if(this.props.config.useMapWidget?c:p){let t=null;this.state.listLoadStatus===Ke.Pending&&(t=(0,e.jsx)("div",{className:"jimu-secondary-loading"})),u=(0,e.jsx)("div",{className:`widget-layerlist widget-layerlist_${this.props.id}`},!t&&(0,e.jsx)($e,{theme:this.props.theme,jimuMapViewId:this.state.jimuMapViewId,layerListRef:this.layerListRef,tableListRef:this.tableListRef,enableSearch:null!==(n=this.props.config.searchLayers)&&void 0!==n&&n,enableBatchOption:null!==(s=this.props.config.layerBatchOptions)&&void 0!==s&&s,isMapWidgetMode:null===(o=this.props.config)||void 0===o?void 0:o.useMapWidget}),(0,e.jsx)("div",{ref:this.layerListContainerRef}),this.props.config.showTables&&(0,e.jsx)(e.React.Fragment,null,null===t&&this.state.tableLoadStatus===Ke.Fulfilled&&(0,e.jsx)("div",{className:"table-list-divider d-flex align-items-center"},(0,e.jsx)(w,null),(0,e.jsx)("span",{className:"ml-1"},this.translate("tables"))),null===t&&this.state.tableLoadStatus===Ke.Pending&&(0,e.jsx)(i.Loading,{type:"DOTS_PRIMARY"}),(0,e.jsx)("div",{ref:this.tableListContainerRef,className:"table-list-wrapper"})),(0,e.jsx)("div",{style:{position:"absolute",opacity:0},ref:this.mapContainerRef},"mapContainer"),(0,e.jsx)("div",{style:{position:"absolute",display:"none"}},d))}else this.destroyLayerList(),u=(0,e.jsx)("div",{className:"widget-layerlist"},(0,e.jsx)(i.WidgetPlaceholder,{icon:l(),message:this.translate("_widgetLabel"),widgetId:this.props.id}));return(0,e.jsx)("div",{css:a(this.props.theme,this.props.config),className:"jimu-widget"},u,(0,e.jsx)(i.Popper,{style:{minWidth:"170px"},keepMount:!0,reference:this.optionBtnRef.current,open:this.state.isActionListPopperOpen,toggle:this.onToggleActionsPopper},this.state.actionListDOM),this.state.nativeActionPopper)}}qe.mapExtraStateProps=(t,i)=>({isDesignMode:t.appRuntimeInfo.appMode===e.AppMode.Design}),qe.versionManager=p;const Ye=qe;function Ze(e){s.p=e}})(),o})())}}}));