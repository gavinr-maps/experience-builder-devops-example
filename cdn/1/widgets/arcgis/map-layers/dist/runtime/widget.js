System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-ui","jimu-theme","esri/core/reactiveUtils","jimu-ui/advanced/map"],function(e,t){var i={},s={},a={},r={},o={},n={},l={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){s.AppMode=e.AppMode,s.BaseVersionManager=e.BaseVersionManager,s.CONSTANTS=e.CONSTANTS,s.DataSourceComponent=e.DataSourceComponent,s.DataSourceTypes=e.DataSourceTypes,s.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties,s.MutableStoreManager=e.MutableStoreManager,s.React=e.React,s.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,s.appActions=e.appActions,s.classNames=e.classNames,s.css=e.css,s.focusElementInKeyboardMode=e.focusElementInKeyboardMode,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.isKeyboardMode=e.isKeyboardMode,s.lodash=e.lodash,s.polished=e.polished,s.portalUrlUtils=e.portalUrlUtils,s.semver=e.semver,s.utils=e.utils},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent,a.MapViewManager=e.MapViewManager,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.zoomToUtils=e.zoomToUtils},function(e){r.Button=e.Button,r.DataActionList=e.DataActionList,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.FloatingPanel=e.FloatingPanel,r.Label=e.Label,r.Loading=e.Loading,r.LoadingType=e.LoadingType,r.Paper=e.Paper,r.Popper=e.Popper,r.Radio=e.Radio,r.Slider=e.Slider,r.TextInput=e.TextInput,r.WidgetPlaceholder=e.WidgetPlaceholder,r.defaultMessages=e.defaultMessages,r.getFocusableElements=e.getFocusableElements},function(e){o.styled=e.styled,o.useTheme=e.useTheme},function(e){n.watch=e.watch},function(e){l.JimuSymbolType=e.JimuSymbolType,l.SymbolList=e.SymbolList}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=o},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},14321:e=>{"use strict";e.exports=r},18249:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h14v12H1zm13 1H2v4h12zm0 5h-3v2h3zm0 3h-3v2h3zm-4 2v-2H6v2zm-5 0v-2H2v2zm-3-3h3V8H2zm8-2v2H6V8z" clip-rule="evenodd"></path></svg>'},40283:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.795 5.281c.387-.387 1.028-.373 1.432.03l1.461 1.462c.404.404.417 1.045.03 1.432L8.414 14.51l-2.674.48a.636.636 0 0 1-.73-.73l.48-2.673zm-5.362 6.825-.32 1.782 1.782-.32 3.99-3.992-1.461-1.462zm4.692-4.693 1.46 1.462 1.402-1.401-1.462-1.461zM4 1a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},43052:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#100" fill-rule="evenodd" d="M1 9H0V8h1zm2-1H2v1h1zm10 1h1V8h-1zm3-1h-1v1h1zM5 9h6v1h1V7h-1v1H5V7H4v3h1zm4-5.5a2.5 2.5 0 1 1 3 2.45v.55h-1v-.55A2.5 2.5 0 0 1 9 3.5m1 0a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0m-8 10a2.5 2.5 0 0 1 2-2.45v-.55h1v.55a2.5 2.5 0 1 1-3 2.45m1 0a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=l},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},62243:e=>{"use strict";e.exports=n},62686:e=>{"use strict";e.exports=a},67386:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=s},85643:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4 11V4h7V1H1v10zm1-6v10h10V5zm9 9H6V6h8z" clip-rule="evenodd"></path><path fill="#000" d="M6 6h5v5H6z" opacity=".5"></path></svg>'},88775:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M10.226.054a.5.5 0 0 0-.451 0L.25 4.942a.446.446 0 0 0 .025.813L9.8 9.958a.5.5 0 0 0 .4 0l9.524-4.203a.446.446 0 0 0 .025-.813zM10 9.044 1.542 5.313 10 .97l8.458 4.34z" clip-rule="evenodd"></path><path fill="#000" d="M.676 10.04a.493.493 0 0 0-.632.216c-.11.22-.006.482.232.585L10 15l9.724-4.16c.238-.102.342-.363.232-.584a.493.493 0 0 0-.632-.215L10 14.029z"></path><path fill="#000" fill-rule="evenodd" d="M.676 15.04a.493.493 0 0 0-.632.216c-.11.22-.006.482.232.585L10 20l9.724-4.16c.238-.102.342-.363.232-.584a.493.493 0 0 0-.632-.215L10 19.029zM10 19.03l.2.085h-.4z" clip-rule="evenodd"></path></svg>'}},t={};function c(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,c),a.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{LoadStatus:()=>Pe,Widget:()=>Ie,__set_webpack_public_path__:()=>Re,default:()=>Ae});var e=c(67386),t=c(79244),i=c(62686),s=c(14321);const a={_widgetLabel:"Map Layers",goto:"Zoom to",information:"Details",showLabels:"Show labels",hideLabels:"Hide labels",emptyListTip:"There are currently no items to display",enablePopup:"Enable pop-up",disablePopup:"Disable pop-up",tables:"Tables",visibilityRange:"Visibility range",changeSymbol:"Change symbol",usePredefinedSymbols:"Use predefined symbols",useCustomSymbols:"Use custom symbols"};var r=c(88775),o=c.n(r);class n extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.12.0",description:"disable old app data-action, delete unused config prop selectedJimuLayerIds",upgrader:e=>{let t=e;return t=t.without("selectedJimuLayerIds"),t}}]}}const l=new n;var p,u=c(1888);!function(e){e[e.Goto=0]="Goto",e[e.Label=1]="Label",e[e.Popup=2]="Popup",e[e.Transparency=3]="Transparency",e[e.VisibilityRange=4]="VisibilityRange",e[e.Information=5]="Information",e[e.ChangeSymbol=6]="ChangeSymbol",e[e.Remove=7]="Remove",e[e.Option=100]="Option"}(p||(p={}));var h=function(e,t,i,s){return new(i||(i=Promise))(function(a,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function n(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,n)}l((s=s.apply(e,t||[])).next())})};const y=u.styled.div`
  min-width: 120px;
  min-height: 20px;
`,m=t.css`
  .jimu-dropdown-item.jimu-dropdown-item-header {
    display: flex;
    justify-content: center;
  }
  .jimu-dropdown {
    .jimu-dropdown-item {
      display: flex;
      justify-content: center;
    }
  }
`;function g(t){const{icon:i,title:a,onClick:r}=t;return(0,e.jsx)(s.DropdownItem,{onClick:r,children:(0,e.jsxs)("div",{className:"d-flex align-items-center",children:["string"==typeof i?(0,e.jsx)("div",{className:`jimu-icon-auto-color ${i}`}):i,(0,e.jsx)("span",{className:"ml-2",children:a})]})})}function f(i){const{widgetId:a,actionObjects:r,listItem:o,onActionListItemClick:n,jimuMapView:l,shouldHideEmptyList:c,enableDataAction:d=!0,mapDataSource:u,optionBtnRef:f}=i,[v,b]=t.React.useState(null),[w,S]=t.React.useState(d),L=t.React.useRef(null),x=(t,i,s)=>{const a=(null==t?void 0:t.icon)||t.className,r=t.title;if(s&&t.group===p.Remove)return;return(0,e.jsx)(g,{icon:a,title:r,onClick:()=>{t.execute(o),n()}},i)};return t.React.useEffect(()=>{d&&function(){h(this,void 0,void 0,function*(){let t=[];try{let e=null;if(u)e=u.getDataSourceByLayer(o.layer);else if(l){const t=null==l?void 0:l.getJimuLayerViewByAPILayer(o.layer);e=t?yield t.getOrCreateLayerDataSource():yield l.getMapDataSource().createDataSourceByLayer(o.layer)}t=e?[{dataSource:e,records:[],name:null==e?void 0:e.getLabel()}]:[]}catch(e){console.error("DataSource create error:",e)}finally{if(L.current){const i=(0,e.jsx)("div",{className:"data-action-list-wrapper",css:m,children:(0,e.jsx)(s.DataActionList,{widgetId:a,dataSets:t,hideGroupTitle:!0,shouldHideEmptyList:c,onActionListItemClick:n,actionPanelRefDOM:f.current,whenListLoaded:()=>{S(!1)}},Math.random())});b(i)}}})}()},[d,o.layer,n,c,a,l,u,f]),(0,e.jsxs)(y,{ref:L,children:[r.map((e,t)=>x(e,t,!0)),d&&v,!w&&r.filter(e=>e.group===p.Remove).map(e=>x(e,"remove-key"))]})}var v=c(18249),b=c.n(v),w=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const S=i=>{const s=window.SVG,{className:a}=i,r=w(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:b()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};class L{constructor(){this.id="id",this.title="title",this.className="esri-icon",this.group=0,this.widget=null,this.icon=null,this.isValid=(e,t=!1)=>!1,this.execute=e=>{}}useMapWidget(){return this.widget.props.config.useMapWidget}}class x extends L{constructor(e,t){super(),this.isValid=(e,t)=>!t&&("esri.layers.GroupLayer"!==e.layer.declaredClass&&((!e.parent||"esri.layers.GroupLayer"===e.parent.layer.declaredClass)&&!(!this.useMapWidget()||!this.widget.props.config.goto))),this.execute=e=>{this.widget.viewFromMapWidget&&i.zoomToUtils.zoomTo(this.widget.viewFromMapWidget,e.layer,{padding:{top:50,bottom:50,left:50,right:50}})},this.id="goto",this.title=t,this.className="esri-icon-zoom-out-fixed",this.group=p.Goto,this.widget=e}}class j extends L{constructor(e,t,i){super(),this.isValid=(e,t)=>{var i;return!t&&(("string"!=typeof e.layer.id||!e.layer.id.startsWith("jimu-draw"))&&(this.title=e.layer.labelsVisible?this.titleHide:this.titleShow,!!(this.useMapWidget()&&this.widget.props.config.label&&(null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.labelingInfo))))},this.execute=e=>{e.layer.labelsVisible=!e.layer.labelsVisible},this.id="label",this.className="esri-icon-labels label-action-title",this.group=p.Label,this.widget=e,this.titleShow=t,this.titleHide=i}}const{useState:M,useCallback:P}=t.React,I=(e,t)=>["ar","tr"].includes(e)?`%${t}`:`${t}%`;function A(i){const{widget:a,listItem:r}=i,[o,n]=M(!0),{isRTL:l,locale:c}=(0,t.getAppStore)().getState().appContext,d=P(()=>{n(!1),a.setState({nativeActionPopper:null})},[a]);return(0,e.jsx)(s.FloatingPanel,{toggle:(e,t)=>{"clickOutside"!==t&&d()},headerTitle:a.translate("transparency"),reference:a.optionBtnRef.current,open:o,className:"transparency-panel",onHeaderClose:d,css:t.css`
    .transparency-panel-container {
      width: 320px;
      padding: 1rem;
      .transparency-panel-title {
        display: block;
        -webkit-box-orient: vertical;
        word-break: break-all;
        white-space: normal;
        -webkit-line-clamp: 1;
        font-size: ${t.polished.rem(14)};
      }
      .transparency-slider {
        padding-bottom: 0.3rem;
        padding-top: 0.4rem;
        margin-top: 1.1rem;
      }
      .transparency-slider-meters {
        span {
          font-size: 5px;
        }
      }
    }
  `,autoSize:!0,children:(0,e.jsxs)("div",{className:"transparency-panel-container",children:[(0,e.jsx)("span",{title:r.layer.title,className:"transparency-panel-title",children:r.layer.title}),(0,e.jsx)(s.Slider,{className:(0,t.classNames)("transparency-slider",l?"rtl":"ltr"),defaultValue:1-r.layer.opacity,min:0,max:1,step:.01,onChange:e=>{const t=Number.parseFloat(e.target.value);r.layer.opacity=1-t},tooltip:!0,formatter:e=>t.utils.formatPercentageNumber((100*e).toFixed(0)+"%")}),(0,e.jsx)("div",{className:"d-flex justify-content-center transparency-slider-meters",children:(0,e.jsx)("span",{children:"|"})}),(0,e.jsxs)("div",{className:"d-flex justify-content-between transparency-slider-label",dir:"ltr",children:[(0,e.jsx)("span",{style:{width:"28px",textAlign:"left"},children:"0"}),(0,e.jsx)("span",{children:I(c,"50")}),(0,e.jsx)("span",{children:I(c,"100")})]})]})})}var R=c(85643),O=c.n(R),V=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const N=i=>{const s=window.SVG,{className:a}=i,r=V(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:O()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};class E extends L{constructor(t,i){super(),this.isValid=(e,t)=>!t&&((!e.parent||"esri.layers.GroupLayer"===e.parent.layer.declaredClass)&&!(!this.useMapWidget()||!this.widget.props.config.opacity)),this.execute=t=>{const i=(0,e.jsx)(A,{widget:this.widget,listItem:t});this.widget.setState({nativeActionPopper:i})},this.id="transparency",this.title=i,this.className="esri-icon-sliders-horizontal",this.group=p.Transparency,this.widget=t,this.icon=(0,e.jsx)(N,{})}}class T extends L{constructor(e,i){super(),this.isValid=e=>!(!e.layer.url||!this.widget.props.config.information),this.execute=e=>{var i;const s=e.layer,a=null==s?void 0:s.portalItem;if((null===(i=null==a?void 0:a.portal)||void 0===i?void 0:i.url)&&a.id){const e=t.portalUrlUtils.getStandardPortalUrl(a.portal.url)+`/home/item.html?id=${a.id}`;window.open(e)}else{const e="feature"===(null==s?void 0:s.type)?`${s.url}/${s.layerId}`:s.url;window.open(e)}},this.id="information",this.title=i,this.className="esri-icon-description",this.group=p.Information,this.widget=e}}class C extends L{constructor(e,t){super(),this.isValid=e=>!0,this.execute=e=>{},this.id="option-action",this.title=t,this.className="esri-icon-handle-horizontal",this.group=p.Option,this.widget=e}}const D=[t.SupportedJSAPILayerTypes.FeatureLayer,t.SupportedJSAPILayerTypes.CSVLayer,t.SupportedJSAPILayerTypes.ImageryLayer,t.SupportedJSAPILayerTypes.ImageryTileLayer,t.SupportedJSAPILayerTypes.GeoJSONLayer,t.SupportedJSAPILayerTypes.SubtypeSublayer,"sublayer"];class k extends L{constructor(e,i,s){super(),this.isValid=e=>{var i;const s=e.layer;if("string"==typeof s.id&&s.id.startsWith("jimu-draw"))return!1;const a=this.widget.jmvFromMap,r=this.widget.props.widgetId,o=t.MutableStoreManager.getInstance().getStateValue([r,"popup",s.id]);if(s&&(null===(i=this.widget.props.config)||void 0===i?void 0:i.popup)&&D.includes(s.type)){const e=s.popupEnabled&&(null==a?void 0:a.isClickOpenPopupEnabled())||(null==o?void 0:o.popupEnabled);return this.title=e?this.disableTitle:this.enableTitle,!0}return!1},this.execute=e=>{const i=e.layer,s=this.widget.jmvFromMap,a=this.widget.props.widgetId,r=t.MutableStoreManager.getInstance(),o=r.getStateValue([a,"popup",i.id]),n=o||{};void 0===(null==o?void 0:o.initialValue)&&(n.initialValue=i.popupEnabled,n.layer=i),this.title===this.disableTitle?(i.popupEnabled=!1,s.disableLayerPopup(i),n.popupEnabled=!1):(i.popupEnabled=!0,s.enableLayerPopup(i,!0),n.popupEnabled=!0),r.updateStateValue(a,`popup.${i.id}`,n)},this.id="popup",this.className="esri-icon-configure-popup",this.group=p.Popup,this.widget=e,this.enableTitle=i,this.disableTitle=s}}var B=c(62243);const{useState:J,useCallback:W,useRef:F,useEffect:z}=t.React,_=e=>t.css`
    .visibility-range-container {
      min-width: 342px;
      .visibility-range-panel-title {
        display: block;
        -webkit-box-orient: vertical;
        word-break: break-all;
        white-space: normal;
        -webkit-line-clamp: 1;
        font-size: ${t.polished.rem(14)};
        padding: 1rem 1rem 0 1rem;
      }
      .scale-range-slider-container {
        padding: 1rem;
        .esri-widget {
          --calcite-button-text-color: var(--sys-color-surface-overlay-text);
          --calcite-dropdown-item-background-color-hover: var(--sys-color-action-hover);
          background-color: unset;
          color: unset;
          font-family: ${e.sys.typography.body.fontFamily};
          .esri-scale-range-slider__segment-active {
            background: var(--sys-color-action-selected);
          }
        }
      }
    }
  `;function G(i){const{widget:a,listItem:r,scaleRangeSliderClass:o}=i,[n,l]=J(!0),[c,d]=J(null),p=F(null),h=(0,u.useTheme)();z(()=>{var e,i;if(!c){const s=null===(i=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appContext)||void 0===i?void 0:i.locale;let n="US";if(s){const e=s.split("-");if((null==e?void 0:e.length)>0){const t=e[e.length-1];if(t){const e=t.toUpperCase();["AE","AR","AT","AU","BE","BG","BO","BR","CA","CH","CI","CL","CN","CO","CR","CZ","DE","DK","EE","EG","ES","FI","FR","GB","GL","GR","GT","HK","ID","IE","IL","IN","IQ","IS","IT","JP","KE","KR","KW","LI","LT","LU","LV","MA","MG","ML","MO","MX","MY","NI","NL","NO","NZ","PE","PL","PR","PT","RO","RU","RW","SE","SG","SK","SR","SV","TH","TN","TW","US","VE","VI","ZA"].includes(e)&&(n=e)}}}const l=new o({view:a.jmvFromMap.view,layer:r.layer,region:n,container:p.current});d(l),B.watch(()=>[l.minScale,l.maxScale],function([e,t]){r.layer.minScale=e,r.layer.maxScale=t})}},[r.layer,c,o,a.jmvFromMap.view]);const y=W(()=>{l(!1),a.setState({nativeActionPopper:null})},[a]);return(0,e.jsx)(s.FloatingPanel,{toggle:(e,t)=>{"clickOutside"!==t&&y()},headerTitle:a.translate("visibilityRange"),reference:a.optionBtnRef.current,open:n,className:"visibility-range-panel",autoSize:!0,onHeaderClose:y,css:_(h),children:(0,e.jsxs)("div",{className:"visibility-range-container",children:[(0,e.jsx)("span",{title:r.layer.title,className:"visibility-range-panel-title",children:r.layer.title}),(0,e.jsx)("div",{className:"scale-range-slider-container",children:(0,e.jsx)("div",{ref:p,className:"scale-range-slider"})})]})})}var H=c(43052),U=c.n(H),K=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const $=i=>{const s=window.SVG,{className:a}=i,r=K(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:U()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};class X extends L{constructor(t,i){super(),this.isValid=(e,t)=>!t&&(!(!this.useMapWidget()||!this.widget.props.config.visibilityRange)&&(this.widget.getModule("esri/widgets/ScaleRangeSlider",()=>this.ScaleRangeSlider,e=>{this.ScaleRangeSlider=e}),!0)),this.execute=t=>{const i=(0,e.jsx)(G,{widget:this.widget,listItem:t,scaleRangeSliderClass:this.ScaleRangeSlider});this.widget.setState({nativeActionPopper:i})},this.id="visibility-range",this.title=i,this.className="esri-icon-sliders-horizontal",this.group=p.VisibilityRange,this.widget=t,this.ScaleRangeSlider=null,this.icon=(0,e.jsx)($,{})}}var Y=c(48993);const{useState:Z,useCallback:Q}=t.React,q=e=>t.css`
    .change-symbol-container {
      width: 320px;
      .change-symbol-title {
        display: block;
        -webkit-box-orient: vertical;
        word-break: break-all;
        white-space: normal;
        -webkit-line-clamp: 1;
        font-size: ${t.polished.rem(14)};
        padding: 1rem 1rem 0 1rem;
      }
      .change-symbol-options {
        margin-left: 1rem;
        margin-top: 0.5rem;
        .radio-option {
          margin-right: 0.25rem;
        }
      }
      .symbol-list-container {
        min-height: ${e===Y.JimuSymbolType.Point?"294px":"238px"};
      }
    }
  `;function ee(i){var a;const{widget:r,listItem:o,symbolType:n}=i,[l,c]=Z(o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER]?"custom":"predefined"),[d,p]=Z(!0),[u,h]=Z(!!o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER]),y=Q(()=>{p(!1),r.setState({nativeActionPopper:null})},[r]),m=Q(e=>{r.state.jimuMapViewId&&(c(e.target.value),"predefined"===e.target.value&&o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER]&&(o.layer.renderer=o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER],delete o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER],h(!1)))},[o.layer,r]),g=Q(e=>{o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER]||(o.layer[t.ExBAddedJSAPIProperties.EXB_PREDEFINED_RENDERER]=o.layer.renderer),h(!0),o.layer.renderer={type:"simple",symbol:e}},[o.layer]);return(0,e.jsx)(s.FloatingPanel,{toggle:(e,t)=>{"clickOutside"!==t&&y()},headerTitle:r.translate("changeSymbol"),reference:r.optionBtnRef.current,open:d,className:"change-symbol-popper-panel",onHeaderClose:y,css:q(n),autoSize:!0,shiftOptions:{crossAxis:!0},children:(0,e.jsxs)("div",{className:"change-symbol-container pb-2",children:[(0,e.jsx)("span",{title:o.layer.title,className:"change-symbol-title",children:o.layer.title}),(0,e.jsxs)("div",{className:"change-symbol-options",role:"radiogroup",children:[(0,e.jsxs)(s.Label,{className:"d-flex align-items-center",style:{cursor:"pointer",fontWeight:"normal"},children:[(0,e.jsx)(s.Radio,{className:"radio-option",name:"predefined",value:"predefined",onChange:m,checked:"predefined"===l}),r.translate("usePredefinedSymbols")]}),(0,e.jsxs)(s.Label,{className:"d-flex align-items-center",style:{cursor:"pointer",fontWeight:"normal"},children:[(0,e.jsx)(s.Radio,{className:"radio-option",name:"custom",value:"custom",onChange:m,checked:"custom"===l}),r.translate("useCustomSymbols")]})]}),"custom"===l&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)("div",{className:"px-4 pt-2 pb-1 align-items-center",style:{display:u?"none":"flex",height:"40px"},children:(0,e.jsx)("div",{children:r.translate("preview")})}),(0,e.jsx)(Y.SymbolList,{symbol:u?null===(a=o.layer.renderer)||void 0===a?void 0:a.symbol:null,className:"symbol-list-container",isShow:!0,onA11yFocus:()=>{},jimuSymbolType:n,onPointSymbolChanged:g,onPolylineSymbolChanged:g,onPolygonSymbolChanged:g,showSymbolPreview:u})]})]})})}var te=c(40283),ie=c.n(te),se=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const ae=i=>{const s=window.SVG,{className:a}=i,r=se(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:ie()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};class re extends L{constructor(i,s){super(),this.isValid=(e,i)=>{if(i)return!1;if(![t.SupportedJSAPILayerTypes.FeatureLayer,t.SupportedJSAPILayerTypes.OrientedImageryLayer,t.SupportedJSAPILayerTypes.MapImageLayer,t.SupportedJSAPILayerTypes.CSVLayer,t.SupportedJSAPILayerTypes.GeoJSONLayer,t.SupportedJSAPILayerTypes.SubtypeSublayer,"sublayer"].includes(e.layer.type))return!1;if("sublayer"===e.layer.type&&!this.supportDynamicLayers(e))return!1;if(this.useMapWidget()&&this.widget.props.config.changeSymbolForRuntimeLayers){const i=["point","polyline","polygon"],s=e.layer;return s[t.ExBAddedJSAPIProperties.EXB_LAYER_FROM_RUNTIME]&&i.includes(s.geometryType)}return!1},this.supportDynamicLayers=e=>{var i,s;const a=e.layer;return!(a.layer.type!==t.SupportedJSAPILayerTypes.MapImageLayer||!(null===(s=null===(i=a.layer.capabilities)||void 0===i?void 0:i.exportMap)||void 0===s?void 0:s.supportsDynamicLayers))},this.getSymbolType=e=>{let t=null;switch(e.geometryType){case"point":t=Y.JimuSymbolType.Point;break;case"polyline":t=Y.JimuSymbolType.Polyline;break;case"polygon":t=Y.JimuSymbolType.Polygon}return t},this.execute=t=>{const i=(0,e.jsx)(ee,{widget:this.widget,listItem:t,symbolType:this.getSymbolType(t.layer)});this.widget.setState({nativeActionPopper:i})},this.id="change-symbol",this.title=s,this.className="esri-icon-edit",this.group=p.ChangeSymbol,this.widget=i,this.icon=(0,e.jsx)(ae,{})}}var oe=c(9044),ne=c.n(oe),le=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const ce=i=>{const s=window.SVG,{className:a}=i,r=le(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:ne()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};class de extends L{constructor(i,s){super(),this.isValid=e=>!!e.layer[t.ExBAddedJSAPIProperties.EXB_LAYER_FROM_RUNTIME],this.execute=e=>{var i;const s=this.widget.jmvFromMap;if(!s)return;const a=null===(i=null==s?void 0:s.view)||void 0===i?void 0:i.map;if(!a)return;const r=e.layer;if((null==r?void 0:r.id)===t.CONSTANTS.ADD_MARKER_LAYER_ID)return s.removeMarkerLayer(),void s.updateMarkerUrlParamIfActive();a.remove(r)},this.id="remove",this.title=s,this.className="esri-icon-remove",this.group=p.Remove,this.widget=i,this.icon=(0,e.jsx)(ce,{})}}var pe=c(50170),ue=c.n(pe),he=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const ye=i=>{const s=window.SVG,{className:a}=i,r=he(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:ue()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};var me=c(13424),ge=c.n(me),fe=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const ve=i=>{const s=window.SVG,{className:a}=i,r=fe(i,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:o,src:ge()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))},{useState:be,useCallback:we,useEffect:Se}=t.React,Le=e=>t=>{if(!t||!e)return!0;const i=t.layer.title.toLowerCase().includes(e.toLowerCase());let s=t;if(i)for(;s;)s.open=!0,s=s.parent;return i};function xe(r){const{theme:o,jimuMapViewId:n,layerListRef:l,tableListRef:c,enableSearch:d,enableBatchOption:p,isMapWidgetMode:u,headerKey:h,expandAllLayers:y}=r,m=t.hooks.useTranslation(a),[g,f]=be(!1),[v,b]=be(""),w=t.lodash.throttle(e=>{const t=e.target.value;b(t)},200),S=we(e=>()=>{!function(e,t){for(const i of e){i.layer.visible=t}}(i.MapViewManager.getInstance().getJimuMapViewById(n).getAllJimuLayerViews(),e)},[n]),L=we(e=>()=>{!function e(t,i){if(t)for(const s of t)s.open=i,s.children&&e(s.children,i)}(l.current.operationalItems,e)},[l]);return Se(()=>{if(""===v)return l.current&&(l.current.filterPredicate=null),c.current&&(c.current.filterPredicate=null),void(y?L(!0)():L(!1)());l.current&&(l.current.filterPredicate=Le(v)),c.current&&(c.current.filterPredicate=Le(v))},[l,v,c,y,L]),Se(()=>{d||f(!1)},[d]),Se(()=>{f(!1)},[h]),p||d?(0,e.jsxs)("div",{className:"map-layers-header d-flex justify-content-between p-1",css:t.css`
    .map-layers-header-title{
      span {
        font-size: var(--calcite-font-size-0);
        font-weight: 500;
      }
    }
    .map-layers-batch-action-dropdown {
      button: hover {
        background: var(--calcite-color-transparent-hover);
      }
    }
  `,children:[g?(0,e.jsx)(s.TextInput,{className:"w-100 mr-1",type:"text",onChange:w,autoFocus:!0,allowClear:!0}):(0,e.jsx)("div",{className:"map-layers-header-title d-flex align-items-center",children:(0,e.jsx)("span",{className:"ml-2",children:m("layers")})}),(0,e.jsxs)("div",{className:"map-layers-header-icons d-flex",children:[p&&!g&&(0,e.jsxs)(s.Dropdown,{className:"map-layers-batch-action-dropdown","aria-label":m("batchOptions"),children:[(0,e.jsx)(s.DropdownButton,{color:"inherit",icon:!0,arrow:!1,title:m("batchOptions"),variant:"text",children:(0,e.jsx)(ve,{})}),(0,e.jsxs)(s.DropdownMenu,{children:[u&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.DropdownItem,{onClick:S(!0),children:m("turnOnAllLayers")}),(0,e.jsx)(s.DropdownItem,{onClick:S(!1),children:m("turnOffAllLayers")}),(0,e.jsx)(s.DropdownItem,{divider:!0})]}),(0,e.jsx)(s.DropdownItem,{onClick:L(!0),children:m("expandAllLayers")}),(0,e.jsx)(s.DropdownItem,{onClick:L(!1),children:m("collapseAllLayers")})]})]}),d&&(0,e.jsx)(s.Button,{color:"inherit",variant:"text",title:m("SearchLabel"),className:"map-layers-search-btn",icon:!0,onClick:()=>{f(!g)},"aria-label":m("SearchLabel"),children:(0,e.jsx)(ye,{})})]})]}):null}var je=function(e,t,i,s){return new(i||(i=Promise))(function(a,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function n(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,n)}l((s=s.apply(e,t||[])).next())})};const Me=Object.assign({},a,s.defaultMessages);var Pe;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(Pe||(Pe={}));class Ie extends t.React.PureComponent{constructor(i){super(i),this.translate=e=>this.props.intl.formatMessage({id:e,defaultMessage:Me[e]}),this.defineLayerListActionsGenerator=(e=!1)=>t=>{var i,s,a,r,o,n,l,c,d;const u=t.item;let h={};u.actionsSections=[],!e&&(null===(i=this.props.config)||void 0===i?void 0:i.useMapWidget)&&(null===(s=this.props.config)||void 0===s?void 0:s.enableLegend)&&u.layer.legendEnabled&&("string"==typeof(null===(a=u.layer)||void 0===a?void 0:a.id)&&u.layer.id.startsWith("jimu-draw")||(u.panel={content:"legend",open:null===(r=this.props.config)||void 0===r?void 0:r.showAllLegend})),this.layerListActions.forEach(t=>{if(t.isValid(u,e)){let e=h[t.group];e||(e=[],h[t.group]=e),e.push({id:t.id,title:t.title,className:t.className})}});const y=null===(o=this.props.enableDataAction)||void 0===o||o,m=p.Option,g=[p.Label,p.Transparency,p.Popup,p.VisibilityRange,p.ChangeSymbol],f=Object.keys(h).length-1;!y&&f<=1&&!g.some(e=>!!h[e])?delete h[m]:h={OPTION_ACTION_INDEX:h[m]};const v=null===(c=null===(l=null===(n=this.props)||void 0===n?void 0:n.config)||void 0===l?void 0:l.customizeLayerOptions)||void 0===c?void 0:c[this.state.jimuMapViewId];if(v&&v.isEnabled){const e=new Set(null==v?void 0:v.hiddenJimuLayerViewIds),t=new Set(null==v?void 0:v.showJimuLayerViewIds),i=this.jimuMapView.getJimuLayerViewIdByAPILayer(u.layer);e.has(i)&&(u.hidden=!0),(null==v?void 0:v.showJimuLayerViewIds)&&(u.hidden=!t.has(i)),this.isLayerFromRuntime(u.layer)&&(u.hidden=!(null===(d=null==v?void 0:v.showRuntimeAddedLayers)||void 0===d||d)),this.isWMTSSublayer(u.layer)&&(u.hidden=!1)}Object.entries(h).sort((e,t)=>Number(e[0])-Number(t[0])).forEach(([e,t])=>{u.actionsSections.push(t)})},this.onLayerListActionsTriggered=(t,i=!1)=>{var s;const a=t.action,r=t.item,o=this.layerListActions.find(e=>e.id===a.id);if("option-action"===o.id){const t=this.layerListActions.filter(e=>e.isValid(r,i)&&"option-action"!==e.id),a=t.length>0,o=null===(s=this.props.enableDataAction)||void 0===s||s;setTimeout(()=>{const i=(0,e.jsx)(f,{widgetId:this.props.id,jimuMapView:this.jimuMapView,mapDataSource:this.dataSource,actionObjects:t,listItem:r,onActionListItemClick:()=>{this.onActionListItemClick()},enableDataAction:o,shouldHideEmptyList:a,optionBtnRef:this.optionBtnRef});this.setState({actionListDOM:i})},0)}else{const e=o.execute(r);e&&this.setState({nativeActionPopper:e})}},this._addJlvCreatedListener=e=>{e.fromRuntime&&this.syncRenderer(this.renderPromise)},this.onActiveViewChange=e=>{const t=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];this.jmvFromMap&&this.jmvFromMap.removeJimuLayerViewCreatedListener(this._addJlvCreatedListener),e&&e.view||!t?(this.jmvFromMap=e,e.addJimuLayerViewCreatedListener(this._addJlvCreatedListener),this.viewFromMapWidget=e&&e.view,this.setState({nativeActionPopper:null},function(){this.setState({mapWidgetId:t,jimuMapViewId:e.id})})):this.destroyLayerList()},this.onDataSourceCreated=e=>{this.dataSource=e,this.setState({mapDataSourceId:e.id})},this.isLayerFromRuntime=e=>!this.isWMTSSublayer(e)&&e[t.ExBAddedJSAPIProperties.EXB_LAYER_FROM_RUNTIME],this.editWidgetConfig=e=>{var i,s;let a=this.props.config;for(const t of e){const e=(null===(s=null===(i=this.props.config.customizeLayerOptions)||void 0===i?void 0:i[t])||void 0===s?void 0:s.showJimuLayerViewIds)||[],r=this.oldSublayersSetMap.get(t);r&&(a=a.setIn(["customizeLayerOptions",t,"showJimuLayerViewIds"],[...e,...r]))}let r=(0,t.getAppStore)().getState().appConfig;r=r.setIn(["widgets",this.props.id,"config"],a),(0,t.getAppStore)().dispatch(t.appActions.appConfigChanged(r)),this.setState({oldConfigUpdated:!0})},this.upgradeOldSublayerConfig=e=>je(this,void 0,void 0,function*(){var i,s,a,r;const o=this.props.originVersion;if(o&&t.semver.lt(o,"1.18.0")&&!this.state.oldConfigUpdated){for(const t of Object.keys(e)){const o=null===(s=null===(i=this.props.config.customizeLayerOptions)||void 0===i?void 0:i[t])||void 0===s?void 0:s.isEnabled;if(void 0===(null===(r=null===(a=this.props.config.customizeLayerOptions)||void 0===a?void 0:a[t])||void 0===r?void 0:r.showJimuLayerViewIds))break;if(o){const i=e[t],s=yield this.getAllLayers(i.view.map.layers);for(const e of s)this.getOldVersionUnselectableSublayer(e,i,this.oldSublayersSetMap)}}this.oldSublayersSetMap.size>0&&this.editWidgetConfig(Object.keys(e))}}),this.onToggleActionsPopper=()=>{if(this.setState({isActionListPopperOpen:!1,actionListDOM:null}),(0,t.isKeyboardMode)()){const e=(0,s.getFocusableElements)(this.optionBtnRef.current);(0,t.focusElementInKeyboardMode)(e[0])}},this.toggleExpand=(e,t)=>{for(const i of e)i.open=t,i.children&&this.toggleExpand(i.children,t)},this.state={mapWidgetId:null,mapDataSourceId:null,jimuMapViewId:null,listLoadStatus:Pe.Pending,isActionListPopperOpen:!1,actionListDOM:null,tableLoadStatus:Pe.Pending,nativeActionPopper:null,oldConfigUpdated:!1,headerKey:null},this.renderPromise=Promise.resolve(),this.layerListActions=function(e){const t=e.translate;return[new x(e,t("goto")),new j(e,t("showLabels"),t("hideLabels")),new k(e,t("enablePopup"),t("disablePopup")),new E(e,t("transparency")),new X(e,t("visibilityRange")),new T(e,t("information")),new re(e,t("changeSymbol")),new de(e,t("remove")),new C(e,t("options"))].sort((e,t)=>e.group-t.group)}(this),this.mapContainerRef=t.React.createRef(),this.layerListContainerRef=t.React.createRef(),this.tableListContainerRef=t.React.createRef(),this.optionBtnRef=t.React.createRef(),this.layerListRef=t.React.createRef(),this.tableListRef=t.React.createRef(),this.oldSublayersSetMap=new Map}componentDidMount(){this.bindClickHandler()}componentDidUpdate(e,t){var i,s;this.props.isDesignMode&&this.props.isDesignMode!==e.isDesignMode&&this.setState({nativeActionPopper:null}),this.needToPreventRefreshList(e,t)||(this.setState({actionListDOM:null}),this.props.enableDataAction===e.enableDataAction&&this.props.config===e.config||(this.optionBtnRef.current=null,this.setState({isActionListPopperOpen:!1})),this.bindClickHandler(),(null===(i=this.props.config)||void 0===i?void 0:i.showTables)===(null===(s=e.config)||void 0===s?void 0:s.showTables)?((this.props.config.useMapWidget&&this.state.mapWidgetId===this.currentUseMapWidgetId||!this.props.config.useMapWidget&&this.state.mapDataSourceId===this.currentUseDataSourceId)&&setTimeout(()=>{this.syncRenderer(this.renderPromise)},150),!this.props.config.popup&&e.config.popup&&this.restoreLayerPopupField()):this.renderTableList())}restoreLayerPopupField(){const e=t.MutableStoreManager.getInstance().getStateValue([this.props.widgetId,"popup"])||{};for(const t of Object.values(e))t.layer.popupEnabled=t.initialValue;e&&t.MutableStoreManager.getInstance().updateStateValue(this.props.widgetId,"popup",null)}bindClickHandler(){const e=e=>{e&&!e.onclick&&(e.onclick=e=>{const t=e.target;"CALCITE-ACTION"===t.nodeName&&t.title===this.translate("options")&&(this.optionBtnRef.current!==t?(this.optionBtnRef.current=t,this.setState({isActionListPopperOpen:!0,nativeActionPopper:null})):this.setState({isActionListPopperOpen:!this.state.isActionListPopperOpen,nativeActionPopper:null}))})};e(this.layerListContainerRef.current),e(this.tableListContainerRef.current)}needToPreventRefreshList(e,t){return t.isActionListPopperOpen!==this.state.isActionListPopperOpen||t.nativeActionPopper!==this.state.nativeActionPopper||t.listLoadStatus!==this.state.listLoadStatus||t.tableLoadStatus!==this.state.tableLoadStatus||t.headerKey!==this.state.headerKey||(t.actionListDOM!==this.state.actionListDOM||(t.tableLoadStatus!==this.state.tableLoadStatus||(this.props.isDesignMode!==e.isDesignMode||this.props.portalSelf!==e.portalSelf)))}createView(){return je(this,void 0,void 0,function*(){var e;return this.props.config.useMapWidget?null===(e=this.jimuMapView)||void 0===e?void 0:e.view:yield this.createViewByDataSource()})}createViewByDataSource(){return je(this,void 0,void 0,function*(){return yield this.loadViewModules(this.dataSource),this.dataSource.type===t.DataSourceTypes.WebMap?yield new Promise((e,t)=>{this.createWebMapView(this.MapView,e,t)}):this.dataSource.type===t.DataSourceTypes.WebScene?new Promise((e,t)=>{this.createSceneView(this.SceneView,e,t)}):Promise.reject(new Error(null))})}createWebMapView(e,t,i){if(this.mapView)this.mapView.map=this.dataSource.map;else{const t={map:this.dataSource.map,container:this.mapContainerRef.current};this.mapView=new e(t)}this.mapView.when(()=>{t(this.mapView)},e=>i(e))}createSceneView(e,t,i){if(this.sceneView)this.sceneView.map=this.dataSource.map;else{const t={map:this.dataSource.map,container:this.mapContainerRef.current};this.sceneView=new e(t)}this.sceneView.when(()=>{t(this.sceneView)},e=>i(e))}destroyView(){this.mapView&&!this.mapView.destroyed&&this.mapView.destroy(),this.sceneView&&!this.sceneView.destroyed&&this.sceneView.destroy()}getModule(e,t,s){return je(this,void 0,void 0,function*(){const a=t();if(a)return a;const r=yield(0,i.loadArcGISJSAPIModules)([e]);return s(r[0]),r[0]})}loadViewModules(e){return je(this,void 0,void 0,function*(){let i=null;return e.type===t.DataSourceTypes.WebMap?i=yield this.getModule("esri/views/MapView",()=>this.MapView,e=>{this.MapView=e}):e.type===t.DataSourceTypes.WebScene&&(i=yield this.getModule("esri/views/SceneView",()=>this.SceneView,e=>{this.SceneView=e})),i})}destroyTableList(){this.tableListRef.current&&!this.tableListRef.current.destroyed&&this.tableListRef.current.destroy()}destroyLayerList(){this.layerListRef.current&&!this.layerListRef.current.destroyed&&this.layerListRef.current.destroy()}createTableList(e){return je(this,void 0,void 0,function*(){var t;this.setState({tableLoadStatus:Pe.Pending}),yield this.getModule("esri/widgets/TableList",()=>this.TableList,e=>{this.TableList=e});const i=document&&document.createElement("div");return i.className="table-list",this.tableListContainerRef.current.appendChild(i),this.destroyTableList(),this.tableListRef.current=new this.TableList({container:i,map:e.map,dragEnabled:null===(t=this.props.config)||void 0===t?void 0:t.reorderLayers,listItemCreatedFunction:this.defineLayerListActionsGenerator(!0)}),this.tableListRef.current.on("trigger-action",e=>{this.onLayerListActionsTriggered(e,!0)}),this.tableListRef.current})}createLayerList(e){return je(this,void 0,void 0,function*(){var t,s,a;if(this.setState({listLoadStatus:Pe.Pending}),!this.LayerList){const e=yield(0,i.loadArcGISJSAPIModules)(["esri/widgets/LayerList"]);this.LayerList=e[0]}const r=document&&document.createElement("div");r.className="jimu-widget",this.layerListContainerRef.current.appendChild(r),this.destroyLayerList();let o={view:e,listItemCreatedFunction:this.defineLayerListActionsGenerator(!1),container:r};this.props.config.useMapWidget&&(o=Object.assign(Object.assign({},o),{dragEnabled:null!==(s=null===(t=this.props.config)||void 0===t?void 0:t.reorderLayers)&&void 0!==s&&s,visibilityAppearance:(null===(a=this.props.config)||void 0===a?void 0:a.useTickBoxes)?"checkbox":"default"}));const n=new this.LayerList(o);n.on("trigger-action",e=>{this.onLayerListActionsTriggered(e)}),n.when(()=>{this.props.config.expandAllLayers&&this.toggleExpand(n.operationalItems,!0)}),this.layerListRef.current=n})}onActionListItemClick(){setTimeout(()=>{this.setState({isActionListPopperOpen:!1})},100)}renderLayerList(){return je(this,void 0,void 0,function*(){var e;try{const t=yield this.createView();(null===(e=this.props.config)||void 0===e?void 0:e.showTables)&&(yield this.renderTableList()),yield this.createLayerList(t),this.setState({listLoadStatus:Pe.Fulfilled,headerKey:Math.random().toString()})}catch(e){console.error(e)}})}renderTableList(){return je(this,void 0,void 0,function*(){var e;try{const t=yield this.createView();(null===(e=this.props.config)||void 0===e?void 0:e.showTables)?(yield this.createTableList(t),this.setState({tableLoadStatus:Pe.Fulfilled})):this.destroyTableList()}catch(e){console.error(e)}})}syncRenderer(e){return je(this,void 0,void 0,function*(){this.jimuMapView=i.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId),this.jimuMapView&&(yield this.jimuMapView.whenJimuMapViewLoaded()),yield e,this.renderPromise=this.renderLayerList()})}isWMTSSublayer(e){let t=e.parent;const i=["esri.layers.WMTSLayer"];for(;t;){if(i.includes(t.declaredClass))return!0;t=t.parent}return!1}getAllLayers(e){return je(this,arguments,void 0,function*(e,t=[]){const i=["esri.layers.WMSLayer","esri.layers.support.WMSSublayer","esri.layers.WMTSLayer","esri.layers.support.WMTSSublayer","esri.layers.KMLLayer","esri.layers.support.KMLSublayer","esri.layers.CatalogLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.KnowledgeGraphLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer","esri.layers.LinkChartLayer","esri.layers.GroupLayer"];for(const s of e)i.includes(s.declaredClass)&&(s.load&&(yield s.load()),t.push(s),s.layers?yield this.getAllLayers(s.layers,t):s.sublayers&&(yield this.getAllLayers(s.sublayers,t)));return t})}getOldVersionUnselectableSublayer(e,t,i){const s=["esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.KMLLayer","esri.layers.CatalogLayer","esri.layers.KnowledgeGraphLayer","esri.layers.LinkChartLayer"],a=t.getJimuLayerViewIdByAPILayer(e);let r=e.parent;for(;r;){if(s.includes(r.declaredClass)){if(i.has(t.id))i.get(t.id).add(a);else{const e=new Set;e.add(a),i.set(t.id,e)}return!0}r=r.parent}return!1}render(){var a,r,n,l,c;const d=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0],p=this.props.useDataSources&&this.props.useDataSources[0];this.currentUseMapWidgetId=d,this.currentUseDataSourceId=p&&p.dataSourceId;let u=null;this.props.config.useMapWidget?u=(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0],onActiveViewChange:this.onActiveViewChange,onViewsCreate:e=>{this.upgradeOldSublayerConfig(e)}}):p&&(u=(0,e.jsx)(t.DataSourceComponent,{useDataSource:p,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:e=>{console.error(e)}}));let h=null;if(this.props.config.useMapWidget?d:p){let i=null;this.state.listLoadStatus===Pe.Pending&&(i=(0,e.jsx)("div",{className:"jimu-secondary-loading"}));const a=!i&&(this.props.config.layerBatchOptions||this.props.config.searchLayers);h=(0,e.jsxs)("div",{className:`widget-layerlist widget-layerlist_${this.props.id}`,children:[a&&(0,e.jsx)(xe,{headerKey:this.state.headerKey,theme:this.props.theme,jimuMapViewId:this.state.jimuMapViewId,layerListRef:this.layerListRef,tableListRef:this.tableListRef,enableSearch:null!==(r=this.props.config.searchLayers)&&void 0!==r&&r,enableBatchOption:null!==(n=this.props.config.layerBatchOptions)&&void 0!==n&&n,isMapWidgetMode:null===(l=this.props.config)||void 0===l?void 0:l.useMapWidget,expandAllLayers:null===(c=this.props.config)||void 0===c?void 0:c.expandAllLayers}),(0,e.jsx)("div",{ref:this.layerListContainerRef}),this.props.config.showTables&&(0,e.jsxs)(t.React.Fragment,{children:[null===i&&this.state.tableLoadStatus===Pe.Fulfilled&&(0,e.jsxs)("div",{className:"table-list-divider d-flex align-items-center",children:[(0,e.jsx)(S,{}),(0,e.jsx)("span",{className:"ml-1",children:this.translate("tables")})]}),null===i&&this.state.tableLoadStatus===Pe.Pending&&(0,e.jsx)(s.Loading,{type:s.LoadingType.DotsPrimary}),(0,e.jsx)("div",{ref:this.tableListContainerRef,className:"table-list-wrapper"})]}),(0,e.jsx)("div",{style:{position:"absolute",opacity:0,top:0,left:0,zIndex:-1},ref:this.mapContainerRef,children:"mapContainer"}),(0,e.jsx)("div",{style:{position:"absolute",display:"none"},children:u})]})}else this.destroyLayerList(),h=(0,e.jsx)("div",{className:"widget-layerlist",children:(0,e.jsx)(s.WidgetPlaceholder,{icon:o(),name:this.translate("_widgetLabel"),widgetId:this.props.id})});return(0,e.jsxs)(s.Paper,{variant:"flat",css:(y=this.props.theme,m=this.props.config,t.css`
    overflow: auto;
    .widget-layerlist {
      width: 100%;
      height: 100%;
      min-height: 32px;
      overflow-x: hidden;

      // Drag handler popper text
      --calcite-dropdown-item-text-color: var(--sys-color-surface-overlay-text);
      --calcite-dropdown-group-title-text-color: var(--sys-color-surface-overlay-text);
      --calcite-dropdown-item-background-color-hover: rgba(0, 0, 0, 0.2);
      --calcite-dropdown-item-text-color-press: var(--sys-color-surface-overlay-text);

      // Action hover text color, it should stay the same
      --calcite-color-text-1: var(--sys-color-action-text);
      // Action hover bg opacity
      --calcite-color-transparent-hover: rgba(0, 0, 0, 0.2);

      --calcite-list-background-color-hover: rgba(0, 0, 0, 0.2);

      // Action elements color
      --calcite-color-text-3: var(--sys-color-action-text);
      // ListItem color
      --calcite-list-label-text-color: var(--sys-color-surface-paper-text);
      // Action button color
      --calcite-action-text-color: var(--sys-color-action-text);
      --calcite-font-family: ${y.sys.typography.body.fontFamily};

      // Let the Paper component decide the color
      --calcite-list-background-color: transparent;

      calcite-flow {
        calcite-flow-item {
          background: transparent;
          // Hover background border radius
          --calcite-corner-radius-sharp: 0;
        }
      }

      calcite-action {
        // Disabled Legend button's background
        --calcite-color-foreground-1: transparent;
      }

      calcite-list-item {
        --calcite-color-foreground-3: rgba(0, 0, 0, 0.2);
      }

      // Visibility checkbox / Eyeball icon
      .esri-layer-list__visible-toggle {
        --calcite-action-text-color: ${(null==m?void 0:m.useTickBoxes)?"var(--sys-color-action-selected)":""};
        ${(null==m?void 0:m.useTickBoxes)?"--calcite-color-text-1: var(--sys-color-action-selected);":""};
      }

      .esri-layer-list__item-message {
        // For empty warning message and icon
        --calcite-notice-content-text-color: var(--sys-color-surface-overlay-text);
        font-family: ${y.sys.typography.body.fontFamily};
      }

      .esri-legend__layer-cell {
        font-family: ${y.sys.typography.body.fontFamily};
        font-size: var(--calcite-font-size--2);
      }

      .esri-layer-list__item-action {
        outline-offset: -2px;
      }

      .table-list-divider {
        border-block-start: 1px solid var(--sys-color-divider-secondary);
        font-size: var(--calcite-font-size-0);
        font-weight: 500;
        padding: 20px 12px;
        height: 28px;
      }
    }
  `),className:"jimu-widget",shape:"none",children:[h,this.state.actionListDOM&&(0,e.jsx)(s.Popper,{style:{minWidth:"170px",overflow:"hidden"},keepMount:!0,reference:this.optionBtnRef.current,open:this.state.isActionListPopperOpen,toggle:this.onToggleActionsPopper,children:this.state.actionListDOM}),this.state.nativeActionPopper]});var y,m}}Ie.mapExtraStateProps=(e,i)=>({isDesignMode:e.appRuntimeInfo.appMode===t.AppMode.Design,resourceSessions:e.resourceSessions}),Ie.versionManager=l;const Ae=Ie;function Re(e){c.p=e}})(),d})())}}});