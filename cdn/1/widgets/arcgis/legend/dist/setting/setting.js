System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/color-picker","jimu-layouts/layout-runtime","jimu-arcgis"],function(e,t){var s={},i={},o={},a={},n={},r={},l={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.DataSourceTypes=e.DataSourceTypes,i.FormattedMessage=e.FormattedMessage,i.Immutable=e.Immutable,i.React=e.React,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.polished=e.polished},function(e){o.Alert=e.Alert,o.FillType=e.FillType,o.Label=e.Label,o.Radio=e.Radio,o.Switch=e.Switch,o.defaultMessages=e.defaultMessages},function(e){a.LayerSetting=e.LayerSetting,a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.getAllItemsInMapView=e.getAllItemsInMapView},function(e){n.ThemeColorPicker=e.ThemeColorPicker},function(e){r.defaultMessages=e.defaultMessages},function(e){l.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{var e={9655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12"><path fill="#000" fill-rule="nonzero" d="m6.828.535 4.966 11.01A.323.323 0 0 1 11.5 12a.78.78 0 0 1-.707-.455L9.182 8H2.818l-1.611 3.545A.78.78 0 0 1 .5 12a.323.323 0 0 1-.294-.456L5.172.535a.909.909 0 0 1 1.656 0M6 1 3.272 7h5.456z"></path></svg>'},14321:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=r},54337:e=>{"use strict";e.exports=n},62686:e=>{"use strict";e.exports=l},67386:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=a}},t={};function d(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,d),o.exports}d.d=(e,t)=>{for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var c={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(c),d.d(c,{CardLayout:()=>y,__set_webpack_public_path__:()=>v,default:()=>f});var e,t=d(67386),s=d(79244),i=d(14321),o=d(79298),a=d(54337);!function(e){e.ShowVisible="show-visible",e.ShowWithinExtent="show-within-extent",e.ShowAll="show-all"}(e||(e={}));const n={sourceDescript:"A web map or web scene, or any combination of the two.",showBaseMap:"Show basemap legends",cardStyle:"Use card style",showAllLegends:"Show all layers",showWithinExtent:"Show visible layers within current map extent",showVisible:"Show visible layers",legendMode:"Legend mode",respectLayerDefinitionExp:"Respect layer filter settings",customizeDescription:"Specify which layers will be displayed in the legend for each map"};var r=d(41496);const l=e=>{const{onRadioChange:o,checked:a,itemId:l,name:d}=e,c=s.hooks.useTranslation(n,r.defaultMessages);return(0,t.jsx)("div",{className:"w-100 legend-tools",children:(0,t.jsx)("div",{className:"legend-tools-item card-style-radio",children:(0,t.jsxs)(i.Label,{className:"d-flex align-items-center",style:{cursor:"pointer",fontWeight:"normal"},children:[(0,t.jsx)(i.Radio,{id:l,name:d,className:"mr-1",onChange:e=>{o(e)},checked:a}),c(l)]})})})},p=e=>{const{itemsIds:s,itemsOptions:i,value:o,onChange:a,name:n}=e,r=s.map((e,r)=>{const d={itemId:s[r],checked:o===i[r],onRadioChange:()=>{a(i[r])},name:n};return(0,t.jsx)(l,Object.assign({},d),r)});return(0,t.jsx)("div",{className:"card-layout-content pl-2",role:"radiogroup",css:h,"aria-label":n,children:r})},h=s.css`
  .legend-tools:last-child {
    .legend-tools-item {
      margin-bottom: -0.5rem;
    }
  }
`;var g=d(62686);const u=d(9655),m=Object.assign({},n,i.defaultMessages);var y;!function(e){e.Auto="auto",e.SideBySide="side-by-side",e.Stack="stack"}(y||(y={}));class S extends s.React.PureComponent{constructor(t){super(t),this.supportedDsTypes=(0,s.Immutable)([s.DataSourceTypes.WebMap,s.DataSourceTypes.WebScene]),this.getPortUrl=()=>(0,s.getAppStore)().getState().portalUrl,this.onOptionsChanged=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t,e)}),"cardStyle"===t&&this.setState({cardStyle:e})},this.onCardLayoutChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("cardLayout",e)}),this.setState({cardLayoutValue:e})},this.onLegendModeChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("legendMode",e)}),this.setState({legendMode:e})},this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onDataSourceChange=e=>{e&&this.props.onSettingChange({id:this.props.id,useDataSources:e})},this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.onUseCustomStyleChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["style","useCustom"],e)})},this.onFontStyleChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["style","fontColor"],e)})},this.onBackgroundStyleChange=e=>{var t,o,a;const n={color:e,fillType:i.FillType.FILL};let r=(0,s.Immutable)(null!==(a=null===(o=null===(t=this.props.config)||void 0===t?void 0:t.style)||void 0===o?void 0:o.background)&&void 0!==a?a:{});for(const e in n)switch(e){case"fillType":r.fillType!==n[e]&&(r=r.set("fillType",n[e]));break;case"color":r=r.set("color",n[e]);break;case"image":r=r.set("image",n[e])}this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["style","background"],r)})},this.onListItemBodyClick=e=>{var t;const s=`${null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0]}-${e}`;this.setState({activeCustomizeJmvId:s})},this.onCustomizeLayerChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["customizeLayerOptions",this.state.activeCustomizeJmvId],{isEnabled:e,hiddenJimuLayerViewIds:[],showJimuLayerViewIds:e?[...t]:[],showRuntimeAddedLayers:!!e||void 0})})},this.onShowRuntimeAddedLayersChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["customizeLayerOptions",this.state.activeCustomizeJmvId,"showRuntimeAddedLayers"],e)})},this.onLayerIdChange=e=>{const t=this.props.config.setIn(["customizeLayerOptions",this.state.activeCustomizeJmvId,"showJimuLayerViewIds"],e);this.props.onSettingChange({id:this.props.id,config:t})},this.hideLayers=e=>{const t=e.getParentJimuLayerView(),i=[s.SupportedJSAPILayerTypes.MapImageLayer,s.SupportedJSAPILayerTypes.WMSLayer,s.SupportedJSAPILayerTypes.SubtypeGroupLayer];if(t&&i.includes(t.type))return!0;if(void 0!==e.layer.legendEnabled&&!e.layer.legendEnabled)return!0;return[s.SupportedJSAPILayerTypes.BuildingComponentSubLayer,s.SupportedJSAPILayerTypes.BuildingGroupSubLayer].includes(e.type)},this.getActiveCustomizeStatus=()=>{var e,t,s,i;return null!==(i=null===(s=null===(t=null===(e=this.props.config)||void 0===e?void 0:e.customizeLayerOptions)||void 0===t?void 0:t[this.state.activeCustomizeJmvId])||void 0===s?void 0:s.isEnabled)&&void 0!==i&&i},this.getShowRuntimeAddedLayerStatus=()=>{var e,t,s,i;return null===(i=null===(s=null===(t=null===(e=this.props.config)||void 0===e?void 0:e.customizeLayerOptions)||void 0===t?void 0:t[this.state.activeCustomizeJmvId])||void 0===s?void 0:s.showRuntimeAddedLayers)||void 0===i||i},this.getSelectedValues=()=>{var e,t;const s={};if(null===(e=this.props.config)||void 0===e?void 0:e.customizeLayerOptions){for(const e of Object.keys(null===(t=this.props.config)||void 0===t?void 0:t.customizeLayerOptions))this.props.config.customizeLayerOptions[e].isEnabled&&(s[e]=this.props.config.customizeLayerOptions[e].showJimuLayerViewIds);return s}return(0,o.getAllItemsInMapView)(this.state.activeCustomizeJmvId,!1)},this.isMapWidgetEmpty=()=>{var e,t,s,i;const o=(null===(t=g.MapViewManager.getInstance().getJimuMapViewGroup(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0]))||void 0===t?void 0:t.jimuMapViews)||{};return Object.keys(o).length<=1&&!(null===(i=null===(s=Object.values(o))||void 0===s?void 0:s[0])||void 0===i?void 0:i.dataSourceId)};const{cardLayout:a=y.Auto,cardStyle:n=!1,legendMode:r=e.ShowVisible}=this.props.config;this.state={cardStyle:n,cardLayoutValue:a,legendMode:r,activeCustomizeJmvId:null}}translate(e){return this.props.intl.formatMessage({id:e,defaultMessage:m[e]})}getFormattedMessage(e){return(0,t.jsx)(s.FormattedMessage,{id:e,defaultMessage:m[e]})}getDefaultStyleConfig(){return{useCustom:!1,background:{color:"",fillType:i.FillType.FILL},fontColor:""}}getStyleConfig(){return this.props.config.style&&this.props.config.style.useCustom?this.props.config.style:this.getDefaultStyleConfig()}render(){var n,r,l,d;let c=null;const h=(0,t.jsx)(i.Label,{id:"multiple-jimu-map-desc",children:this.translate("customizeDescription")});this.state.cardStyle&&(c=(0,t.jsx)(o.SettingRow,{flow:"wrap",children:(0,t.jsx)(p,{value:this.state.cardLayoutValue,name:this.translate("cardStyle"),onChange:this.onCardLayoutChange,itemsIds:["auto","sideBySide","stack"],itemsOptions:Object.values(y)})}));const g=(0,t.jsx)(o.SettingRow,{flow:"wrap",children:(0,t.jsx)("div",{style:{marginLeft:"-0.5rem"},children:(0,t.jsx)(p,{name:this.translate("legendMode"),value:this.state.legendMode,onChange:this.onLegendModeChange,itemsIds:["showVisible","showWithinExtent"],itemsOptions:Object.values(e)})})});let m;return m=(null===(n=this.props.config.style)||void 0===n?void 0:n.useCustom)?"block":"none",(0,t.jsx)("div",{css:(S=this.props.theme,s.css`
    .widget-setting-legend{
      font-weight: lighter;
      font-size: 13px;

      .source-descript {
        color: ${S.ref.palette.neutral[1e3]};
      }

      .webmap-thumbnail{
        cursor: auto;
        width: 100%;
        height: 120px;
        overflow: hidden;
        padding: 1px;
        border: ${s.polished.rem(2)} solid initial;
        img, div{
          width: 100%;
          height: 100%;
        }
      }

      .card-layout-content{
        width: 100%;
      }

      .legend-tools{
        .legend-tools-item{
          display: flex;
          margin-bottom: 8px;
        }
      }

      .advanced-setting-row .jimu-widget-setting--row-label {
        color: #c5c5c5;
        font-size: 0.875rem;
      }

      .map-selector-section .component-map-selector .form-control{
        width: 100%;
      }

      .jimu-builder--background-setting .background-image {
        display: none;
      }

      .jimu-builder--background-setting .background-image-fill-type {
        display: none;
      }
    }
  `),children:(0,t.jsxs)("div",{className:"widget-setting-legend",children:[(0,t.jsxs)(o.SettingSection,{className:"map-selector-section",role:"group",children:[(0,t.jsx)(o.SettingRow,{label:this.getFormattedMessage("selectMapWidget")}),(0,t.jsx)(o.SettingRow,{children:(0,t.jsx)(o.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:this.props.useMapWidgetIds})}),(null===(r=this.props.useMapWidgetIds)||void 0===r?void 0:r[0])&&(0,t.jsx)(o.SettingRow,{label:h,flow:"wrap","aria-label":this.translate("customizeDescription"),className:"customize-layer-list",children:this.isMapWidgetEmpty()?(0,t.jsx)(i.Alert,{tabIndex:0,className:"warningMsg",open:!0,text:this.translate("customizeLayerWarnings"),type:"warning"}):(0,t.jsx)(o.LayerSetting,{mapWidgetId:null===(l=this.props.useMapWidgetIds)||void 0===l?void 0:l[0],onMapItemClick:this.onListItemBodyClick,mapViewId:this.state.activeCustomizeJmvId,isCustomizeEnabled:this.getActiveCustomizeStatus(),isShowRuntimeAddedLayerEnabled:this.getShowRuntimeAddedLayerStatus(),showTable:!1,onToggleCustomize:this.onCustomizeLayerChange,onShowRuntimeAddedLayersChange:this.onShowRuntimeAddedLayersChange,onSelectedLayerIdChange:this.onLayerIdChange,selectedValues:this.getSelectedValues(),hideLayers:this.hideLayers})})]}),(0,t.jsx)(o.SettingSection,{title:this.translate("legendMode"),role:"group","aria-label":this.translate("legendMode"),children:g}),(0,t.jsxs)(o.SettingSection,{title:this.translate("options"),role:"group","aria-label":this.translate("options"),children:[(0,t.jsx)(o.SettingRow,{tag:"label",label:this.getFormattedMessage("showBaseMap"),children:(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.showBaseMap||!1,"data-key":"showBaseMap",onChange:e=>{this.onOptionsChanged(e.target.checked,"showBaseMap")}})}),(0,t.jsx)(o.SettingRow,{tag:"label",label:this.getFormattedMessage("cardStyle"),children:(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.cardStyle||!1,"data-key":"cardStyle",onChange:e=>{this.onOptionsChanged(e.target.checked,"cardStyle")}})}),c]}),(0,t.jsxs)(o.SettingSection,{children:[(0,t.jsx)(o.SettingRow,{className:"advanced-setting-row",tag:"label",label:(0,t.jsx)(s.FormattedMessage,{id:"advance",defaultMessage:"Advanced"}),children:(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:this.getStyleConfig().useCustom||!1,"data-key":"showBaseMap",onChange:e=>{this.onUseCustomStyleChanged(e.target.checked)}})}),(0,t.jsxs)("div",{className:"mt-4",style:{display:m},children:[(0,t.jsx)(o.SettingRow,{label:(0,t.jsx)(s.FormattedMessage,{id:"font",defaultMessage:"Font"}),children:(0,t.jsx)(a.ThemeColorPicker,{icon:u,type:"with-icon",specificTheme:this.props.theme2,value:this.getStyleConfig().fontColor||"",onChange:this.onFontStyleChanged,"aria-label":this.translate("fontColor")})}),(0,t.jsx)(o.SettingRow,{label:(0,t.jsx)(s.FormattedMessage,{id:"background",defaultMessage:"Background"}),children:(0,t.jsx)(a.ThemeColorPicker,{specificTheme:this.props.theme2,value:(null===(d=this.getStyleConfig().background)||void 0===d?void 0:d.color)||this.props.theme2.sys.color.surface.paper||"",onChange:this.onBackgroundStyleChange,"aria-label":this.translate("backgroundColor")})})]})]})]})});var S}}S.mapExtraStateProps=e=>({dsJsons:e.appStateInBuilder.appConfig.dataSources});const f=S;function v(e){d.p=e}})(),c})())}}});