System.register(["jimu-core","jimu-layouts/layout-runtime"],(function(e,t){var o={},s={};return{setters:[function(e){o.AbstractMessageAction=e.AbstractMessageAction,o.AppMode=e.AppMode,o.MessageType=e.MessageType,o.WidgetState=e.WidgetState,o.appActions=e.appActions,o.getAppStore=e.getAppStore},function(){}],execute:function(){e((()=>{"use strict";var e={79244:e=>{e.exports=o},41496:e=>{e.exports=s}},t={};function i(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};i.r(r),i.d(r,{default:()=>a});var n=i(79244);i(41496);class a extends n.AbstractMessageAction{constructor(){super(...arguments),this.supportedMessageTypes=[n.MessageType.ButtonClick,n.MessageType.DataRecordsSelectionChange],this.supportedMessageTypesInExpressMode=[n.MessageType.ButtonClick]}filterMessageDescription(e){return(0,n.getAppStore)().getState().appRuntimeInfo.appMode===n.AppMode.Express?this.supportedMessageTypesInExpressMode.includes(e.messageType):this.supportedMessageTypes.includes(e.messageType)}filterMessage(e){return!0}onExecute(e,t){var o,s,i,r,a,d,p,l,u,c,g;let v=!1,S=!1;if(e.type===n.MessageType.DataRecordsSelectionChange){const c=e;if(0===(c.records||[]).length)v=!0;else{const g=c.records[0].dataSource,v=g.id,y=null===(o=g.getMainDataSource())||void 0===o?void 0:o.id,f=null===(s=g.getRootDataSource())||void 0===s?void 0:s.id,M=null===(r=null===(i=null==g?void 0:g.getAssociatedDataSource)||void 0===i?void 0:i.call(g))||void 0===r?void 0:r.id;if(t.useDataSources&&0!==t.useDataSources.length){t.useDataSources.some((e=>[v,y,f,M].includes(e.mainDataSourceId)))||(S=!0)}else{((null===(u=null===(l=null===(p=null===(d=null===(a=(0,n.getAppStore)().getState().appConfig)||void 0===a?void 0:a.widgets)||void 0===d?void 0:d[e.widgetId])||void 0===p?void 0:p.useDataSources)||void 0===l?void 0:l.map)||void 0===u?void 0:u.call(l,(e=>e.mainDataSourceId)))||[]).some((e=>[v,y,f,M].includes(e)))||(S=!0)}}}if(!t||v||S)return Promise.resolve(!0);let y=null==t?void 0:t.widgetIds.asMutable();const f=null==t?void 0:t.controllerId,M=(0,n.getAppStore)().getState(),A=M.appConfig.widgets[f].config;if(null===(c=null==A?void 0:A.behavior)||void 0===c?void 0:c.onlyOpenOne){const e=null!==(g=M.widgetsRuntimeInfo)&&void 0!==g?g:{},t=Object.keys(e).filter((t=>{const o=e[t];return o.controllerWidgetId===f&&(e=>[n.WidgetState.Opened,n.WidgetState.Active].includes(e.state))(o)}));t.length>0&&(0,n.getAppStore)().dispatch(n.appActions.closeWidgets(t)),y.length>1&&(y=y.slice(0,1))}return(0,n.getAppStore)().dispatch(n.appActions.openWidgets(y)),Promise.resolve(!0)}}return r})())}}}));