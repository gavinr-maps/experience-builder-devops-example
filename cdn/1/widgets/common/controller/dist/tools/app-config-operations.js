System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime"],(function(o,t){var e={},n={},i={};return{setters:[function(o){e.AppMode=o.AppMode,e.FixedPosition=o.FixedPosition,e.LayoutParentType=o.LayoutParentType,e.getAppStore=o.getAppStore,e.lodash=o.lodash},function(o){n.getAppConfigAction=o.getAppConfigAction},function(){}],execute:function(){o((()=>{"use strict";var o={79244:o=>{o.exports=e},4108:o=>{o.exports=n},41496:o=>{o.exports=i}},t={};function r(e){var n=t[e];if(void 0!==n)return n.exports;var i=t[e]={exports:{}};return o[e](i,i.exports,r),i.exports}r.d=(o,t)=>{for(var e in t)r.o(t,e)&&!r.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},r.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r.r=o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var l={};r.r(l),r.d(l,{default:()=>c});var d=r(79244);const s="controller";d.FixedPosition.TopRight,document.body,document;var a=r(4108);r(41496);const u=(o,t,e)=>{var n,i;const r=o.appConfig;let l=null===(i=null===(n=r.widgets[t])||void 0===n?void 0:n.layouts)||void 0===i?void 0:i[s];const a=null==l?void 0:l[e];a&&(o.removeSizeModeLayout(a,e),l=l.without(e),o.editWidgetProperty(t,`layouts.${s}`,l));const u=r.mainSizeMode;o.createLayoutForSizeMode(e,u,l,d.LayoutParentType.Widget,t,s)};class c{constructor(){this.id="controller-app-config-operation"}afterWidgetCopied(o,t,e,n,i){var r,l,d,s;const a=t.widgets[o],u=n.widgets[e],c=null==a?void 0:a.config,p=null===(r=t.controllerPanels)||void 0===r?void 0:r[o];if(p&&(n=n.setIn(["controllerPanels",e],p)),!(null===(l=null==c?void 0:c.behavior)||void 0===l?void 0:l.openStarts)||(null===(s=null===(d=null==c?void 0:c.behavior)||void 0===d?void 0:d.openStarts)||void 0===s?void 0:s.length)<=0)return n;const f=c.behavior.openStarts,v=[];return i?f.forEach((o=>{v.push(i[o])})):f.forEach((o=>{const e=t.layouts[a.layouts.controller.LARGE],i=n.layouts[u.layouts.controller.LARGE];null==e||e.order.forEach(((t,n)=>{if(e.content[t].widgetId===o){const o=i.content[i.order[n]].widgetId;v.push(o)}}))})),n.setIn(["widgets",e,"config","behavior","openStarts"],v)}widgetWillRemove(o){var t;return(null===(t=o.controllerPanels)||void 0===t?void 0:t[this.widgetId])?o.set("controllerPanels",o.controllerPanels.without(this.widgetId)):o}appConfigWillChange(o){var t,e,n,i;const r=this.widgetId,{widgets:l,layouts:c,mainSizeMode:p}=o,f=null===(e=null===(t=l[r])||void 0===t?void 0:t.layouts)||void 0===e?void 0:e[s];if(!f)return o;const v=[],g={};for(const[o,t]of Object.entries(f)){const e=c[t],{order:r,content:d}=e,s=[];for(const e of r||[]){const r=d[e],a=l[r.widgetId];if("accordion"===(null===(n=null==a?void 0:a.manifest)||void 0===n?void 0:n.name)){const t=c[(null===(i=null==a?void 0:a.layouts)||void 0===i?void 0:i.DEFAULT)[o]],e={config:a.config,label:a.label,icon:a.icon,children:[]};if((null==t?void 0:t.content)&&(null==t?void 0:t.order))for(const o of t.order){const n=t.content[o].widgetId;if(n)e.children.push(n);else{const e={layoutId:t.id,layoutItemId:o};v.push(e)}}s.push(e)}else{const o=r.widgetId;if(o)s.push(o);else{const o={layoutId:t,layoutItemId:e};v.push(o)}}}g[o]=s}let y=o;if(v.length>0)for(const o of v){const{layoutId:t,layoutItemId:e}=o,{content:n,order:i}=y.layouts[t]||{};y=y.setIn(["layouts",t,"content"],n.without(e)),y=y.setIn(["layouts",t,"order"],(i||[]).filter((o=>o!==e)))}const h=(0,d.getAppStore)().getState(),I=h.appStateInBuilder?h.appStateInBuilder:h,m=I.appRuntimeInfo.appMode===d.AppMode.Express,S=I.browserSizeMode===I.appConfig.mainSizeMode;if(m&&S){const o=(0,a.getAppConfigAction)(y);for(const[t,e]of Object.entries(g)){const n=t;n===p||d.lodash.isDeepEqual(e,g[p])||u(o,r,n)}y=o.appConfig}return y}}return l})())}}}));