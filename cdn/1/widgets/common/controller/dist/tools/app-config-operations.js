System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime"],(function(o,t){var e={},n={},i={};return{setters:[function(o){e.AppMode=o.AppMode,e.FixedPosition=o.FixedPosition,e.LayoutParentType=o.LayoutParentType,e.dataSourceUtils=o.dataSourceUtils,e.getAppStore=o.getAppStore,e.lodash=o.lodash},function(o){n.getAppConfigAction=o.getAppConfigAction},function(){}],execute:function(){o((()=>{var o={79244:o=>{"use strict";o.exports=e},4108:o=>{"use strict";o.exports=n},41496:o=>{"use strict";o.exports=i}},t={};function r(e){var n=t[e];if(void 0!==n)return n.exports;var i=t[e]={exports:{}};return o[e](i,i.exports,r),i.exports}r.d=(o,t)=>{for(var e in t)r.o(t,e)&&!r.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},r.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r.r=o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.p="";var s={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(s),r.d(s,{default:()=>i});var o=r(79244);const t="controller";o.FixedPosition.TopRight,document.body;var e=r(4108);r(41496);const n=(e,n,i)=>{var r,s;const l=e.appConfig;let a=null===(s=null===(r=l.widgets[n])||void 0===r?void 0:r.layouts)||void 0===s?void 0:s[t];const d=null==a?void 0:a[i];d&&(e.removeSizeModeLayout(d,i),a=a.without(i),e.editWidgetProperty(n,`layouts.${t}`,a));const c=l.mainSizeMode;e.createLayoutForSizeMode(i,c,a,o.LayoutParentType.Widget,n,t)};class i{constructor(){this.id="controller-app-config-operation"}afterWidgetCopied(t,e,n,i,r){var s,l,a,d;const c=e.widgets[t],u=i.widgets[n],p=null==c?void 0:c.config,f=null===(s=e.controllerPanels)||void 0===s?void 0:s[t];f&&(i=i.setIn(["controllerPanels",n],f));let g=i.messageConfigs,v=!1;for(const[t,e]of Object.entries(g||{}))for(let i=0;i<e.actions.length;i++){const s=e.actions[i];if("openWidget"===s.actionName&&s.widgetId===n){const e=s.config;g=g.setIn([t,"actions",i,"config","controllerId"],n);const l=e.widgetIds.map((o=>(null==r?void 0:r[o])||o));if(g=g.setIn([t,"actions",i,"config","widgetIds"],l),e.useDataSources){const n=e.useDataSources.map((t=>o.dataSourceUtils.mapUseDataSource(r,t).useDataSource));g=g.setIn([t,"actions",i,"config","useDataSources"],n)}v=!0}}if((!(null===(l=null==p?void 0:p.behavior)||void 0===l?void 0:l.openStarts)||(null===(d=null===(a=null==p?void 0:p.behavior)||void 0===a?void 0:a.openStarts)||void 0===d?void 0:d.length)<=0)&&!v)return i;const y=p.behavior.openStarts,h=[];return r?y.forEach((o=>{h.push(r[o])})):y.forEach((o=>{const t=e.layouts[c.layouts.controller.LARGE],n=i.layouts[u.layouts.controller.LARGE];null==t||t.order.forEach(((e,i)=>{if(t.content[e].widgetId===o){const o=n.content[n.order[i]].widgetId;h.push(o)}}))})),i.setIn(["widgets",n,"config","behavior","openStarts"],h).set("messageConfigs",g)}widgetWillRemove(o){var t;return(null===(t=o.controllerPanels)||void 0===t?void 0:t[this.widgetId])?o.set("controllerPanels",o.controllerPanels.without(this.widgetId)):o}appConfigWillChange(i){var r,s,l,a;const d=this.widgetId,{widgets:c,layouts:u,mainSizeMode:p}=i,f=null===(s=null===(r=c[d])||void 0===r?void 0:r.layouts)||void 0===s?void 0:s[t];if(!f)return i;const g=[],v={};for(const[o,t]of Object.entries(f)){const e=u[t],{order:n,content:i}=e,r=[];for(const e of n||[]){const n=i[e],s=c[n.widgetId];if("accordion"===(null===(l=null==s?void 0:s.manifest)||void 0===l?void 0:l.name)){const t=u[(null===(a=null==s?void 0:s.layouts)||void 0===a?void 0:a.DEFAULT)[o]],e={config:s.config,label:s.label,icon:s.icon,children:[]};if((null==t?void 0:t.content)&&(null==t?void 0:t.order))for(const o of t.order){const n=t.content[o].widgetId;if(n)e.children.push(n);else{const e={layoutId:t.id,layoutItemId:o};g.push(e)}}r.push(e)}else{const o=n.widgetId;if(o)r.push(o);else{const o={layoutId:t,layoutItemId:e};g.push(o)}}}v[o]=r}let y=i;if(g.length>0)for(const o of g){const{layoutId:t,layoutItemId:e}=o,{content:n,order:i}=y.layouts[t]||{};y=y.setIn(["layouts",t,"content"],n.without(e)),y=y.setIn(["layouts",t,"order"],(i||[]).filter((o=>o!==e)))}const h=(0,o.getAppStore)().getState(),I=h.appStateInBuilder?h.appStateInBuilder:h,S=I.appRuntimeInfo.appMode===o.AppMode.Express,m=I.browserSizeMode===I.appConfig.mainSizeMode;if(S&&m){const t=(0,e.getAppConfigAction)(y);for(const[e,i]of Object.entries(v)){const r=e;r===p||o.lodash.isDeepEqual(i,v[p])||n(t,d,r)}y=t.appConfig}return y}}})(),s})())}}}));