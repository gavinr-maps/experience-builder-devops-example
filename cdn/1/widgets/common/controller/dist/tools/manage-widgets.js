System.register(["jimu-core","jimu-ui","jimu-core/emotion","jimu-ui/advanced/setting-components","jimu-layouts/layout-runtime","jimu-for-builder"],function(e,t){var o={},i={},n={},l={},d={},a={};return{setters:[function(e){o.BrowserSizeMode=e.BrowserSizeMode,o.FixedPosition=e.FixedPosition,o.LayoutItemType=e.LayoutItemType,o.LayoutType=e.LayoutType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.css=e.css,o.getAppStore=e.getAppStore,o.i18n=e.i18n},function(e){i.defaultMessages=e.defaultMessages},function(e){n.jsx=e.jsx},function(e){l.SortTree=e.SortTree},function(e){d.LayoutItemSizeModes=e.LayoutItemSizeModes,d.searchUtils=e.searchUtils},function(e){a.appBuilderSync=e.appBuilderSync,a.appConfigUtils=e.appConfigUtils,a.builderAppSync=e.builderAppSync,a.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={4108:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=i},41496:e=>{"use strict";e.exports=d},67386:e=>{"use strict";e.exports=n},73549:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.667 4.667 11.333 0 16 4.667l-4.667 4.666zM0 1.333V8h6.667V1.333zM6.667 16H0V9.333h6.667zM8 16V9.333h6.667V16z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=l},91455:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M9 4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1zM4 8V4h4v4zM17 4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1zm-5 4V4h4v4zM9 12a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1zm-5 4v-4h4v4zM17 14a3 3 0 1 0-6 0 3 3 0 0 0 6 0m-5 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg>'}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var u={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(u),r.d(u,{default:()=>B});var e=r(79244),t=r(14321),o=r(91455),i=r.n(o),n=r(73549),l=r.n(n),d=r(67386),a=r(79298),s=r(41496);const p="controller",v=(e.FixedPosition.TopRight,document.body,(t,o)=>{var i,n,l,d;const a=(0,e.getAppStore)().getState(),r=a.appStateInBuilder||a;if(!r)return;const u=r.appConfig,p=r.browserSizeMode,v=null===(l=null===(n=null===(i=u.widgets)||void 0===i?void 0:i[t])||void 0===n?void 0:n.layouts)||void 0===l?void 0:l[o],c=s.searchUtils.findLayoutId(v,p,u.mainSizeMode);return null===(d=u.layouts)||void 0===d?void 0:d[c]}),c=e=>{var t,o,i;let n=(null!==(i=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==i?i:[]).map(t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]});return n=n.filter(e=>e&&e.id&&e.widgetId&&!e.isPending),n.map(e=>e.id)};var g=r(4108);const m={gap:10,padding:{number:[0],unit:"px"},header:{borderTop:{type:"solid",color:"var(--sys-color-primary-main)",width:"2px"},expandIcon:{svg:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>',properties:{filename:"expand.svg",size:16,color:"var(--sys-color-surface-overlay-text)",inlineSvg:!0}},collapseIcon:{svg:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>',properties:{filename:"collapse.svg",size:16,color:"var(--sys-color-surface-overlay-text)",inlineSvg:!0}},showWidgetIcon:!1,widgetIconSize:16,widgetIconColor:"var(--sys-color-surface-overlay-text)",textStyle:{bold:!0,color:"var(--sys-color-surface-overlay-text)",size:"14px"},padding:{number:[0],unit:"px"},borderRadius:{number:[0],unit:"px"},collapsedColor:"rgba(0,0,0,0)",expandedColor:"rgba(0,0,0,0)"},panel:{backgroundColor:"rgba(0,0,0,0)",borderRadius:{number:[0],unit:"px"},padding:{number:[0],unit:"px"},border:{color:"var(--sys-color-primary-main)",type:"solid",width:"0px"}},singleMode:!1,showToggleAll:!1,useQuickStyle:3};var f=function(e,t,o,i){return new(o||(o=Promise))(function(n,l){function d(e){try{r(i.next(e))}catch(e){l(e)}}function a(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(d,a)}r((i=i.apply(e,t||[])).next())})};const y=t=>{var o,i;const{appConfig:n,browserSizeMode:l}=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState(),d=s.searchUtils.getParentWidgetIdOfContent(n,t,e.LayoutItemType.Widget,l);return"controller"===(null===(i=null===(o=n.widgets[d])||void 0===o?void 0:o.manifest)||void 0===i?void 0:i.name)},S=(t,o,i)=>f(void 0,void 0,void 0,function*(){const n=(0,g.getAppConfigAction)(),l=yield I(n,t,o,i);if(t.type===e.LayoutType.AccordionLayout){b(n,t.parent.id,[l])}return n.exec(),l}),I=(t,o,i,n)=>f(void 0,void 0,void 0,function*(){const l=i.layoutInfo;let d;if(l&&l.layoutId&&l.layoutItemId){const n=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!n)return;const l=n.browserSizeMode;let a;a=i.isFromCurrentSizeMode?l:g.appConfigUtils.getSizeModeOfALayout(t.appConfig,i.layoutInfo.layoutId),d=t.moveLayoutItem(i.layoutInfo,o.id,a,l)}else if(i.uri){const e=yield t.addNewWidgetToLayout(o.id,{uri:i.uri,itemId:i.itemId},!0);d={layoutId:o.id,layoutItemId:e}}return t.adjustOrderOfItem(d,n||0,!0),t.editLayoutItemProperty(d,"bbox",{},!0),t.editLayoutItemProperty(d,"setting",{},!0),d}),h=(t,o)=>{var i,n;if(!t||!o)return null;return{id:t.id,layoutInfo:o,itemType:e.LayoutItemType.Widget,manifest:null===(i=t.manifest)||void 0===i?void 0:i.asMutable({deep:!0}),icon:"string"==typeof t.icon?t.icon:null===(n=t.icon)||void 0===n?void 0:n.asMutable({deep:!0}),label:t.label}},w=(t,o,i,n,l)=>f(void 0,void 0,void 0,function*(){var d,a,r,u,s,p,v;const c={name:"accordion",label:"Group",uri:"widgets/layout/accordion/",icon:null,itemType:e.LayoutItemType.Widget,manifest:{widgetType:e.WidgetType.Layout,properties:{}}},g=yield I(t,o,c,l),m=null===(r=null===(a=null===(d=t.appConfig.layouts[o.id])||void 0===d?void 0:d.content)||void 0===a?void 0:a[g.layoutItemId])||void 0===r?void 0:r.widgetId,f=function(e,t){const o=Object.values((null==t?void 0:t.content)||{}).map(e=>e.widgetId),i=null==e?void 0:e.widgets,n=Object.values(i||{}).filter(e=>o.includes(e.id)&&"widgets/layout/accordion/"===e.uri).map(e=>e.label);return n}(t.appConfig,o),y=e.i18n.getIntl(),S=y?y.formatMessage({id:"groupLabel",defaultMessage:"Group"}):"Group";t.editWidgetProperty(m,"label",function(e,t="Group"){const o=new RegExp(`${t} [0-9]+`),i=e.filter(e=>o.test(e)),n=/\d+/,l=i.map(e=>{var t;return parseInt(null===(t=n.exec(e))||void 0===t?void 0:t[0])}),d=l.sort((e,t)=>t-e)[0]||0;return`${t} ${d+1}`}(f,S)),t.adjustOrderOfItem(g,l,!0);const h=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!h)return;const w=h.browserSizeMode,x=null===(v=null===(p=null===(s=null===(u=t.appConfig.widgets)||void 0===u?void 0:u[m])||void 0===s?void 0:s.layouts)||void 0===p?void 0:p.DEFAULT)||void 0===v?void 0:v[w],A=t.appConfig.layouts[x],M=yield I(t,A,n,0),C=yield I(t,A,i,1);b(t,m,[M,C])});function b(e,t,o){var i,n,l,d,a,r,u;const p=e.appConfig,v=(null===(n=null===(i=p.widgets[t].config)||void 0===i?void 0:i.asMutable)||void 0===n?void 0:n.call(i,{deep:!0}))||{};let c=v;3!==v.useQuickStyle&&(c=m);const g=v.expandedItems||[],f=[];for(const t of o){const{layoutId:o,layoutItemId:i}=t,n=null===(a=null===(d=null===(l=p.layouts[o])||void 0===l?void 0:l.content)||void 0===d?void 0:d[i])||void 0===a?void 0:a.widgetId,v=p.widgets[n];n&&f.push(n),(null===(r=v.manifest.properties)||void 0===r?void 0:r.supportAutoSize)?e.editLayoutItemProperty(t,"setting.autoProps.height",s.LayoutItemSizeModes.Auto,!0):(null===(u=v.manifest.defaultSize)||void 0===u?void 0:u.height)?e.editLayoutItemProperty(t,"bbox",{height:v.manifest.defaultSize.height+"px"},!0):e.editLayoutItemProperty(t,"bbox",{height:"300px"},!0)}c.expandedItems=g.concat(f),e.editWidgetConfig(t,c)}const x=(e,t,o)=>{var i;return null===(i=e[o.widgetId])||void 0===i?void 0:i.label},A=(e,t)=>`${t.widgetId||""},${e},${t.id}`,M=t=>{var o,i,n,l,d,a,r;const{draggingItemJsons:u,targetItemJsons:s,dropType:p}=t,v=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!v)return!1;const c=v.appConfig.widgets,[g]=u[0].itemKey.split(","),m=c[g],[f]=null===(n=null===(i=null===(o=null==s?void 0:s[1])||void 0===o?void 0:o.itemKey)||void 0===i?void 0:i.split)||void 0===n?void 0:n.call(i,","),y=c[f];return("to-inside"!==p||"accordion"!==(null===(l=null==m?void 0:m.manifest)||void 0===l?void 0:l.name)&&"accordion"!==(null===(d=null==y?void 0:y.manifest)||void 0===d?void 0:d.name))&&(!["to-top","to-bottom"].includes(p)||"accordion"!==(null===(a=null==m?void 0:m.manifest)||void 0===a?void 0:a.name)||"accordion"!==(null===(r=null==y?void 0:y.manifest)||void 0===r?void 0:r.name))},C=(t,o)=>{var i,n,l,d,a,r,u,s,c;const{dragItemJsons:m,dragItemIndex:y,itemJsons:I,dropType:b,targetDropItemIndex:x}=o,A=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!A)return;const M=A.appConfig.widgets,C=v(t,p),[z,T,L]=m[0].itemKey.split(","),B={layoutId:T,layoutItemId:L},P=M[z],[j,O,R]=I[0].itemKey.split(","),W={layoutId:O,layoutItemId:R},K=M[j],U=h(P,B),k=h(K,W),[_]=null===(l=null===(n=null===(i=null==m?void 0:m[1])||void 0===i?void 0:i.itemKey)||void 0===n?void 0:n.split)||void 0===l?void 0:l.call(n,","),[F]=null===(r=null===(a=null===(d=null==I?void 0:I[1])||void 0===d?void 0:d.itemKey)||void 0===a?void 0:a.split)||void 0===r?void 0:r.call(a,","),V=M[F];if("to-inside"===b&&U&&k){const t=null!==(s=null===(u=null==I?void 0:I[1])||void 0===u?void 0:u.itemChildren.map(e=>e.itemKey).indexOf(null==I?void 0:I[0].itemKey))&&void 0!==s?s:0;if("accordion"===k.manifest.name){const e=v(j,"DEFAULT");S(e,U,t)}else if("accordion"!==k.manifest.name){((t,o,i,n,l,...d)=>{f(void 0,[t,o,i,n,l,...d],void 0,function*(t,o,i,n,l,d=!0){var a,r,u,s,p,v;const c=(0,g.getAppConfigAction)(),m=d&&i<l?l-1:l;yield w(c,t,o,n,m),c.exec();const f=o.id?[o.id,n.id]:[n.id];(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(f));const y=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!y)return;const S=y.appRuntimeInfo.selection;if(!S||(null==S?void 0:S.layoutId)===t.id&&[null===(a=o.layoutInfo)||void 0===a?void 0:a.layoutItemId,null===(r=n.layoutInfo)||void 0===r?void 0:r.layoutItemId].includes(null==S?void 0:S.layoutItemId)){const o=null===(u=t.parent)||void 0===u?void 0:u.id,i=null===(v=null===(p=null===(s=y.appConfig.widgets[o])||void 0===s?void 0:s.parent)||void 0===p?void 0:p[y.browserSizeMode])||void 0===v?void 0:v[0];(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(i))}})})(C,U,y,k,t,_===F)}}else if(["to-top","to-bottom"].includes(b)&&U){let e=C;"accordion"===(null===(c=null==V?void 0:V.manifest)||void 0===c?void 0:c.name)&&(e=v(F,"DEFAULT")),S(e,U,x)}},z=(t,o)=>{const[,i,n]=o.itemKey.split(",");((t,o)=>{var i,n,l,d,a,r,u,s;const p=(0,g.getAppConfigAction)();p.removeLayoutItem(t,!0,!0);const{layoutId:v,layoutItemId:c}=t;if(o){const e=null===(i=p.appConfig.widgets[o])||void 0===i?void 0:i.config,t=null===(d=null===(l=null===(n=p.appConfig.layouts[v])||void 0===n?void 0:n.content)||void 0===l?void 0:l[c])||void 0===d?void 0:d.widgetId;if(Array.isArray(null===(a=null==e?void 0:e.behavior)||void 0===a?void 0:a.openStarts)&&e.behavior.openStarts.includes(t)){const i=e.setIn(["behavior","openStarts"],e.behavior.openStarts.filter(e=>e!==t));p.editWidgetConfig(o,i)}}p.exec();const m=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!m)return;const f=m.appRuntimeInfo.selection;if(!f||(null==f?void 0:f.layoutId)===t.layoutId&&(null==f?void 0:f.layoutItemId)===t.layoutItemId){const t=null===(s=null===(u=null===(r=m.appConfig.widgets[o])||void 0===r?void 0:r.parent)||void 0===u?void 0:u[m.browserSizeMode])||void 0===s?void 0:s[0];(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(t))}})({layoutId:i,layoutItemId:n},t)},T=e.css`
width: 300px;
height: 400px;
overflow-y: auto;
padding: var(--sys-spacing-4);
.jimu-tree-item__main-line {
  height: 32px;
  background-color: var(--ref-palette-neutral-500);
  &:hover {
    background-color: var(--ref-palette-neutral-600);
  }
  color: var(--ref-palette-neutral-1100);
}
.jimu-tree-item__body {
  border: none !important;
}
`,L=t=>{const{widgetId:o}=t,i=e.ReactRedux.useSelector(e=>{const t=e.appStateInBuilder||e;if(!t)return;return t.appConfig.layouts}),n=e.React.useMemo(()=>{const t=v(o,p);return((t,o)=>{const i=(0,e.getAppStore)().getState().appStateInBuilder||(0,e.getAppStore)().getState();if(!o||!i)return;const n=i.appConfig.widgets,l=null==o?void 0:o.content;return{itemKey:t,itemChildren:c(o).map(e=>l[e]).map(e=>{var t;const i=e.widgetId,l=n[i];let d;if("accordion"===(null===(t=null==l?void 0:l.manifest)||void 0===t?void 0:t.name)){const e=v(i,"DEFAULT"),t=c(e).map(t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]});d=t.map(t=>({itemKey:A(e.id,t),itemStateTitle:x(n,e.id,t)})).filter(e=>!!e.itemStateTitle)}return{itemKey:A(o.id,e),itemStateTitle:x(n,o.id,e),itemChildren:d,itemStateExpanded:!!d}}).filter(e=>!!e.itemStateTitle)}})(o,t)},[o,i]),l=e.React.useCallback(e=>{C(o,e)},[o]),r=e.React.useCallback(e=>{z(o,e)},[o]);return(0,d.jsx)("div",{css:T,children:(0,d.jsx)(a.SortTree,{rootItemJson:n,isItemDroppable:M,onSort:l,onRemove:r})})};class B{constructor(){this.index=3,this.id="conttroller-manage-widgets1",this.name="conttroller-manage-widgets2"}getAppState(){const t=(0,e.getAppStore)().getState();return t.appStateInBuilder?t.appStateInBuilder:t}getGroupId(){return"controller-tools"}getTitle(){const o=e.i18n.getIntl("_jimu");return o?o.formatMessage({id:"manageWidgets",defaultMessage:t.defaultMessages.manageWidgets}):"Manage widgets"}getIcon(){return window.jimuConfig.isBuilder?l():i()}visible(e){return!y(e.layoutItem.widgetId)}disabled(e){var t,o,i,n,l;const d=this.getAppState(),{appConfig:a,browserSizeMode:r}=d,u=e.layoutItem.widgetId,s=a.widgets[u],v=(null===(t=s.layouts[p])||void 0===t?void 0:t[r])||(null===(o=s.layouts[p])||void 0===o?void 0:o[a.mainSizeMode]);return 0===(null!==(l=null===(n=null===(i=a.layouts[v])||void 0===i?void 0:i.order)||void 0===n?void 0:n.length)&&void 0!==l?l:0)}checked(){if(this.getAppState().browserSizeMode===e.BrowserSizeMode.Small)return this.isOpenInSidePanel}onClick(t){const o=t.layoutItem.widgetId;if(this.getAppState().browserSizeMode===e.BrowserSizeMode.Small){this.isOpenInSidePanel=!this.isOpenInSidePanel;const t=()=>{this.isOpenInSidePanel=!1,((t,o)=>{window.jimuConfig.isBuilder?g.builderAppSync.publishWidgetToolbarStateChangeToApp(t,o):(0,e.getAppStore)().dispatch(e.appActions.widgetToolbarStateChange(t,o))})(o,["controller-manage-widgets"])};g.appBuilderSync.publishSidePanelToApp({type:"manageWidgets",uri:"widgets/common/controller/",widgetId:o,keepPanel:!0,active:this.isOpenInSidePanel,onClose:t})}}getSettingPanel(t){return this.getAppState().browserSizeMode===e.BrowserSizeMode.Small?null:L}}})(),u})())}}});