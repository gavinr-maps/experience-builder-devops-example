/*! For license information please see builder-support.js.LICENSE.txt */
System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-layouts/layout-builder","jimu-ui","jimu-theme","jimu-core/dnd","jimu-core/react"],(function(e,t){var o={},i={},n={},l={},a={},r={},s={},d={},u={};return Object.defineProperty(u,"__esModule",{value:!0}),{setters:[function(e){o.APP_FRAME_NAME_IN_BUILDER=e.APP_FRAME_NAME_IN_BUILDER,o.AppMode=e.AppMode,o.AppType=e.AppType,o.BrowserSizeMode=e.BrowserSizeMode,o.ContainerType=e.ContainerType,o.ErrorBoundary=e.ErrorBoundary,o.ExtensionManager=e.ExtensionManager,o.FixedPosition=e.FixedPosition,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.LayoutParentType=e.LayoutParentType,o.LayoutType=e.LayoutType,o.PagePart=e.PagePart,o.React=e.React,o.ReactRedux=e.ReactRedux,o.WidgetManager=e.WidgetManager,o.WidgetState=e.WidgetState,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.appConfigUtils=e.appConfigUtils,o.classNames=e.classNames,o.createSelector=e.createSelector,o.css=e.css,o.extensionSpec=e.extensionSpec,o.getAppStore=e.getAppStore,o.getIndexFromProgress=e.getIndexFromProgress,o.hooks=e.hooks,o.i18n=e.i18n,o.jimuHistory=e.jimuHistory,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished,o.useIntl=e.useIntl,o.utils=e.utils},function(e){i.LayoutServiceProvider=e.LayoutServiceProvider,i.appBuilderSync=e.appBuilderSync,i.builderAppSync=e.builderAppSync,i.getAppConfigAction=e.getAppConfigAction,i.placeholderService=e.placeholderService,i.widgetService=e.widgetService},function(e){n.LayoutContext=e.LayoutContext,n.PageContext=e.PageContext,n.searchUtils=e.searchUtils,n.utils=e.utils},function(e){l.WidgetListPopper=e.WidgetListPopper},function(e){a.CanvasPane=e.CanvasPane,a.DropArea=e.DropArea,a.addItemToLayout=e.addItemToLayout,a.withRnd=e.withRnd},function(e){r.Button=e.Button,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownMenu=e.DropdownMenu,r.FloatingPanel=e.FloatingPanel,r.Icon=e.Icon,r.Loading=e.Loading,r.MobilePanel=e.MobilePanel,r.NavButtonGroup=e.NavButtonGroup,r.Popper=e.Popper,r.Tooltip=e.Tooltip,r._Popper=e._Popper,r.defaultMessages=e.defaultMessages,r.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,r.utils=e.utils},function(e){s.Theme2GlobalStyleClassName=e.Theme2GlobalStyleClassName,s.getBuilderThemeVariables=e.getBuilderThemeVariables,s.getTheme=e.getTheme,s.getTheme2=e.getTheme2,s.styled=e.styled,s.withBuilderTheme=e.withBuilderTheme},function(){},function(e){Object.keys(e).forEach((function(t){u[t]=e[t]}))}],execute:function(){e((()=>{var e={81617:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M.007.883A1 1 0 0 1 1 0h10l.117.007A1 1 0 0 1 12 1v7l-.007.117A1 1 0 0 1 11 9H4l-4 3V1zM11 1H1v9l2.667-2H11zM3 3.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M3.5 5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},13153:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.333 0h4c.737 0 1.334.597 1.334 1.333v1.334h8C15.403 2.667 16 3.264 16 4v10.667c0 .736-.597 1.333-1.333 1.333H1.333A1.333 1.333 0 0 1 0 14.667V1.333C0 .597.597 0 1.333 0m0 7.333v7.334h13.334V7.333zm0-1.333h13.334V4H5.334V1.335h-4z" clip-rule="evenodd"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},49859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},28736:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M14 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM2 1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M20 8a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM8 7h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},76490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m1.373 8 2.07-2.071.83.828L2.2 8.828a3.515 3.515 0 0 0 4.97 4.971l2.072-2.071.828.828L8 14.627A4.686 4.686 0 1 1 1.373 8M13.799 7.172l-2.071 2.07.828.83L14.627 8A4.686 4.686 0 1 0 8 1.373l-2.071 2.07.828.83L8.828 2.2a3.515 3.515 0 0 1 4.971 4.97"></path><path fill="#000" d="M5.515 9.657a.586.586 0 0 0 .828.828l4.142-4.142a.586.586 0 0 0-.828-.828z"></path></svg>'},55886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},55447:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.994 2.243A1.375 1.375 0 0 0 13.625 1h-7.25l-.132.006A1.375 1.375 0 0 0 5 2.375v1.75h.917v-1.75l.007-.082a.46.46 0 0 1 .451-.376h7.25l.082.007a.46.46 0 0 1 .376.451v7.25l-.007.082a.46.46 0 0 1-.451.376h-1.738V11h1.738l.132-.006A1.375 1.375 0 0 0 15 9.625v-7.25zM9.625 5h-7.25C1.615 5 1 5.616 1 6.375v7.25C1 14.385 1.616 15 2.375 15h7.25c.76 0 1.375-.616 1.375-1.375v-7.25C11 5.615 10.384 5 9.625 5M2.4 6h7.2c.22 0 .4.201.4.45v7.1c0 .248-.18.45-.4.45H2.4c-.22 0-.4-.201-.4-.45v-7.1c0-.249.18-.45.4-.45M4 8h4v1H4zm4 3H4v1h4z" clip-rule="evenodd"></path></svg>'},9869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5M5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 1v9h9V5z" clip-rule="evenodd"></path></svg>'},64548:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 0a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm0 1H4a3 3 0 0 0-2.995 2.824L1 4v8a3 3 0 0 0 2.824 2.995L4 15h8a3 3 0 0 0 2.995-2.824L15 12V4a3 3 0 0 0-2.824-2.995zM8 4a4 4 0 1 1 0 8 4 4 0 0 1 0-8m0 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6" clip-rule="evenodd"></path></svg>'},51993:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.914 6.475 2.94a.5.5 0 1 1-.707-.707L8 0l2.157 2.157a.5.5 0 0 1-.707.707l-.95-.95V7.5h5.586l-1.1-1.1a.5.5 0 1 1 .706-.708L16 8l-2.232 2.232a.5.5 0 1 1-.707-.707L14.086 8.5H8.5v5.586l1.025-1.025a.5.5 0 1 1 .707.707L8 16l-2.308-2.308a.5.5 0 1 1 .707-.707l1.101 1.1V8.5H1.914l.95.95a.5.5 0 0 1-.707.707L0 8l2.232-2.232a.5.5 0 1 1 .707.707L1.914 7.5H7.5z" clip-rule="evenodd"></path></svg>'},93387:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 8.002a.5.5 0 0 1-1 0V1H1v12.003h3.5a.5.5 0 1 1 0 1H1a1 1 0 0 1-1-1V1A1 1 0 0 1 .044.706.498.498 0 0 1 .5 0H11a1 1 0 0 1 1 1zm2.218 1.486a.5.5 0 0 0-.708 0l-5.657 5.658a.5.5 0 0 0 .708.707l5.657-5.658a.5.5 0 0 0 0-.707M11 9.928c.376 0 .794.041 1.23.141l-.871.871a5 5 0 0 0-.359-.012c-1 0-2.731.297-3.83 2 .313.486.677.857 1.062 1.14l-.676.676A6.1 6.1 0 0 1 6 12.928c1.333-2.334 3.5-3 5-3m0 5c-.219 0-.472-.014-.746-.054l-.824.825a5.6 5.6 0 0 0 1.57.23c1.5 0 3.667-.667 5-3a6 6 0 0 0-1.804-1.998l-.684.684c.478.299.936.721 1.319 1.313-1.1 1.704-2.831 2-3.831 2M2.5 3.502A.5.5 0 0 1 3 3h6a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},30119:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 0a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm0 1H4a3 3 0 0 0-2.995 2.824L1 4v8a3 3 0 0 0 2.824 2.995L4 15h8a3 3 0 0 0 2.995-2.824L15 12V4a3 3 0 0 0-2.824-2.995zM8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8" clip-rule="evenodd"></path></svg>'},77154:(e,t,o)=>{"use strict";var i=o(68972);var n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},l=i.useSyncExternalStore,a=i.useRef,r=i.useEffect,s=i.useMemo,d=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,o,i,u){var c=a(null);if(null===c.current){var p={hasValue:!1,value:null};c.current=p}else p=c.current;c=s((function(){function e(e){if(!r){if(r=!0,l=e,e=i(e),void 0!==u&&p.hasValue){var t=p.value;if(u(t,e))return a=t}return a=e}if(t=a,n(l,e))return t;var o=i(e);return void 0!==u&&u(t,o)?t:(l=e,a=o)}var l,a,r=!1,s=void 0===o?null:o;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]}),[t,o,i,u]);var g=l(e,c[0],c[1]);return r((function(){p.hasValue=!0,p.value=g}),[g]),d(g),g}},56037:(e,t,o)=>{"use strict";e.exports=o(77154)},79244:e=>{"use strict";e.exports=o},26245:e=>{"use strict";e.exports=d},68972:e=>{"use strict";e.exports=u},4108:e=>{"use strict";e.exports=i},6055:e=>{"use strict";e.exports=a},41496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=s},14321:e=>{"use strict";e.exports=r},79298:e=>{"use strict";e.exports=l}},t={};function c(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";c.r(p),c.d(p,{default:()=>Wt});var e=c(79244);const t="controller",o={sm:24,default:32,lg:48},i={width:150,height:120},n={width:300,height:300},l={x:70,y:70},a={x:30,y:30},r=(e.FixedPosition.TopRight,[{name:"preventOverflow",options:{boundary:document.body,rootBoundary:document}},{name:"offset",options:{offset:[0,16]}}]);var s=c(4108),d=c(41496);const u=(t,o)=>{const i=e.ReactRedux.useSelector((e=>e.widgetsRuntimeInfo)),n=g(t,o),l=h(n);return e.React.useMemo((()=>{const t={};return l.forEach((o=>{var n;const l=null!==(n=null==i?void 0:i[o])&&void 0!==n?n:{isClassLoaded:!1};t[o]=(0,e.Immutable)(l)})),(0,e.Immutable)(t)}),[l,i])},g=(t,o)=>e.ReactRedux.useSelector((e=>{var i,n,l,a;const r=null===(l=null===(n=null===(i=e.appConfig.widgets)||void 0===i?void 0:i[t])||void 0===n?void 0:n.layouts)||void 0===l?void 0:l[o],s=e.browserSizeMode,u=e.appConfig.mainSizeMode,c=d.searchUtils.findLayoutId(r,s,u);return null===(a=e.appConfig.layouts)||void 0===a?void 0:a[c]})),v=(t,o)=>{var i,n,l,a;const r=(0,e.getAppStore)().getState().appConfig,s=(0,e.getAppStore)().getState().browserSizeMode,u=null===(l=null===(n=null===(i=r.widgets)||void 0===i?void 0:i[t])||void 0===n?void 0:n.layouts)||void 0===l?void 0:l[o],c=d.searchUtils.findLayoutId(u,s,r.mainSizeMode);return null===(a=r.layouts)||void 0===a?void 0:a[c]},f=e=>{var t,o,i;let n=(null!==(i=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==i?i:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return n=n.filter((e=>e&&e.id&&e.widgetId&&!e.isPending)),n.map((e=>e.id))},h=e=>f(e).map((t=>{var o,i;return null===(i=null===(o=e.content)||void 0===o?void 0:o[t])||void 0===i?void 0:i.widgetId})),m=(e,t)=>{if(null!=(null==e?void 0:e.content)&&t)return Object.keys(e.content).find((o=>e.content[o].widgetId===t))},y=t=>[e.WidgetState.Opened,e.WidgetState.Active].includes(t.state);var w=c(79298),b=c(6055),I=function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function a(e){try{s(i.next(e))}catch(e){l(e)}}function r(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((i=i.apply(e,t||[])).next())}))};const x=t=>{var o;let i=!0;const n=null==t?void 0:t.itemType,l=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.name;if((n===e.LayoutItemType.Section||["controller"].includes(l))&&(i=!1),d.utils.isWidgetPlaceholder(d.utils.getAppConfig(),t)){i=!1;const o=(0,e.getAppStore)().getState(),n=o.appInfo.type===e.AppType.Template,l=s.placeholderService.getPlaceholderInfo(o.appConfig,t.layoutInfo);n&&l&&o.browserSizeMode!==o.appConfig.mainSizeMode&&(i=!0)}return i},S=(t,o,i)=>{const n={layoutId:t.id};let l=(0,s.getAppConfigAction)();(0,b.addItemToLayout)(l.appConfig,o,t.id).then((t=>{l=(0,s.getAppConfigAction)(t.updatedAppConfig),l.adjustOrderOfItem(t.layoutInfo,i||0),l.editLayoutItemProperty(t.layoutInfo,"bbox",{}),(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(l.appConfig,n))}))},C=(t,o,i)=>I(void 0,void 0,void 0,(function*(){if(0===t.length)return;let n=(0,s.getAppConfigAction)();const l=t[0].id,{updatedAppConfig:a,layoutInfo:r}=yield(0,b.addItemToLayout)(n.appConfig,o,l);n=(0,s.getAppConfigAction)(a),n.adjustOrderOfItem(r,i||0),n.editLayoutItemProperty(r,"bbox",{});const u=t.slice(1).map((e=>e.id)),c=d.searchUtils.findLayoutItem(n.appConfig,r);u.forEach((t=>{var o,i,l;const{updatedAppConfig:a,layoutItemId:r}=((t,o,i)=>{const n=s.LayoutServiceProvider.getService(t,o).createBlankItem(t,o);let l=n[0];const a=n[1],r={layoutId:o,layoutItemId:a},u=d.searchUtils.findLayoutItem(l,r).set("widgetId",i).set("type",e.LayoutItemType.Widget);l=l.setIn(["layouts",o,"content",a],u);const c=e.appConfigUtils.getSizeModeOfALayout(l,o);return l=s.widgetService.addParent(l,i,r,c),l=s.widgetService.afterAdded(l,i,o,c,c),{updatedAppConfig:l,layoutItemId:a}})(n.appConfig,t,c.widgetId),u=null!==(l=null===(i=(null===(o=a.layouts)||void 0===o?void 0:o[t]).order)||void 0===i?void 0:i.length)&&void 0!==l?l:0;n=(0,s.getAppConfigAction)(a);const p={layoutId:t,layoutItemId:r};n.adjustOrderOfItem(p,u||0),n.editLayoutItemProperty(p,"bbox",{})})),(0,e.getAppStore)().dispatch(e.appActions.appConfigChanged(n.appConfig))}));var R=c(14321),A=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const P=(e,t,i)=>{let n=o[e];t&&(n+=21);return n+=2*k(e,i),n},k=(e,t)=>"circle"===t?"sm"===e?4:"default"===e?2:"lg"===e?0:void 0:6,j={none:"0",sm:"0",default:"var(--sys-shape-1)",lg:"var(--sys-shape-2)"},M=e.React.forwardRef(((t,o)=>{var i;const{label:n,className:l,title:a,showLabel:r,showIndicator:s=!0,showTooltip:d=!0,labelGrowth:u=0,icon:c,marker:p,onClick:g,onMarkerClick:v,avatar:f,autoFlip:h,active:m,editDraggable:y,disabled:w,widgetid:b}=t,I=A(t,["label","className","title","showLabel","showIndicator","showTooltip","labelGrowth","icon","marker","onClick","onMarkerClick","avatar","autoFlip","active","editDraggable","disabled","widgetid"]),x=f||{},{shape:S,style:C}=x,M=A(x,["shape","style"]),L=(null==M?void 0:M.size)||"default",T=((t,o,i,n,l)=>e.React.useMemo((()=>{const a=P(t,o,n),r=a+l,s=k(t,n);return e.css`
      display: flex;
      align-items:center;
      flex-direction: column;
      justify-content: ${o?"space-around":"center"};
      width: ${e.polished.rem(r)} !important;
      height: ${e.polished.rem(a)};
      .tool-drag-handler {
        cursor: auto;
      }
      .avatar {
        padding: ${s}px;
        position: relative;
        text-align: center;
        &:hover .marker {
          visibility: visible;
        }
        .marker {
          position: absolute;
          right: 0;
          top: 0;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          .icon-btn-sizer {
            min-width: .625rem;
            min-height: .625rem;
          }
          visibility: hidden;
        }
      }
      ${i?".avatar.active {\n        .avatar-button, .marker {\n          transform: translateY(-7px);\n        }\n        .marker {\n          z-index: 1;\n        }\n        ::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          border: 1px solid var(--ref-palette-white);\n          border-radius: 3px;\n          width: 6px;\n          height: 3px;\n          background-color: var(--sys-color-primary-main);\n          box-sizing: content-box;\n        }\n      }":""}
      .avatar-label {
        text-align: center;
        width: 100%;
        min-height: ${e.polished.rem(21)};
        cursor: default;
      }
    `}),[t,o,n,l,i]))(L,r,s,S,u),O=j[L],z=(0,e.jsx)(R.Button,Object.assign({"data-widgetid":b,icon:!0,active:m,className:(0,e.classNames)("avatar-button",{disabled:w}),ref:o},M,{style:Object.assign({borderRadius:"circle"===S?"50%":O},C),onClick:g}),(0,e.jsx)(R.Icon,{color:"string"!=typeof c&&(null===(i=c.properties)||void 0===i?void 0:i.color),icon:"string"!=typeof c?c.svg:c,autoFlip:h}));return(0,e.jsx)("div",Object.assign({},I,{className:(0,e.classNames)("avatar-card",`${l} avatar-card`),css:T}),(0,e.jsx)("div",{className:(0,e.classNames)({"no-drag-action":!y,active:m},"avatar tool-drag-handler")},p&&(0,e.jsx)(R.Button,{className:"marker",size:"sm",icon:!0,onClick:v},(0,e.jsx)(R.Icon,{size:8,icon:p})),d?(0,e.jsx)(R.Tooltip,{title:a||n,style:{pointerEvents:"none"}},z):z),r&&(0,e.jsx)("div",{className:(0,e.classNames)("avatar-label text-truncate",{active:m})},n))}));var L=c(62838),T=c.n(L);const O=(t,o,i=0,n=i,l)=>{let a=((t,o=500,i=!1,n)=>{var l,a;const r=i?"clientHeight":"clientWidth",[s,d]=e.React.useState(null!==(a=null===(l=t.current)||void 0===l?void 0:l[r])&&void 0!==a?a:0),u=!n&&!window.jimuConfig.isInBuilder,c=e.hooks.useLatest((()=>{const e=t.current[r]||0;d(e)})),p=e.React.useMemo((()=>e.lodash.debounce((()=>{c.current()}),o,{leading:!0})),[]);return e.React.useEffect((()=>{if(u)return;const e=t.current;e&&p();const o=new ResizeObserver(p);return o.observe(e),()=>{o.disconnect(),p.cancel()}}),[t,p,u]),s})(t,500,o,!l);a+=i,a=Math.max(a,n);const r=((t=500,o=!1)=>{const i=o?"clientHeight":"clientWidth",[n,l]=e.React.useState((()=>document.body[i]-40));e.hooks.useUpdateEffect((()=>{l(document.body[i]-40)}),[i]);const a=e.React.useMemo((()=>e.lodash.debounce((()=>{l(document.body[i]-40)}),t)),[i,t]);return e.React.useEffect((()=>(window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)})),[a]),n})(500,o);return a=l?r:Math.min(a,r),a},z=(e,t,o)=>{let i=e,n=t;return n-i>o?n=e+o:n-i<o&&(i=0,n=i+o),[i,n]};var B=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const E=[],N=e.React.forwardRef(((t,o)=>{const{scrollRef:i,className:n,lists:l=E,createItem:a,vertical:r,itemLength:s,space:d,onChange:u,autoHideArrow:c,minLength:p=s,autoScrollEnd:g,autoSize:v,onScrollStatusChange:f}=t,h=B(t,["scrollRef","className","lists","createItem","vertical","itemLength","space","onChange","autoHideArrow","minLength","autoScrollEnd","autoSize","onScrollStatusChange"]),m=e.hooks.useTranslation(R.defaultMessages),[y,w]=e.hooks.useForwardRef(o),{start:b,end:I,disablePrevious:x,disableNext:S,hideArrow:C,scroll:A}=(t=>{var o;const{rootRef:i,lists:n,itemLength:l,autoSize:a,vertical:r,space:s,minLength:d,autoScrollEnd:u}=t,c=null!==(o=null==n?void 0:n.length)&&void 0!==o?o:0,p=O(i,r,s,d,a),g=Math.floor(p/l)>c?c:Math.floor(p/l),[v,f]=e.React.useState(z(0,0,g)[0]),[h,m]=e.React.useState(z(0,0,g)[1]),y=e.hooks.useLatest(v),w=e.hooks.useLatest(h),b=h-v>=c,I=0===v,x=h===c;e.React.useEffect((()=>{if(0===p)return;const[e,t]=z(w.current,y.current,g);f(e),m(t)}),[g,p,w,y]);const S=e.hooks.useEventCallback(((e,t=!0)=>{const o=t?1:g;let i=0,n=0;e?(i=v-o,i<0?(i=0,n=i+g):n=h-o):(n=h+o,n>c?(n=c,i=n-g):i=v+o),f(i),m(n)})),C=e.React.useRef([]),R=e.hooks.useEventCallback((()=>{const e=c>0&&C.current.length>0&&n[n.length-1]!==C.current[C.current.length-1];if(u&&e&&C.current.length>c){let e=0,t=0;t=c,e=t-g,e=Math.max(0,e),f(e),m(t)}}));return e.React.useEffect((()=>{R(),C.current=n}),[n,R]),{start:v,end:h,disablePrevious:I,disableNext:x,hideArrow:b,scroll:S}})({rootRef:y,lists:l,itemLength:s,autoSize:v,vertical:r,space:d,minLength:p,autoScrollEnd:g}),P=l.slice(b,I),k=((t,o,i,n,l)=>e.css`
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    button.previous, button.next {
      flex-shrink: 0;
      display: ${l?"none":"block"};
    }
    .root {
      flex-direction: ${t?"column":"row"};
      width: 100%;
      height: 100%;
      ${t?`min-height: ${i}px;`:`min-width: ${i}px;`} 
      max-height: ${n?"100%":"calc(100% - 20px)"};
      max-width: ${n?"100%":"calc(100% - 20px)"};
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      .scroll-list-item {
        &:not(:first-of-type) {
          margin-top: ${t?o+"px":"unset"};
          margin-left: ${t?"unset":o+"px"};
        }
      }
    }
`)(r,d,p,v,C);e.React.useEffect((()=>{null==f||f(C,x,S)}),[S,x,C,f]),e.React.useEffect((()=>{R.utils.setRef(i,A)}),[A,i]);return(0,e.jsx)(R.NavButtonGroup,Object.assign({},h,{css:k,type:"tertiary",vertical:r,onChange:e=>{null==u||u(e),A(e,!0)},disablePrevious:x,disableNext:S,previousAriaLabel:m("previous"),nextAriaLabel:m("next"),className:(0,e.classNames)("scroll-list",n)}),(0,e.jsx)("div",{className:"root scroll-list-root",ref:w},l.map((t=>{const o=!P.includes(t);return a(t,(0,e.classNames)("scroll-list-item",{"d-none":o}))}))))}));var $=c(49859),W=c.n($),H=c(1888);const V=(0,H.styled)("div",{shouldForwardProp:e=>!["vertical","space"].includes(e)})`
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: ${e=>e.vertical?"column":"row"};
  .avatar-placeholder {
    &:not(:first-of-type) {
      margin-top: ${t=>t.vertical?e.polished.rem(t.space):"unset"};
      margin-left: ${t=>t.vertical?"unset":e.polished.rem(t.space)};
    }
  }
`,D=(e=>{const t=[];for(;e>0;)t.push(e),e--;return t})(3),F={type:"secondary",size:"lg",shape:"circle"},U=t=>{const{vertical:o,space:i,size:n="lg"}=t,l=e.React.useMemo((()=>Object.assign(Object.assign({},F),{size:n})),[n]);return e.React.createElement(V,{className:"list-placeholder",vertical:o,space:i},D.map(((t,o)=>e.React.createElement(M,{key:o,disabled:!0,className:"avatar-placeholder",icon:W(),label:"",showTooltip:!1,avatar:l}))))};var _=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const q=e.React.forwardRef(((t,o)=>{const{widgetId:i,layout:n,layouts:l,vertical:a,childClass:r,placeholder:s,className:u}=t,c=_(t,["widgetId","layout","layouts","vertical","childClass","placeholder","className"]),{color:p,size:[g,v]}=s,f=e.React.useRef(null),h=e.React.useRef(null),m=e.React.useRef(null),y=e.React.useRef(null),w=e.React.useRef(null),[I,x]=e.React.useState(!1),C=e.hooks.useForkRef(f,o),R=e.css`
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    bottom: 0;
    top: 0;
    right: 0;
    background: transparent;
    z-index: ${I?1:0};
    > .drop-area {
      width: 100%;
      height: 100%;
    }
    > .overlay {
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      background: transparent;
      z-index: -1;
      &.hide {
        display: none;
      }
    }
  `;e.React.useEffect((()=>{h.current=new b.CanvasPane(w.current)}),[]);return(0,e.jsx)("div",Object.assign({className:(0,e.classNames)("drop-zone",u),ref:C},c,{css:R}),(0,e.jsx)(b.DropArea,{style:R,className:"drop-area",layouts:l,highlightDragover:!0,onDragOver:(e,t,o,i,n,l)=>{let r=i;const s=y.current,d=f.current.offsetHeight,u=f.current.offsetWidth;if(s&&s.length)if(a){const{insertY:e,refId:t}=((e,t,o)=>{let i,n,l=!1;if(t.some(((e,a)=>{if(e.top+e.height/2>o){if(0===a)i=e.top;else{const o=t[a-1];i=(e.top+o.top+o.height)/2}l=!0,n=e.id}return l})),!l){const e=t[t.length-1];i=e.top+e.height}return{insertY:i,refId:n}})(0,s,l);m.current=t,r={top:e-v/2+f.current.scrollTop,width:g,left:(u-g)/2+f.current.scrollLeft,height:v}}else{const{insertX:e,refId:t}=((e,t,o)=>{let i,n,l=!1;if(t.some(((e,a)=>{if(e.left+e.width/2>o){if(0===a)i=e.left;else{const o=t[a-1];i=(e.left+o.left+o.width)/2}l=!0,n=e.id}return l})),!l){const e=t[t.length-1];i=e.left+e.width}return{insertX:i,refId:n}})(0,s,n);m.current=t,r={left:e-v/2+f.current.scrollLeft,width:v,top:(d-g)/2+f.current.scrollTop,height:g}}else r=a?{top:o.height/2-v/2,width:g,left:(u-g)/2+f.current.scrollLeft,height:v}:{left:o.width/2-v/2,width:v,top:(d-g)/2+f.current.scrollTop,height:g};h.current.clear(),h.current.setColor(p),h.current.drawRect(r)},onDrop:(t,o,i)=>{var l,a,r;h.current.clear();let s=0;m.current?s=n.order&&n.order.indexOf(m.current)||0:n.order&&(s=n.order.length),S(n,t,s);const d=(0,e.getAppStore)().getState().appConfig.layouts,{layoutId:u,layoutItemId:c}=t.layoutInfo||{},p=null===(r=null===(a=null===(l=d[u])||void 0===l?void 0:l.content)||void 0===a?void 0:a[c])||void 0===r?void 0:r.widgetId;p&&(0,e.getAppStore)().dispatch(e.appActions.closeWidget(p)),m.current=null,y.current=[]},onToggleDragoverEffect:e=>{e&&(m.current=null,(()=>{y.current=[];const e=f.current.getBoundingClientRect(),t=f.current.parentNode.querySelectorAll(`.${r}`);t&&t.length&&t.forEach((t=>{const o=t.getAttribute("data-layoutitemid");if(n.order&&n.order.includes(o)){const i=d.utils.relativeClientRect(t.getBoundingClientRect(),e);i.id=o,y.current.push(i)}})),a?y.current.sort(((e,t)=>e.top-t.top)):y.current.sort(((e,t)=>e.left-t.left))})(),h.current.setSize(f.current.clientWidth,f.current.clientHeight)),x(e)}}),(0,e.jsx)("canvas",{className:(0,e.classNames)("overlay",{hide:!I}),ref:w}))}));c(55886),c(76490),c(13153),c(81617),c(28736);const G=(0,b.withRnd)(!1)((t=>{var o,i;const{className:n,layoutId:l,layoutItemId:a,markerEnabled:r,showLabel:d,showTooltip:u,labelGrowth:c,avatar:p,editDraggable:g}=t,v=(0,e.getAppStore)().getState(),f=s.placeholderService.getPlaceholderInfo(v.appConfig,{layoutId:l,layoutItemId:a}),h=(m=(0,e.useIntl)(),{itemType:e.LayoutItemType.Widget,label:null==m?void 0:m.formatMessage({id:"placeholder",defaultMessage:R.defaultMessages.placeholder}),uri:null,manifest:{defaultSize:{width:300,height:300}},icon:W(),name:"placeholder",group:8,order:899});var m;const y=v.appInfo.type===e.AppType.Template,w=v.appRuntimeInfo.appMode===e.AppMode.Design;return f&&e.React.createElement(M,{className:(0,e.classNames)("placeholder-avatar-card",n),label:h.label+" "+f.id,icon:h.icon,autoFlip:null===(i=null===(o=null==h?void 0:h.manifest)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.flipIcon,marker:r&&y&&w?T():"",showLabel:d,showTooltip:u,labelGrowth:c,avatar:p,editDraggable:g&&y&&w,onMarkerClick:()=>{s.appBuilderSync.publishConfirmDeleteToApp({layoutId:l,layoutItemId:a})}})})),Y=(0,b.withRnd)(!1)((t=>{var o,i;const{markerEnabled:n,onMarkerClick:l,widgetid:a,showLabel:r,showIndicator:s,showTooltip:d,labelGrowth:u,avatar:c,onClick:p,active:g,editDraggable:v,className:f}=t,h=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets)||void 0===t?void 0:t[a]}));return h?e.React.createElement(M,{"data-widgetid":a,widgetid:a,className:`widget-avatar-card ${f}`,showLabel:r,showIndicator:s,showTooltip:d,labelGrowth:u,avatar:c,label:h.label,icon:h.icon,autoFlip:null===(i=null===(o=null==h?void 0:h.manifest)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.flipIcon,marker:n?T():"",active:g,editDraggable:v,onMarkerClick:l,onClick:p}):e.React.createElement(R.Loading,null)})),X=t=>{const{className:o,draggable:i,layoutId:n,layoutItem:l,onClick:a,label:r,showLabel:s,showIndicator:d,showTooltip:u,labelGrowth:c,markerEnabled:p,avatar:g,active:v,removeWidget:f}=t;return l.widgetId?e.React.createElement(Y,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:n,layoutItem:l,widgetid:l.widgetId,layoutItemId:l.id,label:r,markerEnabled:p,showLabel:s,showIndicator:d,showTooltip:u,labelGrowth:c,avatar:g,active:v,editDraggable:i,useDragHandler:!0,onClick:a,onMarkerClick:()=>{f(l.widgetId)}}):e.React.createElement(G,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:n,layoutItem:l,layoutItemId:l.id,markerEnabled:p,showLabel:s,showTooltip:u,labelGrowth:c,avatar:g,editDraggable:i,useDragHandler:!0})};var Z=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const J=e.React.forwardRef(((o,i)=>{const{widgetId:n,draggable:l,itemStyle:a,vertical:r,className:c,space:p,dropZoneRef:v,onItemClick:h,onClick:m,scrollRef:w,markerEnabled:b=!0,autoSize:I,placeholder:S,afterRemoveWidget:C}=o,R=Z(o,["widgetId","draggable","itemStyle","vertical","className","space","dropZoneRef","onItemClick","onClick","scrollRef","markerEnabled","autoSize","placeholder","afterRemoveWidget"]),A=e.ReactRedux.useSelector((e=>{var o,i,l;return null===(l=null===(i=null===(o=e.appConfig.widgets)||void 0===o?void 0:o[n])||void 0===i?void 0:i.layouts)||void 0===l?void 0:l[t]})),k=g(n,t),j=s.placeholderService.isSupported()?(e=>{var t,o,i;let n=(null!==(i=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==i?i:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return n=n.filter((e=>e&&e.id&&!e.isPending)),n.map((e=>e.id))})(k):f(k),M=(0,H.getBuilderThemeVariables)(),L=u(n,t),T=Object.keys(L).filter((e=>y(L[e]))),O=((e,t)=>{const o=null==e?void 0:e.showLabel,i=null==e?void 0:e.labelGrowth,n=null==e?void 0:e.avatar.size,l=null==e?void 0:e.avatar.shape;return P(n,o,l)+t+i})(a,p),z={color:null==M?void 0:M.sys.color.primary.light,size:[O,5]};return k&&e.React.createElement(d.LayoutContext.Provider,{value:{isItemAccepted:x}},e.React.createElement("div",{ref:i,className:(0,e.classNames)(c,"layout controller-layout w-100 h-100 d-flex align-items-center justify-content-center"),"data-layoutid":k.id,onClick:m},e.React.createElement(q,{widgetId:n,vertical:r,layout:k,childClass:`layout-${k.id}-item`,placeholder:z,layouts:A}),S||e.React.createElement(N,Object.assign({},R,{autoSize:I,scrollRef:w,className:"layout-item-list",vertical:r,itemLength:O,space:p,autoHideArrow:!0,lists:j,autoScrollEnd:!0,createItem:(t,o)=>{const i=k.content[t],n=i&&i.widgetId||"",r=T.includes(n);return e.React.createElement(X,Object.assign({},a,{key:t,className:(0,e.classNames)(`layout-${null==k?void 0:k.id}-item layout-item`,o),widgetid:n,layoutId:k.id,layoutItemId:t,draggable:l,markerEnabled:b,layoutItem:i,active:r,removeWidget:e=>{var o;o={layoutId:k.id,layoutItemId:t},s.appBuilderSync.publishConfirmDeleteToApp(o),C(e)},onClick:h}))}}))))}));var K=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const Q=e.React.forwardRef(((t,o)=>{var i;const{showPlaceholder:n,itemStyle:l,space:a,vertical:r}=t,s=K(t,["showPlaceholder","itemStyle","space","vertical"]),d=r?a:l.labelGrowth;return e.React.createElement(J,Object.assign({className:"w-100 h-100",ref:o,itemStyle:l,space:a,vertical:r,placeholder:n?e.React.createElement(U,{size:null===(i=l.avatar)||void 0===i?void 0:i.size,space:d,vertical:r}):void 0},s))}));var ee=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};function te(t){const{widgetId:o,canCrossLayoutBoundary:i,className:n,layoutId:l,layoutItemId:a}=t,r=ee(t,["widgetId","canCrossLayoutBoundary","className","layoutId","layoutItemId"]),s=e.hooks.useCancelablePromiseMaker(),[d,u]=e.React.useState(null),[c,p]=e.React.useState(""),[g,v]=e.React.useState("");e.React.useEffect((()=>{u(null),p("");const t=s((t=>{var o,i;if(!t)return;return(null===(i=null===(o=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===o?void 0:o[t])||void 0===i?void 0:i.isClassLoaded)?Promise.resolve(e.WidgetManager.getInstance().getWidgetClass(t)):e.WidgetManager.getInstance().loadWidgetClass(t)})(o));t.then((e=>{u(e),p(o)}),(e=>{var t;v(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e)}))}),[s,o]);const f=e.React.useCallback((()=>{var t,i;if(g)return;if(window.jimuConfig.isBuilder)return;(null===(i=null===(t=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===t?void 0:t[o])||void 0===i?void 0:i.state)===e.WidgetState.Active||(0,e.getAppStore)().dispatch(e.appActions.activateWidget(o))}),[g,o]),h=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Design)),m=e.ReactRedux.useSelector((e=>{var t,i,n;const l=e.appConfig.widgets[o];return null!==(n=null===(i=null===(t=null==l?void 0:l.manifest)||void 0===t?void 0:t.properties)||void 0===i?void 0:i.supportInlineEditing)&&void 0!==n&&n})),y=e.ReactRedux.useSelector((e=>{const t=e.widgetsRuntimeInfo[o];return m&&(null==t?void 0:t.isInlineEditing)})),w=e.ReactRedux.useSelector((t=>{var i;const n=t.appConfig.widgets[o];return(null===(i=null==n?void 0:n.manifest)||void 0===i?void 0:i.widgetType)!==e.WidgetType.Layout})),b=e.ReactRedux.useSelector((e=>{var t,i,n;const l=e.appConfig.widgets[o];return(null===(i=null===(t=null==l?void 0:l.manifest)||void 0===t?void 0:t.properties)||void 0===i?void 0:i.hasEmbeddedLayout)&&Object.keys(null!==(n=l.layouts)&&void 0!==n?n:{}).length>0})),I=h&&!y&&w&&!b,x=e.React.useCallback((t=>{m&&(t.stopPropagation(),(0,e.getAppStore)().dispatch(e.appActions.setWidgetIsInlineEditingState(o,!0)))}),[o,m]),S=(0,e.classNames)("widget-renderer w-100 h-100",n),C=(t=>e.React.useMemo((()=>e.css`
      overflow: ${t?"visible":"hidden"};
      position: relative;
      .widget-content {
        position: relative;
        height: 100%;
        width: 100%;
        z-index: 0;
      }
      .widget-mask {
        position: absolute;
        background: transparent;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 1;
      }
  `),[t]))(i);return(0,e.jsx)("div",Object.assign({css:C,className:S,onMouseDownCapture:f,onDoubleClickCapture:x,"data-widgetid":c},r),(0,e.jsx)("div",{className:"widget-content p-1"},g,!g&&d&&(0,e.jsx)(e.ErrorBoundary,null,(0,e.jsx)(d,{widgetId:c,layoutId:l,layoutItemId:a})),!g&&!d&&(0,e.jsx)(R.Loading,null)),I&&(0,e.jsx)("div",{className:"widget-mask"}))}const oe=(0,e.Immutable)({}),ie=o=>{var i,n,l;const{controllerId:a,containerMapId:r,onClose:s,widgets:d=oe}=o,u=null!==(i=Object.keys(d).find((e=>y(d[e]))))&&void 0!==i?i:"",c=null===(l=null===(n=(0,e.getAppStore)().getState().appConfig.widgets)||void 0===n?void 0:n[u])||void 0===l?void 0:l.label,p=g(a,t),v=e.React.useCallback(((t,o)=>{var i;t.stopPropagation();const n=null==p?void 0:p.id,l=m(p,o),a=null===(i=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===i?void 0:i.selection;a&&a.layoutId===n&&a.layoutItemId===l||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:l}))}),[p]);return e.React.createElement(R.MobilePanel,{className:(0,e.classNames)("mobile-widget-launcher",{"d-none":!u}),mapWidgetId:r,title:c,open:!!u,keepMount:!0,onClick:e=>{v(e,u)},onClose:e=>{null==e||e.stopPropagation(),null==e||e.nativeEvent.stopImmediatePropagation(),null==s||s(u)}},Object.entries(d).map((([t,o])=>{if(!(void 0!==o.state))return null;const i=y(o),n=null==p?void 0:p.id,l=m(p,t);return e.React.createElement(te,{key:t,widgetId:t,layoutId:n,layoutItemId:l,onClick:e=>{v(e,t)},className:(0,e.classNames)({"d-none":!i})})})))};var ne;!function(e){e.Stack="STACK",e.SideBySide="SIDEBYSIDE"}(ne||(ne={}));const le={_widgetLabel:"Widget Controller",_action_openWidget_label:"Open widget",resizerTooltip:"Customize the window size by dragging and dropping."},ae=e=>document.querySelector(`.widget-controller .avatar-card[data-widgetid='${e}']`),re=()=>{const t=`url("data:image/svg+xml;base64,${window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">\n    <g clip-path="url(#rectangle)">\n      <path d="M10 2.77832V0L0 10H2.77832L10 2.77832Z" fill="#000000" />\n      <path d="M10 5.60674L5.60675 10H10V5.60674Z" fill="#000000" />\n    </g>\n    <defs>\n      <clipPath id="rectangle">\n        <rect width="10" height="10" fill="white" />\n      </clipPath>\n    </defs>\n  </svg>')}")`;return e.css`
    .resizer {
      bottom: 4px !important;
      right: 4px !important;
      background-color: var(--sys-color-secondary-dark);
      mask-image: ${t};
      border: none !important;
    }
  `},se=()=>e.css`
    .resizer {
      width: 9px !important;
      height: 9px !important;
      position: absolute;
      bottom: 4px !important;
      right: 4px !important;
      border: 1px solid #000 !important;
      background: #fff;
      clip-path: polygon(5px 0px, 9px 0px, 9px 9px, 0px 9px, 0px 5px, 5px 5px);
      &::before {
        content: '';
        position: absolute;
        width: 5px;
        height: 5px;
        border-right: 1px solid #000;
        border-bottom: 1px solid #000;
      }
    }
  `,de=()=>{const t=e.hooks.useTranslation(le),o=e.React.useMemo((()=>e.css`
    position: absolute;
    width: 15px;
    height: 15px;
    bottom: 0;
    right: 0;
  `),[]);return e.React.useMemo((()=>(0,e.jsx)(R.Tooltip,{title:t("resizerTooltip")},(0,e.jsx)("div",{className:"resizer-tooltip",css:o}))),[o,t])},ue=(o,i)=>{const n=v(i,t),l=Object.keys(n.content).find((e=>n.content[e].widgetId===o));(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n.id,layoutItemId:l}))},ce=()=>document.body.getBoundingClientRect(),pe=(t,o,i,n,l)=>{const[a,r]=e.React.useState((()=>ce())),[s,d]=e.React.useState([i]),u=e.React.useRef(0);e.React.useEffect((()=>{const e=()=>{const e=ce();r(e)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const c=(e,t)=>e.right>=t.right||e.left<=t.left,p=(e,t)=>e.bottom>=t.bottom||e.top<=t.top,g=e.hooks.useEventCallback((e=>{if(u.current++,u.current>7)return console.warn(`Number of cycles: ${u.current}.You may have opened too many panels, and now there is not enough space for them to be placed without overstepping and blocking`),e;const o=((e,t)=>!(!e||!t)&&(c(e,t)||p(e,t)))(e,a);if(!o)return e;const{width:n,height:r}=e;let{left:s,top:d,right:v,bottom:f}=e;if(o){const e=c({left:s,top:d,right:v,bottom:f,width:n,height:r},a),o=p({left:s,top:d,right:v,bottom:f,width:n,height:r},a);e&&(s=t===ne.SideBySide?i.x:a.right-n),o||t!==ne.SideBySide||(d+=l),v=s+n,f=d+r}return g({left:s,top:d,right:v,bottom:f,width:n,height:r})}));return e.React.useEffect((()=>{const e=[];let a={width:0,height:0};Object.keys(o).forEach(((r,s)=>{const d=o[r],c=0!==s?e[s-1]:i;let{x:p,y:v}=c;if(t===ne.SideBySide){const{width:e}=a;p+=n>0?e:-e,p+=0!==s?n:0}else t===ne.Stack&&(p+=0!==s?n:0,v+=0!==s?l:0);const f={left:p,top:v,right:p+d.width,bottom:v+d.height,width:d.width,height:d.height},{left:h,top:m}=g(f);u.current>7?(p=c.x,v=c.y):(p=h,v=m),u.current=0,e.push({x:p,y:v}),a=d})),d(e)}),[t,i,n,l,a.width,a.height,g,o]),s},ge=(0,e.Immutable)({}),ve=o=>{const{mode:i,start:l,spaceX:a,spaceY:r,sizes:s,controllerId:d,widgets:u=ge,onResizeStop:c,onClose:p}=o,v=e.ReactRedux.useSelector((e=>e.appConfig.widgets)),[f,h]=e.React.useState(s),w=e.React.useMemo((()=>((t,o)=>{let i=(0,e.Immutable)({});return Object.keys(t).forEach((e=>{i=i.set(e,o[e]||n)})),i})(u,f)),[f,u]),b=g(d,t),I=e.React.useCallback(((t,o)=>{var i;t.stopPropagation();const n=null==b?void 0:b.id,l=m(b,o),a=null===(i=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===i?void 0:i.selection;a&&a.layoutId===n&&a.layoutItemId===l||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:l}))}),[b]),x=e=>{const t=ae(e),o=null==t?void 0:t.querySelector("button");null==o||o.focus()},[S,C]=e.React.useState(!1),A=pe(i,w,l,a,r),P=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Run)),k=P?re():se();return(0,e.jsx)(e.React.Fragment,null,Object.entries(u).map((([t,o],i)=>{var n;if(!(void 0!==o.state))return null;const l=y(o),a=A[i];if(!a)return null;const r=w[t],s=null===(n=null==v?void 0:v[t])||void 0===n?void 0:n.label,d=null==b?void 0:b.id,u=m(b,t);return(0,e.jsx)(R.FloatingPanel,{key:t,css:k,style:{maxWidth:"100vw"},headerTitle:s,defaultPosition:a,defaultSize:r,className:(0,e.classNames)({"d-none":!l},"multiple-widget-launcher"),showHeaderClose:!0,showHeaderCollapse:!0,activateOnlyForHeader:!0,autoFocus:l,dragBounds:"body",onClick:e=>{I(e,t)},onResize:e=>{((e,t)=>{h(f.set(e,t)),C(!0)})(t,e)},onResizeStop:e=>{((e,t)=>{null==c||c(e,t),C(!1)})(t,e)},onLeave:()=>{x(t)},onHeaderClose:e=>{((e,t)=>{null==t||t.stopPropagation(),null==p||p(e),x(e)})(t,e)}},(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(te,{widgetId:t,layoutId:d,layoutItemId:u}),!S&&!P&&(0,e.jsx)(de,null)))})))},fe=(0,e.Immutable)({}),he=o=>{const{controllerId:l,widgets:a=fe,root:s,placement:d,sizes:u,onResizeStop:c,onClose:p}=o,v=e.ReactRedux.useSelector((e=>e.appConfig.widgets)),f=g(l,t),h=e.React.useCallback(((t,o)=>{var i;t.stopPropagation();const n=null==f?void 0:f.id,l=m(f,o),a=null===(i=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===i?void 0:i.selection;a&&a.layoutId===n&&a.layoutItemId===l||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:l}))}),[f]),[y,w]=e.React.useState(u),[b,I]=e.React.useState(!1),x=(e,t)=>{var o;t.stopPropagation(),null==p||p(e);const i=null===(o=ae(e))||void 0===o?void 0:o.querySelector("button");null==i||i.focus()},S=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Run)),C=S?re():se();return(0,e.jsx)(e.React.Fragment,null,Object.entries(a).map((([t,o])=>{var l,a;if(!(void 0!==o.state))return null;const u=o.state!==e.WidgetState.Closed,p=null!==(l=y[t])&&void 0!==l?l:n,g=null===(a=null==v?void 0:v[t])||void 0===a?void 0:a.label;let A=ae(t);A&&A.offsetParent||(A=null==s?void 0:s.querySelector(".avatar-card"));const P=null==f?void 0:f.id,k=m(f,t);return(0,e.jsx)(R.Popper,{key:t,css:C,style:{maxWidth:"100vw"},modifiers:r,className:(0,e.classNames)({"d-none":!u},"single-widget-launcher"),headerTitle:g,activateOnlyForHeader:!0,minSize:i,dragBounds:"body",defaultSize:p,onResize:e=>{var o,i;o=t,i=e,w((e=>e.set(o,i))),I(!0)},onResizeStop:e=>{var o,i;o=t,i=e,null==c||c(o,i),I(!1)},onHeaderClose:e=>{x(t,e)},showHeaderCollapse:!0,floating:!0,open:!0,autoFocus:u,reference:A,toggle:e=>{((e,t)=>{"Escape"===(null==t?void 0:t.key)&&x(e,t)})(t,e)},onClick:e=>{h(e,t)},placement:d},(0,e.jsx)(te,{widgetId:t,layoutId:P,layoutItemId:k}),!b&&!S&&(0,e.jsx)(de,null))})))},me=t=>{const o=(0,e.getAppStore)().getState().appConfig.sections,i=Object.values(null!=o?o:{}).find((e=>{var o;return null===(o=e.views)||void 0===o?void 0:o.includes(t)}));return null==i?void 0:i.id},ye=(t,o)=>{const i=(t=>{const o=(0,e.getAppStore)().getState().appConfig.sections,i=t?Object.values(t).map((e=>e.currentViewId)):[],n=i.map(me),l=Object.values(null!=o?o:{}).map((e=>{var t;if(!n.includes(e.id))return null===(t=e.views)||void 0===t?void 0:t[0]})).filter((e=>!!e)),a=i;return l.forEach((e=>{i.includes(e)||a.push(e)})),a})(t),n=(0,e.getAppStore)().getState().browserSizeMode,l=(0,e.getAppStore)().getState().appConfig,a=d.searchUtils.getContentContainerInfo(l,o,e.LayoutItemType.Widget,n);let r=!0;if(!a)return r;if(a.type===e.ContainerType.View)if(i.includes(a.id)){const t=a.id,o=me(t),s=d.searchUtils.getContentContainerInfo(l,o,e.LayoutItemType.Section,n);s&&s.type===e.ContainerType.View&&(i.includes(s.id)||(r=!1))}else r=!1;return r};function we(o){var i,r,s,c,p,g,v,f,h,m;const{id:w,config:b,version:I,rootRef:x,onResizeStop:S}=o,C=e.hooks.useCheckSmallBrowserSizeMode(),R=null===(i=b.behavior)||void 0===i?void 0:i.onlyOpenOne,A=null!==(s=null===(r=null==b?void 0:b.behavior)||void 0===r?void 0:r.arrangement)&&void 0!==s?s:"floating",P=R&&"floating"===A,k=!R&&"floating"===A,j=e.React.useCallback((t=>{if(!t)return;(0,e.getAppStore)().dispatch(e.appActions.closeWidget(t));const o=ae(t);null==o||o.focus(),(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(null))}),[]),M=(t=>e.ReactRedux.useSelector((e=>{var o,i,n,l;const a=e.appConfig,r=e.browserSizeMode,s=a.widgets[t].parent;let u=null!==(o=s[r])&&void 0!==o?o:[];0===u.length&&(u=null!==(i=s[a.mainSizeMode])&&void 0!==i?i:[]);const c=null===(n=u[0])||void 0===n?void 0:n.layoutId,p=d.searchUtils.getWidgetIdThatUseTheLayoutId(a,c),g=a.widgets[p];return"arcgis-map"===(null===(l=null==g?void 0:g.manifest)||void 0===l?void 0:l.name)?g.id:""})))(w),L=(null===(c=b.behavior)||void 0===c?void 0:c.vertical)?"right-start":"bottom",T=null===(p=b.behavior)||void 0===p?void 0:p.displayType,O=null===(f=null===(v=null===(g=(0,e.getAppStore)())||void 0===g?void 0:g.getState())||void 0===v?void 0:v.appContext)||void 0===f?void 0:f.isRTL,z=e.React.useMemo((()=>O?Object.assign(Object.assign({},l),{x:document.body.clientWidth-n.width-l.x}):l),[O]),B=e.React.useMemo((()=>O?Object.assign(Object.assign({},a),{x:-a.x}):a),[O]),E=null===(h=b.behavior)||void 0===h?void 0:h.size,N=u(w,t),$=Object.keys(N),W=$.filter((e=>y(N[e]))),H=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.currentPageId));e.hooks.useUpdateEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.resetWidgetsState($))}),[I,H]);const V=(t=>{const o=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.sectionNavInfos}));return ye(o,t)})(w),D=e.ReactRedux.useSelector((e=>e.appContext.isInBuilder)),F=null===(m=b.behavior)||void 0===m?void 0:m.openStarts;return e.hooks.useUpdateEffect((()=>{V?!D&&(null==F?void 0:F.length)>0&&setTimeout((()=>{(0,e.getAppStore)().dispatch(e.appActions.openWidgets(F,w))}),1e3):(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(W))}),[V]),e.React.useEffect((()=>{D&&(0,e.getAppStore)().dispatch(e.appActions.resetWidgetsState($)),!D&&(null==F?void 0:F.length)&&V&&setTimeout((()=>{(0,e.getAppStore)().dispatch(e.appActions.openWidgets(F,w))}),1e3)}),[]),(0,e.jsx)(e.React.Fragment,null,C&&(0,e.jsx)(ie,{containerMapId:M,controllerId:w,widgets:N,onClose:j}),!C&&P&&(0,e.jsx)(he,{sizes:E,root:x.current,placement:L,controllerId:w,widgets:N,onResizeStop:S,onClose:j}),!C&&k&&(0,e.jsx)(ve,{sizes:E,mode:T,start:z,spaceX:B.x,spaceY:B.y,controllerId:w,widgets:N,onResizeStop:S,onClose:j}))}var be=c(4651),Ie=c.n(be);const xe=e.React.createContext({}),Se=(0,H.withBuilderTheme)(R.Tooltip),Ce=window.jimuConfig.isInBuilder?Se:R.Tooltip,Re=[{name:"flip",options:{fallbackPlacements:["top","right"]}}];class Ae extends e.React.PureComponent{constructor(){super(...arguments),this.select=e=>{if(e.stopPropagation(),this.props.onClick){const{parentRef:t}=this.contextProps;this.props.onClick({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:t&&t.getBoundingClientRect()},e),this.contextProps.onItemClick(this.props.uid)}},this.handleDoubleClick=e=>{e.stopPropagation()},this.handleMouseEnter=e=>{e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)},this.handleMouseLeave=e=>{e.stopPropagation(),this.props.onMouseLeave&&this.props.onMouseLeave({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)}}componentDidUpdate(){const e=this.getValue(this.props.visible,this.contextProps),t=this.getValue(this.props.disabled,this.contextProps);e&&!t||this.contextProps.onItemUnSelected(this.props.uid)}componentWillUnmount(){this.contextProps.onItemUnSelected(this.props.uid)}getValue(e,t){return"function"==typeof e?e(t):e}getStyle(){const{theme:t}=this.contextProps;return e.css`
      cursor: pointer;
      width: 32px;
      min-height: 32px;
      display: flex;
      justify-content: flex-start;
      user-select: none;
      background: ${t.ref.palette.neutral[400]};

      &:hover {
        background: ${t.ref.palette.neutral[500]};
      }
      &.selected {
        background: ${t.sys.color.primary.main};
      }

      &.disabled,
      &.no-action {
        cursor: default;
        &:hover {
          background: ${t.ref.palette.neutral[400]};
        }
      }
      &.disabled {
        .jimu-btn {
          cursor: default;
        }
        .jimu-btn svg, .toolbar-label {
          color: ${t.ref.palette.neutral[800]} !important;
        }
      }

      &.msg {
        width: auto;
        font-size: 12px;
        color: ${t.ref.palette.black};
        letter-spacing: 0.33px;
        text-align: center;
        padding: 0 8px;
      }

      .toolbar-group & {
        justify-content: flex-start;
      }

      .popper {
        border: 1px solid ${t.ref.palette.neutral[900]};
      }

      .toolbar-label {
        color: ${t.ref.palette.black};
      }
    `}separatorStyle(){const{theme:t}=this.contextProps;return this.props.isInGroup?e.css`
        width: 100%;
        height: 1px;
        background-color: ${t.ref.palette.neutral[600]};
        align-self: center;
      `:e.css`
      div.toolbar-item + &,
      div.toolbar-group + & {
        display: block;
      }
      display: none;
      width: 1px;
      height: 30px;
      border-left: 1px solid ${t.ref.palette.neutral[600]};
      align-self: center;
    `}tooltipStyle(){const{theme:t}=this.contextProps;return e.css`
      border: none;

      .tooltip {
        color: ${t.ref.palette.black};
        background-color: ${t.ref.palette.neutral[600]};
        border-color: ${t.ref.palette.neutral[400]};
      }
    `}createButton({textContent:t,iconContent:o,tooltip:i,isDisabled:n,noAction:l,isChecked:a,rotate:r,iconSize:s,autoFlipIcon:d,ref:u}){const c=t?"":i,p=n?{title:c}:{},g=(0,e.jsx)(R.Button,Object.assign({"aria-label":t||i,ref:u,className:"px-0 w-100 text-left",type:"tertiary",size:"sm",icon:o&&!t,role:"menuitem",onClick:n||l?null:this.select,disabled:n,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onDoubleClick:this.handleDoubleClick,"data-extname":this.props.extName},p),o&&(0,e.jsx)(R.Icon,{className:(0,e.classNames)("tool-item-icon",{checked:a}),icon:o,rotate:r,size:s,color:this.contextProps.theme.ref.palette.black,autoFlip:d}),t&&(0,e.jsx)("span",{className:"toolbar-label text-nowrap"},t));return n?g:(0,e.jsx)(Ce,{placement:"bottom",title:c,modifiers:Re,css:this.tooltipStyle()},g)}render(){const{icon:t,autoFlipIcon:o,label:i,size:n,checked:l,disabled:a,visible:r,rotate:s,settingPanel:d,title:u,uid:c,widgetId:p,className:g,seperator:v}=this.props;if(v)return(0,e.jsx)(xe.Consumer,null,(t=>(this.contextProps=t,(0,e.jsx)("div",{"data-testid":"toolbarSeparator",css:this.separatorStyle()}))));const f=null==this.props.onClick,h=n||16,m=d;return(0,e.jsx)(xe.Consumer,null,(n=>{if(this.contextProps=n,p&&n.layoutItem.widgetId!==p)return null;let v="";"function"==typeof u?v=u(n):"string"==typeof u&&(v=u);const y=d&&n.activeItem===c&&n.toggleOn,w=y||this.getValue(l,n),b=this.getValue(a,n),I=this.getValue(r,n),x=this.getValue(i,n),S=this.getValue(t,n);return null==r||I?(0,e.jsx)("div",{className:(0,e.classNames)("toolbar-item",g,{selected:w,disabled:b,msg:x,"no-action":f}),css:this.getStyle()},!m&&this.createButton({textContent:x,iconContent:S,tooltip:v,isDisabled:b,noAction:f,isChecked:w,rotate:s,iconSize:h,autoFlipIcon:o,ref:null}),m&&(0,e.jsx)(e.React.Fragment,null,this.createButton({textContent:x,iconContent:S,tooltip:v,isDisabled:b,noAction:f,isChecked:w,rotate:s,iconSize:h,autoFlipIcon:o,ref:e=>{this.reference=e}}),(0,e.jsx)(R.Popper,{placement:"bottom-start",reference:this.reference,open:y,disablePortal:!0},(0,e.jsx)("div",{css:e.css`
                          display: flex;
                          pointer-events: all;
                          background-color: ${n.theme.ref.palette.white};
                          border-radius: 2px;
                          box-shadow: 0 2px 8px 1px rgba(0, 0, 0, 0.2);
                        `,className:"d-flex"},y&&(0,e.jsx)(m,Object.assign({},n)))))):null}))}}const Pe=()=>{},ke=window.jimuConfig.isInBuilder?Se:R.Tooltip;class je extends e.React.PureComponent{constructor(t){super(t),this.togglePopToolItems=e=>{e&&e.stopPropagation(),this.contextProps.onItemClick(this.props.uid)},this.onItemClick=(t,o)=>{const{parentRef:i}=this.contextProps;t.onClick(Object.assign(Object.assign({},o),{clientRect:i.getBoundingClientRect()})),e.lodash.defer((()=>{this.dropdownBtnRef.current.focus()}))},this.handleDoubleClick=e=>{e.stopPropagation()},this.dropdownBtnRef=e.React.createRef()}getBaseStyle(){const{theme:t}=this.contextProps;return e.css`
      cursor: pointer;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background-color: ${t.ref.palette.neutral[400]};

      &:hover {
        background-color: ${t.ref.palette.neutral[500]} !important;
      }
    `}getValue(e,t){return"function"==typeof e?e(t):e}createToolItem(t,o,i){return t.onClick||t.seperator?(0,e.jsx)(Ae,Object.assign({key:i,uid:`${this.props.uid}_${i+1}`,isInGroup:!0},t,{onClick:()=>{this.onItemClick(t,o)}})):null}getGroupMenu(t,o){const{theme:i}=this.contextProps;return t?(0,e.jsx)(R.Icon,{rotate:t.rotate,icon:t.icon,size:t.size||16,color:i.ref.palette.black}):o[0].icon?(0,e.jsx)(R.Icon,{icon:o[0].icon,size:o[0].size||16,color:i.ref.palette.black}):(0,e.jsx)(Ae,Object.assign({uid:`${this.props.uid}_0`,onClick:Pe},o[0]))}tooltipStyle(){const{theme:t}=this.contextProps;return e.css`
      border: none;

      .tooltip {
        color: ${t.ref.palette.black};
        background-color: ${t.ref.palette.neutral[600]};
        border-color: ${t.ref.palette.neutral[400]};
      }
    `}render(){const{tools:t,uid:o}=this.props;return t&&0!==t.length?(0,e.jsx)(xe.Consumer,null,(i=>{this.contextProps=i;const{visible:n,caret:l=!0,title:a}=t[0],r=this.getValue(n,i);if(void 0!==n&&!r)return null;const s=t.filter((e=>{const{visible:t}=e,o=this.getValue(t,i);return void 0===t||o}));if(0===s.length)return null;if(1===s.length)return(0,e.jsx)(Ae,Object.assign({uid:`${o}_0`},s[0]));let d;s.some((e=>{const{checked:t}=e;if(this.getValue(t,i))return d=e,!0}));let u="";return"function"==typeof a?u=a(i):"string"==typeof a&&(u=a),(0,e.jsx)("div",{className:"toolbar-group",css:this.getBaseStyle()},(0,e.jsx)(R.Dropdown,{direction:"down",size:"sm",className:l?"px-1":"",isOpen:i.toggleOn&&i.activeItem===o,toggle:this.togglePopToolItems},(0,e.jsx)(ke,{placement:"bottom",title:u,css:this.tooltipStyle()},(0,e.jsx)(R.DropdownButton,{icon:!0,arrow:l,type:"tertiary",size:"sm",ref:this.dropdownBtnRef,css:e.css`
                      .caret-icon {
                        color: ${i.theme.ref.palette.neutral[1e3]};
                        margin-left: 0.25rem;
                      }
                    `,onDoubleClick:this.handleDoubleClick},this.getGroupMenu(d,s))),(0,e.jsx)(R.DropdownMenu,{className:`p-0 ${window.jimuConfig.isInBuilder?H.Theme2GlobalStyleClassName:""}`,css:e.css`min-width: 5rem;`},s.map(((e,t)=>this.createToolItem(e,i,t))))))})):null}}var Me;!function(e){e[e.BringForward=0]="BringForward",e[e.SendBackward=1]="SendBackward",e[e.BringToFront=2]="BringToFront",e[e.SendToBack=3]="SendToBack"}(Me||(Me={}));var Le,Te;function Oe(t,o,i){var n,l,a,r,s,d,u,c,p,g;const{layoutId:v}=t,f=o.layouts[v];switch(null===(n=null==f?void 0:f.parent)||void 0===n?void 0:n.type){case e.LayoutParentType.View:{const e=o.views[f.parent.id],t=o.sections[e.parent];return 1===(null===(a=null===(l=null==t?void 0:t.parent)||void 0===l?void 0:l[i])||void 0===a?void 0:a.length)?t.parent[i][0]:(null===(s=null===(r=null==t?void 0:t.parent)||void 0===r?void 0:r[i])||void 0===s?void 0:s.length)>1?Oe(t.parent[i][0],o,i):null}case e.LayoutParentType.Widget:{const e=o.widgets[f.parent.id];return 1===(null===(u=null===(d=null==e?void 0:e.parent)||void 0===d?void 0:d[i])||void 0===u?void 0:u.length)?e.parent[i][0]:(null===(p=null===(c=null==e?void 0:e.parent)||void 0===c?void 0:c[i])||void 0===p?void 0:p.length)>1?Oe(e.parent[i][0],o,i):null}case e.LayoutParentType.Screen:{const e=o.screens[f.parent.id];return null===(g=o.screenGroups[e.parent].parent)||void 0===g?void 0:g[i]}default:return null}}function ze(t,o,i){var n;let l=t.layouts[o];for(;(null==l?void 0:l.parent)&&[e.LayoutParentType.Screen,e.LayoutParentType.View,e.LayoutParentType.Widget].includes(l.parent.type);){const e=Oe({layoutId:o},t,i);o=null==e?void 0:e.layoutId,l=t.layouts[o]}switch(null===(n=null==l?void 0:l.parent)||void 0===n?void 0:n.type){case e.LayoutParentType.Dialog:return{type:e.ContainerType.Dialog,id:l.parent.id};case e.LayoutParentType.Page:return{type:e.ContainerType.Page,id:l.parent.id};case e.LayoutParentType.Header:return{type:e.ContainerType.Header,id:"header"};case e.LayoutParentType.Footer:return{type:e.ContainerType.Footer,id:"footer"}}}!function(e){e.Auto="auto",e[e.Normal=0]="Normal",e[e.BoundaryDropArea=10]="BoundaryDropArea",e[e.DragMoveTip=20]="DragMoveTip",e[e.HandlerTools=30]="HandlerTools",e[e.DraggingItem=40]="DraggingItem"}(Le||(Le={})),function(e){e.Auto="AUTO",e.Stretch="STRETCH",e.Custom="CUSTOM"}(Te||(Te={}));(0,e.createSelector)([e=>e.appConfig.mainSizeMode,e=>e.browserSizeMode,(t,o)=>{var i,n,l,a,r;let s;if(t.browserSizeMode===t.appConfig.mainSizeMode)s=!0;else{let a;(null===(i=o.layouts)||void 0===i?void 0:i[t.browserSizeMode])?a=t.browserSizeMode:(null===(n=o.layouts)||void 0===n?void 0:n[t.appConfig.mainSizeMode])&&(a=t.appConfig.mainSizeMode);const r=null===(l=o.layouts)||void 0===l?void 0:l[a],d=ze(t.appConfig,r,a);if((null==d?void 0:d.type)===e.ContainerType.Header)s=null!=t.appConfig.header.layout[t.browserSizeMode];else if((null==d?void 0:d.type)===e.ContainerType.Footer)s=null!=t.appConfig.footer.layout[t.browserSizeMode];else if((null==d?void 0:d.type)===e.ContainerType.Dialog){s=null!=t.appConfig.dialogs[d.id].layout[t.browserSizeMode]}else if((null==d?void 0:d.type)===e.ContainerType.Page){s=null!=t.appConfig.pages[d.id].layout[t.browserSizeMode]}}if(s&&(null===(a=o.layouts)||void 0===a?void 0:a[t.browserSizeMode])){const e=o.layouts[t.browserSizeMode];return t.appConfig.layouts[e]}const d=null===(r=o.layouts)||void 0===r?void 0:r[t.appConfig.mainSizeMode];return t.appConfig.layouts[d]}],((e,t,o)=>({mainSizeMode:e,browserSizeMode:t,layout:o}))),(0,e.createSelector)([(e,t)=>{var o,i,n;const{layoutId:l,layoutItemId:a}=t;return null===(n=null===(i=null===(o=e.appConfig.layouts)||void 0===o?void 0:o[l])||void 0===i?void 0:i.content)||void 0===n?void 0:n[a]},(t,o)=>{var i,n,l,a,r,s;const{layoutId:d,layoutItemId:u}=o,c=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[d])||void 0===n?void 0:n.content)||void 0===l?void 0:l[u];if((null==c?void 0:c.type)===e.LayoutItemType.Widget&&c.widgetId){const e=t.appConfig.widgets[c.widgetId];return null!==(s=null===(r=null===(a=null==e?void 0:e.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.watchViewportVisibility)&&void 0!==s&&s}return!1},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.selection},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.animationPreview},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.hoverPreview},(e,t)=>t.layoutId],((e,t,o,i,n,l)=>{var a;if(!e)return{layoutItem:null,selected:!1};let r=!1;const s=null!==(a=e.isPending)&&void 0!==a&&a;o&&(r=o.layoutId===l&&o.layoutItemId===e.id);const d={selected:r,watchViewportVisibility:t,layoutItem:s?null:e,autoScroll:r?o.autoScroll:void 0};if(r&&(null==i?void 0:i.layoutInfo)){const{layoutId:t,layoutItemId:o}=i.layoutInfo;d.animationPreview=t===l&&o===e.id,d.playMode=d.animationPreview?i.playMode:null,d.previewId=d.animationPreview?i.id:null}else if(r&&(null==n?void 0:n.layoutInfo)){const{layoutId:t,layoutItemId:o}=n.layoutInfo;d.hoverPreview=t===l&&o===e.id,d.previewId=d.hoverPreview?n.id:null}return d})),(0,e.createSelector)([(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&s.widgetId)return t.appConfig.widgets[s.widgetId]},(t,o)=>{var i,n,l,a;const{layoutId:r,layoutItemId:s}=o,d=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[r])||void 0===n?void 0:n.content)||void 0===l?void 0:l[s];if((null==d?void 0:d.type)===e.LayoutItemType.Widget&&!d.widgetId)return null===(a=d.setting)||void 0===a?void 0:a.placeholderStyle},(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&s.widgetId)return t.widgetsRuntimeInfo[s.widgetId]},(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&!s.widgetId)return t.widgetsState[s.widgetId]},(t,o)=>{var i,n;const{layoutId:l}=o,a=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[l];if((null===(n=a.parent)||void 0===n?void 0:n.type)===e.LayoutParentType.Widget){const e=a.parent.id,o=t.appConfig.widgets[e];return/widgets\/common\/controller\/?/.test(o.uri)}return!1}],((t,o,i,n,l)=>{var a,r,s,d,u,c,p,g,v,f,h,m,y,w,b,I;const x=null===(r=null===(a=null==t?void 0:t.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.supportInlineEditing;return{hasEmbeddedLayout:(null===(d=null===(s=null==t?void 0:t.manifest)||void 0===s?void 0:s.properties)||void 0===d?void 0:d.hasEmbeddedLayout)&&Object.keys(null!==(u=t.layouts)&&void 0!==u?u:{}).length>0,supportInlineEditing:x,supportRepeat:null===(p=null===(c=null==t?void 0:t.manifest)||void 0===c?void 0:c.properties)||void 0===p?void 0:p.supportRepeat,isClassLoaded:null!==(g=null==i?void 0:i.isClassLoaded)&&void 0!==g&&g,isInlineEditing:x&&(null==i?void 0:i.isInlineEditing),isInController:l,useDragHandler:null!==(h=null===(f=null===(v=null==t?void 0:t.manifest)||void 0===v?void 0:v.properties)||void 0===f?void 0:f.useDragHandler)&&void 0!==h&&h,widgetStyle:null!=t?t.style:o,canCrossLayoutBoundary:null===(y=null===(m=null==t?void 0:t.manifest)||void 0===m?void 0:m.properties)||void 0===y?void 0:y.canCrossLayoutBoundary,hasExtension:(null===(b=null===(w=null==t?void 0:t.manifest)||void 0===w?void 0:w.extensions)||void 0===b?void 0:b.length)>0,widgetJson:t,widgetId:null==t?void 0:t.id,isFunctionalWidget:(null===(I=null==t?void 0:t.manifest)||void 0===I?void 0:I.widgetType)!==e.WidgetType.Layout,widgetState:n}}));var Be=function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function a(e){try{s(i.next(e))}catch(e){l(e)}}function r(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((i=i.apply(e,t||[])).next())}))};function Ee(t,o){if(window.jimuConfig.isBuilder){(0,s.getAppConfigAction)(t).exec(),s.builderAppSync.publishChangeSelectionToApp(o)}else(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(t,o))}function Ne(t,o,i){return Be(this,void 0,void 0,(function*(){const n=o.layoutInfo;return o.id?yield function(e,t,o){return Be(this,void 0,void 0,(function*(){var i;const n=(0,s.getAppConfigAction)(e);let l;const a=d.utils.getCurrentSizeMode();l=t.isFromCurrentSizeMode?a:d.searchUtils.getBrowserSizeModeByLayoutId(e,t.layoutInfo.layoutId);const r=d.searchUtils.findLayoutItem(n.appConfig,t.layoutInfo),u=n.moveLayoutItem(t.layoutInfo,o,l,a);return(null===(i=r.setting)||void 0===i?void 0:i.lockParent)&&n.editLayoutItemProperty(u,"setting.lockParent",!0),yield Promise.resolve({layoutInfo:u,updatedAppConfig:n.appConfig})}))}(t,o,i):n&&n.layoutId&&n.layoutItemId?yield function(e,t,o){return Be(this,void 0,void 0,(function*(){const i=(0,s.getAppConfigAction)(e),n=d.utils.getCurrentSizeMode(),l=i.moveLayoutItem(t.layoutInfo,o,n,n),a=d.searchUtils.getWidgetIdThatUseTheLayoutId(e,o);return a&&$e(e.widgets[a])&&i.editLayoutItemProperty(l,"setting.lockParent",!0),{layoutInfo:l,updatedAppConfig:i.appConfig}}))}(t,o,i):o.itemType===e.LayoutItemType.Section?yield function(e,t){return Be(this,void 0,void 0,(function*(){const o=(0,s.getAppConfigAction)(e),i=o.addNewSectionToLayout(t);return{layoutInfo:{layoutId:t,layoutItemId:i},updatedAppConfig:o.appConfig}}))}(t,i):o.uri||o.itemId?yield function(e,t,o){return Be(this,void 0,void 0,(function*(){s.appBuilderSync.publishIsBusyToBuilder(!0);const i=(0,s.getAppConfigAction)(e),n=yield i.addNewWidgetToLayout(o,{uri:t.uri,itemId:t.itemId}),l={layoutId:o,layoutItemId:n},a=d.searchUtils.getWidgetIdThatUseTheLayoutId(e,o);return a&&$e(e.widgets[a])&&i.editLayoutItemProperty(l,"setting.lockParent",!0),s.appBuilderSync.publishIsBusyToBuilder(!1),{layoutInfo:l,updatedAppConfig:i.appConfig}}))}(t,o,i):yield function(e,t){return Be(this,void 0,void 0,(function*(){const o=(0,s.getAppConfigAction)(e),i=o.addPlaceholderToLayout(t),n={layoutId:t,layoutItemId:i},l=d.searchUtils.getWidgetIdThatUseTheLayoutId(e,t);return l&&$e(e.widgets[l])&&o.editLayoutItemProperty(n,"setting.lockParent",!0),{layoutInfo:n,updatedAppConfig:o.appConfig}}))}(t,i)}))}function $e(t){var o,i,n,l,a,r,s;const d=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.widgetType,u=null!==(l=null===(n=null===(i=null==t?void 0:t.manifest)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.hasEmbeddedLayout)&&void 0!==l&&l,c=null!==(s=null===(r=null===(a=null==t?void 0:t.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.lockChildren)&&void 0!==s&&s;return d!==e.WidgetType.Layout&&u&&c}function We(t,o,i,n,l,a,r){return Be(this,void 0,void 0,(function*(){let u=(0,s.getAppConfigAction)(r);const c={name:"row",label:"row",uri:"widgets/layout/row/",icon:null,itemType:e.LayoutItemType.Widget,manifest:{widgetType:e.WidgetType.Layout,properties:{}}},p=yield Ne(u.appConfig,c,o),{updatedAppConfig:g,layoutInfo:v}=p,f=d.utils.replaceBoundingBox(null,n,i);u=(0,s.getAppConfigAction)(g),u.editLayoutItemProperty(v,"bbox",f).adjustOrderOfItem(v,a);const h=d.searchUtils.findLayoutItem(g,p.layoutInfo),m=g.widgets[h.widgetId],y=Object.keys(m.layouts)[0],w=m.layouts[y],b=d.searchUtils.findLayoutId(w,(0,e.getAppStore)().getState().browserSizeMode,g.mainSizeMode),I=e.i18n.getIntl().formatMessage({id:"block"}),x=e.appConfigUtils.getUniqueLabel(g,"widget",I);u.editWidgetProperty(m.id,"label",x).editLayoutItemProperty(v,"setting.heightMode","fixed").editLayoutItemProperty(v,"bbox.height",n.height+20).editLayoutProperty(b,"parent",{id:m.id,type:e.LayoutParentType.Widget});const S=yield Ne(u.appConfig,t,b),{layoutInfo:C,updatedAppConfig:R}=S;u=(0,s.getAppConfigAction)(R),u.editLayoutItemProperty(C,"setting.heightMode","fit").editLayoutItemProperty(C,"bbox.left",0).editLayoutItemProperty(C,"bbox.width",l).editLayoutItemProperty(C,"bbox.height",Math.round(Math.min(n.height,i.height))).adjustOrderOfItem(C,0),window.jimuConfig.isBuilder?((0,s.getAppConfigAction)(u.appConfig).exec(),s.builderAppSync.publishChangeSelectionToApp(C)):(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(u.appConfig,C))}))}class He extends e.React.PureComponent{constructor(e){super(e),this.topLeft=this.updateFloatingArea.bind(this,1),this.topCenter=this.updateFloatingArea.bind(this,2),this.topRight=this.updateFloatingArea.bind(this,3),this.middleLeft=this.updateFloatingArea.bind(this,4),this.middleCenter=this.updateFloatingArea.bind(this,5),this.middleRight=this.updateFloatingArea.bind(this,6),this.bottomLeft=this.updateFloatingArea.bind(this,7),this.bottomCenter=this.updateFloatingArea.bind(this,8),this.bottomRight=this.updateFloatingArea.bind(this,9)}updateFloatingArea(t){const{layoutId:o,layoutItem:i}=this.props;!function(t,o,i){Be(this,void 0,void 0,(function*(){const n=d.utils.getCurrentPageRootLayoutId();let l=(0,s.getAppConfigAction)();const a=yield Ne(l.appConfig,{layoutInfo:t},n);l=(0,s.getAppConfigAction)(a.updatedAppConfig),l.editLayoutItemProperty(a.layoutInfo,"bbox",{top:0,left:0,right:0,width:`${o.width}px`,height:`${o.height}px`}).editLayoutItemProperty(a.layoutInfo,"setting.isFloating",!0).editLayoutItemProperty(a.layoutInfo,"setting.lockParent",!0).editLayoutItemProperty(a.layoutInfo,"setting.floatingArea",i).adjustOrderOfItem(a.layoutInfo,null),window.jimuConfig.isBuilder?((0,s.getAppConfigAction)(l.appConfig).exec(),s.builderAppSync.publishChangeSelectionToApp(a.layoutInfo)):(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(l.appConfig,a.layoutInfo))}))}({layoutId:o,layoutItemId:i.id},this.getSizeOfItem(),t)}getSizeOfItem(){const{layoutId:t,layoutItem:o}=this.props;let i;if(window.jimuConfig.isBuilder){const t=document.querySelector(`iframe[name="${e.APP_FRAME_NAME_IN_BUILDER}"]`);i=(null==t?void 0:t.contentDocument)||(null==t?void 0:t.contentWindow.document)}else i=document;const n=i.querySelector(`div.exb-rnd[data-layoutid="${t}"][data-layoutitemid="${o.id}"]`);return n?n.getBoundingClientRect():null}getStyle(){let t;t=window.jimuConfig.isBuilder?(0,H.getTheme)():(0,H.getTheme2)();const o=t.ref.palette.neutral[500];return e.css`
      background-color: ${t.ref.palette.neutral[400]};
      position: relative;
      padding: 4px;

      .content {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-row-gap: 0;
        grid-column-gap: 0;
        border: 1px solid ${o};

        & > button {
          cursor: pointer;
          height: 50px;
          width: 50px;
          position: relative;
          border: none;
          background-color: transparent;
          border-radius: 0;

          &:after {
            content: '';
            position: absolute;
            left: 1px;
            top: 1px;
            right: 1px;
            bottom: 1px;
          }

          &:hover {
            &:after {
              outline: 1px solid ${t.sys.color.primary.dark};
              background: ${t.sys.color.primary.light};
            }
          }
        }

        & > button:nth-of-type(3n+1) {
          border-right: 1px solid ${o};
        }
        & > button:nth-of-type(3n) {
          border-left: 1px solid ${o};
        }
        & > button:nth-of-type(1), & > button:nth-of-type(2), & > button:nth-of-type(3) {
          border-bottom: 1px solid ${o};
        }
        & > button:nth-of-type(7), & > button:nth-of-type(8), & > button:nth-of-type(9) {
          border-top: 1px solid ${o};
        }

        .selected:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          background-color: ${t.sys.color.primary.light};
          border: 1px solid ${t.sys.color.primary.main};
        }
      }
    `}render(){const{area:t}=this.props;return(0,e.jsx)("div",{className:"floating-area-chooser d-flex",css:this.getStyle()},(0,e.jsx)("div",{className:"content w-100"},(0,e.jsx)(R.Button,{className:(0,e.classNames)("top-left",{selected:1===t}),onClick:this.topLeft}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("top-center",{selected:2===t}),onClick:this.topCenter}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("top-right",{selected:3===t}),onClick:this.topRight}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("middle-left",{selected:4===t}),onClick:this.middleLeft}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("middle-center",{selected:5===t}),onClick:this.middleCenter}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("middle-right",{selected:6===t}),onClick:this.middleRight}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("bottom-left",{selected:7===t}),onClick:this.bottomLeft}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("bottom-center",{selected:8===t}),onClick:this.bottomCenter}),(0,e.jsx)(R.Button,{className:(0,e.classNames)("bottom-right",{selected:9===t}),onClick:this.bottomRight})))}}He.defaultProps={area:0};var Ve=c(9044),De=c.n(Ve),Fe=c(93387),Ue=c.n(Fe),_e=c(51993),qe=c.n(_e),Ge=c(9869),Ye=c.n(Ge),Xe=c(64548),Ze=c.n(Xe),Je=c(30119),Ke=c.n(Je),Qe=c(93303),et=c.n(Qe);function tt(){var t;let o=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(o=o.appStateInBuilder),null===(t=o.appRuntimeInfo)||void 0===t?void 0:t.appMode}function ot(){var t,o,i;let n=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(n=n.appStateInBuilder),null!==(i=null===(o=null===(t=n.appConfig)||void 0===t?void 0:t.forBuilderAttributes)||void 0===o?void 0:o.lockLayout)&&void 0!==i&&i}function it(){return tt()===e.AppMode.Design}const nt={icon:De(),title:e=>e.formatMessage("delete"),visible:t=>{const o=tt();return(o===e.AppMode.Design||o===e.AppMode.Express)&&(!ot()||function(t){var o;let i=(0,e.getAppStore)().getState();if(window.jimuConfig.isBuilder&&(i=i.appStateInBuilder),t.type===e.LayoutItemType.Widget&&t.widgetId){const n=i.appConfig.widgets[t.widgetId];if(n)return(null===(o=n.manifest)||void 0===o?void 0:o.widgetType)!==e.WidgetType.Layout}return!1}(t.layoutItem))},onClick:e=>{const{layoutItem:t,layoutId:o}=e,i={layoutId:o,layoutItemId:t.id};s.appBuilderSync.publishConfirmDeleteToApp(i)}},lt={icon:Ue(),title:e=>e.formatMessage("pendingTip"),visible:t=>tt()===e.AppMode.Design&&!ot()&&function(e){const{layoutItem:t}=e;return null!=t.widgetId||null!=t.sectionId||null!=t.screenGroupId}(t),onClick:e=>{const{layoutId:t,layoutItem:o}=e;!function(e){const t=(0,s.getAppConfigAction)();t.setLayoutItemToPending(e,!0),Ee(t.appConfig,null)}({layoutId:t,layoutItemId:o.id})}},at=(et(),qe(),{icon:Ye(),title:e=>e.formatMessage("duplicate"),visible:t=>{var o,i,n;if(ot()||!it())return!1;const{layoutId:l}=t,a=null===(o=(0,e.getAppStore)().getState().appConfig)||void 0===o?void 0:o.layouts[l];return"ROW"!==(null==a?void 0:a.type)||(null!==(n=null===(i=a.order)||void 0===i?void 0:i.length)&&void 0!==n?n:0)<12},onClick:e=>{const{layoutId:t,layoutItem:o}=e;!function(e){const{layoutId:t}=e,o=(0,s.getAppConfigAction)(),i={layoutId:t,layoutItemId:o.duplicateLayoutItemInSameLayout(e)};Ee(o.appConfig,i)}({layoutId:t,layoutItemId:o.id})}}),rt={icon:Ze(),title:e=>e.formatMessage("floating"),visible:t=>{if(ot()||!it())return!1;const{layoutItem:o,layoutId:i}=t;return function(t){var o,i,n,l,a;const{layoutId:r,layoutItemId:u}=t,c=(0,s.getAppConfigAction)().appConfig,p=null===(n=null===(i=null===(o=null==c?void 0:c.layouts)||void 0===o?void 0:o[r])||void 0===i?void 0:i.content)||void 0===n?void 0:n[u];if(!p||(null===(l=p.setting)||void 0===l?void 0:l.isFloating))return!1;const g=d.utils.getActivePagePart();if(g!==e.PagePart.Header&&g!==e.PagePart.Footer){const t=d.utils.getCurrentPageRootLayoutId();return(null===(a=c.layouts[t])||void 0===a?void 0:a.type)===e.LayoutType.FlowLayout&&r!==t}return!1}({layoutId:i,layoutItemId:o.id})},settingPanel:He,onClick:()=>{}},st={icon:Ke(),title:e=>e.formatMessage("sinking"),visible:e=>{var t,o;if(ot()||!it())return!1;const{layoutItem:i}=e;return null!==(o=null===(t=i.setting)||void 0===t?void 0:t.isFloating)&&void 0!==o&&o},onClick:t=>{const{layoutId:o,layoutItem:i,clientRect:n}=t;!function(t,o){Be(this,void 0,void 0,(function*(){var i;const{layoutId:n,layoutItemId:l}=t,a=(0,s.getAppConfigAction)();let r,u,c=-1,p=2;if(window.jimuConfig.isBuilder){const t=document.querySelector(`iframe[name="${e.APP_FRAME_NAME_IN_BUILDER}"]`);u=(null==t?void 0:t.contentDocument)||(null==t?void 0:t.contentWindow.document)}else u=document;if(null==o){const e=u.querySelector(`div.exb-rnd[data-layoutid="${n}"][data-layoutitemid="${l}"]`);o=e?e.getBoundingClientRect():{width:100,height:100}}const g=u.querySelectorAll(`div.flow-layout[data-layoutid="${n}"] > div.trail-container > div.builder-layout-item:not(.floating)`);if((null==g?void 0:g.length)>1)for(let e=0;e<g.length;e++){const t=g[e];if(-1===c&&t.getAttribute("data-layoutitemid")!==l){const i=t.getBoundingClientRect();if(p=Math.round(12*o.width/i.width),d.utils.contains(i,o)){c=e,r=i;break}if(d.utils.intersects(i,o)){c=e+1,r=i;break}}}else{const t=e.utils.findViewportSize(d.utils.getAppConfig(),d.utils.getCurrentSizeMode());r={left:0,top:0,width:t.width,height:t.height},p=Math.round(12*o.width/t.width)}-1===c&&(c=(null===(i=a.appConfig.layouts[n].order)||void 0===i?void 0:i.length)||0),We({layoutInfo:t},n,r||o,o,p,c)}))}({layoutId:o,layoutItemId:i.id},n)}},dt="interactjs-dragging";c(26245);const ut="interactjs-resizing";class ct extends e.React.PureComponent{constructor(){super(...arguments),this.state={activeItem:null},this.onItemClick=e=>{let t=this.state.toggleOn;t=e!==this.state.activeItem||!t,this.setState({activeItem:e,toggleOn:t})},this.onItemUnSelected=e=>{e===this.state.activeItem&&this.setState({activeItem:null,toggleOn:!1})}}getStyle(){const{theme:t}=this.props;return e.css`
      display: flex;
      pointer-events: all;
      border-radius: 2px;
      box-shadow: 0 2px 8px 1px rgba(0,0,0,0.20);
      height: 100%;
      margin: 5px 0;
      background: ${t.ref.palette.neutral[400]};

      .toolbar-item, .toolbar-item {
        .jimu-btn:focus, .jimu-btn:focus-visible {
          z-index: 1;
        }
      }

      .${dt} &,
      .${ut} &,
      .${"exb-h5-dragging"} & {
        display: none;
      }
    `}reOrganizeTools(){const{tools:t}=this.props;if(d.utils.getCurrentSizeMode()===e.BrowserSizeMode.Small){if(t.filter((e=>{let t;t=Array.isArray(e)?e[0]:e;const{visible:o,seperator:i=!1}=t,n="function"==typeof o?o(this.props):o;return!i&&(void 0===o||n)})).length>8){const e=t.slice(0,8),o=t.slice(8).map((e=>Object.assign(Object.assign({},e),{label:e.title}))),i=[{icon:Ie(),caret:!1},...o];return e.push(i),e}}return t}render(){const{tools:t,isLockLayout:o}=this.props;if(!t||0===t.length)return null;const i=this.reOrganizeTools(),{activeItem:n,toggleOn:l}=this.state;return(0,e.jsx)(xe.Provider,{value:Object.assign(Object.assign({},this.props),{activeItem:n,toggleOn:l,onItemClick:this.onItemClick,onItemUnSelected:this.onItemUnSelected,isLockLayout:o})},(0,e.jsx)("div",{css:this.getStyle(),className:`layout-item-toolbar ${window.jimuConfig.isInBuilder?H.Theme2GlobalStyleClassName:""}`},i.map(((t,o)=>Array.isArray(t)?(0,e.jsx)(je,{uid:`${o}`,key:o,tools:t}):(0,e.jsx)(Ae,Object.assign({uid:`${o}`,key:o},t))))))}}const pt=(0,e.createSelector)((e=>{var t,o,i;return null!==(i=null===(o=null===(t=e.appConfig)||void 0===t?void 0:t.forBuilderAttributes)||void 0===o?void 0:o.lockLayout)&&void 0!==i&&i}),(e=>({isLockLayout:e}))),gt=e.ReactRedux.connect(pt)(ct);var vt=c(37568),ft=c.n(vt),ht=c(52943),mt=c.n(ht),yt=c(23662),wt=c.n(yt),bt=c(55447);function It(t){let o=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(o=o.appStateInBuilder),d.searchUtils.getSectionInfo(o,t.sectionId)}function xt(t){var o;const{navInfo:i,views:n,activeView:l}=null!=t?t:{};if(!i)return null==l?void 0:l.id;if(!i.useProgress)return i.currentViewId;const a=(null===(o=i.visibleViews)||void 0===o?void 0:o.length)>0?i.visibleViews:n,{currentIndex:r}=(0,e.getIndexFromProgress)(i.progress,a.length);return a[r]}const St={icon:c.n(bt)(),title:e=>e.formatMessage("duplicateView"),visible:()=>tt()===e.AppMode.Design&&!ot(),onClick:t=>{const{layoutItem:o}=t;let i=xt(It(o));if(!i){i=It(o).views[0]}const n=(0,s.getAppConfigAction)(),l=n.duplicateView(i,o.sectionId,!0);n.exec(),e.jimuHistory.changeView(o.sectionId,l.id)}},Ct={icon:T(),title:e=>e.formatMessage("deleteView"),visible:t=>{if(tt()!==e.AppMode.Design||ot())return!1;const{layoutItem:o}=t,i=It(o);if(!i)return!1;const{views:n}=i;return n&&n.length>1},onClick:t=>{const{layoutItem:o}=t,i=It(o),{views:n}=i,l=xt(i);if(n.length>1){const i=n.indexOf(l);let a;a=i>0?n[i-1]:n[1],(0,s.getAppConfigAction)().removeView(l,o.sectionId).exec(),e.jimuHistory.changeView(t.layoutItem.sectionId,a)}}},Rt=[{icon:ft(),autoFlipIcon:!0,size:10,title:e=>e.formatMessage("previousView"),onClick:t=>{const{layoutItem:o}=t,i=It(o),{views:n}=i,l=xt(i),a=n.indexOf(l);a>0&&e.jimuHistory.changeView(o.sectionId,n[a-1])},disabled:e=>{const{layoutItem:t}=e,o=It(t);if(!o)return!0;const{views:i}=o,n=xt(o);return i.indexOf(n)<=0}},{label:e=>{const{layoutItem:t}=e,o=It(t);if(!o)return"";const{views:i}=o,n=xt(o);return`${Math.max(0,i.indexOf(n))+1} / ${i.length}`}},{icon:mt(),autoFlipIcon:!0,size:10,title:e=>e.formatMessage("nextView"),onClick:t=>{const{layoutItem:o}=t,i=It(o),{views:n}=i,l=xt(i),a=n.indexOf(l);a>=0&&a<n.length-1&&e.jimuHistory.changeView(o.sectionId,n[a+1])},disabled:e=>{const{layoutItem:t}=e,o=It(t);if(!o)return!0;const{views:i}=o,n=xt(o),l=i.indexOf(n);return l<0||l>=i.length-1}},{icon:wt(),title:e=>e.formatMessage("addView"),visible:()=>tt()===e.AppMode.Design&&!ot(),onClick:t=>{const{layoutItem:o}=t,i=(0,s.getAppConfigAction)(),n=i.addView(o.sectionId);i.exec(),e.jimuHistory.changeView(o.sectionId,n)}},St,Ct,{seperator:!0}],At=[at,rt,st,lt,nt],Pt=[].concat(Rt,At);let kt=0;function jt(t){e.ReactRedux.useSelector((t=>t.extensionsInfo[e.extensionSpec.ExtensionPoints.ContextTool]));const{layoutId:o,layoutItem:i,placement:n="top-start",refElement:l,modifiers:a,formatMessage:r,builderTheme:d,toolItems:u=[],showDefaultTools:c=!0}=t;if(!l)return null;const p=i.type===e.LayoutItemType.Section;let g=function({layoutId:t,layoutItem:o,refElement:i}){const{widgetId:n}=o;if(!n)return[];const l=e.ExtensionManager.getInstance().getExtensions(e.extensionSpec.ExtensionPoints.ContextTool),a=i.getBoundingClientRect();return l.filter((e=>e.widgetId===n)).map((e=>({widgetId:n,icon:e.getIcon(),title:e.getTitle.bind(e),onClick:e.onClick.bind(e),checked:e.checked&&e.checked.bind(e),disabled:e.disabled?"function"==typeof e.disabled?e.disabled.bind(e):e.disabled:null,visible:e.visible?"function"==typeof e.visible?e.visible.bind(e):e.visible:null,settingPanel:e.getSettingPanel({layoutId:t,layoutItem:o,clientRect:a}),index:e.index,extName:e.name}))).sort(((e,t)=>e.index-t.index))}(t);const v=p?Pt:At;let f=c?[...u,...v]:u;if(tt()===e.AppMode.Express){s.placeholderService.getPlaceholderInfo((0,e.getAppStore)().getState().appConfig,{layoutId:o,layoutItemId:i.id})&&(f=[nt])}return g.length>0?f.length>0&&(g=[].concat(f,{seperator:!0},g)):g=f,0===g.length?null:(0,e.jsx)(R._Popper,{placement:n,reference:l,open:!0,modifiers:a,version:kt++,trapFocus:!1,autoFocus:!1,css:e.css`
        background: transparent;
        box-shadow: none;
      `},(0,e.jsx)("div",null,(0,e.jsx)(gt,{layoutId:o,layoutItem:i,theme:d,parentRef:l,tools:g,formatMessage:r})))}var Mt=c(68972),Lt=c(56037),Tt="default"in Mt?Mt.default:Mt;Symbol.for("react-redux-context"),"undefined"!=typeof globalThis&&globalThis;Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen"),Symbol.for("react.client.reference");!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?Tt.useLayoutEffect:Tt.useEffect;function Ot(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function zt(e,t){if(Ot(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(let i=0;i<o.length;i++)if(!Object.prototype.hasOwnProperty.call(t,o[i])||!Ot(e[o[i]],t[o[i]]))return!1;return!0}Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var Bt;function Et(o){const{id:i}=o,{layoutId:n,layoutItem:l}=e.ReactRedux.useSelector((e=>{var o;const n=null===(o=e.appRuntimeInfo)||void 0===o?void 0:o.selection,l=v(i,t);let a,r;return n&&n.layoutId===l.id&&l.content[n.layoutItemId]&&(a=n.layoutId,r=l.content[n.layoutItemId]),{layoutId:a,layoutItem:r}}),zt),[a,r]=e.React.useState(null);e.React.useEffect((()=>{if(n&&l){let e=0;const t=setInterval((()=>{e++;const o=document.querySelector(`.single-widget-launcher:has(.widget-renderer[data-widgetid=${null==l?void 0:l.widgetId}])`)||document.querySelector(`.multiple-widget-launcher:has(.widget-renderer[data-widgetid=${null==l?void 0:l.widgetId}])`)||document.querySelector(`.mobile-panel-popper:has(.widget-renderer[data-widgetid=${null==l?void 0:l.widgetId}])`);r(o),(e>=20||o)&&clearInterval(t)}),100)}else r(null)}),[n,l]);const s=e.React.useMemo((()=>[{name:"preventOverflow",enabled:!0,options:{boundary:"viewport",altAxis:!0}},{name:"flip",enabled:!0,options:{boundary:"body",fallbackPlacements:(0,R.getFallbackPlacementsModifier)(["top-start","bottom-start"],!0).options.fallbackPlacements}}]),[]),d=e.hooks.useTranslation();return n&&l&&a&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(jt,{layoutId:n,layoutItem:l,refElement:a,modifiers:s,builderTheme:(0,H.getTheme2)(),formatMessage:d,showDefaultTools:!1}))}Bt=Lt.useSyncExternalStoreWithSelector,(e=>{e})(Mt.useSyncExternalStore);var Nt=function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function a(e){try{s(i.next(e))}catch(e){l(e)}}function r(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((i=i.apply(e,t||[])).next())}))};const $t=e.css`
  width: 300px;
  height: 300px;
  overflow-y: auto;
`,Wt={Builder:o=>{var i,n,l,a;const{id:r,config:c,version:p,autoSize:f}=o,h=e.hooks.useCheckSmallBrowserSizeMode(),m=null!==(n=null===(i=null==c?void 0:c.behavior)||void 0===i?void 0:i.arrangement)&&void 0!==n?n:"floating",{viewOnly:b}=e.React.useContext(d.PageContext),I=e.React.useRef(null),R=e.ReactRedux.useSelector((e=>e.widgetsState[r])),A=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentDialogId})),P=null==R?void 0:R.showWidgetsPanel,k=e.ReactRedux.useSelector((e=>e.browserSizeMode)),j=e.React.useRef(),M=u(r,t),L=((t,o)=>{const i=g(t,o),n=(0,e.getAppStore)().getState().appConfig;return Object.values((null==i?void 0:i.content)||{}).filter((e=>!e.widgetId)).map((e=>s.placeholderService.getPlaceholderInfo(n,{layoutId:i.id,layoutItemId:e.id})))})(r,t),T=!Object.keys(null!=M?M:{}).length&&0===L.length,O="floating"===m||h;e.React.useEffect((()=>{k===e.BrowserSizeMode.Small&&void 0!==P&&s.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!1,isItemAccepted:x,onSelect:W,keepPanel:!0,active:P})}),[P]);const z=e.React.useCallback(((t,o,i)=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(r,"hideArrow",t)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(r,"disablePrevious",o)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(r,"disableNext",i))}),[r]);e.React.useEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(r,"onArrowClick",j.current))}),[r]);const B=e.React.useCallback((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(r,"showWidgetsPanel",!1))}),[r]);e.React.useEffect((()=>{A&&B()}),[B,A]);const E=e.React.useRef([0,0]),N=Object.keys(M).filter((e=>y(M[e]))),$=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Express)),W=e.React.useCallback((o=>Nt(void 0,void 0,void 0,(function*(){var i,n;const l=v(r,t),a=null!==(n=null===(i=l.order)||void 0===i?void 0:i.length)&&void 0!==n?n:0;try{if($){const{widgets:i,layouts:n}=(0,e.getAppStore)().getState().appConfig,l=Object.values(i[r].layouts[t]).map((e=>n[e]));C(l,o,a)}else S(l,o,a)}catch(e){console.error("Failed to add widget")}}))),[r,$]);return(0,e.jsx)("div",{className:"controller-builder w-100 h-100",ref:I,onClick:e=>{const t=e.target,o=I.current;t&&o&&o.contains(t)&&B()}},O&&(0,e.jsx)(we,{id:r,config:c,version:p,rootRef:I,onResizeStop:(t,o)=>{if(!t)return;let i=(null==c?void 0:c.behavior.size)||(0,e.Immutable)({});i=i.set(t,o);const n=c.setIn(["behavior","size"],i);(0,s.getAppConfigAction)().editWidgetConfig(r,n).exec()}}),(0,e.jsx)(Et,{id:r}),(0,e.jsx)(Q,{autoSize:f,scrollRef:j,showPlaceholder:T,onScrollStatusChange:z,vertical:null===(l=null==c?void 0:c.behavior)||void 0===l?void 0:l.vertical,widgetId:r,onItemClick:t=>{var o,i;if(b)return;const n=null===(o=t.currentTarget.dataset)||void 0===o?void 0:o.widgetid,l=E.current[0]!==t.clientX||E.current[1]!==t.clientY;if(!n||l)return;N.includes(n)||t.stopPropagation();const a=null===(i=c.behavior)||void 0===i?void 0:i.onlyOpenOne;((t,o,i,n)=>{n?((0,e.getAppStore)().dispatch(e.appActions.closeWidgets(i)),i.includes(o)||((0,e.getAppStore)().dispatch(e.appActions.openWidget(o,t)),ue(o,t))):i.includes(o)?(0,e.getAppStore)().dispatch(e.appActions.closeWidget(o)):((0,e.getAppStore)().dispatch(e.appActions.openWidget(o,t)),ue(o,t))})(r,n,N,!!h||a)},onMouseDown:e=>{E.current=[e.clientX,e.clientY]},itemStyle:c.appearance.card,draggable:!0,markerEnabled:!b,space:null===(a=null==c?void 0:c.appearance)||void 0===a?void 0:a.space,afterRemoveWidget:e=>{c.behavior.openStarts.includes(e)&&(e=>{(0,s.getAppConfigAction)().editWidgetConfig(r,e).exec()})(c.setIn(["behavior","openStarts"],c.behavior.openStarts.filter((t=>t!==e))))}}),P&&k!==e.BrowserSizeMode.Small&&(0,e.jsx)(w.WidgetListPopper,{css:$t,placement:"right-start",referenceElement:I.current,isAccepted:x,onSelect:W,onClose:e=>{(e=>{var t,o;if(!e)return!1;if("controller-add-widget"===(null===(t=e.dataset)||void 0===t?void 0:t.extname))return!0;const i=e.parentElement;return"controller-add-widget"===(null===(o=null==i?void 0:i.dataset)||void 0===o?void 0:o.extname)})(null==e?void 0:e.target)||B()}}))}}})(),p})())}}}));