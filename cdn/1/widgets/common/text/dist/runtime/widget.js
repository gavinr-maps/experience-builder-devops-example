System.register(["jimu-core/emotion","jimu-core","jimu-theme","jimu-ui"],function(e,t){var o={},n={},r={},a={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){n.AppMode=e.AppMode,n.BaseVersionManager=e.BaseVersionManager,n.DynamicStyleResolverComponent=e.DynamicStyleResolverComponent,n.ExpressionResolverComponent=e.ExpressionResolverComponent,n.Immutable=e.Immutable,n.MutableStoreManager=e.MutableStoreManager,n.React=e.React,n.ReactRedux=e.ReactRedux,n.appActions=e.appActions,n.appConfigUtils=e.appConfigUtils,n.classNames=e.classNames,n.css=e.css,n.dynamicStyleUtils=e.dynamicStyleUtils,n.expressionUtils=e.expressionUtils,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.polished=e.polished},function(e){r.styled=e.styled,r.useTheme=e.useTheme},function(e){a.Popper=e.Popper,a.RichTextDisplayer=e.RichTextDisplayer,a.Scrollable=e.Scrollable,a.defaultMessages=e.defaultMessages,a.richTextUtils=e.richTextUtils,a.styleUtils=e.styleUtils}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=a},17663:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.854 2.153a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 7.74zm0 5a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 12.74z" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=n}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var i={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(i),s.d(i,{__set_webpack_public_path__:()=>k,default:()=>j});var e=s(67386),t=s(79244),o=s(1888),n=s(17663),r=s.n(n),a=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const l=o=>{const n=window.SVG,{className:s}=o,i=a(o,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",s);return n?(0,e.jsx)(n,Object.assign({className:l,src:r()},i)):(0,e.jsx)("svg",Object.assign({className:l},i))};var c=s(14321),u=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const d=(0,o.styled)("div")(({theme:e,styleState:o})=>{var n;return{width:"100%",height:"100%",position:"relative",overflowY:"hidden",".rich-displayer":Object.assign(Object.assign({width:"100%",height:"fit-content",lineHeight:1.42},!o.wrap&&{whiteSpace:"preserve nowrap !important"}),{"a:focus":{outlineOffset:"-3px",outlineWidth:"2px"},"exp:hover,arcade:hover":{background:"transparent !important",outline:"none !important",cursor:"default !important"}}),".text-fade":{position:"absolute",left:"0",height:o.fadeLength,width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",pointerEvents:"none","> .arrow":{position:"absolute",width:"16px",height:"16px",background:e.ref.palette.white,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center","&.arrow-bottom":{bottom:"4px"}},"&.text-fade-bottom":{bottom:"0",background:`linear-gradient(180deg, rgba(182, 182, 182, 0) 0%, ${t.polished.rgba(null!==(n=e.ref.palette.neutral[500])&&void 0!==n?n:"#444",.5)} 100%)`}},".bounce":{animationName:"bounce",animationDuration:"0.6s",animationIterationCount:"infinite",animationTimingFunction:"linear"},"@keyframes bounce":{"0%":{transform:"translateY(0px)"},"50%":{transform:"translateY(2px)"},"100%":{transform:"translateY(4px)"}}}});function p(n){var r;const{value:a="",placeholder:s,repeatedDataSource:i,useDataSources:p,widgetId:g,wrap:f,tooltip:m,dynamicStyleConfig:b,onArcadeChange:v}=n,h=u(n,["value","placeholder","repeatedDataSource","useDataSources","widgetId","wrap","tooltip","dynamicStyleConfig","onArcadeChange"]),x=t.React.useMemo(()=>a.replace(/\ufeff/g,""),[a]),S=(0,o.useTheme)(),y=t.React.useRef(void 0),w=t.expressionUtils.isSingleStringExpression(m),[R,j]=t.React.useState(""),[k,O]=t.React.useState("24px"),[M,I]=t.React.useState(!1),[C,D]=t.React.useState(!1),[U,P]=t.React.useState(0),[E,A]=t.React.useState(!1),N=t.React.useCallback(e=>{if(null==e)return;const{scrollable:t,bottoming:o}=e;I(o),D(t)},[]);t.React.useEffect(()=>{var e;if(null!=m&&w){const o=null!==(e=t.expressionUtils.getSingleStringExpressionText(m))&&void 0!==e?e:m.name;j(o)}},[m,w]);const T=t.React.useRef(void 0);return(0,e.jsxs)(d,Object.assign({styleState:{wrap:f,fadeLength:k},title:R,onMouseEnter:()=>{var e,t;null!=T.current&&(clearTimeout(T.current),T.current=null);const o=(n=null!==(t=null===(e=y.current)||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0)<=80?"0px":n<=140?"24px":"15%";var n;A("0px"!==o),P(e=>e+1),O(o)},onMouseLeave:()=>{T.current=setTimeout(()=>{A(!1),T.current=null},500)},ref:y},h,{children:[(0,e.jsx)(c.Scrollable,{ref:N,version:U,children:(0,e.jsx)(c.RichTextDisplayer,{widgetId:g,repeatedDataSource:i,useDataSources:p,value:x,placeholder:s})}),E&&C&&!M&&(0,e.jsx)("div",{className:"text-fade text-fade-bottom",children:(0,e.jsx)("span",{className:"arrow arrow-bottom rounded-circle mr-1",children:(0,e.jsx)(l,{className:"bounce",color:null===(r=null==S?void 0:S.ref.palette)||void 0===r?void 0:r.black})})}),!w&&m&&(0,e.jsx)(t.ExpressionResolverComponent,{useDataSources:p,expression:m,widgetId:g,onChange:e=>{(null==e?void 0:e.isSuccessful)?j(e.value):j("")}}),(0,e.jsx)(t.DynamicStyleResolverComponent,{widgetId:g,useDataSources:p,dynamicStyleConfig:b,onChange:e=>{if(e){const t=e.asMutable({deep:!0});(null==t?void 0:t.border)&&Object.assign(t,t.border),(null==t?void 0:t.borderRadius)&&(t.borderRadius.number=t.borderRadius.number.map(e=>null===e?0:e));const o=c.styleUtils.toCSSStyle(t);null==v||v(o)}else null==v||v({})}})]}))}const g={_widgetLabel:"Text",defaultPlaceholder:"Double click to edit text"},f=JSON.parse('{"Qq":"<p></p>","qf":"Double click to edit text","iF":{"wrap":true}}');class m extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.13.0",description:"Remove useless line-height: normal;",upgrader:e=>{var t;let o=null!==(t=e.text)&&void 0!==t?t:"";return o.includes("line-height: normal;")?(o=o.replace(/line-height: normal;/gm,"line-height: 1.2;"),e.set("text",o)):e}},{version:"1.17.0",description:"Complete the default config",upgrader:e=>{let t=e;return t.text||(t=t.set("text",f.Qq)),t.placeholder||(t=t.set("placeholder",f.qf)),t.style||(t=t.set("style",f.iF)),t}}]}}const b=new m;var v,h=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(v||(v={}));const x=(e,t)=>(e===g.defaultPlaceholder&&(e=((e,t)=>null!==t?t.formatMessage({id:e,defaultMessage:g[e]}):"")("defaultPlaceholder",t)),e),S=(0,o.styled)("div")(({styleState:e})=>{const{dynamicStyles:t,color:o}=e,n=t||{},{backgroundColor:r,backgroundImage:a,backgroundPosition:s,backgroundRepeat:i,backgroundSize:l}=n,c=h(n,["backgroundColor","backgroundImage","backgroundPosition","backgroundRepeat","backgroundSize"]);return Object.assign(Object.assign({minHeight:"12px"},c),{backgroundColor:r,backgroundImage:a,backgroundPosition:s,backgroundRepeat:i,backgroundSize:l,color:c.color||o,"h1,h2,h3,h4,h5,h6,span,p,span,p,s,strong,em,u,ol,ul,li,exp,a,arcade":c})}),y={rootBoundary:"viewport",crossAxis:!0,padding:4},w={boundary:document.body,fallbackPlacements:["right-start","left-start","top","bottom","left","right","top-start","bottom-start"]},R=o=>{var n,r,a,s,i;const{builderSupportModules:l,id:u,intl:d,useDataSources:g,repeatedDataSource:f,useDataSourcesEnabled:m,isInlineEditing:b,config:h,onInitResizeHandler:R}=o,j=t.ReactRedux.useDispatch(),{current:k}=t.React.useRef((0,t.getAppStore)().getState().appContext.isInBuilder),O=t.hooks.useWidgetSelected(u),M=t.hooks.useLatest(O),I=t.React.useRef(null),C=t.ReactRedux.useSelector(e=>e.appRuntimeInfo.appMode),D=t.ReactRedux.useSelector(e=>e.dynamicStyleState),U=null==l?void 0:l.jimuForBuilderLib.getAppConfigAction,P=null==l?void 0:l.widgetModules.Editor,E=null==l?void 0:l.widgetModules.builderUtils,A=null===(r=null===(n=h.style)||void 0===n?void 0:n.wrap)||void 0===r||r,N=null===(a=h.style)||void 0===a?void 0:a.color,T=t.React.useMemo(()=>t.appConfigUtils.processResourceUrl(h.text),[h.text]),z=h.tooltip,_=x(h.placeholder,d),B=m?g:void 0,F=null!==(s=null==B?void 0:B.length)&&void 0!==s?s:0,L=null===(i=h.style)||void 0===i?void 0:i.dynamicStyleConfig,[W,V]=t.React.useState({}),[H,q]=t.React.useState(null),[Y,Q]=t.React.useState(null),$=t.React.useRef(!1),G=t.React.useMemo(()=>{let e=v.Sub;return e=null==f?v.None:0===f.recordIndex?v.Main:v.Sub,e},[f]),J=t.React.useMemo(()=>{var e,t;return"number"==typeof(null===(t=null===(e=null==D?void 0:D.previewConditionInfo)||void 0===e?void 0:e[u])||void 0===t?void 0:t.conditionId)},[D,u]),K=t.hooks.usePrevious(J);t.React.useEffect(()=>{var e,o;if(J&&!K&&f){const n=f,r=(null===(o=null===(e=null==D?void 0:D.previewRepeatedRecordInfo)||void 0===e?void 0:e[n.widgetId])||void 0===o?void 0:o.asMutable())||{};j(t.appActions.changeDynamicStylePreviewRepeatedRecordInfo(n.widgetId,Object.assign(Object.assign({},r),{needUpdateRecordIndex:!0})))}},[j,J,K,f,D]);const X=t.React.useMemo(()=>{var e,t;let o=J;if(f&&o){const n=f,r=n.widgetId,a=n.recordIndex;if(r&&void 0!==a){(null===(t=null===(e=null==D?void 0:D.previewRepeatedRecordInfo)||void 0===e?void 0:e[r])||void 0===t?void 0:t.recordIndex)!==a&&(o=!1)}}return o},[D,J,f]),Z=t.hooks.useLatest(G!==v.Sub);t.React.useEffect(()=>{Z.current&&M.current&&C===t.AppMode.Run&&j(t.appActions.setWidgetIsInlineEditingState(u,!1))},[Z,M,C,j,u]),t.hooks.useUpdateEffect(()=>{Z.current&&k&&(b&&0!==F||(j(t.appActions.widgetStatePropChange(u,"showExpression",!1)),j(t.appActions.widgetStatePropChange(u,"showArcade",!1))))},[Z,b,F,j,u]);const ee=(C===t.AppMode.Design||C===t.AppMode.Express)&&G!==v.Sub,te=ee&&O,oe=ee&&b,ne=t.React.useRef(!1);t.React.useEffect(()=>()=>{ne.current=!0},[]),t.hooks.useUpdateEffect(()=>{if(!Z.current)return;let e=c.richTextUtils.getAllExpressions(T);e=null!=e?e:(0,t.Immutable)({}),e=e.merge(null!=z?{tooltip:z}:{}),$.current||0!==Object.keys(e).length?($.current=Object.keys(e).length>0,q(e)):q(null);const o=c.richTextUtils.getArcades(T);Q(o)},[Z,T,z,F]);const re=t.hooks.useEventCallback(()=>{if(ne.current)return;if(!k)return;const e=E.getExpressionParts(H);let o=t.expressionUtils.generateFieldsForUseDataSourcesByExpressionParts(e,B);if(L){const e=t.dynamicStyleUtils.generateFieldsForUseDataSourcesByDynamicStyle(L,B);o=t.expressionUtils.mergeUseDataSources(o,e)}if(Y&&Object.keys(Y).length>0){const e=function(e,o){const n=(0,t.Immutable)(o||[]);return Object.values(e).reduce((e,o)=>{const n=null==o?void 0:o.useDataSources;return(null==n?void 0:n.length)>0?t.expressionUtils.mergeUseDataSources(e,n):e},n)}(Y,B);o=t.expressionUtils.mergeUseDataSources(o,e)}((e,t)=>{if(!e||!t)return!1;if(e.length!==t.length)return!1;let o=!0;return e.forEach((e,n)=>{var r,a,s,i,l;e.dataSourceId===t[n].dataSourceId&&(null===(a=null!==(r=e.fields)&&void 0!==r?r:[])||void 0===a?void 0:a.length)===(null===(i=null!==(s=t[n].fields)&&void 0!==s?s:[])||void 0===i?void 0:i.length)?null===(l=e.fields)||void 0===l||l.forEach((e,r)=>{e!==t[n].fields[r]&&(o=!1)}):o=!1}),o})(B,o)||U((0,t.getAppStore)().getState().appConfig).editWidget({id:u,useDataSources:null==o?void 0:o.asMutable({deep:!0})}).exec()});t.hooks.useUpdateEffect(()=>{re()},[H,L,Y,re]);const ae=t.React.useMemo(()=>{const e=e=>e?`${e} !important`:void 0;return{color:e(W.color),fontStyle:e(W.fontStyle),fontWeight:e(W.fontWeight),fontSize:e(W.fontSize),textDecoration:e(W.textDecoration),backgroundColor:e(W.backgroundColor),backgroundImage:e(W.backgroundImage),backgroundPosition:e(W.backgroundPosition),backgroundRepeat:e(W.backgroundRepeat),backgroundSize:e(W.backgroundSize)}},[W]);return(0,e.jsxs)(S,{"data-testid":"text-widget",className:(0,t.classNames)("widget-text jimu-widget p-1"),styleState:{dynamicStyles:ae,color:N},ref:I,children:[te&&(0,e.jsx)(P,{className:(0,t.classNames)({"d-none":!oe}),widgetId:u,nowrap:!A,onInitResizeHandler:R,useDataSources:B,enabled:!!b,onCreate:e=>{t.MutableStoreManager.getInstance().updateStateValue(u,"editor",e)},onDestroy:()=>{t.MutableStoreManager.getInstance().updateStateValue(u,"editor",null)},onComplete:(e,t)=>{ne.current||k&&U().editWidget({id:u,config:h.set("text",e).set("placeholder",t)}).exec()},onEditorFocus:()=>{j(t.appActions.widgetToolbarStateChange(u,["text-inline-editing"]))},placeholder:_,preserveWhitespace:!0,value:T}),(0,e.jsx)(p,{className:(0,t.classNames)({"d-none":oe}),value:T,tooltip:z,wrap:A,placeholder:_,useDataSources:B,widgetId:u,dynamicStyleConfig:L,onArcadeChange:e=>{V(e)},repeatedDataSource:f}),(0,e.jsx)(c.Popper,{open:X,offsetOptions:[0,4],css:t.css`
          white-space: nowrap;
          z-index: 12;
          background-color: var(--sys-color-info-dark);
          font-size: 12px;
          font-weight: 400;
          border: none;
          box-shadow: none;
          color: var(--sys-color-info-text);
      `,autoUpdate:!0,shiftOptions:y,flipOptions:w,placement:"right-start",reference:I,children:(0,e.jsx)("div",{className:"pl-2 pr-2 pt-1 pb-1",children:d.formatMessage({id:"conditionalStylePreview",defaultMessage:c.defaultMessages.conditionalStylePreview})})})]})};R.versionManager=b;const j=R;function k(e){s.p=e}})(),i})())}}});