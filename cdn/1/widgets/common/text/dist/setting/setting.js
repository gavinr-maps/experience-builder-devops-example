System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/advanced/rich-text-editor","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder","jimu-ui/advanced/dynamic-style-builder"],function(e,t){var o={},i={},n={},l={},a={},s={},r={},c={},u={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){i.DataSourceTypes=e.DataSourceTypes,i.DynamicStyleType=e.DynamicStyleType,i.Immutable=e.Immutable,i.React=e.React,i.ReactRedux=e.ReactRedux,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dynamicStyleUtils=e.dynamicStyleUtils,i.getAppStore=e.getAppStore,i.hooks=e.hooks},function(e){n.builderAppSync=e.builderAppSync},function(e){l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection},function(e){a.RichTextFormatKeys=e.RichTextFormatKeys,a.RichTextFormats=e.RichTextFormats,a.richTextEditorUtils=e.richTextEditorUtils,a.useEditorSelectionFormats=e.useEditorSelectionFormats},function(e){s.Button=e.Button,s.Switch=e.Switch,s.TextArea=e.TextArea,s.defaultMessages=e.defaultMessages,s.richTextUtils=e.richTextUtils},function(e){r.DataSourceSelector=e.DataSourceSelector},function(e){c.ExpressionInput=e.ExpressionInput,c.ExpressionInputType=e.ExpressionInputType},function(e){u.DynamicStyleBuilderSwitch=e.DynamicStyleBuilderSwitch}],execute:function(){e((()=>{var e={4108:e=>{"use strict";e.exports=n},9759:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.5 2a.5.5 0 0 0 0 1H7l-1.868 8.406a.488.488 0 0 0 .953.212L8 3h3.5a.5.5 0 0 0 0-1zm-1 11a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zm6.64-3.86a.477.477 0 0 1 .674 0l1.686 1.686 1.686-1.686a.477.477 0 1 1 .674.674L12.174 11.5l1.686 1.686a.477.477 0 1 1-.674.674L11.5 12.174 9.814 13.86a.477.477 0 1 1-.674-.674l1.686-1.686L9.14 9.814a.477.477 0 0 1 0-.674" clip-rule="evenodd"></path></svg>'},13089:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=s},33949:e=>{"use strict";e.exports=a},67386:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=l},84845:e=>{"use strict";e.exports=c},85252:e=>{"use strict";e.exports=u}},t={};function d(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var o in t)d.o(t,o)&&!d.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var p={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(p),d.d(p,{__set_webpack_public_path__:()=>I,default:()=>D});var e=d(67386),t=d(79244),o=d(4108),i=d(79298),n=d(33949),l=d(14321),a=d(13089);const s={verticalAlignment:"Vertical alignment"};var r=d(84845);var c=d(9759),u=d.n(c),y=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const S=o=>{const i=window.SVG,{className:n}=o,l=y(o,["className"]),a=(0,t.classNames)("jimu-icon jimu-icon-component",n);return i?(0,e.jsx)(i,Object.assign({className:a,src:u()},l)):(0,e.jsx)("svg",Object.assign({className:a},l))};var m=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const g=t.css`
  > * {
    user-select: none;
  }
`,x=o=>{const{editor:i,onChange:a}=o,s=m(o,["editor","onChange"]),[,r]=(0,n.useEditorSelectionFormats)(i,!0),c=t.hooks.useTranslation(l.defaultMessages);return(0,e.jsx)(l.Button,Object.assign({css:g},s,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{n.richTextEditorUtils.clearFormats(i,r),null==a||a(null==i?void 0:i.root.innerHTML)},title:c("clearAllFormats"),"aria-label":c("clearAllFormats"),children:(0,e.jsx)(S,{})}))};var b=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const f=o=>{const{editor:i,defaultColor:l}=o,a=b(o,["editor","defaultColor"]),[s,r]=(0,n.useEditorSelectionFormats)(i,!0),c=t.React.useMemo(()=>{var e;let t=s;return null!=(null===(e=null==t?void 0:t.link)||void 0===e?void 0:e.link)&&(t=Object.assign(Object.assign({},t),{link:t.link.link})),!t.color&&l&&(t=Object.assign(Object.assign({},t),{color:l})),t},[s,l]);return(0,e.jsx)(n.RichTextFormats,Object.assign({editor:i,formats:c,selection:r},a))};var v=d(85252);const h=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SceneLayer,t.DataSourceTypes.BuildingComponentSubLayer,t.DataSourceTypes.OrientedImageryLayer,t.DataSourceTypes.ImageryLayer,t.DataSourceTypes.SubtypeGroupLayer,t.DataSourceTypes.SubtypeSublayer]),w=(0,t.Immutable)([t.DynamicStyleType.Text,t.DynamicStyleType.Background]),j=(0,t.Immutable)([t.DynamicStyleType.Text,t.DynamicStyleType.Background]),T=(0,t.Immutable)([r.ExpressionInputType.Static,r.ExpressionInputType.Attribute,r.ExpressionInputType.Statistics,r.ExpressionInputType.Expression]),O=(0,t.Immutable)([]),D=c=>{var u,d,p,y,S,m,g,b,D;const{id:I,config:C,useDataSources:E,useDataSourcesEnabled:R,onSettingChange:A}=c,M="Web Experience Template"===(null===(d=null===(u=(0,t.getAppStore)().getState().appStateInBuilder)||void 0===u?void 0:u.appInfo)||void 0===d?void 0:d.type),U=C.style,F=null===(p=null==U?void 0:U.wrap)||void 0===p||p,k=null!==(y=null==U?void 0:U.enableDynamicStyle)&&void 0!==y&&y,P=null==U?void 0:U.dynamicStyleConfig,B=C.text,L=C.placeholder,_=t.React.useMemo(()=>{var e;return null!==(e=l.richTextUtils.getHTMLTextContent(L))&&void 0!==e?e:""},[L]),N=t.React.useMemo(()=>{var e,t;return Object.values(null!==(t=null===(e=l.richTextUtils.getAllExpressions(B))||void 0===e?void 0:e.asMutable({deep:!0}))&&void 0!==t?t:{})},[B]),V=C.tooltip,H=t.ReactRedux.useSelector(e=>e.appStateInBuilder),W=null===(m=null===(S=null==H?void 0:H.widgetsMutableStateVersion)||void 0===S?void 0:S[I])||void 0===m?void 0:m.editor,z=null===(b=null===(g=null==H?void 0:H.widgetsRuntimeInfo)||void 0===g?void 0:g[I])||void 0===b?void 0:b.isInlineEditing,K=R&&(null==E?void 0:E.length)>0,[G,q]=t.React.useState(null),[J,Q]=t.React.useState(!1);t.React.useEffect(()=>{var e;const t=window._appWindow._mutableStoreManager,o=null!==(e=null==t?void 0:t.getStateValue([I,"editor"]))&&void 0!==e?e:null;q(o)},[W,I]);const X=t.hooks.useTranslation(s,l.defaultMessages),Y=(e,o,i)=>{const a=l.richTextUtils.isBlankRichText(B)&&!!L,s=!z&&a?"placeholder":"text";e="text"===s?t.appConfigUtils.restoreResourceUrl(e):e;let r=C.set(s,e);z||o!==n.RichTextFormatKeys.Color||(r=r.setIn(["style","color"],i)),A({id:I,config:r})},Z=t.React.useMemo(()=>K?T:(0,t.Immutable)([r.ExpressionInputType.Static]),[K]);return(0,e.jsxs)("div",{className:"widget-setting-text jimu-widget-setting",children:[(0,e.jsx)(i.SettingSection,{children:(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(a.DataSourceSelector,{isMultiple:!0,types:h,useDataSources:E,useDataSourcesEnabled:R,onToggleUseDataEnabled:()=>{var e;o.builderAppSync.publishWidgetToolbarStateChangeToApp(I,["text-expression","text-arcade"]);const t=C.without("tooltip").set("style",null===(e=C.style)||void 0===e?void 0:e.without("enableDynamicStyle").without("dynamicStyleConfig")),i=!R;A(!V&&!k||i?{id:I,useDataSourcesEnabled:i}:{id:I,config:t,useDataSourcesEnabled:i})},onChange:e=>{var i,n,l;if(o.builderAppSync.publishWidgetToolbarStateChangeToApp(I,["text-expression","text-arcade"]),null==e){const e=C.set("style",null===(i=C.style)||void 0===i?void 0:i.without("enableDynamicStyle").without("dynamicStyleConfig"));A({id:I,config:e})}else if(null===(n=C.style)||void 0===n?void 0:n.enableDynamicStyle){let o;const i=t.dynamicStyleUtils.updateDynamicStyleWhenUseDataSourcesChange(I,E,(0,t.Immutable)(e),(0,t.Immutable)(C.style.dynamicStyleConfig));o=i?C.setIn(["style","dynamicStyleConfig"],i):C.set("style",null===(l=C.style)||void 0===l?void 0:l.without("enableDynamicStyle").without("dynamicStyleConfig")),A({id:I,config:o,useDataSources:e})}else A({id:I,useDataSources:e})},widgetId:I})})}),(0,e.jsxs)(i.SettingSection,{children:[(0,e.jsx)(i.SettingRow,{flow:"no-wrap",tag:"label",label:X("wrap"),children:(0,e.jsx)(l.Switch,{checked:F,onChange:()=>{A({id:I,config:C.setIn(["style","wrap"],!F)})}})}),(0,e.jsx)(i.SettingRow,{label:X("tooltip"),flow:"wrap",role:"group","aria-label":X("tooltip"),children:(0,e.jsx)("div",{className:"w-100",children:(0,e.jsx)(r.ExpressionInput,{"aria-label":X("tooltip"),autoHide:!0,useDataSources:K?E:O,onChange:e=>{null!=e&&(A({id:I,config:C.set("tooltip",e)}),Q(!1))},openExpPopup:()=>{Q(!0)},expression:"object"==typeof V?V:null,isExpPopupOpen:J,closeExpPopup:()=>{Q(!1)},types:Z,widgetId:I})})}),M&&(0,e.jsx)(i.SettingRow,{flow:"wrap",label:X("placeholder"),children:(0,e.jsx)(l.TextArea,{"aria-label":X("placeholder"),defaultValue:_,onAcceptValue:e=>{e=e.replace(/\n/gm,"");const t=((e,t)=>{const o=l.richTextUtils.getHTMLTextContent(e);return e.replace(null==o?void 0:o.trim(),t)})(L,e);A({id:I,config:C.set("placeholder",t)})}})})]}),null!=G&&(0,e.jsxs)(i.SettingSection,{children:[(0,e.jsx)(i.SettingRow,{flow:"no-wrap",label:X("textFormat"),role:"group","aria-label":X("textFormat"),children:(0,e.jsx)(x,{editor:G,onChange:Y})}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(f,{widgetId:I,editor:G,defaultColor:null===(D=C.style)||void 0===D?void 0:D.color,useDataSources:E,onChange:Y})})]}),K&&(0,e.jsx)(i.SettingSection,{children:(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(v.DynamicStyleBuilderSwitch,{widgetId:I,disabled:z,useDataSources:E,expressions:N,widgetDynamicContentCapability:"multiple",useIconsForArcade:!1,config:P,onChange:e=>{const t=C.setIn(["style","dynamicStyleConfig"],e);A({id:I,config:t})},switchChecked:k,onSwitchChange:(e,t)=>{let o=C.setIn(["style","enableDynamicStyle"],t);t||(o=o.set("style",o.style.without("dynamicStyleConfig"))),A({id:I,config:o})},conditionStyleTypes:w,arcacdeStyleTypes:j})})})]})};function I(e){d.p=e}})(),p})())}}});