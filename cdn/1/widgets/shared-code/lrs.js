/*! For license information please see lrs.js.LICENSE.txt */
System.register(["jimu-theme","jimu-core","widgets/shared-code/lrs","jimu-core/react","jimu-core/emotion","jimu-ui","esri/geometry/operators/disjointOperator","jimu-arcgis","calcite-components","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/map"],function(e,t){var r={},n={},i={},o={},s={},a={},l={},c={},u={},d={},h={},p={},f={};return Object.defineProperty(o,"__esModule",{value:!0}),{setters:[function(e){r.registerStyles=e.registerStyles,r.useTheme=e.useTheme,r.withStyles=e.withStyles,r.withTheme=e.withTheme},function(e){n.DataSourceManager=e.DataSourceManager,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.JimuFieldType=e.JimuFieldType,n.OrderRule=e.OrderRule,n.React=e.React,n.ReactRedux=e.ReactRedux,n.SessionManager=e.SessionManager,n.TimezoneConfig=e.TimezoneConfig,n.WidgetState=e.WidgetState,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.defaultMessages=e.defaultMessages,n.esri=e.esri,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,n.moduleLoader=e.moduleLoader,n.polished=e.polished,n.urlUtils=e.urlUtils,n.useIntl=e.useIntl,n.utils=e.utils},function(e){i.GetUniqueLrsUrls=e.GetUniqueLrsUrls,i.ImportMode=e.ImportMode,i.LoadLayers=e.LoadLayers,i.LrsLayerType=e.LrsLayerType,i.LrsViewSelector=e.LrsViewSelector,i.MapMode=e.MapMode,i.ModeType=e.ModeType,i.advancedActionMap=e.advancedActionMap,i.colorCyan=e.colorCyan,i.colorRed=e.colorRed,i.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,i.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,i.fieldsWithContingentValues=e.fieldsWithContingentValues,i.formatMessage=e.formatMessage,i.getAllDataSourcesLayer=e.getAllDataSourcesLayer,i.getAllDataSourcesMap=e.getAllDataSourcesMap,i.getAllDatasourceFromMapWidgetId=e.getAllDatasourceFromMapWidgetId,i.getAllUseDs=e.getAllUseDs,i.getContingentOptions=e.getContingentOptions,i.getDataSourceById=e.getDataSourceById,i.getUnsupportedLayerIds=e.getUnsupportedLayerIds,i.isConflictPreventionEnabledSelector=e.isConflictPreventionEnabledSelector,i.isParentNetworkAvailable=e.isParentNetworkAvailable,i.isSupportedJimuLayerView=e.isSupportedJimuLayerView,i.lrsDefaultMessages=e.lrsDefaultMessages,i.normalizeFieldName=e.normalizeFieldName,i.setConflictPreventionEnabled=e.setConflictPreventionEnabled,i.setContingentValues=e.setContingentValues,i.setDate=e.setDate,i.validateContingencyConstraints=e.validateContingencyConstraints,i.validateLayers=e.validateLayers,i.waitTime=e.waitTime},function(e){Object.keys(e).forEach(function(t){o[t]=e[t]})},function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.ConfirmDialog=e.ConfirmDialog,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.FloatingPanel=e.FloatingPanel,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.Popper=e.Popper,a.Radio=e.Radio,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){l.execute=e.execute},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent,c.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){u.CalciteButton=e.CalciteButton,u.CalciteInputDatePicker=e.CalciteInputDatePicker,u.CalciteTable=e.CalciteTable,u.CalciteTableCell=e.CalciteTableCell,u.CalciteTableHeader=e.CalciteTableHeader,u.CalciteTableRow=e.CalciteTableRow},function(e){d.getAppConfigAction=e.getAppConfigAction},function(e){h.MapWidgetSelector=e.MapWidgetSelector,h.SettingRow=e.SettingRow,h.SettingSection=e.SettingSection,h.SidePopper=e.SidePopper,h.getOutputJsonOriginDs=e.getOutputJsonOriginDs},function(e){p.List=e.List,p.Tree=e.Tree,p.TreeAlignmentType=e.TreeAlignmentType,p.TreeCollapseStyle=e.TreeCollapseStyle,p.TreeItemActionType=e.TreeItemActionType,p.TreeStyle=e.TreeStyle},function(e){f.DrawingElevationMode3D=e.DrawingElevationMode3D}],execute:function(){e((()=>{var e={270:(e,t,r)=>{"use strict";const n=r(53908),i=r(78311);e.exports=(e,t,r)=>{let o=null,s=null,a=null;try{a=new i(t,r)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(o&&1!==s.compare(e)||(o=e,s=new n(o,r)))}),o}},1888:e=>{"use strict";e.exports=r},4108:e=>{"use strict";e.exports=d},4146:(e,t,r)=>{"use strict";var n=r(44363),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return n.isMemo(e)?s:a[e.$$typeof]||i}a[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[n.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(f){var i=p(r);i&&i!==f&&e(t,i,n)}var s=u(r);d&&(s=s.concat(d(r)));for(var a=l(t),m=l(r),g=0;g<s.length;++g){var v=s[g];if(!(o[v]||n&&n[v]||m&&m[v]||a&&a[v])){var y=h(r,v);try{c(t,v,y)}catch(e){}}}}return t}},4644:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 3H3v1h1z"></path><path fill="#000" fill-rule="evenodd" d="M1 7V1h6v6zm1-5h4v4H2z" clip-rule="evenodd"></path><path fill="#000" d="M4 10H3v1h1zM4 12H3v1h1zM10 8h1v1h-1zM10 12h1v1h-1z"></path><path fill="#000" fill-rule="evenodd" d="M1 8v6H0v1h16v-1h-2V6H8v8H7V8zm5 6V9H2v5zm7-7v7H9V7z" clip-rule="evenodd"></path><path fill="#000" d="M10 10h1v1h-1z"></path></svg>'},5342:(e,t,r)=>{"use strict";const n=r(97075);e.exports=(e,t,r)=>n(e,t,"<",r)},6374:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#151515" fill-rule="evenodd" d="M2 0v9h1V1h7v4h4v4h1V3.6L11.4 0zm12 4h-3V1h.31L14 3.69zM1.5 13.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2M14.57 10h1.05l-1.615 5.059h-.994L11.421 10h1.047l1.044 3.317zM4 11v3h2v1H3v-5h3v1zm4 0v1h2v3H7v-1h2v-1H7v-3h3v1z" clip-rule="evenodd"></path></svg>'},7059:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>n(e,t,r)<0},8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},8816:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5 1H2v1h3zM0 14.09 1.2 7h1.014l-1.09 6.437a9.5 9.5 0 0 0 2.669.363 11 11 0 0 0 3.888-.748 12.8 12.8 0 0 1 4.526-.852 8.3 8.3 0 0 1 2.489.376l-1.72-10.163a7.2 7.2 0 0 0-2.27-.399 5.9 5.9 0 0 0-2.367.434q-.165.06-.339.12V1.506a6.9 6.9 0 0 1 2.706-.493 8.2 8.2 0 0 1 3.161.674L16 14.29a6.62 6.62 0 0 0-3.793-1.089c-1.833 0-3.02.4-4.207.8s-2.375.8-4.207.8A9.2 9.2 0 0 1 0 14.09M2 3h5v1H2zm6 3V5H2v1z" clip-rule="evenodd"></path></svg>'},9970:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>n(t,e,r)},11330:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path><path fill="#000" fill-rule="evenodd" d="m11.002 7.002-3 3-3-3v-4a2.893 2.893 0 0 1 3-3 2.893 2.893 0 0 1 3 3zm-3-6h-.038a1.893 1.893 0 0 0-1.963 1.962l.001.018v3.606l2 2 2-2V2.964A1.894 1.894 0 0 0 8.04 1z" clip-rule="evenodd"></path><path fill="#000" d="M4.072 1.908a10.4 10.4 0 0 1-1.939-.433L0 13.077c1.2.504 2.493.746 3.793.711A10.7 10.7 0 0 0 7 13.31v1.678H2v1h11v-1H8v-2a11.9 11.9 0 0 1 4.207-.8A6.62 6.62 0 0 1 16 13.277L13.867 1.674a8.2 8.2 0 0 0-2.236-.61 3.5 3.5 0 0 1 .336 1.066q.514.097 1.009.27l1.72 9.163a8.3 8.3 0 0 0-2.489-.376 12.8 12.8 0 0 0-4.526.852l-.604.204-.363.108a9.7 9.7 0 0 1-2.921.436 9.5 9.5 0 0 1-2.668-.363l1.81-9.697q.53.115 1.068.18v-.173a3.4 3.4 0 0 1 .069-.826"></path></svg>'},11763:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t)=>n(e,t,!0)},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},13874:(e,t,r)=>{"use strict";const n=r(78311);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},13999:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>0!==n(e,t,r)},14041:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5.53 6.937v4.356l5.386-1.905-.604-.45.604-.805 2.368 1.479-8.753 3.095V6.888a1.5 1.5 0 1 1 2.055-1.183l.827.482-.731.731-.556-.324c-.167.157-.37.276-.595.343M5.6 5.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0" clip-rule="evenodd"></path><path fill="#000" d="m8.307 7.414-.707.707.707.707.707-.707.707.707.707-.707-.707-.707.707-.707L9.721 6l-.707.707L8.307 6l-.707.707z"></path><path fill="#000" fill-rule="evenodd" d="M8 14.29c4.8-1.6 8 0 8 0L13.867 1.487a9.76 9.76 0 0 0-5.867 0 9.74 9.74 0 0 1-5.867 0L0 14.29s3.2 1.6 8 0m4.208-1.712c-1.54.01-3.067.267-4.524.762-1.253.428-2.567.65-3.891.66a9.5 9.5 0 0 1-2.67-.363L2.941 2.722a12 12 0 0 0 2.353.241 8.3 8.3 0 0 0 3.078-.547 6.3 6.3 0 0 1 2.334-.402c.768.006 1.533.097 2.28.272l1.76 10.56c-.834-.18-1.685-.27-2.538-.268" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=a},16874:e=>{"use strict";const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},17390:(e,t,r)=>{var n;!function(){"use strict";var i=function e(t){var r,n=Symbol.for("react.element"),i=Symbol.for("react.transitional.element"),o={use_static:!1};function s(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function a(e,t,r){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:r})}"object"!=typeof(r=t)||Array.isArray(r)||null===r||void 0!==t.use_static&&(o.use_static=Boolean(t.use_static));var l="__immutable_invariants_hold";function c(e){return"object"!=typeof e||(null===e||Boolean(Object.getOwnPropertyDescriptor(e,l)))}function u(e,t){return e===t||e!=e&&t!=t}function d(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var h=["setPrototypeOf"],p=(h.concat(["push","pop","sort","splice","shift","unshift","reverse"]),["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]));function f(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function m(e,t){return a(e,l,!0),e}function g(e,t){var r=e[t];a(e,t,function(){return $(r.apply(e,arguments))})}function v(e,t,r){var n=r&&r.deep;if(e in this&&(n&&this[e]!==t&&d(t)&&d(this[e])&&(t=$.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var i=R.call(this);return i[e]=$(t),I(i)}h.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]),f.prototype=new Error,f.prototype.constructor=Error;var y=$([]);function S(e,t,r){var n=e[0];if(1===e.length)return v.call(this,n,t,r);var i,o=e.slice(1),s=this[n];if("object"==typeof s&&null!==s)i=$.setIn(s,o,t);else{var a=o[0];i=""!==a&&isFinite(a)?S.call(y,o,t):x.call(P,o,t)}if(n in this&&s===i)return this;var l=R.call(this);return l[n]=i,I(l)}function I(e){for(var t in p){if(p.hasOwnProperty(t))g(e,p[t])}o.use_static||(a(e,"flatMap",E),a(e,"asObject",T),a(e,"asMutable",R),a(e,"set",v),a(e,"setIn",S),a(e,"update",k),a(e,"updateIn",F),a(e,"getIn",U));for(var r=0,n=e.length;r<n;r++)e[r]=$(e[r]);return m(e)}function w(){return new Date(this.getTime())}function E(e){if(0===arguments.length)return this;var t,r=[],n=this.length;for(t=0;t<n;t++){var i=e(this[t],t,this);Array.isArray(i)?r.push.apply(r,i):r.push(i)}return I(r)}function b(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach(function(e,t,r){"number"==typeof e&&(r[t]=e.toString())}),e=function(e,r){return-1!==t.indexOf(r)}}var r=s(this);for(var n in this)this.hasOwnProperty(n)&&!1===e(this[n],n)&&(r[n]=this[n]);return G(r)}function R(e){var t,r,n=[];if(e&&e.deep)for(t=0,r=this.length;t<r;t++)n.push(N(this[t]));else for(t=0,r=this.length;t<r;t++)n.push(this[t]);return n}function T(e){"function"!=typeof e&&(e=function(e){return e});var t,r={},n=this.length;for(t=0;t<n;t++){var i=e(this[t],t,this),o=i[0],s=i[1];r[o]=s}return G(r)}function N(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,l)||e instanceof Date?e:$.asMutable(e,{deep:!0})}function O(e,t){for(var r in e)Object.getOwnPropertyDescriptor(e,r)&&(t[r]=e[r]);return t}function C(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var r,n,i=Array.isArray(e),o=t&&t.deep,a=t&&t.mode||"merge",l=t&&t.merger;function c(e,n,i){var a,c=$(n[i]),h=l&&l(e[i],c,t),p=e[i];void 0===r&&void 0===h&&e.hasOwnProperty(i)&&u(c,p)||(u(p,a=void 0!==h?h:o&&d(p)&&d(c)?$.merge(p,c,t):c)&&e.hasOwnProperty(i)||(void 0===r&&(r=O(e,s(e))),r[i]=a))}if(i)for(var h=0,p=e.length;h<p;h++){var f=e[h];for(n in f)f.hasOwnProperty(n)&&c(void 0!==r?r:this,f,n)}else{for(n in e)Object.getOwnPropertyDescriptor(e,n)&&c(this,e,n);"replace"===a&&function(e,t){for(var n in e)t.hasOwnProperty(n)||(void 0===r&&(r=O(e,s(e))),delete r[n])}(this,e)}return void 0===r?this:G(r)}function L(e,t){var r=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return $.merge(this,e,{deep:r,mode:"replace"})}var A,D,_,P=$({});function x(e,t,r){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var n=e[0];if(1===e.length)return M.call(this,n,t,r);var i,o=e.slice(1),a=this[n];if(i=this.hasOwnProperty(n)&&"object"==typeof a&&null!==a?$.setIn(a,o,t):x.call(P,o,t),this.hasOwnProperty(n)&&a===i)return this;var l=O(this,s(this));return l[n]=i,G(l)}function M(e,t,r){var n=r&&r.deep;if(this.hasOwnProperty(e)&&(n&&this[e]!==t&&d(t)&&d(this[e])&&(t=$.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var i=O(this,s(this));return i[e]=$(t),G(i)}function k(e,t){var r=Array.prototype.slice.call(arguments,2),n=this[e];return $.set(this,e,t.apply(n,[n].concat(r)))}function j(e,t){for(var r=0,n=t.length;null!=e&&r<n;r++)e=e[t[r]];return r&&r==n?e:void 0}function F(e,t){var r=Array.prototype.slice.call(arguments,2),n=j(this,e);return $.setIn(this,e,t.apply(n,[n].concat(r)))}function U(e,t){var r=j(this,e);return void 0===r?t:r}function B(e){var t,r=s(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(r[t]=N(this[t]));else for(t in this)this.hasOwnProperty(t)&&(r[t]=this[t]);return r}function V(){return{}}function G(e){return o.use_static||(a(e,"merge",C),a(e,"replace",L),a(e,"without",b),a(e,"asMutable",B),a(e,"set",M),a(e,"setIn",x),a(e,"update",k),a(e,"updateIn",F),a(e,"getIn",U)),m(e)}function $(e,t,r){if(c(e)||function(e){return"object"==typeof e&&null!==e&&(e.$$typeof===i||e.$$typeof===n)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then($);if(Array.isArray(e))return I(e.slice());if(e instanceof Date)return s=new Date(e.getTime()),o.use_static||a(s,"asMutable",w),m(s);var s,l=t&&t.prototype,u=(l&&l!==Object.prototype?function(){return Object.create(l)}:V)();for(var d in e)Object.getOwnPropertyDescriptor(e,d)&&(u[d]=$(e[d],void 0,r));return G(u)}function H(e){return function(){var t=[].slice.call(arguments),r=t.shift();return e.apply(r,t)}}function W(e,t){return function(){var r=[].slice.call(arguments),n=r.shift();return Array.isArray(n)?t.apply(n,r):e.apply(n,r)}}return $.from=$,$.isImmutable=c,$.ImmutableError=f,$.merge=H(C),$.replace=H(L),$.without=H(b),$.asMutable=(A=B,D=R,_=w,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?D.apply(t,e):t instanceof Date?_.apply(t,e):A.apply(t,e)}),$.set=W(M,v),$.setIn=W(x,S),$.update=H(k),$.updateIn=H(F),$.getIn=H(U),$.flatMap=H(E),$.asObject=H(T),o.use_static||($.static=e({use_static:!0})),Object.freeze($),$}();void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}()},18249:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h14v12H1zm13 1H2v4h12zm0 5h-3v2h3zm0 3h-3v2h3zm-4 2v-2H6v2zm-5 0v-2H2v2zm-3-3h3V8H2zm8-2v2H6V8z" clip-rule="evenodd"></path></svg>'},19628:(e,t,r)=>{"use strict";const n=r(53908),i=r(78311);e.exports=(e,t,r)=>{let o=null,s=null,a=null;try{a=new i(t,r)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(o&&-1!==s.compare(e)||(o=e,s=new n(o,r)))}),o}},22799:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,a=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,h=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,f=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,y=r?Symbol.for("react.fundamental"):60117,S=r?Symbol.for("react.responder"):60118,I=r?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case u:case d:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case h:case g:case m:case l:return e;default:return t}}case i:return t}}}function E(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=h,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return E(e)||w(e)===u},t.isConcurrentMode=E,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return w(e)===h},t.isFragment=function(e){return w(e)===o},t.isLazy=function(e){return w(e)===g},t.isMemo=function(e){return w(e)===m},t.isPortal=function(e){return w(e)===i},t.isProfiler=function(e){return w(e)===a},t.isStrictMode=function(e){return w(e)===s},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===d||e===a||e===s||e===p||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===h||e.$$typeof===y||e.$$typeof===S||e.$$typeof===I||e.$$typeof===v)},t.typeOf=w},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},24308:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M10.95 1 6 3.95l4.95 2.95 4.95-2.95zm0 1.164L7.953 3.95l2.997 1.785 2.996-1.785z" clip-rule="evenodd"></path><path fill="#000" d="M0 4.5h5v-1H0zM0 12.5h5v-1H0z"></path><path fill="#000" fill-rule="evenodd" d="M6 11.95 10.95 9l4.95 2.95-4.95 2.95zm1.953 0 2.997-1.786 2.996 1.786-2.996 1.785z" clip-rule="evenodd"></path></svg>'},24493:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t)=>new n(e,t).patch},25200:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>n(e,t,r)<=0},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30144:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},30430:e=>{"use strict";e.exports=JSON.parse('{"Dateline Standard Time":-12,"UTC-11":-11,"Hawaiian Standard Time":-10,"Alaskan Standard Time":-9,"Pacific Standard Time":-8,"Pacific Standard Time (Mexico)":-8,"Mountain Standard Time":-7,"Mountain Standard Time (Mexico)":-7,"US Mountain Standard Time":-7,"Canada Central Standard Time":-6,"Central America Standard Time":-6,"Central Standard Time":-6,"Central Standard Time (Mexico)":-6,"Eastern Standard Time":-5,"SA Pacific Standard Time":-5,"US Eastern Standard Time":-5,"Venezuela Standard Time":-3.5,"Atlantic Standard Time":-4,"Central Brazilian Standard Time":-4,"Pacific SA Standard Time":-4,"SA Western Standard Time":-4,"Paraguay Standard Time":-4,"Newfoundland Standard Time":-2.5,"E. South America Standard Time":-3,"Greenland Standard Time":-3,"Montevideo Standard Time":-3,"SA Eastern Standard Time":-3,"Argentina Standard Time":-3,"Mid-Atlantic Standard Time":-2,"UTC-2":-2,"Azores Standard Time":-1,"Cabo Verde Standard Time":-1,"GMT Standard Time":0,"Greenwich Standard Time":0,"Morocco Standard Time":0,"UTC":0,"Central Europe Standard Time":1,"Central European Standard Time":1,"Romance Standard Time":1,"W. Central Africa Standard Time":1,"W. Europe Standard Time":1,"Namibia Standard Time":1,"E. Europe Standard Time":2,"Egypt Standard Time":2,"FLE Standard Time":2,"GTB Standard Time":2,"Israel Standard Time":2,"Jordan Standard Time":2,"Middle East Standard Time":2,"South Africa Standard Time":2,"Syria Standard Time":2,"Turkey Standard Time":2,"Arab Standard Time":3,"Arabic Standard Time":3,"E. Africa Standard Time":3,"Kaliningrad Standard Time":3,"Iran Standard Time":3.5,"Russian Standard Time":4,"Arabian Standard Time":4,"Azerbaijan Standard Time":4,"Caucasus Standard Time":4,"Georgian Standard Time":4,"Mauritius Standard Time":4,"Afghanistan Standard Time":4.5,"West Asia Standard Time":5,"Pakistan Standard Time":5,"India Standard Time":5.5,"Sri Lanka Standard Time":5.5,"Nepal Standard Time":5,"Ekaterinburg Standard Time":6,"Central Asia Standard Time":6,"Bangladesh Standard Time":6,"Myanmar Standard Time":6.5,"N. Central Asia Standard Time":7,"SE Asia Standard Time":7,"North Asia Standard Time":8,"China Standard Time":8,"Singapore Standard Time":8,"Taipei Standard Time":8,"W. Australia Standard Time":8,"Ulaanbaatar Standard Time":8,"North Asia East Standard Time":9,"Korea Standard Time":9,"Tokyo Standard Time":9,"AUS Central Standard Time":9.5,"Cen. Australia Standard Time":9.5,"Yakutsk Standard Time":10,"AUS Eastern Standard Time":10,"E. Australia Standard Time":10,"Tasmania Standard Time":10,"West Pacific Standard Time":10,"Vladivostok Standard Time":11,"Central Pacific Standard Time":11,"Magadan Standard Time":12,"Fiji Standard Time":12,"New Zealand Standard Time":12,"UTC+12":12,"Tonga Standard Time":13,"Samoa Standard Time":-11}')},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},31729:(e,t,r)=>{"use strict";const n=r(30144);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},32528:e=>{"use strict";e.exports=JSON.parse('{"exbVersion":"1.19.0","exbBuildNum":"1201","exbBuildCommit":"c3471543b9e1900f104077869f3cd1304b1bb56b","exbBuildBranch":"origin/release/dev1.19","exbExtensionsBuildCommit":"1ec6bb2fc5fdc18010f66fcbd75da41f7ed84054","exbExtensionsBuildBranch":"origin/release/dev1.19","exbBuildDate":"20251107.091849.CST","productVersion":"ArcGIS Experience Builder"}')},32938:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t)=>new n(e,t).major},35580:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>n(e,t,r)>0},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},36614:e=>{"use strict";e.exports=l},40909:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t,r)=>{const i=new n(e,r),o=new n(t,r);return i.compare(o)||i.compareBuild(o)}},41261:(e,t,r)=>{"use strict";const n=r(53908),i=r(78311),o=r(35580);e.exports=(e,t)=>{e=new i(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let s=null;i.forEach(e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!o(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),!s||r&&!o(r,s)||(r=s)}return r&&e.test(r)?r:null}},43927:(e,t,r)=>{"use strict";const n=r(40909);e.exports=(e,t)=>e.sort((e,r)=>n(e,r,t))},44363:(e,t,r)=>{"use strict";e.exports=r(22799)},46170:(e,t,r)=>{"use strict";const n=r(53908),i=r(30144),{safeRe:o,t:s}=r(99718);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?o[s.COERCERTLFULL]:o[s.COERCERTL];let i;for(;(i=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?o[s.COERCEFULL]:o[s.COERCE]);if(null===r)return null;const a=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${a}.${l}.${c}${u}${d}`,t)}},46254:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t)=>new n(e,t).minor},47626:e=>{"use strict";e.exports=i},48964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m9.5.332-.641.189-7.5 2.5L1 3.126V12H0v1h7v2H2v1h11v-1H8v-2h8v-1H9.5V6H14v6h1V5H9.5zM8.5 12V1.67L2 3.874V12z" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=f},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},50560:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},51832:(e,t,r)=>{"use strict";const n=r(30144);e.exports=(e,t)=>{const r=n(e,null,!0),i=n(t,null,!0),o=r.compare(i);if(0===o)return null;const s=o>0,a=s?r:i,l=s?i:r,c=!!a.prerelease.length;if(!!l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(a))return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return r.major!==i.major?u+"major":r.minor!==i.minor?u+"minor":r.patch!==i.patch?u+"patch":"prerelease"}},52443:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 2v12H2V2zm-1 1H3v10h10zm-5 7.5L6 9l-2 1.5L6 12zm2-3.833 2 1.5-2 1.5-2-1.5zM8 5.5 6 4 4 5.5 6 7z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},53908:(e,t,r)=>{"use strict";const n=r(57272),{MAX_LENGTH:i,MAX_SAFE_INTEGER:o}=r(16874),{safeRe:s,t:a}=r(99718),l=r(98587),{compareIdentifiers:c}=r(61123);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[a.LOOSE]:s[a.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(n("build compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return c(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},54089:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>n(e,t,r)>=0},54882:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m13 11-1-6H4l-1 6zM4.847 6l-.25 1.5h1.7l.15-1.5zm-.667 4 .25-1.5h1.768l-.15 1.5zm2.872 0 .15-1.5h1.595l.15 1.5zm2.9 0-.15-1.5h1.768l.25 1.5zm-.25-2.5h1.7l-.25-1.5h-1.6zm-2.4 0h1.396L8.548 6H7.451z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 14.29c4.8-1.6 8 0 8 0L13.867 1.487a9.76 9.76 0 0 0-5.867 0 9.74 9.74 0 0 1-5.867 0L0 14.29s3.2 1.6 8 0m4.208-1.712c-1.54.01-3.067.267-4.524.762-1.253.428-2.567.65-3.891.66a9.5 9.5 0 0 1-2.67-.363L2.941 2.722a12 12 0 0 0 2.353.241 8.3 8.3 0 0 0 3.078-.547 6.3 6.3 0 0 1 2.334-.402c.768.006 1.533.097 2.28.272l1.76 10.56c-.834-.18-1.685-.27-2.538-.268" clip-rule="evenodd"></path></svg>'},56037:(e,t,r)=>{"use strict";r(85160)},56953:(e,t,r)=>{"use strict";const n=r(30144);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},57272:e=>{"use strict";const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},57414:(e,t,r)=>{"use strict";const n=r(30144);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},61123:e=>{"use strict";const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),i=t.test(r);return n&&i&&(e=+e,r=+r),e===r?0:n&&!i?-1:i&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},62686:e=>{"use strict";e.exports=c},62773:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 1.5a1.5 1.5 0 0 1-2.147 1.354l-11 11a1.5 1.5 0 1 1-.707-.707l11-11A1.5 1.5 0 1 1 16 1.5" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},64203:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m-2 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M15 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" clip-rule="evenodd"></path></svg>'},64558:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.5 6 0l6 3.5L6 7zm1.985 0L6 1.158 10.015 3.5 6 5.842zM8 8.5 12 6l4 2.5-4 2.5zm1.887 0L12 7.18l2.113 1.32L12 9.82z" clip-rule="evenodd"></path><path fill="#000" d="M3 6.5 4 7v2h3v1H4v3.5h3v1H3zM8 13l2.4-1.5.943.59-1.456.91L12 14.32 14.113 13l-1.456-.91.943-.59L16 13l-4 2.5z"></path></svg>'},64931:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m9.513 3.47 4.324 8.03H2.224l3.158-6.948L7.43 7.113zM7.79 8.5h3.296L9.487 5.53zm3.834 1H4.231l-.454 1h8.386zm-4.364-1H4.686l.932-2.052z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M16 14.29s-3.2-1.6-8 0-8 0-8 0L2.133 1.487a9.74 9.74 0 0 0 5.867 0 9.76 9.76 0 0 1 5.867 0zm-8.316-.95a14.3 14.3 0 0 1 4.524-.762c.853-.002 1.704.088 2.538.267l-1.76-10.559a10.3 10.3 0 0 0-2.28-.272 6.3 6.3 0 0 0-2.334.402 8.3 8.3 0 0 1-3.078.547 12 12 0 0 1-2.353-.24L1.123 13.636c.868.247 1.767.37 2.67.363a12.3 12.3 0 0 0 3.891-.66" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=s},67414:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#151515" fill-rule="evenodd" d="M0 14.09 1.2 7h1.014l-1.09 6.437a9.5 9.5 0 0 0 2.669.363 11 11 0 0 0 3.888-.748 12.8 12.8 0 0 1 4.526-.852 8.3 8.3 0 0 1 2.489.376l-1.72-10.163a7.2 7.2 0 0 0-2.27-.399 5.9 5.9 0 0 0-2.367.434q-.165.06-.339.12V1.506a6.9 6.9 0 0 1 2.706-.493 8.2 8.2 0 0 1 3.161.674L16 14.29a6.62 6.62 0 0 0-3.793-1.089c-3.665 0-4.749 1.6-8.414 1.6A9.2 9.2 0 0 1 0 14.089zM4 11V7h4V4h4v7zm4-2.5a.954.954 0 0 1-.995 1.062h-.002L7 10h1zm3 1.5v-.487A2.96 2.96 0 0 1 9.5 10zM9 7h2V5H9zm0 1v1h.5a2.7 2.7 0 0 0 1.5-.721V8zm-4 2h1v-.5c0-.574.312-.889.93-.936l.068-.005L7 8.5c.002-.173.043-.344.119-.5H5zM2 6V1h5v5zm1.564-2.19c.075-.288.228-.55.442-.756a.9.9 0 0 1 .74-.179c.077-.32.226-.62.436-.875H3v2.34a.56.56 0 0 0 .336-.09 1 1 0 0 0 .228-.44M6 2.56a1.26 1.26 0 0 0-.297.609 1 1 0 0 1-.279.544.87.87 0 0 1-.756.161l-.05-.009q-.065.135-.11.276c-.09.328-.268.625-.516.859H6z" clip-rule="evenodd"></path></svg>'},68629:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6 3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0M0 14.09 1.2 7h1.014l-1.09 6.437a9.5 9.5 0 0 0 2.669.363 11 11 0 0 0 3.888-.748 12.8 12.8 0 0 1 4.526-.852 8.3 8.3 0 0 1 2.489.376l-1.72-10.163a7.2 7.2 0 0 0-2.27-.399 5.9 5.9 0 0 0-2.367.434q-.165.06-.339.12V1.506a6.9 6.9 0 0 1 2.706-.493 8.2 8.2 0 0 1 3.161.674L16 14.29a6.62 6.62 0 0 0-3.793-1.089c-1.833 0-3.02.4-4.207.8s-2.375.8-4.207.8A9.2 9.2 0 0 1 0 14.09M10 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 0 0-4 2 2 0 0 0 0 4m-3.223.916 1.5-1-.554-.832-1.5 1zm.444-5.798 1.092.898-.635.773-1.093-.899zM5 11.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m1 0a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" clip-rule="evenodd"></path></svg>'},68794:e=>{"use strict";e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},68972:e=>{"use strict";e.exports=o},70133:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6 2H3v3h3zM2 1v5h5V1zM0 14.09c1.2.503 2.493.746 3.793.711 1.832 0 3.02-.4 4.207-.8s2.374-.8 4.207-.8A6.62 6.62 0 0 1 16 14.291L13.867 1.686a8.2 8.2 0 0 0-3.161-.674A6.9 6.9 0 0 0 8 1.506v1.062q.174-.06.339-.12a5.9 5.9 0 0 1 2.367-.434c.773.01 1.54.146 2.27.4l1.72 10.162a8.3 8.3 0 0 0-2.489-.376 12.8 12.8 0 0 0-4.526.852c-1.24.484-2.557.737-3.888.748a9.5 9.5 0 0 1-2.669-.363L2.214 7H1.2zM11 5H9v2h2zM8 4v3H5v4h7V4zm-2 6V8h2v2zm3-2h2v2H9z" clip-rule="evenodd"></path></svg>'},70880:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h5v12H2zM1 14V1h7v13h2.5V4H9V3h2.5v11H14V7h-1.5V6H15v8h1v1H0v-1zM3 3h1v1H3zm1 3H3v1h1zM3 9h1v1H3zm3-6H5v1h1zM5 6h1v1H5zm1 3H5v1h1z" clip-rule="evenodd"></path></svg>'},71539:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4 2H2v2h2zM2 1H1v4h4V1H2m-.619 5L0 14.29s3.2 1.6 8 0 8 0 8 0L13.867 1.487a9.76 9.76 0 0 0-5.867 0 9.7 9.7 0 0 1-2 .408v1.048a8.3 8.3 0 0 0 2.372-.527 6.3 6.3 0 0 1 2.334-.402c.768.006 1.533.097 2.28.272l1.76 10.56c-.834-.18-1.685-.27-2.538-.268-1.54.01-3.067.267-4.524.762-1.253.428-2.567.65-3.891.66a9.5 9.5 0 0 1-2.67-.363L2.395 6zM10 5H8v2h2zM7 4v3H4v4h7V4zm-2 6V8h2v2zm3-2h2v2H8z" clip-rule="evenodd"></path></svg>'},72111:(e,t,r)=>{"use strict";const n=r(94641),i=r(13999),o=r(35580),s=r(54089),a=r(7059),l=r(25200);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return i(e,r,c);case">":return o(e,r,c);case">=":return s(e,r,c);case"<":return a(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},72525:(e,t,r)=>{"use strict";const n=r(97638),i=r(50560);e.exports=(e,t,r)=>{const o=[];let s=null,a=null;const l=e.sort((e,t)=>i(e,t,r));for(const e of l){n(e,t,r)?(a=e,s||(s=e)):(a&&o.push([s,a]),a=null,s=null)}s&&o.push([s,null]);const c=[];for(const[e,t]of o)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},74277:(e,t,r)=>{"use strict";const n=r(40909);e.exports=(e,t)=>e.sort((e,r)=>n(r,e,t))},75032:(e,t,r)=>{"use strict";const n=r(78311),i=r(93904),{ANY:o}=i,s=r(97638),a=r(50560),l=[new i(">=0.0.0-0")],c=[new i(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===o){if(r.includePrerelease)return!0;t=c}const n=new Set;let i,u,p,f,m,g,v;for(const t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?u=h(u,t,r):n.add(t.semver);if(n.size>1)return null;if(i&&u){if(p=a(i.semver,u.semver,r),p>0)return null;if(0===p&&(">="!==i.operator||"<="!==u.operator))return null}for(const e of n){if(i&&!s(e,String(i),r))return null;if(u&&!s(e,String(u),r))return null;for(const n of t)if(!s(e,String(n),r))return!1;return!0}let y=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,S=!(!i||r.includePrerelease||!i.semver.prerelease.length)&&i.semver;y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,i)if(S&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===S.major&&e.semver.minor===S.minor&&e.semver.patch===S.patch&&(S=!1),">"===e.operator||">="===e.operator){if(f=d(i,e,r),f===e&&f!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1;if(u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(m=h(u,e,r),m===e&&m!==u)return!1}else if("<="===u.operator&&!s(u.semver,String(e),r))return!1;if(!e.operator&&(u||i)&&0!==p)return!1}return!(i&&g&&!u&&0!==p)&&(!(u&&v&&!i&&0!==p)&&(!S&&!y))},d=(e,t,r)=>{if(!e)return t;const n=a(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;const n=a(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let i=!1;e:for(const n of e.set){for(const e of t.set){const t=u(n,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},75571:(e,t,r)=>{"use strict";const n=r(97075);e.exports=(e,t,r)=>n(e,t,">",r)},76780:(e,t,r)=>{"use strict";const n=r(78311);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},77631:(e,t,r)=>{"use strict";const n=r(78311);e.exports=(e,t)=>new n(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},78030:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#151515" fill-rule="evenodd" d="M3.793 14.8A9.2 9.2 0 0 1 0 14.089l1.01-5.97v1.866a.99.99 0 0 0 .55.88l-.435 2.572a9.5 9.5 0 0 0 2.668.363 11 11 0 0 0 3.888-.748 12.8 12.8 0 0 1 4.526-.852 8.3 8.3 0 0 1 2.489.376l-.284-1.674c.393-.14.664-.501.688-.917v-.63a1.09 1.09 0 0 0-1.1-1h-.018l-.197-1.162V6a1 1 0 0 0-.326-.73l-.483-2.857a7.2 7.2 0 0 0-2.27-.4 5.9 5.9 0 0 0-2.367.435A7.8 7.8 0 0 1 5.294 3a11.4 11.4 0 0 1-2.359-.26L2.553 5H2.01a.97.97 0 0 0-.497.152l.62-3.664A10.4 10.4 0 0 0 5.294 2c2.688 0 2.721-.986 5.412-.986a8.2 8.2 0 0 1 3.161.674L16 14.29a6.62 6.62 0 0 0-3.793-1.09c-3.665 0-4.749 1.6-8.414 1.6M2.01 9.985h.785v-1.85h.011l1.407 1.85H5v-.3L3.563 7.877 5 6.2v-.18q.002-.01.004-.021h-.796L2.795 7.713V6H2.01zm11.99 0v-.628h-1.215V6H12v3.985zM6 6.02V10h.865V6.73l.013-.012L8.09 10h.865l1.188-3.282h.013V10H11V6.02H9.601l-1.07 3.02h-.014L7.446 6.02z" clip-rule="evenodd"></path></svg>'},78311:(e,t,r)=>{"use strict";const n=/\s+/g;class i{constructor(e,t){if(t=s(t),e instanceof i)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new i(e.raw,t);if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!v(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,r=o.get(t);if(r)return r;const n=this.options.loose,i=n?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(i,A(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],h),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],p),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],f),l("caret trim",e);let s=e.split(" ").map(e=>I(e,this.options)).join(" ").split(/\s+/).map(e=>L(e,this.options));n&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE])))),l("range list",s);const c=new Map,y=s.map(e=>new a(e,this.options));for(const e of y){if(v(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const S=[...c.values()];return o.set(t,S),S}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Range is required");return this.set.some(r=>S(r,t)&&e.set.some(e=>S(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(D(this.set[t],e,this.options))return!0;return!1}}e.exports=i;const o=new(r(68794)),s=r(98587),a=r(93904),l=r(57272),c=r(53908),{safeRe:u,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=r(99718),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=r(16874),v=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,S=(e,t)=>{let r=!0;const n=e.slice();let i=n.pop();for(;r&&n.length;)r=n.every(e=>i.intersects(e,t)),i=n.pop();return r},I=(e,t)=>(l("comp",e,t),e=R(e,t),l("caret",e),e=E(e,t),l("tildes",e),e=N(e,t),l("xrange",e),e=C(e,t),l("stars",e),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>b(e,t)).join(" "),b=(e,t)=>{const r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,(t,r,n,i,o)=>{let s;return l("tilde",e,t,r,n,i,o),w(r)?s="":w(n)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(i)?s=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(l("replaceTilde pr",o),s=`>=${r}.${n}.${i}-${o} <${r}.${+n+1}.0-0`):s=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,l("tilde return",s),s})},R=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{l("caret",e,t);const r=t.loose?u[d.CARETLOOSE]:u[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(t,r,i,o,s)=>{let a;return l("caret",e,t,r,i,o,s),w(r)?a="":w(i)?a=`>=${r}.0.0${n} <${+r+1}.0.0-0`:w(o)?a="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),a="0"===r?"0"===i?`>=${r}.${i}.${o}-${s} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}-${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o}-${s} <${+r+1}.0.0-0`):(l("no pr"),a="0"===r?"0"===i?`>=${r}.${i}.${o}${n} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o} <${+r+1}.0.0-0`),l("caret return",a),a})},N=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>O(e,t)).join(" ")),O=(e,t)=>{e=e.trim();const r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,(r,n,i,o,s,a)=>{l("xRange",e,r,n,i,o,s,a);const c=w(i),u=c||w(o),d=u||w(s),h=d;return"="===n&&h&&(n=""),a=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&h?(u&&(o=0),s=0,">"===n?(n=">=",u?(i=+i+1,o=0,s=0):(o=+o+1,s=0)):"<="===n&&(n="<",u?i=+i+1:o=+o+1),"<"===n&&(a="-0"),r=`${n+i}.${o}.${s}${a}`):u?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${o}.0${a} <${i}.${+o+1}.0-0`),l("xRange return",r),r})},C=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),L=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),A=e=>(t,r,n,i,o,s,a,l,c,u,d,h)=>`${r=w(n)?"":w(i)?`>=${n}.0.0${e?"-0":""}`:w(o)?`>=${n}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=w(c)?"":w(u)?`<${+c+1}.0.0-0`:w(d)?`<${c}.${+u+1}.0-0`:h?`<=${c}.${u}.${d}-${h}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),D=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==a.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=h},80914:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m8 0 8 6-8 6-8-6zM1.887 6 8 10.82 14.113 6 8 1.18zM0 9.81.563 9 8 14.775 15.437 9l.563.81L8 16z" clip-rule="evenodd"></path></svg>'},81219:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#151515" fill-rule="evenodd" d="M15 3.6 11.4 0H2v16h13zM14 15H3V1h7v4h4zM11 4h3v-.31L11.31 1H11zM7 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0M5 7.5h7v-1H5z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M9 10H6v2h3zM5 9v4h5V9z" clip-rule="evenodd"></path></svg>'},85160:(e,t,r)=>{"use strict";var n=r(68972);var i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=n.useSyncExternalStore,s=n.useRef,a=n.useEffect,l=n.useMemo,c=n.useDebugValue},87442:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 3H3v10h5zM3 2H2v12h7V2H3m1.833 2.834h2.75v.916h-2.75zm2.75 1.833h-2.75v.916h2.75zm2.75 2.75h1.833v.916h-1.833zm1.833 1.833h-1.833v.917h1.833zM4.833 8.5h2.75v.917h-2.75zM14 7.583H9.416V8.5h3.667v4.583H9.416V14H14V7.583" clip-rule="evenodd"></path></svg>'},90819:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.915 1A1.5 1.5 0 1 0 1 2.915v10.17A1.5 1.5 0 1 0 2.915 15h10.17a1.5 1.5 0 1 0 1.276-1.994l-2.272-3.975c.255-.269.411-.632.411-1.031 0-.4-.156-.762-.41-1.031l2.27-3.975q.07.006.14.006a1.5 1.5 0 1 0-1.415-2zm0 13h10.17q.076-.211.207-.389l-2.204-4.114L11 9.5a1.5 1.5 0 1 1 .088-2.997l2.204-4.114A1.5 1.5 0 0 1 13.085 2H2.915c-.151.426-.489.764-.915.915v10.17c.426.151.764.489.915.915" clip-rule="evenodd"></path></svg>'},92618:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#040303" fill-rule="evenodd" d="M7 13v2H2v1h11v-1H8v-2h8L14 1H2L0 13zM2.847 2 1.18 12h3.697a1.58 1.58 0 0 1 .107-1.323A1.37 1.37 0 0 1 4 9.387c0-.165.03-.303.07-.424.032-.094.07-.178.105-.257a1.1 1.1 0 0 0 .115-.34c.029-.282-.084-.321-.084-.575a1.62 1.62 0 0 1 1.591-1.643 1.44 1.44 0 0 1 1.086.47A1.45 1.45 0 0 1 8.266 5.53a1.5 1.5 0 0 1 .453.073q.114.037.221.093a2 2 0 0 1 .555-.606l.094-.064a3 3 0 0 0-.066-.414 1.32 1.32 0 0 1 .32-1.09l.068-.078a1.7 1.7 0 0 1 .468-.353 1.4 1.4 0 0 1 .074-.442c.086-.246.231-.466.422-.643L10.872 2zm3.46 10h3.479l.062-.035c.223-.125.447-.251.447-.541 0-.174-.184-.24-.184-.41 0-.213.127-.341.253-.468.064-.064.127-.127.174-.201a.5.5 0 0 0 .079-.265v-.502a.2.2 0 0 1 .035-.115c.075-.116.26-.178.41-.178a.7.7 0 0 1 .3.088c.095.044.19.089.299.089.242 0 .372-.17.502-.339s.26-.338.501-.338c.11 0 .185.052.245.13.056.073.099.172.142.273.06.141.123.287.23.38a1.48 1.48 0 0 0 .906.432h.3l-1.334-8h-1.175a.5.5 0 0 1 .018.133.43.43 0 0 1-.057.219 1 1 0 0 1-.065.091 1 1 0 0 1-.082.086l-.104.092c-.07.06-.14.12-.195.188a.5.5 0 0 0-.092.16l-.008.028-.008.038a.4.4 0 0 0-.006.076q0 .045.008.097l.017.093.005.026c.016.086.033.176.035.26a.5.5 0 0 1-.011.129c-.035.141-.154.24-.466.218a.3.3 0 0 0-.16.052c-.16.099-.328.31-.304.435l.011.054c.082.397.22 1.069-.371 1.386-.22.12-.34.333-.454.535-.145.257-.28.495-.599.495-.174 0-.293-.09-.413-.18-.119-.09-.238-.18-.411-.18a.45.45 0 0 0-.184.052.47.47 0 0 0-.253.436c0 .367-.308.977-.798.977a.64.64 0 0 1-.617-.308l-.007-.011a1.7 1.7 0 0 0-.252-.375.48.48 0 0 0-.359-.154.617.617 0 0 0-.59.643q.002.11.022.202l.029.12c.026.098.051.196.051.32 0 .194-.077.336-.154.477-.077.142-.154.283-.154.476a.405.405 0 0 0 .437.36q.13-.002.223-.028.085-.024.158-.055a.8.8 0 0 1 .416-.071c.108.01.185.077.237.162a.7.7 0 0 1 .094.289l.003.063c0 .274-.196.47-.392.665-.141.141-.282.283-.35.454-.06.153-.062.33.049.553.06.118.234.173.432.222m8.513 0h-3.645a1.5 1.5 0 0 0 .12-.576q0-.183-.053-.358c.152-.176.263-.383.326-.607l.093.003c.3.002.593-.09.836-.266q.06.066.126.124c.42.411.977.654 1.564.68h.43v-.215z" clip-rule="evenodd"></path></svg>'},93007:(e,t,r)=>{"use strict";const n=r(53908);e.exports=(e,t,r,i,o)=>{"string"==typeof r&&(o=i,i=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,i,o).version}catch(e){return null}}},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},93509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2H3v12h5zM2 1v13H0v1h16v-1h-3V8.69l-4-2V1zm7 6.809V14h3V9.309zM5 3H4v1h1zM4 6h1v1H4zm1 3H4v1h1zm1-6h1v1H6zm1 3H6v1h1zM6 9h1v1H6z" clip-rule="evenodd"></path></svg>'},93904:(e,t,r)=>{"use strict";const n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(e,t){if(t=o(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?s[a.COMPARATORLOOSE]:s[a.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):(!(t=o(t)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}e.exports=i;const o=r(98587),{safeRe:s,t:a}=r(99718),l=r(72111),c=r(57272),u=r(53908),d=r(78311)},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},94641:(e,t,r)=>{"use strict";const n=r(50560);e.exports=(e,t,r)=>0===n(e,t,r)},97075:(e,t,r)=>{"use strict";const n=r(53908),i=r(93904),{ANY:o}=i,s=r(78311),a=r(97638),l=r(35580),c=r(7059),u=r(25200),d=r(54089);e.exports=(e,t,r,h)=>{let p,f,m,g,v;switch(e=new n(e,h),t=new s(t,h),r){case">":p=l,f=u,m=c,g=">",v=">=";break;case"<":p=c,f=d,m=l,g="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,h))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let s=null,a=null;if(n.forEach(e=>{e.semver===o&&(e=new i(">=0.0.0")),s=s||e,a=a||e,p(e.semver,s.semver,h)?s=e:m(e.semver,a.semver,h)&&(a=e)}),s.operator===g||s.operator===v)return!1;if((!a.operator||a.operator===g)&&f(e,a.semver))return!1;if(a.operator===v&&m(e,a.semver))return!1}return!0}},97638:(e,t,r)=>{"use strict";const n=r(78311);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},98427:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C1 1.567 4.134 0 8 0s7 1.567 7 3.5M2 5.304V6.5C2 7.692 4.615 9 8 9s6-1.308 6-2.5V5.304C12.775 6.32 10.546 7 8 7s-4.775-.68-6-1.696M8 10c2.546 0 4.775-.68 6-1.696V9.5c0 1.192-2.615 2.5-6 2.5s-6-1.308-6-2.5V8.304C3.225 9.32 5.454 10 8 10m6 1.304C12.775 12.32 10.546 13 8 13s-4.775-.68-6-1.696V12.5C2 13.692 4.615 15 8 15s6-1.308 6-2.5zM14 3.5C14 4.692 11.385 6 8 6S2 4.692 2 3.5 4.615 1 8 1s6 1.308 6 2.5" clip-rule="evenodd"></path></svg>'},98587:e=>{"use strict";const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},98640:e=>{"use strict";e.exports=p},99037:e=>{"use strict";e.exports=u},99589:(e,t,r)=>{"use strict";const n=r(99718),i=r(16874),o=r(53908),s=r(61123),a=r(30144),l=r(56953),c=r(57414),u=r(93007),d=r(51832),h=r(32938),p=r(46254),f=r(24493),m=r(31729),g=r(50560),v=r(9970),y=r(11763),S=r(40909),I=r(43927),w=r(74277),E=r(35580),b=r(7059),R=r(94641),T=r(13999),N=r(54089),O=r(25200),C=r(72111),L=r(46170),A=r(93904),D=r(78311),_=r(97638),P=r(77631),x=r(19628),M=r(270),k=r(41261),j=r(13874),F=r(97075),U=r(75571),B=r(5342),V=r(76780),G=r(72525),$=r(75032);e.exports={parse:a,valid:l,clean:c,inc:u,diff:d,major:h,minor:p,patch:f,prerelease:m,compare:g,rcompare:v,compareLoose:y,compareBuild:S,sort:I,rsort:w,gt:E,lt:b,eq:R,neq:T,gte:N,lte:O,cmp:C,coerce:L,Comparator:A,Range:D,satisfies:_,toComparators:P,maxSatisfying:x,minSatisfying:M,minVersion:k,validRange:j,outside:F,gtr:U,ltr:B,intersects:V,simplifyRange:G,subset:$,SemVer:o,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},99718:(e,t,r)=>{"use strict";const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:o}=r(16874),s=r(57272),a=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],d=t.t={};let h=0;const p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",o],[p,i]],m=(e,t,r)=>{const n=(e=>{for(const[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),i=h++;s(e,i,t),d[e]=i,c[i]=t,u[i]=n,a[i]=new RegExp(t,r?"g":void 0),l[i]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[d.PRERELEASEIDENTIFIER]}(?:\\.${c[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${c[d.BUILDIDENTIFIER]}(?:\\.${c[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[d.MAINVERSION]}${c[d.PRERELEASE]}?${c[d.BUILD]}?`),m("FULL",`^${c[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[d.MAINVERSIONLOOSE]}${c[d.PRERELEASELOOSE]}?${c[d.BUILD]}?`),m("LOOSE",`^${c[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:${c[d.PRERELEASE]})?${c[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:${c[d.PRERELEASELOOSE]})?${c[d.BUILD]}?)?)?`),m("XRANGE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[d.COERCEPLAIN]+`(?:${c[d.PRERELEASE]})?`+`(?:${c[d.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[d.COERCE],!0),m("COERCERTLFULL",c[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[d.LONECARET]}${c[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[d.LONECARET]}${c[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[d.GTLT]}\\s*(${c[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]}|${c[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[d.XRANGEPLAIN]})\\s+-\\s+(${c[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}},t={};function m(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,m),i.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var r in t)m.o(t,r)&&!m.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var g={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(g),m.d(g,{AttributeTable:()=>tv,ConvertUnits:()=>of,Coordinate:()=>Qp,CopyAttributeTool:()=>Mv,CreateLayers:()=>cI,EmptyPlaceholder:()=>by,GetEsriUnits:()=>lf,GetReferentProperties:()=>qS,GetSRUnits:()=>sf,GetUniqueLrsUrls:()=>iI,GetUnits:()=>af,Identifiers:()=>Kp,ImportMode:()=>vy,InlineEditableDropdown:()=>vv,Intellisense:()=>Nv,IntellisenseTextInput:()=>Cv,IsClosed:()=>vf,IsRouteReversed:()=>yf,LineConcurrencyTable:()=>gv,LineIdentifiers:()=>Yp,LoadLayers:()=>oI,LockAcquireStatus:()=>pm,LockAction:()=>ym,LockManagerComponent:()=>Av,LockReleaseStatus:()=>fm,LocksEndpointType:()=>gm,LrsApplyEdits:()=>lm,LrsLayerType:()=>qp,LrsLoader:()=>Fv,LrsStoreExtension:()=>f,LrsViewSelector:()=>My,LrsViewSelectorComponent:()=>xy,MapMode:()=>py,MapViewLoader:()=>Pv,ModeType:()=>zp,PointConcurrencyTable:()=>hv,QueryLock:()=>Im,QueryMapPointWithMeasureOnRoute:()=>am,QueryMeasureOnRoute:()=>sm,QueryPolylineOnRoute:()=>um,QueryRouteConcurrencies:()=>nm,QueryRouteMeasures:()=>im,QueryRouteMeasuresAndDistances:()=>om,ReleasableStatus:()=>mm,RoutePicker:()=>kg,RoutePickerPopup:()=>Fg,SearchMeasuresType:()=>Zp,SearchMethod:()=>Jp,SpatialReferenceFrom:()=>Xp,UpdateDataSource:()=>aS,VMSEndpoints:()=>vm,VmsManager:()=>zm,acquireLock:()=>wm,advancedActionMap:()=>PS,allLineEvents:()=>Ng,allPointEvents:()=>Og,atOrAfter:()=>_f,atOrBefore:()=>Pf,atOrBetween:()=>Df,checkConflictPrevention:()=>hI,colorBlack:()=>Eg,colorCyan:()=>bg,colorRed:()=>Rg,convertStationToNumber:()=>bf,coordinateGraphicColor:()=>Tg,createFeatureLayer:()=>Fy,createField:()=>Wy,createLabelLayer:()=>NS,derivedFields:()=>mg,distanceField:()=>gg,errorMessageDelay:()=>Ig,fetchEnterpriseContingentValues:()=>Ky,fetchEnterpriseFieldGroup:()=>Jy,fieldsWithContingentValues:()=>iS,findEventInfoFromMapViewsConfig:()=>bS,findEventInfoFromMapViewsConfigAndEventDS:()=>ES,findFieldByName:()=>Vy,findFieldByType:()=>By,findFirstArcgisMapWidgetId:()=>MS,findNetworkInfoFromMapViewsConfig:()=>wS,flash:()=>xf,formatMessage:()=>nf,getAddressingInfoFromResults:()=>WS,getAllDataSourcesFromLayerViews:()=>IS,getAllDataSourcesLayer:()=>uS,getAllDataSourcesMap:()=>dS,getAllDatasourceFromMapWidgetId:()=>lS,getAllUseDs:()=>cS,getAttributeSets:()=>eI,getBaseURL:()=>_m,getCalciteBasicTheme:()=>Jf,getCalciteButtonWithIconTheme:()=>Kf,getCalciteNoticeTheme:()=>Yf,getCalibrationPointInfoFromResults:()=>GS,getCenterlineInfoFromResults:()=>$S,getConfigValue:()=>uI,getConflictPreventionEnabled:()=>QS,getContingentOptions:()=>nS,getDataSourceById:()=>sS,getDateToUTC:()=>Ef,getDateWithRouteTime:()=>Vf,getDateWithTZOffset:()=>Uf,getDateWithoutTZOffset:()=>jf,getDateWithoutTime:()=>Bf,getDefaultAttributeSet:()=>ZS,getDefaultEvent:()=>YS,getDefaultNetwork:()=>XS,getEventInfoFromResults:()=>BS,getExistingFieldNames:()=>Hy,getFeatureLayer:()=>cm,getGDBVersion:()=>Cf,getGeometryGraphic:()=>Lg,getHoverGraphic:()=>Ag,getInitialEventInfoState:()=>Tf,getInitialRouteInfoState:()=>Rf,getInitialRouteMeasurePickerInfoState:()=>Nf,getIntersectionInfoFromResults:()=>VS,getIntialLocksInfo:()=>Om,getLayer:()=>Uy,getLayersByType:()=>xS,getLocalTimeOffset:()=>Mf,getLocksEndpoint:()=>Am,getLrsFeatureUrlByType:()=>nI,getLrsRequestUrl:()=>jS,getModeType:()=>kS,getNetworkFields:()=>$y,getNetworkInfoFromResults:()=>US,getNetworkOutFields:()=>hf,getNonLrsInfoFromResults:()=>zS,getPolylineMidPoint:()=>OS,getPolylineStartEndMValues:()=>df,getRouteFromEndMeasures:()=>uf,getRouteMeasures:()=>DS,getRoutesByRouteIds:()=>pf,getSimpleLineGraphic:()=>xg,getSimplePointGraphic:()=>Pg,getSuggestions:()=>wf,getTimeExtentByTzOffset:()=>Ff,getUUID:()=>qg,getUnsupportedLayerIds:()=>rI,getUserSession:()=>Of,getUtilityNetworkInfoFromResults:()=>HS,getVMSEndpoint:()=>Dm,getVersionGuid:()=>Nm,highlightColor:()=>wg,isCodedDomain:()=>Hg,isConflictPreventionEnabled:()=>Pm,isConflictPreventionEnabledSelector:()=>w,isDate:()=>Gg,isDefaultVersion:()=>Lf,isDefined:()=>cf,isInWidgetController:()=>Gf,isLineEvent:()=>qf,isNumber:()=>$g,isParentNetworkAvailable:()=>JS,isPointEvent:()=>zf,isRangeDomain:()=>Wg,isSupportedJimuLayerView:()=>Hf,isValidRoute:()=>Sf,isWithinTolerance:()=>Af,lrsDefaultMessages:()=>c,measureFields:()=>fg,networkObjectIdField:()=>yg,normalizeFieldName:()=>tS,queryAllRoutesByLineId:()=>mf,queryAllRoutesByLineIdAndFromDate:()=>gf,queryEventsByEventObjectIds:()=>em,queryEventsByRouteIdOrEventObjectId:()=>Zf,queryLineId:()=>rm,queryRouteId:()=>dm,queryRouteIdOrName:()=>If,queryRouteIds:()=>hm,queryRoutes:()=>tm,queryRoutesByLineId:()=>ff,releaseLock:()=>Rm,removeLabelLayer:()=>TS,requestService:()=>Qf,resolveFieldName:()=>Gy,setConflictPreventionEnabled:()=>I,setContingentValues:()=>eS,setDate:()=>S,setLrsLayers:()=>y,setMapViewId:()=>v,setRouteInfoByRouteIdOrName:()=>AS,shouldQueryRouteLock:()=>Cm,shouldTryAcquireLock:()=>Lm,stationField:()=>vg,toRouteField:()=>Sg,tryAutoReconcile:()=>Tm,tryReleaseLock:()=>bm,tryReleaseLockOnDefault:()=>Em,updateConfig:()=>dI,updateDefaultForMapMode:()=>KS,useEditSession:()=>og,useLrsDate:()=>rg,useVmsManager:()=>Qm,validateContingencyConstraints:()=>Yy,validateField:()=>Bg,validateLayers:()=>tI,validateRangeDomain:()=>Vg,waitTime:()=>Wf});var e={};m.r(e),m.d(e,{AttributeTable:()=>a,LineConcurrencyTable:()=>s,PointConcurrencyTable:()=>o});var t={};m.r(t),m.d(t,{LrsViewSelector:()=>l});var r={};m.r(r),m.d(r,{exclude:()=>Y,extract:()=>H,parse:()=>W,parseUrl:()=>q,pick:()=>K,stringify:()=>z,stringifyUrl:()=>J});var n=m(1888),i=m(79244);const o=()=>i.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-point-concurrency-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `,s=()=>i.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-line-concurrency-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `,a=()=>i.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-attribute-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `,l=e=>{const t=e.isInDropdown?"366px":"calc(100% - 34px)";return i.css`
    .button-container {
      display: flex;
      justify-content: space-between;
      .search-input {
        width: calc(100% - 32px);
      }
      .layer-label {
        font-size: 14px;
        color: ${e.theme.sys.color.surface.paperHint};
        font-weight: 600;
        margin-left: 2px;
      }
      .right-buttons {
        display: flex;
        gap: var(--sys-spacing-1);
      }
    }
    .tree-container {
      margin-top: 16px;
      height: ${t};
    }
  `},c={measureAndRouteName:"({measure}) {routeName}",fromToMeasuresAndRouteName:"({fromMeasure} to {toMeasure}) {routeName}",selectedRouteName:"Selected Route Name",selectedRouteMeasure:"Selected Route Measure ({units})",selectedRouteFromMeasure:"Selected Route From Measure ({units})",selectedRouteToMeasure:"Selected Route To Measure ({units})",eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",concurrencySettings:"Concurrency Settings",hideAddToDominantRouteOption:"Hide Add to Dominant Route Option",enableAddToDominantRouteOption:"Enable Add to Dominant Route Option",notAllowOverrideEventReplacement:"Don't allow override of event placement on dominant routes",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",intMiles:"Statute miles",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks.",selectLayers:"Select Layers",layerConfig:"Layer Configuration",selectMapToEditSettings:"Select map to edit default settings",lrsChangeModeConfirmTitle:"Are you sure you want to switch the mode?",lrsChangeModeConfirmTips:"You will lose the settings configured.",noMapSelected:"Select a map for further configurations.",importLayersTips:"Select a map to import LRS networks and events",noLayersInMap:"No layers are present in the selected map.",noLrsLayersInMap:"No LRS layers are present in the selected map. Select a map with LRS layers present in the map.",noNetworkLayersInMap:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noLineEventLayersInMap:"No LRS Line Event layers are present in the selected map. Select a map with at least one LRS line event layer present in the web map.",noPointEventLayersInMap:"No LRS Point Event layers are present in the selected map. Select a map with at least one LRS point event layer present in the web map.",noIntersectionLayersInMap:"No LRS Intersection layers are present in the selected map. Select a map with at least one LRS intersection layer present in the web map.",multipleLrsInWebMap:"Multiple LRS's are present in the selected map. Select a web map with only one LRS in the map.",noNetworkConfig:"No LRS Network layers are configured with the widget. Configure the widget with at least one LRS Network layer.",noLineEventConfig:"No LRS Line Event layers are configured with the widget. Configure the widget with at least one LRS Line Event layer.",noPointEventConfig:"No LRS Point Event layers are configured with the widget. Configure the widget with at least one LRS Point Event layer.",noIntersectionConfig:"No LRS Intersection layers are configured with the widget. Configure the widget with at least one LRS Intersection layer.",lrsMinimumSchema:"LRS Minimum Schema",lrsNetwork:"LRS Network",lrsEvent:"LRS Event",lrsIntersection:"LRS Intersection",nonLrsLayer:"Non-LRS Layers",vmsError:"Version Management Service is not available.",vmsChangeVersionError:"Failed to change version to {versionName}.",vmsCreateVersionError:"Failed to create version {versionName}.",vmsDeleteVersionError:"Failed to delete version {versionName}.",vmsFailedToStartEditSession:"Failed to start edit session.",vmsFailedToStopEditSession:"Failed to stop edit session.",vmsReconcileError:"Failed to reconcile changes.",vmsPostError:"Failed to post changes.",vmsVersionNotFound:"Version {versionName} not found.",vmsVersionGuidMissing:"Version GUID is missing.",vmsFailedToStartReading:"Failed to start reading version {versionName}."};var u;!function(e){e.SetMapView="SET_MAP_VIEW",e.SetLrsLayers="SET_LRS_LAYERS",e.SetDate="SET_DATE",e.SetEditSession="SET_EDIT_SESSION",e.SetConflictPreventionEnabled="SET_CONFLICT_PREVENTION_ENABLED"}(u||(u={}));const d=(e,t,r)=>{switch(t.type){case u.SetMapView:return((e,t)=>{const r=t.payload;return e.set("mapViewId",r)})(e,t);case u.SetLrsLayers:return((e,t)=>{const{mapViewId:r,lrsLayers:n}=t.payload;return e.setIn(["lrsLayers",r],n)})(e,t);case u.SetDate:return((e,t)=>{const r=t.payload;return e.set("date",r)})(e,t);case u.SetEditSession:return((e,t)=>{const r=t.payload;return e.set("editSession",r)})(e,t);case u.SetConflictPreventionEnabled:return((e,t)=>{const{lrsUrl:r,isEnabled:n}=t.payload;return e.setIn(["isConflictPreventionEnabled",r],n)})(e,t)}},h="lrsState",p=(0,i.Immutable)({mapViewId:"",lrsLayers:new Map,date:null,editSession:!1,isConflictPreventionEnabled:new Map},{});class f{constructor(){this.id="lrs-store-extension"}getActions(){return Object.keys(u).map(e=>u[e])}getStoreKey(){return h}getInitLocalState(){return p}getReducer(){return d}}function v(e,t){t({type:u.SetMapView,payload:e})}function y(e,t,r){const n={mapViewId:e,lrsLayers:t};r({type:u.SetLrsLayers,payload:n})}function S(e,t){t({type:u.SetDate,payload:e})}function I(e,t,r){const n={lrsUrl:e,isEnabled:t};r({type:u.SetConflictPreventionEnabled,payload:n})}function w(e,t){var r,n;return null!==(n=null===(r=null==t?void 0:t[h])||void 0===r?void 0:r.isConflictPreventionEnabled.getIn([e]))&&void 0!==n?n:null}const E=class{constructor(e){this.stackItems=[],this.forwardStackItems=[],this.stackItems.push(e)}push(e){return this.forwardStackItems.length,this.stackItems.push(e)}pop(){if(!(this.forwardStackItems.length>0))return this.stackItems.pop()}undo(){if(!this.canUndo())return;const e=this.stackItems.pop();return this.forwardStackItems.push(e),e}peek(){return this.stackItems.at(-1)}canUndo(){return this.stackItems.length>1}canRedo(){return this.hasForwardEdits()}redo(){if(!this.canRedo())return;const e=this.forwardStackItems.pop();return this.stackItems.push(e),e}size(){return this.stackItems.length+this.forwardStackItems.length}hasForwardEdits(){return this.forwardStackItems.length>0}clearForwardEdits(){this.forwardStackItems=[]}};var b,R,T,N=m(47626);!function(e){e.DataSelection="dataSelection"}(b||(b={})),function(e){e.Widgets="widgets",e.Data_s="data_s"}(R||(R={})),function(e){e.Id="id",e.Where="where",e.Geometry="geometry",e.SpatialRel="spatialRel"}(T||(T={}));const O="%[a-f0-9]{2}",C=new RegExp("("+O+")|([^%]+?)","gi"),L=new RegExp("("+O+")+","gi");function A(e,t){try{return[decodeURIComponent(e.join(""))]}catch{}if(1===e.length)return e;t=t||1;const r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],A(r),A(n))}function D(e){try{return decodeURIComponent(e)}catch{let t=e.match(C)||[];for(let r=1;r<t.length;r++)t=(e=A(t,r).join("")).match(C)||[];return e}}function _(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return function(e){const t={"%FE%FF":"\ufffd\ufffd","%FF%FE":"\ufffd\ufffd"};let r=L.exec(e);for(;r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{const e=D(r[0]);e!==r[0]&&(t[r[0]]=e)}r=L.exec(e)}t["%C2"]="\ufffd";const n=Object.keys(t);for(const r of n)e=e.replace(new RegExp(r,"g"),t[r]);return e}(e)}}function P(e,t){const r={};if(Array.isArray(t))for(const n of t){const t=Object.getOwnPropertyDescriptor(e,n);t?.enumerable&&Object.defineProperty(r,n,t)}else for(const n of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,n);if(i.enumerable){t(n,e[n],e)&&Object.defineProperty(r,n,i)}}return r}function x(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===e||""===t)return[];const r=e.indexOf(t);return-1===r?[]:[e.slice(0,r),e.slice(r+t.length)]}const M=e=>null==e,k=e=>encodeURIComponent(e).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),j=Symbol("encodeFragmentIdentifier");function F(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function U(e,t){return t.encode?t.strict?k(e):encodeURIComponent(e):e}function B(e,t){return t.decode?_(e):e}function V(e){return Array.isArray(e)?e.sort():"object"==typeof e?V(Object.keys(e)).sort((e,t)=>Number(e)-Number(t)).map(t=>e[t]):e}function G(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function $(e,t,r){return"string"===r&&"string"==typeof e?e:"function"==typeof r&&"string"==typeof e?r(e):"boolean"===r&&null===e||("boolean"!==r||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()?"boolean"!==r||null===e||"1"!==e.toLowerCase()&&"0"!==e.toLowerCase()?"string[]"===r&&"none"!==t.arrayFormat&&"string"==typeof e?[e]:"number[]"!==r||"none"===t.arrayFormat||Number.isNaN(Number(e))||"string"!=typeof e||""===e.trim()?"number"!==r||Number.isNaN(Number(e))||"string"!=typeof e||""===e.trim()?!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()?t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?Number(e):e:"true"===e.toLowerCase():Number(e):[Number(e)]:"1"===e.toLowerCase():"true"===e.toLowerCase())}function H(e){const t=(e=G(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function W(e,t){F((t={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...t}).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)]$/.exec(e),e=e.replace(/\[\d*]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[])$/.exec(e),e=e.replace(/\[]$/,""),t?void 0!==n[e]?n[e]=[...n[e],r]:n[e]=[r]:n[e]=r};case"colon-list-separator":return(e,r,n)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==n[e]?n[e]=[...n[e],r]:n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const i="string"==typeof r&&r.includes(e.arrayFormatSeparator),o="string"==typeof r&&!i&&B(r,e).includes(e.arrayFormatSeparator);r=o?B(r,e):r;const s=i||o?r.split(e.arrayFormatSeparator).map(t=>B(t,e)):null===r?r:B(r,e);n[t]=s};case"bracket-separator":return(t,r,n)=>{const i=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!i)return void(n[t]=r?B(r,e):r);const o=null===r?[]:B(r,e).split(e.arrayFormatSeparator);void 0!==n[t]?n[t]=[...n[t],...o]:n[t]=o};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[...[r[e]].flat(),t]:r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const i of e.split("&")){if(""===i)continue;const e=t.decode?i.replaceAll("+"," "):i;let[o,s]=x(e,"=");void 0===o&&(o=e),s=void 0===s?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?s:B(s,t),r(B(o,t),s,n)}for(const[e,r]of Object.entries(n))if("object"==typeof r&&null!==r&&"string"!==t.types[e])for(const[n,i]of Object.entries(r)){const o=t.types[e]?t.types[e].replace("[]",""):void 0;r[n]=$(i,t,o)}else"object"==typeof r&&null!==r&&"string"===t.types[e]?n[e]=Object.values(r).join(t.arrayFormatSeparator):n[e]=$(r,t,t.types[e]);return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{const r=n[t];return e[t]=Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?V(r):r,e},Object.create(null))}function z(e,t){if(!e)return"";F((t={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...t}).arrayFormatSeparator);const r=r=>t.skipNull&&M(e[r])||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const i=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[U(t,e),"[",i,"]"].join("")]:[...r,[U(t,e),"[",U(i,e),"]=",U(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[U(t,e),"[]"].join("")]:[...r,[U(t,e),"[]=",U(n,e)].join("")];case"colon-list-separator":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[U(t,e),":list="].join("")]:[...r,[U(t,e),":list=",U(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(n,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:(i=null===i?"":i,0===n.length?[[U(r,e),t,U(i,e)].join("")]:[[n,U(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,U(t,e)]:[...r,[U(t,e),"=",U(n,e)].join("")]}}(t),i={};for(const[t,n]of Object.entries(e))r(t)||(i[t]=n);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map(r=>{const i=e[r];return void 0===i?"":null===i?U(r,t):Array.isArray(i)?0===i.length&&"bracket-separator"===t.arrayFormat?U(r,t)+"[]":i.reduce(n(r),[]).join("&"):U(r,t)+"="+U(i,t)}).filter(e=>e.length>0).join("&")}function q(e,t){t={decode:!0,...t};let[r,n]=x(e,"#");return void 0===r&&(r=e),{url:r?.split("?")?.[0]??"",query:W(H(e),t),...t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:B(n,t)}:{}}}function J(e,t){t={encode:!0,strict:!0,[j]:!0,...t};const r=G(e.url).split("?")[0]||"";let n=z({...W(H(e.url),{sort:!1,...t}),...e.query},t);n&&=`?${n}`;let i=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);if("string"==typeof e.fragmentIdentifier){const n=new URL(r);n.hash=e.fragmentIdentifier,i=t[j]?n.hash:`#${e.fragmentIdentifier}`}return`${r}${n}${i}`}function K(e,t,r){r={parseFragmentIdentifier:!0,[j]:!1,...r};const{url:n,query:i,fragmentIdentifier:o}=q(e,r);return J({url:n,query:P(i,t),fragmentIdentifier:o},r)}function Y(e,t,r){return K(e,Array.isArray(t)?e=>!t.includes(e):(e,r)=>!t(e,r),r)}const X=r;var Q,Z,ee,te,re,ne,ie,oe,se;!function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(Q||(Q={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE",e.DateOnly="DATE_ONLY",e.TimeOnly="TIME_ONLY"}(Z||(Z={})),function(e){e.BigInteger="esriFieldTypeBigInteger",e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.DateOnly="esriFieldTypeDateOnly",e.TimeOnly="esriFieldTypeTimeOnly",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(ee||(ee={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(te||(te={})),function(e){e.Design="DESIGN",e.Run="RUN",e.Express="EXPRESS"}(re||(re={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED",e.Hidden="HIDDEN"}(ne||(ne={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS",e.Block="BLOCK",e.Screen="SCREEN",e.PageTop="PAGE_TOP",e.PrintPreview="PRINT_PREVIEW",e.CookieBanner="COOKIE_BANNER"}(ie||(ie={})),function(e){e.CurrentWindow="_self",e.TopWindow="_top",e.NewWindow="_blank"}(oe||(oe={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(se||(se={}));var ae,le;!function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(ae||(ae={})),function(e){e.Http="http:",e.Https="https:"}(le||(le={}));var ce,ue;!function(e){e.Image="IMAGE",e.Config="CONFIG",e.Translation="TRANSLATION"}(ce||(ce={})),function(e){e.EXB_DATA_SOURCE_ID_SET_TO_CREATED_JS_API_LAYER="_exb_data_source_id_set_to_created_js_api_layer",e.EXB_OID="_exb_oid",e.EXB_NOT_EDITABLE="_exb_not_editable",e.EXB_DATA_SOURCE="__exb_data_source",e.EXB_DATA_SET="__exb_data_set",e.EXB_LAYER_VIEW_IGNORE_SPATIAL_FILTER="__exb_layer_view_ignore_spatial_filter",e.EXB_LAYER_FROM_RUNTIME="__exb_layer_from_runtime",e.EXB_DATA_SOURCE_ID="__exb_data_source_id",e.EXB_JIMU_LAYER_VIEW_ID="__exb_jimu_layer_view_id",e.EXB_PREDEFINED_RENDERER="__exb_predefined_renderer",e.EXB_LAYER_REMOVED_BEFORE="__exb_layer_removed_before",e.EXB_LAYER_CREATED_BY_DATA_SOURCE="__exb_layer_created_by_data_source"}(ue||(ue={}));const de=function(){this.__data__=[],this.size=0};const he=function(e,t){return e===t||e!=e&&t!=t};const pe=function(e,t){for(var r=e.length;r--;)if(he(e[r][0],t))return r;return-1};var fe=Array.prototype.splice;const me=function(e){var t=this.__data__,r=pe(t,e);return!(r<0)&&(r==t.length-1?t.pop():fe.call(t,r,1),--this.size,!0)};const ge=function(e){var t=this.__data__,r=pe(t,e);return r<0?void 0:t[r][1]};const ve=function(e){return pe(this.__data__,e)>-1};const ye=function(e,t){var r=this.__data__,n=pe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Se.prototype.clear=de,Se.prototype.delete=me,Se.prototype.get=ge,Se.prototype.has=ve,Se.prototype.set=ye;const Ie=Se;const we=function(){this.__data__=new Ie,this.size=0};const Ee=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};const be=function(e){return this.__data__.get(e)};const Re=function(e){return this.__data__.has(e)};const Te="object"==typeof global&&global&&global.Object===Object&&global;var Ne="object"==typeof self&&self&&self.Object===Object&&self;const Oe=Te||Ne||Function("return this")();const Ce=Oe.Symbol;var Le=Object.prototype,Ae=Le.hasOwnProperty,De=Le.toString,_e=Ce?Ce.toStringTag:void 0;const Pe=function(e){var t=Ae.call(e,_e),r=e[_e];try{e[_e]=void 0;var n=!0}catch(e){}var i=De.call(e);return n&&(t?e[_e]=r:delete e[_e]),i};var xe=Object.prototype.toString;const Me=function(e){return xe.call(e)};var ke=Ce?Ce.toStringTag:void 0;const je=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ke&&ke in Object(e)?Pe(e):Me(e)};const Fe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const Ue=function(e){if(!Fe(e))return!1;var t=je(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Be=Oe["__core-js_shared__"];var Ve,Ge=(Ve=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||""))?"Symbol(src)_1."+Ve:"";const $e=function(e){return!!Ge&&Ge in e};var He=Function.prototype.toString;const We=function(e){if(null!=e){try{return He.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var ze=/^\[object .+?Constructor\]$/,qe=Function.prototype,Je=Object.prototype,Ke=qe.toString,Ye=Je.hasOwnProperty,Xe=RegExp("^"+Ke.call(Ye).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Qe=function(e){return!(!Fe(e)||$e(e))&&(Ue(e)?Xe:ze).test(We(e))};const Ze=function(e,t){return null==e?void 0:e[t]};const et=function(e,t){var r=Ze(e,t);return Qe(r)?r:void 0};const tt=et(Oe,"Map");const rt=et(Object,"create");const nt=function(){this.__data__=rt?rt(null):{},this.size=0};const it=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var ot=Object.prototype.hasOwnProperty;const st=function(e){var t=this.__data__;if(rt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ot.call(t,e)?t[e]:void 0};var at=Object.prototype.hasOwnProperty;const lt=function(e){var t=this.__data__;return rt?void 0!==t[e]:at.call(t,e)};const ct=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=rt&&void 0===t?"__lodash_hash_undefined__":t,this};function ut(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ut.prototype.clear=nt,ut.prototype.delete=it,ut.prototype.get=st,ut.prototype.has=lt,ut.prototype.set=ct;const dt=ut;const ht=function(){this.size=0,this.__data__={hash:new dt,map:new(tt||Ie),string:new dt}};const pt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ft=function(e,t){var r=e.__data__;return pt(t)?r["string"==typeof t?"string":"hash"]:r.map};const mt=function(e){var t=ft(this,e).delete(e);return this.size-=t?1:0,t};const gt=function(e){return ft(this,e).get(e)};const vt=function(e){return ft(this,e).has(e)};const yt=function(e,t){var r=ft(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function St(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}St.prototype.clear=ht,St.prototype.delete=mt,St.prototype.get=gt,St.prototype.has=vt,St.prototype.set=yt;const It=St;const wt=function(e,t){var r=this.__data__;if(r instanceof Ie){var n=r.__data__;if(!tt||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new It(n)}return r.set(e,t),this.size=r.size,this};function Et(e){var t=this.__data__=new Ie(e);this.size=t.size}Et.prototype.clear=we,Et.prototype.delete=Ee,Et.prototype.get=be,Et.prototype.has=Re,Et.prototype.set=wt;const bt=Et;const Rt=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const Tt=function(e){return this.__data__.has(e)};function Nt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new It;++t<r;)this.add(e[t])}Nt.prototype.add=Nt.prototype.push=Rt,Nt.prototype.has=Tt;const Ot=Nt;const Ct=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};const Lt=function(e,t){return e.has(t)};const At=function(e,t,r,n,i,o){var s=1&r,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var d=-1,h=!0,p=2&r?new Ot:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var f=e[d],m=t[d];if(n)var g=s?n(m,f,d,t,e,o):n(f,m,d,e,t,o);if(void 0!==g){if(g)continue;h=!1;break}if(p){if(!Ct(t,function(e,t){if(!Lt(p,t)&&(f===e||i(f,e,r,n,o)))return p.push(t)})){h=!1;break}}else if(f!==m&&!i(f,m,r,n,o)){h=!1;break}}return o.delete(e),o.delete(t),h};const Dt=Oe.Uint8Array;const _t=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r};const Pt=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r};var xt=Ce?Ce.prototype:void 0,Mt=xt?xt.valueOf:void 0;const kt=function(e,t,r,n,i,o,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Dt(e),new Dt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return he(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=_t;case"[object Set]":var l=1&n;if(a||(a=Pt),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var u=At(a(e),a(t),n,i,o,s);return s.delete(e),u;case"[object Symbol]":if(Mt)return Mt.call(e)==Mt.call(t)}return!1};const jt=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e};const Ft=Array.isArray;const Ut=function(e,t,r){var n=t(e);return Ft(e)?n:jt(n,r(e))};const Bt=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o};const Vt=function(){return[]};var Gt=Object.prototype.propertyIsEnumerable,$t=Object.getOwnPropertySymbols;const Ht=$t?function(e){return null==e?[]:(e=Object(e),Bt($t(e),function(t){return Gt.call(e,t)}))}:Vt;const Wt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};const zt=function(e){return null!=e&&"object"==typeof e};const qt=function(e){return zt(e)&&"[object Arguments]"==je(e)};var Jt=Object.prototype,Kt=Jt.hasOwnProperty,Yt=Jt.propertyIsEnumerable,Xt=qt(function(){return arguments}())?qt:function(e){return zt(e)&&Kt.call(e,"callee")&&!Yt.call(e,"callee")};const Qt=Xt;const Zt=function(){return!1};var er="object"==typeof exports&&exports&&!exports.nodeType&&exports,tr=er&&"object"==typeof module&&module&&!module.nodeType&&module,rr=tr&&tr.exports===er?Oe.Buffer:void 0;const nr=(rr?rr.isBuffer:void 0)||Zt;var ir=/^(?:0|[1-9]\d*)$/;const or=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&ir.test(e))&&e>-1&&e%1==0&&e<t};const sr=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ar={};ar["[object Float32Array]"]=ar["[object Float64Array]"]=ar["[object Int8Array]"]=ar["[object Int16Array]"]=ar["[object Int32Array]"]=ar["[object Uint8Array]"]=ar["[object Uint8ClampedArray]"]=ar["[object Uint16Array]"]=ar["[object Uint32Array]"]=!0,ar["[object Arguments]"]=ar["[object Array]"]=ar["[object ArrayBuffer]"]=ar["[object Boolean]"]=ar["[object DataView]"]=ar["[object Date]"]=ar["[object Error]"]=ar["[object Function]"]=ar["[object Map]"]=ar["[object Number]"]=ar["[object Object]"]=ar["[object RegExp]"]=ar["[object Set]"]=ar["[object String]"]=ar["[object WeakMap]"]=!1;const lr=function(e){return zt(e)&&sr(e.length)&&!!ar[je(e)]};const cr=function(e){return function(t){return e(t)}};var ur="object"==typeof exports&&exports&&!exports.nodeType&&exports,dr=ur&&"object"==typeof module&&module&&!module.nodeType&&module,hr=dr&&dr.exports===ur&&Te.process;const pr=function(){try{var e=dr&&dr.require&&dr.require("util").types;return e||hr&&hr.binding&&hr.binding("util")}catch(e){}}();var fr=pr&&pr.isTypedArray;const mr=fr?cr(fr):lr;var gr=Object.prototype.hasOwnProperty;const vr=function(e,t){var r=Ft(e),n=!r&&Qt(e),i=!r&&!n&&nr(e),o=!r&&!n&&!i&&mr(e),s=r||n||i||o,a=s?Wt(e.length,String):[],l=a.length;for(var c in e)!t&&!gr.call(e,c)||s&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||or(c,l))||a.push(c);return a};var yr=Object.prototype;const Sr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||yr)};const Ir=function(e,t){return function(r){return e(t(r))}};const wr=Ir(Object.keys,Object);var Er=Object.prototype.hasOwnProperty;const br=function(e){if(!Sr(e))return wr(e);var t=[];for(var r in Object(e))Er.call(e,r)&&"constructor"!=r&&t.push(r);return t};const Rr=function(e){return null!=e&&sr(e.length)&&!Ue(e)};const Tr=function(e){return Rr(e)?vr(e):br(e)};const Nr=function(e){return Ut(e,Tr,Ht)};var Or=Object.prototype.hasOwnProperty;const Cr=function(e,t,r,n,i,o){var s=1&r,a=Nr(e),l=a.length;if(l!=Nr(t).length&&!s)return!1;for(var c=l;c--;){var u=a[c];if(!(s?u in t:Or.call(t,u)))return!1}var d=o.get(e),h=o.get(t);if(d&&h)return d==t&&h==e;var p=!0;o.set(e,t),o.set(t,e);for(var f=s;++c<l;){var m=e[u=a[c]],g=t[u];if(n)var v=s?n(g,m,u,t,e,o):n(m,g,u,e,t,o);if(!(void 0===v?m===g||i(m,g,r,n,o):v)){p=!1;break}f||(f="constructor"==u)}if(p&&!f){var y=e.constructor,S=t.constructor;y==S||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof S&&S instanceof S||(p=!1)}return o.delete(e),o.delete(t),p};const Lr=et(Oe,"DataView");const Ar=et(Oe,"Promise");const Dr=et(Oe,"Set");const _r=et(Oe,"WeakMap");var Pr="[object Map]",xr="[object Promise]",Mr="[object Set]",kr="[object WeakMap]",jr="[object DataView]",Fr=We(Lr),Ur=We(tt),Br=We(Ar),Vr=We(Dr),Gr=We(_r),$r=je;(Lr&&$r(new Lr(new ArrayBuffer(1)))!=jr||tt&&$r(new tt)!=Pr||Ar&&$r(Ar.resolve())!=xr||Dr&&$r(new Dr)!=Mr||_r&&$r(new _r)!=kr)&&($r=function(e){var t=je(e),r="[object Object]"==t?e.constructor:void 0,n=r?We(r):"";if(n)switch(n){case Fr:return jr;case Ur:return Pr;case Br:return xr;case Vr:return Mr;case Gr:return kr}return t});const Hr=$r;var Wr="[object Arguments]",zr="[object Array]",qr="[object Object]",Jr=Object.prototype.hasOwnProperty;const Kr=function(e,t,r,n,i,o){var s=Ft(e),a=Ft(t),l=s?zr:Hr(e),c=a?zr:Hr(t),u=(l=l==Wr?qr:l)==qr,d=(c=c==Wr?qr:c)==qr,h=l==c;if(h&&nr(e)){if(!nr(t))return!1;s=!0,u=!1}if(h&&!u)return o||(o=new bt),s||mr(e)?At(e,t,r,n,i,o):kt(e,t,l,r,n,i,o);if(!(1&r)){var p=u&&Jr.call(e,"__wrapped__"),f=d&&Jr.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return o||(o=new bt),i(m,g,r,n,o)}}return!!h&&(o||(o=new bt),Cr(e,t,r,n,i,o))};const Yr=function e(t,r,n,i,o){return t===r||(null==t||null==r||!zt(t)&&!zt(r)?t!=t&&r!=r:Kr(t,r,n,i,e,o))};const Xr=function(e,t){return Yr(e,t)},Qr={};Qr[Q.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],Qr[Q.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],Qr[Q.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}];const Zr="selection",en="no_selection",tn="output",rn="exb_user_locale",nn=["en","ar","bg","bs","ca","cs","da","de","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw"];var on,sn,an=m(17390);!function(e){e.NotCreated="NOT_CREATED",e.Created="CREATED",e.CreateError="CREATE_ERROR",e.NotReady="NOT_READY",e.Unloaded="UNLOADED",e.Loading="LOADING",e.Loaded="LOADED",e.LoadError="LOAD_ERROR",e.Saving="SAVING",e.Saved="SAVED",e.SaveError="SAVE_ERROR",e.Closed="CLOSED",e.Connecting="CONNECTING",e.Connected="CONNECTED",e.Closing="CLOSING"}(on||(on={})),function(e){e.Error="ERROR",e.SimpleLocal="SIMPLE_LOCAL",e.CSV="CSV",e.FeatureLayer="FEATURE_LAYER",e.SceneLayer="SCENE_LAYER",e.SubtypeGroupLayer="SUBTYPE_GROUP_LAYER",e.SubtypeSublayer="SUBTYPE_SUBLAYER",e.GroupLayer="GROUP_LAYER",e.FeatureService="FEATURE_SERVICE",e.MapService="MAP_SERVICE",e.SceneService="SCENE_SERVICE",e.VectorTileService="VECTOR_TILE_SERVICE",e.GeoJSON="GEO_JSON",e.KML="KML",e.WFS="WFS",e.WMS="WMS",e.WMTS="WMTS",e.BuildingSceneLayer="BUILDING_SCENE_LAYER",e.BuildingGroupSubLayer="BUILDING_GROUP_SUBLAYER",e.BuildingComponentSubLayer="BUILDING_COMPONENT_SUBLAYER",e.OrientedImageryLayer="ORIENTED_IMAGERY_LAYER",e.ImageryLayer="IMAGERY_LAYER",e.ImageryTileLayer="IMAGERY_TILE_LAYER",e.ElevationLayer="ELEVATION_LAYER",e.Map="MAP",e.WebMap="WEB_MAP",e.WebScene="WEB_SCENE"}(sn||(sn={}));var ln,cn,un,dn,hn,pn,fn,mn,gn,vn;!function(e){e.FeatureLayer="Feature Layer",e.Table="Table",e.GroupLayer="Group Layer",e.OrientedImageryLayer="Oriented Imagery Layer",e.SceneLayerPoint="Point",e.SceneLayer3DObject="3DObject",e.BuildingSceneLayer="Building",e.BuildingGroupSubLayer="building-group",e.BuildingComponentSubLayer="building-component"}(ln||(ln={})),function(e){e.FeatureService="FeatureServer",e.MapService="MapServer",e.SceneService="SceneServer",e.ImageService="ImageServer",e.VectorTileService="VectorTileServer"}(cn||(cn={})),function(e){e.WebMap="Web Map",e.WebScene="Web Scene",e.FeatureService="Feature Service",e.MapService="Map Service",e.SceneService="Scene Service",e.ImageService="Image Service",e.VectorTileService="Vector Tile Service",e.FeatureCollection="Feature Collection",e.GroupLayer="Group Layer",e.CSV="CSV",e.GeoJSON="GeoJson",e.KML="KML",e.WFS="WFS",e.WMS="WMS",e.WMTS="WMTS",e.GeometryService="Geometry Service",e.GeocodingService="Geocoding Service",e.GeoprocessingService="Geoprocessing Service",e.NetworkAnalysisService="Network Analysis Service",e.GeoenrichmentService="Geoenrichment service"}(un||(un={})),function(e){e.FeatureLayer="feature",e.MapImageLayer="map-image",e.TileLayer="tile",e.GroupLayer="group",e.SceneLayer="scene",e.ImageryLayer="imagery",e.ImageryTileLayer="imagery-tile",e.ElevationLayer="elevation",e.OrientedImageryLayer="oriented-imagery",e.SubtypeGroupLayer="subtype-group",e.SubtypeSublayer="subtype-sublayer",e.VectorTileLayer="vector-tile",e.KMLLayer="kml",e.CSVLayer="csv",e.GeoJSONLayer="geojson",e.WFSLayer="wfs",e.WMSLayer="wms",e.WMTSLayer="wmts",e.BuildingSceneLayer="building-scene",e.BuildingComponentSubLayer="building-component",e.BuildingGroupSubLayer="building-group"}(dn||(dn={})),function(e){e.FeatureLayer="ArcGISFeatureLayer",e.SceneLayer="ArcGISSceneServiceLayer",e.GroupLayer="GroupLayer",e.MapService="ArcGISMapServiceLayer",e.TiledMapService="ArcGISTiledMapServiceLayer",e.VectorTileService="VectorTileLayer",e.ImageService="ArcGISImageServiceLayer",e.TiledImageService="ArcGISTiledImageServiceLayer",e.CSV="CSV",e.GeoJSON="GeoJSON",e.KML="KML",e.WFS="WFS",e.WMS="WMS",e.SubtypeGroupLayer="SubtypeGroupLayer"}(hn||(hn={}));class yn extends Error{constructor(e,t){super(`data source id: ${e}, ${t}`),this.dataSourceId=e}}!function(e){e.InAllData="IN_ALL_DATA",e.InRemoteConfigView="IN_REMOTE_CONFIG_VIEW",e.InConfigView="IN_CONFIG_VIEW",e.InRuntimeView="IN_RUNTIME_VIEW"}(pn||(pn={})),function(e){e.Asc="ASC",e.Desc="DESC"}(fn||(fn={})),function(e){e.New="New",e.AddToCurrent="AddToCurrent",e.RemoveFromCurrent="RemoveFromCurrent",e.SelectFromCurrent="SelectFromCurrent"}(mn||(mn={})),function(e){e.BaseDynamicLayer="base-dynamic",e.BaseElevationLayer="base-elevation",e.BaseTileLayer="base-tile",e.BingMapsLayer="bing-maps",e.BuildingSceneLayer="building-scene",e.BuildingGroupSublayer="building-group",e.BuildingComponentSublayer="building-component",e.CatalogLayer="catalog",e.CatalogDynamicGroupLayer="catalog-dynamic-group",e.CatalogFootprintLayer="catalog-footprint",e.CSVLayer="csv",e.DimensionLayer="dimension",e.ElevationLayer="elevation",e.FeatureLayer="feature",e.GeoJSONLayer="geojson",e.GeoRSSLayer="geo-rss",e.GraphicsLayer="graphics",e.GroupLayer="group",e.SubtypeGroupLayer="subtype-group",e.SubtypeSublayer="subtype-sublayer",e.ImageryLayer="imagery",e.ImageryTileLayer="imagery-tile",e.IntegratedMesh3DTilesLayer="integrated-mesh-3dtiles",e.OrientedImageryLayer="oriented-imagery",e.IntegratedMeshLayer="integrated-mesh",e.KMLLayer="kml",e.KnowledgeGraphLayer="knowledge-graph",e.KnowledgeGraphSublayer="knowledge-graph-sublayer",e.LineOfSightLayer="line-of-sight",e.MapImageLayer="map-image",e.MapNotesLayer="map-notes",e.MediaLayer="media",e.OGCFeatureLayer="ogc-feature",e.OpenStreetMapLayer="open-street-map",e.PointCloudLayer="point-cloud",e.RouteLayer="route",e.SceneLayer="scene",e.StreamLayer="stream",e.TileLayer="tile",e.UnknownLayer="unknown",e.UnsupportedLayer="unsupported",e.VectorTileLayer="vector-tile",e.VideoLayer="video",e.ViewshedLayer="viewshed",e.VoxelLayer="voxel",e.WCSLayer="wcs",e.WFSLayer="wfs",e.WMSLayer="wms",e.WMTSLayer="wmts",e.WebTileLayer="web-tile"}(gn||(gn={})),function(e){e.AppConfigProcessor="APP_CONFIG_PROCESSOR",e.WidgetClassWrapper="WIDGET_CLASS_WRAPPER",e.AppConfigService="APP_CONFIG_SERVICE",e.ReduxStore="REDUX_STORE",e.ReduxActionInterceptor="REDUX_ACTION_INTERCEPTOR",e.DependencyDefine="DEPENDENCY_DEFINE",e.DataSourceFactoryUri="DATA_SOURCE_FACTORY_URI",e.ContextTool="CONTEXT_TOOL",e.AppConfigOperations="APP_CONFIG_OPERATIONS",e.BuilderOperations="BUILDER_OPERATIONS",e.LayoutTransformer="LAYOUT_TRANSFORMER"}(vn||(vn={}));const Sn=[vn.ReduxStore,vn.ReduxActionInterceptor,vn.DataSourceFactoryUri,vn.DependencyDefine,vn.ContextTool,vn.AppConfigOperations,vn.BuilderOperations,vn.LayoutTransformer],In=[vn.ContextTool,vn.AppConfigOperations,vn.BuilderOperations];var wn=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class En{constructor(){this.extensions={},this.extensionClasses={}}static getInstance(){return En.instance||(En.instance=new En,window._extensionManager=En.instance),En.instance}getExtensions(e){return this.extensions[e]||[]}getAllExtensions(){const e=[];return Object.keys(this.extensions).forEach(t=>{this.extensions[t].forEach(t=>{e.push(t)})}),e}registerExtension(e){if(!this.getExtensionById(e.extension.id)){if(this.extensions[e.epName]){if(!Sn.includes(e.epName))return;this.extensions[e.epName].push(e.extension),this.extensions[e.epName]=this.extensions[e.epName].sort((e,t)=>e.index-t.index)}else this.extensions[e.epName]=[e.extension];var t;e.epName===vn.ReduxStore&&Ya().dispatch((t=e.extension.id,{type:ja.InitStoreExtensionState,extensionId:t}))}}destroyAllExtensions(){Object.keys(this.extensions).forEach(e=>{this.extensions[e].forEach(e=>{delete this.extensionClasses[e.name],e.destroy&&e.destroy()})}),this.extensions={}}destroyWidgetExtensions(e){Object.keys(this.extensions).forEach(t=>{this.extensions[t].forEach(t=>{t.widgetId===e&&(delete this.extensionClasses[t.name],t.destroy&&t.destroy())}),this.extensions[t]=this.extensions[t].filter(t=>t.widgetId!==e)})}registerWidgetExtensions(e,t){return wn(this,void 0,void 0,function*(){var r;const n=[];e.manifest.extensions&&e.manifest.extensions.forEach(t=>{(window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder||!In.includes(t.point))&&n.push(this.registerWidgetExtension(e,t))});const i=yield Promise.all(n);if(t&&e.manifest.extensions){const t=Ya().getState().widgetsRuntimeInfo;(null===(r=null==t?void 0:t[e.id])||void 0===r?void 0:r.shouldExpandContextTool)||Ya().dispatch((o=e.id,s="shouldExpandContextTool",a=!0,{type:ja.WidgetRuntimeInfoChange,widgetId:o,prop:s,value:a}))}var o,s,a;return i})}registerWidgetExtension(e,t){return wn(this,void 0,void 0,function*(){if(this.extensions[t.point]){if(!Sn.includes(t.point))return Promise.resolve();if(this.extensions[t.point].filter(r=>r.name===`${e.manifest.name}-${t.name}`&&r.widgetId===e.id).length>0)return Promise.resolve()}return window.jimuConfig.isInBuilder&&In.includes(t.point)&&(yield window.parent._extensionManager.registerWidgetExtension(e,t)),this.loadWidgetExtensionClass(e,t).then(r=>{const n=new r;n.name=`${e.manifest.name}-${t.name}`,n.widgetId=e.id,n.id=`${n.widgetId}-${t.name}`,n.label=e.manifest.i18nMessages[`_ext_${t.name}_label`]||t.label,this.registerExtension({epName:t.point,extension:n})}).catch(t=>(console.error("Register widget extension error.",e.label),Promise.resolve()))})}loadWidgetExtensionClass(e,t){return wn(this,void 0,void 0,function*(){const r=`${e.manifest.name}-${t.name}`;if(this.extensionClasses[r])return yield this.extensionClasses[r];const n=e.uri+"dist/"+t.uri;return this.extensionClasses[r]=Cl(n).then(e=>e.default),this.extensionClasses[r]})}getExtensionById(e){const t=this.getAllExtensions();for(const r of t)if(r.id===e)return r}}const bn=function(){return Oe.Date.now()};var Rn=/\s/;const Tn=function(e){for(var t=e.length;t--&&Rn.test(e.charAt(t)););return t};var Nn=/^\s+/;const On=function(e){return e?e.slice(0,Tn(e)+1).replace(Nn,""):e};const Cn=function(e){return"symbol"==typeof e||zt(e)&&"[object Symbol]"==je(e)};var Ln=/^[-+]0x[0-9a-f]+$/i,An=/^0b[01]+$/i,Dn=/^0o[0-7]+$/i,_n=parseInt;const Pn=function(e){if("number"==typeof e)return e;if(Cn(e))return NaN;if(Fe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Fe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=On(e);var r=An.test(e);return r||Dn.test(e)?_n(e.slice(2),r?2:8):Ln.test(e)?NaN:+e};var xn=Math.max,Mn=Math.min;const kn=function(e,t,r){var n,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=n,o=i;return n=i=void 0,c=t,s=e.apply(o,r)}function f(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-c>=o}function m(){var e=bn();if(f(e))return g(e);a=setTimeout(m,function(e){var r=t-(e-l);return d?Mn(r,o-(e-c)):r}(e))}function g(e){return a=void 0,h&&n?p(e):(n=i=void 0,s)}function v(){var e=bn(),r=f(e);if(n=arguments,i=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(m,t),u?p(e):s}(l);if(d)return clearTimeout(a),a=setTimeout(m,t),p(l)}return void 0===a&&(a=setTimeout(m,t)),s}return t=Pn(t)||0,Fe(r)&&(u=!!r.leading,o=(d="maxWait"in r)?xn(Pn(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=i=a=void 0},v.flush=function(){return void 0===a?s:g(bn())},v};const jn=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Fe(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),kn(e,t,{leading:n,maxWait:t,trailing:i})};const Fn=function(e,t,r){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout(function(){e.apply(void 0,r)},t)};const Un=function(e){return e};const Bn=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)};var Vn=Math.max;const Gn=function(e,t,r){return t=Vn(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=Vn(n.length-t,0),s=Array(o);++i<o;)s[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(s),Bn(e,this,a)}};const $n=function(e){return function(){return e}};const Hn=function(){try{var e=et(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Wn=Hn?function(e,t){return Hn(e,"toString",{configurable:!0,enumerable:!1,value:$n(t),writable:!0})}:Un;var zn=Date.now;const qn=function(e){var t=0,r=0;return function(){var n=zn(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};const Jn=qn(Wn);const Kn=function(e,t){return Jn(Gn(e,t,Un),e+"")}(function(e,t){return Fn(e,1,t)});function Yn(e){return/\/$/.test(e)?`${e}sharing/rest`:`${e}/sharing/rest`}function Xn(e){const t=/\/$/.test(e)?"/sharing/rest/":"/sharing/rest";return e.substr(0,e.length-t.length)}function Qn(e,t){const r=/^http(s?):\/\//gi,n=/^\/\//gi;return(e=ei(e).toLowerCase().replace(r,"").replace(n,""))===(t=ei(t).toLowerCase().replace(r,"").replace(n,""))}function Zn(e){return fl(e).includes(".arcgis.com")}function ei(e){const t=fl(e);return""===t?"":Zn(t)?hl(t,le.Https):hl(e=(e||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),le.Https)}function ti(e,t){let r="";const n=function(e){let t="";const r=ei(e);return r&&(t=r+"/sharing/rest/content/items"),t}(e);return n&&t&&(r=n+"/"+t),r}function ri(e){if(!e)return e;if(Zn(e)){const t=fl(e),r=dl(e),n=t.split("."),i=n[0];n.splice(0,1);const o=n.join(".");let s;return"devext"===i||"mapsdevext.arcgis.com"===o?s="devext.arcgis.com":"qaext"===i||"mapsqa.arcgis.com"===o?s="qaext.arcgis.com":"www"!==i&&"maps.arcgis.com"!==o||(s="www.arcgis.com"),s=s&&`${r?r+"//":""}${s}`,s}return e}const ni={mapServer:"MapServer",imageServer:"ImageServer",featureServer:"FeatureServer",sceneServer:"SceneServer",streamServer:"StreamServer",vectortileServer:"VectorTileServer",GPServer:"GPServer",bigDataCatalogServer:"BigDataCatalogServer",dataReviewerServer:"DataReviewerServer",geoAnalytics:"GeoAnalytics",geocodeServer:"GeocodeServer",geoDataServer:"GeoDataServer",geometryServer:"GeometryServer",globeServer:"GlobeServer",knowledgeGraphServer:"KnowledgeGraphServer",LRServer:"LRServer",mobileServer:"MobileServer",networkDiagramServer:"NetworkDiagramServer",parcelFabricServer:"ParcelFabricServer",relationalCatalogServer:"RelationalCatalogServer",NAServer:"NAServer",schematicsServer:"SchematicsServer",symbolServer:"SymbolServer",topographicProductionServer:"TopographicProductionServer",traceNetworkServer:"TraceNetworkServer",utilityNetworkServer:"UtilityNetworkServer",validationServer:"ValidationServer",versionManagementServer:"VersionManagementServer"};function ii(e=""){const t=Object.values(ni),r=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/(admin\\/)?services\\/(.+?)\\/(${t.join("|")}))`,"i"),n=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${t.join("|")}))`,"i"),i=e.match(r)||e.match(n);return i?i[0]:null}function oi(e=""){const t=/\/rest\/admin\/services(\/|$)/i,r=e.toLowerCase();let n=r.indexOf("/appservices");-1===n&&(n=r.indexOf("/rest/services")),-1===n&&t.test(e)&&(n=e.search(t));return n>-1?e.substring(0,n):null}function si(e=""){return!!ii(e)}function ai(e=""){return!!oi(e)}function li(e=""){return ii(e)||e}function ci(e=""){return oi(e)||e}var ui=function(e,t){return ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},ui(e,t)};function di(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ui(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var hi=function(){return hi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},hi.apply(this,arguments)};function pi(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}Object.create;function fi(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;function mi(e){return Object.keys(e).some(t=>{let r=e[t];if(!r)return!1;r&&r.toParam&&(r=r.toParam());switch(r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function gi(e){const t={};return Object.keys(e).forEach(r=>{var n,i;let o=e[r];if(o&&o.toParam&&(o=o.toParam()),!o&&0!==o&&"boolean"!=typeof o&&"string"!=typeof o)return;let s;switch(o.constructor.name){case"Array":const e=null===(i=null===(n=o[0])||void 0===n?void 0:n.constructor)||void 0===i?void 0:i.name;s="Array"===e?o:"Object"===e?JSON.stringify(o):o.join(",");break;case"Object":s=JSON.stringify(o);break;case"Date":s=o.valueOf();break;case"Function":s=null;break;case"Boolean":s=o+"";break;default:s=o}(s||0===s||"string"==typeof s||Array.isArray(s))&&(t[r]=s)}),t}function vi(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map(t=>vi(e,t)).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function yi(e){const t=gi(e);return Object.keys(t).map(e=>vi(e,t[e])).join("&")}const Si=globalThis.FormData;globalThis.File,globalThis.Blob;class Ii extends Error{constructor(e,t,r,n,i){super(e);const o=new.target.prototype;Object.setPrototypeOf(this,o),e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=i}}const wi={noCorsDomains:[],crossOriginNoCorsDomains:{},pendingNoCorsRequests:{}},Ei="ARCGIS_REST_JS_NO_CORS";globalThis[Ei]||(globalThis[Ei]=Object.assign({},wi));const bi=globalThis[Ei];function Ri(e){const t=new URL(e).origin;-1===bi.noCorsDomains.indexOf(t)&&bi.noCorsDomains.push(t)}function Ti(e){let t=!1;if(bi.noCorsDomains.length){const r=new URL(e).origin.toLowerCase();t=bi.noCorsDomains.some(e=>r.includes(e))}return t}const Ni="@esri/arcgis-rest-js";class Oi extends Ii{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",r,n,i){super(e,t,r,n,i),this.name="ArcGISAuthError",this.message="AUTHENTICATION_ERROR_CODE"===t?e:`${t}: ${e}`;const o=new.target.prototype;Object.setPrototypeOf(this,o)}retry(e,t=1){let r=0;const n=(i,o)=>{r+=1,e(this.url,this.options).then(e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return Ci(this.url,t)}).then(e=>{i(e)}).catch(e=>{"ArcGISAuthError"===e.name&&r<t?n(i,o):e.name===this.name&&e.message===this.message&&r>=t?o(this):o(e)})};return new Promise((e,t)=>{n(e,t)})}}function Ci(e,t){const r=globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}},n=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},r),t),{params:Object.assign(Object.assign({},r.params),t.params),headers:Object.assign(Object.assign({},r.headers),t.headers)}),{httpMethod:i,rawResponse:o}=n,s=Object.assign({f:"json"},n.params);let a=null;const l={method:i,signal:n.signal,credentials:n.credentials||"same-origin"};let c;if(Ti(e)&&(l.credentials="include"),n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(l.credentials="include"),"string"==typeof n.authentication){const e=n.authentication;c={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)},n.authentication.startsWith("AAPK")||n.authentication.startsWith("AAPT")||n.authentication.startsWith("AATK")||n.authentication.startsWith("AAST")||n.suppressWarnings||globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING||(u="Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.",console&&console.warn&&console.warn.apply(console,[u]),globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=!0)}else c=n.authentication;var u;const d=e;let h=!1;"undefined"!=typeof window&&(h=function(e,t){var r;if((t||window)&&e){const n=null===(r=(t=t||window).location)||void 0===r?void 0:r.origin;return e.startsWith(n)}return!1}(e));const p=!h&&function(e){let t=!1;if(Ti(e)){const r=new URL(e).origin.toLowerCase(),n=bi.crossOriginNoCorsDomains[r]||0;Date.now()-36e5>n&&(t=!0)}return t}(e);n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(l.credentials="include");let f=Promise.resolve();return p&&(l.credentials="include",f=function(e){const t=new URL(e);e=t.origin+t.pathname,t.search.includes("f=json")&&(e+="?f=json");const r=t.origin;return bi.pendingNoCorsRequests[r]||(bi.pendingNoCorsRequests[r]=fetch(e,{mode:"no-cors",credentials:"include",cache:"no-store"}).then(e=>{-1===bi.noCorsDomains.indexOf(r)&&bi.noCorsDomains.push(r),bi.crossOriginNoCorsDomains[r.toLowerCase()]=Date.now(),delete bi.pendingNoCorsRequests[r]}).catch(e=>(delete bi.pendingNoCorsRequests[r],Promise.reject(new Error(`no-cors request to ${r} failed`))))),bi.pendingNoCorsRequests[r]}(e)),f.then(()=>c?c.getToken(e).catch(t=>(t.url=e,t.options=n,a=t,Promise.resolve(""))):Promise.resolve("")).then(t=>{t.length&&(s.token=t),c&&c.getDomainCredentials&&(l.credentials=c.getDomainCredentials(e));const r={};if("GET"===l.method){s.token&&n.hideToken&&"undefined"==typeof window&&(r["X-Esri-Authorization"]=`Bearer ${s.token}`,delete s.token);const i=""===yi(s)?e:e+"?"+yi(s);n.maxUrlLength&&i.length>n.maxUrlLength||!n.maxUrlLength&&i.length>2e3||s.token&&n.hideToken?(l.method="POST",t.length&&n.hideToken&&(s.token=t,delete r["X-Esri-Authorization"])):e=i}const i=new RegExp("/items/.+/updateResources").test(e);return"POST"===l.method&&(l.body=function(e,t){const r=mi(e)||t,n=gi(e);if(r){const e=new Si;return Object.keys(n).forEach(t=>{if("undefined"!=typeof Blob&&n[t]instanceof Blob){const r=n.fileName||n[t].name||t;e.append(t,n[t],r)}else e.append(t,n[t])}),e}return yi(e)}(s,i)),l.headers=Object.assign(Object.assign({},r),n.headers),("undefined"==typeof window||window&&void 0===window.document)&&!l.headers.referer&&(l.headers.referer=Ni),mi(s)||i||(l.headers["Content-Type"]="application/x-www-form-urlencoded"),globalThis.fetch?globalThis.fetch(e,l):Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.Request}).then(({fetch:t})=>t(e,l))}).then(t=>{if(!t.ok)return t.json().then(r=>{const{status:i,statusText:o}=t,{message:s,details:a}=r.error,l=`${s}. ${a?a.join(" "):""}`.trim();throw new Ii(l,`HTTP ${i} ${o}`,r,e,n)}).catch(r=>{if("ArcGISRequestError"===r.name)throw r;const{status:i,statusText:o}=t;throw new Ii(o,`HTTP ${i}`,t,e,n)});if(o)return t;switch(s.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}}).then(t=>{if("json"!==s.f&&"geojson"!==s.f||o)return t;{const r=function(e,t,r,n,i){if(e.code>=400){const{message:r,code:i}=e;throw new Ii(r,i,e,t,n)}if(e.error){const{message:r,code:o,messageCode:s}=e.error,a=s||o||"UNKNOWN_ERROR_CODE";if(498===o||499===o)throw i||new Oi(r,a,e,t,n);throw new Ii(r,a,e,t,n)}if("failed"===e.status||"failure"===e.status){let r,i="UNKNOWN_ERROR_CODE";try{r=JSON.parse(e.statusMessage).message,i=JSON.parse(e.statusMessage).code}catch(t){r=e.statusMessage||e.message}throw new Ii(r,i,e,t,n)}return e}(t,d,0,n,a);if(t&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(e)&&Array.isArray(t.authorizedCrossOriginNoCorsDomains)&&t.authorizedCrossOriginNoCorsDomains.forEach(e=>{e=e.toLowerCase(),/^https?:\/\//.test(e)?Ri(e):(Ri("http://"+e),Ri("https://"+e))}),a){const t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+864e5)},a=null}return r}})}function Li(e,t={params:{f:"json"}}){const{request:r}=t,n=pi(t,["request"]);return r?r(e,n):Ci(e,n).catch(e=>e instanceof Oi&&t.authentication&&"string"!=typeof t.authentication&&t.authentication.canRefresh&&t.authentication.refreshCredentials?e.retry(()=>t.authentication.refreshCredentials(),1):Promise.reject(e))}var Ai,Di;!function(e){e.TOKEN_REFRESH_FAILED="TOKEN_REFRESH_FAILED",e.GENERATE_TOKEN_FOR_SERVER_FAILED="GENERATE_TOKEN_FOR_SERVER_FAILED",e.REFRESH_TOKEN_EXCHANGE_FAILED="REFRESH_TOKEN_EXCHANGE_FAILED",e.NOT_FEDERATED="NOT_FEDERATED",e.UNKNOWN_ERROR_CODE="UNKNOWN_ERROR_CODE"}(Ai||(Ai={}));class _i extends Error{constructor(e="UNKNOWN_ERROR",t=Ai.UNKNOWN_ERROR_CODE,r,n,i){super(e);const o=new.target.prototype;Object.setPrototypeOf(this,o),this.name="ArcGISTokenRequestError",this.message=`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=i}}class Pi extends Error{constructor(){super("The user has denied your authorization request.");const e=new.target.prototype;Object.setPrototypeOf(this,e),this.name="ArcGISAccessDeniedError"}}Error;function xi(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError",e.ArcGISAccessDeniedError="ArcGISAccessDeniedError",e.ArcGISTokenRequestError="ArcGISTokenRequestError"}(Di||(Di={}));const Mi=3e5;function ki(e,t){const r=t;return r.rawResponse=!1,Li(e,r).then(e=>{if("token"in e&&"expires"in e)return{token:e.token,username:t.params.username,expires:new Date(e.expires)};const r={token:e.access_token,username:e.username,expires:new Date(Date.now()+1e3*e.expires_in-Mi),ssl:!0===e.ssl};return e.refresh_token&&(r.refreshToken=e.refresh_token),e.refresh_token_expires_in&&(r.refreshTokenExpires=new Date(Date.now()+1e3*e.refresh_token_expires_in-Mi)),r})}class ji{constructor(e){this.portal=e.portal?xi(e.portal):"https://www.arcgis.com/sharing/rest",this._username=e.username}get username(){return this._username?this._username:this._user&&this._user.username?this._user.username:void 0}getUsername(){return this.username?Promise.resolve(this.username):this.getUser().then(e=>e.username)}getUser(e){if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);{const t=`${this.portal}/community/self`,r=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=Li(t,r).then(e=>(this._user=e,this._pendingUserRequest=null,e)),this._pendingUserRequest}}clearCachedUserInfo(){this._user=null}}function Fi(e){return!e||e.length<=0?{}:e.replace(/^#/,"").replace(/^\?/,"").split("&").reduce((e,t)=>{const{key:r,value:n}=function(e){const[t,r]=e.split("=");return{key:decodeURIComponent(t),value:decodeURIComponent(r)}}(t);return e[r]=n,e},{})}const Ui=/^https?:\/\/(\S+)\.arcgis\.com.+/;function Bi(e){return Ui.test(e)}function Vi(e){if(!Ui.test(e))return null;const t=e.match(Ui)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function Gi(e,t){const r=xi(function(e){if(!Ui.test(e))return e;switch(Vi(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=xi(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(r)}function $i(e,t=window){return!t&&window&&(t=window),t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function Hi(e){!e&&window&&(e=window);return $i(e.crypto.getRandomValues(new Uint8Array(32)))}function Wi(e,t,r){return"string"!=typeof t&&t?JSON.stringify(Object.assign({id:e},t)):JSON.stringify({id:e,originalUrl:r})}class zi extends ji{constructor(e){if(super(e),this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?xi(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.server=e.server,this.referer=e.referer,this.state=e.state,this.federatedServers={},this.trustedDomains=[],e.server){const t=this.getServerRootUrl(e.server);this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}get token(){return this._token}get tokenExpires(){return this._tokenExpires}get refreshToken(){return this._refreshToken}get refreshTokenExpires(){return this._refreshTokenExpires}get canRefresh(){return!(!this.username||!this.password)||!!(this.clientId&&this.refreshToken&&this.redirectUri)}static beginOAuth2(e,t){!t&&window&&(t=window);const{portal:r,provider:n,clientId:i,expiration:o,redirectUri:s,popup:a,popupWindowFeatures:l,locale:c,params:u,style:d,pkce:h,state:p}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",locale:"",style:"",pkce:!0},e),f=function(e,t){return"string"==typeof e?e:"object"==typeof e?e.id:Hi(t)}(p,t),m=`ARCGIS_REST_JS_AUTH_STATE_${i}`;t.localStorage.setItem(m,f);let g=`${xi(r)}/oauth2/authorize`;const v={client_id:i,response_type:h?"code":"token",expiration:o,redirect_uri:s,state:Wi(f,p,t.location.href),locale:c,style:d};let y;if("arcgis"!==n&&(g=`${xi(r)}/oauth2/social/authorize`,v.socialLoginProviderName=n,v.autoAccountCreateForSocial=!0),h){const e=Hi(t),r=`ARCGIS_REST_JS_CODE_VERIFIER_${i}`;t.localStorage.setItem(r,e),y=function(e,t=window){if(!t&&window&&(t=window),e&&t.isSecureContext&&t.crypto&&t.crypto.subtle){const r=(new t.TextEncoder).encode(e);return t.crypto.subtle.digest("SHA-256",r).then(e=>$i(new Uint8Array(e),t))}return Promise.resolve(null)}(e,t).then(function(t){v.code_challenge_method=t?"S256":"plain",v.code_challenge=t||e})}else y=Promise.resolve();return y.then(()=>(g=`${g}?${yi(v)}`,u&&(g=`${g}&${yi(u)}`),a?new Promise((e,n)=>{t.addEventListener(`arcgis-rest-js-popup-auth-${i}`,t=>{if("access_denied"===t.detail.error){const e=new Pi;return n(e),e}if(t.detail.errorMessage){const e=new Oi(t.detail.errorMessage,t.detail.error);return n(e),e}e(new zi({clientId:i,portal:r,ssl:t.detail.ssl,token:t.detail.token,tokenExpires:t.detail.expires,username:t.detail.username,refreshToken:t.detail.refreshToken,refreshTokenExpires:t.detail.refreshTokenExpires,redirectUri:s,state:t.detail.state}))},{once:!0}),t.open(g,"oauth-window",l),t.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-start"))}):void(t.location.href=g)))}static completeOAuth2(e,t){!t&&window&&(t=window);const{portal:r,clientId:n,popup:i,pkce:o,redirectUri:s}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",popup:!0,pkce:!0},e),a=`ARCGIS_REST_JS_AUTH_STATE_${n}`,l=t.localStorage.getItem(a),c=Fi(o?t.location.search.replace(/^\?/,""):t.location.hash.replace(/^#/,"")),u=c&&c.state?JSON.parse(c.state):void 0;function d(e,r,o){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:{error:r,errorMessage:e}})),void t.close()):(o&&t.history.replaceState(t.history.state,"",o),"access_denied"===r?Promise.reject(new Pi):Promise.reject(new Oi(e,r)))}function h(e,o){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:Object.assign(Object.assign({},e),{state:o})})),void t.close()):(o.originalUrl&&t.history.replaceState(t.history.state,"",o.originalUrl),new zi({clientId:n,portal:r,ssl:e.ssl,token:e.token,tokenExpires:e.expires,username:e.username,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,redirectUri:s||location.href.replace(location.search,""),state:o}))}if(!l||!u)return d("No authentication state was found, call `ArcGISIdentityManager.beginOAuth2(...)` to start the authentication process.","no-auth-state");if(u.id!==l)return d("Saved client state did not match server sent state.","mismatched-auth-state");if(c.error){const e=c.error;return d(c.error_description||"Unknown error",e,u.originalUrl)}if(o&&c.code){const e=xi(`${r}/oauth2/token/`),i=`ARCGIS_REST_JS_CODE_VERIFIER_${n}`,o=t.localStorage.getItem(i);return t.localStorage.removeItem(i),ki(e,{httpMethod:"POST",params:{client_id:n,code_verifier:o,grant_type:"authorization_code",redirect_uri:s||location.href.replace(location.search,""),code:c.code}}).then(e=>h(Object.assign(Object.assign({},e),u),u)).catch(e=>d(e.originalMessage,e.code,u.originalUrl))}return!o&&c.access_token?Promise.resolve(h(Object.assign({token:c.access_token,expires:new Date(Date.now()+1e3*parseInt(c.expires_in,10)),ssl:"true"===c.ssl,username:c.username},u),u)):d("Unknown error","oauth-error",u.originalUrl)}static fromParent(e,t){let r;return!t&&window&&(t=window),new Promise((n,i)=>{r=e=>{if(e.source===t.parent&&e.data)try{return n(zi.parentMessageHandler(e))}catch(e){return i(e)}},t.addEventListener("message",r,!1),t.parent.postMessage({type:"arcgis:auth:requestCredential"},e)}).then(e=>(t.removeEventListener("message",r,!1),e))}static authorize(e,t){const{portal:r,clientId:n,expiration:i,redirectUri:o,state:s}=Object.assign({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),a={client_id:n,expiration:i,response_type:"code",redirect_uri:o};s&&(a.state=s);const l=`${r}/oauth2/authorize?${yi(a)}`;t.writeHead(301,{Location:l}),t.end()}static exchangeAuthorizationCode(e,t){const{portal:r,clientId:n,redirectUri:i}=Object.assign({portal:"https://www.arcgis.com/sharing/rest"},e);return ki(`${r}/oauth2/token`,{params:{grant_type:"authorization_code",client_id:n,redirect_uri:i,code:t}}).then(e=>new zi({clientId:n,portal:r,ssl:e.ssl,redirectUri:i,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,token:e.token,tokenExpires:e.expires,username:e.username})).catch(e=>{throw new _i(e.message,Ai.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)})}static deserialize(e){const t=JSON.parse(e);return new zi({clientId:t.clientId,refreshToken:t.refreshToken,refreshTokenExpires:t.refreshTokenExpires?new Date(t.refreshTokenExpires):void 0,username:t.username,password:t.password,token:t.token,tokenExpires:t.tokenExpires?new Date(t.tokenExpires):void 0,portal:t.portal,ssl:t.ssl,tokenDuration:t.tokenDuration,redirectUri:t.redirectUri,server:t.server})}static fromCredential(e,t){const r=void 0===e.ssl||e.ssl,n=e.expires||Date.now()+72e5;return t.hasServer?new zi({server:e.server,ssl:r,token:e.token,username:e.userId,tokenExpires:new Date(n)}):new zi({portal:xi(e.server.includes("sharing/rest")?e.server:e.server+"/sharing/rest"),ssl:r,token:e.token,username:e.userId,tokenExpires:new Date(n)})}static parentMessageHandler(e){if("arcgis:auth:credential"===e.data.type){const t=e.data.credential;return function(e){return"string"==typeof e.userId||"number"==typeof e.expires}(t)?zi.fromCredential(t,{hasPortal:!0,hasServer:!1,server:t.server}):new zi(t)}if("arcgis:auth:error"===e.data.type){const t=new Error(e.data.error.message);throw t.name=e.data.error.name,t}throw new Error("Unknown message type.")}static destroy(e){return function(e){const t=`${xi(e.portal||"https://www.arcgis.com/sharing/rest")}/oauth2/revokeToken/`,r=e.token,n=e.clientId;delete e.portal,delete e.clientId,delete e.token;const i=Object.assign(Object.assign({},e),{httpMethod:"POST",params:{client_id:n,auth_token:r}});return Li(t,i).then(e=>{if(!e.success)throw new Ii("Unable to revoke token",500,e,t,i);return e})}({clientId:e.clientId,portal:e.portal,token:e.refreshToken||e.token})}static fromToken(e){const t=new zi(e);return t.getUser().then(()=>t)}static signIn(e){const t=new zi(e);return t.getUser().then(()=>t)}toCredential(){return{expires:this.tokenExpires.getTime(),server:this.server||this.portal,ssl:this.ssl,token:this.token,userId:this.username}}getPortal(e){if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);{const t=`${this.portal}/portals/self`,r=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=Li(t,r).then(e=>(this._portalInfo=e,this._pendingPortalRequest=null,e)),this._pendingPortalRequest}}getToken(e,t){return function(e,t){const r=Bi(e),n=Bi(t),i=Vi(e),o=Vi(t);return!(!r||!n||i!==o)}(this.portal,e)||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)}validateAppAccess(e){return this.getToken(this.portal).then(t=>function(e,t,r="https://www.arcgis.com/sharing/rest"){return Li(`${r}/oauth2/validateAppAccess`,{method:"POST",params:{f:"json",client_id:t,token:e}})}(t,e))}toJSON(){return{type:"ArcGISIdentityManager",clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires||void 0,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires||void 0,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,server:this.server}}serialize(){return JSON.stringify(this)}enablePostMessageAuth(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)}disablePostMessageAuth(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)}refreshCredentials(e){return this.clearCachedUserInfo(),this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new _i("Unable to refresh token. No refresh token or password present.",Ai.TOKEN_REFRESH_FAILED))}getServerRootUrl(e){const[t]=xi(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/),[r,n,i]=t.match(/(https?:\/\/)(.+)/),[o,...s]=i.split("/");return`${n}${o.toLowerCase()}/${s.join("/")}`}getDomainCredentials(e){return this.trustedDomains&&this.trustedDomains.length?(e=e.toLowerCase(),this.trustedDomains.some(t=>e.startsWith(t.toLowerCase()))?"include":"same-origin"):"same-origin"}signOut(){return zi.destroy(this)}createPostMessageHandler(e){return t=>{const r=e.indexOf(t.origin)>-1,n="arcgis:auth:requestCredential"===t.data.type,i=this.tokenExpires.getTime()>Date.now();if(r&&n){let e={};if(i){const t=this.toCredential();t.server=t.server.replace("/sharing/rest",""),e={type:"arcgis:auth:credential",credential:t}}else e={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Token was expired, and not returned to the child application"}};t.source.postMessage(e,t.origin)}}}getTokenForServer(e,t){const r=this.getServerRootUrl(e),n=this.federatedServers[r];return n&&n.expires&&n.expires.getTime()>Date.now()?Promise.resolve(n.token):(this._pendingTokenRequests[r]||(this._pendingTokenRequests[r]=this.fetchAuthorizedDomains().then(()=>Li(`${r}/rest/info`,{credentials:this.getDomainCredentials(e)}).then(n=>{if(n.owningSystemUrl){if(Gi(n.owningSystemUrl,this.portal))return Li(`${n.owningSystemUrl}/sharing/rest/info`,t);throw new _i(`${e} is not federated with ${this.portal}.`,Ai.NOT_FEDERATED)}if(n.authInfo&&void 0!==this.federatedServers[r])return Promise.resolve({authInfo:n.authInfo});throw new _i(`${e} is not federated with any portal and is not explicitly trusted.`,Ai.NOT_FEDERATED)}).then(e=>this.token&&this.tokenExpires.getTime()<Date.now()?this.server?this.refreshCredentials().then(()=>({token:this.token,expires:this.tokenExpires})):this.refreshCredentials().then(()=>this.generateTokenForServer(e.authInfo.tokenServicesUrl,r)):this.generateTokenForServer(e.authInfo.tokenServicesUrl,r)).then(e=>(this.federatedServers[r]=e,delete this._pendingTokenRequests[r],e.token)))),this._pendingTokenRequests[r])}generateTokenForServer(e,t){return Li(e,{params:{token:this.token,serverUrl:t,expiration:this.tokenDuration}}).then(e=>({token:e.token,expires:new Date(e.expires-3e5)})).catch(e=>{throw new _i(e.message,Ai.GENERATE_TOKEN_FOR_SERVER_FAILED,e.response,e.url,e.options)})}getFreshToken(e){return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshCredentials(e).then(()=>(this._pendingTokenRequests[this.portal]=null,this.token))),this._pendingTokenRequests[this.portal])}refreshWithUsernameAndPassword(e){const t={username:this.username,password:this.password,expiration:this.tokenDuration,client:"referer",referer:this.referer?this.referer:"undefined"!=typeof window&&void 0!==window.document&&window.location&&window.location.origin?window.location.origin:Ni};return(this.server?Li(`${this.getServerRootUrl(this.server)}/rest/info`).then(r=>Li(r.authInfo.tokenServicesUrl,Object.assign({params:t},e))):Li(`${this.portal}/generateToken`,Object.assign({params:t},e))).then(e=>(this.updateToken(e.token,new Date(e.expires)),this)).catch(e=>{throw new _i(e.message,Ai.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)})}refreshWithRefreshToken(e){if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()-864e5<Date.now())return this.exchangeRefreshToken(e);const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return ki(`${this.portal}/oauth2/token`,t).then(e=>this.updateToken(e.token,e.expires)).catch(e=>{throw new _i(e.message,Ai.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)})}updateToken(e,t){return this._token=e,this._tokenExpires=t,this}exchangeRefreshToken(e){const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return ki(`${this.portal}/oauth2/token`,t).then(e=>(this._token=e.token,this._tokenExpires=e.expires,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this)).catch(e=>{throw new _i(e.message,Ai.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)})}fetchAuthorizedDomains(){return this.server||!this.portal?Promise.resolve(this):this.getPortal().then(e=>(e.authorizedCrossOriginDomains&&e.authorizedCrossOriginDomains.length&&(this.trustedDomains=e.authorizedCrossOriginDomains.filter(e=>!e.startsWith("http://")).map(e=>e.startsWith("https://")?e:`https://${e}`)),this))}}function qi(e){return console.log("DEPRECATED:, 'UserSession' is deprecated. Use 'ArcGISIdentityManager' instead."),new zi(e)}var Ji;qi.beginOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.beginOAuth2' is deprecated. Use 'ArcGISIdentityManager.beginOAuth2' instead."),zi.beginOAuth2(...e)},qi.completeOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.completeOAuth2()' is deprecated. Use 'ArcGISIdentityManager.completeOAuth2()' instead."),e.length<=1&&console.warn("WARNING:, 'UserSession.completeOAuth2()' is now async and returns a promise the resolves to an instance of `ArcGISIdentityManager`."),zi.completeOAuth2(...e)},qi.fromParent=function(...e){return console.warn("DEPRECATED:, 'UserSession.fromParent' is deprecated. Use 'ArcGISIdentityManager.fromParent' instead."),zi.fromParent(...e)},qi.authorize=function(...e){return console.warn("DEPRECATED:, 'UserSession.authorize' is deprecated. Use 'ArcGISIdentityManager.authorize' instead."),zi.authorize(...e)},qi.exchangeAuthorizationCode=function(...e){return console.warn("DEPRECATED:, 'UserSession.exchangeAuthorizationCode' is deprecated. Use 'ArcGISIdentityManager.exchangeAuthorizationCode' instead."),zi.exchangeAuthorizationCode(...e)},qi.fromCredential=function(...e){return console.log("DEPRECATED:, 'UserSession.fromCredential' is deprecated. Use 'ArcGISIdentityManager.fromCredential' instead."),console.warn("WARNING:, 'UserSession.fromCredential' now requires a `ServerInfo` object from the JS API as a second parameter."),zi.fromCredential(...e)},qi.deserialize=function(...e){return console.log("DEPRECATED:, 'UserSession.deserialize' is deprecated. Use 'ArcGISIdentityManager.deserialize' instead."),zi.deserialize(...e)},function(e){e.Success="Succeeded",e.Failed="Failed",e.Waiting="Waiting",e.Cancelled="Cancelled",e.Cancelling="Cancelling",e.New="New",e.Executing="Executing",e.Submitted="Submitted",e.Failure="Failure",e.TimedOut="TimedOut",e.Error="Error",e.Status="Etatus",e.Unknown="Unknown"}(Ji||(Ji={}));var Ki=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const Yi={},Xi={};function Qi(e){return Ki(this,void 0,void 0,function*(){if(Xi[e])return Xi[e];let t=[];const r=En.getInstance().getExtensions(vn.DependencyDefine).filter(t=>t.getDependencyKey()===e)[0];if(r)t=t.concat(r.getResources());else{if(!/^http/.test(e))return console.error("Unknown dependency.",e),Promise.reject(Error(`Unknown dependency: ${e}.`));t.push({url:e})}const n=[];return t.forEach(e=>{Yi[e.url]?n.push(Yi[e.url]):n.push(eo(e))}),Xi[e]=Promise.all(n).then(e=>{if(null==r?void 0:r.postInit)return r.postInit()})})}function Zi(e){return Ki(this,void 0,void 0,function*(){return e.reduce((e,t)=>Ki(this,void 0,void 0,function*(){return e.then(()=>Ki(this,void 0,void 0,function*(){return Qi(t)}))}),Qi(e[0]))})}function eo(e){return Ki(this,void 0,void 0,function*(){if(e.dependencies&&e.dependencies.length>0)return Promise.all(e.dependencies.map(e=>Ki(this,void 0,void 0,function*(){return eo(e)}))).then(()=>Ki(this,void 0,void 0,function*(){return delete e.dependencies,eo(e)}));const t=e.url;return Yi[e.url]=Cl(t),Yi[e.url]})}var to=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function ro(e){return to(this,void 0,void 0,function*(){return yield Qi("jimu-arcgis"),yield function(e,t){return Nl(this,void 0,void 0,function*(){return yield Promise.all(e.map(e=>Nl(this,void 0,void 0,function*(){return yield Cl(e,t)})))})}(e)})}function no(e,t){return Li(io(e,t),Object.assign({httpMethod:"GET"},t))}const io=(e,t)=>`${"string"==typeof t?t:function(e={}){return e.portal?xi(e.portal):e.authentication&&"string"!=typeof e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}(t)}/content/items/${e}`;var oo=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};let so={};function ao(e,t=!1){const r=pa.getInstance(),n=r.handleAuthError.bind(r);return function(e,t=!1){e=ei(e);const r=pa.getInstance(),n=r.getSessionByUrl(e);so[e]&&!t||(so[e]=Li(`${Yn(e)}/portals/self`,{authentication:n,httpMethod:"GET",params:{f:"json",culture:window.locale}}).then(e=>e));return so[e]}(e,t).then(t=>{if(!t.isPortal){const n=`https://${t.urlKey}.${t.customBaseUrl}`;t.urlKey&&!Qn(e,n)&&Ya().dispatch((r={portalUrl:n},{type:ja.SetPortalInfo,portalInfo:r}))}var r;return Ya().dispatch(function(e){return{type:ja.SetPortalSelf,portalSelf:e}}(t)),t}).catch(e=>{n(e,!1)})}const lo={};function co(e=function(e){var t;e||(e=window.location);const r=null===(t=Ya().getState().appRuntimeInfo)||void 0===t?void 0:t.noPermissionPages;if(window.jimuConfig.useStructuralUrl)return vl(e.pathname,Ya().getState().appConfig,r);{const t=X.parse(e.search);return{appId:t.id,pageId:yl(t.page,Ya().getState().appConfig,r)}}}().appId,t){return lo[e]&&!t||(window.jimuConfig.isDevEdition?lo[e]=function(e){return oo(this,void 0,void 0,function*(){return yield window.fetch(`${window.jimuConfig.mountPath}apps/${e}/info.json`).then(e=>oo(this,void 0,void 0,function*(){return yield e.json()})).then(e=>Object.assign(Object.assign({},e),{name:e.title}))})}(e):lo[e]=function(e){return oo(this,void 0,void 0,function*(){const t=pa.getInstance(),r=t.getMainSession(),n=(null==r?void 0:r.portal)||Ya().getState().portalUrl,i=yield ao(n),o=i.isPortal?n:i.urlKey?`https://${i.urlKey}.${i.customBaseUrl}`:n;return yield no(e,{portal:Yn(o),authentication:t.getSessionByUrl(n)}).then(e=>Object.assign(Object.assign({},e),{name:e.title})).catch(e=>"CONT_0001"===e.code?Promise.reject(e):Promise.reject({}))})}(e)),lo[e]}var uo,ho,po,fo,mo,go,vo,yo,So,Io,wo,Eo,bo,Ro,To;!function(e){e.Page="pages",e.Dialog="dialogs",e.Header="header",e.Footer="footer",e.View="views",e.ScreenPanel="screens_panel",e.ScreenMain="screens_main"}(uo||(uo={})),function(e){e.Page="pages",e.View="view",e.Widget="widget",e.Screen="screen",e.Dialog="dialog",e.Header="header",e.Footer="footer"}(ho||(ho={})),function(e){e[e.Row=0]="Row",e[e.Column=1]="Column",e[e.Tab=2]="Tab",e[e.Plain=3]="Plain"}(po||(po={})),function(e){e.Fade="FADE",e.Cover="COVER",e.Push="PUSH"}(fo||(fo={})),function(e){e.Top="TOP",e.Upper="UPPER",e.Lower="LOWER",e.Bottom="BOTTOM"}(mo||(mo={})),function(e){e.Normal="NORMAL",e.Folder="FOLDER",e.Link="LINK"}(go||(go={})),function(e){e.FitWindow="FIT_WINDOW",e.AutoScroll="AUTO_SCROLL"}(vo||(vo={})),function(e){e.Fixed="FIXED",e.Anchored="ANCHORED"}(yo||(yo={})),function(e){e.NoButton="NO_BUTTON",e.ButtonInline="BUTTON_INLINE",e.ButtonBlock="BUTTON_BLOCK"}(So||(So={})),function(e){e.TopLeft="TOP_LEFT",e.TopRight="TOP_RIGHT",e.BottomLeft="BOTTOM_LEFT",e.BottomRight="BOTTOM_RIGHT",e.TopCenter="TOP_CENTER",e.BottomCenter="BOTTOM_CENTER",e.MiddleLeft="MIDDLE_LEFT",e.MiddleRight="MIDDLE_RIGHT",e.MiddleCenter="MIDDLE_CENTER"}(Io||(Io={})),function(e){e.CSV="CSV",e.JSON="JSON",e.GeoJSON="GeoJSON",e.Item="Item",e.Shapefile="Shapefile",e.FileGDB="FGDB",e.KML="KML"}(wo||(wo={})),function(e){e.GeoEnrichment="GEOENRICH",e.Geometry="GEOMETRY",e.GeoCoding="GEOCODING",e.Printing="PRINTING",e.Routing="ROUTING",e.GPServer="GPSERVER",e.GPTask="GPTask"}(Eo||(Eo={})),function(e){e.Device="DEVICE",e.Specific="SPECIFIC",e.Data="DATA"}(bo||(bo={})),function(e){e.Required="REQUIRED",e.Optional="OPTIONAL"}(Ro||(Ro={})),function(e){e.Horizontal="HORIZONTAL",e.Vertical="VERTICAL"}(To||(To={}));var No,Oo,Co=m(68972);!function(e){e.Unkown="UNKNOWN",e.Widget="WIDGET",e.Section="SECTION",e.ScreenGroup="SCREEN_GROUP"}(No||(No={})),function(e){e.FixedLayout="FIXED",e.FlowLayout="FLOW",e.GridLayout="GRID",e.ColumnLayout="COLUMN",e.RowLayout="ROW",e.AccordionLayout="ACCORDION",e.FlexRowLayout="FLEX_ROW"}(Oo||(Oo={}));Co.createContext({isInView:!1,isInCurrentView:!1}),Co.createContext(!0);function Lo(e){const t={};return/^http(s)?:\/\//.test(e)||/^\/\//.test(e)?(t.isRemote=!0,t.folderUrl=e):(t.isRemote=!1,t.folderUrl=`${window.location.protocol}//${window.location.host}${Tl()}${e}`),t}function Ao(e,t){t.icon=t.icon?t.icon:t.context.folderUrl+"icon.svg",t.label=t.label?t.label:function(e,t,r){const n=function(e){return"y"===e.charAt(e.length-1)?`${e.slice(0,e.length-1)}ies`:`${e}s`}(t);let[i,o]=Do(r);if(!e[n])return null===o?r:`${r} ${o+1}`;Object.keys(e[n]).filter(t=>{const i=Do(e[n][t].label)[0];return r===i}).forEach(t=>{let r=Do(e[n][t].label)[1];r=null===r?1:r,o=Math.max(o,r)});return null===o?i:`${i} ${o+1}`}(e,"widget",t.manifest?t.manifest.i18nMessages._widgetLabel||t.manifest.label||t.manifest.name:"")}function Do(e){if(!e)return[e,null];const t=e.lastIndexOf(" "),r=e.substring(t+1);let n,i;return/^\d+$/.test(r)?(n=e.substring(0,t),i=parseInt(r)):(n=e,i=null),[n,i]}function _o(){var e,t;const r=(null===(e=null===window||void 0===window?void 0:window.jimuConfig)||void 0===e?void 0:e.isBuilder)?Ya().getState().appStateInBuilder:Ya().getState(),n=(null===(t=null==r?void 0:r.appConfig)||void 0===t?void 0:t.connections)||[],i=n.length,o=n.map(e=>{const t=Object.assign({},e);return(r=e.portalUrl,n=e.clientId,fetch(`${r}/sharing/rest/oauth2/token?client_id=${n}&client_secret=invalid_secret&grant_type=client_credentials`).then(e=>e.json()).then(e=>{var t;return"invalid_client_id"!==(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.error)}).catch(e=>!1)).then(e=>(e||(t.clientId=null),t));var r,n});Promise.allSettled(o).then(e=>{let t=null==r?void 0:r.appConfig;const n=[];e.forEach(e=>{var t;(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.clientId)&&n.push(e.value)}),i!==n.length&&(t=t.set("connections",n),il(t))})}function Po(e){var t;const r=window.jimuConfig.isBuilder?Ya().getState().appStateInBuilder:Ya().getState();return((null===(t=null==r?void 0:r.appConfig)||void 0===t?void 0:t.connections)||[]).find(t=>"portal"===t.type&&Qn(e,null==t?void 0:t.portalUrl))}function xo(e,t,r){var n,i;const o=e&&t&&r&&{type:"portal",portalUrl:e,clientId:t,portalVersion:r};if(!o)return;const s=window.jimuConfig.isBuilder?Ya().getState().appStateInBuilder:Ya().getState();let a=(null===(n=null==s?void 0:s.appConfig)||void 0===n?void 0:n.connections)||[];const l=Po(e);if(!(l&&(c=l,u=o,c&&u&&c.type===u.type&&c.clientId===u.clientId&&c.portalVersion===u.portalVersion&&Qn(c.portalUrl,u.portalUrl)))){a=l?a.filter(t=>t.portalUrl!==e):a;const t=null===(i=null==s?void 0:s.appConfig)||void 0===i?void 0:i.set("connections",a.concat([o]));if(window.jimuConfig.isBuilder){Ol("jimu-for-builder").builderAppSync.publishAppConfigChangeToApp(t)}else Ya().dispatch(Fa(t))}var c,u}function Mo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var ko=function e(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=Mo({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var s in i)i[s]&&(o+="; "+s,!0!==i[s]&&(o+="="+i[s].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+o}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var o=r[i].split("="),s=o.slice(1).join("=");try{var a=decodeURIComponent(o[0]);if(n[a]=t.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",Mo({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Mo({},this.attributes,t))},withConverter:function(t){return e(Mo({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const jo={loading:"Loading",apply:"Apply",ok:"OK",publish:"Publish",cancel:"Cancel",yes:"Yes",no:"No",open:"Open",close:"Close",new:"New",classic:"Classic",widgetLoadError:"The widget could not be loaded due to an unexpected error.",notPublishError:"This item is not published. Please open this item in Experience Builder, then click <b>&nbsp;Publish&nbsp;</b> to publish it.",versionUpdateMsg:"New updates are available. Click Reload to get the latest updates.",userLocaleChangeMsg:"The user locale has changed. Click Reload to refresh the page.",doUpdate:"Reload",search:"Search",delete:"Delete",about:"About",failed:"Failed",continue:"Continue",neverUnsupportedBrowserTitle:"Unsupported browser",neverUnsupportedBrowserOnlineContent:"You are using a browser that is not supported by [ArcGIS Experience Builder]. Please use the latest version of <chrome-link>Google Chrome</chrome-link>, <firefox-link>Mozilla Firefox</firefox-link>, <safari-link>Apple Safari</safari-link>, or <edge-link>Microsoft Edge</edge-link>. Provide your feedback through <feedback-link>GeoNet, the Esri Community</feedback-link>.",neverUnsupportedBrowserEnterpriseContent:"You are using a browser that is not supported [ArcGIS Experience Builder]. Please use the latest version of <chrome-link>Google Chrome</chrome-link>, <firefox-link>Mozilla Firefox</firefox-link>, <safari-link>Apple Safari</safari-link>, or <edge-link>Microsoft Edge</edge-link>.",message_StringSelectionChange:"String selection changes",message_ExtentChange:"Extent changes",message_DataSourceFilterChange:"Data filtering changes",message_DataRecordsSelectionChange:"Record selection changes",message_DataRecordSetChange:"Records created",message_DataSourcesChange:"Data added",message_SelectDataRecord:"Select data record",message_LocationChange:"Location change",message_ButtonClick:"Button click",message_ViewChange:"Views change",actions:"Actions",noActions:"No available actions",selectedData:"Selected ({count})",allData:"All data ({count})",allDataWithoutCount:"All data",loadedData:"Loaded ({count})",currentData:"Current",export:"Export",exportAll:"Export all",exportSelected:"Export selected",exportingData:"Exporting: {name}",failedToExport:"Failed to export {name}",viewItem:"View item:",largeWarningTitle:"Are you sure you want to export all data records? ",largeWarningContent:"Exporting this large dataset will take time.",tooLargeWarningTitle:"You can only export the first {max} records.",tooLargeWarningContent:"Dataset export is limited to the first {max} records.",dataAction_ExportJson:"Export to JSON",dataAction_ExportCSV:"Export to CSV",dataAction_ExportGeoJson:"Export to GeoJSON",dataAction_ExportItem:"Export to Item",dataAction_ExportShp:"Export to Shapefile",dataAction_ExportGDB:"Export to FGDB",dataAction_ExportKML:"Export to KML",dataAction_SetFilter:"Set filter",dataAction_DataStatistics:"Calculate statistics",dataAction_RelatedData:"View related data",selectionMode:"Selection mode",selectionModeSingle:"Single",selectionModeMultiple:"Multiple",showMore:"Show More",pleaseSelectAField:"Please select a field",countLabel:"Number of values",countEmptyLabel:"Number of empty values",sumLabel:"Sum of values",minLabel:"Minimum",maxLabel:"Maximum",avgLabel:"Average",stddevLabel:"Standard deviation",error:"Error",messageAction_SelectDataRecord:"Select data records",messageAction_FilterDataRecord:"Filter data records",messageAction_TriggerData:"Trigger data",messageAction_ChangeView:"Open view",action_addedData:"Added: {label}",icon:"Icon",verySmall:"Very small",small:"Small",low:"Low",high:"High",large:"Large",varyLarge:"Very large",extraLarge:"Extra large",short:"Short",medium:"Medium",long:"Long",full:"Full",experience:"Experience",template:"Template",widget:"Widget",section:"Section",view:"View",page:"Page",dialog:"Window",makeHome:"Make homepage",makeSplash:"Set as splash",pageWindowSelect:"Switch page and window",layout:"Layout",theme:"Theme",dataSource:"Data source",block:"Block",screenGroup:"Screen group",screen:"Screen",grid:"Grid",locationReferencing:"Location Referencing",dialogConfirmationDefaultText:"I agree to the above terms and conditions",dialogPreventDisplayAgainDefaultText:"Don't show this again",page404Error:"404 \u2014 Page not found{br}The page you\u2019re looking for doesn\u2019t exist or has been moved.",goToHomePage:"Go to home page",publicUserError:"Public Account user cannot access this application.",noEditPrivilegesError:"Your account does not have permission to create or modify data.",noEditContentPrivilegesError:"Your account does not have permission to create or modify content.",essentialAppsLicenseErrorForApp:"Your account is not licensed to use an app that is not public. Please ask your organization administrator to assign you a user type that includes Essential Apps or an add-on Essential Apps license.",essentialAppsLicenseErrorForBuilder:"Your account is not licensed for Experience Builder. Please ask your organization administrator to assign you a user type that includes Essential Apps or an add-on Essential Apps license.",roleError:"Experience Builder Developer Edition requires a level 2 ArcGIS account to work. Please login with an account that has level 2 privileges.",roleError2:"Experience Builder Developer Edition requires an ArcGIS organization account with a user type that includes privileges to create content.",invalidResourceExperience:"This is not a supported item.",invalidResourceItem:"Item does not exist or is inaccessible.",invalidResourcePermission:"Sorry, you do not have permissions to access this application.",invalidResourcePermissionForReadOnly:"Sorry, you only have view permission to this application.",dataSourceCreateError:"Data is inaccessible.",blockedByAdminErrorForApp:"Your organization has blocked access to this application. Please contact your administrator for details.",blockedByAdminErrorForBuilder:"Your organization has blocked access to Experience Builder. Please contact your administrator for details.",readOnlyModeError:"ArcGIS Online is experiencing operational issues and has temporarily switched to read-only mode. Some capabilities may be limited. For the latest updates on when this will be resolved, visit the {link}.",readOnlyModeErrorLink:"ArcGIS Online Health Dashboard",goToAnotherExperienceBtn:"Go to another experience",switchAccountBtn:"Switch account",switch:"Switch",pageRestrictionError:"Sorry, you do not have permissions to access this page.",homepageRestrictionWarning:"There is a visibility restriction set to this page. Please review it carefully in Privacy and security settings.",administrator:"Administrator",publisher:"Publisher",user:"User",signInErrorDefault:"Sorry, you do not have permission to access this resource.",signInErrorsDefault:"Sorry, you do not have permission to access ({names}).",signInErrorEnterCredential:"Sorry, you do not have permission to access this resource. Click to enter credential.",signInErrorCannotEnterCredential:"Sorry, your current account does not have permission to access this resource.",signInErrorTryAgain:"Sorry, you do not have permission to access this resource. Please try again.",signInErrorInvalidToken:"Invalid credential. Please login again.",signInBannerListWarning:"Sorry, you don\u2019t have access to the resources from the following servers or organizations. Click Sign in to provide credentials. Click Ignore to avoid loading the resource until you refresh the app.",signInBannerIgnore:"Ignore",signInBannerIgnoreAll:"Ignore all",signInBannerTitle:"Credential banner",restoreState:"Restore experience state",restoreStateTips:"Restore the state of page, view, window, map viewpoint, and layer visibility where you left off.",restoreStateAccept:"Accept",upgradedFrom:"Upgraded from previous config",versionIsHigh:"Oops.. It seems this experience is built with a higher version of ArcGIS Experience Builder. Please upgrade to the latest version to view.",badVersion:"Oops.. It seems the version of this experience is incorrect. Please check its configuration file.",setClientIdMessage1:"This service is hosted on an ArcGIS Enterprise that the Experience Builder not registered with. Please provide Client ID to {register} first.",registerText:"register",arcgisEnterpriseText:"ArcGIS Enterprise",setClientIdMessage2:"Provide the Client ID for Experience Builder registered in the ArcGIS Enterprise you specify above",experienceVersionRemind:"This experience is in higher version. Incompatible contents may not work.",templateVersionRemind:"This template is in higher version. Incompatible contents may not work.",publishedExperienceVersionRemind:"The published version of this experience is in higher version. Incompatible contents may not work.",publishedTemplateVersionRemind:"The published version of this template is in higher version. Incompatible contents may not work.",draftTemplateVersionRemind:"The draft version of this template is in higher version. Incompatible contents may not work.",draftExperienceVersionRemind:"The draft version of this experience is in higher version. Incompatible contents may not work.",featureLayer:"Feature Layer",featureSet:"Feature Set",featureService:"Feature Service",mapService:"Map Service",groupLayer:"Group Layer",map:"Map",simpleLocal:"Simple Local",webMap:"Web Map",webScene:"Web Scene",csv:"CSV",sceneService:"Scene Service",sceneLayer:"Scene Layer",imageryLayer:"Imagery Layer",imageryTileLayer:"Tiled Imagery Layer",elevationLayer:"Elevation layer",rasterLayer:"Raster Layer",orientedImageryLayer:"Oriented Imagery Layer",SubtypeGroupLayer:"Subtype Group Layer",SubtypeSublayer:"Subtype Sublayer",vectorTileService:"Vector Tile Service",wfsLayer:"WFS Layer",wmsLayer:"WMS Layer",wmtsLayer:"WMTS Layer",kml:"KML",geojson:"GeoJSON",outputView:"{dataSourceLabel} output view",buildingScene:"Building Scene Layer",buildingGroup:"Building Group Sublayer",buildingComponent:"Building Component Sublayer",json:"JSON",exportItem:"Item",import:"Import",a11ySkipTo:"Skip to",a11ySkipToContent:"Skip to {content}"};class Fo{constructor(){this._status="pending",this._promise=new Promise((e,t)=>{this._resolver=e,this._rejecter=t})}resolve(e){return this._status="resolved",this._resolver(e)}reject(e){return this._status="rejected",this._rejecter(e)}get status(){return this._status}get promise(){return this._promise}}const Uo=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e};const Bo=function(e,t,r){"__proto__"==t&&Hn?Hn(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Vo=Object.prototype.hasOwnProperty;const Go=function(e,t,r){var n=e[t];Vo.call(e,t)&&he(n,r)&&(void 0!==r||t in e)||Bo(e,t,r)};const $o=function(e,t,r,n){var i=!r;r||(r={});for(var o=-1,s=t.length;++o<s;){var a=t[o],l=n?n(r[a],e[a],a,r,e):void 0;void 0===l&&(l=e[a]),i?Bo(r,a,l):Go(r,a,l)}return r};const Ho=function(e,t){return e&&$o(t,Tr(t),e)};const Wo=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t};var zo=Object.prototype.hasOwnProperty;const qo=function(e){if(!Fe(e))return Wo(e);var t=Sr(e),r=[];for(var n in e)("constructor"!=n||!t&&zo.call(e,n))&&r.push(n);return r};const Jo=function(e){return Rr(e)?vr(e,!0):qo(e)};const Ko=function(e,t){return e&&$o(t,Jo(t),e)};var Yo="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xo=Yo&&"object"==typeof module&&module&&!module.nodeType&&module,Qo=Xo&&Xo.exports===Yo?Oe.Buffer:void 0,Zo=Qo?Qo.allocUnsafe:void 0;const es=function(e,t){if(t)return e.slice();var r=e.length,n=Zo?Zo(r):new e.constructor(r);return e.copy(n),n};const ts=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};const rs=function(e,t){return $o(e,Ht(e),t)};const ns=Ir(Object.getPrototypeOf,Object);const is=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)jt(t,Ht(e)),e=ns(e);return t}:Vt;const os=function(e,t){return $o(e,is(e),t)};const ss=function(e){return Ut(e,Jo,is)};var as=Object.prototype.hasOwnProperty;const ls=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&as.call(e,"index")&&(r.index=e.index,r.input=e.input),r};const cs=function(e){var t=new e.constructor(e.byteLength);return new Dt(t).set(new Dt(e)),t};const us=function(e,t){var r=t?cs(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)};var ds=/\w*$/;const hs=function(e){var t=new e.constructor(e.source,ds.exec(e));return t.lastIndex=e.lastIndex,t};var ps=Ce?Ce.prototype:void 0,fs=ps?ps.valueOf:void 0;const ms=function(e){return fs?Object(fs.call(e)):{}};const gs=function(e,t){var r=t?cs(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};const vs=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return cs(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return us(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return gs(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return hs(e);case"[object Symbol]":return ms(e)}};var ys=Object.create;const Ss=function(){function e(){}return function(t){if(!Fe(t))return{};if(ys)return ys(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();const Is=function(e){return"function"!=typeof e.constructor||Sr(e)?{}:Ss(ns(e))};const ws=function(e){return zt(e)&&"[object Map]"==Hr(e)};var Es=pr&&pr.isMap;const bs=Es?cr(Es):ws;const Rs=function(e){return zt(e)&&"[object Set]"==Hr(e)};var Ts=pr&&pr.isSet;const Ns=Ts?cr(Ts):Rs;var Os="[object Arguments]",Cs="[object Function]",Ls="[object Object]",As={};As[Os]=As["[object Array]"]=As["[object ArrayBuffer]"]=As["[object DataView]"]=As["[object Boolean]"]=As["[object Date]"]=As["[object Float32Array]"]=As["[object Float64Array]"]=As["[object Int8Array]"]=As["[object Int16Array]"]=As["[object Int32Array]"]=As["[object Map]"]=As["[object Number]"]=As[Ls]=As["[object RegExp]"]=As["[object Set]"]=As["[object String]"]=As["[object Symbol]"]=As["[object Uint8Array]"]=As["[object Uint8ClampedArray]"]=As["[object Uint16Array]"]=As["[object Uint32Array]"]=!0,As["[object Error]"]=As[Cs]=As["[object WeakMap]"]=!1;const Ds=function e(t,r,n,i,o,s){var a,l=1&r,c=2&r,u=4&r;if(n&&(a=o?n(t,i,o,s):n(t)),void 0!==a)return a;if(!Fe(t))return t;var d=Ft(t);if(d){if(a=ls(t),!l)return ts(t,a)}else{var h=Hr(t),p=h==Cs||"[object GeneratorFunction]"==h;if(nr(t))return es(t,l);if(h==Ls||h==Os||p&&!o){if(a=c||p?{}:Is(t),!l)return c?os(t,Ko(a,t)):rs(t,Ho(a,t))}else{if(!As[h])return o?t:{};a=vs(t,h,l)}}s||(s=new bt);var f=s.get(t);if(f)return f;s.set(t,a),Ns(t)?t.forEach(function(i){a.add(e(i,r,n,i,t,s))}):bs(t)&&t.forEach(function(i,o){a.set(o,e(i,r,n,o,t,s))});var m=d?void 0:(u?c?ss:Nr:c?Jo:Tr)(t);return Uo(m||t,function(i,o){m&&(i=t[o=i]),Go(a,o,e(i,r,n,o,t,s))}),a};const _s=function(e){return Ds(e,5)};var Ps,xs,Ms,ks;let js;!function(e){e.Loading="LOADING",e.Loaded="LOADED",e.Failed="FAILED"}(Ps||(Ps={})),function(e){e.AppError="APP_ERROR",e.PrivilegeError="PRIVILEGE_ERROR",e.OAuthError="OAUTH_ERROR"}(xs||(xs={})),function(e){e.AppNotPublished="APP_NOT_PUBLISHED",e.AppNotExisted="APP_NOT_EXISTED",e.AppPage404="APP_PAGE_404",e.PrivilegeNullInfo="PRIVILEGE_NULL_INFO",e.PrivilegeInvalidUserLevel="PRIVILEGE_INVALID_USER_LEVEL",e.PrivilegeInvalidPrivilege="PRIVILEGE_INVALID_PRIVILEGE",e.PrivilegeInvalidLicense="PRIVILEGE_INVALID_LICENSE",e.PrivilegeInvalidAppBlockedByOrg="PRIVILEGE_INVALID_APP_BLOCK_BY_ORG",e.PrivilegeInvalidResourceExperience="PRIVILEGE_INVALID_RESOURCE_EXPERIENCE",e.PrivilegeInvalidResourceItem="PRIVILEGE_INVALID_RESOURCE_ITEM",e.PrivilegeInvalidResourcePermission="PRIVILEGE_INVALID_RESOURCE_PERMISSION",e.PrivilegeInvalidResourcePermissionForReadOnly="PRIVILEGE_INVALID_RESOURCE_PERMISSION_FOR_READ_ONLY",e.PrivilegeInvalidMainSession="PRIVILEGE_INVALID_MAIN_SESSION",e.PrivilegeInvalidPagePermission="PRIVILEGE_INVALID_PAGE_PERMISSION",e.OAuthPublicUserLimit="OAUTH_PUBLIC_USER_LIMIT",e.OAuthAppLicenceLimit="OAUTH_APP_LICENCE_LIMIT",e.OAuthOthers="OAUTH_OTHERS"}(Ms||(Ms={})),function(e){e.Experience="Web Experience",e.Template="Web Experience Template"}(ks||(ks={}));const Fs=new Uint8Array(16);function Us(){if(!js){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");js=crypto.getRandomValues.bind(crypto)}return js(Fs)}const Bs=[];for(let e=0;e<256;++e)Bs.push((e+256).toString(16).slice(1));function Vs(e,t=0){return(Bs[e[t+0]]+Bs[e[t+1]]+Bs[e[t+2]]+Bs[e[t+3]]+"-"+Bs[e[t+4]]+Bs[e[t+5]]+"-"+Bs[e[t+6]]+Bs[e[t+7]]+"-"+Bs[e[t+8]]+Bs[e[t+9]]+"-"+Bs[e[t+10]]+Bs[e[t+11]]+Bs[e[t+12]]+Bs[e[t+13]]+Bs[e[t+14]]+Bs[e[t+15]]).toLowerCase()}const Gs={};function $s(e,t,r,n,i,o,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(o){if(s<0||s+16>o.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else o=new Uint8Array(16),s=0;t??=Date.now(),r??=0,n??=16383&(e[8]<<8|e[9]),i??=e.slice(10,16);const a=(1e4*(268435455&(t+=122192928e5))+r)%4294967296;o[s++]=a>>>24&255,o[s++]=a>>>16&255,o[s++]=a>>>8&255,o[s++]=255&a;const l=t/4294967296*1e4&268435455;o[s++]=l>>>8&255,o[s++]=255&l,o[s++]=l>>>24&15|16,o[s++]=l>>>16&255,o[s++]=n>>>8|128,o[s++]=255&n;for(let e=0;e<6;++e)o[s++]=i[e];return o}const Hs=function(e,t,r){let n;const i=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)n=$s(e.random??e.rng?.()??Us(),e.msecs,e.nsecs,e.clockseq,e.node,t,r);else{const e=Date.now(),o=Us();!function(e,t,r){e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0);e.node||(e.node=r.slice(10,16),e.node[0]|=1,e.clockseq=16383&(r[8]<<8|r[9]));e.msecs=t}(Gs,e,o),n=$s(o,Gs.msecs,Gs.nsecs,i?void 0:Gs.clockseq,i?void 0:Gs.node,t,r)}return t??Vs(n)};var Ws,zs=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.AppList="AppList",e.Builder="Builder",e.Experience="Experience"}(Ws||(Ws={}));const qs="OAUTH_0070";function Js(e,t,r){return zs(this,void 0,void 0,function*(){return yield ia(e,r).then(n=>zs(this,void 0,void 0,function*(){const i=function(e,t,r){return zs(this,void 0,void 0,function*(){const n=Ys(),i={valid:!0,isExperience:!0,isValidItem:!0,hasPermissionToAccess:!0,viewOnly:!1};return e===Ws.AppList||window.jimuConfig.isDevEdition?yield Promise.resolve(i):n?/\.json$/.test(n)||/^https/.test(n)?yield Promise.resolve(i):yield ra(n,r).then(r=>zs(this,void 0,void 0,function*(){if(!r||"Web Experience"!==r.type&&"Web Experience Template"!==r.type)return i.valid=!1,i.isExperience=!1,i;{const n=!!Ya().getState().queryObject.template;if(e===Ws.Builder&&!n){(yield Ks(r))||t||(i.valid=!1,i.hasPermissionToAccess=!1)}return r.origin&&(i.viewOnly=!0),i}})).catch(e=>(e&&"CONT_0001"===e.code?(i.valid=!1,i.isValidItem=!1):(i.valid=!1,i.hasPermissionToAccess=!1),i)):yield Promise.resolve(i)})}(e,t,r),o=function(e){return zs(this,void 0,void 0,function*(){return window.jimuConfig.isDevEdition||e!==Ws.Builder&&e!==Ws.AppList?Promise.resolve(!0):yield ta().then(e=>!(!e||!e.orgId)).catch(()=>!1)})}(e),s=function(e){return zs(this,void 0,void 0,function*(){return yield Qs().then(t=>zs(this,void 0,void 0,function*(){return window.jimuConfig.isDevEdition&&t&&(e===Ws.Builder||e===Ws.AppList)?yield function(){return zs(this,void 0,void 0,function*(){return yield ta().then(e=>!(!e||"2"!==e.level)).catch(()=>!1)})}():yield Promise.resolve(!0)}))})}(e),a=function(e,t){return zs(this,void 0,void 0,function*(){return yield Zs(t).then(t=>{const r={valid:!1,capabilities:t,invalidInfo:Ms.PrivilegeNullInfo,invalidMessage:""};if(window.jimuConfig.isDevEdition){if(e===Ws.AppList)return r.valid=t.canCreateExperience,r;if(e===Ws.Builder)return r.valid=t.canCreateExperience,r;if(e===Ws.Experience)return r.valid=!0,r}else{if(e===Ws.AppList)return r.valid=!0,r;if(e===Ws.Builder)return r.valid=t.canCreateExperience,r;if(e===Ws.Experience)return r.valid=!0,r}})})}(e,n),l=function(e,t){return zs(this,void 0,void 0,function*(){const r=Ya().getState();return window.jimuConfig.isDevEdition?yield Promise.resolve({valid:!0,viewOnly:!1}):e===Ws.Builder||e===Ws.AppList?yield Promise.resolve(t):r.appId?/^\/templates\/.*\.json$/.test(r.appId)?yield Promise.resolve({valid:!0,viewOnly:!1}):yield function(e){return zs(this,void 0,void 0,function*(){return yield ra(e).then(e=>e&&"public"===e.access)})}(r.appId).then(e=>e&&(t.valid||t.messageCode!==qs)?{valid:!0,viewOnly:!1}:t).catch(e=>({valid:!0,viewOnly:!1})):Promise.resolve({valid:!0,viewOnly:!1})})}(e,n);return yield Promise.all([i,o,s,a,l])})).then(t=>{const[r,n,i,o,s]=t,a={valid:r.valid&&n&&i&&o.valid&&s.valid&&(e!==Ws.Builder||!r.viewOnly&&!s.viewOnly),capabilities:{canViewExperience:i&&o.capabilities.canViewExperience&&s.valid,canCreateExperience:!r.viewOnly&&i&&o.capabilities.canCreateExperience&&s.valid&&!s.viewOnly,canUpdateExperience:!r.viewOnly&&i&&o.capabilities.canUpdateExperience&&s.valid&&!s.viewOnly,canDeleteExperience:!r.viewOnly&&i&&o.capabilities.canDeleteExperience&&s.valid&&!s.viewOnly,canShareExperience:!r.viewOnly&&i&&o.capabilities.canShareExperience&&s.valid&&!s.viewOnly,canEditFeature:o.capabilities.canEditFeature},invalidInfo:Ms.PrivilegeNullInfo,invalidMessage:""};return a.invalidInfo=function(e,t,r,n,i,o){let s=Ms.PrivilegeNullInfo;s=n?o.valid?!i.valid||!r||e===Ws.Builder&&o.viewOnly?Ms.PrivilegeInvalidPrivilege:t.valid&&e===Ws.Builder&&t.viewOnly?Ms.PrivilegeInvalidResourcePermissionForReadOnly:t.valid?Ms.PrivilegeNullInfo:t.isExperience?t.isValidItem?Ms.PrivilegeInvalidResourcePermission:Ms.PrivilegeInvalidResourceItem:Ms.PrivilegeInvalidResourceExperience:o.messageCode===qs?Ms.PrivilegeInvalidAppBlockedByOrg:Ms.PrivilegeInvalidLicense:Ms.PrivilegeInvalidUserLevel;return s}(e,r,n,i,o,s),a.invalidMessage=function(e,t){const r=hp(),n=ea();let i="";n?t===Ms.PrivilegeInvalidLicense?e===Ws.Builder||e===Ws.AppList?i=r.formatMessage({id:"essentialAppsLicenseErrorForBuilder",defaultMessage:jo.essentialAppsLicenseErrorForBuilder}):e===Ws.Experience&&(i=r.formatMessage({id:"essentialAppsLicenseErrorForApp",defaultMessage:jo.essentialAppsLicenseErrorForApp})):t===Ms.PrivilegeInvalidAppBlockedByOrg?e===Ws.Builder||e===Ws.AppList?i=r.formatMessage({id:"blockedByAdminErrorForBuilder",defaultMessage:jo.blockedByAdminErrorForBuilder}):e===Ws.Experience&&(i=r.formatMessage({id:"blockedByAdminErrorForApp",defaultMessage:jo.blockedByAdminErrorForApp})):t===Ms.PrivilegeInvalidPrivilege?i=window.jimuConfig.isDevEdition?r.formatMessage({id:"roleError2",defaultMessage:jo.roleError2}):r.formatMessage({id:"noEditContentPrivilegesError",defaultMessage:jo.noEditContentPrivilegesError}):t===Ms.PrivilegeInvalidUserLevel?i=r.formatMessage({id:"roleError",defaultMessage:jo.roleError}):t===Ms.PrivilegeInvalidResourceExperience?i=r.formatMessage({id:"invalidResourceExperience",defaultMessage:jo.invalidResourceExperience}):t===Ms.PrivilegeInvalidResourceItem?i=r.formatMessage({id:"invalidResourceItem",defaultMessage:jo.invalidResourceItem}):t===Ms.PrivilegeInvalidResourcePermission?i=r.formatMessage({id:"invalidResourcePermission",defaultMessage:jo.invalidResourcePermission}):t===Ms.PrivilegeInvalidResourcePermissionForReadOnly?i=r.formatMessage({id:"invalidResourcePermissionForReadOnly",defaultMessage:jo.invalidResourcePermissionForReadOnly}):t===Ms.PrivilegeInvalidMainSession&&(i=r.formatMessage({id:"signInErrorInvalidToken",defaultMessage:jo.signInErrorInvalidToken})):i=t===Ms.PrivilegeInvalidResourceExperience?r.formatMessage({id:"invalidResourceExperience",defaultMessage:jo.invalidResourceExperience}):t===Ms.PrivilegeInvalidResourceItem?r.formatMessage({id:"invalidResourceItem",defaultMessage:jo.invalidResourceItem}):"";return i}(e,a.invalidInfo),a})})}const Ks=e=>zs(void 0,void 0,void 0,function*(){var t;if(!ea())return!1;const r=yield ta(),n=!!window.jimuConfig.isInPortal||"self"===e.contentOrigin,i=!!r&&("org_admin"===r.role&&(null===(t=r.privileges)||void 0===t?void 0:t.includes("portal:admin:updateItems")))&&n,o=e.owner===(null==r?void 0:r.username),s=yield function(e,t){return zs(this,void 0,void 0,function*(){return ta().then(r=>{var n;const i=t||ea(),o=null===(n=null==r?void 0:r.groups)||void 0===n?void 0:n.filter(e=>e.capabilities.indexOf("updateitemcontrol")>-1);return(null==o?void 0:o.length)>0&&(s=e,a={authentication:i},Li(`${io(s,a)}/groups`,a)).then(e=>{const t=[].concat(e.admin).concat(e.member).concat(e.other);return o.some(e=>t.some(t=>t.id===e.id))});var s,a}).catch(e=>!1)})}(e.id);return!!(i||o||s)});function Ys(){const e=Ya().getState();return e.appId||e.queryObject.id}function Xs(){return zs(this,void 0,void 0,function*(){return yield function(){return zs(this,void 0,void 0,function*(){const e=Ya().getState(),t=e.portalSelf,r=e.portalUrl;return t?yield Promise.resolve(t):r?yield ao(r):yield Promise.resolve(null)})}().then(e=>e&&e.isPortal?e.currentVersion:null).catch(e=>null)})}function Qs(){return zs(this,void 0,void 0,function*(){const e=yield Xs();return!!e&&Number(e)<=6.1})}function Zs(e){return zs(this,void 0,void 0,function*(){const t={canViewExperience:!0,canCreateExperience:!1,canUpdateExperience:!1,canDeleteExperience:!1,canShareExperience:!1,canEditFeature:!1};return yield function(){return zs(this,void 0,void 0,function*(){return yield ta().then(e=>!!(e&&e.privileges&&e.privileges.indexOf&&e.privileges.includes("portal:user:createItem"))).catch(()=>!1)})}().then(r=>zs(this,void 0,void 0,function*(){const n=r&&e.valid&&!e.viewOnly;return t.canCreateExperience=n,t.canUpdateExperience=n,t.canDeleteExperience=n,t.canShareExperience=n,yield function(){return zs(this,void 0,void 0,function*(){return yield ta().then(e=>!!(e&&e.privileges&&e.privileges.indexOf&&e.privileges.includes("features:user:edit"))).catch(()=>!0)})}()})).then(e=>(t.canEditFeature=e,t))})}function ea(){return pa.getInstance().getMainSession()}const ta=()=>zs(void 0,void 0,void 0,function*(){const e=ea();return e?yield e.getUser().then(e=>e).catch(t=>zs(void 0,void 0,void 0,function*(){return console.log(t&&t.message,`You are currently signed in as: '${e.username}'.`),yield Promise.reject(new Error(null))})):(console.log("The user has not signed in."),yield Promise.reject(new Error(null)))});const ra=(e,t)=>zs(void 0,void 0,void 0,function*(){const r=ea(),n=Ya().getState().appInfo;return n&&n.name&&!t?yield Promise.resolve(n):yield co(e,t).then(e=>e).catch(e=>zs(void 0,void 0,void 0,function*(){return console.log(e&&e.message,`You are currently signed in as: '${null==r?void 0:r.username}'.`),yield Promise.reject(e)}))});let na=null;function ia(e,t){return zs(this,void 0,void 0,function*(){const r=Ya().getState().portalUrl,n=(yield function(){return zs(this,void 0,void 0,function*(){const e=yield Xs();return!!e&&Number(e)<=7.3})}())?"arcgisWebApps":"experienceBuilder";return na&&!t||(na=(yield function(e){return zs(this,void 0,void 0,function*(){return!window.jimuConfig.isDevEdition||(e===Ws.Builder||e===Ws.AppList)&&!(yield Qs())})}(e))?yield function(e,t){return zs(this,void 0,void 0,function*(){const r={valid:!1,viewOnly:!1,messageCode:""},n=pa.getInstance().getSessionByUrl(e);if(n){const e=`${n.portal}/oauth2/validateAppAccess?client_id=${t}`;return yield Li(e,{authentication:n}).then(e=>(!1===e.valid?(r.messageCode=e.messageCode||"",console.log("not-authorized",`You are currently signed in as: '${n.username}'.`)):(r.valid=!0,r.viewOnly=!!e.viewOnlyUserTypeApp),r)).catch(e=>zs(this,void 0,void 0,function*(){return console.log(e&&e.message,`You are currently signed in as: '${n.username}'.`),yield Promise.resolve(r)}))}return yield Promise.resolve(r)})}(r,n):yield Promise.resolve({valid:!0,viewOnly:!1})),na})}var oa,sa,aa,la=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.TokenRequired="TOKEN_REQUIRED",e.InvalidToken="INVALID_TOKEN",e.NoPermission="NO_PERMISSION",e.SignInCanceled="SIGN_IN_CANCELED",e.Other="OTHER"}(oa||(oa={})),function(e){e.ArcGISJSAPISync="ARCGIS_JSAPI",e.PostMessageSync="POST_MESSAGE",e.OtherWindowSync="OTHER_WINDOW",e.AddOrUpdate="ADD_OR_UPDATE",e.Remove="REMOVE"}(sa||(sa={})),function(e){e.PortalSession="PORTAL_SESSION",e.ServerSessionFederated="SERVER_SESSION_FEDERATED",e.ServerSessionStandAlone="SERVER_SESSION_STAND_ALONE",e.ServerSessionStandAloneWebTier="SERVER_SESSION_STAND_ALONE_WEB_TIER"}(aa||(aa={}));const ca=12e5,ua=!0,da="exb_auth_states";class ha{getMainSession(){var e;if(!this.sessions||!this.getMainPortal())return null;const t=this.sessions[this.getSessionKeyFromUrl(null===(e=this.getMainPortal())||void 0===e?void 0:e.portalUrl)];return this.isSessionExpired(t)?null:t}getSessions(){if(!this.sessions)return[];const e={};return Object.keys(this.sessions).forEach(t=>{const r=this.sessions[t];this.isSessionExpired(r)?r.canRefresh&&(e[t]=r):e[t]=r}),this.sessions=e,Object.keys(this.sessions).map(e=>this.sessions[e])}clearSessions(){delete this.sessions}onSessionChanged(e){if(this.onSessionChangedCallbacks){const t=this.getSessions();this.onSessionChangedCallbacks.forEach(r=>{r(t,e)})}}static getInstance(){return ha.instance||(ha.instance=new ha,window._sessionManager=ha.instance,this.instance.isSigning=!1,this.instance.signInUrlFromQueue="",this.instance.signInQueue=[],this.instance.onSessionChangedCallbacks=[],this.instance.requestCacheForValidatingToken={},this.instance.signInDialogPendingList={},this.instance.noPermissionResourceInfoList={}),ha.instance}constructor(){this.readSessionFromParentPromise=null,this.isMainSession=e=>{if(!e)return!1;if(this.isSessionExpired(e))return!1;const t=this.getSessionKeyFromUrl(e.portal),r=this.getMainPortal();return!(!(null==r?void 0:r.portalUrl)||t!==this.getSessionKeyFromUrl(null==r?void 0:r.portalUrl)||e.clientId!==(null==r?void 0:r.clientId))},this.processInvalidSignInSession=()=>{this.removeAuthInfo(),this.clearSessions()},this.gotoSignInPage=()=>{var e,t;const r=!window.jimuConfig.isSite&&!window.jimuConfig.isBuilder,n=`${window.location.pathname}${window.location.search}${window.location.hash}`;window.jimuConfig.isDevEdition&&(null===(t=null===(e=Ya().getState())||void 0===e?void 0:e.portalUrl)||void 0===t?void 0:t.includes("www.arcgis.com"))?this.gotoLandingPage():window.jimuConfig.isInPortal||window.jimuConfig.isBuilder||r?this.signIn({fromUrl:n,popup:!1}):this.gotoLandingPage()},this.gotoLandingPage=()=>{let e;if(window.jimuConfig.isDevEdition)e=`${location.protocol}//${location.host}${window.jimuConfig.mountPath}page/set-portalurl`;else{e=`${location.protocol}//${location.host}/page/landing`;const t=Ya().getState().queryObject;t.locale&&(e=gl(e,"locale",t.locale)),t.__env__&&(e=gl(e,"__env__",t.__env__))}0!==window.location.href.indexOf(e)&&(window.location.href=e)},this.gotoPrivilegeErrorPage=e=>{Ya().dispatch(za({type:xs.PrivilegeError,code:e}))},this.handleAuthError=(e,...t)=>la(this,[e,...t],void 0,function*(e,t=!0){const r=e.options,n=e instanceof Oi&&r&&(!r.authentication||498===e.code||"AUTHENTICATION_ERROR_CODE"===e.code),i=e instanceof Ii&&!r.authentication;if(n||i){const r=this.getSessionKeyFromUrl(e.url);this.sessions&&this.sessions[r]&&delete this.sessions[r];const n=t?null:window.location&&window.location.href;return yield this.signIn({fromUrl:n,popup:t,desUrl:e.url})}throw new Error(e)}),this.onMessage=e=>{var t,r,n;if("arcgis:auth:requestCredential"===e.data.type){if(!this.canPostSessionTo(e.origin))return;try{const n={dev:/.*dev\.arcgis\.com$/,qa:/.*qa\.arcgis\.com$/,prod:/.*\.arcgis\.com$/};let i;const o=fl(e.origin);i=n.dev.test(o)?"https://devext.arcgis.com":n.qa.test(o)?"https://qaext.arcgis.com":n.prod.test(o)?"https://www.arcgis.com":null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl;const s=this.getSessionByUrl(i);if(!s)return void e.source.postMessage({type:"arcgis:auth:error",error:{name:"NoCredential",message:"Does not find credential."}},e.origin);let a=s.toCredential();a.server=a.server.replace("/sharing/rest",""),null===(r=e.source)||void 0===r||r.postMessage({type:"arcgis:auth:credential",credential:a},e.origin)}catch(t){null===(n=e.source)||void 0===n||n.postMessage({type:"arcgis:auth:error",error:{name:t.name,message:t.message}},e.origin),console.error("Response requestCredential error.",t)}}else if("arcgis:auth:credential"===e.data.type){const t=Ya().getState().queryObject["arcgis-auth-origin"];if(!(e.origin===window.location.origin||e.origin===t)||!e.data.credential)return;this.addFromCredential(e.data.credential,sa.PostMessageSync).then(e=>{this.readSessionFromParentPromise&&this.readSessionFromParentPromise.resolve(e)}).catch(e=>{console.error("Get session from parent error.",e),this.readSessionFromParentPromise&&this.readSessionFromParentPromise.resolve(null)})}},this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage,!1),this.clientIdDialogResultPromises={},window.jimuConfig.isInBuilder&&Xa((e,t)=>{void 0===e?_o():t.some(e=>{const t=this.getSessionKeyFromUrl(e.portalUrl);return!!this.clientIdDialogResultPromises[t]&&(this.onClientIdDialogFinished(e.portalUrl,e.clientId),!0)})},["appConfig","connections"]),window.jimuConfig.isInBuilder||(window.addEventListener("visibilitychange",e=>{"visible"===document.visibilityState&&(console.debug("^^^^ check session expiration when current page is visible"),this.refreshSessions())}),setInterval(()=>{this.refreshSessions()},ca))}needToRefreshSession(e){const t=(new Date).getTime();return e.tokenExpires-t<=ca}refreshFederatedSessionsBelongToThePortalSession(e,t){return la(this,void 0,void 0,function*(){const r=[];return Object.values(this.sessions||{}).forEach(n=>{if(n.portal&&n.server&&n.portal===e.portal){console.debug("---- try refreshing session, ","current time: ",new Date,` expiration time: ${n.tokenExpires}`," - ",`portal: ${n.portal}`,`server: ${n.server||""}`);const i=hl(fl(window.location.href),le.Https),o=`serverUrl=${n.server}&referer=${i}&token=${e.token}`;r.push(this.generateToken(Xn(n.portal),o,t).then(e=>(e?n.updateToken(e.token,new Date(e.expires)):console.warn("Refresh sessions failed: generate token info is null"),Promise.resolve())).catch(e=>(console.warn("Refresh sessions failed: generate token request failed",e),Promise.resolve())))}}),Promise.allSettled(r)})}refreshPortalSession(e){return la(this,void 0,void 0,function*(){return e.canRefresh?e.refreshCredentials().then(()=>(this.isMainSession(e)&&this.writeAuthInfo(e),this.refreshFederatedSessionsBelongToThePortalSession(e))).catch(e=>(console.warn("Refresh sessions failed: refresh credentials request failed",e),Promise.reject(new Error(e)))):(console.warn("Refresh sessions failed: session cannot be refreshed"),Promise.reject(new Error(null)))})}refreshWebTierPortalSession(e){return la(this,void 0,void 0,function*(){return this.getSessionFromWebTierPortal(Xn(e.portal)).then(t=>t?(this.isMainSession(e)&&this.writeAuthInfo(t),e.updateToken(t.token,t.tokenExpires),this.refreshFederatedSessionsBelongToThePortalSession(t,"include")):(console.warn("Refresh webTier portal sessions failed: generate webTier portal token failed"),Promise.reject(new Error(null))))})}refreshSessions(){const e=[];console.debug("==== check session expiration, ","current time: ",new Date),Object.values(this.sessions||{}).forEach(t=>{if(t.portal&&!t.server)if(t.canRefresh&&this.needToRefreshSession(t)){console.debug("---- try refreshing session, ","current time: ",new Date,` expiration time: ${t.tokenExpires}`," - ",`portal: ${t.portal}`,`server: ${t.server||""}`);const r=this.refreshPortalSession(t).catch(()=>(console.warn("Refresh sessions failed: try a second request"),this.refreshPortalSession(t).catch(()=>(console.warn("Refresh sessions failed: try a second request and it fails"),Promise.resolve()))));e.push(r)}else{const{portalUrl:r,isWebTier:n}=Ya().getState();if((n&&Qn(t.portal,r)||this.isTrustedServer(t.portal))&&this.needToRefreshSession(t)){console.debug("---- try refreshing webTier portal session, ","current time: ",new Date,` expiration time: ${t.tokenExpires}`," - ",`portal: ${t.portal}`,`server: ${t.server||""}`);const r=this.refreshWebTierPortalSession(t).catch(()=>Promise.resolve());e.push(r)}else{const e=t.canRefresh?"session has not expired":"session cannot be refreshed";console.debug(`**** ${e}, `,"current time: ",new Date,` expiration time: ${t.tokenExpires}`," - ",`portal: ${t.portal}`,`server: ${t.server||""}`)}}}),Promise.allSettled(e).then(e=>{(null==e?void 0:e.length)>0&&(this.syncToOtherWindowSessionManager(),this.onSessionChanged(sa.AddOrUpdate))})}initSession(){return la(this,void 0,void 0,function*(){const e=window.location.pathname;if(new RegExp(`^${window.jimuConfig.mountPath}page/set-portalurl`).test(e)||/^\/page\/landing/.test(e))return Promise.resolve();const t=Ya().getState().queryObject["arcgis-auth-origin"];return t?this.readSessionFromParent(t).then(e=>{this.readSessionFromParentPromise=null}):this.initSessionFromCookieOrStorage().then(()=>{this.refreshSessions()})})}initSessionFromCookieOrStorage(){return la(this,void 0,void 0,function*(){var e;this.initResourceSessionsFromStorage();const t=this.getMainPortal();if(!t)return;let r=Yn(t.portalUrl);dl(r)||(r=hl(r,le.Https));const n=this.isValidTokenFromStorage(t.portalUrl),i=function(e,t,r="https://www.arcgis.com/sharing/rest"){return Li(`${r}/oauth2/platformSelf?f=json`,{method:"POST",headers:{"X-Esri-Auth-Client-Id":e,"X-Esri-Auth-Redirect-Uri":t},params:{f:"json"}})}(null==t?void 0:t.clientId,r,r).then(e=>e).catch(()=>null),[o,s]=yield null===(e=Promise.allSettled([n,i]))||void 0===e?void 0:e.then(e=>e.map(e=>null==e?void 0:e.value)),a=yield this.getSessionFromStorage();if(a){const e=this.getSessionKeyFromUrl(a.portal);o&&s?a.username===s.username?this.setSession(e,a):this.setSessionByPlatformSelfResponse(s,t):!o&&s?this.setSessionByPlatformSelfResponse(s,t):o&&!s&&(!Zn(window.location.host)||window.jimuConfig.isDevEdition||this.readCookie("esri_locale"))?this.setSession(e,a):this.failedToInitSession()}else s?this.setSessionByPlatformSelfResponse(s,t):this.failedToInitSession()})}initResourceSessionsFromStorage(){(this.readResourcesAuthInfo()||[]).forEach(e=>{e.tokenExpires=e.tokenExpires?new Date(e.tokenExpires):null,e.refreshTokenExpires=e.refreshTokenExpires?new Date(e.refreshTokenExpires):null;const t=new zi(e);t.server?(t.portal=void 0,this.isValidToken(`${t.server}/rest/services`,t.token).then(e=>{var r;return!(!e.valid||!(null===(r=e.response)||void 0===r?void 0:r.currentVersion))&&this.addOrReplaceSession(t)})):t.canRefresh?t.refreshCredentials().then(()=>this.addOrReplaceSession(t)):t.token&&this.isValidToken(`${t.portal}/sharing/rest`,t.token).then(e=>{var r;return!(!e.valid||!(null===(r=e.response)||void 0===r?void 0:r.currentVersion))&&this.addOrReplaceSession(t)})})}failedToInitSession(){if(this.processInvalidSignInSession(),window.jimuConfig.isSite||window.jimuConfig.isBuilder)throw this.gotoSignInPage(),new Error("Should signIn")}setSessionByPlatformSelfResponse(e,t){let r=Yn(t.portalUrl);dl(r)||(r=hl(r,le.Https));const n={expires:(new Date).getTime()+1e3*e.expires_in,server:r,ssl:!0,token:e.token,userId:e.username};let i=zi.fromCredential(n,{hasPortal:!1,hasServer:!1,server:""}),o=i.toJSON();o.clientId=t.clientId,i=new zi(o);const s=this.getSessionKeyFromUrl(i.portal);this.setSession(s,i)}isValidTokenFromStorage(e){return la(this,void 0,void 0,function*(){const t=yield this.getSessionFromStorage();if((null==t?void 0:t.token)&&e){const r=`${e}/sharing/rest`,n=Ya().getState().isWebTier?{credentials:"include"}:{};return this.isValidToken(r,t.token,n).then(e=>{var t;return!(!e.valid||!(null===(t=e.response)||void 0===t?void 0:t.currentVersion))})}return Promise.resolve(!1)})}isValidToken(e,t){return la(this,arguments,void 0,function*(e,t,r={}){if(t){const n=`${e=li(e=ml(e))}?f=json&token=${t}`,i=`${e}_${t}`;if(this.requestCacheForValidatingToken[i])return this.requestCacheForValidatingToken[i];{const e=fetch(n,r).then(e=>e.json()).then(e=>(null==e?void 0:e.error)?{valid:!1,error:e.error}:{valid:!0,response:e,error:null}).catch(e=>(console.warn("failed to validate token."),{valid:!1,error:e}));return this.requestCacheForValidatingToken[i]=Promise.resolve(e),e}}return Promise.resolve({valid:!1,error:null})})}isSameSession(e,t){var r,n;return!(!e||!t)&&(e.portal===t.portal&&e.server===t.server&&e.username===t.username&&e.clientId===t.clientId&&e.ssl===t.ssl&&e.token===t.token&&(null===(r=e.tokenExpires)||void 0===r?void 0:r.valueOf())===(null===(n=t.tokenExpires)||void 0===n?void 0:n.valueOf())&&e.refreshToken===t.refreshToken)}getUserInfo(e){return la(this,void 0,void 0,function*(){const t=e||this.getMainSession(),r=Ya().getState().user;return r&&t&&r.username===t.username?yield Promise.resolve(Ya().getState().user.asMutable({deep:!0})):t?yield t.getUser().then(e=>(this.afterGetUserInfo(e),e)):Promise.resolve(null)})}afterGetUserInfo(e){Ya().dispatch(function(e){return{type:ja.UserSignIn,user:e}}(e));const t=null===e.culture?"":e.culture;if(null!==el(rn)){if(el(rn)!==t){tl(rn,t);const r=Ya().getState().queryObject.locale||e.culture||function(e){if(!e)return;const t=["language","browserLanguage","systemLanguage","userLanguage"];let r,n;if(Array.isArray(e.languages)&&e.languages.length>0&&(n=e.languages[0],n&&n.length))return n;for(r=0;r<t.length;r++)if(n=e[t[r]],n&&n.length)return n}(window.navigator);window.locale!==r&&function(e){op(this,void 0,void 0,function*(){const t=Ya().getState();if(t.appContext.locale===e)return;const r=ap(e,nn)||"en";if(r===t.appContext.translatedLocale)return void gp(e,r);const n=sp(e,nn);if(!n)return function(){const e=Object.assign({},jo),t=Ol("jimu-ui"),r=Ol("jimu-layouts/runtime"),n=Ol("jimu-for-builder");t&&Object.assign(e,t.defaultMessages),r&&Object.assign(e,r.defaultMessages),n&&Object.assign(e,n.defaultMessages),Ya().dispatch(Ga("all-jimu-packages",e))}(),mp().forEach(e=>{ip.getInstance().resetWidgetI18nMessages(e)}),void gp(e,r);yield function(e){return op(this,void 0,void 0,function*(){const t=["jimu-core/lib/translations","jimu-ui/lib/translations","jimu-layouts/lib/translations","jimu-for-builder/lib/translations"].map(t=>{const r=`${t}-${e}`;return fp[r]||(fp[r]=cp(t,e)),fp[r]});yield Promise.all(t).then(e=>{const t=e.reduce((e,t)=>Object.assign(e,t),{});Ya().dispatch(Ga("all-jimu-packages",t))})})}(n),yield function(e){return op(this,void 0,void 0,function*(){const t=mp().map(t=>ip.getInstance().loadWidgetTranslation(t,e));yield Promise.all(t)})}(n),gp(e,r)})}(r)}}else tl(rn,t)}getMainPortal(){const e=Ya().getState();if(!e.portalUrl)return null;return{portalUrl:e.portalUrl,clientId:e.clientId,isWebTier:e.isWebTier}}getTrustedServers(){var e;const t=Ya().getState(),r=null===(e=null==t?void 0:t.portalSelf)||void 0===e?void 0:e.authorizedCrossOriginDomains;return!this.trustedServers&&r&&(this.trustedServers=r.map(e=>hl(fl(e),le.Https))),this.trustedServers||[]}isTrustedServer(e){return this.getTrustedServers().some(t=>e.includes(t))}removeSession(e){if(!e)return!1;const t=this.getSessionKeyFromSession(e);if(this.removeSessionByKey(t)){if(this.getSessionType(e)===aa.PortalSession&&e.signOut(),this.isMainSession(e)&&(Ya().dispatch({type:ja.UserSignOut}),this.removeAuthInfo()),!(window.jimuConfig.isBuilder||e.portal&&e.server)){const t=ri(ei(e.portal))||ci(e.server);Ya().dispatch(Ja(t,null))}return this.removeServerSessionsByPortalSession(e),this.syncToOtherWindowSessionManager(),this.onSessionChanged(sa.Remove),this.updateResourcesAuthInfo(),!0}return!1}removeSessionByKey(e){return!!e&&(this.sessions&&this.sessions[e]&&delete this.sessions[e],!0)}addOrReplaceSession(e){if(!e)return!1;if(this.doAddOrReplaceSession(e)){this.syncToOtherWindowSessionManager(),this.onSessionChanged(sa.AddOrUpdate);const t=e.server?`${e.server}/rest/services`:e.portal;return this.releasePendingSignIn(t),!0}return!1}doAddOrReplaceSession(e){if(!e)return!1;const t=this.getSessionKeyFromSession(e);return!!t&&(this.setSession(t,e),!0)}setSession(e,t){var r;if(this.isSessionExpired(t))return;this.sessions||(this.sessions={});const n=this.sessions[e];this.removeServerSessionsByPortalSession(n),this.sessions[e]=t;const i=null===(r=this.getMainPortal())||void 0===r?void 0:r.portalUrl,o=e===this.getSessionKeyFromUrl(i);if(o&&this.updatingAfterMainSessionChanged(t,n),!(window.jimuConfig.isBuilder||t.portal&&t.server||o)){const e=ri(ei(t.portal))||ci(t.server);Ya().dispatch(Ja(e,t.username))}this.updateResourcesAuthInfo()}updatingAfterMainSessionChanged(e,t){return la(this,void 0,void 0,function*(){if(!Ya().getState().user||e.username!==(null==t?void 0:t.username)){if(yield ao(e.portal,!0),yield this.getUserInfo(e),!window.jimuConfig.isBuilder){const t=ri(ei(e.portal));Ya().dispatch(Ja(t,e.username))}window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder||!t||Js(Ws.Experience,!1,!0).then(e=>{e.valid||Ya().dispatch(za({type:xs.PrivilegeError,code:e.invalidInfo,message:e.invalidMessage}))})}this.writeAuthInfo(e)})}removeServerSessionsByPortalSession(e){if(e&&e.portal&&!e.server){this.getSessions().forEach(t=>{if(t.server&&t.portal===e.portal&&t.username===e.username){const e=this.getSessionKeyFromSession(t);this.removeSessionByKey(e)}})}}getSessionByUrl(e){if(!this.sessions)return;let t=this.getSessionKeyFromUrl(e),r=this.sessions[t];if((null==r?void 0:r.server)&&(null==r?void 0:r.portal)){const e=this.getPortalKeyFromUrl(r.portal);r=this.sessions[e]}return r}getSessionKeyFromSession(e){return(null==e?void 0:e.server)?"server_"+pl(e.server).toLowerCase():this.getSessionKeyFromUrl(e.portal)}getSessionKeyFromUrl(e){return this.getServerKeyFromUrl(e)||this.getPortalKeyFromUrl(e)}getServerKeyFromUrl(e){const t=ai(e)?pl(ci(e)):"";return(t?`server_${t}`:"").toLowerCase()}getPortalKeyFromUrl(e){var t,r;let n="";if(Zn(e))n=this.getStandardAGOLSessionKey(e)||"";else{const{customBaseUrl:i,urlKey:o}=this.getPortalUrlInfo(e)||{};if(n=`${o}.${i}`,null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl){const e=this.getPortalUrlInfo(null===(r=this.getMainPortal())||void 0===r?void 0:r.portalUrl);o===e.urlKey&&0===i.indexOf(e.customBaseUrl)&&(n=`${e.urlKey}.${e.customBaseUrl}`)}}return n.toLowerCase()}getPortalUrlInfo(e){if(!e)return null;let t=e.toLowerCase(),r="",n=t.indexOf("https://");0===n?r="https://":(n=t.indexOf("http://"),0===n&&(r="http://")),n=r.length;let i,o,s=t.indexOf("/sharing/rest",n);s=s<0?t.length:s,t=t.substring(n,s);const a=t.split(".");return i=a[0],a.splice(0,1),o=a.join("."),{urlKey:i,customBaseUrl:o,schema:r}}getSessionFromAuthInfo(e){var t;if(!this.checkAuthInfo(e))return null;const r=this.getPortalFromAuthInfo(e);return new zi({clientId:null===(t=this.getMainPortal())||void 0===t?void 0:t.clientId,token:e.token,tokenExpires:new Date(e.expires),refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires?new Date(e.refreshTokenExpires):null,redirectUri:e.redirectUri,portal:r,username:e.email})}getSessionFromStorage(){return la(this,void 0,void 0,function*(){var e;const t=null===(e=this.readAuthInfo("exb_auth"))||void 0===e?void 0:e.authInfo,r=this.getSessionFromAuthInfo(t);let n=null;if(r&&r.canRefresh&&this.isSessionExpired(r))try{yield r.refreshCredentials()}catch(e){return console.warn("failed to refresh the token in storage",e),Promise.resolve(null)}return r&&this.isMainSession(r)?n=r:r&&this.processInvalidSignInSession(),Promise.resolve(n)})}readCookie(e){try{return ko.get(e)}catch(e){console.error("Read cookie error.",e)}}getPortalFromAuthInfo(e){var t;if(window.jimuConfig.isInPortal)return`${null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl}/sharing/rest/`;const r=e.urlKey?`${e.urlKey}.`:"";let n=e.schema;n=n||"https://";let i=`${n}${r}${e.customBaseUrl}/sharing/rest/`;return"maps.arcgis.com"===e.customBaseUrl?i=`${n}www.arcgis.com/sharing/rest/`:"mapsdevext.arcgis.com"===e.customBaseUrl?i=`${n}devext.arcgis.com/sharing/rest/`:"mapsqa.arcgis.com"===e.customBaseUrl&&(i=`${n}qaext.arcgis.com/sharing/rest/`),i}isSessionExpired(e){return!e||new Date(e.tokenExpires)<new Date&&(console.debug("???? session has expired, ","current time: ",new Date,` expiration time: ${e.tokenExpires}`," - ",`portal: ${e.portal}`,`server: ${e.server||""}`),!0)}getAuthInfoFromSession(e){const{urlKey:t,customBaseUrl:r,schema:n}=this.getPortalUrlInfo(e.portal);return{portalApp:!1,email:e.username,token:e.token,expires:e.tokenExpires,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,redirectUri:e.redirectUri,urlKey:t,customBaseUrl:r,clientId:e.clientId,schema:n}}checkAuthInfo(e){if(!e)return!1;if(e.refreshTokenExpires){if(new Date(e.refreshTokenExpires)<new Date)return!1}else if(new Date(e.expires)<new Date)return!1;return!0}readAuthInfo(e){let t,r;try{r=JSON.parse(el(e))}catch(e){console.error("Parse localStorage auth error")}if(r)t={authInfo:r,from:"LocalStorage"};else{try{r=JSON.parse(rl(e))}catch(e){console.error("Parse sessionStorage auth error")}t={authInfo:r,from:"SessionStorage"}}return t}writeAuthInfo(e){const t=this.readAuthInfo("exb_auth");this.removeAuthInfo(),"LocalStorage"===t.from||window.jimuConfig.isDevEdition||window.jimuConfig.isOutOfExb?tl("exb_auth",JSON.stringify(this.getAuthInfoFromSession(e))):nl("exb_auth",JSON.stringify(this.getAuthInfoFromSession(e)))}removeAuthInfo(){!function(e){try{localStorage.removeItem(e)}catch(e){console.error("Remove from Local storage error.",e)}}("exb_auth"),function(e){try{sessionStorage.removeItem(e)}catch(e){console.error("Remove from session storage error.",e)}}("exb_auth")}updateResourcesAuthInfo(){const e=[];Object.entries(this.sessions||{}).forEach(t=>{const r=t[1];if(this.isMainSession(r))return;const n=this.getSessionType(r);if(n===aa.ServerSessionFederated||n===aa.ServerSessionStandAloneWebTier)return;const i=r.toJSON();r.canRefresh&&(i.token=void 0,i.tokenExpires=void 0,i.tokenDuration=void 0),e.push(i)}),nl("exb_auth_resources",JSON.stringify(e))}readResourcesAuthInfo(){let e=[];try{e=JSON.parse(rl("exb_auth_resources"))}catch(e){console.error("Parse localStorage auth error")}return e}writeAuthState(e){const t=JSON.parse(el(da))||[];e&&(t.push(e),tl(da,JSON.stringify(t)))}getStandardAGOLSessionKey(e){if(!Zn(e))return;let t,r;const n=fl(e).split(".");let i;return t=n[0],n.splice(0,1),r=n.join("."),"devext"===t||"mapsdevext.arcgis.com"===r?i="devext.arcgis.com":"qaext"===t||"mapsqa.arcgis.com"===r?i="qaext.arcgis.com":"www"===t||"maps.arcgis.com"===r?i="www.arcgis.com":(i="www.arcgis.com",t.indexOf("dev")>-1||r.indexOf("dev")>-1?i="devext.arcgis.com":(t.indexOf("qa")>-1||r.indexOf("qa")>-1)&&(i="qaext.arcgis.com")),i}getOrgUrl(e,t){let r;return"www.arcgis.com"===e?r=`${t}.maps.arcgis.com`:"devext.arcgis.com"===e?r=`${t}.mapsdevext.arcgis.com`:"qaext.arcgis.com"===e?r=`${t}.mapsqa.arcgis.com`:(r=e,console.error("Bad params.",e,t)),hl(r,le.Https)}getHostedService(e){return la(this,void 0,void 0,function*(){const t=e.split(/\/rest(\/admin)?\/services\//)[0];return t?yield Li(t+"/rest/info",{httpMethod:"GET"}).then(e=>la(this,void 0,void 0,function*(){if(!e.owningSystemUrl)return yield Promise.resolve(null);let t;return/https?:\/\/(www|services)\.arcgis\.com/.test(e.owningSystemUrl)?t="www.arcgis.com":/https?:\/\/(devext|servicesdev)\.arcgis\.com/.test(e.owningSystemUrl)&&/mapsdevext\.arcgis\.com\/?$/.test(Ya().getState().portalUrl)?t="devext.arcgis.com":/https?:\/\/(qaext|servicesqa)\.arcgis\.com/.test(e.owningSystemUrl)&&/mapsqa\.arcgis\.com\/?$/.test(Ya().getState().portalUrl)&&(t="qaext.arcgis.com"),yield Promise.resolve(t)})):yield Promise.resolve(null)})}getHostedServiceArcgisKey(e){return la(this,void 0,void 0,function*(){const t=fl(e).split("."),r=t[0];let n;return t.splice(0,1),r.includes("servicesdev")?n="devext.arcgis.com":r.includes("servicesqa")?n="qaext.arcgis.com":r.includes("services")&&(n="www.arcgis.com"),n?yield Promise.resolve(n):yield this.getHostedService(e)})}getSignInDomain(e,t){return la(this,void 0,void 0,function*(){if(!e)return null;if(Zn(e)){let r=this.getStandardAGOLSessionKey(e);return r||(r=yield this.getHostedServiceArcgisKey(e),r=r||fl(e)),t?this.getOrgUrl(r,t):`https://${r}`}{const{customBaseUrl:t,urlKey:r,schema:n}=this.getPortalUrlInfo(e);return`${n||"https://"}${r}.${t}`}})}signInByResourceUrl(e,t,r){let n;return n=ai(e)?t?this.signIn({desUrl:t,forceLogin:r,federatedServiceUrl:e}):this.nonOAuthSignIn(e,r):this.signIn({desUrl:e,forceLogin:r}),n}signIn(){return la(this,arguments,void 0,function*(e={}){var t,r,n,i,o;let s=e.fromUrl||window.jimuConfig.mountPath;const a=e.desUrl||(null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl),l=e.clientId||this.getClientIdByUrl(a),c=null===(r=e.popup)||void 0===r||r,u=null!==(n=e.forceLogin)&&void 0!==n&&n,d=e.federatedServiceUrl,h=e.redirectUrlInNewWindow,p=e.redirectUrlInTopWindow;"/"===s.split("#")[0]&&window.jimuConfig.isInPortal&&(s=window.location.pathname);const f=this.getSessionByUrl(a);if(f&&!u){if(this._executeSignIn(),!c){const e=0===s.indexOf("/");window.location.href=`${location.protocol}//${location.host}${e?"":"/"}${s}`}return d&&(yield this.generateSeverSessionByPortalSession(f,d)),Promise.resolve(f)}let m=!1;if(c){const e=this.tryToPendingSignInDialog(a);m=!!e,d&&this.tryToPendingSignInDialog(d);const t=this.signInUrlFromQueue&&this.getSessionKeyFromUrl(this.signInUrlFromQueue)===this.getSessionKeyFromUrl(a);if(e&&!t)return e.promise.then(()=>la(this,void 0,void 0,function*(){this.isSigning=!1,d&&this.releasePendingSignIn(d),this._executeSignIn();const e=this.getSessionByUrl(a);return d&&(yield this.generateSeverSessionByPortalSession(e,d)),e})).catch(e=>{const t=this.getSignInErrorCodeByAuthError(e);return d&&this.releasePendingSignIn(d,e),this._executeSignIn(),Promise.reject(this.getSignInErrorByCode(t))})}const g=Ya().getState().queryObject;if(this.isSigning&&!m){const t=this.defer();return this.signInQueue.push(Object.assign(Object.assign({},e),{sessionDefer:t})),yield t.promise}let v=Yn(yield this.getSignInDomain(a,null==g?void 0:g.org));const y=function(e){if(/\/$/.test(e))return e;if(!([".js",".css",".scss",".html"].filter(t=>new RegExp(`${t}$`).test(e)).length>0))return e;const t=e.split("/");return t.pop(),t.join("/")}(function(e){const t=Ll(e);if(/^file:/.test(t))return t;return t.substring(`${window.location.protocol}//${window.location.host}`.length,t.length)}("jimu-core")),S=`${window.location.origin}${y}/oauth-callback.html`,I=Hs(),w={id:I,clientId:l,portal:v,popup:c,isInPortal:window.jimuConfig.isInPortal,isDevEdition:window.jimuConfig.isDevEdition,isOutOfExb:window.jimuConfig.isOutOfExb,mountPath:window.jimuConfig.mountPath,enablePkce:ua,jimuCorePath:y,fromUrl:s,redirectUrlInNewWindow:h,redirectUrlInTopWindow:p};this.writeAuthState(w);const E={portal:v,clientId:l,redirectUri:S,state:{id:I},popup:c,pkce:ua,locale:null===(i=Ya().getState())||void 0===i?void 0:i.appContext.locale,params:{showSignupOption:!0,signupType:"esri",hideCancel:window.jimuConfig.isInPortal&&!c,force_login:u}};this.isSigning=!0;const b=new Fo,R=window.open.exbReplaced?null:window.open;if(R){const e=(e,t,r)=>{R&&(window.open=R);const n=R(e,t,r);if("oauth-window"===t){const e=n,t=setInterval(()=>{if(null==e?void 0:e.closed){const e=this.getSessionByUrl(v);this.releasePendingSignIn(a,e?null:{name:"identity-manager:user-aborted",details:"originally aborted from exb",message:"ABORTED"}),d&&this.releasePendingSignIn(d,e?null:{name:"identity-manager:user-aborted",details:"originally aborted from exb",message:"ABORTED"}),this.isSigning=!1,this._executeSignIn(),e?b.resolve(e):this.initSessionFromCookieOrStorage().then(()=>{const e=this.getSessionByUrl(v);e?b.resolve(e):b.reject(this.getSignInErrorByCode(oa.SignInCanceled))}),clearInterval(t)}},500)}return n};e.exbReplaced=!0,window.open=e}null===(o=zi.beginOAuth2(E))||void 0===o||o.then(t=>{if(this.addOrReplaceSession(t),this.isSigning=!1,this._executeSignIn(),b.resolve(t),c){const t=!(window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder);e.fromUrl&&t&&(window.location.href=e.fromUrl),e.redirectUrlInNewWindow&&t&&window.open(e.redirectUrlInNewWindow),e.redirectUrlInTopWindow&&t&&(window.top.location.href=e.redirectUrlInTopWindow)}}).catch(e=>{"ArcGISAccessDeniedError"!==e.name&&b.reject(this.getSignInErrorByCode(oa.Other))});const T=f,N=u?this.removeFromNoPermissionResourceInfoList(ri(ei(v))):null;return b.promise.then(e=>la(this,void 0,void 0,function*(){return d&&(yield this.generateSeverSessionByPortalSession(e,d)),u&&N&&(null==T?void 0:T.username)===e.username&&this.setNoPermissionResourceInfoList(Object.assign(Object.assign({},this.noPermissionResourceInfoList),N)),e})).catch(e=>{throw u&&N&&e.code===oa.SignInCanceled&&this.setNoPermissionResourceInfoList(Object.assign(Object.assign({},this.noPermissionResourceInfoList),N)),e})})}nonOAuthSignIn(e,t){return la(this,void 0,void 0,function*(){return ro(["esri/request"]).then(r=>{const[n]=r,i=this.getSessionByUrl(e);let o;if(t){i&&this.removeSession(i);const t=ci(e);o=this.removeFromNoPermissionResourceInfoList(t)}const s=t?"immediate":"auto";return e=gl(e,"f","json"),n(e=t?gl(e,"_exbForceLogin","true"):e,{authMode:s,responseType:"json"}).then(t=>this.getSessionByUrl(e)).catch(r=>{const n=this.getSessionByUrl(e);if(n)return Promise.resolve(n);{const e=this.getSignInErrorCodeByAuthError(r),n=this.getSignInErrorByCode(e);return t&&(i&&this.addOrReplaceSession(i),n.code===oa.SignInCanceled&&this.setNoPermissionResourceInfoList(Object.assign(Object.assign({},this.noPermissionResourceInfoList),o))),Promise.reject(n)}})})})}getSignInErrorCodeByAuthError(e){var t,r,n,i;const o=(null===(r=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.error)||void 0===r?void 0:r.code)||e.code||(null===(i=null===(n=null==e?void 0:e.details)||void 0===n?void 0:n.raw)||void 0===i?void 0:i.code)||null;let s=null;return 499===o?s=oa.TokenRequired:498===o?s=oa.InvalidToken:403===o?s=oa.NoPermission:"identity-manager:user-aborted"===e.name&&(s=oa.SignInCanceled),s}getSignInErrorByCode(e=oa.Other){const t=hp(),r={code:e,isSignInError:!0,message:t.formatMessage({id:"signInErrorDefault",defaultMessage:jo.signInErrorDefault}),message1:t.formatMessage({id:"signInErrorEnterCredential",defaultMessage:jo.signInErrorEnterCredential}),message2:t.formatMessage({id:"signInErrorTryAgain",defaultMessage:jo.signInErrorTryAgain})};switch(e){case oa.TokenRequired:case oa.InvalidToken:case oa.NoPermission:case oa.SignInCanceled:break;default:r.code=oa.Other}return r}getClientIdByUrl(e){return this.getClientIdByPortalUrlAndHost(e,window.location.hostname)}getClientIdByPortalUrlAndHost(e,t){var r;let n;const i=Ya().getState();n=Qn(ri(e),ri(i.portalUrl))?i.clientId:null===(r=Po(e))||void 0===r?void 0:r.clientId;const o=fl(e),s=t.endsWith(".arcgis.com"),a=t.endsWith(".esri.com"),l=o.endsWith(".arcgis.com");return!n&&(s||a)&&l&&(n="experienceBuilder"),n}onClientIdDialogFinished(e,t,r){const n=this.getSessionKeyFromUrl(e);this.clientIdDialogResultPromises[n]&&(r?this.clientIdDialogResultPromises[n].reject(null):this.clientIdDialogResultPromises[n].resolve(t))}getPortalVersionByUrl(e){return Li(function(e){let t="",r=e||"";return r=ei(r),r&&(t=r+"/sharing/rest/portals/self"),t}(e),{httpMethod:"GET"}).then(e=>Number(null==e?void 0:e.currentVersion)).catch(e=>(console.warn(e),null))}useDialogToSetClientIdToConnectionsOfAppConfig(e){return la(this,void 0,void 0,function*(){var t,r;let n;const i=this.getSessionKeyFromUrl(e);let o;this.clientIdDialogResultPromises[i]?o=this.clientIdDialogResultPromises[i]:(o={promise:null,resolve:null,reject:null},o.promise=new Promise((e,t)=>{o.resolve=e,o.reject=t}));const s=window.location.host,a=/.*\.arcgis\.com(?::(\d+))?(?=[\/?#]|$)/.test(s),l=yield this.getPortalVersionByUrl(e),c=l>7.3;if(this.isTrustedServer(e))xo(e,"",l),n=Promise.resolve("");else if(a&&c)xo(e,"experienceBuilder",l),n=Promise.resolve("experienceBuilder");else if(window.jimuConfig.isBuilder)this.clientIdDialogResultPromises[i]=o,Ya().dispatch(function(e,t,r,n){return{type:ja.AddToRegisterClientIdList,portalUrl:e,needToSignIn:t,forceLogin:n,serviceUrl:r}}(e)),n=null===(t=this.clientIdDialogResultPromises[i])||void 0===t?void 0:t.promise;else if(window.jimuConfig.isInBuilder){const t=Ol("jimu-for-builder").appBuilderSync;this.clientIdDialogResultPromises[i]=o,t.publishPortalUrlNeedToRegisterClientId(e),n=null===(r=this.clientIdDialogResultPromises[i])||void 0===r?void 0:r.promise}else n=Promise.resolve();return n})}addSessionChangeListener(e){if("function"!=typeof e)throw new Error("callback must be a function");this.onSessionChangedCallbacks.includes(e)||this.onSessionChangedCallbacks.push(e)}_executeSignIn(){if(!this.isSigning&&this.signInQueue){const e=this.signInQueue.pop();e&&(this.signInUrlFromQueue=e.desUrl,this.signIn(e).then(t=>{e.sessionDefer.resolve(t)}).catch(t=>{e.sessionDefer.reject(t)}),this.signInUrlFromQueue="")}}signOutByResourceUrl(e,t){const r=t||e,n=this.getSessionByUrl(r);this.removeSession(n)}signOut(e={}){var t,r;const n=e.desUrl||(null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl),i=e.clientId||this.getClientIdByUrl(n),o=null===(r=e.redirectToSignOutPage)||void 0===r||r,s=this.getSessionByUrl(n);if(i&&this.removeSession(s),o){let t;t=window.jimuConfig.isDevEdition?`${window.location.protocol}//${window.location.host}${window.jimuConfig.mountPath}page/set-portalurl`:window.jimuConfig.isInPortal?window.location.href:`${window.location.protocol}//${window.location.host}/page/landing`;const r=encodeURIComponent(e.redirectUrl||t);if(i){const e=`${Yn(n)}/oauth2/signout?client_id=${i}&redirect_uri=${r}`;location.href=e}else location.href="/"}}switchAccountByResourceUrl(e,t){const r=this.getSessionByUrl(t||e);return this.signInByResourceUrl(e,t,!0).then(e=>(r&&r.clientId&&r.signOut(),e))}switchAccount(e={}){var t,r;const n=e.desUrl||(null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl),i=e.clientId||this.getClientIdByUrl(n),o=null===(r=e.popup)||void 0===r||r,s=e.federatedServiceUrl;if(o){const e=this.getSessionByUrl(n);return this.signIn({desUrl:n,clientId:i,popup:o,federatedServiceUrl:s,forceLogin:!0}).then(t=>(null==e||e.signOut(),t))}{const e=`${n}/home/pages/Account/manage_accounts.html#client_id=${i}&redirect_uri=${window.location.href}#`;this.removeAuthInfo(),window.location.href=e}}defer(){const e={promise:null,resolve:null,reject:null};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}generateToken(e){return la(this,arguments,void 0,function*(e,t="",r="same-origin"){const n=hl(`${Yn(e)}/generateToken?f=json`,le.Https),i=t||"",o={cache:"no-cache",credentials:r};return yield fetch(`${n}&${i}`,o).then(e=>la(this,void 0,void 0,function*(){return yield e.json()})).then(e=>e.error?null:e,e=>null)})}generateSeverSessionByPortalSession(e,t){return la(this,arguments,void 0,function*(e,t,r="same-origin"){const n=(t||"").trim().replace(/rest(.*)/gi,"").replace(/\/*$/g,""),i=hl(fl(window.location.href),le.Https),o=`serverUrl=${n}&referer=${i}&token=${e.token}`;return this.generateToken(Xn(e.portal),o,r).then(t=>{if(t){const r=new zi({portal:e.portal,server:n,token:t.token,tokenExpires:new Date(t.expires),ssl:t.ssl,username:e.username});return this.addOrReplaceSession(r),r}return null})})}getPortalSelf(e){return la(this,void 0,void 0,function*(){const t=hl(`${Yn(e)}/portals/self?f=json`,le.Https);return yield fetch(t,{cache:"no-cache",credentials:"include"}).then(e=>la(this,void 0,void 0,function*(){return yield e.json()}))})}getSessionFromWebTierPortal(e,t,r){let n,i;return i=r?Promise.resolve(r):this.getPortalSelf(e),i.then(r=>la(this,void 0,void 0,function*(){return n=r,yield this.generateToken(e,t,"include")})).then(t=>{if(t&&t.token){const r={token:t.token,expires:t.expires,userId:n.user?n.user.username:"",ssl:t.ssl,server:Yn(e)},i={hasPortal:!1,hasServer:!1,server:""};return zi.fromCredential(r,i)}return null}).catch(()=>null)}getSessionFromWebTierServer(e){return la(this,void 0,void 0,function*(){if(!si(e))return Promise.resolve(null);const t=ci(e),r=this.getSessionByUrl(e);if(r)return yield Promise.resolve(r);{const r=hl(fl(window.location.href),le.Https);return yield fetch(t+"/rest/info?f=json",{cache:"no-cache",credentials:"include"}).then(e=>la(this,void 0,void 0,function*(){return yield e.json()})).then(t=>la(this,void 0,void 0,function*(){const n=t.owningSystemUrl;if(n){const t=`referer=${r}`;return this.getSessionFromWebTierPortal(n,t).then(t=>la(this,void 0,void 0,function*(){if(t){this.addOrReplaceSession(t);const r=yield this.generateSeverSessionByPortalSession(t,e,"include");return r&&this.addOrReplaceSession(r),t}return null}))}{const t=ci(e),r=`${t}/rest/self?f=json`,n=yield fetch(r,{credentials:"include"}).then(e=>la(this,void 0,void 0,function*(){return yield e.json()}));if(n){const e=(new Date).getTime()+31536e6,r=new zi({server:t,token:"",tokenExpires:new Date(e),username:null==n?void 0:n.user.username});return r.portal=void 0,this.addOrReplaceSession(r),r}return null}})).catch(e=>(console.warn("Failed to get session from trusted server."),null))}})}getSessionType(e){return e.portal&&e.server?aa.ServerSessionFederated:e.server?e.token?aa.ServerSessionStandAlone:aa.ServerSessionStandAloneWebTier:e.portal?aa.PortalSession:void 0}addFromCredential(e,t,r,n){return la(this,void 0,void 0,function*(){var i;let o;if(!e.server)return null;if(e.token&&e.expires)if("server"===e.scope)o=new zi({server:e.server,token:e.token,tokenExpires:new Date(e.expires),ssl:e.ssl,username:e.userId}),(null==r?void 0:r.owningSystemUrl)?o.portal=`${null==r?void 0:r.owningSystemUrl}/sharing/rest`:o.portal=void 0;else{const t=Yn(e.server);o=new zi({portal:t,token:e.token,tokenExpires:new Date(e.expires),ssl:e.ssl,username:e.userId,clientId:null==n?void 0:n.appId,redirectUri:null==n?void 0:n.popupCallbackUrl,refreshToken:null===(i=null==n?void 0:n._oAuthCred)||void 0===i?void 0:i.refreshToken})}else{const{portalUrl:t,isWebTier:r}=Ya().getState(),n=r&&Qn(e.server,t);(this.isTrustedServer(e.server)||n)&&(o="server"===e.scope?yield this.getSessionFromWebTierServer(e.server):yield this.getSessionFromWebTierPortal(e.server))}const s=this.sessions?this.sessions[this.getSessionKeyFromSession(o)]:null;return!this.isSameSession(o,s)&&this.doAddOrReplaceSession(o)&&(this.syncToOtherWindowSessionManager(),this.onSessionChanged(t)),o})}syncToOtherWindowSessionManager(){if(window.jimuConfig.isBuilder){Ol("jimu-for-builder").builderAppSync.publishChangeSessionToApp()}else if(window.jimuConfig.isInBuilder){Ol("jimu-for-builder").appBuilderSync.publishAppSessionChangeToBuilder()}}syncSessionsFromOtherWindow(e){this.clearSessions(),e.forEach(e=>{const t=e.toJSON(),r=new zi(t);r.portal=e.portal,r.server=e.server,this.doAddOrReplaceSession(r)}),this.onSessionChanged(sa.OtherWindowSync)}syncNoPermissionResourceInfoListToOtherWindowSessionManager(){if(window.jimuConfig.isBuilder){Ol("jimu-for-builder").builderAppSync.publishNoPermissionResourceInfoListChangeToApp()}else if(window.jimuConfig.isInBuilder){Ol("jimu-for-builder").appBuilderSync.publishNoPermissionResourceInfoListChangeToBuilder()}}syncNoPermissionResourceInfoListFromOtherWindow(e){this.noPermissionResourceInfoList=_s(e),Ya().dispatch(qa())}readSessionFromParent(e){return la(this,void 0,void 0,function*(){return this.readSessionFromParentPromise=new Fo,window.parent.postMessage({type:"arcgis:auth:requestCredential"},e),this.readSessionFromParentPromise.promise})}canPostSessionTo(e){var t;const r=null===(t=window.trustedOrigins)||void 0===t?void 0:t.includes(e);return window.location.origin===e||e.endsWith(".arcgis.com")||r}tryToPendingSignInDialog(e){const t=this.getSessionKeyFromUrl(e);if(t){if(this.signInDialogPendingList[t])return this.signInDialogPendingList[t];{const e=new Fo;return this.signInDialogPendingList[t]=e,null}}return null}releasePendingSignIn(e,t){const r=this.getSessionKeyFromUrl(e),n=this.signInDialogPendingList[r];n&&(t?n.reject(t):n.resolve(null),delete this.signInDialogPendingList[r])}getNoPermissionResourceKey(e){let t;const r="/sharing/rest/content/items";if(si(e))t=li(e);else{const n=ri(ei(e));if(e.includes(r)){const i=e.indexOf(r)+27;t=ti(n,e.substr(i+1).split("/")[0])}else t=null}return t}addToNoPermissionResourceInfoList(e,t,r,n,i){var o;const s=this.getNoPermissionResourceKey(e);if(!s)return;const a=this.noPermissionResourceInfoList[s],l=Qn(ri(null===(o=this.getMainPortal())||void 0===o?void 0:o.portalUrl),ri(ei(i||e)));a&&a.userName===t||(this.noPermissionResourceInfoList[s]={owningSystemUrl:i||"",userName:t||"",ignored:n||!1,signInErrorCode:r||oa.Other,allowSignIn:!(l&&(window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder))},this.syncNoPermissionResourceInfoListToOtherWindowSessionManager(),Ya().dispatch(qa()))}removeFromNoPermissionResourceInfoList(e){const t={},r=this.getNoPermissionResourceKey(e);let n=!1;this.noPermissionResourceInfoList[r]&&(t[r]=this.noPermissionResourceInfoList[r],delete this.noPermissionResourceInfoList[r],n=!0);const i=!this.getServerKeyFromUrl(e)&&ei(e)===e,o=ai(e)&&ci(e)===e;return(i||o)&&Object.entries(this.noPermissionResourceInfoList).forEach(r=>{const i=r[0];r[1].owningSystemUrl!==e&&ei(i)!==ri(e)&&ci(i)!==e||(t[i]=this.noPermissionResourceInfoList[i],delete this.noPermissionResourceInfoList[i],n=!0)}),n?(this.syncNoPermissionResourceInfoListToOtherWindowSessionManager(),Ya().dispatch(qa()),t):null}ignoreFromNoPermissionResourceInfoList(e){let t=!1;if(!e)Object.entries(this.noPermissionResourceInfoList).forEach(e=>{const r=e[0];e[1].ignored||(this.noPermissionResourceInfoList[r].ignored=!0,t=!0)});else{const r=!this.getServerKeyFromUrl(e),n=this.getNoPermissionResourceKey(e),i=ci(`${e}/rest/services`)===e;this.noPermissionResourceInfoList[n]&&(this.noPermissionResourceInfoList[n].ignored=!0,t=!0),(r||i)&&Object.entries(this.noPermissionResourceInfoList).forEach(r=>{const n=r[0],i=r[1],o=i.owningSystemUrl===ri(e),s=ei(n)===ri(e),a=ci(n)===e;!i.ignored&&(o||s||a)&&(this.noPermissionResourceInfoList[n].ignored=!0,t=!0)})}t&&(this.syncNoPermissionResourceInfoListToOtherWindowSessionManager(),Ya().dispatch(qa()))}getNoPermissionResourceInfoList(){return this.noPermissionResourceInfoList}setNoPermissionResourceInfoList(e){this.noPermissionResourceInfoList=e,this.syncNoPermissionResourceInfoListToOtherWindowSessionManager(),Ya().dispatch(qa())}getNoPermissionResourceInfoByUrl(e){const t=this.getNoPermissionResourceKey(e);return this.noPermissionResourceInfoList[t]}checkSessionPermissionForUrl(e,t,r,n){e&&t&&this.isValidToken(e,t).then(t=>{var i,o;(null==t?void 0:t.valid)?this.removeFromNoPermissionResourceInfoList(e):403===(null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.code)?this.addToNoPermissionResourceInfoList(e,r,oa.NoPermission,!1,n):498===(null===(o=null==t?void 0:t.error)||void 0===o?void 0:o.code)&&this.addToNoPermissionResourceInfoList(e,r,oa.InvalidToken,!1,n)})}handleInvalidToken(e){var t,r;const n=Qn(ri(null===(t=this.getMainPortal())||void 0===t?void 0:t.portalUrl),ri(ei(e))),i=Ya().getState(),o=this.sessions&&this.sessions[this.getSessionKeyFromUrl(e)];if(this.removeSession(o),Object.keys(this.requestCacheForValidatingToken).forEach(t=>{t.includes(li(ml(e)))&&delete this.requestCacheForValidatingToken[t]}),n&&(window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder||(null===(r=i.appInfo)||void 0===r?void 0:r.access)&&"public"!==i.appInfo.access)&&(this.gotoPrivilegeErrorPage(Ms.PrivilegeInvalidMainSession),window.jimuConfig.isInBuilder)){Ol("jimu-for-builder").appBuilderSync.publishCheck498ErrorToBuilder(e)}}isSignInPromptBlocked(){var e,t;if(window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder||window.jimuConfig.isSite)return!1;return null===(t=((null===(e=null===window||void 0===window?void 0:window.jimuConfig)||void 0===e?void 0:e.isBuilder)?Ya().getState().appStateInBuilder:Ya().getState()).appConfig.permission)||void 0===t?void 0:t.blockSignInPrompt}}const pa=ha;var fa,ma,ga,va,ya;!function(e){e.All="ALL",e.Simple="SIMPLE"}(fa||(fa={})),function(e){e.And="AND",e.Or="OR"}(ma||(ma={})),function(e){e.None="NONE",e.Previous="PREVIOUS",e.All="ALL"}(ga||(ga={})),function(e){e.StringOperatorIs="STRING_OPERATOR_IS",e.StringOperatorIsNot="STRING_OPERATOR_IS_NOT",e.StringOperatorContains="STRING_OPERATOR_CONTAINS",e.StringOperatorDoesNotContain="STRING_OPERATOR_DOES_NOT_CONTAIN",e.StringOperatorStartsWith="STRING_OPERATOR_STARTS_WITH",e.StringOperatorDoesNotStartWith="STRING_OPERATOR_DOES_NOT_START_WITH",e.StringOperatorEndsWith="STRING_OPERATOR_ENDS_WITH",e.StringOperatorDoesNotEndWith="STRING_OPERATOR_DOES_NOT_END_WITH",e.StringOperatorIsAnyOf="STRING_OPERATOR_IS_ANY_OF",e.StringOperatorIsNoneOf="STRING_OPERATOR_IS_NONE_OF",e.StringOperatorIsBlank="STRING_OPERATOR_IS_BLANK",e.StringOperatorIsNotBlank="STRING_OPERATOR_IS_NOT_BLANK",e.NumberOperatorIs="NUMBER_OPERATOR_IS",e.NumberOperatorIsNot="NUMBER_OPERATOR_IS_NOT",e.NumberOperatorIsAtLeast="NUMBER_OPERATOR_IS_AT_LEAST",e.NumberOperatorIsAtMost="NUMBER_OPERATOR_IS_AT_MOST",e.NumberOperatorIsLessThan="NUMBER_OPERATOR_IS_LESS_THAN",e.NumberOperatorIsGreaterThan="NUMBER_OPERATOR_IS_GREATER_THAN",e.NumberOperatorIsBetween="NUMBER_OPERATOR_IS_BETWEEN",e.NumberOperatorIsNotBetween="NUMBER_OPERATOR_IS_NOT_BETWEEN",e.NumberOperatorIsAnyOf="NUMBER_OPERATOR_IS_ANY_OF",e.NumberOperatorIsNoneOf="NUMBER_OPERATOR_IS_NONE_OF",e.NumberOperatorIsBlank="NUMBER_OPERATOR_IS_BLANK",e.NumberOperatorIsNotBlank="NUMBER_OPERATOR_IS_NOT_BLANK",e.DateOperatorIsOn="DATE_OPERATOR_IS_ON",e.DateOperatorIsNotOn="DATE_OPERATOR_IS_NOT_ON",e.DateOperatorIsIn="DATE_OPERATOR_IS_IN",e.DateOperatorIsNotIn="DATE_OPERATOR_IS_NOT_IN",e.DateOperatorIsBefore="DATE_OPERATOR_IS_BEFORE",e.DateOperatorIsAfter="DATE_OPERATOR_IS_AFTER",e.DateOperatorIsOnOrBefore="DATE_OPERATOR_IS_ON_OR_BEFORE",e.DateOperatorIsOnOrAfter="DATE_OPERATOR_IS_ON_OR_AFTER",e.DateOperatorIsInTheLast="DATE_OPERATOR_IS_IN_THE_LAST",e.DateOperatorIsNotInTheLast="DATE_OPERATOR_IS_NOT_IN_THE_LAST",e.DateOperatorIsInTheNext="DATE_OPERATOR_IS_IN_THE_NEXT",e.DateOperatorIsNotInTheNext="DATE_OPERATOR_IS_NOT_IN_THE_NEXT",e.DateOperatorIsBetween="DATE_OPERATOR_IS_BETWEEN",e.DateOperatorIsNotBetween="DATE_OPERATOR_IS_NOT_BETWEEN",e.DateOperatorIsBlank="DATE_OPERATOR_IS_BLANK",e.DateOperatorIsNotBlank="DATE_OPERATOR_IS_NOT_BLANK",e.DateOnlyOperatorIsOn="DATE_ONLY_OPERATOR_IS_ON",e.DateOnlyOperatorIsNotOn="DATE_ONLY_OPERATOR_IS_NOT_ON",e.DateOnlyOperatorIsBefore="DATE_ONLY_OPERATOR_IS_BEFORE",e.DateOnlyOperatorIsAfter="DATE_ONLY_OPERATOR_IS_AFTER",e.DateOnlyOperatorIsOnOrBefore="DATE_ONLY_OPERATOR_IS_ON_OR_BEFORE",e.DateOnlyOperatorIsOnOrAfter="DATE_ONLY_OPERATOR_IS_ON_OR_AFTER",e.DateOnlyOperatorIsBetween="DATE_ONLY_OPERATOR_IS_BETWEEN",e.DateOnlyOperatorIsNotBetween="DATE_ONLY_OPERATOR_IS_NOT_BETWEEN",e.DateOnlyOperatorIsBlank="DATE_ONLY_OPERATOR_IS_BLANK",e.DateOnlyOperatorIsNotBlank="DATE_ONLY_OPERATOR_IS_NOT_BLANK",e.TimeOnlyOperatorIsOn="TIME_ONLY_OPERATOR_IS_ON",e.TimeOnlyOperatorIsNotOn="TIME_ONLY_OPERATOR_IS_NOT_ON",e.TimeOnlyOperatorIsBefore="TIME_ONLY_OPERATOR_IS_BEFORE",e.TimeOnlyOperatorIsAfter="TIME_ONLY_OPERATOR_IS_AFTER",e.TimeOnlyOperatorIsOnOrBefore="TIME_ONLY_OPERATOR_IS_ON_OR_BEFORE",e.TimeOnlyOperatorIsOnOrAfter="TIME_ONLY_OPERATOR_IS_ON_OR_AFTER",e.TimeOnlyOperatorIsBetween="TIME_ONLY_OPERATOR_IS_BETWEEN",e.TimeOnlyOperatorIsNotBetween="TIME_ONLY_OPERATOR_IS_NOT_BETWEEN",e.TimeOnlyOperatorIsBlank="TIME_ONLY_OPERATOR_IS_BLANK",e.TimeOnlyOperatorIsNotBlank="TIME_ONLY_OPERATOR_IS_NOT_BLANK"}(va||(va={})),function(e){e.UserInput="USER_INPUT",e.Field="FIELD",e.SingleSelectFromUnique="UNIQUE",e.MultipleSelectFromUnique="MULTIPLE",e.SingleSelectFromPredefined="UNIQUE_PREDEFINED",e.MultipleSelectFromPredefined="MULTIPLE_PREDEFINED"}(ya||(ya={}));var Sa,Ia,wa,Ea;!function(e){e.Single="SINGLE",e.Set="SET"}(Sa||(Sa={})),function(e){e.Inline="INLINE",e.Block="BLOCK"}(Ia||(Ia={})),function(e){e.None="NONE",e.UseAskForValue="USE_ASK_FOR_VALUE",e.UseLabel="USE_LABEL"}(wa||(wa={})),function(e){e.Asc="ASC",e.Desc="DESC"}(Ea||(Ea={}));var ba,Ra;!function(e){e.Now="NOW",e.Min="MIN",e.Max="MAX",e.Today="TODAY",e.Tomorrow="TOMORROW",e.Yesterday="YESTERDAY",e.ThisWeek="THIS_WEEK",e.ThisMonth="THIS_MONTH",e.ThisQuarter="THIS_QUARTER",e.ThisYear="THIS_YEAR"}(ba||(ba={})),function(e){e.Minute="MINUTE",e.Hour="HOUR",e.Day="DAY",e.Week="WEEK",e.Month="MONTH",e.Year="YEAR"}(Ra||(Ra={}));m(30430);var Ta;!function(e){e.Date="DATE",e.DateTimeShort="DATE_TIME_SHORT",e.DateTimeLong="DATE_TIME_LONG"}(Ta||(Ta={}));var Na;!function(e){e.Point="POINT",e.Polyline="POLYLINE",e.Polygon="POLYGON"}(Na||(Na={}));m(30430);var Oa=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Ca(e,t){return Oa(this,arguments,void 0,function*(e,t,r=1,n=!1){if(function(){var e,t;return!(null===(t=null===(e=Ya().getState())||void 0===e?void 0:e.appContext)||void 0===t?void 0:t.isInBuilder)}()){const t=function(e){var t,r;const n=null===(r=null===(t=Ya().getState())||void 0===t?void 0:t.appConfig)||void 0===r?void 0:r.appProxies;if(!e||!n)return null;const i=Object.values(n);for(let t=0;t<i.length;t++){const r=i[t],n=r.sourceUrl.replace(/\/*$/g,""),o=r.proxyUrl;if(n&&o&&0===e.indexOf(n))return o+e.replace(n,"")}return null}(e);t&&t!==e&&(e=t)}const i=(o,s=0)=>t(o).catch(t=>{if(s>=r)return Promise.reject(Aa(t));const a=t.options,l=ha.getInstance(),c="ArcGISAuthError"===t.name&&a&&(!a.authentication||498===t.code||403===t.code||"AUTHENTICATION_ERROR_CODE"===t.code||"GWM_0003"===t.code),u="ArcGISRequestError"===t.name&&(403===t.code||"GWM_0003"===t.code);return c||u?(498===t.code&&l.handleInvalidToken(e),La(e,n).then(e=>i(e,s+1)).catch(e=>Promise.reject(Aa(e)))):i(o,s+1)}),o=ha.getInstance(),s=o.getSessionByUrl(e);return s?i(s):o.getServerKeyFromUrl(e)?Pa.getInstance().fetchArcGISServerInfo(e).then(t=>Oa(this,void 0,void 0,function*(){if(null==t?void 0:t.owningSystemUrl){const r=o.getSessionByUrl(t.owningSystemUrl);return r&&(yield La(e)),i(r)}return i(void 0)})):i(void 0)})}function La(e,t=!1){const r=ha.getInstance(),n=r.getServerKeyFromUrl(e);let i,o="";const s=r.getNoPermissionResourceInfoByUrl(e),a=r.isSignInPromptBlocked();if(t=t&&(null==s?void 0:s.allowSignIn),s&&!t){const t=r.getSessionByUrl(e);return i=t?Promise.resolve(t):Promise.reject(r.getSignInErrorByCode(s.signInErrorCode)),i}if(a&&!t){let t;t=n?Pa.getInstance().fetchArcGISServerInfo(e).then(e=>e):Promise.resolve(null),i=t.then(t=>Oa(this,void 0,void 0,function*(){const n=t?t.owningSystemUrl:e,i=r.getSessionByUrl(n);return o=null==t?void 0:t.owningSystemUrl,i?Promise.resolve(i):Promise.reject(r.getSignInErrorByCode(oa.SignInCanceled))}))}else i=n?Pa.getInstance().fetchArcGISServerInfo(e).then(n=>Oa(this,void 0,void 0,function*(){if(null==n?void 0:n.owningSystemUrl){const i=r.getClientIdByUrl(null==n?void 0:n.owningSystemUrl);let s;if(o=null==n?void 0:n.owningSystemUrl,i)s=r.signIn({popup:!0,desUrl:null==n?void 0:n.owningSystemUrl,clientId:i,forceLogin:t,federatedServiceUrl:e}).then(e=>e);else{if(!window.jimuConfig.isBuilder&&!window.jimuConfig.isInBuilder)return r.nonOAuthSignIn(e,t);s=r.useDialogToSetClientIdToConnectionsOfAppConfig(n.owningSystemUrl).then(i=>{const o=i||r.getClientIdByUrl(n.owningSystemUrl);return r.signIn({popup:!0,desUrl:n.owningSystemUrl,clientId:o,forceLogin:t,federatedServiceUrl:e})})}return s}return r.nonOAuthSignIn(e,t)})):r.signIn({popup:!0,desUrl:e});return i.then(t=>(r.checkSessionPermissionForUrl(e,t.token,t.username,o),t)).catch(t=>(t.code===oa.SignInCanceled&&r.addToNoPermissionResourceInfoList(e,"",oa.SignInCanceled,!1,o),Promise.reject(t)))}function Aa(e){const t=ha.getInstance(),r=t.getSignInErrorCodeByAuthError(e);return r?t.getSignInErrorByCode(r):e}const Da={};window._cachedRequests=Da;var _a=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Pa{constructor(){this.servicesInfo={},this.servicesInfoPromise={},this.arcGISServersInfo={},this.arcGISServersInfoPromise={}}static getInstance(){return window.jimuConfig&&window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._serviceManager?window._appWindow._serviceManager:(console.error("Please wait for app loaded."),null):(Pa.instance||(Pa.instance=new Pa,window._serviceManager=Pa.instance),Pa.instance)}getServiceInfo(e){return this.servicesInfo[e]}setServiceInfo(e,t){this.servicesInfo[e]=t}getServerInfo(e){return this.arcGISServersInfo[e]}getServerInfoByServiceUrl(e){return this.arcGISServersInfo[this.getArcGISServerUrlFromServiceUrl(e)]}clearServiceInfo(e){e&&Object.keys(this.servicesInfoPromise).forEach(t=>{t.startsWith(e)&&(delete this.servicesInfoPromise[t],delete this.servicesInfo[t])})}fetchServiceInfo(e){return _a(this,void 0,void 0,function*(){return this.getServiceInfo(e)?Promise.resolve(this.getServiceInfo(e)):(this.servicesInfoPromise[e]||(this.servicesInfoPromise[e]=this.isHostedServiceInSamePortal(e).then(t=>_a(this,void 0,void 0,function*(){return Ca(e,r=>_a(this,void 0,void 0,function*(){return Li(e,{authentication:r,httpMethod:"GET"}).then(e=>({definition:e,isHostedInSamePortal:t}))}),1)})).then(t=>(this.servicesInfo[e]=t,t))),this.servicesInfoPromise[e])})}isHostedServiceInSamePortal(e){return _a(this,void 0,void 0,function*(){return this.fetchArcGISServerInfo(e).then(t=>(null==t?void 0:t.owningSystemUrl)?!(!/https?:\/\/(www|services)\.arcgis\.com/.test(t.owningSystemUrl)||!/maps\.arcgis\.com\/?$/.test(Ya().getState().portalUrl))||(!(!/https?:\/\/(devext|servicesdev)\.arcgis\.com/.test(t.owningSystemUrl)||!/mapsdevext\.arcgis\.com\/?$/.test(Ya().getState().portalUrl))||(!(!/https?:\/\/(qaext|servicesqa)\.arcgis\.com/.test(t.owningSystemUrl)||!/mapsqa\.arcgis\.com\/?$/.test(Ya().getState().portalUrl))||Qn(Ya().getState().portalUrl,t.owningSystemUrl))):!!pa.getInstance().getSessionByUrl(e))})}fetchArcGISServerInfo(e){return _a(this,void 0,void 0,function*(){const t=this.getArcGISServerUrlFromServiceUrl(e);return t?(this.arcGISServersInfoPromise[t]||(this.arcGISServersInfoPromise[t]=Li(t,{httpMethod:"GET"}).then(e=>(this.arcGISServersInfo[t]=e,e)).catch(e=>_a(this,void 0,void 0,function*(){return console.warn("Failed to fetch ArcGIS server info."),Promise.resolve(null)}))),this.arcGISServersInfoPromise[t]):Promise.resolve(null)})}getArcGISServerUrlFromServiceUrl(e){const t=ci(e);return t?t+"/rest/info":null}isHostedService(e){return _a(this,void 0,void 0,function*(){const t=e.split(/\/rest(\/admin)?\/services\//)[0];return t?Li(t+"/rest/info",{httpMethod:"GET"}).then(e=>!!e.owningSystemUrl):Promise.resolve(!1)})}fetchChildLayerDefinitionsFromUrls(e){return _a(this,void 0,void 0,function*(){return Promise.allSettled(e.map(e=>_a(this,void 0,void 0,function*(){return this.fetchServiceInfo(e).then(e=>e.definition)}))).then(t=>{const r={};let n;return t.forEach((t,i)=>{const o="fulfilled"===t.status?t.value:null;o&&(n=e[i],r[n]=o)}),r}).then(e=>{const t=Object.keys(e).map(t=>e[t]),r=this._getAllChildLayerIdsOfGroupLayer(t),n={};return Object.keys(e).forEach(t=>{r.some(r=>{var n;return r===`${null===(n=e[t])||void 0===n?void 0:n.id}`})||(n[t]=e[t])}),n})})}_getAllChildLayerIdsOfGroupLayer(e){if(!e||0===e.length)return[];const t=e.filter(e=>e.type===ln.GroupLayer);return this._getChildLayerIdsFromGroupLayerDefinitions(t)}_getChildLayerIdsFromGroupLayerDefinitions(e){return 0===e.length?[]:Array.prototype.concat.apply([],e.map(e=>(null==e?void 0:e.subLayers.map(e=>`${e.id}`))||[]))}}var xa=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Ma{static getInstance(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._dataSourceManager:(Ma.instance||(Ma.instance=new Ma,window._dataSourceManager=Ma.instance),Ma.instance)}constructor(){this.dataSources={},this.dataSourcesCreatePromise={},this.dataSourceFactories={},this.childDataSourcesPendedByTime=[],this.throttleDispatchPendedNotCreatedStatus=jn(this.dispatchPendedNotCreatedStatus.bind(this),200,{leading:!1,trailing:!0}),this.throttleDispatchPendedCreatedStatus=jn(this.dispatchPendedCreatedStatus.bind(this),200,{leading:!1,trailing:!0}),this.traversedDataSourceIdsByTime=new Set([]),this.notCreatedDataSourceIds=new Set([]),this.createdDataSourceIds=new Set([]),this.doNotBatchStatusDataSourceIds=new Set([]),window.jimuConfig.isBuilder?console.error("DataSourceManager should not be created in builder"):(Xa(this.onStoreDataSourcesChange.bind(this),["appConfig","dataSources"]),Xa(this.onStoreResourceSessionsChange.bind(this),["resourceSessions"]))}getDataSource(e){return this.dataSources[e]}getDataViewDataSource(e,t){return this.dataSources[this.getDataViewDataSourceId(e,t)]}getDataSources(){return this.dataSources}getDataSourcesAsArray(){return Object.keys(this.dataSources).map(e=>this.dataSources[e])}setDataSource(e,t){this.dataSources[e]=t}destroyAllDataSources(){Object.keys(this.dataSources).forEach(e=>{this.destroyDataSource(e)}),this.dataSourcesCreatePromise={}}destroyDataSource(e){var t;(null===(t=this.dataSources[e])||void 0===t?void 0:t.type)===sn.Error&&this.destroyDataSource(this.restoreErrorDataSourceId(e)),this.dataSources[e]?(Ya().dispatch(Ha(e)),this.dataSources[e].getDataViews().forEach(e=>{this.destroyDataSource(e.id)}),this.dataSources[e].getLocalDataSources().forEach(e=>{this.destroyDataSource(e.id)}),this.getDataSourcesAsArray().forEach(t=>{t.getOriginDataSources().find(t=>t===this.dataSources[e])&&this.destroyDataSource(t.id)}),this.dataSources[e].destroy(),delete this.dataSources[e],delete this.dataSourcesCreatePromise[e]):this.dataSourcesCreatePromise[e]&&(Ya().dispatch(Ha(e)),delete this.dataSourcesCreatePromise[e]),this.doNotBatchStatusDataSourceIds.delete(e),this.traversedDataSourceIdsByTime.delete(e),this.notCreatedDataSourceIds.delete(e),this.createdDataSourceIds.delete(e)}getConfiguredDataSources(){return Object.keys(this.dataSources).filter(e=>!this.dataSources[e].getDataSourceJson().isOutputFromWidget).map(e=>this.getDataSource(e)).filter(e=>{var t,r;return null===(t=this.getAppConfig().dataSources)||void 0===t?void 0:t[(null===(r=e.getRootDataSource())||void 0===r?void 0:r.id)||e.id]})}getWidgetGeneratedDataSources(){const e={},t=this.getAppConfig();return Object.keys(t.widgets).filter(e=>t.widgets[e].outputDataSources).forEach(r=>{e[r]=t.widgets[r].outputDataSources.asMutable().map(e=>this.getDataSource(e))}),e}createAllDataSources(){const e=this.getAppConfig()&&this.getAppConfig().dataSources,t=[];return e&&Object.keys(e).forEach(e=>{this.dataSources[e]||t.push(this.createDataSource(e).then(e=>e.isDataSourceSet()&&!e.getRootDataSource()?e.childDataSourcesReady().then(()=>e):e).catch(t=>(console.error("Create data source failed",e,t),Promise.resolve(null))))}),Promise.all(t).then(e=>Promise.all(this.getDataSourcesAsArray().filter(e=>e.getMainDataSource().id===e.id).map(e=>this.createDataViews(e))).then(()=>e))}createAllDataSourcesByTime(){return xa(this,arguments,void 0,function*(e=30,t=1e3){for(;!this.areAllDataSourcesCreated();){const r=this.getDataSourcesAsArray().filter(e=>e.type!==sn.Error&&e.getMainDataSource().id===e.id&&!this.traversedDataSourceIdsByTime.has(e.id)).reverse();r.length?this.createDataSourcesAndTheirDataViewsByUseDataSources(this.getChildUseDataSourcesFromParentDss(e,r)):this.createDataSourcesAndTheirDataViewsByUseDataSources(this.getRootUseDataSourcesFromConfig(e)),yield this.delay(t)}this.getDataSourcesAsArray().forEach(e=>{e.query&&Object.keys(e.getDataSourceJson().dataViews||{}).some(t=>!this.getDataViewDataSource(e.id,t))&&this.createDataViews(e)})})}delay(e){return new Promise(t=>{const r=setTimeout(()=>{clearTimeout(r),t()},e)})}areAllDataSourcesCreated(){var e,t;return!Object.keys(null!==(t=null===(e=this.getAppConfig())||void 0===e?void 0:e.dataSources)&&void 0!==t?t:{}).some(e=>{var t,r;const n=this.getDataSource(e);return(null==n?void 0:n.isDataSourceSet())?!n.areChildDataSourcesCreated():![on.Created,on.CreateError].includes(null===(r=null===(t=Ya().getState().dataSourcesInfo)||void 0===t?void 0:t[e])||void 0===r?void 0:r.instanceStatus)})}getChildUseDataSourcesFromParentDss(e,t){const r=t.reduce((e,t)=>t.isDataSourceSet()?e.concat(t.getChildDataSourceIds().map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:(t.getRootDataSource()||t).id}))):e,[]).filter(e=>!this.dataSourcesCreatePromise[e.dataSourceId]&&!this.childDataSourcesPendedByTime.some(t=>t.dataSourceId===e.dataSourceId));return r.unshift(...this.childDataSourcesPendedByTime.splice(0)),r.length>e?this.childDataSourcesPendedByTime.push(...r.splice(e,r.length-e)):r.length<e&&r.push(...this.getRootUseDataSourcesFromConfig(e-r.length)),r}getRootUseDataSourcesFromConfig(e){const t=this.getAppConfig()&&this.getAppConfig().dataSources,r=[];return Object.keys(t).some(n=>(this.dataSourcesCreatePromise[n]||r.push({dataSourceId:t[n].id,mainDataSourceId:t[n].id}),r.length===e)),r}createDataSourcesAndTheirDataViewsByUseDataSources(e){return(null==e?void 0:e.length)?Promise.all(e.map(e=>this.createDataSourceAndItsDataViewsByUseDataSource(e,!0))).then(e=>e.filter(e=>!!e)):Promise.resolve([])}createDataViews(e){return e.id!==e.getMainDataSource().id?[]:Object.keys(e.getDataSourceJson().dataViews||{}).map(t=>this.createDataView(e,t))}createDataSource(e,t,r,n){let i,o;if("string"==typeof e){let t=this.getAppConfig().dataSources[e];if(!t&&!n)throw Error("Can not create data source."+e);o=e,t=t||an({id:o}),i={dataSourceJson:t,dataSourceManager:this,id:o}}else if(e.dataSourceJson||e.belongToDataSource)i=e,o=i.dataSourceJson?i.dataSourceJson.id:i.belongToDataSource.getMainDataSource().id,i.dataViewId&&(t=i.dataViewId,delete i.dataViewId),i.localId&&(r=i.localId,delete i.localId),i.dataSourceManager=this,i.id=o;else{const t=e;o=t.id,i={dataSourceJson:t,dataSourceManager:this,id:o}}const s=e=>this.dataSourcesCreatePromise[e]?this.dataSourcesCreatePromise[e]:this.createDataSource(e),a=(e,t)=>{const r=this.getDataViewDataSourceId(e,t);return this.getDataSource(r)?Promise.resolve(this.getDataSource(r)):s(o).then(e=>this.createDataView(e,t))};return t&&r?a(o,t).then(e=>this.createLocalDataSource(e,r)):t?a(o,t):r?s(o).then(e=>this.createLocalDataSource(e,r)):this.createOriginDataSources(i.dataSourceJson).catch(t=>(console.error("Create origin data source error.",e,t),Ya().dispatch($a(o,on.CreateError)),Promise.reject(new yn(o,t)))).then(()=>this.dataSourcesCreatePromise[o]?this.dataSourcesCreatePromise[o]:(this.dispatchNotCreatedStatus(o),this.dataSourcesCreatePromise[o]=new Promise((e,t)=>{n?t(new yn(o,"Create error outside createDataSource method.")):e(this.createDataSourceObj(i))}).then(e=>e.ready().then(()=>e.fetchSchema()).then(t=>{var r,n,i;e.setFetchedSchema(t),0===Object.keys(e.getSchema()).length&&this.initSchema(e,t);const o=[];if(Object.keys((null===(r=e.getSchema())||void 0===r?void 0:r.fields)||{}).length){const t=this.createDataViewObj(e,Zr);o.push(t);if(!!(null===(i=null===(n=e.getDataSourceJson())||void 0===n?void 0:n.dataViews)||void 0===i?void 0:i[en])){const t=this.createDataViewObj(e,en);o.push(t)}}return o.reduce((e,t)=>e.then(()=>t.ready().then(()=>{this.afterCreate(t)})),Promise.resolve()).then(()=>{if(this.afterCreate(e),e.getDataSourceJson().isOutputFromWidget){const t=this.createDataViewObj(e,tn);this.afterCreate(t)}return e})})).catch(t=>{const r=o&&(null==i?void 0:i.dataSourceJson),n=["not-authenticated","abort"],s=(null==t?void 0:t.isSignInError)||n.some(e=>{var r,n,i;return null===(i=null===(n=null===(r=null==t?void 0:t.name)||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r))||void 0===i?void 0:i.includes(e)})||n.some(e=>{var r,n,i;return null===(i=null===(n=null===(r=null==t?void 0:t.message)||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r))||void 0===i?void 0:i.includes(e)})||Object.keys(pa.getInstance().getNoPermissionResourceInfoList()||{}).some(e=>{var t,r;return(null===(t=i.dataSourceJson.url)||void 0===t?void 0:t.includes(e))||(null===(r=i.dataSourceJson.portalUrl)||void 0===r?void 0:r.includes(e))||e.includes(i.dataSourceJson.itemId)});if(r&&s){const e=this.getErrorDataSourceId(o),t=Object.assign(Object.assign({},i),{id:e,dataSourceJson:i.dataSourceJson.set("id",e).set("type",sn.Error)});this.dataSourcesCreatePromise[e]=this.createDataSourceObj(t).then(t=>(this.dataSources[e]=t,t))}return console.warn("Create data source error.",e,t),Ya().dispatch($a(o,on.CreateError)),Promise.reject(new yn(o,t))}),this.dataSourcesCreatePromise[i.dataSourceJson.id]))}createDataSourceAndWaitForChildrenReady(e){return xa(this,void 0,void 0,function*(){const t=yield this.createDataSource(e);return(null==t?void 0:t.isDataSourceSet())&&(yield t.childDataSourcesReady()),t})}createDataView(e,t){const r=this.getDataViewDataSourceId(e.id,t);if(this.getDataSource(r))return this.getDataSource(r);try{const r=this.createDataViewObj(e,t);return this.afterCreate(r),r}catch(r){return Ya().dispatch($a(this.getDataViewDataSourceId(e.id,t),on.CreateError)),null}}createLocalDataSource(e,t){const r=this.getLocalDataSourceId(e.id,t);return this.getDataSource(r)?this.getDataSource(r):this.createLocalDataSourceObj(e,t)}afterCreate(e){var t,r,n,i;this.dataSources[e.id]=e,this.dispatchCreatedStatus(e.id),e.isDataSourceSet()&&0===(null===(t=e.getChildIds())||void 0===t?void 0:t.length)&&e.setChildDataSourcesCreated(!0);const o=e.getMainDataSource().id;if(e.id!==o&&e.dataViewId!==Zr&&e.dataViewId!==en&&(null===(r=e.getMainDataSource().getSelectedRecordIds())||void 0===r?void 0:r.length)>0){const t=null===(i=null===(n=e.getMainDataSource().getSelectOptionsFromInfo())||void 0===n?void 0:n.asMutable)||void 0===i?void 0:i.call(n,{deep:!0});e.updateSelectionInfo(Object.assign(Object.assign({},t),{ids:e.getMainDataSource().getSelectedRecordIds()}),e.getMainDataSource())}}dispatchNotCreatedStatus(e){this.doNotBatchStatusDataSourceIds.has(e)?Ya().dispatch($a(e,on.NotCreated)):(this.notCreatedDataSourceIds.add(e),this.throttleDispatchPendedNotCreatedStatus())}dispatchCreatedStatus(e){const t=this.getDefaultDataSourceStatus(e);if(this.doNotBatchStatusDataSourceIds.has(e)||t===on.NotReady){const i=Ya().getState().dataSourcesInfo[e];Ya().dispatch((r=e,n=an(Object.assign(Object.assign({},null!=i?i:{}),{instanceStatus:on.Created,status:t,countStatus:t})),{type:ja.UpdateDataSourceInfo,dataSourceId:r,dataSourceInfo:n}))}else this.createdDataSourceIds.add(e),this.throttleDispatchPendedCreatedStatus();var r,n}dispatchPendedNotCreatedStatus(){if(this.notCreatedDataSourceIds.size){let e={};this.notCreatedDataSourceIds.forEach(t=>{var r;const n=null===(r=Ya().getState().dataSourcesInfo[t])||void 0===r?void 0:r.asMutable({deep:!0});(null==n?void 0:n.instanceStatus)||(e=Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},null!=n?n:{}),{instanceStatus:on.NotCreated})}))}),Object.keys(e).length>0&&Ya().dispatch(Wa(an(e))),this.notCreatedDataSourceIds.clear()}}dispatchPendedCreatedStatus(){if(this.createdDataSourceIds.size){let e={};this.createdDataSourceIds.forEach(t=>{var r;const n=null===(r=Ya().getState().dataSourcesInfo[t])||void 0===r?void 0:r.asMutable({deep:!0}),i=on.Unloaded;e=Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},null!=n?n:{}),{instanceStatus:on.Created,status:(null==n?void 0:n.status)||i,countStatus:(null==n?void 0:n.countStatus)||i})})}),Ya().dispatch(Wa(an(e))),this.createdDataSourceIds.forEach(e=>{var t,r;return null===(r=null===(t=this.getDataSource(e).parentDataSource)||void 0===t?void 0:t.updateAreChildDataSourcesCreated)||void 0===r?void 0:r.call(t)}),this.createdDataSourceIds.clear()}}getDefaultDataSourceStatus(e){const t=this.getDataSource(e);if(!t)return;const r=t.belongToDataSource&&t.belongToDataSource.getStatus(),n=r&&r!==on.NotReady;return t.getDataSourceJson().isOutputFromWidget&&!n?on.NotReady:on.Unloaded}getDataViewDataSourceId(e,t){return`${e}-${t}`}getLocalDataSourceId(e,t){return`${e}-${t}`}createDataSourceByUseDataSource(e,t,r){r||this.doNotBatchStatusDataSourceIds.add(e.dataSourceId);const n=this.getAppConfig().dataSources;return n[e.mainDataSourceId]?e.dataViewId?e.dataViewId===Zr||e.dataViewId===tn||n[e.mainDataSourceId].dataViews[e.dataViewId]?this.createDataSource(e.mainDataSourceId,e.dataViewId,t):(console.error(`Can not find data view: ${e.mainDataSourceId}, ${e.dataViewId}`),Promise.reject(new yn(e.dataSourceId,"Can not find data source."))):this.createDataSource(e.mainDataSourceId,null,t):n[e.rootDataSourceId]?this.createDataSource(e.rootDataSourceId).then(t=>t.isDataSourceSet()&&t.createDataSourceById(e.mainDataSourceId)).then(()=>{const r=this.getDataSource(e.mainDataSourceId);return r?e.dataViewId?e.dataViewId===Zr||r.getDataSourceJson().dataViews[e.dataViewId]?this.createDataSource(r.getDataSourceJson(),e.dataViewId,t):(console.error(`Can not find data view: ${e.mainDataSourceId}, ${e.dataViewId}`),Promise.reject(new yn(e.dataSourceId,"Can not find data source."))):t?this.createDataSource(r.getDataSourceJson(),null,t):r:Promise.reject(new yn(e.dataSourceId,"Can not find data source."))}):(console.error("Can not find data source:",e.dataSourceId),Promise.reject(new yn(e.dataSourceId,"Can not find data source.")))}createDataSourceAndItsDataViewsByUseDataSource(e,t){return this.createDataSourceByUseDataSource(e,null,t).then(e=>(this.createDataViews(e),e)).catch(e=>null)}createOriginDataSources(e){return e.isOutputFromWidget&&e.originDataSources&&e.originDataSources.length>0?Promise.all(e.originDataSources.asMutable().map(e=>this.createDataSourceByUseDataSource(e))).then(()=>Promise.resolve()):Promise.resolve()}initSchema(e,t){e.setFetchedSchema(t);const r=e.getDataSourceJson().schema;if(e.getDataSourceJson().isOutputFromWidget)if(e.getDataSourceJson().schema)e.setSchema(e.getDataSourceJson().schema);else if(e.getDataSourceJson().originDataSources&&e.getDataSourceJson().originDataSources.length>0)if(1===e.getDataSourceJson().originDataSources.length){const t=this.getDataSource(e.getDataSourceJson().originDataSources[0].dataSourceId);e.setSchema(t&&t.getSchema())}else console.error("Data source created from more than one data source must save the schema in app config.");else console.error("Data source without origin data source must save the schema in app config.");else{if(Ya().getState().appConfig.dataSources[e.id]&&(null==t?void 0:t.label)&&t.label!==e.getDataSourceJson().sourceLabel){il(Ya().getState().appConfig.setIn(["dataSources",e.id,"sourceLabel"],t.label))}const n=this.mergeSchema(e,r,t);e.setSchema(n)}}mergeSchema(e,t,r){if(e.isDataSourceSet()){if(!t)return r;let n=t;const i=e.getReversedConfigSchema();return Object.keys(r.childSchemas).forEach(o=>{if(i.childSchemas[o])i.childSchemas[o].forEach(t=>{n=n.setIn(["childSchemas",t.jimuChildId],e.getChildDataSource(t.jimuChildId).getSchema())});else{if(t.childSchemas[o])return void console.warn("Layer existed, please re-map the data source.",e.id,o);n=n.setIn(["childSchemas",o],r.childSchemas[o])}}),Object.keys(t.childSchemas).forEach(e=>{const n=t.childSchemas[e].childId;r.childSchemas[n]||console.error("Used data is not found.",n)}),n}return this.mergeOneSchema(e,t,r)}mergeOneSchema(e,t,r){if(!t)return r;let n=t;const i=e.getReversedConfigSchema();return(null==r?void 0:r.fields)&&Object.keys(r.fields).forEach(o=>{if(i.fields[o])i.fields[o].forEach(e=>{n.fields[e.jimuName].alias||(n=n.setIn(["fields",e.jimuName,"alias"],r.fields[o].alias))});else{if(t.fields[o])return void console.warn("Field name existed, please re-map the data source.",e.id,o);const i=r.fields[o];n=n.setIn(["fields",o],i)}}),(null==t?void 0:t.fields)&&Object.keys(t.fields).forEach(e=>{const n=t.fields[e].name;(null==r?void 0:r.fields)&&!r.fields[n]&&console.error("Used field is not found.",n)}),n}getDataSourceFactory(e){try{let t=this.getDataSourceFactorySync(e);if(t)return Promise.resolve(t);const r=this.getDataSourceFactoryUri(e);return Cl(r).then(e=>(t=new e.default,this.dataSourceFactories[r]=t,t))}catch(e){return Promise.reject(e)}}getDataSourceFactoryUri(e){const t=En.getInstance().getExtensions(vn.DataSourceFactoryUri).filter(t=>t.getFactoryUri(e))[0];if(!t)throw Error("Unknown data source type:"+e);return t.getFactoryUri(e)}getDataSourceFactorySync(e){const t=this.getDataSourceFactoryUri(e),r=this.dataSourceFactories[t];if(r)return r}createDataSourceObj(e){return this.getDataSourceFactory(e.dataSourceJson.type).then(t=>{let r;try{r=t.createDataSource(e)}catch(t){return console.error("Create data source error.",e.dataSourceJson,t),Promise.reject(new Error(t))}return Promise.resolve(r)})}createDataViewObj(e,t){const r=this.getDataSourceFactoryUri(e.type),n=this.dataSourceFactories[r];if(!n)throw Error("Data source is not created");return n.createDataSource({id:this.getDataViewDataSourceId(e.id,t),dataViewId:t,belongToDataSource:e,dataSourceManager:this})}createLocalDataSourceObj(e,t){const r=this.getDataSourceFactoryUri(e.type),n=this.dataSourceFactories[r];if(!n)throw Error("Data source is not created");let i=null;try{i=n.createDataSource({id:this.getLocalDataSourceId(e.id,t),dataViewId:e.isDataView?e.dataViewId:null,localId:t,belongToDataSource:e,dataSourceManager:this}),this.afterCreate(i)}catch(r){console.error("Create local data source error.",e.id,t,r),Ya().dispatch($a(this.getLocalDataSourceId(e.id,t),on.CreateError))}return i}getAppConfig(){return Ya().getState().appConfig}onStoreDataSourcesChange(e,t){e&&t&&Object.keys(e).forEach(r=>{if(t[r]){if(t[r]&&e[r]){const e=t[r],n=this.getDataSource(r);n&&(n.type!==e.type?Kn(()=>{this.destroyDataSource(r),this.createDataSource(r).then(e=>{this.createDataViews(e),window.jimuConfig.isInBuilder&&e.isDataSourceSet()&&e.childDataSourcesReady()})}):this.updateDataSourceByDataSourceJson(n,e))}}else Kn(()=>{this.destroyDataSource(r)})}),window.jimuConfig.isInBuilder&&e&&t&&Object.keys(t).forEach(t=>{var r;const n=Ya().getState();e[t]||(null===(r=n.dataSourcesInfo[t])||void 0===r?void 0:r.instanceStatus)||this.createDataSource(t).then(e=>{this.createDataViews(e),e.isDataSourceSet()&&e.childDataSourcesReady()})})}onStoreResourceSessionsChange(e,t){Kn(()=>xa(this,void 0,void 0,function*(){const r=[],n=[];this.getDataSourcesAsArray().forEach(i=>{var o;if(i.getMainDataSource().id!==i.id)return;const s=i.getDataSourceJson().url&&(null===(o=Pa.getInstance().getServerInfoByServiceUrl(i.getDataSourceJson().url))||void 0===o?void 0:o.owningSystemUrl),a=i.getDataSourceJson().url&&ci(i.getDataSourceJson().url),l=ei(s||a),c=ei(i.getDataSourceJson().portalUrl&&ri(i.getDataSourceJson().portalUrl));if(!l&&!c)return;const u=l&&(null==e?void 0:e[l])!==(null==t?void 0:t[l]),d=c&&(null==e?void 0:e[c])!==(null==t?void 0:t[c]);if(u||d){u&&Pa.getInstance().clearServiceInfo(i.getDataSourceJson().url);const e=i.getRootDataSource()||i;let t;if((null==e?void 0:e.type)===sn.WebMap||(null==e?void 0:e.type)===sn.WebScene)r.some(t=>t.id===e.id)||r.push(e),t=an({dataSourceId:e.id,mainDataSourceId:e.id});else{r.some(e=>e.id===i.id)||r.push(i);const n=i.type===sn.Error?this.restoreErrorDataSourceId(i.id):i.id;t=an({dataSourceId:n,mainDataSourceId:n,rootDataSourceId:null==e?void 0:e.id})}n.some(e=>e.dataSourceId===t.dataSourceId)||n.push(t)}}),yield Promise.all(r.map(e=>e.isDataSourceSet()?e.areSomeChildDataSourcesPending().then(t=>t&&r.splice(r.indexOf(e),1)):Promise.resolve())),r.forEach(e=>{this.destroyDataSource(e.id)}),n.forEach(e=>{this.createDataSourceByUseDataSource(e).then(e=>e.isDataSourceSet()?e.childDataSourcesReady().then(()=>e):e)})}))}getErrorDataSourceId(e){return`error${e.charAt(0).toUpperCase()}${e.slice(1)}`}restoreErrorDataSourceId(e){const t=e.replace(/^error/,"");return`${t.charAt(0).toLowerCase()}${t.slice(1)}`}updateDataSourceByDataSourceJson(e,t){var r,n;if(t&&!Xr(e.getDataSourceJson(),t)){if(Xr(e.getDataSourceJson().query,null==t?void 0:t.query)||Kn(()=>{e.clearRecords(),e.clearSelection()}),e.getDataSourceJson().dataViews!==(null==t?void 0:t.dataViews)){const r=e.getDataSourceJson().dataViews,n=null==t?void 0:t.dataViews;r&&n&&Object.keys(r).forEach(i=>{if(n[i]){if(n[i]&&r[i]){const r=this.getDataViewDataSourceId(e.id,i),n=this.getDataSource(r);n&&(Xr(n.getDataSourceJson().dataViews[i],t.dataViews[i])||Kn(()=>{n.clearRecords(),n.clearSelection()}))}}else Kn(()=>{this.destroyDataSource(this.getDataViewDataSourceId(e.id,i))})})}let i;if(e.isDataSourceSet()&&e.getDataSourceJson().childDataSourceJsons!==(null==t?void 0:t.childDataSourceJsons)&&e.getChildDataSources().forEach(e=>{var r;this.updateDataSourceByDataSourceJson(e,null===(r=null==t?void 0:t.childDataSourceJsons)||void 0===r?void 0:r[e.jimuChildId])}),(null===(r=e.getDataSourceJson().originDataSources)||void 0===r?void 0:r.length)===(null===(n=null==t?void 0:t.originDataSources)||void 0===n?void 0:n.length)){i=!e.getDataSourceJson().originDataSources||e.getDataSourceJson().originDataSources.every(e=>(null==t?void 0:t.originDataSources)&&(null==t?void 0:t.originDataSources.some(t=>t.dataSourceId===e.dataSourceId)))}else i=!1;const o=t&&(e.getDataSourceJson().schema!==t.schema||!i||e.getDataSourceJson().itemId!==t.itemId||e.getDataSourceJson().portalUrl!==t.portalUrl||e.getDataSourceJson().url!==t.url);e.setDataSourceJson(t),o&&(e.getDataSourceJson().isDataInDataSourceInstance?(e.clearSourceRecordsNotAddVersion(),this.initSchema(e,null)):(e.clearRecordsNotAddVersion(),e.fetchSchema().then(t=>{this.initSchema(e,t),e.addVersion()}))),Kn(()=>{e.addVersion()})}}}const ka=Ma;var ja;function Fa(e){return{type:ja.AppConfigChanged,appConfig:e}}function Ua(e,t){return{type:ja.WidgetsUpgraded,widgetUri:e,upgradeInfos:t}}function Ba(e,t){return{type:ja.WidgetUpgraded,widgetId:e,upgradeInfo:t}}function Va(e){return{type:ja.OpenWidget,widgetId:e}}function Ga(e,t){return{type:ja.I18nMessagesLoaded,key:e,messages:t}}function $a(e,t){return{type:ja.DataSourceInstanceStatusChanged,dataSourceId:e,status:t}}function Ha(e){return{type:ja.ClearDataSourceInfo,dataSourceId:e}}function Wa(e){return{type:ja.BatchUpdateDataSourceInfo,dataSourcesInfo:e}}function za(e){return{type:ja.SetSystemError,systemError:e}}function qa(){return{type:ja.UpdateNoPermissionResourceChangedFlag}}function Ja(e,t){return{type:ja.UpdateResourceSessions,resourceRootUrl:e,userName:t}}let Ka;!function(e){e.InitStoreExtensionState="INIT_STORE_EXTENSION_STATE",e.AppConfigLoaded="APP_CONFIG_LOADED",e.AppConfigChanged="APP_CONFIG_CHANGED",e.ThemeVariablesChanged="THEME_VARIABLES_CHANGED",e.SetPortalInfo="SET_PORTAL_INFO",e.SetPortalSelf="SET_PORTAL_SELF",e.WidgetClassLoaded="WIDGET_CLASS_LOADED",e.WidgetConfigLoaded="WIDGET_CONFIG_LOADED",e.WidgetsUpgraded="WIDGETS_UPGRADED",e.WidgetUpgraded="WIDGET_UPGRADED",e.OpenWidget="OPEN_WIDGET",e.OpenWidgets="OPEN_WIDGETS",e.CloseWidget="CLOSE_WIDGET",e.CloseWidgets="CLOSE_WIDGETS",e.ResetWidgetsState="RESET_WIDGETS_STATE",e.SetWidgetIsInlineEditingState="SET_WIDGET_IS_INLINE_EDITING_STATE",e.SetWidgetPreloadProps="SET_WIDGET_PRELOAD_PROPS",e.ActivateWidget="ACTIVATE_WIDGET",e.SetAppInBuilder="SET_APP_IN_BUILDER",e.LayoutClassLoaded="LAYOUT_CLASS_LOADED",e.AppContextInit="APP_CONTEXT_INIT",e.I18nMessagesLoaded="I18N_MESSAGES_LOADED",e.QueryObjectChanged="QUERY_OBJECT_CHANGED",e.UrlHashObjectChanged="URL_HASH_OBJECT_CHANGED",e.AppModeChanged="APP_MODE_CHANGED",e.SelectionChanged="SELECTION_CHANGED",e.AppRuntimeInfoInit="APP_RUNTIME_INFO_INIT",e.CurrentPageChanged="CURRENT_PAGE_CHANGED",e.CurrentDialogChanged="CURRENT_DIALOG_CHANGED",e.DialogInfosChanged="DIALOG_INFOS_CHANGED",e.ClipboardChanged="CLIPBOARD_CHANGED",e.AppPathChanged="APP_PATH_CHANGED",e.AppIdChanged="APP_ID_CHANGED",e.AppInfoChanged="APP_INFO_CHANGED",e.NetworkStatusChanged="NETWORK_STATUS_CHANGED",e.DataSourceStatusChanged="DATA_SOURCE_STATUS_CHANGED",e.DataSourceCountStatusChanged="DATA_SOURCE_COUNT_STATUS_CHANGED",e.DataSourceInstanceStatusChanged="DATA_SOURCE_INSTANCE_STATUS_CHANGED",e.DataSourceSaveStatusChanged="DATA_SOURCE_SAVE_STATUS_CHANGED",e.DataSourceVersionAdded="DATA_SOURCE_VERSION_ADDED",e.DataSourceSourceVersionAdded="DATA_SOURCE_SOURCE_VERSION_ADDED",e.DataSourceSelectedIndexesChanged="DATA_SOURCE_SELECTED_INDEXES_CHANGED",e.DataSourceSelectionChanged="DATA_SOURCE_SELECTION_CHANGED",e.SetDataSourcePreloadData="SET_DATA_SOURCE_PRELOAD_DATA",e.SetDataNeedRefresh="SET_DATA_NEED_REFRESH",e.SetDataLastRefreshTime="SET_DATA_LAST_REFRESH_TIME",e.UpdateWidgetQuery="UPDATE_WIDGET_QUERY",e.ChangeDataSourceGDBVersion="CHANGE_DATA_SOURCE_GDB_VERSION",e.ClearDataSourceInfo="CLEAR_DATA_SOURCE_INFO",e.UpdateDataSourceInfo="UPDATE_DATA_SOURCE_INFO",e.BatchUpdateDataSourceInfo="BATCH_UPDATE_DATA_SOURCE_INFO",e.JimuMapViewAdded="JIMU_MAP_VIEW_ADDED",e.JimuMapViewRemoved="JIMU_MAP_VIEW_REMOVED",e.JimuMapViewUpdated="JIMU_MAP_VIEW_UPDATED",e.MapWidgetInfoAdded="MAP_WIDGET_INFO_ADDED",e.MapWidgetInfoRemoved="MAP_WIDGET_INFO_REMOVED",e.MapWidgetInfoUpdated="MAP_WIDGET_INFO_UPDATED",e.RequestAutoControlMapWidget="REQUEST_AUTO_CONTROL_MAP_WIDGET",e.ReleaseAutoControlMapWidget="RELEASE_AUTO_CONTROL_MAP_WIDGET",e.WidgetStatePropChange="WIDGET_STATE_PROP_CHANGE",e.WidgetMutableStatePropChange="WIDGET_MUTABLE_STATE_PROP_CHANGE",e.UserSignIn="USER_SIGN_IN",e.UserSignOut="USER_SIGN_OUT",e.BrowserSizeModeChanged="BROWSER_SIZE_MODE_CHANGED",e.UpdateStoreState="UPDATE_STORE_STATE",e.ActivePagePartChanged="ACTIVE_PAGE_PART_CHANGED",e.ChangeThemeMode="CHANGE_THEME_MODE",e.OpenOverlay="OPEN_OVERLAY",e.CloseOverlay="CLOSE_OVERLAY",e.ActiveOverlay="ACTIVE_OVERLAY",e.SetIsBusy="SET_IS_BUSY",e.ZoomScaleChanged="ZOOM_SCALE_CHANGED",e.SectionNavInfoChanged="SECTION_NAV_INFO_CHANGED",e.SetupAnimationPreview="SETUP_ANIMATION_PREVIEW",e.ClearAnimationPreview="CLEAR_ANIMATION_PREVIEW",e.SetupHoverPreview="SETUP_HOVER_PREVIEW",e.ScreenGroupNavInfoChanged="SCREEN_GROUP_NAV_INFO_CHANGE",e.UserLocaleChanged="USER_LOCALE_CHANGED",e.SetSystemError="SET_SYSTEM_ERROR",e.ClearSystemError="CLEAR_SYSTEM_ERROR",e.AddToRegisterClientIdList="ADD_TO_REGISTER_CLIENT_ID_LIST",e.RemoveFromRegisterClientIdList="REMOVE_FROM_REGISTER_CLIENT_ID_LIST",e.UpdateNoPermissionResourceChangedFlag="UPDATE_NO_PERMISSION_RESOURCE_CHANGED_FLAG",e.UpdateResourceSessions="UPDATE_RESOURCE_SESSIONS",e.ScreenPanelVisibleChange="SCREEN_PANEL_VISIBLE_CHANGE",e.ActivePrintPreview="ACTIVE_PRINT_PREVIEW",e.QuitPrintPreview="QUIT_PRINT_PREVIEW",e.UtilityStateChange="UTILITY_STATE_CHANGE",e.SaveThumbnailUrl="SAVE_THUMBNAIL_URL",e.OpenCookieBannerSetting="OPEN_COOKIE_BANNER_SETTING",e.OpenCookieSettingsWindow="OPEN_COOKIE_SETTINGS_WINDOW",e.OpenCookieBannerByPrivacyPanel="OPEN_COOKIE_BANNER_BY_PRIVACY_PANEL",e.OpenCookieBannerByUrl="OPEN_COOKIE_BANNER_BY_URL",e.WidgetToolbarStateChange="WIDGET_TOOLBAR_STATE_CHANGE",e.WidgetRuntimeInfoChange="WIDGET_RUNTIME_INFO_CHANGE",e.CurrentGuideChange="CURRENT_GUIDE_CHANGE",e.ChangeDynamicStylePreviewConditionInfo="CHANGE_DYNAMIC_STYLE_PREVIEW_CONDITION_INFO",e.ChangeDynamicStylePreviewRepeatedRecordInfo="CHANGE_DYNAMIC_STYLE_PREVIEW_REPEATED_RECORD_INFO",e.SetNoPermissionPages="SET_NO_PERMISSION_PAGES"}(ja||(ja={}));function Ya(){return Ka}function Xa(e,t){let r;function n(){let n=Ka.getState();t?(n=n.getIn(t),n!==r&&(e(r,n),r=n)):n!==r&&(e(r,n),r=n)}const i=Ka.subscribe(n);return n(),i}var Qa=m(99589);m(32528).exbVersion;var Za;!function(e){e.None="None Version Heigher",e.Draft="Draft Version Heigher",e.Published="Published Version Heigher",e.Both="Both Version Heigher"}(Za||(Za={}));function el(e){try{return localStorage.getItem(e)}catch(e){return console.error("Read Local storage error.",e),null}}function tl(e,t){try{localStorage.setItem(e,t)}catch(e){console.error("Set Local storage error.",e)}}function rl(e){try{return sessionStorage.getItem(e)}catch(e){return console.error("Read session storage error.",e),null}}function nl(e,t){try{sessionStorage.setItem(e,t)}catch(e){console.error("Set session storage error.",e)}}function il(e){if(window.jimuConfig.isInBuilder){Ol("jimu-for-builder").getAppConfigAction().setAppConfig(e).exec()}else Ya().dispatch(Fa(e))}function ol(e){return/^widget_/.test(e)}function sl(e){let t=null;(null==e?void 0:e.data_filter)&&(t={data_filter:e.data_filter});let r=e;(null==r?void 0:r.data_filter)&&(r.without?r=r.without("data_filter"):delete r.data_filter);let n=X.stringify(r);return t&&(n=n+"&"+X.stringify(t,{encode:!1})),n}function al(e,t,r){"object"==typeof e&&(null==e?void 0:e.length)&&(null==e?void 0:e.length)>0&&(e=e[0]);let n=an({});if(t===R.Data_s)return n.set(R.Data_s,decodeURIComponent(e));const{compatibleMode:i=!0}=null!=r?r:{};i&&e&&(e=function(e){let t=e;return t=function(e){let t=e;/^dataSource_[^%]*%3A/.test(e)&&(t=e.replace(/%3A/g,":"));return t}(t),t}(e));try{const t=null==e?void 0:e.split(",");null==t||t.forEach(e=>{const t=e.split(":"),r=t[0];let i=null;try{i=decodeURIComponent(t[1])}catch(e){console.warn(e)}n=n.set(r,i)})}catch(e){console.warn(e)}return n}function ll(e){let t=e||"/",r="",n="";const i=t.indexOf("#");-1!==i&&(n=t.substr(i),t=t.substr(0,i));const o=t.indexOf("?");return-1!==o&&(r=t.substr(o),t=t.substr(0,o)),{pathname:t,search:"?"===r?"":r,hash:"#"===n?"":n}}function cl(e){return/(^http:)|(^https:)|(^\/\/)|(^mailto:)|(^tel:)|(^data:)|(^sms:)|(^ftp:)/.test(e)}function ul(e,t){let r=t;const n=ll(t);e.hash&&!n.hash&&(r+=e.hash);const i=ll(r);return"/"===i.pathname||""===i.pathname?(i.pathname=e.pathname,i):"/"===i.pathname.charAt(0)?i:"."===i.pathname.charAt(0)?(i.pathname=e.pathname+"/"+i.pathname.substr(2),i):(i.pathname=e.pathname+"/"+i.pathname,i)}function dl(e){let t;return 0===(e=e.toLowerCase()).indexOf("https://")?t="https:":0===e.indexOf("http://")&&(t="http:"),t}function hl(e,t){return dl(e)?e.replace(/^https?:\/\//,`${t}//`):`${t}//${e}`}function pl(e){return e.replace(/^https?:\/\//,"")}function fl(e){return 0===(e=(e=(e||"").trim()).replace(/^(http(s?):?)\/\//gi,"")).indexOf("//")&&(e=e.slice(2)),e.split("/")[0].toLowerCase()}function ml(e){return(e=(e||"").trim()).split("?")[0]}function gl(e,t,r){const n=(e=(e||"").trim()).indexOf("#");let i="";return n>-1&&(i=e.substring(n),e=e.substring(0,n)),e.includes("?")?e+=`&${t}=${r}${i}`:e+=`?${t}=${r}${i}`,e}function vl(e,t,r){const n=e.substr(window.jimuConfig.rootPath.length),i={pageId:null,appId:null},o=n.split("/").filter(e=>e).map(e=>decodeURIComponent(e));return""===n||(1===o.length?n.includes(".")||"page"===o[0]||(i.appId=o[0]):2===o.length?/^page\/page\//.test(n)?i.pageId="page":/^page/.test(n)?i.pageId=o[1]:i.appId=o[0]:o.length>=3?(i.appId=o[0],i.pageId=o[2]):console.log("URL pattern is not correct.",e),i.pageId&&(i.pageId=yl(i.pageId,t,r))),i}function yl(e,t,r){if(!t||!e)return e;const n={};null==r||r.forEach(e=>{n[e.id]=e});const i=Object.assign(Object.assign({},t.pages),n);if(!i||i[e])return e;{const r=Object.keys(i).find(t=>wl(i[t].label)===e);if(r)return r;{const r=Il(e,"pages",t);return null!=r?r:e}}}function Sl(e,t){if(!t||!e)return e;const r=t.views;if(!r||r[e])return e;{const n=Object.keys(r).find(t=>bl(r[t].label)===e);if(n)return n;{const r=Il(e,"views",t);return null!=r?r:e}}}function Il(e,t,r){if(!r.historyLabels)return null;const n=r.historyLabels[t];return n?Object.keys(n).find(r=>!!n[r].find(r=>"views"===t?bl(r)===e:"dialogs"===t?El(r)===e:wl(r)===e)):null}function wl(e){return null==e?void 0:e.replace(/\s/g,"-").replace(/\./g,"_")}function El(e){return null==e?void 0:e.replace(/\s/g,"-")}function bl(e){return null==e?void 0:e.replace(/\s/g,"-").replace(/,/g,"-")}function Rl(e,t,r=window.location,n){"current_page"===e&&(e=Ya().getState().appRuntimeInfo.currentPageId);const i=function(e){var t,r,n;let i=window.jimuConfig.isInBuilder?e:wl(null!==(n=null===(r=null===(t=Ya().getState().appConfig)||void 0===t?void 0:t.pages[e])||void 0===r?void 0:r.label)&&void 0!==n?n:e);if(window.jimuConfig.useStructuralUrl){i=encodeURIComponent(i);const e=vl(window.location.pathname,Ya().getState().appConfig);let t;return t=e.appId?`${window.jimuConfig.rootPath}${e.appId}/page/${i}`:`${window.jimuConfig.rootPath}page/${i}`,{path:t,qo:null}}return{path:window.jimuConfig.rootPath,qo:{page:i}}}(e);let o,s;if(o=t&&i.qo?Object.assign({},t,i.qo):t||i.qo,o&&!Xr(o,{})){const e=sl(o);s=`${i.path}?${e}`}else s=i.path;return r&&r.hash&&(s=`${s}${r.hash}`),n&&(s=`${s}#${n}`),s}function Tl(){let e;return e=window.jimuConfig.isOutOfExb||window.jimuConfig.rootPath===window.jimuConfig.mountPath?window.jimuConfig.rootPath:window.jimuConfig.rootPath+"../",window.jimuConfig.buildNumber?e+"cdn/"+window.jimuConfig.buildNumber+"/":e}var Nl=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Ol(e){const t=window.SystemJS.get(Ll(e));return t?t.__useDefault?t.default:t:null}function Cl(e,t){return Nl(this,void 0,void 0,function*(){return!cl(e)||/\.(js|css)$/.test(e)||/\/$/.test(e)||(e=`${e}.js`),window.SystemJS.import(e,t).then(e=>e=e.__useDefault?e.default:e).catch(e=>(console.error("Load module error.",e),null))})}function Ll(e){return window.SystemJS.resolve(e)}function Al(e,t){var r=t&&t.cache?t.cache:Bl,n=t&&t.serializer?t.serializer:Fl;return(t&&t.strategy?t.strategy:xl)(e,{cache:r,serializer:n})}function Dl(e,t,r,n){var i,o=null==(i=n)||"number"==typeof i||"boolean"==typeof i?n:r(n),s=t.get(o);return void 0===s&&(s=e.call(this,n),t.set(o,s)),s}function _l(e,t,r){var n=Array.prototype.slice.call(arguments,3),i=r(n),o=t.get(i);return void 0===o&&(o=e.apply(this,n),t.set(i,o)),o}function Pl(e,t,r,n,i){return r.bind(t,e,n,i)}function xl(e,t){return Pl(e,this,1===e.length?Dl:_l,t.cache.create(),t.serializer)}var Ml,kl,jl,Fl=function(){return JSON.stringify(arguments)},Ul=function(){function e(){this.cache=Object.create(null)}return e.prototype.get=function(e){return this.cache[e]},e.prototype.set=function(e,t){this.cache[e]=t},e}(),Bl={create:function(){return new Ul}},Vl={variadic:function(e,t){return Pl(e,this,_l,t.cache.create(),t.serializer)},monadic:function(e,t){return Pl(e,this,Dl,t.cache.create(),t.serializer)}};function Gl(e){return e.type===kl.literal}function $l(e){return e.type===kl.argument}function Hl(e){return e.type===kl.number}function Wl(e){return e.type===kl.date}function zl(e){return e.type===kl.time}function ql(e){return e.type===kl.select}function Jl(e){return e.type===kl.plural}function Kl(e){return e.type===kl.pound}function Yl(e){return e.type===kl.tag}function Xl(e){return!(!e||"object"!=typeof e||e.type!==jl.number)}function Ql(e){return!(!e||"object"!=typeof e||e.type!==jl.dateTime)}!function(e){e[e.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",e[e.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",e[e.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",e[e.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",e[e.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",e[e.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",e[e.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",e[e.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",e[e.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",e[e.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",e[e.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",e[e.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",e[e.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",e[e.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",e[e.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",e[e.INVALID_TAG=23]="INVALID_TAG",e[e.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",e[e.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",e[e.UNCLOSED_TAG=27]="UNCLOSED_TAG"}(Ml||(Ml={})),function(e){e[e.literal=0]="literal",e[e.argument=1]="argument",e[e.number=2]="number",e[e.date=3]="date",e[e.time=4]="time",e[e.select=5]="select",e[e.plural=6]="plural",e[e.pound=7]="pound",e[e.tag=8]="tag"}(kl||(kl={})),function(e){e[e.number=0]="number",e[e.dateTime=1]="dateTime"}(jl||(jl={}));var Zl=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,ec=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function tc(e){var t={};return e.replace(ec,function(e){var r=e.length;switch(e[0]){case"G":t.era=4===r?"long":5===r?"narrow":"short";break;case"y":t.year=2===r?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":t.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":t.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":t.weekday=4===r?"long":5===r?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][r-4];break;case"a":t.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":t.hourCycle="h12",t.hour=["numeric","2-digit"][r-1];break;case"H":t.hourCycle="h23",t.hour=["numeric","2-digit"][r-1];break;case"K":t.hourCycle="h11",t.hour=["numeric","2-digit"][r-1];break;case"k":t.hourCycle="h24",t.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":t.minute=["numeric","2-digit"][r-1];break;case"s":t.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":t.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),t}var rc=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function nc(e){return e.replace(/^(.*?)-/,"")}var ic=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,oc=/^(@+)?(\+|#+)?[rs]?$/g,sc=/(\*)(0+)|(#+)(0+)|(0+)/g,ac=/^(0+)$/;function lc(e){var t={};return"r"===e[e.length-1]?t.roundingPriority="morePrecision":"s"===e[e.length-1]&&(t.roundingPriority="lessPrecision"),e.replace(oc,function(e,r,n){return"string"!=typeof n?(t.minimumSignificantDigits=r.length,t.maximumSignificantDigits=r.length):"+"===n?t.minimumSignificantDigits=r.length:"#"===r[0]?t.maximumSignificantDigits=r.length:(t.minimumSignificantDigits=r.length,t.maximumSignificantDigits=r.length+("string"==typeof n?n.length:0)),""}),t}function cc(e){switch(e){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function uc(e){var t;if("E"===e[0]&&"E"===e[1]?(t={notation:"engineering"},e=e.slice(2)):"E"===e[0]&&(t={notation:"scientific"},e=e.slice(1)),t){var r=e.slice(0,2);if("+!"===r?(t.signDisplay="always",e=e.slice(2)):"+?"===r&&(t.signDisplay="exceptZero",e=e.slice(2)),!ac.test(e))throw new Error("Malformed concise eng/scientific notation");t.minimumIntegerDigits=e.length}return t}function dc(e){var t=cc(e);return t||{}}function hc(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r];switch(i.stem){case"percent":case"%":t.style="percent";continue;case"%x100":t.style="percent",t.scale=100;continue;case"currency":t.style="currency",t.currency=i.options[0];continue;case"group-off":case",_":t.useGrouping=!1;continue;case"precision-integer":case".":t.maximumFractionDigits=0;continue;case"measure-unit":case"unit":t.style="unit",t.unit=nc(i.options[0]);continue;case"compact-short":case"K":t.notation="compact",t.compactDisplay="short";continue;case"compact-long":case"KK":t.notation="compact",t.compactDisplay="long";continue;case"scientific":t=hi(hi(hi({},t),{notation:"scientific"}),i.options.reduce(function(e,t){return hi(hi({},e),dc(t))},{}));continue;case"engineering":t=hi(hi(hi({},t),{notation:"engineering"}),i.options.reduce(function(e,t){return hi(hi({},e),dc(t))},{}));continue;case"notation-simple":t.notation="standard";continue;case"unit-width-narrow":t.currencyDisplay="narrowSymbol",t.unitDisplay="narrow";continue;case"unit-width-short":t.currencyDisplay="code",t.unitDisplay="short";continue;case"unit-width-full-name":t.currencyDisplay="name",t.unitDisplay="long";continue;case"unit-width-iso-code":t.currencyDisplay="symbol";continue;case"scale":t.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":t.roundingMode="floor";continue;case"rounding-mode-ceiling":t.roundingMode="ceil";continue;case"rounding-mode-down":t.roundingMode="trunc";continue;case"rounding-mode-up":t.roundingMode="expand";continue;case"rounding-mode-half-even":t.roundingMode="halfEven";continue;case"rounding-mode-half-down":t.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":t.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(sc,function(e,r,n,i,o,s){if(r)t.minimumIntegerDigits=n.length;else{if(i&&o)throw new Error("We currently do not support maximum integer digits");if(s)throw new Error("We currently do not support exact integer digits")}return""});continue}if(ac.test(i.stem))t.minimumIntegerDigits=i.stem.length;else if(ic.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(ic,function(e,r,n,i,o,s){return"*"===n?t.minimumFractionDigits=r.length:i&&"#"===i[0]?t.maximumFractionDigits=i.length:o&&s?(t.minimumFractionDigits=o.length,t.maximumFractionDigits=o.length+s.length):(t.minimumFractionDigits=r.length,t.maximumFractionDigits=r.length),""});var o=i.options[0];"w"===o?t=hi(hi({},t),{trailingZeroDisplay:"stripIfInteger"}):o&&(t=hi(hi({},t),lc(o)))}else if(oc.test(i.stem))t=hi(hi({},t),lc(i.stem));else{var s=cc(i.stem);s&&(t=hi(hi({},t),s));var a=uc(i.stem);a&&(t=hi(hi({},t),a))}}return t}var pc,fc={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function mc(e){var t=e.hourCycle;if(void 0===t&&e.hourCycles&&e.hourCycles.length&&(t=e.hourCycles[0]),t)switch(t){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var r,n=e.language;return"root"!==n&&(r=e.maximize().region),(fc[r||""]||fc[n||""]||fc["".concat(n,"-001")]||fc["001"])[0]}var gc=new RegExp("^".concat(Zl.source,"*")),vc=new RegExp("".concat(Zl.source,"*$"));function yc(e,t){return{start:e,end:t}}var Sc=!!String.prototype.startsWith&&"_a".startsWith("a",1),Ic=!!String.fromCodePoint,wc=!!Object.fromEntries,Ec=!!String.prototype.codePointAt,bc=!!String.prototype.trimStart,Rc=!!String.prototype.trimEnd,Tc=!!Number.isSafeInteger?Number.isSafeInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<=9007199254740991},Nc=!0;try{Nc="a"===(null===(pc=xc("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu").exec("a"))||void 0===pc?void 0:pc[0])}catch(e){Nc=!1}var Oc,Cc=Sc?function(e,t,r){return e.startsWith(t,r)}:function(e,t,r){return e.slice(r,r+t.length)===t},Lc=Ic?String.fromCodePoint:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,n="",i=e.length,o=0;i>o;){if((r=e[o++])>1114111)throw RangeError(r+" is not a valid code point");n+=r<65536?String.fromCharCode(r):String.fromCharCode(55296+((r-=65536)>>10),r%1024+56320)}return n},Ac=wc?Object.fromEntries:function(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r],o=i[0],s=i[1];t[o]=s}return t},Dc=Ec?function(e,t){return e.codePointAt(t)}:function(e,t){var r=e.length;if(!(t<0||t>=r)){var n,i=e.charCodeAt(t);return i<55296||i>56319||t+1===r||(n=e.charCodeAt(t+1))<56320||n>57343?i:n-56320+(i-55296<<10)+65536}},_c=bc?function(e){return e.trimStart()}:function(e){return e.replace(gc,"")},Pc=Rc?function(e){return e.trimEnd()}:function(e){return e.replace(vc,"")};function xc(e,t){return new RegExp(e,t)}if(Nc){var Mc=xc("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");Oc=function(e,t){var r;return Mc.lastIndex=t,null!==(r=Mc.exec(e)[1])&&void 0!==r?r:""}}else Oc=function(e,t){for(var r=[];;){var n=Dc(e,t);if(void 0===n||Uc(n)||Bc(n))break;r.push(n),t+=n>=65536?2:1}return Lc.apply(void 0,r)};var kc=function(){function e(e,t){void 0===t&&(t={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!t.ignoreTag,this.locale=t.locale,this.requiresOtherClause=!!t.requiresOtherClause,this.shouldParseSkeletons=!!t.shouldParseSkeletons}return e.prototype.parse=function(){if(0!==this.offset())throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},e.prototype.parseMessage=function(e,t,r){for(var n=[];!this.isEOF();){var i=this.char();if(123===i){if((o=this.parseArgument(e,r)).err)return o;n.push(o.val)}else{if(125===i&&e>0)break;if(35!==i||"plural"!==t&&"selectordinal"!==t){if(60===i&&!this.ignoreTag&&47===this.peek()){if(r)break;return this.error(Ml.UNMATCHED_CLOSING_TAG,yc(this.clonePosition(),this.clonePosition()))}if(60===i&&!this.ignoreTag&&jc(this.peek()||0)){if((o=this.parseTag(e,t)).err)return o;n.push(o.val)}else{var o;if((o=this.parseLiteral(e,t)).err)return o;n.push(o.val)}}else{var s=this.clonePosition();this.bump(),n.push({type:kl.pound,location:yc(s,this.clonePosition())})}}}return{val:n,err:null}},e.prototype.parseTag=function(e,t){var r=this.clonePosition();this.bump();var n=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:kl.literal,value:"<".concat(n,"/>"),location:yc(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var i=this.parseMessage(e+1,t,!0);if(i.err)return i;var o=i.val,s=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!jc(this.char()))return this.error(Ml.INVALID_TAG,yc(s,this.clonePosition()));var a=this.clonePosition();return n!==this.parseTagName()?this.error(Ml.UNMATCHED_CLOSING_TAG,yc(a,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:kl.tag,value:n,children:o,location:yc(r,this.clonePosition())},err:null}:this.error(Ml.INVALID_TAG,yc(s,this.clonePosition())))}return this.error(Ml.UNCLOSED_TAG,yc(r,this.clonePosition()))}return this.error(Ml.INVALID_TAG,yc(r,this.clonePosition()))},e.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&Fc(this.char());)this.bump();return this.message.slice(e,this.offset())},e.prototype.parseLiteral=function(e,t){for(var r=this.clonePosition(),n="";;){var i=this.tryParseQuote(t);if(i)n+=i;else{var o=this.tryParseUnquoted(e,t);if(o)n+=o;else{var s=this.tryParseLeftAngleBracket();if(!s)break;n+=s}}}var a=yc(r,this.clonePosition());return{val:{type:kl.literal,value:n,location:a},err:null}},e.prototype.tryParseLeftAngleBracket=function(){return this.isEOF()||60!==this.char()||!this.ignoreTag&&(jc(e=this.peek()||0)||47===e)?null:(this.bump(),"<");var e},e.prototype.tryParseQuote=function(e){if(this.isEOF()||39!==this.char())return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if("plural"===e||"selectordinal"===e)break;return null;default:return null}this.bump();var t=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(39===r){if(39!==this.peek()){this.bump();break}t.push(39),this.bump()}else t.push(r);this.bump()}return Lc.apply(void 0,t)},e.prototype.tryParseUnquoted=function(e,t){if(this.isEOF())return null;var r=this.char();return 60===r||123===r||35===r&&("plural"===t||"selectordinal"===t)||125===r&&e>0?null:(this.bump(),Lc(r))},e.prototype.parseArgument=function(e,t){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Ml.EXPECT_ARGUMENT_CLOSING_BRACE,yc(r,this.clonePosition()));if(125===this.char())return this.bump(),this.error(Ml.EMPTY_ARGUMENT,yc(r,this.clonePosition()));var n=this.parseIdentifierIfPossible().value;if(!n)return this.error(Ml.MALFORMED_ARGUMENT,yc(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Ml.EXPECT_ARGUMENT_CLOSING_BRACE,yc(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:kl.argument,value:n,location:yc(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Ml.EXPECT_ARGUMENT_CLOSING_BRACE,yc(r,this.clonePosition())):this.parseArgumentOptions(e,t,n,r);default:return this.error(Ml.MALFORMED_ARGUMENT,yc(r,this.clonePosition()))}},e.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),t=this.offset(),r=Oc(this.message,t),n=t+r.length;return this.bumpTo(n),{value:r,location:yc(e,this.clonePosition())}},e.prototype.parseArgumentOptions=function(e,t,r,n){var i,o=this.clonePosition(),s=this.parseIdentifierIfPossible().value,a=this.clonePosition();switch(s){case"":return this.error(Ml.EXPECT_ARGUMENT_TYPE,yc(o,a));case"number":case"date":case"time":this.bumpSpace();var l=null;if(this.bumpIf(",")){this.bumpSpace();var c=this.clonePosition();if((v=this.parseSimpleArgStyleIfPossible()).err)return v;if(0===(p=Pc(v.val)).length)return this.error(Ml.EXPECT_ARGUMENT_STYLE,yc(this.clonePosition(),this.clonePosition()));l={style:p,styleLocation:yc(c,this.clonePosition())}}if((y=this.tryParseArgumentClose(n)).err)return y;var u=yc(n,this.clonePosition());if(l&&Cc(null==l?void 0:l.style,"::",0)){var d=_c(l.style.slice(2));if("number"===s)return(v=this.parseNumberSkeletonFromString(d,l.styleLocation)).err?v:{val:{type:kl.number,value:r,location:u,style:v.val},err:null};if(0===d.length)return this.error(Ml.EXPECT_DATE_TIME_SKELETON,u);var h=d;this.locale&&(h=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e.charAt(n);if("j"===i){for(var o=0;n+1<e.length&&e.charAt(n+1)===i;)o++,n++;var s=1+(1&o),a=o<2?1:3+(o>>1),l=mc(t);for("H"!=l&&"k"!=l||(a=0);a-- >0;)r+="a";for(;s-- >0;)r=l+r}else r+="J"===i?"H":i}return r}(d,this.locale));var p={type:jl.dateTime,pattern:h,location:l.styleLocation,parsedOptions:this.shouldParseSkeletons?tc(h):{}};return{val:{type:"date"===s?kl.date:kl.time,value:r,location:u,style:p},err:null}}return{val:{type:"number"===s?kl.number:"date"===s?kl.date:kl.time,value:r,location:u,style:null!==(i=null==l?void 0:l.style)&&void 0!==i?i:null},err:null};case"plural":case"selectordinal":case"select":var f=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Ml.EXPECT_SELECT_ARGUMENT_OPTIONS,yc(f,hi({},f)));this.bumpSpace();var m=this.parseIdentifierIfPossible(),g=0;if("select"!==s&&"offset"===m.value){if(!this.bumpIf(":"))return this.error(Ml.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,yc(this.clonePosition(),this.clonePosition()));var v;if(this.bumpSpace(),(v=this.tryParseDecimalInteger(Ml.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Ml.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE)).err)return v;this.bumpSpace(),m=this.parseIdentifierIfPossible(),g=v.val}var y,S=this.tryParsePluralOrSelectOptions(e,s,t,m);if(S.err)return S;if((y=this.tryParseArgumentClose(n)).err)return y;var I=yc(n,this.clonePosition());return"select"===s?{val:{type:kl.select,value:r,options:Ac(S.val),location:I},err:null}:{val:{type:kl.plural,value:r,options:Ac(S.val),offset:g,pluralType:"plural"===s?"cardinal":"ordinal",location:I},err:null};default:return this.error(Ml.INVALID_ARGUMENT_TYPE,yc(o,a))}},e.prototype.tryParseArgumentClose=function(e){return this.isEOF()||125!==this.char()?this.error(Ml.EXPECT_ARGUMENT_CLOSING_BRACE,yc(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},e.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,t=this.clonePosition();!this.isEOF();){switch(this.char()){case 39:this.bump();var r=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Ml.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,yc(r,this.clonePosition()));this.bump();break;case 123:e+=1,this.bump();break;case 125:if(!(e>0))return{val:this.message.slice(t.offset,this.offset()),err:null};e-=1;break;default:this.bump()}}return{val:this.message.slice(t.offset,this.offset()),err:null}},e.prototype.parseNumberSkeletonFromString=function(e,t){var r=[];try{r=function(e){if(0===e.length)throw new Error("Number skeleton cannot be empty");for(var t=[],r=0,n=e.split(rc).filter(function(e){return e.length>0});r<n.length;r++){var i=n[r].split("/");if(0===i.length)throw new Error("Invalid number skeleton");for(var o=i[0],s=i.slice(1),a=0,l=s;a<l.length;a++)if(0===l[a].length)throw new Error("Invalid number skeleton");t.push({stem:o,options:s})}return t}(e)}catch(e){return this.error(Ml.INVALID_NUMBER_SKELETON,t)}return{val:{type:jl.number,tokens:r,location:t,parsedOptions:this.shouldParseSkeletons?hc(r):{}},err:null}},e.prototype.tryParsePluralOrSelectOptions=function(e,t,r,n){for(var i,o=!1,s=[],a=new Set,l=n.value,c=n.location;;){if(0===l.length){var u=this.clonePosition();if("select"===t||!this.bumpIf("="))break;var d=this.tryParseDecimalInteger(Ml.EXPECT_PLURAL_ARGUMENT_SELECTOR,Ml.INVALID_PLURAL_ARGUMENT_SELECTOR);if(d.err)return d;c=yc(u,this.clonePosition()),l=this.message.slice(u.offset,this.offset())}if(a.has(l))return this.error("select"===t?Ml.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Ml.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,c);"other"===l&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error("select"===t?Ml.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Ml.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,yc(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,t,r);if(p.err)return p;var f=this.tryParseArgumentClose(h);if(f.err)return f;s.push([l,{value:p.val,location:yc(h,this.clonePosition())}]),a.add(l),this.bumpSpace(),l=(i=this.parseIdentifierIfPossible()).value,c=i.location}return 0===s.length?this.error("select"===t?Ml.EXPECT_SELECT_ARGUMENT_SELECTOR:Ml.EXPECT_PLURAL_ARGUMENT_SELECTOR,yc(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(Ml.MISSING_OTHER_CLAUSE,yc(this.clonePosition(),this.clonePosition())):{val:s,err:null}},e.prototype.tryParseDecimalInteger=function(e,t){var r=1,n=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var i=!1,o=0;!this.isEOF();){var s=this.char();if(!(s>=48&&s<=57))break;i=!0,o=10*o+(s-48),this.bump()}var a=yc(n,this.clonePosition());return i?Tc(o*=r)?{val:o,err:null}:this.error(t,a):this.error(e,a)},e.prototype.offset=function(){return this.position.offset},e.prototype.isEOF=function(){return this.offset()===this.message.length},e.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},e.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var t=Dc(this.message,e);if(void 0===t)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return t},e.prototype.error=function(e,t){return{val:null,err:{kind:e,message:this.message,location:t}}},e.prototype.bump=function(){if(!this.isEOF()){var e=this.char();10===e?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},e.prototype.bumpIf=function(e){if(Cc(this.message,e,this.offset())){for(var t=0;t<e.length;t++)this.bump();return!0}return!1},e.prototype.bumpUntil=function(e){var t=this.offset(),r=this.message.indexOf(e,t);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},e.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var t=this.offset();if(t===e)break;if(t>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},e.prototype.bumpSpace=function(){for(;!this.isEOF()&&Uc(this.char());)this.bump()},e.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),t=this.offset(),r=this.message.charCodeAt(t+(e>=65536?2:1));return null!=r?r:null},e}();function jc(e){return e>=97&&e<=122||e>=65&&e<=90}function Fc(e){return 45===e||46===e||e>=48&&e<=57||95===e||e>=97&&e<=122||e>=65&&e<=90||183==e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function Uc(e){return e>=9&&e<=13||32===e||133===e||e>=8206&&e<=8207||8232===e||8233===e}function Bc(e){return e>=33&&e<=35||36===e||e>=37&&e<=39||40===e||41===e||42===e||43===e||44===e||45===e||e>=46&&e<=47||e>=58&&e<=59||e>=60&&e<=62||e>=63&&e<=64||91===e||92===e||93===e||94===e||96===e||123===e||124===e||125===e||126===e||161===e||e>=162&&e<=165||166===e||167===e||169===e||171===e||172===e||174===e||176===e||177===e||182===e||187===e||191===e||215===e||247===e||e>=8208&&e<=8213||e>=8214&&e<=8215||8216===e||8217===e||8218===e||e>=8219&&e<=8220||8221===e||8222===e||8223===e||e>=8224&&e<=8231||e>=8240&&e<=8248||8249===e||8250===e||e>=8251&&e<=8254||e>=8257&&e<=8259||8260===e||8261===e||8262===e||e>=8263&&e<=8273||8274===e||8275===e||e>=8277&&e<=8286||e>=8592&&e<=8596||e>=8597&&e<=8601||e>=8602&&e<=8603||e>=8604&&e<=8607||8608===e||e>=8609&&e<=8610||8611===e||e>=8612&&e<=8613||8614===e||e>=8615&&e<=8621||8622===e||e>=8623&&e<=8653||e>=8654&&e<=8655||e>=8656&&e<=8657||8658===e||8659===e||8660===e||e>=8661&&e<=8691||e>=8692&&e<=8959||e>=8960&&e<=8967||8968===e||8969===e||8970===e||8971===e||e>=8972&&e<=8991||e>=8992&&e<=8993||e>=8994&&e<=9e3||9001===e||9002===e||e>=9003&&e<=9083||9084===e||e>=9085&&e<=9114||e>=9115&&e<=9139||e>=9140&&e<=9179||e>=9180&&e<=9185||e>=9186&&e<=9254||e>=9255&&e<=9279||e>=9280&&e<=9290||e>=9291&&e<=9311||e>=9472&&e<=9654||9655===e||e>=9656&&e<=9664||9665===e||e>=9666&&e<=9719||e>=9720&&e<=9727||e>=9728&&e<=9838||9839===e||e>=9840&&e<=10087||10088===e||10089===e||10090===e||10091===e||10092===e||10093===e||10094===e||10095===e||10096===e||10097===e||10098===e||10099===e||10100===e||10101===e||e>=10132&&e<=10175||e>=10176&&e<=10180||10181===e||10182===e||e>=10183&&e<=10213||10214===e||10215===e||10216===e||10217===e||10218===e||10219===e||10220===e||10221===e||10222===e||10223===e||e>=10224&&e<=10239||e>=10240&&e<=10495||e>=10496&&e<=10626||10627===e||10628===e||10629===e||10630===e||10631===e||10632===e||10633===e||10634===e||10635===e||10636===e||10637===e||10638===e||10639===e||10640===e||10641===e||10642===e||10643===e||10644===e||10645===e||10646===e||10647===e||10648===e||e>=10649&&e<=10711||10712===e||10713===e||10714===e||10715===e||e>=10716&&e<=10747||10748===e||10749===e||e>=10750&&e<=11007||e>=11008&&e<=11055||e>=11056&&e<=11076||e>=11077&&e<=11078||e>=11079&&e<=11084||e>=11085&&e<=11123||e>=11124&&e<=11125||e>=11126&&e<=11157||11158===e||e>=11159&&e<=11263||e>=11776&&e<=11777||11778===e||11779===e||11780===e||11781===e||e>=11782&&e<=11784||11785===e||11786===e||11787===e||11788===e||11789===e||e>=11790&&e<=11798||11799===e||e>=11800&&e<=11801||11802===e||11803===e||11804===e||11805===e||e>=11806&&e<=11807||11808===e||11809===e||11810===e||11811===e||11812===e||11813===e||11814===e||11815===e||11816===e||11817===e||e>=11818&&e<=11822||11823===e||e>=11824&&e<=11833||e>=11834&&e<=11835||e>=11836&&e<=11839||11840===e||11841===e||11842===e||e>=11843&&e<=11855||e>=11856&&e<=11857||11858===e||e>=11859&&e<=11903||e>=12289&&e<=12291||12296===e||12297===e||12298===e||12299===e||12300===e||12301===e||12302===e||12303===e||12304===e||12305===e||e>=12306&&e<=12307||12308===e||12309===e||12310===e||12311===e||12312===e||12313===e||12314===e||12315===e||12316===e||12317===e||e>=12318&&e<=12319||12320===e||12336===e||64830===e||64831===e||e>=65093&&e<=65094}function Vc(e){e.forEach(function(e){if(delete e.location,ql(e)||Jl(e))for(var t in e.options)delete e.options[t].location,Vc(e.options[t].value);else Hl(e)&&Xl(e.style)||(Wl(e)||zl(e))&&Ql(e.style)?delete e.style.location:Yl(e)&&Vc(e.children)})}function Gc(e,t){void 0===t&&(t={}),t=hi({shouldParseSkeletons:!0,requiresOtherClause:!0},t);var r=new kc(e,t).parse();if(r.err){var n=SyntaxError(Ml[r.err.kind]);throw n.location=r.err.location,n.originalMessage=r.err.message,n}return(null==t?void 0:t.captureLocation)||Vc(r.val),r.val}var $c;!function(e){e.MISSING_VALUE="MISSING_VALUE",e.INVALID_VALUE="INVALID_VALUE",e.MISSING_INTL_API="MISSING_INTL_API"}($c||($c={}));var Hc,Wc=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.code=r,i.originalMessage=n,i}return di(t,e),t.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},t}(Error),zc=function(e){function t(t,r,n,i){return e.call(this,'Invalid values for "'.concat(t,'": "').concat(r,'". Options are "').concat(Object.keys(n).join('", "'),'"'),$c.INVALID_VALUE,i)||this}return di(t,e),t}(Wc),qc=function(e){function t(t,r,n){return e.call(this,'Value for "'.concat(t,'" must be of type ').concat(r),$c.INVALID_VALUE,n)||this}return di(t,e),t}(Wc),Jc=function(e){function t(t,r){return e.call(this,'The intl string context variable "'.concat(t,'" was not provided to the string "').concat(r,'"'),$c.MISSING_VALUE,r)||this}return di(t,e),t}(Wc);function Kc(e){return"function"==typeof e}function Yc(e,t,r,n,i,o,s){if(1===e.length&&Gl(e[0]))return[{type:Hc.literal,value:e[0].value}];for(var a=[],l=0,c=e;l<c.length;l++){var u=c[l];if(Gl(u))a.push({type:Hc.literal,value:u.value});else if(Kl(u))"number"==typeof o&&a.push({type:Hc.literal,value:r.getNumberFormat(t).format(o)});else{var d=u.value;if(!i||!(d in i))throw new Jc(d,s);var h=i[d];if($l(u))h&&"string"!=typeof h&&"number"!=typeof h||(h="string"==typeof h||"number"==typeof h?String(h):""),a.push({type:"string"==typeof h?Hc.literal:Hc.object,value:h});else if(Wl(u)){var p="string"==typeof u.style?n.date[u.style]:Ql(u.style)?u.style.parsedOptions:void 0;a.push({type:Hc.literal,value:r.getDateTimeFormat(t,p).format(h)})}else if(zl(u)){p="string"==typeof u.style?n.time[u.style]:Ql(u.style)?u.style.parsedOptions:n.time.medium;a.push({type:Hc.literal,value:r.getDateTimeFormat(t,p).format(h)})}else if(Hl(u)){(p="string"==typeof u.style?n.number[u.style]:Xl(u.style)?u.style.parsedOptions:void 0)&&p.scale&&(h*=p.scale||1),a.push({type:Hc.literal,value:r.getNumberFormat(t,p).format(h)})}else{if(Yl(u)){var f=u.children,m=u.value,g=i[m];if(!Kc(g))throw new qc(m,"function",s);var v=g(Yc(f,t,r,n,i,o).map(function(e){return e.value}));Array.isArray(v)||(v=[v]),a.push.apply(a,v.map(function(e){return{type:"string"==typeof e?Hc.literal:Hc.object,value:e}}))}if(ql(u)){if(!(y=u.options[h]||u.options.other))throw new zc(u.value,h,Object.keys(u.options),s);a.push.apply(a,Yc(y.value,t,r,n,i))}else if(Jl(u)){var y;if(!(y=u.options["=".concat(h)])){if(!Intl.PluralRules)throw new Wc('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',$c.MISSING_INTL_API,s);var S=r.getPluralRules(t,{type:u.pluralType}).select(h-(u.offset||0));y=u.options[S]||u.options.other}if(!y)throw new zc(u.value,h,Object.keys(u.options),s);a.push.apply(a,Yc(y.value,t,r,n,i,h-(u.offset||0)))}else;}}}return function(e){return e.length<2?e:e.reduce(function(e,t){var r=e[e.length-1];return r&&r.type===Hc.literal&&t.type===Hc.literal?r.value+=t.value:e.push(t),e},[])}(a)}function Xc(e,t){return t?Object.keys(e).reduce(function(r,n){var i,o;return r[n]=(i=e[n],(o=t[n])?hi(hi(hi({},i||{}),o||{}),Object.keys(i).reduce(function(e,t){return e[t]=hi(hi({},i[t]),o[t]||{}),e},{})):i),r},hi({},e)):e}function Qc(e){return{create:function(){return{get:function(t){return e[t]},set:function(t,r){e[t]=r}}}}}!function(e){e[e.literal=0]="literal",e[e.object=1]="object"}(Hc||(Hc={}));var Zc,eu=function(){function e(t,r,n,i){void 0===r&&(r=e.defaultLocale);var o,s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(e){var t=s.formatToParts(e);if(1===t.length)return t[0].value;var r=t.reduce(function(e,t){return e.length&&t.type===Hc.literal&&"string"==typeof e[e.length-1]?e[e.length-1]+=t.value:e.push(t.value),e},[]);return r.length<=1?r[0]||"":r},this.formatToParts=function(e){return Yc(s.ast,s.locales,s.formatters,s.formats,e,void 0,s.message)},this.resolvedOptions=function(){var e;return{locale:(null===(e=s.resolvedLocale)||void 0===e?void 0:e.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=r,this.resolvedLocale=e.resolveLocale(r),"string"==typeof t){if(this.message=t,!e.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var a=i||{},l=(a.formatters,pi(a,["formatters"]));this.ast=e.__parse(t,hi(hi({},l),{locale:this.resolvedLocale}))}else this.ast=t;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=Xc(e.formats,n),this.formatters=i&&i.formatters||(void 0===(o=this.formatterCache)&&(o={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,fi([void 0],t,!1)))},{cache:Qc(o.number),strategy:Vl.variadic}),getDateTimeFormat:Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,fi([void 0],t,!1)))},{cache:Qc(o.dateTime),strategy:Vl.variadic}),getPluralRules:Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,fi([void 0],t,!1)))},{cache:Qc(o.pluralRules),strategy:Vl.variadic})})}return Object.defineProperty(e,"defaultLocale",{get:function(){return e.memoizedDefaultLocale||(e.memoizedDefaultLocale=(new Intl.NumberFormat).resolvedOptions().locale),e.memoizedDefaultLocale},enumerable:!1,configurable:!0}),e.memoizedDefaultLocale=null,e.resolveLocale=function(e){if(void 0!==Intl.Locale){var t=Intl.NumberFormat.supportedLocalesOf(e);return t.length>0?new Intl.Locale(t[0]):new Intl.Locale("string"==typeof e?e:e[0])}},e.__parse=Gc,e.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},e}();!function(e){e.FORMAT_ERROR="FORMAT_ERROR",e.UNSUPPORTED_FORMATTER="UNSUPPORTED_FORMATTER",e.INVALID_CONFIG="INVALID_CONFIG",e.MISSING_DATA="MISSING_DATA",e.MISSING_TRANSLATION="MISSING_TRANSLATION"}(Zc||(Zc={}));var tu=function(e){function t(r,n,i){var o=this,s=i?i instanceof Error?i:new Error(String(i)):void 0;return(o=e.call(this,"[@formatjs/intl Error ".concat(r,"] ").concat(n,"\n").concat(s?"\n".concat(s.message,"\n").concat(s.stack):""))||this).code=r,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(o,t),o}return di(t,e),t}(Error),ru=function(e){function t(t,r){return e.call(this,Zc.UNSUPPORTED_FORMATTER,t,r)||this}return di(t,e),t}(tu),nu=function(e){function t(t,r){return e.call(this,Zc.INVALID_CONFIG,t,r)||this}return di(t,e),t}(tu),iu=function(e){function t(t,r){return e.call(this,Zc.MISSING_DATA,t,r)||this}return di(t,e),t}(tu),ou=function(e){function t(t,r,n){var i=e.call(this,Zc.FORMAT_ERROR,"".concat(t,"\nLocale: ").concat(r,"\n"),n)||this;return i.locale=r,i}return di(t,e),t}(tu),su=function(e){function t(t,r,n,i){var o=e.call(this,"".concat(t,"\nMessageID: ").concat(null==n?void 0:n.id,"\nDefault Message: ").concat(null==n?void 0:n.defaultMessage,"\nDescription: ").concat(null==n?void 0:n.description,"\n"),r,i)||this;return o.descriptor=n,o.locale=r,o}return di(t,e),t}(ou),au=function(e){function t(t,r){var n=e.call(this,Zc.MISSING_TRANSLATION,'Missing message: "'.concat(t.id,'" for locale "').concat(r,'", using ').concat(t.defaultMessage?"default message (".concat("string"==typeof t.defaultMessage?t.defaultMessage:t.defaultMessage.map(function(e){var t;return null!==(t=e.value)&&void 0!==t?t:JSON.stringify(e)}).join(),")"):"id"," as fallback."))||this;return n.descriptor=t,n}return di(t,e),t}(tu);function lu(e,t,r){return void 0===r&&(r={}),t.reduce(function(t,n){return n in e?t[n]=e[n]:n in r&&(t[n]=r[n]),t},{})}var cu={formats:{},messages:{},timeZone:void 0,defaultLocale:"en",defaultFormats:{},fallbackOnEmptyString:!0,onError:function(e){0},onWarn:function(e){0}};function uu(e){return{create:function(){return{get:function(t){return e[t]},set:function(t,r){e[t]=r}}}}}function du(e,t,r,n){var i,o=e&&e[t];if(o&&(i=o[r]),i)return i;n(new ru("No ".concat(t," format named: ").concat(r)))}function hu(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=hi({timeZone:t},e[n]),r},{})}function pu(e,t){return Object.keys(hi(hi({},e),t)).reduce(function(r,n){return r[n]=hi(hi({},e[n]||{}),t[n]||{}),r},{})}function fu(e,t){if(!t)return e;var r=eu.formats;return hi(hi(hi({},r),e),{date:pu(hu(r.date,t),hu(e.date||{},t)),time:pu(hu(r.time,t),hu(e.time||{},t))})}var mu=function(e,t,r,n,i){var o=e.locale,s=e.formats,a=e.messages,l=e.defaultLocale,c=e.defaultFormats,u=e.fallbackOnEmptyString,d=e.onError,h=e.timeZone,p=e.defaultRichTextElements;void 0===r&&(r={id:""});var f=r.id,m=r.defaultMessage;!function(e,t,r){if(void 0===r&&(r=Error),!e)throw new r(t)}(!!f,"[@formatjs/intl] An `id` must be provided to format a message. You can either:\n1. Configure your build toolchain with [babel-plugin-formatjs](https://formatjs.github.io/docs/tooling/babel-plugin)\nor [@formatjs/ts-transformer](https://formatjs.github.io/docs/tooling/ts-transformer) OR\n2. Configure your `eslint` config to include [eslint-plugin-formatjs](https://formatjs.github.io/docs/tooling/linter#enforce-id)\nto autofix this issue");var g=String(f),v=a&&Object.prototype.hasOwnProperty.call(a,g)&&a[g];if(Array.isArray(v)&&1===v.length&&v[0].type===kl.literal)return v[0].value;if(!n&&v&&"string"==typeof v&&!p)return v.replace(/'\{(.*?)\}'/gi,"{$1}");if(n=hi(hi({},p),n||{}),s=fu(s,h),c=fu(c,h),!v){if(!1===u&&""===v)return v;if((!m||o&&o.toLowerCase()!==l.toLowerCase())&&d(new au(r,o)),m)try{return t.getMessageFormat(m,l,c,i).format(n)}catch(e){return d(new su('Error formatting default message for: "'.concat(g,'", rendering default message verbatim'),o,r,e)),"string"==typeof m?m:g}return g}try{return t.getMessageFormat(v,o,s,hi({formatters:t},i||{})).format(n)}catch(e){d(new su('Error formatting message: "'.concat(g,'", using ').concat(m?"default message":"id"," as fallback."),o,r,e))}if(m)try{return t.getMessageFormat(m,l,c,i).format(n)}catch(e){d(new su('Error formatting the default message for: "'.concat(g,'", rendering message verbatim'),o,r,e))}return"string"==typeof v?v:"string"==typeof m?m:g},gu=["formatMatcher","timeZone","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName","hourCycle","dateStyle","timeStyle","calendar","numberingSystem","fractionalSecondDigits"];function vu(e,t,r,n){var i=e.locale,o=e.formats,s=e.onError,a=e.timeZone;void 0===n&&(n={});var l=n.format,c=hi(hi({},a&&{timeZone:a}),l&&du(o,t,l,s)),u=lu(n,gu,c);return"time"!==t||u.hour||u.minute||u.second||u.timeStyle||u.dateStyle||(u=hi(hi({},u),{hour:"numeric",minute:"numeric"})),r(i,u)}function yu(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=r[0],o=r[1],s=void 0===o?{}:o,a="string"==typeof i?new Date(i||0):i;try{return vu(e,"date",t,s).format(a)}catch(t){e.onError(new ou("Error formatting date.",e.locale,t))}return String(a)}function Su(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=r[0],o=r[1],s=void 0===o?{}:o,a="string"==typeof i?new Date(i||0):i;try{return vu(e,"time",t,s).format(a)}catch(t){e.onError(new ou("Error formatting time.",e.locale,t))}return String(a)}function Iu(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=r[0],o=r[1],s=r[2],a=void 0===s?{}:s,l="string"==typeof i?new Date(i||0):i,c="string"==typeof o?new Date(o||0):o;try{return vu(e,"dateTimeRange",t,a).formatRange(l,c)}catch(t){e.onError(new ou("Error formatting date time range.",e.locale,t))}return String(l)}function wu(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=r[0],o=r[1],s=void 0===o?{}:o,a="string"==typeof i?new Date(i||0):i;try{return vu(e,"date",t,s).formatToParts(a)}catch(t){e.onError(new ou("Error formatting date.",e.locale,t))}return[]}function Eu(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=r[0],o=r[1],s=void 0===o?{}:o,a="string"==typeof i?new Date(i||0):i;try{return vu(e,"time",t,s).formatToParts(a)}catch(t){e.onError(new ou("Error formatting time.",e.locale,t))}return[]}var bu=["style","type","fallback","languageDisplay"];function Ru(e,t,r,n){var i=e.locale,o=e.onError;Intl.DisplayNames||o(new Wc('Intl.DisplayNames is not available in this environment.\nTry polyfilling it using "@formatjs/intl-displaynames"\n',$c.MISSING_INTL_API));var s=lu(n,bu);try{return t(i,s).of(r)}catch(e){o(new ou("Error formatting display name.",i,e))}}var Tu=["type","style"],Nu=Date.now();function Ou(e,t,r,n){void 0===n&&(n={});var i=Cu(e,t,r,n).reduce(function(e,t){var r=t.value;return"string"!=typeof r?e.push(r):"string"==typeof e[e.length-1]?e[e.length-1]+=r:e.push(r),e},[]);return 1===i.length?i[0]:0===i.length?"":i}function Cu(e,t,r,n){var i=e.locale,o=e.onError;void 0===n&&(n={}),Intl.ListFormat||o(new Wc('Intl.ListFormat is not available in this environment.\nTry polyfilling it using "@formatjs/intl-listformat"\n',$c.MISSING_INTL_API));var s=lu(n,Tu);try{var a={},l=r.map(function(e,t){if("object"==typeof e){var r=function(e){return"".concat(Nu,"_").concat(e,"_").concat(Nu)}(t);return a[r]=e,r}return String(e)});return t(i,s).formatToParts(l).map(function(e){return"literal"===e.type?e:hi(hi({},e),{value:a[e.value]||e.value})})}catch(e){o(new ou("Error formatting list.",i,e))}return r}var Lu=["style","currency","unit","unitDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","currencyDisplay","currencySign","notation","signDisplay","unit","unitDisplay","numberingSystem","trailingZeroDisplay","roundingPriority","roundingIncrement","roundingMode"];function Au(e,t,r){var n=e.locale,i=e.formats,o=e.onError;void 0===r&&(r={});var s=r.format,a=s&&du(i,"number",s,o)||{};return t(n,lu(r,Lu,a))}function Du(e,t,r,n){void 0===n&&(n={});try{return Au(e,t,n).format(r)}catch(t){e.onError(new ou("Error formatting number.",e.locale,t))}return String(r)}function _u(e,t,r,n){void 0===n&&(n={});try{return Au(e,t,n).formatToParts(r)}catch(t){e.onError(new ou("Error formatting number.",e.locale,t))}return[]}var Pu=["type"];function xu(e,t,r,n){var i=e.locale,o=e.onError;void 0===n&&(n={}),Intl.PluralRules||o(new Wc('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',$c.MISSING_INTL_API));var s=lu(n,Pu);try{return t(i,s).select(r)}catch(e){o(new ou("Error formatting plural.",i,e))}return"other"}var Mu=["numeric","style"];function ku(e,t,r,n,i){void 0===i&&(i={}),n||(n="second"),Intl.RelativeTimeFormat||e.onError(new Wc('Intl.RelativeTimeFormat is not available in this environment.\nTry polyfilling it using "@formatjs/intl-relativetimeformat"\n',$c.MISSING_INTL_API));try{return function(e,t,r){var n=e.locale,i=e.formats,o=e.onError;void 0===r&&(r={});var s=r.format,a=!!s&&du(i,"relative",s,o)||{};return t(n,lu(r,Mu,a))}(e,t,i).format(r,n)}catch(t){e.onError(new ou("Error formatting relative time.",e.locale,t))}return String(r)}function ju(e){var t;e.onWarn&&e.defaultRichTextElements&&"string"==typeof((t=e.messages||{})?t[Object.keys(t)[0]]:void 0)&&e.onWarn('[@formatjs/intl] "defaultRichTextElements" was specified but "message" was not pre-compiled. \nPlease consider using "@formatjs/cli" to pre-compile your messages for performance.\nFor more details see https://formatjs.github.io/docs/getting-started/message-distribution')}function Fu(e,t){var r=function(e){void 0===e&&(e={dateTime:{},number:{},message:{},relativeTime:{},pluralRules:{},list:{},displayNames:{}});var t=Intl.RelativeTimeFormat,r=Intl.ListFormat,n=Intl.DisplayNames,i=Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,fi([void 0],t,!1)))},{cache:uu(e.dateTime),strategy:Vl.variadic}),o=Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,fi([void 0],t,!1)))},{cache:uu(e.number),strategy:Vl.variadic}),s=Al(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,fi([void 0],t,!1)))},{cache:uu(e.pluralRules),strategy:Vl.variadic});return{getDateTimeFormat:i,getNumberFormat:o,getMessageFormat:Al(function(e,t,r,n){return new eu(e,t,r,hi({formatters:{getNumberFormat:o,getDateTimeFormat:i,getPluralRules:s}},n||{}))},{cache:uu(e.message),strategy:Vl.variadic}),getRelativeTimeFormat:Al(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new(t.bind.apply(t,fi([void 0],e,!1)))},{cache:uu(e.relativeTime),strategy:Vl.variadic}),getPluralRules:s,getListFormat:Al(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(r.bind.apply(r,fi([void 0],e,!1)))},{cache:uu(e.list),strategy:Vl.variadic}),getDisplayNames:Al(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(n.bind.apply(n,fi([void 0],e,!1)))},{cache:uu(e.displayNames),strategy:Vl.variadic})}}(t),n=hi(hi({},cu),e),i=n.locale,o=n.defaultLocale,s=n.onError;return i?!Intl.NumberFormat.supportedLocalesOf(i).length&&s?s(new iu('Missing locale data for locale: "'.concat(i,'" in Intl.NumberFormat. Using default locale: "').concat(o,'" as fallback. See https://formatjs.github.io/docs/react-intl#runtime-requirements for more details'))):!Intl.DateTimeFormat.supportedLocalesOf(i).length&&s&&s(new iu('Missing locale data for locale: "'.concat(i,'" in Intl.DateTimeFormat. Using default locale: "').concat(o,'" as fallback. See https://formatjs.github.io/docs/react-intl#runtime-requirements for more details'))):(s&&s(new nu('"locale" was not configured, using "'.concat(o,'" as fallback. See https://formatjs.github.io/docs/react-intl/api#intlshape for more details'))),n.locale=n.defaultLocale||"en"),ju(n),hi(hi({},n),{formatters:r,formatNumber:Du.bind(null,n,r.getNumberFormat),formatNumberToParts:_u.bind(null,n,r.getNumberFormat),formatRelativeTime:ku.bind(null,n,r.getRelativeTimeFormat),formatDate:yu.bind(null,n,r.getDateTimeFormat),formatDateToParts:wu.bind(null,n,r.getDateTimeFormat),formatTime:Su.bind(null,n,r.getDateTimeFormat),formatDateTimeRange:Iu.bind(null,n,r.getDateTimeFormat),formatTimeToParts:Eu.bind(null,n,r.getDateTimeFormat),formatPlural:xu.bind(null,n,r.getPluralRules),formatMessage:mu.bind(null,n,r),$t:mu.bind(null,n,r),formatList:Ou.bind(null,n,r.getListFormat),formatListToParts:Cu.bind(null,n,r.getListFormat),formatDisplayName:Ru.bind(null,n,r.getDisplayNames)})}function Uu(e){!function(e,t,r){if(void 0===r&&(r=Error),!e)throw new r(t)}(e,"[React Intl] Could not find required `intl` object. <IntlProvider> needs to exist in the component ancestry.")}var Bu=hi(hi({},cu),{textComponent:Co.Fragment}),Vu={key:42},Gu=function(e){return Co.isValidElement(e)?Co.createElement(Co.Fragment,Vu,e):e};function $u(e){return e?Object.keys(e).reduce(function(t,r){var n,i=e[r];return t[r]=Kc(i)?(n=i,function(e){return n(Co.Children.toArray(e))}):i,t},{}):e}var Hu=function(e,t,r,n){for(var i=[],o=4;o<arguments.length;o++)i[o-4]=arguments[o];var s=$u(n),a=mu.apply(void 0,fi([e,t,r,s],i,!1));return Array.isArray(a)?function(e){var t;return null!==(t=Co.Children.map(e,Gu))&&void 0!==t?t:[]}(a):a},Wu=function(e,t){var r=e.defaultRichTextElements,n=pi(e,["defaultRichTextElements"]),i=$u(r),o=Fu(hi(hi(hi({},Bu),n),{defaultRichTextElements:i}),t),s={locale:o.locale,timeZone:o.timeZone,fallbackOnEmptyString:o.fallbackOnEmptyString,formats:o.formats,defaultLocale:o.defaultLocale,defaultFormats:o.defaultFormats,messages:o.messages,onError:o.onError,defaultRichTextElements:i};return hi(hi({},o),{formatMessage:Hu.bind(null,s,o.formatters),$t:Hu.bind(null,s,o.formatters)})},zu=m(67386),qu=(m(56037),Co.version.startsWith("19")),Ju=Symbol.for(qu?"react.transitional.element":"react.element"),Ku=Symbol.for("react.portal"),Yu=Symbol.for("react.fragment"),Xu=Symbol.for("react.strict_mode"),Qu=Symbol.for("react.profiler"),Zu=Symbol.for("react.consumer"),ed=Symbol.for("react.context"),td=Symbol.for("react.forward_ref"),rd=Symbol.for("react.suspense"),nd=Symbol.for("react.suspense_list"),id=Symbol.for("react.memo"),od=Symbol.for("react.lazy"),sd=td,ad=id;function ld(e){if("object"==typeof e&&null!==e){const{$$typeof:t}=e;switch(t){case Ju:switch(e=e.type){case Yu:case Qu:case Xu:case rd:case nd:return e;default:switch(e=e&&e.$$typeof){case ed:case td:case od:case id:case Zu:return e;default:return t}}case Ku:return t}}}function cd(e,t,r,n,{areStatesEqual:i,areOwnPropsEqual:o,areStatePropsEqual:s}){let a,l,c,u,d,h=!1;function p(h,p){const f=!o(p,l),m=!i(h,a,p,l);return a=h,l=p,f&&m?(c=e(a,l),t.dependsOnOwnProps&&(u=t(n,l)),d=r(c,u,l),d):f?(e.dependsOnOwnProps&&(c=e(a,l)),t.dependsOnOwnProps&&(u=t(n,l)),d=r(c,u,l),d):m?function(){const t=e(a,l),n=!s(t,c);return c=t,n&&(d=r(c,u,l)),d}():d}return function(i,o){return h?p(i,o):(a=i,l=o,c=e(a,l),u=t(n,l),d=r(c,u,l),h=!0,d)}}function ud(e){return function(t){const r=e(t);function n(){return r}return n.dependsOnOwnProps=!1,n}}function dd(e){return e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function hd(e,t){return function(t,{displayName:r}){const n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e,void 0)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=dd(e);let i=n(t,r);return"function"==typeof i&&(n.mapToProps=i,n.dependsOnOwnProps=dd(i),i=n(t,r)),i},n}}function pd(e,t){return(r,n)=>{throw new Error(`Invalid value of type ${typeof e} for ${t} argument when connecting component ${n.wrappedComponentName}.`)}}function fd(e,t,r){return{...r,...e,...t}}function md(e){e()}var gd={notify(){},get:()=>[]};function vd(e,t){let r,n=gd,i=0,o=!1;function s(){c.onStateChange&&c.onStateChange()}function a(){i++,r||(r=t?t.addNestedSub(s):e.subscribe(s),n=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){md(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=e;for(;r;)t.push(r),r=r.next;return t},subscribe(r){let n=!0;const i=t={callback:r,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){n&&null!==e&&(n=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function l(){i--,r&&0===i&&(r(),r=void 0,n.clear(),n=gd)}const c={addNestedSub:function(e){a();const t=n.subscribe(e);let r=!1;return()=>{r||(r=!0,t(),l())}},notifyNestedSubs:function(){n.notify()},handleChangeWrapper:s,isSubscribed:function(){return o},trySubscribe:function(){o||(o=!0,a())},tryUnsubscribe:function(){o&&(o=!1,l())},getListeners:()=>n};return c}var yd=(()=>!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement))(),Sd=(()=>"undefined"!=typeof navigator&&"ReactNative"===navigator.product)(),Id=(()=>yd||Sd?Co.useLayoutEffect:Co.useEffect)();function wd(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function Ed(e,t){if(wd(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(t,r[n])||!wd(e[r[n]],t[r[n]]))return!1;return!0}var bd={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Rd={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Td={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Nd={[sd]:{$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},[ad]:Td};function Od(e){return ld(e)===id?Td:Nd[e.$$typeof]||bd}var Cd=Object.defineProperty,Ld=Object.getOwnPropertyNames,Ad=Object.getOwnPropertySymbols,Dd=Object.getOwnPropertyDescriptor,_d=Object.getPrototypeOf,Pd=Object.prototype;function xd(e,t){if("string"!=typeof t){if(Pd){const r=_d(t);r&&r!==Pd&&xd(e,r)}let r=Ld(t);Ad&&(r=r.concat(Ad(t)));const n=Od(e),i=Od(t);for(let o=0;o<r.length;++o){const s=r[o];if(!(Rd[s]||i&&i[s]||n&&n[s])){const r=Dd(t,s);try{Cd(e,s,r)}catch(e){}}}}return e}var Md=Symbol.for("react-redux-context"),kd="undefined"!=typeof globalThis?globalThis:{};function jd(){if(!Co.createContext)return{};const e=kd[Md]??=new Map;let t=e.get(Co.createContext);return t||(t=Co.createContext(null),e.set(Co.createContext,t)),t}var Fd=jd(),Ud=[null,null];function Bd(e,t,r,n,i,o){e.current=n,r.current=!1,i.current&&(i.current=null,o())}function Vd(e,t){return e===t}var Gd=function(e,t,r,{pure:n,areStatesEqual:i=Vd,areOwnPropsEqual:o=Ed,areStatePropsEqual:s=Ed,areMergedPropsEqual:a=Ed,forwardRef:l=!1,context:c=Fd}={}){const u=c,d=function(e){return e?"function"==typeof e?hd(e):pd(e,"mapStateToProps"):ud(()=>({}))}(e),h=function(e){return e&&"object"==typeof e?ud(t=>function(e,t){const r={};for(const n in e){const i=e[n];"function"==typeof i&&(r[n]=(...e)=>t(i(...e)))}return r}(e,t)):e?"function"==typeof e?hd(e):pd(e,"mapDispatchToProps"):ud(e=>({dispatch:e}))}(t),p=function(e){return e?"function"==typeof e?function(e){return function(t,{displayName:r,areMergedPropsEqual:n}){let i,o=!1;return function(t,r,s){const a=e(t,r,s);return o?n(a,i)||(i=a):(o=!0,i=a),i}}}(e):pd(e,"mergeProps"):()=>fd}(r),f=Boolean(e);return e=>{const t=e.displayName||e.name||"Component",r=`Connect(${t})`,n={shouldHandleStateChanges:f,displayName:r,wrappedComponentName:t,WrappedComponent:e,initMapStateToProps:d,initMapDispatchToProps:h,initMergeProps:p,areStatesEqual:i,areStatePropsEqual:s,areOwnPropsEqual:o,areMergedPropsEqual:a};function c(t){const[r,i,o]=Co.useMemo(()=>{const{reactReduxForwardedRef:e,...r}=t;return[t.context,e,r]},[t]),s=Co.useMemo(()=>u,[r,u]),a=Co.useContext(s),l=Boolean(t.store)&&Boolean(t.store.getState)&&Boolean(t.store.dispatch),c=Boolean(a)&&Boolean(a.store);const d=l?t.store:a.store,h=c?a.getServerState:d.getState,p=Co.useMemo(()=>function(e,{initMapStateToProps:t,initMapDispatchToProps:r,initMergeProps:n,...i}){return cd(t(e,i),r(e,i),n(e,i),e,i)}(d.dispatch,n),[d]),[m,g]=Co.useMemo(()=>{if(!f)return Ud;const e=vd(d,l?void 0:a.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]},[d,l,a]),v=Co.useMemo(()=>l?a:{...a,subscription:m},[l,a,m]),y=Co.useRef(void 0),S=Co.useRef(o),I=Co.useRef(void 0),w=Co.useRef(!1),E=Co.useRef(!1),b=Co.useRef(void 0);Id(()=>(E.current=!0,()=>{E.current=!1}),[]);const R=Co.useMemo(()=>()=>I.current&&o===S.current?I.current:p(d.getState(),o),[d,o]),T=Co.useMemo(()=>e=>m?function(e,t,r,n,i,o,s,a,l,c,u){if(!e)return()=>{};let d=!1,h=null;const p=()=>{if(d||!a.current)return;const e=t.getState();let r,p;try{r=n(e,i.current)}catch(e){p=e,h=e}p||(h=null),r===o.current?s.current||c():(o.current=r,l.current=r,s.current=!0,u())};return r.onStateChange=p,r.trySubscribe(),p(),()=>{if(d=!0,r.tryUnsubscribe(),r.onStateChange=null,h)throw h}}(f,d,m,p,S,y,w,E,I,g,e):()=>{},[m]);var N,O,C;let L;N=Bd,O=[S,y,w,o,I,g],Id(()=>N(...O),C);try{L=Co.useSyncExternalStore(T,R,h?()=>p(h(),o):R)}catch(e){throw b.current&&(e.message+=`\nThe error may be correlated with this previous error:\n${b.current.stack}\n\n`),e}Id(()=>{b.current=void 0,I.current=void 0,y.current=L});const A=Co.useMemo(()=>Co.createElement(e,{...L,ref:i}),[i,e,L]);return Co.useMemo(()=>f?Co.createElement(s.Provider,{value:v},A):A,[s,A,v])}const m=Co.memo(c);if(m.WrappedComponent=e,m.displayName=c.displayName=r,l){const t=Co.forwardRef(function(e,t){return Co.createElement(m,{...e,reactReduxForwardedRef:t})});return t.displayName=r,t.WrappedComponent=e,xd(t,e)}return xd(m,e)}};var $d=m(4146),Hd=m.n($d);var Wd="undefined"==typeof window||window.__REACT_INTL_BYPASS_GLOBAL_CONTEXT__?Co.createContext(null):window.__REACT_INTL_CONTEXT__||(window.__REACT_INTL_CONTEXT__=Co.createContext(null)),zd=Wd.Consumer,qd=Wd.Provider;function Jd(e){return{locale:e.locale,timeZone:e.timeZone,fallbackOnEmptyString:e.fallbackOnEmptyString,formats:e.formats,textComponent:e.textComponent,messages:e.messages,defaultLocale:e.defaultLocale,defaultFormats:e.defaultFormats,onError:e.onError,onWarn:e.onWarn,wrapRichTextChunksInFragment:e.wrapRichTextChunksInFragment,defaultRichTextElements:e.defaultRichTextElements}}var Kd=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cache={dateTime:{},number:{},message:{},relativeTime:{},pluralRules:{},list:{},displayNames:{}},t.state={cache:t.cache,intl:Wu(Jd(t.props),t.cache),prevConfig:Jd(t.props)},t}return di(t,e),t.getDerivedStateFromProps=function(e,t){var r=t.prevConfig,n=t.cache,i=Jd(e);return function(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e),n=Object.keys(t),i=r.length;if(n.length!==i)return!1;for(var o=0;o<i;o++){var s=r[o];if(e[s]!==t[s]||!Object.prototype.hasOwnProperty.call(t,s))return!1}return!0}(r,i)?null:{intl:Wu(i,n),prevConfig:i}},t.prototype.render=function(){return Uu(this.state.intl),Co.createElement(qd,{value:this.state.intl},this.props.children)},t.displayName="IntlProvider",t.defaultProps=Bu,t}(Co.PureComponent);const Yd=Kd;var Xd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qd=/^\w*$/;const Zd=function(e,t){if(Ft(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Cn(e))||(Qd.test(e)||!Xd.test(e)||null!=t&&e in Object(t))};function eh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(eh.Cache||It),r}eh.Cache=It;const th=eh;var rh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nh=/\\(\\)?/g;const ih=function(e){var t=th(e,function(e){return 500===r.size&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rh,function(e,r,n,i){t.push(n?i.replace(nh,"$1"):r||e)}),t});const oh=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i};var sh=Ce?Ce.prototype:void 0,ah=sh?sh.toString:void 0;const lh=function e(t){if("string"==typeof t)return t;if(Ft(t))return oh(t,e)+"";if(Cn(t))return ah?ah.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};const ch=function(e){return null==e?"":lh(e)};const uh=function(e,t){return Ft(e)?e:Zd(e,t)?[e]:ih(ch(e))};const dh=function(e){if("string"==typeof e||Cn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const hh=function(e,t,r,n){if(!Fe(e))return e;for(var i=-1,o=(t=uh(t,e)).length,s=o-1,a=e;null!=a&&++i<o;){var l=dh(t[i]),c=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=s){var u=a[l];void 0===(c=n?n(u,l,a):void 0)&&(c=Fe(u)?u:or(t[i+1])?[]:{})}Go(a,l,c),a=a[l]}return e};const ph=function(e,t,r){return null==e?e:hh(e,t,r)};const fh=function(e,t){for(var r=0,n=(t=uh(t,e)).length;null!=e&&r<n;)e=e[dh(t[r++])];return r&&r==n?e:void 0};const mh=function(e,t,r){var n=null==e?void 0:fh(e,t);return void 0===n?r:n};class gh{constructor(){this.state={}}static getInstance(){return gh.instance||(gh.instance=new gh,window._mutableStoreManager=gh.instance),gh.instance}updateStateValue(e,t,r){var n;const i=null!==(n=null==t?void 0:t.split("."))&&void 0!==n?n:[],o=[e].concat(i);ph(this.state,o,r),Ya().dispatch(function(e,t){return{type:ja.WidgetMutableStatePropChange,widgetId:e,propKey:t}}(e,t))}readStateValue(e,t){var r;const n=null!==(r=null==t?void 0:t.split("."))&&void 0!==r?r:[],i=[e].concat(n);return mh(this.state,i)}getStateValue(e){return mh(this.state,e)}getState(){return this.state}clearState(){Object.keys(this.state).forEach(e=>{delete this.state[e]})}}const vh=Co.createContext(null);vh.Consumer;var yh,Sh,Ih,wh,Eh;!function(e){e.StringSelectionChange="STRING_SELECTION_CHANGE",e.ExtentChange="EXTENT_CHANGE",e.DataRecordsSelectionChange="DATA_RECORDS_SELECTION_CHANGE",e.DataSourceFilterChange="DATA_SOURCE_FILTER_CHANGE",e.DataRecordSetChange="DATA_RECORD_SET_CHANGE",e.DataSourcesChange="DATA_SOURCES_CHANGE",e.LocationChange="LOCATION_CHANGE",e.SelectDataRecord="SELECT_DATA_RECORD",e.ButtonClick="BUTTON_CLICK",e.ViewChange="VIEW_CHANGE"}(yh||(yh={})),function(e){e.UseDataSource="USE_DATA_SOURCE",e.OutputDataSource="OUTPUT_DATA_SOURCE",e.BothDataSource="BOTH_DATA_SOURCE"}(Sh||(Sh={}));!function(e){e.CreateUpdate="CREATE_UPDATE",e.Remove="REMOVE"}(Ih||(Ih={}));!function(e){e.Create="CREATE",e.Remove="REMOVE"}(wh||(wh={}));class bh{constructor(e){this.id=e.id,e.name&&(this.name=e.name),e.widgetId&&(this.widgetId=e.widgetId),e.sectionId&&(this.sectionId=e.sectionId),this.label=e.label,this.intl=e.intl}destroy(){return null}onRemoveListen(e,t){return null}}function Rh(){return Rh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rh.apply(null,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(Eh||(Eh={}));var Th=function(e){return e};var Nh="beforeunload",Oh="popstate";function Ch(e){e.preventDefault(),e.returnValue=""}function Lh(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(e){return e!==t})}},call:function(t){e.forEach(function(e){return e&&e(t)})}}}function Ah(){return Math.random().toString(36).substr(2,8)}function Dh(e){var t=e.pathname,r=void 0===t?"/":t,n=e.search,i=void 0===n?"":n,o=e.hash,s=void 0===o?"":o;return i&&"?"!==i&&(r+="?"===i.charAt(0)?i:"?"+i),s&&"#"!==s&&(r+="#"===s.charAt(0)?s:"#"+s),r}function _h(e){var t={};if(e){var r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));var n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}const Ph=[/\.arcgis\.com$/];var xh,Mh;function kh(e){const t=function(){try{return window.parent}catch(e){return null}}();if(!window||!t||t===window)return;const r=t;try{if(r.jimuConfig&&r.jimuConfig.isBuilder)return}catch(e){}r.postMessage(e,window.location.origin)}function jh(e,t){return function(r){if(!function(e){var t;return(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.origin)===e||Ph.some(t=>t.test(e))}(r.origin))return;if(!r.data)return;if(!Object.keys(Mh).map(e=>Mh[e]).includes(r.data.type))return;const n=r.data;n.type===e&&t(n)}}function Fh(e,t){if(!window||!window.addEventListener)return;const r=jh(e,t);return window.addEventListener("message",r,!1),r}!function(e){e.JimuPageChanged="JIMU_PAGE_CHANGED",e.JimuQueryChanged="JIMU_QUERY_CHANGED",e.JimuHashChanged="JIMU_HASH_CHANGED"}(xh||(xh={})),function(e){e.ChangePage="CHANGE_PAGE",e.ChangeQuery="CHANGE_QUERY"}(Mh||(Mh={}));class Uh{constructor(e,t,r,n,i,o){this.db=null,this.closed=!1,this.dbName=function(e,t){var r,n;const i=(null===(r=window.jimuConfig)||void 0===r?void 0:r.isBuilder)?null===(n=Ya().getState().appStateInBuilder)||void 0===n?void 0:n.appId:Ya().getState().appId;return`exb-${i}-${t}-${e}-cache`}(e,t),this.storeName=r,this.version=n,this.indexName=i,this.indexKey=o}init(){return indexedDB?Promise.resolve().then(()=>{const e=indexedDB.open(this.dbName,this.version);return e.onupgradeneeded=()=>{const t=e.result;if(!t.objectStoreNames.contains(this.storeName)){const e=t.createObjectStore(this.storeName,{autoIncrement:!0});this.indexName&&e.createIndex(this.indexName,this.indexKey)}},Bh(e)}).then(e=>{this.closed?e.close():this.db=e}):Promise.reject(new Error(null))}initialized(){return null!=this.db}close(){this.db&&(this.db.close(),this.db=null),this.closed=!0}put(e,t){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(t,e)).then()}putObject(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e))}putAllObject(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));const t=this.db.transaction([this.storeName],"readwrite");return e.forEach(e=>{t.objectStore(this.storeName).put(e)}),Vh(t)}putAll(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));const t=this.db.transaction([this.storeName],"readwrite");return e.forEach(e=>{t.objectStore(this.storeName).put(e.value,e.key)}),Vh(t)}get(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e))}getAllKeys(){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys())}getAll(){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll())}delete(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e))}deleteAll(e){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));const t=this.db.transaction([this.storeName],"readwrite");return e.forEach(e=>{t.objectStore(this.storeName).delete(e)}),Vh(t)}clear(){if(null==this.db)return Promise.reject(new Error("IndexedDB:not-initialized"));return Bh(this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear())}destroy(){this.db&&this.db.deleteObjectStore(this.storeName),this.close()}}function Bh(e){return new Promise((t,r)=>{"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=()=>{t(e.result)},e.onerror=()=>{r(e.error)})})}function Vh(e){return new Promise((t,r)=>{e.oncomplete=()=>{t()},e.onerror=()=>{r(e.error)},e.onabort=()=>{r(e.error)}})}var Gh=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class $h{constructor(){this.lastLocalState={},this.initialized=!1,this.restoreFunctions=[],this.shouldRestoreLocalState=!1}static getInstance(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._appStateManager:($h.instance||($h.instance=new $h,window._appStateManager=$h.instance),$h.instance)}static isSupportLocalState(){const e=!!window.indexedDB,t=!window.jimuConfig.isBuilder&&!window.jimuConfig.isSite&&!window.jimuConfig.isInBuilder;return e&&t}init(){return Gh(this,void 0,void 0,function*(){if(this.initialized)return this;this.localStateCache=new Uh("init","app_state_mananger","local_state"),yield this.localStateCache.init();const e=yield this.localStateCache.getAllKeys(),t=yield this.localStateCache.getAll();return e.forEach((e,r)=>{const n=t[r];null!=n&&(this.lastLocalState[e]=n)}),Object.freeze(this.lastLocalState),this.initialized=!0,this})}isLocalStateRestored(){return this.shouldRestoreLocalState}putLocalState(e,t){return Gh(this,void 0,void 0,function*(){this.initialized&&(yield this.localStateCache.put(e,t))})}getLocalState(e){return Gh(this,void 0,void 0,function*(){if(this.initialized)return yield this.localStateCache.get(e)})}getLastLocalState(e){if(this.initialized)return this.lastLocalState[e]}existLocalState(){return!!this.initialized&&Object.keys(this.lastLocalState).length>0}registerRestoreFunction(e){this.initialized&&(this.shouldRestoreLocalState?e(this.lastLocalState):this.restoreFunctions.includes(e)||this.restoreFunctions.push(e))}restoreLocalState(){if(this.initialized){this.shouldRestoreLocalState=!0;for(const e of this.restoreFunctions)e(this.lastLocalState)}}}const Hh=$h,Wh=document&&function(e){void 0===e&&(e={});var t=e.window,r=void 0===t?document.defaultView:t,n=r.history;function i(){var e=r.location,t=e.pathname,i=e.search,o=e.hash,s=n.state||{};return[s.idx,Th({pathname:t,search:i,hash:o,state:s.usr||null,key:s.key||"default"})]}var o=null;r.addEventListener(Oh,function(){if(o)d.call(o),o=null;else{var e=Eh.Pop,t=i(),r=t[0],n=t[1];if(d.length){if(null!=r){var s=l-r;s&&(o={action:e,location:n,retry:function(){v(-1*s)}},v(s))}}else g(e)}});var s=Eh.Pop,a=i(),l=a[0],c=a[1],u=Lh(),d=Lh();function h(e){return"string"==typeof e?e:Dh(e)}function p(e,t){return void 0===t&&(t=null),Th(Rh({pathname:c.pathname,hash:"",search:""},"string"==typeof e?_h(e):e,{state:t,key:Ah()}))}function f(e,t){return[{usr:e.state,key:e.key,idx:t},h(e)]}function m(e,t,r){return!d.length||(d.call({action:e,location:t,retry:r}),!1)}function g(e){s=e;var t=i();l=t[0],c=t[1],u.call({action:s,location:c})}function v(e){n.go(e)}null==l&&(l=0,n.replaceState(Rh({},n.state,{idx:l}),""));var y={get action(){return s},get location(){return c},createHref:h,push:function e(t,i){var o=Eh.Push,s=p(t,i);if(m(o,s,function(){e(t,i)})){var a=f(s,l+1),c=a[0],u=a[1];try{n.pushState(c,"",u)}catch(e){r.location.assign(u)}g(o)}},replace:function e(t,r){var i=Eh.Replace,o=p(t,r);if(m(i,o,function(){e(t,r)})){var s=f(o,l),a=s[0],c=s[1];n.replaceState(a,"",c),g(i)}},go:v,back:function(){v(-1)},forward:function(){v(1)},listen:function(e){return u.push(e)},block:function(e){var t=d.push(e);return 1===d.length&&r.addEventListener(Nh,Ch),function(){t(),d.length||r.removeEventListener(Nh,Ch)}}};return y}();Fh(Mh.ChangePage,e=>{qh(e.pageId)}),Fh(Mh.ChangeQuery,e=>{zh(e.queryObject)}),Wh&&Wh.listen(({action:e,location:t})=>{if(t.pathname!==Ya().getState().appPath){Ya().dispatch((n=t.pathname,{type:ja.AppPathChanged,path:n}));const e=vl(t.pathname,Ya().getState().appConfig).pageId;r=e,kh({type:xh.JimuPageChanged,pageId:r})}var r,n;const i=Ya().getState().queryObject.asMutable(),o=X.parse(t.search);if(o.data_filter){const e=X.parse(t.search,{decode:!1});o.data_filter=e.data_filter}var s,a;Xr(i,o)||(Ya().dispatch((a=o,{type:ja.QueryObjectChanged,query:a})),s=o,kh({type:xh.JimuQueryChanged,queryObject:s}));const l=function(e){let t={};t=X.parse(e,{decode:!1});for(const e of Object.keys(t)){let r;e===R.Data_s?(r=al(t[e],R.Data_s),t=Object.assign(t,r)):ol(e)&&(r=al(t[e],R.Widgets),t[e]=r)}return t}(t.hash);var c,u;Xr(l,Ya().getState().urlHashObject.asMutable())||(Ya().dispatch((u=l,{type:ja.UrlHashObjectChanged,hash:u})),c=l,kh({type:xh.JimuHashChanged,urlHashObject:c})),window.jimuConfig.isBuilder||window.jimuConfig.isSite||window.jimuConfig.isInBuilder||function(){const e=Hh.getInstance(),t=Ya().getState(),r=t.appConfig,n=t.appRuntimeInfo;if(!e||!r||!n)return;const i=null==n?void 0:n.currentPageId;e.putLocalState("app_current_page",i);const o=null==n?void 0:n.currentDialogId;e.putLocalState("app_current_dlg",o);const s=null==n?void 0:n.sectionNavInfos,a=Object.entries(s||{}).reduce((e,[t,n])=>{var i,o;const s=n.currentViewId||(null===(o=null===(i=r.sections[t])||void 0===i?void 0:i.views)||void 0===o?void 0:o[0]);return s&&e.push(s),e},[]);e.putLocalState("app_current_views",a)}()});Co.createContext(Wh);function zh(e,t=!1,r=!1){if(Xr(e,Ya().getState().queryObject))return;let n=r?an(e):Ya().getState().queryObject.merge(e);n=n.without.apply(n,Object.keys(n).filter(e=>null===n[e]));const i=sl(n),o=ul(Wh.location,"?"+i);try{t?Wh.replace(o):Wh.push(o)}catch(e){console.error("Failed to change browser history",e)}}function qh(e){vl(window.location.pathname,Ya().getState().appConfig).pageId!==e&&Wh.push(Rl(e,Ya().getState().queryObject))}function Jh(e,t){const r=Ya().getState();let n=r.queryObject.views?r.queryObject.views.split(","):[];n=n.map(e=>Sl(e,r.appConfig));const i=n.length,o=Object.keys(r.appConfig.views);n=n.filter(e=>o.includes(e));const s=n.length;if(n.includes(t)){if(i===s)return;zh({views:n.map(e=>r.appConfig.views[e].label).sort().join(",")})}else n=n.filter(t=>!r.appConfig.sections[e].views.includes(t)),n.push(t),zh({views:n.map(e=>bl(r.appConfig.views[e].label)).sort().join(",")})}class Kh extends bh{constructor(){super(...arguments),this.name="change view action"}getDefaultMessageActionConfig(){return{}}filterMessageDescription(e){return e.messageType===yh.DataRecordsSelectionChange}filterMessage(e){return!0}getSettingComponentUri(){return"change-section-view-action"}onExecute(e,t){const r=e;if(!r.records||0===r.records.length)return!0;let n;if(n=Array.isArray(t)&&t.length>0?t[t.length-1]:t,n){const{sectionId:e,viewId:t,useDataSources:i}=n;if((null==i?void 0:i.length)>0){const e=r.records[0].dataSource.id;if(!i.some(t=>t.dataSourceId===e||t.mainDataSourceId===e))return!0}Jh(e,t)}return!0}}var Yh=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Xh{constructor(){this.actions=[],this.actionClassPromises={}}static getInstance(){return Xh.instance||(Xh.instance=new Xh,window._messageManager=Xh.instance),Xh.instance}getActions(){return this.actions}getWidgetActions(e){return this.actions.filter(t=>t.widgetId===e)}getAction(e,t){return this.actions.find(r=>r.widgetId===e&&r.name===t)}destroyWidgetActions(e){this.actions=this.actions.filter(t=>(t.widgetId===e&&t.destroy(),t.widgetId!==e))}destroySectionActions(e){this.actions=this.actions.filter(t=>t.sectionId!==e||(t.destroy(),!1))}registerWidgetActions(e,t){return Yh(this,void 0,void 0,function*(){const r=[];return e.manifest.messageActions&&e.manifest.messageActions.forEach(n=>{const i=e.uri+"dist/"+n.uri;r.push(this.registerAction({id:`${e.id}-${n.name}`,name:n.name,uri:i,widgetId:e.id,appConfig:t,label:e.manifest.i18nMessages[`_action_${n.name}_label`]||n.label||n.name}))}),Promise.all(r)})}registerSectionActions(e,t){return Yh(this,void 0,void 0,function*(){const r=hp();return this.registerAction({id:`${e}-change-view-action`,name:"change-view",sectionId:e,appConfig:t,label:r.formatMessage({id:"messageAction_ChangeView",defaultMessage:jo.messageAction_ChangeView}),ActionClass:Kh})})}registerAction(e){return Yh(this,void 0,void 0,function*(){let t=this.actions.find(t=>t.id===e.id);if(t)return Promise.resolve(t);return(()=>Yh(this,void 0,void 0,function*(){return e.ActionClass?Promise.resolve(e.ActionClass):this.loadActionClass(e)}))().then(r=>Yh(this,void 0,void 0,function*(){t=new r({id:e.id,name:e.name,widgetId:e.widgetId,sectionId:e.sectionId,label:e.label,intl:hp(e.widgetId,"runtime")});let n=[];if(r.versionManager&&e.appConfig){const t=function(e,t,r){let n=[];return e.messageConfigs&&Object.entries(e.messageConfigs).forEach(([e,i])=>{n=n.concat(i.actions&&i.actions.filter(e=>e.widgetId===t&&e.actionName===r))}),n}(e.appConfig,e.widgetId,e.name);n=t.map(t=>Yh(this,void 0,void 0,function*(){return this.upgradeActionConfig(t,r.versionManager,e.appConfig.widgets[e.widgetId].manifest.version)}))}return Promise.all(n).then(()=>(this.actions.push(t),t))}))})}upgradeActionConfig(e,t,r){return Yh(this,void 0,void 0,function*(){const n=e.version,i=e.widgetId,o=e.config;return n||(e.version="1.0.0-beta2"),r===n?o:t?Qa.valid(n)&&Qa.valid(r)?t.upgrade(o,n,r,e.actionId).then(t=>{e.config=t,e.version=r}):(console.error("Bad widget action config version number, "+i+","+n+","+r),o):o})}loadActionClass(e){return Yh(this,void 0,void 0,function*(){const t=e.uri;return this.actionClassPromises[t]||(e.widgetId&&(yield this.loadDependency(e)),this.actionClassPromises[t]=Cl(t).then(e=>e.default)),this.actionClassPromises[t]})}loadDependency(e){return Yh(this,void 0,void 0,function*(){var t;const{widgetId:r,appConfig:n}=e,i=null===(t=(n||Ya().getState().appConfig).widgets[r])||void 0===t?void 0:t.manifest;if(!i||!i.dependency)return Promise.resolve();return Zi("string"==typeof i.dependency?[i.dependency]:i.dependency)})}publishMessage(e){return Yh(this,void 0,void 0,function*(){const t=Ya().getState().appConfig.messageConfigs,r=Object.keys(t||{});let n=null;for(let i=0;i<r.length;i++)if(t[r[i]].messageType===e.type&&t[r[i]].widgetId===e.widgetId){n=t[r[i]];break}if(n)for(let t=0;t<n.actions.length;t++){const r=n.actions[t],i=this.actions.find(e=>e.name===r.actionName&&(!(!r.widgetId||r.widgetId!==e.widgetId)||(!(!r.sectionId||r.sectionId!==e.sectionId)||!(r.widgetId||e.widgetId||r.sectionId))));if(!i){console.error(`Not find action: ${r.actionName}`);break}if(!i.filterMessage(e))break;i.widgetId&&this.openWidget(i.widgetId);if(!(yield this.exeAction(i,e,r)))return void console.warn(`Action execute failed. id: ${i.id}`)}})}openWidget(e){}exeAction(e,t,r){return Yh(this,void 0,void 0,function*(){var n;if((null===(n=r.useDataSources)||void 0===n?void 0:n.length)>0)try{yield Promise.all(r.useDataSources.asMutable({deep:!1}).map(e=>ka.getInstance().createDataSourceByUseDataSource(e)))}catch(e){return Promise.resolve(!0)}const i=e.onExecute(t,r.config);return i&&i instanceof Promise?i.then(e=>e,function(e){return Yh(this,void 0,void 0,function*(){return console.error(e),Promise.resolve(!1)})}):Promise.resolve(i)})}}const Qh=Xh;var Zh=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function ep(e,t){var r,n,i,o,s,a;const l=t.widgetId;if(!t.supportProviderWidget&&e===l)return!1;const c=null===(r=Ya().getState().appConfig)||void 0===r?void 0:r.widgets[e];if(!c)return!1;const u=c.dataActions;if(null===(i=null===(n=null==u?void 0:u[t.name])||void 0===n?void 0:n.enabled)||void 0===i||i){const e=null===(s=null===(o=null==u?void 0:u[t.name])||void 0===o?void 0:o.actions)||void 0===s?void 0:s[l];return null===(a=null==e?void 0:e.enabled)||void 0===a||a}return!1}class tp{constructor(){this.actions=[],this.actionClassPromises={}}static getInstance(){return tp.instance||(tp.instance=new tp,window._dataActionManager=tp.instance),tp.instance}getActions(){return this.actions}getSupportedActions(e,t,r){return Zh(this,void 0,void 0,function*(){var n,i;const o={},s=Ya().getState().appConfig,a=null===(n=(null==s?void 0:s.widgets[e]).manifest)||void 0===n?void 0:n.excludeDataActions,l=function(e){var t,r;const n=Ya().getState(),i=(null===(t=window.jimuConfig)||void 0===t?void 0:t.isBuilder)?n.appStateInBuilder:n,o=i.appConfig,s=null===(r=i.appRuntimeInfo)||void 0===r?void 0:r.currentPageId,a=i.browserSizeMode,l=Ol("jimu-layouts/layout-runtime"),c=l.searchUtils.getContentRootContainerInfo(o,e,No.Widget,a,!1);return l.searchUtils.getContentsInContainerRecursiveAdv(o,c,No.Widget,a,{includePending:!1,includeOtherSizeMode:!1,currentPageId:s})}(e),c=[];for(const t of this.actions){let r=!1;if(t.widgetId){const n=null===(i=Ya().getState().appConfig)||void 0===i?void 0:i.widgets[t.widgetId];r=this.isActionExcluded(`${n.manifest.name}.${t.name}`,a)||!ep(e,t)}else r=(null==a?void 0:a.includes(t.name))||!ep(e,t);r||c.push(t)}return yield Promise.all(c.map(n=>Zh(this,void 0,void 0,function*(){let i=!1;try{i=yield this.testActionSupportData(n,t,r,e)}catch(t){console.error("testActionSupportData error",n,r,e),i=!1}i&&(n.widgetId&&!l.includes(n.widgetId)||(o[n.name]||(o[n.name]=[]),o[n.name].push(n)))}))),o})}isActionExcluded(e,t=[]){const r=e.split(".");if(2!==r.length)return!0;const n=`${r[0]}.*`;return t.some(t=>t===e||t===n)}registerWidgetActions(e,t){return Zh(this,void 0,void 0,function*(){const r=[];if(!e.uri)return r;const n=n=>Zh(this,void 0,void 0,function*(){var i;const o=e.uri+"dist/"+n.uri,s=`${e.id}-${n.name}`,a=yield this.registerAction({id:s,name:n.name,uri:o,widgetId:e.id,label:null!==(i=e.manifest.i18nMessages[`_action_${n.name}_label`])&&void 0!==i?i:n.label,icon:`${Lo(e.uri).folderUrl}dist/${n.icon}`,appConfig:t});a&&r.push(a)});if(e.manifest.dataActions)for(let t=0;t<e.manifest.dataActions.length;t++){const r=e.manifest.dataActions[t];yield n(r)}return r})}registerAction(e){return Zh(this,void 0,void 0,function*(){const t=this.actions.find(t=>t.id===e.id);if(t)return t;const r=()=>Zh(this,void 0,void 0,function*(){return e.ActionClass?e.ActionClass:this.loadActionClass(e)});try{const t=new(yield r())({id:e.id,name:e.name,label:e.label,icon:e.icon,widgetId:e.widgetId,intl:hp(e.widgetId,"runtime")});return this.actions.push(t),t}catch(t){console.error(`Action class ${e.uri} load failed.`,t)}return null})}executeDataAction(e,t,r,n,i){return Zh(this,void 0,void 0,function*(){return e.widgetId&&this.openWidget(e.widgetId),e.onExecute(t,r,n,i)})}openWidget(e){const t=Ol("jimu-layouts/layout-runtime"),r=Ya().getState(),n=r.appConfig,i=r.browserSizeMode,o=t.searchUtils.getParentWidgetIdOfContent(n,e,No.Widget,i);o&&(n.widgets[o].manifest.properties.isWidgetController?Ya().dispatch(Va(e)):this.openWidget(o))}destroyWidgetActions(e){this.actions=this.actions.filter(t=>(t.widgetId===e&&t.destroy(),t.widgetId!==e))}loadActionClass(e){return Zh(this,void 0,void 0,function*(){const t=e.uri;return this.actionClassPromises[t]||(e.widgetId&&(yield this.loadDependency(e)),this.actionClassPromises[t]=Cl(t).then(e=>e.default)),this.actionClassPromises[t]})}loadDependency(e){return Zh(this,void 0,void 0,function*(){var t;const{widgetId:r,appConfig:n}=e,i=null===(t=(n||Ya().getState().appConfig).widgets[r])||void 0===t?void 0:t.manifest;if(!i||!i.dependency)return Promise.resolve();return Zi("string"==typeof i.dependency?[i.dependency]:i.dependency)})}testActionSupportData(e,t,r,n){return Zh(this,void 0,void 0,function*(){return e.isSupported(t,r,n)})}}var rp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class np{static getInstance(){return np.instance||(np.instance=new np,window._widgetManager=np.instance),np.instance}constructor(){this.widgets={},Xa(this.onStoreChange.bind(this),["appConfig","widgets"]),Xa(this.onStoreSectionChange.bind(this),["appConfig","sections"]),Xa(this.onAppI18nMessagesChange.bind(this),["appI18nMessages"]),this.dsManager=ka.getInstance()}updateWidgetCache(e,t){if("__proto__"!==e&&"constructor"!==e&&"prototype"!==e){this.widgets[e]||(this.widgets[e]={});for(const r in t){if("__proto__"===r||"constructor"===r||"prototype"===r)return;this.widgets[e][r]=t[r]}}}getWidgetClass(e){var t,r,n;const i=null===(r=null===(t=Ya().getState().appConfig)||void 0===t?void 0:t.widgets)||void 0===r?void 0:r[e];if(i)return null===(n=this.widgets[i.uri])||void 0===n?void 0:n.clazz}getWidgetClassByUri(e){var t;return null===(t=this.widgets[e])||void 0===t?void 0:t.clazz}getWidgetI18nMessagesByUri(e){var t;return(null===(t=this.widgets[e])||void 0===t?void 0:t.i18nMessages)||{}}destroyWidget(e){var t,r;const n=null===(r=null===(t=Ya().getState().appConfig)||void 0===t?void 0:t.widgets)||void 0===r?void 0:r[e];n&&delete this.widgets[n.uri]}destroyWidgetByUri(e){this.checkWidgetUriInConfig(e)||delete this.widgets[e]}destroyAllWidgets(){this.widgets={}}checkWidgetUriInConfig(e){const t=Ya().getState().appConfig.widgets||{};return!!Object.keys(t).find(r=>t[r].uri===e)}loadWidgetClass(e){return rp(this,void 0,void 0,function*(){var t,r;const n=null===(r=null===(t=Ya().getState().appConfig)||void 0===t?void 0:t.widgets)||void 0===r?void 0:r[e];return n?this.loadWidgetClassByUri(n.uri):Promise.resolve(null)})}upgradeWidgetByUri(e,t){return rp(this,void 0,void 0,function*(){const r=Ya().getState().appConfig.widgets,n=Object.keys(r).map(e=>r[e]).filter(t=>t.uri===e);if(0===n.length)return;if(!t)return void Ya().dispatch(Ua(e));const i=n.map(e=>this.upgradeWidget(e,t)),o=(yield Promise.all(i)).filter(e=>!!e);Ya().dispatch(Ua(e,o))})}upgradeWidget(e,t){return rp(this,void 0,void 0,function*(){var r;const n=e.manifest.version,i=e.version,o=e.config,s=e.manifest.name;if(n===i)return null;if(!i)return null;if(!Qa.valid(i)||!Qa.valid(n))return console.error("Bad widget version number, "+e.manifest.name+","+i+","+n),null;let a=null;e.outputDataSources&&(a=an({}),e.outputDataSources.forEach(e=>{a=a.set(e,Ya().getState().appConfig.dataSources[e])}));const l={widgetJson:Ya().getState().appConfig.widgets[e.id],outputDataSourceJsons:a};if(!Qa.lt(i,n))return console.error("It seems this widget is configured with a higher version. Please upgrade to the latest version to view. "+s+","+i+","+n),null;try{let s;if(t.widgetUpgrade)s=yield t.widgetUpgrade(l,i,n,e.id);else{const a=yield t.upgrade(o,i,n,e.id);s={widgetJson:Ya().getState().appConfig.widgets[e.id].set("config",a),outputDataSourceJsons:null===(r=e.outputDataSources)||void 0===r?void 0:r.reduce((e,t)=>e.set(t,Ya().getState().appConfig.dataSources[t]),an({}))}}return s}catch(e){return console.error("Upgrade widget ["+s+"] error,"+e),null}})}loadWidgetClassByUri(e){return rp(this,void 0,void 0,function*(){var t,r;if(!this.checkWidgetUriInConfig(e))return Promise.resolve(null);if(null===(t=this.widgets[e])||void 0===t?void 0:t.clazzPromise)return this.widgets[e].clazzPromise;if(!(null===(r=this.widgets[e])||void 0===r?void 0:r.manifest))return console.error(e,"Should load manifest first."),Promise.reject(null);const n=this.widgets[e].manifest;return n.properties.hasMainClass?(this.widgets[e].clazzPromise=this.loadRawClass(e).then(t=>this.upgradeWidgetByUri(e,t.versionManager)).then(()=>rp(this,void 0,void 0,function*(){return this.injectWidgetProps(e)})).then(e=>e?this.appWidgetClassWrapperExtension(e,n):e).then(t=>t?(this.widgets[e].clazz=t,Ya().dispatch(function(e){return{type:ja.WidgetClassLoaded,widgetUri:e}}(e)),t):(delete this.widgets[e],t)),this.widgets[e].clazzPromise):Promise.resolve(null)})}loadRawClass(e){return rp(this,void 0,void 0,function*(){return this.loadWidgetDependency(e).then(()=>rp(this,void 0,void 0,function*(){return Cl(`${e}dist/runtime/widget`)})).then(t=>{if(cl(e)&&t.__set_webpack_public_path__){const r=e.indexOf("/widgets/");if(r<0)console.warn(`The widget, located at ${e}, is not present within the "widgets" folder. If the widget utilizes the "import()" function to dynamically load modules, it is necessary to deploy both the widget itself and the "chunks" folder within the "widgets" directory.`);else{const n=e.substring(0,r+1);t.__set_webpack_public_path__(n)}}const r=t.default?t.default:t;return this.widgets[e].rawClazz=r,r})})}loadWidgetTranslation(e,t){return rp(this,void 0,void 0,function*(){var r,n,i;const o=null===(r=this.widgets[e])||void 0===r?void 0:r.manifest;t||(t=Ya().getState().appContext.locale);const s=sp(t,o.translatedLocales);let a={};if(s)try{(null===(i=null===(n=this.widgets[e])||void 0===n?void 0:n.i18nMessagesPromiseByLocale)||void 0===i?void 0:i[s])?a=yield this.widgets[e].i18nMessagesPromiseByLocale[s]:(this.widgets[e].i18nMessagesPromiseByLocale||(this.widgets[e].i18nMessagesPromiseByLocale={}),this.widgets[e].i18nMessagesPromiseByLocale[s]=cp(`${e}dist/runtime/translations`,s),a=yield cp(`${e}dist/runtime/translations`,s))}catch(e){return console.error("Load widget translation error",e),Promise.resolve({})}o.i18nMessages=a;const l=Ya().getState().appI18nMessages;return this.widgets[e].i18nMessages=Object.assign({},o.i18nMessages,l),this.widgets[e].i18nMessages})}resetWidgetI18nMessages(e){this.widgets[e].manifest.i18nMessages={},this.widgets[e].i18nMessages={}}openWidget(e){Ya().dispatch(Va(e))}closeWidget(e){Ya().dispatch(function(e){return{type:ja.CloseWidget,widgetId:e}}(e))}appWidgetClassWrapperExtension(e,t){const r=En.getInstance().getExtensions(vn.WidgetClassWrapper)[0];return r?r.wrap(e,t):e}handleNewWidgetJson(e){return rp(this,void 0,void 0,function*(){return e.context=Lo(e.uri),e.itemId&&(e.uri=yield this.getWidgetUriByItemId(e.itemId)),this.loadWidgetManifest(e.uri,!e.itemId).then(t=>rp(this,void 0,void 0,function*(){return e.manifest=t,this.processWidgetManifest(e)})).then(t=>rp(this,void 0,void 0,function*(){var r;e.manifest=t,e.version=t.version,(null===(r=t.properties)||void 0===r?void 0:r.defaultOffPanel)&&(e.offPanel=!0);return Ao(Ya().getState().appStateInBuilder?Ya().getState().appStateInBuilder.appConfig:Ya().getState().appConfig,e),this.loadWidgetDefaultConfig(e.uri)})).then(t=>(e.config=t,e))})}getWidgetUriByItemId(e){return rp(this,void 0,void 0,function*(){if(Zn(Ya().getState().portalUrl))return Promise.reject("Not support yet.");const t=yield no(e,{portal:Yn(Ya().getState().portalUrl),authentication:pa.getInstance().getSessionByUrl(Ya().getState().portalUrl)}).catch(e=>pa.getInstance().handleAuthError(e,!1));if("Experience Builder Widget"!==t.type)return Promise.reject("Item type is not correct.");if(!t.url)return Promise.reject("Item does not have url.");let r;return r=/manifest\.json$/.test(t.url)?t.url.substring(0,t.url.length-13):/\/$/.test(t.url)?t.url:t.url+"/",r=r.replace(/^http:\/\//,"https://"),r})}loadWidgetManifest(e,t){return rp(this,void 0,void 0,function*(){var r;if(!e)return Promise.reject("Widget uri or itemId is required.");if(t&&cl(e))return Promise.reject("Remote URL is not allowed.");if(this.widgets[e]||(this.widgets[e]={}),this.widgets[e].manifestPromise)return this.widgets[e].manifestPromise;let n;if(null===(r=window.widgetsManifest)||void 0===r?void 0:r[e])n=Promise.resolve(window.widgetsManifest[e]);else{const t=`${Lo(e).folderUrl}manifest.json`;n=window.fetch(t).then(e=>rp(this,void 0,void 0,function*(){return 404===e.status?Promise.reject("404, widget not found."):e.json()}))}return this.widgets[e].manifestPromise=n.then(e=>rp(this,void 0,void 0,function*(){if(e.error&&e.error.code)return Promise.reject(e.error);const t=e;return!t.widgetType&&t.properties&&t.properties.type&&(t.widgetType=t.properties.type,delete t.properties.type),!t.layouts&&t.properties&&t.properties.layouts&&(t.layouts=t.properties.layouts,delete t.properties.layouts),!t.translatedLocales&&t.supportedLocales&&(t.translatedLocales=t.supportedLocales),Promise.resolve(t)})),this.widgets[e].manifestPromise})}processWidgetManifest(e){return rp(this,void 0,void 0,function*(){const t=function(e){return void 0===e.properties&&(e.properties={}),["hasVersionManager","supportInlineEditing","supportRepeat","hasBuilderSupportModule","hasEmbeddedLayout","lockChildren","flipIcon","coverLayoutBackground","canCrossLayoutBoundary","needActiveState","canConsumeDataAction","watchViewportVisibility","isWidgetController"].forEach(function(t){void 0===e.properties[t]&&(e.properties[t]=!1)}),["hasMainClass","hasConfig","hasSettingPage","hasConfigInSettingPage","passDataSourceToChildren","deactivateOtherWidgets","supportAutoSize"].forEach(function(t){void 0===e.properties[t]&&(e.properties[t]=!0)}),e}(e.manifest);e.manifest=t,this.widgets[e.uri]?this.widgets[e.uri].manifest=t:this.widgets[e.uri]={manifest:t,manifestPromise:Promise.resolve(t)};const r=Ya().getState().appContext.locale;return this.loadWidgetTranslation(e.uri,r).then(t=>this.widgets[e.uri].manifest)})}registerManifestProps(e,t){return rp(this,void 0,void 0,function*(){const r=e.manifest,n=[];return r.extensions&&r.extensions.length>0&&n.push(En.getInstance().registerWidgetExtensions(e,!t)),r.messageActions&&r.messageActions.length>0&&Qh.getInstance().registerWidgetActions(e,t),r.dataActions&&r.dataActions.length>0&&tp.getInstance().registerWidgetActions(e,t),Promise.all(n).then(()=>null)})}unRegisterManifestProps(e){En.getInstance().destroyWidgetExtensions(e),Qh.getInstance().destroyWidgetActions(e),tp.getInstance().destroyWidgetActions(e)}loadWidgetDefaultConfig(e){return rp(this,void 0,void 0,function*(){var t;if(!this.widgets[e].manifest.properties.hasConfig)return Promise.resolve(null);if(null===(t=this.widgets[e])||void 0===t?void 0:t.defaultConfigPromise)return this.widgets[e].defaultConfigPromise;const r=Lo(e).folderUrl;return this.widgets[e].defaultConfigPromise=window.fetch(`${r}config.json`).then(e=>rp(this,void 0,void 0,function*(){return 404===e.status?Promise.reject("404, widget not found."):e.json()})).then(e=>e),this.widgets[e].defaultConfigPromise})}loadWidgetDependency(e){return rp(this,void 0,void 0,function*(){const t=this.widgets[e].manifest;if(!t.dependency)return Promise.resolve();return Zi("string"==typeof t.dependency?[t.dependency]:t.dependency)})}injectWidgetProps(e){return rp(this,void 0,void 0,function*(){const t=this.widgets[e].manifest,r=t.name,n=(Ol("jimu-theme")?Ol("jimu-theme"):(console.error("Please init jimu-theme."),null)).withTheme,i=this.widgets[e].rawClazz,o=function(e,t){var r,n=t||{},i=n.intlPropName,o=void 0===i?"intl":i,s=n.forwardRef,a=void 0!==s&&s,l=n.enforceContext,c=void 0===l||l,u=function(t){return Co.createElement(zd,null,function(r){var n;c&&Uu(r);var i=((n={})[o]=r,n);return Co.createElement(e,hi({},t,i,{ref:a?t.forwardedRef:null}))})};return u.displayName="injectIntl(".concat((r=e).displayName||r.name||"Component",")"),u.WrappedComponent=e,a?Hd()(Co.forwardRef(function(e,t){return Co.createElement(u,hi({},e,{forwardedRef:t}))}),e):Hd()(u,e)}(i),s=function(e){function t(t){return(0,zu.jsx)(vh.Consumer,{children:r=>(0,zu.jsx)(e,Object.assign({},t,{repeatedDataSource:r}))})}return t.displayName="RepeatedDataSourceContextConsumerWrapper",t}(n(o,window.jimuConfig.isBuilder||window.jimuConfig.isInBuilder));if(!this.checkWidgetUriInConfig(e))return Promise.resolve(null);const a=(t,r)=>{var n,o;const s=r.widgetId;if(!t.appConfig.widgets[s])return{};const a=t.widgetsRuntimeInfo[s],l=Object.assign({portalUrl:t.portalUrl,portalSelf:t.portalSelf,user:t.user,locale:t.appContext.locale,appI18nMessages:t.appI18nMessages,i18nMessages:null===(n=this.widgets[e])||void 0===n?void 0:n.i18nMessages},r);t.widgetsState[s]&&(l.stateProps=t.widgetsState[s]),t.widgetsMutableStateVersion[s]&&(l.mutableStatePropsVersion=t.widgetsMutableStateVersion[s],l.mutableStateProps=gh.getInstance().getStateValue([s])),(null===(o=this.widgets[e])||void 0===o?void 0:o.widgetBuilderSupportModules)&&(l.builderSupportModules=this.widgets[e].widgetBuilderSupportModules),t.widgetsPreloadProps&&t.widgetsPreloadProps[s]&&Object.assign(l,t.widgetsPreloadProps[s]);const c=Object.assign(l,t.appConfig.widgets[s],a);return Object.assign(c,i.mapExtraStateProps?i.mapExtraStateProps(t,c):{})},l=e=>rp(this,void 0,void 0,function*(){const t=Ya().getState().appConfig.widgets[e];if(!t)return Promise.resolve(null);if(t.version===t.manifest.version)return Promise.resolve(null);if(!i.versionManager)return void Ya().dispatch(Ba(e));const r=yield this.upgradeWidget(t,i.versionManager);Ya().dispatch(Ba(e,r))});class c extends Co.PureComponent{constructor(e){super(e),this.state={fullConfig:null}}componentDidMount(){l(this.props.widgetId),i.getFullConfig&&this.setState({fullConfig:i.getFullConfig(this.props.config)})}componentDidUpdate(e){l(this.props.widgetId),i.getFullConfig&&e.config!==this.props.config&&this.setState({fullConfig:i.getFullConfig(this.props.config)})}getFullConfig(e){return i.getFullConfig?i.getFullConfig(e):e}render(){const{id:e,manifest:t,version:r,i18nMessages:n}=this.props;if(!e)return null;if(i.versionManager&&r&&t.version!==r)return null;const o=Object.assign({},this.props);return o.savedConfig=this.props.config,this.state.fullConfig?o.config=this.state.fullConfig:o.config=this.getFullConfig(this.props.config),(0,zu.jsx)(Yd,{locale:this.props.locale,defaultLocale:this.props.locale,messages:n,children:(0,zu.jsx)(s,Object.assign({},o))})}}return c.displayName=`WidgetWrapper(${r})`,this.loadWidgetBuilderSupportModules(e,t).then(()=>rp(this,void 0,void 0,function*(){return this.checkWidgetUriInConfig(e)?Promise.resolve(Gd(a)(c)):Promise.resolve(null)}))})}loadWidgetBuilderSupportModules(e,t){return rp(this,void 0,void 0,function*(){var r;const n=[];if(window.jimuConfig.isInBuilder){if(null===(r=this.widgets[e])||void 0===r?void 0:r.widgetBuilderSupportModulesPromise)return this.widgets[e].widgetBuilderSupportModulesPromise;if(t.properties.hasEmbeddedLayout?n.push(Cl("jimu-layouts/layout-builder").then(e=>e.LayoutEntry)):n.push(Promise.resolve(null)),t.properties.hasBuilderSupportModule){const t=`${e}dist/runtime/builder-support`;n.push(Cl(t).then(e=>e.default))}else n.push(Promise.resolve(null));return this.widgets[e].widgetBuilderSupportModulesPromise=Promise.all(n).then(t=>(this.widgets[e].widgetBuilderSupportModules={jimuForBuilderLib:Ol("jimu-for-builder"),LayoutEntry:t[0],widgetModules:t[1]},this.widgets[e].widgetBuilderSupportModules)),this.widgets[e].widgetBuilderSupportModulesPromise}return Promise.resolve({jimuForBuilderLib:null})})}onStoreChange(e,t){e&&t&&Object.keys(e).forEach(e=>{t[e]||this.unRegisterManifestProps(e)}),e&&t&&Object.keys(t).forEach(r=>{e[r]?e[r].uri!==t[r].uri&&(this.unRegisterManifestProps(r),this.registerManifestProps(t[r])):this.registerManifestProps(t[r])})}onStoreSectionChange(e,t){e&&t&&Object.keys(e).forEach(e=>{t[e]||Qh.getInstance().destroySectionActions(e)}),e&&t&&Object.keys(t).forEach(t=>{e[t]||Qh.getInstance().registerSectionActions(t)})}onAppI18nMessagesChange(e,t){e!==t&&Object.keys(this.widgets).forEach(e=>{const r=this.widgets[e];r&&r.i18nMessages&&(r.i18nMessages=Object.assign({},r.i18nMessages,t))})}}const ip=np;var op=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function sp(e,t){const r=ap(e=e.toLowerCase(),t);if(r){if(r!==(t&&t[0]))return r}}function ap(e,t=[]){if(e){if(window.jimuConfig.downloadLocales){const e=new Set(window.jimuConfig.downloadLocales);t=t.filter(t=>e.has(t))}return pp(e,t)}}function lp(e,t){return e.split("-")[0]===t.split("-")[0]}function cp(e,t){return op(this,void 0,void 0,function*(){return yield Cl(`${e}/${t}`)})}function up(e){let t=!1;const r=["ar","he"];for(let n=0;n<r.length;n++)lp(r[n],e)&&(t=!0);return t}let dp={};function hp(e="_jimu",t="runtime"){var r,n,i,o,s,a,l,c;const u=`${e}-${t}`;if(dp[u])return dp[u];const d={dateTime:{},number:{},message:{},relativeTime:{},pluralRules:{},list:{},displayNames:{}},h=Ya().getState();if(!h)return null;let p;if("_jimu"===e)p=Wu({locale:h.appContext.locale,defaultLocale:h.appContext.locale,messages:h.appI18nMessages},d);else if("runtime"===t){const t=window.jimuConfig.isBuilder?null===(r=h.appStateInBuilder)||void 0===r?void 0:r.appConfig:h.appConfig,o=ip.getInstance().getWidgetI18nMessagesByUri(null===(i=null===(n=null==t?void 0:t.widgets)||void 0===n?void 0:n[e])||void 0===i?void 0:i.uri);p=Wu({locale:h.appContext.locale,defaultLocale:h.appContext.locale,messages:o},d)}else{let t;if(window.jimuConfig.isBuilder){const r=null===(l=null===(a=null===(s=null===(o=h.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===s?void 0:s.widgets)||void 0===a?void 0:a[e])||void 0===l?void 0:l.manifest.name;t=null===(c=h.builder.widgetSettingI18nMessages)||void 0===c?void 0:c[r]}else t={};const r=Object.assign({},t,h.appI18nMessages);p=Wu({locale:h.appContext.locale,defaultLocale:h.appContext.locale,messages:r},d)}return dp[u]=p,p}function pp(e,t=[]){let r;if(e=e.toLowerCase(),t.includes(e))r=e;else{const n=e.split("-")[0];t.includes(n)?r=n:"nb"!==e&&"nn"!==e&&"nb"!==n&&"nn"!==n||!t.includes("no")||(r="no")}return r}const fp={};function mp(){const e=Ya().getState().appConfig.widgets;return Object.keys(e).reduce((t,r)=>{const n=e[r];return t.includes(n.uri)||t.push(n.uri),t},[])}function gp(e,t){window.locale=e,function(e){if("undefined"==typeof document)return;const t=document.getElementsByTagName("html")[0];t.setAttribute("lang",e),up(e)?(t.setAttribute("dir","rtl"),t.className+=" esriRtl jimu-rtl",t.className+=" "+e+" "+(-1!==e.indexOf("-")?e.split("-")[0]:"")):(t.setAttribute("dir","ltr"),t.className+=" esriLtr jimu-ltr",t.className+=" "+e+" "+(-1!==e.indexOf("-")?e.split("-")[0]:""))}(e),Ya().dispatch(function(e,t,r){return{type:ja.UserLocaleChanged,locale:e,translatedLocale:t,isRTL:r}}(e,t,up(e)))}const vp="randomUUID"in crypto,yp=new Map,Sp=new Map;const Ip=`{${function(){if(vp)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}()}}`;function wp(e){const t={};for(const r in e){if("declaredClass"===r)continue;const n=e[r];null!=n&&"function"!=typeof n&&(Array.isArray(n)?t[r]=n.map(e=>wp(e)):t[r]=n)}return t}function Ep(e){if(!e)throw new Error((0,N.formatMessage)(hp(),"vmsVersionGuidMissing"));return e.startsWith("{")?e.slice(1,-1):e}function bp(e,t,r){return`${e}/versions/${t}/${r}`}var Rp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},Tp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};class Np{constructor(e={}){var t,r;this.versionName=e.versionName,this.description=null!==(t=e.description)&&void 0!==t?t:null,this.accessPermission=null!==(r=e.accessPermission)&&void 0!==r?r:"private"}static from(e){return e instanceof Np?e:new Np(e)}toJSON(){return{versionName:this.versionName,description:this.description,accessPermission:this.accessPermission}}}class Op{constructor(e={}){var t,r;this.ownerFilter=null!==(t=e.ownerFilter)&&void 0!==t?t:null,this.includeHidden=null!==(r=e.includeHidden)&&void 0!==r&&r}static from(e){return e instanceof Op?e:new Op(e)}toJSON(){return{ownerFilter:this.ownerFilter,includeHidden:this.includeHidden}}}var Cp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},Lp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};var Ap=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},Dp=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};class _p{constructor(e={}){this.versionName=e.versionName,this.sessionId=e.sessionId}static from(e){return e instanceof _p?e:new _p(e)}toJSON(){return{versionName:this.versionName,sessionId:this.sessionId}}}var Pp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};new Map;class xp{constructor(e={}){var t,r,n,i;this.hasConflicts=null!==(t=e.hasConflicts)&&void 0!==t&&t,this.moment=null!==(r=e.moment)&&void 0!==r?r:null,this.didPost=null!==(n=e.didPost)&&void 0!==n&&n,this.success=null!==(i=e.success)&&void 0!==i&&i}static from(e){return e instanceof xp?e:new xp(e)}static fromJSON(e){return new xp({hasConflicts:e.hasConflicts,moment:e.moment?new Date(e.moment):null,didPost:e.didPost,success:e.success})}}const Mp=xp;class kp{constructor(e={}){var t,r,n;this.sessionId=e.sessionId,this.abortIfConflicts=null===(t=e.abortIfConflicts)||void 0===t||t,this.conflictDetection=null!==(r=e.conflictDetection)&&void 0!==r?r:"byObject",this.withPost=null!==(n=e.withPost)&&void 0!==n&&n}static from(e){return e instanceof kp?e:new kp(e)}toJSON(){return{sessionId:this.sessionId,abortIfConflicts:this.abortIfConflicts,conflictDetection:this.conflictDetection,withPost:this.withPost}}}const jp=kp;var Fp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var Up=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var Bp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var Vp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var Gp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var $p=m(14321),Hp=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var Wp,zp,qp,Jp,Kp,Yp,Xp,Qp,Zp;function ef(e,t,r){return Hp(this,void 0,void 0,function*(){const n={jimuName:e,type:i.JimuFieldType.String,esriType:Wp.String,name:e,alias:e,format:null};return function(e,t,r){return Hp(this,void 0,void 0,function*(){const n={searchText:e,searchFields:r.map(e=>e.name),dataSource:t,maxSuggestions:1e3};return i.dataSourceUtils.querySuggestions(n).then(e=>{const t={suggestionItem:null==e?void 0:e.map(e=>Object.assign(Object.assign({},e),{isFromSuggestion:!0})),layer:null,icon:null};return Promise.resolve(t)}).catch(e=>Promise.resolve({suggestionItem:[],layer:null,icon:null}))})}(t,r,[n])})}!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(Wp||(Wp={})),function(e){e.Layer="Layer",e.Map="MAP"}(zp||(zp={})),function(e){e.Network="NETWORK",e.Event="EVENT",e.LineEvent="LINEEVENT",e.PointEvent="POINTEVENT",e.Intersection="INTERSECTION",e.Centerline="CENTERLINE",e.CalibrationPoint="CALIBRATIONPOINT",e.UtilityNetwork="UTILITYNETWORK",e.Addressing="ADDRESSING",e.NonLrs="NONLRS",e.NonLrsPoint="NONLRSPOINTS",e.NonLrsLine="NONLRSLINES"}(qp||(qp={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(Jp||(Jp={})),function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(Kp||(Kp={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(Yp||(Yp={})),function(e){e.Map="MAP",e.Lrs="LRS"}(Xp||(Xp={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(Qp||(Qp={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(Zp||(Zp={}));var tf=m(36614),rf=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function nf(e,t,r){const n=Object.assign({},c,$p.defaultMessages);return e.formatMessage({id:t,defaultMessage:n[t]},r)}const of=(e,t,r)=>{if(isNaN(e)||!t||!r||t===r)return e;const n={esriMeters:1,esriDecimalDegrees:899928005759e-17,esriNauticalMiles:.00053995680345572,esriIntNauticalMiles:.00053959318990227,esriMiles:.00062136994949496,esriIntMiles:.00062137119223733,esriKilometers:.001,esriYards:1.093611111115486,esriIntYards:1.093613298337708,esriFeet:3.280833333346457,esriIntFeet:3.280839895013123,esriDecimeters:10,esriInches:39.370078740157,esriIntInches:39.37007874015748,esriCentimeters:100,esriMillimeters:1e3,esriPoints:2834.645669291964};return t in n&&r in n?n[r]/n[t]*e:e};function sf(e){switch(e){case"esriFeet":case"esriIntFeet":return"esriSRUnit_Foot";case"esriMiles":case"esriIntMiles":return"esriSRUnit_StatuteMile";case"esriNauticalMiles":return"esriSRUnit_USNauticalMile";case"esriIntNauticalMiles":return"esriSRUnit_NauticalMile";case"esriMeters":return"esriSRUnit_Meter";case"esriKilometers":return"esriSRUnit_Kilometer";default:return""}}function af(e,t){switch(e){case"esriInches":return nf(t,"inches");case"esriPoints":return nf(t,"points");case"esriFeet":return nf(t,"feet");case"esriYards":return nf(t,"yards");case"esriMiles":return nf(t,"miles");case"esriNauticalMiles":return nf(t,"nauticalMiles");case"esriMillimeters":return nf(t,"millimeters");case"esriCentimeters":return nf(t,"centimeters");case"esriMeters":return nf(t,"meters");case"esriKilometers":return nf(t,"kilometers");case"esriDecimalDegrees":return nf(t,"decimalDegrees");case"esriDecimeters":return nf(t,"decimeters");case"esriIntFeet":return nf(t,"intFeet");case"esriIntMiles":return nf(t,"intMiles");default:return nf(t,"esriUnknownUnits")}}function lf(e,t){switch(e){case nf(t,"inches"):return"esriInches";case nf(t,"points"):return"esriPoints";case nf(t,"feet"):return"esriFeet";case nf(t,"yards"):return"esriYards";case nf(t,"miles"):return"esriMiles";case nf(t,"nauticalMiles"):return"esriNauticalMiles";case nf(t,"millimeters"):return"esriMillimeters";case nf(t,"centimeters"):return"esriCentimeters";case nf(t,"meters"):return"esriMeters";case nf(t,"kilometers"):return"esriKilometers";case nf(t,"decimalDegrees"):return"esriDecimalDegrees";case nf(t,"decimeters"):return"esriDecimeters";case nf(t,"intFeet"):return"esriIntFeet";case nf(t,"intMiles"):return"esriIntMiles";default:return"unknownUnits"}}function cf(e,t=!0){return null!=e&&("string"==typeof e?""!==e.trim()||!t:"number"==typeof e?!isNaN(e):Array.isArray(e)?!t||0!==e.length:Boolean(e))}const uf=e=>{var t;if(cf(e)){const r=e;if((null===(t=r.paths)||void 0===t?void 0:t.length)>0){const e=r.getPoint(0,0),t=r.paths[r.paths.length-1].length-1;return[e,r.getPoint(r.paths.length-1,t)]}}return[null,null]},df=e=>{var t;if(cf(e)){const r=e;if((null===(t=r.paths)||void 0===t?void 0:t.length)>0){const e=r.getPoint(0,0),t=r.paths[r.paths.length-1].length-1,n=r.getPoint(r.paths.length-1,t);return[e.m,n.m]}}return[null,null]},hf=e=>{const t={routeIdFieldName:"",routeNameFieldName:"",fromDateFieldName:"",toDateFieldName:"",lineIdFieldName:"",lineNameFieldName:"",lineOrderFieldName:""};return cf(e)&&(t.routeIdFieldName=e.routeIdFieldSchema.name,t.routeNameFieldName=e.useRouteName?e.routeNameFieldSchema.name:"",t.fromDateFieldName=e.fromDateFieldSchema.name,t.toDateFieldName=e.toDateFieldSchema.name,t.lineIdFieldName=cf(e.lineIdFieldSchema)?e.lineIdFieldSchema.name:"",t.lineNameFieldName=cf(e.lineNameFieldSchema)?e.lineNameFieldSchema.name:"",t.lineOrderFieldName=cf(e.lineOrderFieldSchema)?e.lineOrderFieldSchema.name:""),t},pf=(e,t,r)=>{if(!cf(t)||!cf(r)||!e.length||!t.useRouteName&&!t.supportsLines)return Promise.reject(new Error(null));const n=r.layer,i=n.createQuery();i.where=t.routeIdFieldSchema.name+" IN ('"+e.join("','")+"')";const o=hf(t);return i.returnM=!0,i.outFields=[o.routeIdFieldName],t.useRouteName&&i.outFields.push(o.routeNameFieldName),t.supportsLines&&i.outFields.push(o.lineIdFieldName),n.queryFeatures(i).then(e=>e).catch(e=>Promise.reject(new Error(null)))},ff=(e,t,r,n)=>{if(!(cf(r)&&cf(n)&&e.length&&t.length))return Promise.reject(new Error(null));const i=n.layer,o=i.createQuery();let s;s=(r.useRouteName,e.map(e=>`${r.routeNameFieldSchema.name} = '${e}'`));const a=s.join(" OR "),l=`${r.lineIdFieldSchema.name} = '${t}' AND (${a})`,c=hf(r);return o.returnM=!0,o.outFields=[c.routeIdFieldName,c.fromDateFieldName,c.toDateFieldName],r.useRouteName&&o.outFields.push(c.routeNameFieldName),o.where=l,i.queryFeatures(o).then(e=>e).catch(e=>Promise.reject(new Error(null)))},mf=(e,t,r)=>{if(!cf(t)||!cf(r))return Promise.reject(new Error(null));const n=r.layer,i=n.createQuery(),o=`${t.lineIdFieldSchema.name} = '${e}'`,s=hf(t);return i.returnM=!0,i.outFields=[s.routeIdFieldName,s.fromDateFieldName,s.toDateFieldName,s.lineOrderFieldName],t.useRouteName&&i.outFields.push(s.routeNameFieldName),i.where=o,n.queryFeatures(i).then(e=>e).catch(e=>Promise.reject(new Error(null)))},gf=(e,t,r,n)=>{if(!cf(t)||!cf(r))return Promise.reject(new Error(null));const i=r.layer,o=i.createQuery();let s=`${t.lineIdFieldSchema.name} = '${e}'`;const a=hf(t);if(o.returnGeometry=!0,o.returnM=!0,o.outFields=[a.routeIdFieldName,a.fromDateFieldName,a.toDateFieldName,a.lineOrderFieldName],t.useRouteName&&o.outFields.push(a.routeNameFieldName),cf(n)){const e=`TIMESTAMP '${n.toISOString().slice(0,10)}'`;s=`${s} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}return o.where=s,i.queryFeatures(o).then(e=>e).catch(e=>Promise.reject(new Error(null)))},vf=e=>{if(cf(e)){const t=e.getPoint(0,0),r=e.getPoint(e.paths.length-1,e.paths[e.paths.length-1].length-1);return!tf.execute(t,r)}return!1},yf=(e,t)=>{let r=!1;if(e.length<2||t>=e.length)return r;const n=e.at(t);if(!cf(n)||vf(n))return r;if(0===t){const i=e.at(t+1);if(cf(i)){const e=n.getPoint(0,0),t=n.getPoint(n.paths.length-1,n.paths[n.paths.length-1].length-1),o=i.getPoint(0,0),s=i.getPoint(i.paths.length-1,i.paths[i.paths.length-1].length-1),a=tf.execute(e,s),l=tf.execute(t,o);if(!a&&!l)return r;const c=tf.execute(t,o),u=tf.execute(e,o),d=tf.execute(e,s);r=c&&(!u||!d)}}else{const i=e.at(t-1);if(cf(i)){const e=n.getPoint(0,0),t=n.getPoint(n.paths.length-1,n.paths[n.paths.length-1].length-1),o=i.getPoint(0,0),s=i.getPoint(i.paths.length-1,i.paths[i.paths.length-1].length-1),a=tf.execute(t,o),l=tf.execute(e,s);if(!a&&!l)return r;const c=tf.execute(e,s),u=tf.execute(t,o),d=tf.execute(t,s);r=c&&(!u||!d)}}return r},Sf=(e,t,r,...n)=>rf(void 0,[e,t,r,...n],void 0,function*(e,t,r,n=!1,i=!0,o="",s=null,a=!1,l=!1){const c=r,u=(null==c?void 0:c.layer)||(yield c.createJSAPILayerByDataSource());let d;if(d=!t.useRouteName||a?l?`${t.routeIdFieldSchema.name} LIKE '${e}'`:`${t.routeIdFieldSchema.name} = '${e}'`:l?`${t.routeNameFieldSchema.name} LIKE '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,cf(s)){const e=`TIMESTAMP '${s.toISOString().slice(0,10)}'`;d=`${d} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}const h=d,p=u.createQuery();p.where=h;const f=hf(t);return p.returnGeometry=!0,p.returnM=!0,p.outFields=[f.routeIdFieldName,f.fromDateFieldName,f.toDateFieldName],t.useRouteName&&p.outFields.push(f.routeNameFieldName),t.supportsLines&&(p.outFields.push(f.lineIdFieldName),p.outFields.push(f.lineNameFieldName),p.outFields.push(f.lineOrderFieldName)),u.queryFeatures(p).then(e=>e).catch(e=>Promise.reject(new Error(null)))}),If=(e,t,r,...n)=>rf(void 0,[e,t,r,...n],void 0,function*(e,t,r,n=!1,i=!0,o="",s=null,a=!1,l=!1){if(!cf(t)||!cf(r)||!e.length)return Promise.reject(new Error(null));const c=r,u=(null==c?void 0:c.layer)||(yield c.createJSAPILayerByDataSource());let d;if(d=!t.useRouteName||a?l?`${t.routeIdFieldSchema.name} LIKE '${e}'`:`${t.routeIdFieldSchema.name} = '${e}'`:l?`${t.routeNameFieldSchema.name} LIKE '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,cf(s)){const e=`TIMESTAMP '${s.toISOString().slice(0,10)}'`;d=`${d} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}const h=yield Sf(e,t,r,n,i,o,s,a,l);if(!h||0===h.features.length)return Promise.reject(new Error("invalidRoute"));let p=d;n&&!i&&cf(o)&&(p=`${t.lineIdFieldSchema.name} = '${o}' AND (${d})`);const f=u.createQuery();f.where=p;const m=hf(t);return f.returnGeometry=!0,f.returnM=!0,f.outFields=[m.routeIdFieldName,m.fromDateFieldName,m.toDateFieldName],t.useRouteName&&f.outFields.push(m.routeNameFieldName),t.supportsLines&&(f.outFields.push(m.lineIdFieldName),f.outFields.push(m.lineNameFieldName),f.outFields.push(m.lineOrderFieldName)),u.queryFeatures(f).then(t=>0===t.features.length&&e.length>0?Promise.reject(new Error("routeNotOnSameLine")):t).catch(e=>Promise.reject(new Error(e)))}),wf=(e,t,r)=>{const n=[],i=ef(e,t,r);return n.push(i),Promise.all(n)},Ef=e=>{const t=new Date(e);return cf(t)?Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0):null};function bf(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),r=e.split("+");let n=100*parseInt(r[0],10);return isNaN(n)?n=NaN:2===r.length&&(t?n-=parseFloat(r[1]):n+=parseFloat(r[1])),n}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),r=e.split("+");let n=1e3*parseInt(r[0],10);return isNaN(n)?n=NaN:2===r.length&&(t?n-=parseFloat(r[1]):n+=parseFloat(r[1])),n}return NaN}function Rf(){return{routeId:"",toRouteId:"",lineId:"",toLineId:"",lineName:"",toLineName:"",routeLineOrder:NaN,toRouteLineOrder:NaN,routeName:"",toRouteName:"",fromMeasure:NaN,toMeasure:NaN,toRouteFromMeasure:NaN,toRouteToMeasure:NaN,fromDate:new Date(Date.now()),toRouteFromDate:new Date(Date.now()),toDate:null,toRouteToDate:null,selectedMeasure:NaN,selectedToMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null,selectedPoint:null,selectedToPoint:null,selectedPolyline:null,selectedToPolyline:null,validRoute:!1,validToRoute:!1}}function Tf(){return{eventUrl:"",fromDateFieldName:"",toDateFieldName:"",derivedFromMeasureFieldName:"",derivedRouteIdFieldName:"",derivedRouteNameFieldName:"",derivedToMeasureFieldName:"",fromReferentLocationFieldName:"",fromReferentMethodFieldName:"",fromReferentOffsetFieldName:"",toReferentLocationFieldName:"",toReferentMethodFieldName:"",toReferentOffsetFieldName:"",locErrorFieldName:"",eventIdFieldName:"",routeIdFieldName:"",routeNameFieldName:"",fromMeasureFieldName:"",toRouteIdFieldName:"",toRouteNameFieldName:"",toMeasureFieldName:"",lrsFields:null,attributeFields:null,parentNetworkId:NaN,useRouteName:!1,isPointEvent:!1,canSpanRoutes:!1,mergeCoincident:!1,retireOverlapping:!1,addToDominantRoute:!1,datasetName:""}}function Nf(){return{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1}}function Of(e){return i.SessionManager.getInstance().getSessionByUrl(e)}function Cf(e){return e.getGDBVersion()||"sde.DEFAULT"}function Lf(e){return"sde.default"===e.toLocaleLowerCase()||""===e}function Af(e,t,r){return!isNaN(e)&&!isNaN(t)&&!isNaN(r)&&Math.abs(e-t)<=r}function Df(e,t,r){return _f(t,e[0],r)&&Pf(t,e[1],r)}function _f(e,t,r){return function(e,t,r,n){return r=Math.abs(r),n?e>t+r:e>=t-r}(e,t,r,!1)}function Pf(e,t,r){return function(e,t,r,n){return r=Math.abs(r),n?e<t-r:e<=t+r}(e,t,r,!1)}const xf=(e,t)=>{cf(t)&&(e.add(t),setTimeout(()=>{e.removeAll(),setTimeout(()=>{e.add(t),setTimeout(()=>{e.removeAll(),setTimeout(()=>{e.add(t),setTimeout(()=>{e.removeAll()},800)},800)},800)},800)},800))};function Mf(e){const t=(new Date).getTimezoneOffset();return(t<0?1:-1)*(t<0?Math.abs(t)/60:t/60)*60*60*1e3+function(e){const t=kf(new Date(Date.now())),r=kf(e);return t&&!r?-36e5:!t&&r?36e5:0}(e)}function kf(e){const t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1),n=Math.max(t.getTimezoneOffset(),r.getTimezoneOffset());return e.getTimezoneOffset()<n}function jf(e,t){if(!cf(e)||!cf(new Date(e)))return null;const r=t.getTimezone();if("Etc/UTC"===r||!r.includes("/")&&"device"!==r){const t=Mf(new Date(e));return new Date(e+t)}return new Date(i.dataSourceUtils.getDateFieldValueWithoutTzOffset(e,t))}function Ff(e,t=!1){let r;if(r=window.jimuConfig.isBuilder?(0,i.getAppStore)().getState().appStateInBuilder.appConfig.attributes.timezone:(0,i.getAppStore)().getState().appConfig.attributes.timezone,(null==r?void 0:r.type)===i.TimezoneConfig.Specific){const n=i.dataSourceUtils.getTimeZoneOffsetByName(r.value),o=i.dataSourceUtils.getLocalTimeOffset();e=t?e-o+n:e+o-n}return e}function Uf(e,t){if(!cf(e)||!cf(new Date(e)))return null;const r=t.getTimezone();if("Etc/UTC"===r||!r.includes("/")&&"device"!==r){const t=Mf(new Date(e));return new Date(e-t)}return new Date(i.dataSourceUtils.getDateFieldValue(e,t))}function Bf(e){return cf(e)?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e}function Vf(e,t){return cf(e)?cf(t)?new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()):new Date(e.getFullYear(),e.getMonth(),e.getDate()):e}function Gf(e){let t=document.getElementById(e);for(;t&&!t.classList.contains("floating-panel");)if(t=t.parentElement,t&&t.classList.contains("floating-panel"))return!0;for(t=document.getElementById(e);t&&!t.classList.contains("panel-content");)if(t=t.parentElement,t&&t.classList.contains("panel-content"))return!0;return!1}const $f=[i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.ImageryLayer,i.JSAPILayerTypes.SubtypeSublayer];function Hf(e){if(!e||!e.type)return!1;const t=e.type,r=t!==i.JSAPILayerTypes.BuildingComponentSublayer||t===i.JSAPILayerTypes.BuildingComponentSublayer&&e.view,n=$f.includes(t);return r&&n}function Wf(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function zf(e){var t;return cf(e)&&e.layerType===qp.Event&&(null===(t=null==e?void 0:e.eventInfo)||void 0===t?void 0:t.isPointEvent)}function qf(e){var t;return cf(e)&&e.layerType===qp.Event&&!(null===(t=null==e?void 0:e.eventInfo)||void 0===t?void 0:t.isPointEvent)}function Jf(){return i.css`
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text);
  `}function Kf(){return i.css`
    --calcite-ui-icon-color: var(--sys-color-surface-paper-text);
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text);
  `}function Yf(e){return i.css`
      --calcite-color-foreground-1: ${e.sys.color.surface.paper};
      --calcite-color-brand: ${e.sys.color.primary.main};
      --calcite-color-status-warning: ${e.sys.color.error.main};
      --calcite-color-text-3: ${e.sys.color.primary.text};
      --calcite-color-transparent-hover: ${e.sys.color.primary.light};
      --calcite-color-transparent-pressed: ${e.sys.color.primary.dark};
      --calcite-color-status-success: ${e.sys.color.success.main};
    `}var Xf=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Qf(e){return Xf(this,void 0,void 0,function*(){return new Promise(function(t,r){const n={params:e.params,httpMethod:e.method};i.esri.restRequest.request(e.url,n).then(e=>{t(e)}).catch(e=>{t(e)})})})}function Zf(e,t,r,n,o,s){return Xf(this,void 0,void 0,function*(){var a,l,c,u,d,h;const p=n.routeId,f=[];if(!cf(n.selectedPoint)&&!cf(s))return f;const m=null!==(l=null===(a=t.getTimeInfo())||void 0===a?void 0:a.timeExtent)&&void 0!==l?l:0,g=r.eventInfo.eventUrl.replace("/exts/LRServer/eventLayers",""),v=`${g}/query`,y=yield i.SessionManager.getInstance().getSessionByUrl(g).getToken(g);let S,I,w,E,b=t.getGDBVersion();if(b||(b=""),cf(n.selectedPoint)){w=n.selectedPoint.toJSON?n.selectedPoint.toJSON():n.selectedPoint,E=n.distance>e?n.distance:"";let t="";if(r.eventInfo.canSpanRoutes)o.length>0&&(t=`${null===(c=r.eventInfo)||void 0===c?void 0:c.routeIdFieldName} IN ('${o.join("','")}')`);else{if(!(p&&p.length>0))return f;t=`${null===(u=r.eventInfo)||void 0===u?void 0:u.routeIdFieldName} = '${p}'`}if(cf(n.fromDate)){if(n.fromDate){const e=`TIMESTAMP '${n.fromDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} <= ${r.eventInfo.fromDateFieldName}`}if(n.toDate){const e=`TIMESTAMP '${n.toDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} > ${r.eventInfo.fromDateFieldName}`}}I=t}else S=[s];let R=null===(h=null===(d=t.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===h?void 0:h.units;R&&(R=sf(R));const T={f:"json",token:y,returnGeometry:!1,time:m,gdbVersion:b,outSR:102100,objectIds:S,where:I,outFields:"*",spatialRel:"esriSpatialRelIntersects",geometryType:"esriGeometryPoint",geometry:w,distance:E,units:R};return Qf({method:"GET",url:v,params:T}).then(e=>Xf(this,void 0,void 0,function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:(T.distance=.2,T.units="esriSRUnit_Meter",Qf({method:"GET",url:v,params:T}).then(e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:f}).catch(e=>f))})).catch(e=>f)})}function em(e,t){return Xf(this,void 0,void 0,function*(){const r=[],n=null==e?void 0:e.layer,i=n.createQuery();return t.length>0?(i.objectIds=t,n.queryFeatures(i).then(e=>e&&e.features.length>0?e.features:r).catch(e=>r)):r})}function tm(e,t,r){return Xf(this,void 0,void 0,function*(){var n,i;const o=[];let s="";r.routeId.length>0?s=`${t.routeIdFieldSchema.jimuName} = '${r.routeId}'`:r.routeName.length>0&&(s=`${t.routeNameFieldSchema.jimuName} = '${r.routeName}'`);const a={returnGeometry:!0,returnM:!0,returnZ:!0,where:s,orderByFields:[],time:null!==(i=null===(n=e.getTimeInfo())||void 0===n?void 0:n.timeExtent)&&void 0!==i?i:0};return e.query(a).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:o}).catch(e=>o)})}function rm(e,t,r){return Xf(this,void 0,void 0,function*(){var n,i;const o=[];let s="";if(!(r.length>0))return o;s=`${t.lineIdFieldSchema.jimuName} = '${r}'`;const a={where:s,time:null!==(i=null===(n=e.getTimeInfo())||void 0===n?void 0:n.timeExtent)&&void 0!==i?i:0,outFields:[t.routeIdFieldSchema.name],notAddFieldsToClient:!0};return e.query(a).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:o}).catch(e=>o)})}function nm(e,t,r,n,o){return Xf(this,void 0,void 0,function*(){if(0===o.length)return null;const s=t.networkUrl,a=`${s}/concurrencies`,l=yield i.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];if(o.forEach(e=>{e.routeId.length>0&&c.push({routeId:e.routeId,fromMeasure:e.fromMeasure,toMeasure:e.toMeasure})}),0===c.length)return null;let u=e.getGDBVersion();u||(u="");return Qf({method:"GET",url:a,params:{f:"json",token:l,locations:c,fromDate:r,toDate:n,gdbVersion:u}}).then(e=>e)})}function im(e,t,r,n,o){return Xf(this,void 0,void 0,function*(){const s=[];if(!cf(r)&&r.length)return s;const a=t.networkUrl,l=`${a}/geometryToMeasure`,c=yield i.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];r.forEach(e=>{u.push({routeId:o,geometry:{x:e.x,y:e.y}})});let d=e.getGDBVersion();d||(d="");return Qf({method:"GET",url:l,params:{f:"json",token:c,locations:u,tolerance:10,temporalViewDate:cf(n)&&0!==n.valueOf()?n:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then(e=>e&&e.locations?(e.locations.forEach(e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach(e=>{s.push(e.measure)})}),s):s)})}function om(e,t,r,n,o){return Xf(this,void 0,void 0,function*(){const s=[];if(!cf(r)&&r.length)return s;const a=t.networkUrl,l=`${a}/geometryToMeasure`,c=yield i.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];r.forEach(e=>{u.push({routeId:o,geometry:{x:e.x,y:e.y}})});let d=e.getGDBVersion();d||(d="");return Qf({method:"GET",url:l,params:{f:"json",token:c,locations:u,tolerance:10,temporalViewDate:cf(n)&&0!==n.valueOf()?n:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then(e=>e&&e.locations?(e.locations.forEach(e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach(e=>{s.push({measure:e.measure,distance:e.distance})})}),s):s)})}function sm(e,t,r,n,o){return Xf(this,void 0,void 0,function*(){if(!r.length)return null;const s=t.networkUrl,a=`${s}/measureToGeometry`,l=yield i.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];c.push({routeId:r,measure:o});let u=e.getGDBVersion();u||(u="");return Qf({method:"GET",url:a,params:{f:"json",token:l,locations:c,temporalViewDate:cf(n)&&0!==n.valueOf()?n:"",gdbVersion:u}}).then(e=>Xf(this,void 0,void 0,function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,i.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[t,r]=e}).then(()=>{let n=null;return e.locations.forEach(i=>{if("esriGeometryPoint"===i.geometryType&&null!=i.geometry){const o=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(i.geometry),n.spatialReference=o}}),n})}))})}function am(e,t,r,n,o){return Xf(this,void 0,void 0,function*(){if(!r.length)return null;const s=t.networkUrl,a=`${s}/measureToGeometry`,l=yield i.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];c.push({routeId:r,measure:o});let u=e.getGDBVersion();u||(u="");return Qf({method:"GET",url:a,params:{f:"json",token:l,locations:c,temporalViewDate:cf(n)&&0!==n.valueOf()?n:"",gdbVersion:u,outSR:102100}}).then(e=>Xf(this,void 0,void 0,function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,i.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[t,r]=e}).then(()=>{let n=null;return e.locations.forEach(i=>{if("esriGeometryPoint"===i.geometryType&&null!=i.geometry){const o=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(i.geometry),n.spatialReference=o}}),n})}))})}function lm(e,t,r,n,o,s){return Xf(this,void 0,void 0,function*(){const a=t.lrsUrl,l=`${a}/applyEdits`,c=yield i.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];if(o){const e={objectId:o.eventOid,routeId:o.routeId,measure:o.measure,fromDate:o.fromDate?Ef(o.fromDate):null,attributes:o.attributes,attributes2:o.attributes2},r={id:t.serviceId,splitEvent:e};u.push(r)}else if(s){const e={objectIds:s.objectIds,objectIdToPreserve:s.objectIdToPreserve,fromDate:s.fromDate?Ef(s.fromDate):null,toDate:s.toDate?Ef(s.toDate):null,attributes:s.attributes},r={id:t.serviceId,mergeEvents:e};u.push(r)}else n.edits.forEach(e=>{u.push(e)});let d=e.getGDBVersion();d||(d="");const h={f:"json",token:c,gdbVersion:d,edits:u,sessionId:"",returnServiceEditsOption:"none",returnEditMoment:!1};return r&&r.length>0&&(h.sessionId=r,h.returnServiceEditsOption="originalAndCurrentFeatures",h.returnEditMoment=!0),Qf({method:"POST",url:l,params:h}).then(e=>{const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults,t.editMoment=e.editMoment,t.exceededTransferLimit=e.exceededTransferLimit||!1,t.serviceEdits=e.serviceEdits||[]):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t})})}function cm(e){return Xf(this,void 0,void 0,function*(){return yield(0,i.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then(t=>{const[r]=t;let n;if(e.url.includes("MapServer")){let t="";t=e.url.substring(0,e.url.indexOf("MapServer")),t+="FeatureServer/"+e.layerId,n=new r({url:t})}else e.layer?n=e.layer:e.itemId&&(n=new r({portalItem:{id:e.itemId,portal:{url:e.portalUrl}}}));return n.load().then(()=>Xf(this,void 0,void 0,function*(){return yield Promise.resolve(n)}))}).catch(e=>(console.warn(e),null))})}function um(e,t,r,n,o,s,a){return Xf(this,void 0,void 0,function*(){if(!r.length||!n.length)return null;const l=t.networkUrl,c=`${l}/measureToGeometry`,u=yield i.SessionManager.getInstance().getSessionByUrl(l).getToken(l),d=[];d.push({routeId:r,toRouteId:n,fromMeasure:s,toMeasure:a});let h=e.getGDBVersion();h||(h="");return Qf({method:"GET",url:c,params:{f:"json",token:u,locations:d,temporalViewDate:cf(o)&&0!==o.valueOf()?o:"",gdbVersion:h}}).then(e=>Xf(this,void 0,void 0,function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,i.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/geometry/SpatialReference"]).then(e=>{[t,r]=e}).then(()=>{let n=null;return e.locations.forEach(i=>{if("esriGeometryPolyline"===i.geometryType){const o=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(i.geometry),n.spatialReference=o}}),n})}))})}const dm=(e,t,r,n)=>{if(!cf(t)||!cf(r)||!e.length)return Promise.reject(new Error(null));const i=hf(t),o=r.layer,s=o.createQuery();return s.where=`${i.routeIdFieldName} = '${e}'`,s.orderByFields=[t.fromDateFieldSchema.name],s.returnGeometry=!0,n&&(s.outSpatialReference=n),s.returnM=!0,s.outFields=[i.routeIdFieldName,i.fromDateFieldName,i.toDateFieldName],t.useRouteName&&s.outFields.push(i.routeNameFieldName),t.supportsLines&&(s.outFields.push(i.lineIdFieldName),s.outFields.push(i.lineNameFieldName),s.outFields.push(i.lineOrderFieldName)),o.queryFeatures(s).then(t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t).catch(e=>Promise.reject(new Error(null)))},hm=(e,t,r)=>{if(!cf(t)||!cf(r)||!e.length||0===e.length)return Promise.reject(new Error(null));const n=hf(t),i=r.layer,o=i.createQuery();return o.where=`${n.routeIdFieldName} IN ('${e.join("','")}')`,o.outFields=[n.routeIdFieldName,n.lineIdFieldName,n.lineOrderFieldName],i.queryFeatures(o).then(t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t).catch(e=>Promise.reject(new Error(null)))};var pm,fm,mm,gm,vm,ym;!function(e){e.EsriSuccess="esriSuccess",e.EsriReconcileRequired="esriReconcileRequired",e.EsriWrongReconcileVersion="esriWrongReconcileVersion",e.EsriConflictsDuringReconcile="esriConflictsDuringReconcile",e.EsriCouldNotAcquireAllLocks="esriCouldNotAcquireAllLocks",e.EsriActiveEditSessionOnVersion="esriActiveEditSessionOnVersion"}(pm||(pm={})),function(e){e.EsriSuccess="esriSuccess",e.EsriPostRequired="esriPostRequired",e.EsriWrongPostVersion="esriWrongPostVersion",e.EsriCouldNotReleaseAllLocks="esriCouldNotReleaseAllLocks",e.EsriCouldNotReleaseAllLocksPostRequired="esriCouldNotReleaseAllLocksPostRequired",e.EsriCouldNotReleaseAllLocksOwnedByOtherUsers="esriCouldNotReleaseAllLocksOwnedByOtherUsers",e.EsriCouldNotReleaseAllLocksActiveEditSession="esriCouldNotReleaseAllLocksActiveEditSession",e.EsriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault="esriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault"}(fm||(fm={})),function(e){e.No="no",e.Yes="yes",e.OnPost="onPost",e.Undefined="undefined"}(mm||(mm={})),function(e){e[e.Acquire=0]="Acquire",e[e.Release=1]="Release",e[e.Query=2]="Query",e[e.Locks=3]="Locks"}(gm||(gm={})),function(e){e[e.Reconcile=0]="Reconcile",e[e.Versions=1]="Versions",e[e.StartRead=2]="StartRead",e[e.StopRead=3]="StopRead",e[e.StartEdit=4]="StartEdit",e[e.StopEdit=5]="StopEdit"}(vm||(vm={})),function(e){e[e.Query=0]="Query",e[e.QueryAndAcquire=1]="QueryAndAcquire",e[e.QueryAndRelease=2]="QueryAndRelease",e[e.Acquire=3]="Acquire",e[e.Release=4]="Release",e[e.Clear=5]="Clear",e[e.None=6]="None"}(ym||(ym={}));var Sm=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Im(e,t,r){return Sm(this,void 0,void 0,function*(){if(!xm(t,e,!1))return t;const n=Of(e.url);return function(e){return Sm(this,void 0,void 0,function*(){var t;const r=Am(e,gm.Locks),n={f:"json",token:null===(t=i.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Qf({method:"GET",url:r,params:n}).then(e=>{var t;return(null===(t=null==e?void 0:e.lrs[0])||void 0===t?void 0:t.lockTableFields)||null})})}(e.url).then(i=>function(e,t,r,n,i){return Sm(this,void 0,void 0,function*(){const o=Am(e.url,gm.Query);let s=`${r.routeIdFieldName} IN ('${t.routeOrLineId.join("','")}')`;s+=` AND ${r.networkIdFieldName} IN (${t.networkId.toString()})`;return Qf({method:"GET",url:o,params:{f:"json",token:n.token,where:s,returnReleasableStatus:i}}).then(e=>e)})}(e,t,i,n,r).then(e=>cf(e)?(t.details=e.locks,t):(t.details=[],t)))})}function wm(e,t){return Sm(this,void 0,void 0,function*(){const r={acquireStatus:pm.EsriCouldNotAcquireAllLocks,acquiredLocks:[],unavailableLocks:[]};if(!xm(t,e,!0))return r;const n=Of(e.url),i=Cf(e),o=Am(e.url,gm.Acquire),s=[];t.eventServiceLayerIds.forEach((e,r)=>{t.isLine[r]?s.push({lineId:t.routeOrLineId[r],layerId:e}):s.push({routeId:t.routeOrLineId[r],layerId:e})});return Qf({method:"GET",url:o,params:{f:"json",token:n.token,editVersion:i,acquireLocks:s}}).then(e=>e)})}function Em(e,t){return Sm(this,void 0,void 0,function*(){if(!xm(t,e,!0))return!1;if(Lf(Cf(e))){return(yield Rm(e,t)).releaseStatus===fm.EsriSuccess}})}function bm(e,t,r){return Sm(this,void 0,void 0,function*(){if(!cf(t)||!cf(r))return!1;const n=Of(e.url),i=Cf(e);if(t.user===n.username&&t.versionName===i&&r.eventServiceLayerIds.includes(t.layerId))return!0;if(t.releasableStatus===mm.Yes){const n={routeOrLineId:[t.routeId],eventServiceLayerIds:[t.layerId],isLine:[r.isLine[0]],networkId:[t.lrsNetworkId],status:r.status,details:[],routeInfo:r.routeInfo,lockAction:r.lockAction};return(yield Rm(e,n)).releaseStatus===fm.EsriSuccess}})}function Rm(e,t){return Sm(this,void 0,void 0,function*(){if(!xm(t,e,!0))return null;const r=Am(e.url,gm.Release),n=Of(e.url),i=[];t.eventServiceLayerIds.forEach((e,r)=>{t.isLine[r]?i.push({lineId:t.routeOrLineId[r],layerId:e}):i.push({routeId:t.routeOrLineId[r],layerId:e})});return Qf({method:"GET",url:r,params:{f:"json",token:n.token,releaseLocks:i}}).then(e=>e)})}function Tm(e){return Sm(this,void 0,void 0,function*(){const t=Of(e.url),r=yield Nm(e.url,Cf(e));if(!cf(r)||""===r)return!1;const n=r.replace("{","").replace("}",""),o=Dm(e.url,vm.Reconcile,n);let s="{"+i.utils.getUUID()+"}";s=s.replace(/[_]/g,"-");const a={token:t.token,sessionId:s,abortIfConflicts:!0,conflictDetection:"byAttribute",withPost:!0,saveEdits:!0},l=Dm(e.url,vm.StartRead,n),c=Dm(e.url,vm.StartEdit,n),u=Dm(e.url,vm.StopRead,n),d=Dm(e.url,vm.StopEdit,n);let h=!1;return yield Qf({method:"POST",url:l,params:a}).then(e=>Sm(this,void 0,void 0,function*(){e.success&&(yield Qf({method:"POST",url:c,params:a}).then(e=>Sm(this,void 0,void 0,function*(){e.success&&(yield Qf({method:"POST",url:o,params:a}).then(e=>Sm(this,void 0,void 0,function*(){e.success&&(h=!0,yield Qf({method:"POST",url:d,params:a}).then(e=>Sm(this,void 0,void 0,function*(){e.success&&(yield Qf({method:"POST",url:u,params:a}).then(e=>null))})))})))})))})),h})}function Nm(e,t){return Sm(this,void 0,void 0,function*(){if(Lf(t))return"";const r=Dm(e,vm.Versions),n={f:"json",token:Of(e).token};return yield Qf({method:"GET",url:r,params:n}).then(e=>{let r="";return e.versions.forEach(e=>{e.versionName===t&&(r=e.versionGuid)}),r})})}function Om(){return{routeInfo:null,networkId:[],routeOrLineId:[],eventServiceLayerIds:[],isLine:[],status:pm.EsriSuccess,details:[],lockAction:ym.None}}function Cm(e){return""!==e.routeId||""!==e.lineId}function Lm(e,t){if(0===t.details.length)return!0;const r=Of(e.url),n=t.details.filter(e=>e.user===r.username);if(0===n.length)return!0;const i=Cf(e),o=n.filter(e=>e.versionName===i);if(0===o.length)return!0;const s=Object.assign([],String(t.eventServiceLayerIds));for(let e=0;e<o.length;e++){if(""===o[e].eventFeatureClassName)return!1;cf(s)&&s.includes(String(o[e].layerId))&&s.splice(s.indexOf(String(o[e].layerId)),1)}return 0!==(null==s?void 0:s.length)}function Am(e,t){let r=_m(e);if(""===r)return"";switch(r+="MapServer/exts/LRServer/",t){case gm.Acquire:r+="Locks/acquire";break;case gm.Release:r+="Locks/release";break;case gm.Query:r+="Locks/query";break;case gm.Locks:r+="locks"}return r}function Dm(e,t,r){let n=_m(e);if(""===n)return"";switch(n+="VersionManagementServer/",t){case vm.Reconcile:n+=`versions/${r}/reconcile`;break;case vm.Versions:n+="versions";break;case vm.StartRead:n+=`versions/${r}/startReading`;break;case vm.StopRead:n+=`versions/${r}/stopReading`;break;case vm.StartEdit:n+=`versions/${r}/startEditing`;break;case vm.StopEdit:n+=`versions/${r}/stopEditing`}return n}function _m(e){return e.includes("MapServer")?e.substring(0,e.lastIndexOf("MapServer")):e.includes("FeatureServer")?e.substring(0,e.lastIndexOf("FeatureServer")):e.includes("VersionManagementServer")?e.substring(0,e.lastIndexOf("VersionManagementServer")):""}function Pm(e){return Sm(this,void 0,void 0,function*(){var t;const r=Am(e,gm.Locks),n={f:"json",token:null===(t=i.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Qf({method:"GET",url:r,params:n}).then(e=>{var t;return(null===(t=null==e?void 0:e.lrs)||void 0===t?void 0:t[0].conflictPreventionEnabled)||!1})})}function xm(e,t,r){return!(!cf(e)||!cf(t))&&!(r&&!function(e){return e.eventServiceLayerIds.length===e.routeOrLineId.length&&e.eventServiceLayerIds.length===e.isLine.length}(e))}var Mm=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class km{constructor(e={}){var t;this.sessionId=e.sessionId,this.moment=null!==(t=e.moment)&&void 0!==t?t:null}static from(e){return e instanceof km?e:new km(e)}toJSON(){return{sessionId:this.sessionId,moment:this.moment}}}const jm=km;class Fm{constructor(e={}){this.sessionId=e.sessionId,this.rows=e.rows}static from(e){return e instanceof Fm?e:new Fm(e)}toJSON(){return{sessionId:this.sessionId,rows:this.rows}}}const Um=Fm;class Bm{constructor(e={}){var t,r;this.moment=null!==(t=e.moment)&&void 0!==t?t:null,this.success=null!==(r=e.success)&&void 0!==r&&r}static from(e){return e instanceof Bm?e:new Bm(e)}static fromJSON(e){return new Bm({moment:e.moment?new Date(e.moment):null,success:e.success})}}const Vm=Bm;var Gm=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};var $m=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const Hm=class{constructor(e){this.url=null,this.sourceJSON=null,this.name=null,this.capabilities=null,this.error=null,this.loaded=!1,this.loadStatus="not-loaded",this._esriRequest=null,this.defaultVersionIdentifier=null,this._isDefault=e=>!e||e===this.defaultVersionIdentifier.name,this.url=e,this.initialize()}initialize(){var e;this.url=this.url.replace(/\/$/,""),this._featureServiceUrl=this.url.replace(/\/VersionManagementServer/i,"/FeatureServer"),Sp.has(this.url)||Sp.set(this.url,new Map),console.log("versionCollection",Sp);const t=(null!==(e=yp.get(this.url))&&void 0!==e?e:0)+1;yp.set(this.url,t),console.log("versionCollectionCount",yp)}destroy(){var e;const t=(null!==(e=yp.get(this.url))&&void 0!==e?e:1)-1;yp.set(this.url,t),0===t&&Sp.delete(this.url)}read(e){e?(this.sourceJSON=e,this.loaded=!0,this.loadStatus="loaded",this.name=e.name||null,this.capabilities=e.capabilities||null,this.defaultVersionIdentifier={name:e.defaultVersionName||null,guid:e.defaultVersionGuid||null}):(this.loaded=!1,this.loadStatus="failed")}load(){return $m(this,void 0,void 0,function*(){return this.loadStatus="loading",yield this._fetchService(this.url),Promise.resolve(this)})}getSessionId(){return Ip}createVersion(e){return $m(this,void 0,void 0,function*(){const t=Np.from(e);return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield function(e,t,r){return Rp(this,void 0,void 0,function*(){const n={query:wp(Object.assign(Object.assign({},t),{f:"json"})),authMode:"immediate",method:"post"},i=`${e}/create`,{data:o}=yield r(i,n),s=o.versionInfo,{versionName:a,versionGuid:l}=s,c=Tp(s,["versionName","versionGuid"]),u={name:a,guid:l};return Object.assign(Object.assign({},c),{versionIdentifier:u})})}(this.url,t,this._esriRequest)}),null)})}deleteVersion(e){return $m(this,void 0,void 0,function*(){var t;let r;e.guid&&(null===(t=Sp.get(this.url))||void 0===t?void 0:t.has(e.guid))&&(r=null!=Ip?Ip:void 0);const n=new _p({versionName:e.name,sessionId:r});return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield function(e,t,r){return Pp(this,void 0,void 0,function*(){const n=t.toJSON(),i={query:wp(Object.assign(Object.assign({},n),{f:"json"})),authMode:"immediate",method:"post"},o=`${e}/delete`,{data:s}=yield r(o,i);return s.success})}(this.url,n,this._esriRequest)}),!1)})}getVersionInfoExtended(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield function(e,t,r){return Ap(this,void 0,void 0,function*(){const n={query:wp({f:"json"})};t.startsWith("{")&&(t=t.slice(1,-1));const i=`${e}/versions/${t}`,{data:o}=yield r(i,n),{versionName:s,versionGuid:a}=o,l=Dp(o,["versionName","versionGuid"]),c={name:s,guid:a};return Object.assign(Object.assign({},l),{versionIdentifier:c})})}(this.url,e.guid,this._esriRequest)}),null)})}getVersionInfos(){return $m(this,arguments,void 0,function*(e=new Op){const t=Op.from(e);return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield function(e,t,r){return Cp(this,void 0,void 0,function*(){const n=t.toJSON(),i={query:wp(Object.assign(Object.assign({},n),{f:"json"}))},o=`${e}/versionInfos`,{data:s}=yield r(o,i);return s.versions.map(e=>{const{versionName:t,versionGuid:r}=e,n=Lp(e,["versionName","versionGuid"]),i={name:t,guid:r};return Object.assign(Object.assign({},n),{versionIdentifier:i})})})}(this.url,t,this._esriRequest)}),[])})}reconcile(e){return $m(this,arguments,void 0,function*(e,t={}){const r=jp.from(t);return r.sessionId=Ip,yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return function(e,t,r,n){return Fp(this,void 0,void 0,function*(){const i=r.toJSON(),o={query:wp(Object.assign(Object.assign({},i),{f:"json"})),method:"post"};t=Ep(t);const s=bp(e,t,"reconcile"),{data:a}=yield n(s,o);return Mp.fromJSON(a)})}(this.url,e.guid,r,this._esriRequest)}),Mp.fromJSON({success:!1}))})}post(e){return $m(this,arguments,void 0,function*(e,t={}){const r=Um.from(t);return r.sessionId=Ip,yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return function(e,t,r,n){return Gm(this,void 0,void 0,function*(){const i=r.toJSON();r.rows&&(i.rows=JSON.stringify(r.rows));const o={query:wp(Object.assign(Object.assign({},i),{f:"json"})),method:"post"};t=Ep(t);const s=bp(e,t,"post"),{data:a}=yield n(s,o);return Vm.fromJSON(a)})}(this.url,e.guid,r,this._esriRequest)}),Vm.fromJSON({success:!1}))})}startReading(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return(yield this.startReadingWithResult(e)).success}),!1)})}startReadingWithResult(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){const t=yield function(e,t,r,n){return Up(this,void 0,void 0,function*(){const i={query:wp({sessionId:r,f:"json"}),method:"post"};t=Ep(t);const o=bp(e,t,"startReading"),{data:s}=yield n(o,i);return s||{success:!1}})}(this.url,e.guid,Ip,this._esriRequest);if(t.success){const t=yield this.getVersionInfoExtended(e),r=new Date(t.modifiedDate),n={editName:e.name,moment:r,edit:void 0},i={name:t.versionIdentifier.name,stackItem:n,lockType:"read"};this._addOrUpdateItem(e.guid,i)}return t}),{success:!1})})}stopReading(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return(yield this.stopReadingWithResult(e)).success}),!1)})}stopReadingWithResult(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){var t;const r=yield function(e,t,r,n){return Bp(this,void 0,void 0,function*(){const i={query:wp({sessionId:r,f:"json"}),method:"post"};t=Ep(t);const o=bp(e,t,"stopReading"),{data:s}=yield n(o,i);return s||{success:!1}})}(this.url,e.guid,Ip,this._esriRequest);return r.success&&(null===(t=Sp.get(this.url))||void 0===t||t.delete(e.guid)),r}),{success:!1})})}startEditing(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return(yield this.startEditingWithResult(e)).success}),!1)})}startEditingWithResult(e){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){const t=yield function(e,t,r,n){return Vp(this,void 0,void 0,function*(){const i={query:wp({sessionId:r,f:"json"}),method:"post"};t=Ep(t);const o=bp(e,t,"startEditing"),{data:s}=yield n(o,i);return s||{success:!1}})}(this.url,e.guid,Ip,this._esriRequest);if(t.success){const t=yield this.getVersionInfoExtended(e),r=new Date(t.modifiedDate),n={editName:e.name,moment:r,edit:void 0},i=new E(n),o={name:e.name,stackItem:n,lockType:"edit",stack:i};this._addOrUpdateItem(e.guid,o)}return t}),{success:!1})})}stopEditing(e,t){return $m(this,void 0,void 0,function*(){return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return(yield this.stopEditingWithResult(e,t)).success}),!1)})}stopEditingWithResult(e,t){return $m(this,void 0,void 0,function*(){var r,n;if(t){const t=null===(r=Sp.get(this.url))||void 0===r?void 0:r.get(e.guid);if(null===(n=null==t?void 0:t.stack)||void 0===n?void 0:n.canRedo()){const r=yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield function(e,t,r,n){return Mm(this,void 0,void 0,function*(){const i=r.toJSON(),o={query:wp(Object.assign(Object.assign({},i),{f:"json"})),method:"post"};t=Ep(t);const s=bp(e,t,"deleteForwardEdits"),{data:a}=yield n(s,o);return a})}(this.url,e.guid,new jm({sessionId:Ip,moment:t.stackItem.moment}),this._esriRequest)}),{success:!1});if(!r.success)return r}}return yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){const r=yield function(e,t,r,n,i){return Gp(this,void 0,void 0,function*(){const o={query:wp({sessionId:r,saveEdits:n,f:"json"}),method:"post"};t=Ep(t);const s=bp(e,t,"stopEditing"),{data:a}=yield i(s,o);return a||{success:!1}})}(this.url,e.guid,Ip,t,this._esriRequest);if(r.success){const t=yield this.getVersionInfoExtended(e),r={editName:e.name,edit:{},moment:t.modifiedDate?new Date(t.modifiedDate):void 0};this._addOrUpdateItem(e.guid,{name:e.name,stackItem:r,lockType:"read",stack:void 0})}return r}),{success:!1})})}startEditSession(e){return $m(this,void 0,void 0,function*(){return this._isDefault(e.name)?Promise.resolve(!0):yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return!!(yield this.startReading(e))&&(yield this.startEditing(e))}),!1)})}stopEditSession(e,t){return $m(this,void 0,void 0,function*(){return this._isDefault(e.name)?Promise.resolve(!1):yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield this.stopEditing(e,t)}),!1)})}getLockType(e){var t,r;const n=null===(r=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid))||void 0===r?void 0:r.lockType;return null!=n?n:"none"}changeVersion(e){return $m(this,void 0,void 0,function*(){if(e&&"name"in e&&!(yield this.getVersionInfoExtended(e)))throw new Error((0,N.formatMessage)(hp(),"vmsVersionNotFound",{versionName:e.name}));return this._changeVersionInternal(e.name),!0})}canUndo(e){var t,r;const n=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid);return!!(null===(r=null==n?void 0:n.stack)||void 0===r?void 0:r.canUndo())}canRedo(e){var t,r;const n=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid);return!!(null===(r=null==n?void 0:n.stack)||void 0===r?void 0:r.canRedo())}undo(e){var t,r,n,i;const o=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid),s=(null===(r=null==o?void 0:o.stack)||void 0===r?void 0:r.undo())||void 0;if(o&&s){this._updateDataSources(s,!0);const t=null===(n=null==o?void 0:o.stack)||void 0===n?void 0:n.peek();null===(i=Sp.get(this.url))||void 0===i||i.set(e.guid,Object.assign(Object.assign({},o),{stackItem:t}))}}redo(e){var t,r,n;const i=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid),o=(null===(r=null==i?void 0:i.stack)||void 0===r?void 0:r.redo())||void 0;i&&o&&(this._updateDataSources(o,!1),null===(n=Sp.get(this.url))||void 0===n||n.set(e.guid,Object.assign(Object.assign({},i),{stackItem:o})))}getEditMomentStack(e){var t;const r=null===(t=Sp.get(this.url))||void 0===t?void 0:t.get(e.guid);if(r&&r.stack)return r.stack}addEdit(e,t,r){if(this._isDefault(e.name))return;const n={editName:r,edit:t,moment:t.editMoment?new Date(t.editMoment):void 0};this._addMomentToVersionItem(e.name,n)}_tryCatchAsync(e,t){return $m(this,void 0,void 0,function*(){try{return this.error=null,yield this._loadEsriRequest(),yield e()}catch(e){return this.error=e,t}})}_loadEsriRequest(){return $m(this,void 0,void 0,function*(){this._esriRequest||(this._esriRequest=yield(0,i.loadArcGISJSAPIModule)("esri/request"))})}_addMomentToVersionItem(e,t){const r=Sp.get(this.url);if(r)for(const[n,i]of r){i.name===e&&this._addToStack(n,t)}}_addToStack(e,t){const r=Sp.get(this.url),n=null==r?void 0:r.get(e);return!!(null==n?void 0:n.stack)&&(function(e,t){if(e){return e.moment.getTime()<t.moment.getTime()}return!0}(n.stack.peek(),t)&&n.stack.push(t),r.set(e,Object.assign(Object.assign({},n),{stackItem:t})),!0)}_addOrUpdateItem(e,t){const r=Sp.get(this.url),n=null==r?void 0:r.get(e);return n?(r.set(e,Object.assign(Object.assign({},n),t)),!0):!(!t.name||!t.lockType)&&(null==r||r.set(e,Object.assign(Object.assign({},t),{lockType:t.lockType})),!0)}_updateDataSources(e,t){const r=this._getDataSources(),n=e.edit;for(const i of n.serviceEdits){const n=r.find(e=>e.layerId===i.id.toString());if(!n)continue;if(n&&(n.layer.historicMoment=e.moment),i.editedFeatures.adds)for(const e of i.editedFeatures.adds)if(t){const t=n.buildRecord(e);n.afterDeleteRecordById(t.getId())}else{const t=n.buildRecord(e);n.afterAddRecord(t)}if(i.editedFeatures.updates)for(const e of i.editedFeatures.updates){const r=e[0],i=e[1];if(t){const e=n.buildRecord(r);n.afterUpdateRecord(e)}else{const e=n.buildRecord(i);n.afterUpdateRecord(e)}}if(i.editedFeatures.deletes)for(const e of i.editedFeatures.deletes)if(t){const t=n.buildRecord(e);n.afterAddRecord(t)}else{const t=n.buildRecord(e);n.afterDeleteRecordById(t.getId())}}}_changeVersionInternal(e){let t=!1;const r=this._getDataSources();for(const n of Object.values(r))switch(n.type){case i.DataSourceTypes.FeatureLayer:case i.DataSourceTypes.SubtypeGroupLayer:case i.DataSourceTypes.SubtypeSublayer:this._getLayerObject(n).changeGDBVersion(e),t=!0;break;case i.DataSourceTypes.FeatureService:case i.DataSourceTypes.MapService:n.changeGDBVersion(e),t=!0}return t}_getDataSources(){const e=i.DataSourceManager.getInstance().getDataSources(),t=_m(this.url);return Object.values(e).filter(e=>!(!e._url||!decodeURI(e._url).includes(t))||(e.type===i.DataSourceTypes.FeatureService||e.type===i.DataSourceTypes.MapService))}_getLayerObject(e){return e.type,i.DataSourceTypes.FeatureLayer,e}_fetchService(e){return $m(this,void 0,void 0,function*(){if(this.sourceJSON)return void this.read(this.sourceJSON);const t=yield this._tryCatchAsync(()=>$m(this,void 0,void 0,function*(){return yield this._esriRequest(e,{responseType:"json",query:{f:"json"}})}),null);t?this.read(t.data):this.loaded=!1})}sendStopEditingBeacon(e,t){if(!navigator.sendBeacon||!this.url||!(null==e?void 0:e.guid))return;const r=`${this.url}/versions/${e.guid}/stopEditing`,n=new URLSearchParams;n.append("f","json"),n.append("sessionId",Ip||""),n.append("saveEdits",t?"true":"false"),navigator.sendBeacon(r,n)}sendStopReadingBeacon(e){if(!navigator.sendBeacon||!this.url||!(null==e?void 0:e.guid))return;const t=`${this.url}/versions/${e.guid}/stopReading`,r=new URLSearchParams;r.append("f","json"),r.append("sessionId",Ip||""),navigator.sendBeacon(t,r)}};var Wm=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class zm{static getInstance(){return zm._instance||(zm._instance=new zm),zm._instance}static subscribe(e){return zm._listeners.push(e),()=>{zm._listeners=zm._listeners.filter(t=>t!==e)}}isLoadingOrLoaded(){return zm._isInitialized||zm._isInitializing}canInitialize(e){return!(!e||""===e||void 0===e)&&(!(!zm._isInitialized||zm._isInitializing||e===zm._url)||!zm._isInitialized&&!zm._isInitializing)}initialize(e,t,r,n){return Wm(this,arguments,void 0,function*(e,t,r,n,i=""){if(!zm._isInitialized&&!zm._isInitializing&&t||t!==zm._url){if(zm._isInitializing=!0,zm._intl=e,zm._url=t,zm._lrsLayers=r,zm._conflictPreventionEnabled=n,yield this.initializeVmsService(t),!zm._vms||zm._vms.error)return zm._isInitializing=!1,void this.setErrorMessage(this.getI18nMessage("vmsError"));zm._vms.loaded&&(zm._currentVersion[t]||(yield this.initializeVersions(),this.initializeDefaultVersion(i)),this.setSessionId(zm._vms.getSessionId()),zm._isInitializing=!1,this.setInterceptor(),this.registerUnloadHandler(),this.setInitialized(),this.notifyChange())}return zm._initialized})}get versions(){return this.getVersions().map(e=>e.versionIdentifier.name)}get versionStates(){return this.getVersionStates()}get versionsInfo(){return this.getVersions()}get currentVersion(){var e,t;return null!==(t=null===(e=this.getCurrentVersion())||void 0===e?void 0:e.name)&&void 0!==t?t:null}get defaultVersion(){var e,t;return null!==(t=null===(e=this.getDefaultVersion())||void 0===e?void 0:e.name)&&void 0!==t?t:null}get stack(){return this.getEditStack()}get forwardStack(){return this.getForwardStack()}get sessionId(){return this.getSessionId()}get errorMessage(){return this.getErrorMessage()}get hasReconciled(){return this.getHasReconciled()}get historicMoment(){return this.getActiveMoment()}changeVersion(e){return Wm(this,arguments,void 0,function*(e,t=!1){if((this._isNotReady()||!e)&&!t)return!1;const r=this.findVersionByName(e);if(!r)return!1;this._isDefault()||(this.getIsEditing()&&(yield zm._vms.stopEditing(this.getCurrentVersion(),!1),this.setIsEditing(!1)),yield zm._vms.stopReading(this.getCurrentVersion()));if(!(yield zm._vms.changeVersion(r.versionIdentifier)))return this.setErrorMessage(this.getI18nMessage("vmsChangeVersionError",{versionName:e})),!1;if(this.setCurrentVersion(r.versionIdentifier),this.setHasReconciled(!1),this._isDefault())return this._getEditMomentStack(),this.notifyChange(),!0;return(yield zm._vms.startReading(this.getCurrentVersion()))?(this._getEditMomentStack(),this.notifyChange(),!0):(this.setErrorMessage(this.getI18nMessage("vmsFailedToStartReading",{versionName:this.getCurrentVersion().name})),!1)})}createVersion(e,t,r,n){return Wm(this,void 0,void 0,function*(){if(this._isNotReady()||!e)return!1;const i=yield zm._vms.createVersion({versionName:e,description:t,accessPermission:r});if(!i)return this.setErrorMessage(this.getI18nMessage("vmsCreateVersionError",{versionName:e})),!1;const o=this.getVersions();if(o.push(i),yield this.setVersions(o),n){if(!(yield this.changeVersion(i.versionIdentifier.name)))return this.setErrorMessage(this.getI18nMessage("vmsChangeVersionError",{versionName:e})),!1}return this.notifyChange(),!0})}deleteVersion(e){return Wm(this,void 0,void 0,function*(){if(this._isNotReady()||!e)return!1;const t=this.findVersionByName(e);if(!t)return!1;if(!(yield zm._vms.deleteVersion(t.versionIdentifier)))return this.setErrorMessage(this.getI18nMessage("vmsDeleteVersionError",{versionName:e})),!1;if(yield this.setVersions(this.getVersions().filter(t=>t.versionIdentifier.name!==e)),this.getCurrentVersion().name===e){return!!(yield this.changeVersion(this.getDefaultVersion().name))||(this.setErrorMessage(this.getI18nMessage("vmsChangeVersionError",{versionName:this.getDefaultVersion().name})),!1)}return this.notifyChange(),!0})}startEditSession(){return Wm(this,void 0,void 0,function*(){if(this._isNotReady())return!1;if(this.getIsEditing()||this._isDefault())return!0;return(yield zm._vms.startEditSession(this.getCurrentVersion()))?(this.setIsEditing(!0),this._getEditMomentStack(),this.notifyChange(),!0):(this.setErrorMessage(this.getI18nMessage("vmsFailedToStartEditSession")),!1)})}stopEditSession(e){return Wm(this,void 0,void 0,function*(){if(this._isNotReady()||!this.getIsEditing())return!1;if(this._isDefault())return!0;return(yield zm._vms.stopEditSession(this.getCurrentVersion(),e))?(this.setIsEditing(!1),this._getEditMomentStack(),this.notifyChange(),!0):(this.setErrorMessage(this.getI18nMessage("vmsFailedToStopEditSession")),!1)})}reconcile(){return Wm(this,void 0,void 0,function*(){if(this._isNotReady()||this._isDefault())return!1;if(!(yield zm._vms.startEditSession(this.getCurrentVersion())))return this.setErrorMessage(this.getI18nMessage("vmsFailedToStartEditSession")),!1;return(yield zm._vms.reconcile(this.getCurrentVersion())).success?(this.setHasReconciled(!0),(yield zm._vms.stopEditSession(this.getCurrentVersion(),!0))?(yield this.initializeVersions(),this._getEditMomentStack(),this.notifyChange(),!0):(this.setErrorMessage(this.getI18nMessage("vmsFailedToStopEditSession")),!1)):(this.setErrorMessage(this.getI18nMessage("vmsReconcileError")),!1)})}post(){return Wm(this,void 0,void 0,function*(){if(this._isNotReady()||this._isDefault())return!1;if(!(yield zm._vms.startEditSession(this.getCurrentVersion())))return this.setErrorMessage(this.getI18nMessage("vmsFailedToStartEditSession")),!1;return(yield zm._vms.post(this.getCurrentVersion())).success?(yield zm._vms.stopEditSession(this.getCurrentVersion(),!0))?(yield this.initializeVersions(),this._getEditMomentStack(),this.notifyChange(),!0):(this.setErrorMessage(this.getI18nMessage("vmsFailedToStopEditSession")),!1):(this.setErrorMessage(this.getI18nMessage("vmsPostError")),!1)})}undo(){return!this._isNotReady()&&(zm._vms.undo(this.getCurrentVersion()),this._getEditMomentStack(),this.notifyChange(),!0)}redo(){return!this._isNotReady()&&(zm._vms.redo(this.getCurrentVersion()),this._getEditMomentStack(),this.notifyChange(),!0)}addEdit(e,t){this._isNotReady()||(zm._vms.addEdit(this.getCurrentVersion(),e,t),this._getEditMomentStack(),this.notifyChange())}getVersions(){return zm._versions[zm._url]||[]}setVersions(e){return Wm(this,void 0,void 0,function*(){zm._versions[zm._url]=Array.isArray(e)?[...e]:e;const t=new Map;for(const r of e){const e=yield zm._vms.getVersionInfoExtended(r.versionIdentifier);e&&t.set(r.versionIdentifier.name,e)}this.setVersionStates(t)})}getVersionStates(){return zm._versionStates||new Map}setVersionStates(e){zm._versionStates=e}getCurrentVersion(){return zm._currentVersion[zm._url]}setCurrentVersion(e){zm._currentVersion[zm._url]=e}getDefaultVersion(){return zm._defaultVersion[zm._url]}setDefaultVersion(e){zm._defaultVersion[zm._url]=e}getEditStack(){return zm._editStack[zm._url]||[]}setEditStack(e){zm._editStack[zm._url]=Array.isArray(e)?[...e]:e}getForwardStack(){return zm._forwardStack[zm._url]||[]}setForwardStack(e){zm._forwardStack[zm._url]=Array.isArray(e)?[...e]:e}getSessionId(){return zm._sessionId[zm._url]||""}setSessionId(e){zm._sessionId[zm._url]=e}getErrorMessage(){return zm._errorMessage[zm._url]||""}setErrorMessageValue(e){zm._errorMessage[zm._url]=e}getActiveMoment(){return zm._activeMoment[zm._url]}setActiveMoment(e){zm._activeMoment[zm._url]=e}getIsEditing(){return zm._isEditing[zm._url]||!1}setIsEditing(e){zm._isEditing[zm._url]=e}getHasReconciled(){return zm._hasReconciled[zm._url]||!1}setHasReconciled(e){zm._hasReconciled[zm._url]=e}getConflictPreventionEnabled(){return zm._conflictPreventionEnabled}constructor(){null===zm._initialized&&(zm._initialized=new Promise(e=>{zm._resolveInitialized=e}))}notifyChange(){zm._listeners.forEach(e=>{e()})}initializeVmsService(e){return Wm(this,void 0,void 0,function*(){e&&(zm._vms=new Hm(e),yield zm._vms.load())})}initializeDefaultVersion(e){this.setDefaultVersion(zm._vms.defaultVersionIdentifier);const t=this.findVersionByName(e);if(t)return this.changeVersion(t.versionIdentifier.name,!0),void this.setCurrentVersion(t.versionIdentifier);this.changeVersion(zm._vms.defaultVersionIdentifier.name,!0),this.setCurrentVersion(zm._vms.defaultVersionIdentifier)}initializeVersions(){return Wm(this,void 0,void 0,function*(){yield this.setVersions(yield zm._vms.getVersionInfos())})}findVersionByName(e){const t=this.getVersions().find(t=>t.versionIdentifier.name===e);if(t)return t;this.setErrorMessage(this.getI18nMessage("vmsVersionNotFound",{versionName:e}))}_getEditMomentStack(){var e,t;const r=zm._vms.getEditMomentStack(this.getCurrentVersion());if(r&&!this._isDefault()){const n=r.stackItems.length-1;this.setActiveMoment((null===(t=null===(e=r.stackItems[n])||void 0===e?void 0:e.edit)||void 0===t?void 0:t.editMoment)||null),this.setEditStack(r.stackItems.filter(e=>e.edit).map(e=>e.editName)||[]),this.setForwardStack(r.forwardStackItems.filter(e=>e.edit).map(e=>e.editName)||[])}else this.setActiveMoment(-1),this.setEditStack([]),this.setForwardStack([])}_isDefault(){return this.getCurrentVersion()&&this.getCurrentVersion().name===this.getDefaultVersion().name}_isNotReady(){return!zm._isInitialized||!zm._vms}setInitialized(){zm._isInitialized||(zm._isInitialized=!0,zm._resolveInitialized())}setErrorMessage(e){var t,r;this.setErrorMessageValue((null===(r=null===(t=zm._vms)||void 0===t?void 0:t.error)||void 0===r?void 0:r.message)||e),this.notifyChange()}getI18nMessage(e,t){return nf(zm._intl,e,t)}getLayerIdFromUrl(e){const t=e.match(/FeatureServer\/(\d+)\b/);return t?parseInt(t[1],10):null}getDataSourceFromUrl(e){const t=this.getLayerIdFromUrl(e);if(null!==t)return zm._lrsLayers.find(e=>e.serviceId===t)}extractRouteOrLineIds(e,t,r){if(!e)return[];let n=[];if("string"==typeof e)try{const t=JSON.parse(e);Array.isArray(t)&&(n=t)}catch(e){return[]}else Array.isArray(e)&&(n=e);return n.flatMap(e=>{const n=[];return e&&e.attributes&&(e.attributes[t]&&n.push(e.attributes[t]),e.attributes[r]&&n.push(e.attributes[r])),n})}populateRouteOrLineIds(e,t){return Wm(this,void 0,void 0,function*(){const r=[],n=[];if(e.networkInfo.supportsLines){const o=i.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId),s=o.getCurrentQueryParams();s.where=`${e.networkInfo.routeIdFieldName} IN (${t.map(e=>`'${e}'`).join(",")})`,s.outFields=[e.networkInfo.lineIdFieldName];const a=yield o.query(s);a&&a.records&&a.records.forEach(t=>{const i=t.getData()[e.networkInfo.lineIdFieldName];i&&(r.push(i),n.push(!0))})}else{r.push(...t);for(let e=0;e<t.length;e++)n.push(!1)}return{uniqueRouteOrLineIds:r,isLine:n}})}acquireLocksTable(e,t,r,n){return Wm(this,void 0,void 0,function*(){const o=zm._lrsLayers.filter(e=>e.layerType===qp.Network),s=this.getDataSourceFromUrl(e);if(s){if(s.layerType!==qp.Event)return!0;const e=o.find(e=>{var t;return(null===(t=e.networkInfo)||void 0===t?void 0:t.lrsNetworkId)===s.eventInfo.parentNetworkId}),a=[...this.extractRouteOrLineIds(t,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName),...this.extractRouteOrLineIds(r,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName),...this.extractRouteOrLineIds(n,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName)],l=Array.from(new Set(a)),{uniqueRouteOrLineIds:c,isLine:u}=yield this.populateRouteOrLineIds(e,l),d={networkId:[e.networkInfo.lrsNetworkId],routeOrLineId:c,eventServiceLayerIds:[s.serviceId],isLine:u,status:pm.EsriSuccess,details:[],lockAction:ym.Acquire,routeInfo:null},h=i.DataSourceManager.getInstance().getDataSource(s.useDataSource.dataSourceId);return yield wm(h,d),!0}})}acquireLocksEdit(e,t){return Wm(this,void 0,void 0,function*(){try{const e=JSON.parse(t);for(const t of e){const e=t.id,r=t.adds||[],n=t.updates||[],o=t.deletes||[],s=zm._lrsLayers.find(t=>t.serviceId===e);if(s){const e=zm._lrsLayers.find(e=>{var t;return(null===(t=e.networkInfo)||void 0===t?void 0:t.lrsNetworkId)===s.eventInfo.parentNetworkId});if(e){const t=[...this.extractRouteOrLineIds(r,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName),...this.extractRouteOrLineIds(n,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName),...this.extractRouteOrLineIds(o,s.eventInfo.routeIdFieldName,s.eventInfo.toRouteIdFieldName)],a=Array.from(new Set(t)),{uniqueRouteOrLineIds:l,isLine:c}=yield this.populateRouteOrLineIds(e,a),u={networkId:[e.networkInfo.lrsNetworkId],routeOrLineId:l,eventServiceLayerIds:[s.serviceId],isLine:c,status:pm.EsriSuccess,details:[],lockAction:ym.Acquire,routeInfo:null},d=i.DataSourceManager.getInstance().getDataSource(s.useDataSource.dataSourceId);yield wm(d,u)}}}}catch(e){}})}setInterceptor(){return Wm(this,void 0,void 0,function*(){const[e]=yield i.moduleLoader.loadModules(["esri/config"]),t=this,r={urls:[/\/server\/rest\/.*/],before:function(e){return Wm(this,void 0,void 0,function*(){if(e.url.includes("query")&&t.getActiveMoment()>-1&&(e.requestOptions.query.historicMoment=t.getActiveMoment()),e.url.includes("applyEdits")){if(t.getConflictPreventionEnabled()){const r=e.requestOptions.query.edits||[],n=e.requestOptions.query.adds,i=e.requestOptions.query.updates,o=e.requestOptions.query.deletes;r&&r.length>0&&(yield t.acquireLocksEdit(e.url,r)),(n||i||o)&&(yield t.acquireLocksTable(e.url,n,i,o))}t._isDefault()||(t.getIsEditing()||(yield zm._vms.startEditSession(t.getCurrentVersion()))&&t.setIsEditing(!0),e.requestOptions.query.returnEditMoment=!0,e.requestOptions.query.sessionID=t.getSessionId())}})},after:function(e){return Wm(this,void 0,void 0,function*(){var r,n,o,s,a,l,c,u,d;if(e&&e.url.includes("applyEdits")){const h={serviceEdits:[],editMoment:-1};if(Array.isArray(e.data)){h.editMoment=(null===(n=null===(r=e.data)||void 0===r?void 0:r[0])||void 0===n?void 0:n.editMoment)||-1;for(const t of e.data){const e={id:null==t?void 0:t.id,editedFeatures:null==t?void 0:t.editedFeatures};h.serviceEdits.push(e)}let i="Apply Edits";(null===(s=null===(o=e.data)||void 0===o?void 0:o[0])||void 0===s?void 0:s.addResults)?i="Apply Edits (Add)":(null===(l=null===(a=e.data)||void 0===a?void 0:a[0])||void 0===l?void 0:l.updateResults)?i="Apply Edits (Update)":(null===(u=null===(c=e.data)||void 0===c?void 0:c[0])||void 0===u?void 0:u.deleteResults)&&(i="Apply Edits (Delete)"),zm._vms.addEdit(t.getCurrentVersion(),h,i)}else{h.editMoment=(null===(d=e.data)||void 0===d?void 0:d.editMoment)||-1;const r=t.getDataSourceFromUrl(e.url),n=i.DataSourceManager.getInstance().getDataSource(r.useDataSource.dataSourceId);try{const i=e.requestOptions.query.adds,o=e.requestOptions.query.updates,s=e.requestOptions.query.deletes,a=[],l=[],c=[];if(i){const e=JSON.parse(i);for(const t of e)a.push({attributes:t.attributes||{},geometry:t.geometry||{}})}if(o){const e=JSON.parse(o);for(const t of e){const e=[],r=[];e.push({attributes:t.attributes||{},geometry:t.geometry||{}});const i=t.attributes[n.getIdField()],o=yield n.queryById(i);if(o){const e=o.getData(),t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);const n=o.getGeometry();e&&r.push({attributes:t,geometry:n})}l.push([...e,...r])}}if(s){const e=JSON.parse(s);for(const t of e)c.push({attributes:t.attributes||{},geometry:t.geometry||{}})}const u={id:r.serviceId.toString(),editedFeatures:{adds:a||[],updates:l||[],deletes:s||[],spatialReference:null}};h.serviceEdits.push(u);let d="Apply Edits";a.length>0?d="Apply Edits (Add)":l.length>0?d="Apply Edits (Update)":c.length>0&&(d="Apply Edits (Delete)"),zm._vms.addEdit(t.getCurrentVersion(),h,d)}catch(e){console.error("Error parsing applyEdits response:",e)}}t._getEditMomentStack(),t.notifyChange()}})}};e.request.interceptors.splice(0,0,r)})}registerUnloadHandler(){window.addEventListener("beforeunload",()=>{zm._vms&&!this._isDefault()&&(navigator.sendBeacon?(this.getIsEditing()&&zm._vms.sendStopEditingBeacon(this.getCurrentVersion(),!1),zm._vms.sendStopReadingBeacon(this.getCurrentVersion())):(this.getIsEditing()&&zm._vms.stopEditing(this.getCurrentVersion(),!1),zm._vms.stopReading(this.getCurrentVersion())))})}}zm._instance=null,zm._isInitialized=!1,zm._isInitializing=!1,zm._initialized=null,zm._url="",zm._intl=null,zm._listeners=[],zm._lrsLayers=(0,i.Immutable)([]),zm._conflictPreventionEnabled=!1,zm._versions=new Map,zm._versionStates=new Map,zm._currentVersion=new Map,zm._defaultVersion=new Map,zm._editStack=new Map,zm._forwardStack=new Map,zm._errorMessage=new Map,zm._sessionId=new Map,zm._activeMoment=new Map,zm._isEditing=new Map,zm._hasReconciled=new Map;var qm=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const{useEffect:Jm,useMemo:Km,useState:Ym}=i.React,{useSelector:Xm}=i.ReactRedux,Qm=e=>{var t,r;const n=Km(()=>zm.getInstance(),[]),[o,s]=Ym(!1),a=Xm(e=>function(e){var t,r;return null!==(r=null===(t=null==e?void 0:e[h])||void 0===t?void 0:t.mapViewId)&&void 0!==r?r:null}(e)),l=Xm(e=>function(e,t){var r;return null===(r=null==t?void 0:t[h])||void 0===r?void 0:r.lrsLayers.getIn([e])}(a,e)),c=null!==(r=null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.lrsUrl)&&void 0!==r?r:"",u=Xm(e=>w(c,e)),d=(0,i.useIntl)(),[,p]=Ym(0);Jm(function(){let t=!1;return(()=>{qm(this,void 0,void 0,function*(){const r=null==l?void 0:l[0],i=r?_m(r.lrsUrl)+"VersionManagementServer":void 0;if(n.canInitialize(i)&&e){const i=_m(r.lrsUrl)+"VersionManagementServer";yield n.initialize(d,i,l,u,e),t||(s(!0),p(e=>e+1))}else n.isLoadingOrLoaded()&&s(!0)})})(),()=>{t=!0}},[e,d,u,l,n]),Jm(function(){if(!o)return;const e=()=>{p(e=>e+1)};e();const t=zm.subscribe(e);return()=>{t()}},[n,o]);const f=(0,Co.useCallback)(e=>qm(void 0,void 0,void 0,function*(){return{success:yield n.changeVersion(e),error:n.errorMessage}}),[n]),m=(0,Co.useCallback)((e,t,r,i)=>qm(void 0,void 0,void 0,function*(){return{success:yield n.createVersion(e,t,r,i),error:n.errorMessage}}),[n]),g=(0,Co.useCallback)(e=>qm(void 0,void 0,void 0,function*(){return{success:yield n.deleteVersion(e),error:n.errorMessage}}),[n]),v=(0,Co.useCallback)(()=>qm(void 0,void 0,void 0,function*(){return{success:yield n.startEditSession(),error:n.errorMessage}}),[n]),y=(0,Co.useCallback)(e=>qm(void 0,void 0,void 0,function*(){return{success:yield n.stopEditSession(e),error:n.errorMessage}}),[n]),S=(0,Co.useCallback)(()=>qm(void 0,void 0,void 0,function*(){return{success:yield n.reconcile(),error:n.errorMessage}}),[n]),I=(0,Co.useCallback)(()=>qm(void 0,void 0,void 0,function*(){return{success:yield n.post(),error:n.errorMessage}}),[n]),E=(0,Co.useCallback)(()=>(n.redo(),{success:!0,error:n.errorMessage}),[n]),b=(0,Co.useCallback)(()=>(n.undo(),{success:!0,error:n.errorMessage}),[n]),R=(0,Co.useCallback)((e,t)=>{n.addEdit(e,t)},[n]);return Km(()=>({currentVersion:n.currentVersion,defaultVersion:n.defaultVersion,versions:n.versions,versionStates:n.versionStates,versionsInfo:n.versionsInfo,stack:n.stack,forwardStack:n.forwardStack,sessionId:n.sessionId,hasReconciled:n.hasReconciled,vmsEnabled:o,historicMoment:n.historicMoment,changeVersion:f,createVersion:m,deleteVersion:g,startEditSession:v,stopEditSession:y,reconcile:S,post:I,redo:E,undo:b,addEdit:R}),[n.currentVersion,n.defaultVersion,n.versions,n.versionStates,n.versionsInfo,n.stack,n.forwardStack,n.sessionId,n.hasReconciled,o,n.historicMoment,f,m,g,v,y,S,I,E,b,R])},{useEffect:Zm}=i.React,{useSelector:eg,useDispatch:tg}=i.ReactRedux,rg=(e=null)=>{const t=eg(e=>function(e){var t,r;return null!==(r=null===(t=null==e?void 0:e[h])||void 0===t?void 0:t.date)&&void 0!==r?r:null}(e)),r=tg();Zm(()=>{if(!t){const t=e?new Date(e):new Date(Date.now());(0,N.setDate)(t,r)}},[e,r,t]);const n=i.React.useCallback(e=>{(0,N.setDate)(e,r)},[r]);return i.React.useMemo(()=>{return{activeDate:(e=t,e?"function"==typeof e.asMutable?e.asMutable():e:null),setActiveDate:n};var e},[t,n])},{useSelector:ng,useDispatch:ig}=i.ReactRedux,og=()=>{const e=ng(e=>function(e){var t,r;return null!==(r=null===(t=null==e?void 0:e[h])||void 0===t?void 0:t.editSession)&&void 0!==r&&r}(e)),t=ig(),r=i.React.useCallback(e=>{!function(e,t){t({type:u.SetEditSession,payload:e})}(e,t)},[t]);return i.React.useMemo(()=>({supportsEditSession:e,setSupportsEditSession:r}),[e,r])};var sg=m(62686),ag=1/0;const lg=function(e){return e?(e=Pn(e))===ag||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const cg=function(e){var t=lg(e),r=t%1;return t==t?r?t-r:t:0};var ug=Oe.isFinite,dg=Math.min;const hg=function(e){var t=Math[e];return function(e,r){if(e=Pn(e),(r=null==r?0:dg(cg(r),292))&&ug(e)){var n=(ch(e)+"e").split("e"),i=t(n[0]+"e"+(+n[1]+r));return+((n=(ch(i)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");var pg=m(99037);const fg=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],mg=[{value:"DerivedRouteName",label:"Derived Route Name"},{value:"DerivedRouteID",label:"Derived Route ID"},{value:"DerivedRouteMeasure",label:"Derived Route Measure"},{value:"DerivedRouteToMeasure",label:"Derived Route ToMeasure"}],gg={value:"Distance",label:"Distance"},vg=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],yg={value:"Network_OBJECTID",label:"Network OBJECTID"},Sg=[{value:"ToRouteID",label:"To RouteID"},{value:"ToRouteName",label:"To Route Name"},{value:"ToRouteLineOrder",label:"To Route Line Order"},{value:"ToRouteFromDate",label:"To Route From Date"},{value:"ToRouteToDate",label:"To Route To Date"}],Ig=1e4,wg="#00FFFF",Eg="#000000",bg="#00FFFF",Rg="#FF0000",Tg="#FFFF00",Ng="All Line Events",Og="All Point Events";var Cg=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const Lg=(e,t,r,n)=>Cg(void 0,void 0,void 0,function*(){var i;switch(t||(t=wg),null===(i=null==e?void 0:e.geometry)||void 0===i?void 0:i.type){case"point":return yield Dg(e,t,r).then(e=>e);case"polyline":return yield _g(e,t,r,n).then(e=>e);default:return null}}),Ag=e=>(0,sg.loadArcGISJSAPIModules)(["esri/Graphic"]).then(t=>{let r=null;[r]=t;const n={type:"simple-marker",style:"circle",size:6,color:Eg};return new r({geometry:e.geometry,symbol:n,attributes:e.attributes})}),Dg=(e,t,r=3)=>(0,sg.loadArcGISJSAPIModules)(["esri/Graphic"]).then(n=>{let i=null;[i]=n;const o={type:"simple-marker",style:"circle",width:r,color:t||wg,outline:{color:Eg,width:1}};return new i({geometry:e.geometry,symbol:o,attributes:e.attributes})}),_g=(e,t,r=9,n=!1)=>(0,sg.loadArcGISJSAPIModules)(["esri/Graphic"]).then(i=>{let o=null;[o]=i;let s={};s=n?{type:"simple-line",color:t||wg,width:r,style:"solid",marker:{color:t||wg,style:"arrow",placement:"end"},outline:{color:Eg,width:1}}:{type:"simple-line",color:t||wg,width:r,style:"solid",outline:{color:Eg,width:1}};return new o({geometry:e.geometry,symbol:s,attributes:e.attributes})}),Pg=e=>(0,sg.loadArcGISJSAPIModules)(["esri/Graphic"]).then(t=>{let r=null;[r]=t;return new r({geometry:e,symbol:null,attributes:[]})}),xg=e=>(0,sg.loadArcGISJSAPIModules)(["esri/Graphic"]).then(t=>{let r=null;[r]=t;return new r({geometry:e,symbol:null,attributes:[]})});var Mg=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function kg(e){const{type:t,active:r,networkDs:n,network:o,routeInfo:s,disabled:a,jimuMapView:l,hoverGraphic:c,isFrom:u=!1,canSpanRoutes:d=!1,useRouteStartMeasure:h=!1,useRouteEndMeasure:p=!1,onActiveChange:f,onRouteInfoUpdated:m,onMultiRouteSelect:g}=e,v=i.React.useRef(null),y=i.React.useRef(null),[S,I]=i.React.useState(null),w=i.React.useRef(!1),E=i.React.useRef(!1);i.React.useEffect(()=>{if(cf(n)&&cf(l)){const e=n;cf(null==e?void 0:e.layer)&&I(null==e?void 0:e.layer)}},[l,n]),i.React.useEffect(()=>{r?b():R()},[r]);const b=()=>{v.current=null==l?void 0:l.view.on("pointer-move",C),y.current=null==l?void 0:l.view.on("pointer-down",L)},R=()=>{cf(v.current)&&(v.current.remove(),v.current=null),cf(y.current)&&(y.current.remove(),y.current=null),E.current&&(E.current=!1),w.current&&(w.current=!1)},T=()=>{cf(c)&&c.removeAll()},N=e=>{T(),cf(e)&&c.add(e)},O=e=>{const t=S.spatialReference,r=S.createQuery(),n="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);return r.geometry=e,r.units="meters",r.returnGeometry=!0,r.returnM=!0,r.returnZ=!0,r.distance=(null==l?void 0:l.view.resolution)*n,r.spatialRelationship="intersects",r},C=e=>{cf(S)&&!w.current&&(0,sg.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/time/TimeExtent"]).then(r=>{let i=null,a=null;[i,a]=r,w.current=!0;const c=n.getCurrentQueryParams(),h=null==l?void 0:l.view.toMap(e),p=O(h),f=o.lineIdFieldSchema?o.lineIdFieldSchema.name:"",m=d?s.lineId:"";if(p.outFields=d?[f]:[],(null==c?void 0:c.time)&&(p.timeExtent=new a({start:c.time[0],end:c.time[1]})),p.gdbVersion=c.gdbVersion,"route-measure"===t)S.queryFeatures(p).then(e=>{e.features.forEach(e=>Mg(this,void 0,void 0,function*(){const t=e.geometry;if(!d||d&&u){const e=i.getNearestCoordinate(t,h),r=i.getNearestVertex(t,h);return r.distance<3*p.distance&&(e.coordinate=r.coordinate),N(yield Ag(yield Pg(e.coordinate))),w.current=!1,!0}if(d&&!u){if(e.attributes[f]===m){const e=i.getNearestCoordinate(t,h),r=i.getNearestVertex(t,h);return r.distance<3*p.distance&&(e.coordinate=r.coordinate),N(yield Ag(yield Pg(e.coordinate))),w.current=!1,!0}}})),w.current&&(N(null),w.current=!1)});else{const e=o.routeIdFieldSchema?o.routeIdFieldSchema.name:"",t=o.fromDateFieldSchema?o.fromDateFieldSchema.name:"",r=o.lineIdFieldSchema?o.lineIdFieldSchema.name:"";p.outFields=d?[e,r,t]:[e,t];const a=u?s.routeId:s.toRouteId;S.queryFeatures(p).then(r=>{r.features.forEach(o=>Mg(this,void 0,void 0,function*(){const l=o.attributes[e],c=Uf(o.attributes[t],n).toLocaleDateString(),d=u?s.fromDate.toLocaleDateString():s.toRouteFromDate.toLocaleDateString();if(l===a&&c===d){const e=r.features[0].geometry,t=i.getNearestCoordinate(e,h),n=i.getNearestVertex(e,h);n.distance<3*p.distance&&(t.coordinate=n.coordinate),N(yield Ag(yield Pg(t.coordinate))),w.current=!1}})),w.current&&(N(null),w.current=!1)})}})},L=e=>Mg(this,void 0,void 0,function*(){return new Promise(r=>{try{cf(S)&&!E.current&&(e.stopPropagation(),(0,sg.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/time/TimeExtent"]).then(r=>Mg(this,void 0,void 0,function*(){let i=null,a=null;[i,a]=r;const c=S.popupEnabled;S.popupEnabled=!1,E.current=!0;const v=null==l?void 0:l.view.toMap(e),y=O(v),I=o.routeNameFieldSchema?o.routeNameFieldSchema.name:"",w=o.routeIdFieldSchema?o.routeIdFieldSchema.name:"",b=o.fromDateFieldSchema.name,N=o.toDateFieldSchema.name,C=o.lineIdFieldSchema?o.lineIdFieldSchema.name:"",L=o.lineNameFieldSchema?o.lineNameFieldSchema.name:"",A=o.lineOrderFieldSchema?o.lineOrderFieldSchema.name:"";y.outFields=[w,b,N],(d||""!==C)&&(y.outFields.push(C),y.outFields.push(L),y.outFields.push(A)),o.useRouteName&&y.outFields.push(I);const D=n.getCurrentQueryParams();(null==D?void 0:D.time)&&(y.timeExtent=new a({start:D.time[0],end:D.time[1]})),y.gdbVersion=D.gdbVersion,!u&&d&&("esriFieldTypeGUID"===o.lineIdFieldSchema.esriType?y.where=`${C} = '${s.lineId}'`:y.where=`${C} LIKE '%${s.lineId}'`);const _=[];yield S.queryFeatures(y).then(e=>Mg(this,void 0,void 0,function*(){"route-measure"===t?yield Promise.all(e.features.map(e=>Mg(this,void 0,void 0,function*(){const t=e.attributes[w],r=o.useRouteName?e.attributes[I]:"",a=(null==e?void 0:e.attributes[C])||"",l=(null==e?void 0:e.attributes[L])||"",c=(null==e?void 0:e.attributes[A])||"",f=e.attributes[b],m=e.attributes[N],g=uf(e.geometry),S=e.geometry,E=i.getNearestCoordinate(S,v),R=i.getNearestVertex(S,v);R.distance<3*y.distance&&(E.coordinate=R.coordinate),yield im(n,o,g,f,t).then(v=>Mg(this,void 0,void 0,function*(){const y=Math.min(...v),I=Math.max(...v);yield om(n,o,[E.coordinate],f,t).then(v=>{v.forEach(v=>{const w=v.measure;let b=new Date(Date.now());const R=f?Uf(f,n):null,T=m?Uf(m,n):null;cf(T)&&b>T||cf(f)&&b<R?b=R:b.setHours(0,0,0,0);let N=new Date(Date.now());cf(T)&&N>T?N=T:N.setHours(0,0,0,0),(!cf(m)||T>N)&&(N=null);let O=!1;!u||d||s.routeId===t&&s.routeName===r&&s.toRouteId===t&&s.toRouteName===r?u&&d&&!s.validToRoute&&(O=!0):O=!0,u&&a&&s.lineId!==a&&(O=!0);let C=!1;(u&&d&&!s.validToRoute||u&&a&&s.toLineId!==a||u&&!d&&s.routeId===s.toRouteId)&&(C=!0);let L=cf(f)?Uf(f,n):null,A=cf(m)?Uf(m,n):null;u&&d&&""!==s.toRouteId&&t!==s.toRouteId&&(L=s.toRouteFromDate,A=s.toRouteToDate);E.coordinate.hasZ=!0;const D={routeId:u?t:s.routeId,toRouteId:u?C?t:s.toRouteId:t,routeName:u?r:s.routeName,toRouteName:u?C?r:s.toRouteName:r,routeLineOrder:u?c:s.routeLineOrder,toRouteLineOrder:u?s.toRouteLineOrder:c,lineId:a,toLineId:a,lineName:l,toLineName:l,fromMeasure:u?hg(y,o.measurePrecision):s.fromMeasure,toMeasure:u?hg(I,o.measurePrecision):s.toMeasure,toRouteFromMeasure:u?C?hg(y,o.measurePrecision):s.toRouteFromMeasure:hg(y,o.measurePrecision),toRouteToMeasure:u?C?hg(I,o.measurePrecision):s.toRouteToMeasure:hg(I,o.measurePrecision),selectedMeasure:u?hg(w,o.measurePrecision):s.selectedMeasure,distance:v.distance,selectedToMeasure:u?O?NaN:s.selectedToMeasure:hg(w,o.measurePrecision),fromDate:u?cf(f)?Uf(f,n):null:s.fromDate,toDate:u?cf(m)?Uf(m,n):null:s.toDate,toRouteFromDate:L,toRouteToDate:A,selectedPoint:u?E.coordinate:s.selectedPoint,isNearestCoordinate:u,selectedToPoint:u?O?null:s.selectedToPoint:E.coordinate,selectedPolyline:e.geometry,selectedToPolyline:u?s.selectedToPolyline:e.geometry,selectedFromDate:u?b:s.selectedFromDate,selectedToDate:u?N:s.selectedToDate,validRoute:!!u||s.validRoute,validToRoute:!u||s.validToRoute};if(u){if(h){D.selectedMeasure=D.fromMeasure;const e=i.getNearestCoordinate(S,g[0]);D.selectedPoint=e.coordinate}if(p&&(!d||D.routeId===D.toRouteId)){const e=i.getNearestCoordinate(S,g[1]);D.selectedToMeasure=D.toRouteToMeasure,D.selectedToPoint=e.coordinate,D.selectedToPolyline=D.selectedPolyline}}else if(p&&d){const e=i.getNearestCoordinate(S,g[1]);D.selectedToMeasure=D.toRouteToMeasure,D.selectedToPoint=e.coordinate}if(u)_.push(D);else{_.find(e=>e.routeId===D.routeId&&e.fromDate===D.fromDate)||_.push(D)}})})}))}))):yield Promise.all(e.features.map(e=>Mg(this,void 0,void 0,function*(){const t=e.attributes[w],r=e.attributes[b]?Uf(e.attributes[b],n):null,a=u?s.routeId:s.toRouteId,l=u?s.fromDate:s.toRouteFromDate;if(t===a&&r.toLocaleDateString()===l.toLocaleDateString()){const t=e.attributes[w],r=o.useRouteName?e.attributes[I]:"",a=e.attributes[b],l=e.attributes[N],c=d?e.attributes[A]:"",h=uf(e.geometry),p=e.geometry,f=i.getNearestCoordinate(p,v),m=i.getNearestCoordinate(p,v);m.distance<3*y.distance&&(f.coordinate=m.coordinate),h.push(f.coordinate),yield im(n,o,h,a,t).then(i=>Mg(this,void 0,void 0,function*(){const h=Math.min(...i),p=Math.max(...i);yield im(n,o,[f.coordinate],a,t).then(i=>{i.forEach(i=>{let m=new Date(Date.now());cf(l)&&m>l?m=Uf(a,n):m.setHours(0,0,0,0);let g=new Date(Date.now());cf(l)&&g>l?g=Uf(l,n):g.setHours(0,0,0,0),cf(l)||(g=null);let v=cf(a)?Uf(a,n):null,y=cf(l)?Uf(l,n):null;u&&d&&""!==s.toRouteId&&t!==s.toRouteId&&(v=s.toRouteFromDate,y=s.toRouteToDate);f.coordinate.hasZ=!0;const S={routeId:u?t:s.routeId,toRouteId:u?s.toRouteId:t,routeName:u?r:s.routeName,toRouteName:u?s.toRouteName:r,lineId:s.lineId,toLineId:s.toLineId,lineName:s.lineName,routeLineOrder:u?c:s.routeLineOrder,toRouteLineOrder:u?s.toRouteLineOrder:c,fromMeasure:u?hg(h,o.measurePrecision):s.fromMeasure,toMeasure:u?hg(p,o.measurePrecision):s.toMeasure,toRouteFromMeasure:u?s.toRouteFromMeasure:hg(h,o.measurePrecision),toRouteToMeasure:u?s.toRouteToMeasure:hg(p,o.measurePrecision),selectedMeasure:u?hg(i,o.measurePrecision):s.selectedMeasure,selectedToMeasure:u?s.selectedToMeasure:hg(i,o.measurePrecision),fromDate:u?cf(a)?Uf(a,n):null:s.fromDate,toDate:u?cf(l)?Uf(l,n):null:s.toDate,toRouteFromDate:v,toRouteToDate:y,selectedFromDate:s.selectedFromDate,selectedToDate:s.selectedToDate,selectedPoint:u?f.coordinate:s.selectedPoint,selectedToPoint:u?s.selectedToPoint:f.coordinate,selectedPolyline:e.geometry,selectedToPolyline:u?s.selectedToPolyline:e.geometry,validRoute:!!u||s.validRoute,validToRoute:!u||s.validToRoute};_.push(S)})})}))}})))})).then(()=>{_.length>1?g(_):1===_.length&&((e,t=!1)=>{m(e,t),T()})(_[0],!0)}).finally(()=>{c&&(S.popupEnabled=!1),R(),f(),E.current=!1}).catch(()=>{R(),f(),E.current=!1})})))}catch(e){console.error("Error in pointerClickHandler",e)}r()})});return(0,zu.jsx)(pg.CalciteButton,{scale:"s",iconStart:"select",css:Kf(),disabled:!!a||void 0,appearance:r?"solid":"transparent",kind:r?"brand":"neutral",onClick:()=>{f()}})}var jg=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Fg(e){const t=i.hooks.useTranslation(c),{isOpen:r,routeInfos:n,useRouteName:o,measurePrecision:s,isFrom:a,jimuMapView:l,graphicLayer:u,showMeasure:d=!0,onRouteSelect:h,onRouteSelectCancel:p}=e,f=16,m=i.React.useRef(null),[g,v]=i.React.useState({x:0,y:0}),[y,S]=i.React.useState({width:500,height:250});i.React.useEffect(()=>{if(n.length){m.current=n[0];const e=R(),t=T();if(S({width:t,height:e}),I(a,0),cf(l)&&cf(l.view)){const e=a?n[0].selectedPoint:n[0].selectedToPoint;if(cf(e)){const t=null==l?void 0:l.view.toScreen(e);if(t){const e=g;e.x=t.x+f,e.y=t.y+f;const r=b(t.x,t.y,null==l?void 0:l.view);r&&(e.x=r.x+f,e.y=r.y+f),v(e)}}}}},[n]);const I=(e,t)=>jg(this,void 0,void 0,function*(){if(cf(u)){if(u.removeAll(),e&&cf(n[t].selectedPolyline)){const e=yield Lg(yield xg(n[t].selectedPolyline),N.colorCyan,6);u.add(e)}if(!e&&cf(n[t].selectedToPolyline)){const e=yield Lg(yield xg(n[t].selectedToPolyline),N.colorCyan,6);u.add(e)}}}),w=()=>{cf(u)&&u.removeAll()},E=()=>{w(),p()},b=(e,t,r)=>{if(!r)return;const n=T(),i=R(),o=e>=0&&t>=0&&e+n<=window.innerWidth&&t+i<=window.innerHeight,s=r.width-e+32,a=r.height-t+32;return o?null:(e+n>window.innerWidth&&(e=window.innerWidth-n-s),t+i>window.innerHeight&&(t=window.innerHeight-i-a),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},R=i.React.useCallback(()=>{const e=250;return 2===n.length?e:3===n.length?290:4===n.length?330:n.length>=5?370:e},[n]),T=i.React.useCallback(()=>o?700:500,[o]),O=i.React.useCallback(e=>{v(e)},[]),C=i.React.useCallback((e,t)=>{const r=R(),n=T();e.height<=r&&(e.height=r),e.width<=n&&(e.width=n),e.height>370&&(e.height=370),e.width>700&&(e.width=700),S(e),v(t)},[R,T]);return(0,zu.jsx)("div",{children:r&&(0,zu.jsx)($p.FloatingPanel,{headerTitle:t("selectRouteLabel"),size:y,defaultPosition:g,position:g,disableActivateOverlay:!1,dragBounds:"body",onDrag:O,onResize:C,onLeave:E,onHeaderClose:E,children:(0,zu.jsxs)("div",{css:Jf(),children:[(null==n?void 0:n.length)&&(0,zu.jsxs)(pg.CalciteTable,{selectionDisplay:"none",pageSize:5,caption:t("routePicker"),striped:!0,bordered:!0,"selection-mode":"single",scale:"s",children:[(0,zu.jsxs)("calcite-table-row",{slot:"table-header",children:[o&&(0,zu.jsx)("calcite-table-header",{heading:t("routeNameLabel")}),(0,zu.jsx)("calcite-table-header",{heading:t("routeIdLabel")}),(0,zu.jsx)("calcite-table-header",{heading:t("fromDateLabel")}),(0,zu.jsx)("calcite-table-header",{heading:t("toDateLabel")}),d&&(0,zu.jsx)("calcite-table-header",{heading:t("measureLabel")})]}),n.map((e,t)=>(0,zu.jsxs)(pg.CalciteTableRow,{selected:0===t,onCalciteTableRowSelect:()=>{(e=>{I(a,e),m.current=n[e]})(t)},children:[o&&(0,zu.jsx)("calcite-table-cell",{style:{minWidth:"200px"},children:(0,zu.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"},children:a?e.routeName:e.toRouteName})}),(0,zu.jsx)("calcite-table-cell",{style:{minWidth:"200px"},children:(0,zu.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"},children:a?e.routeId:e.toRouteId})}),(0,zu.jsx)("calcite-table-cell",{style:{minWidth:"100px"},children:(0,zu.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"},children:cf(e.fromDate)?e.fromDate.toLocaleDateString():""})}),(0,zu.jsx)("calcite-table-cell",{style:{minWidth:"100px"},children:(0,zu.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"},children:cf(e.toDate)?e.toDate.toLocaleDateString():""})}),d&&(0,zu.jsx)("calcite-table-cell",{style:{minWidth:"100px"},children:(0,zu.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"},children:hg(a?e.selectedMeasure:e.selectedToMeasure,s)})})]},t))]}),(0,zu.jsxs)("div",{className:"pt-1 d-flex justify-content-center",children:[(0,zu.jsx)($p.Button,{className:"mr-2",style:{width:"100px"},type:"secondary",onClick:E,children:t("cancel")}),(0,zu.jsx)($p.Button,{className:"ml-2",style:{width:"100px"},type:"primary",onClick:()=>{w(),cf(m.current)&&h(m.current)},children:t("ok")})]})]})})})}const Ug=function(e){return null===e};function Bg(e,t,r,n){const i={hasError:!1,message:""};let o=[];if(cf(r)){const e=r;o=null==e?void 0:e.layer.fields}else cf(n)&&o.push(n);const s=o.find(e=>e.name===t);if(s){if(!cf(e)&&s.nullable)return i;if(cf(e)||s.nullable||(i.hasError=!0,i.message="nonNullable"),"string"==typeof e&&0===e.length&&s.nullable)return i;"string"!=typeof e||0!==e.length||s.nullable||(i.hasError=!0,i.message="nonNullable"),"small-integer"===s.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-32768||t>32767)return!1;return!0}(e)||(i.hasError=!0,i.message="invalidShort"):"integer"===s.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-2147483648||t>2147483647)return!1;return!0}(e)||(i.hasError=!0,i.message="invalidInteger"):"single"===s.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(i.hasError=!0,i.message="invalidSingle"):"double"===s.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(i.hasError=!0,i.message="invalidDouble"):"string"===s.type?function(e,t){if(cf(e)&&e.length>t)return!1;return!0}(e,s.length)||(i.hasError=!0,i.message="invalidString"):"date"===s.type&&(function(e){return!isNaN(Date.parse(e))}(e)||(i.hasError=!0,i.message="invalidDate"))}return i}function Vg(e,t,r,n){const i={hasError:!1,message:""};let o=[];if(cf(r)){const e=r;o=null==e?void 0:e.layer.fields}else cf(n)&&o.push(n);const s=o.find(e=>e.name===t),a=s.domain;if(cf(s)&&cf(a)&&"range"===s.domain.type){const t=a;if(s.nullable&&(Ug(e)||!cf(e)||""===e))return i;if("number"==typeof t.minValue&&"number"==typeof t.maxValue){const r=Number(e);isNaN(r)&&(i.hasError=!0,i.message="invalidRange"),(r<t.minValue||r>t.maxValue)&&(i.hasError=!0,i.message="invalidRange")}else if("string"==typeof t.minValue&&"string"==typeof t.maxValue&&"string"==typeof e){const r=new Date(e),n=new Date(t.minValue),o=new Date(t.maxValue);(r<n||r>o)&&(i.hasError=!0,i.message="invalidRange")}}return i}function Gg(e){return"date"===e}function $g(e){return"small-integer"===e||"big-integer"===e||"integer"===e||"single"===e||"double"===e||"long"===e}function Hg(e){return"coded-value"===e}function Wg(e){return"range"===e}function zg(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function qg(){return zg()+zg()+"-"+zg()+"-"+zg()+"-"+zg()+"-"+zg()+zg()+zg()}var Jg=m(28996),Kg=m.n(Jg);const Yg=i.React.memo(e=>{var t,r;const n=i.hooks.useTranslation(c),{validValues:o,fieldInfo:s,isSubtype:a,eventDS:l,selected:u,onSelectionChange:d,onUpdateItem:h}=e,[p,f]=i.React.useState(s.value),[m,g]=i.React.useState(""),[v,y]=i.React.useState(s.error);i.React.useEffect(()=>{if(cf(s)){if(f(s.value),y(s.error),"contingentValueError"===s.error&&y(n("contingentValueError")),cf(S.domain)&&Hg(S.domain.type))if(cf(s.value)){const e=I.codedValues.find(e=>"string"==typeof e.code&&"string"==typeof s.value?e.code.toLowerCase()===s.value.toLowerCase():e.code===s.value);cf(e)?(g(T(e.code,e.name)),y("")):(g(s.value),y("Invalid value."))}else g("");if(a){const e=w.find(e=>"string"==typeof e.value?e.value.toLowerCase()===s.value.toLowerCase():e.value===s.value);g(e?T(e.value,e.label):"")}}},[l,s]);const S=i.React.useMemo(()=>{const e=l,t=(null==e?void 0:e.layer.fields).find(e=>e.name===s.name);return t||(f(t.defaultValue),null)},[l,s]),I=i.React.useMemo(()=>{if(cf(S)&&cf(S.domain)&&"coded-value"===S.domain.type){const e=S.domain.codedValues.some(e=>null===e.code&&e.name===n("nullLabel"));return S.nullable&&!e&&S.domain.codedValues.unshift({code:null,name:n("nullLabel")}),S.domain}return null},[S]),w=i.React.useMemo(()=>{if(a){const e=null==l?void 0:l.layer;if(cf(e)&&cf(e.subtypes)){const t=e.subtypes.map(e=>({value:e.code,label:e.name}));if(t)return t}const t=null==l?void 0:l.getFieldCodedValueList(S.name);if(t)return t}return[]},[l,S.name,a]),E=e=>{if(e.target.value!==p){if(f(e.target.value),cf(s.value)&&cf(S.domain)&&Hg(S.domain.type)){const e=I.codedValues.find(e=>"string"==typeof e.code&&"string"==typeof s.value?e.code.toLowerCase()===s.value.toLowerCase():e.code===s.value);e&&g(T(e.code,e.name))}if(a){const t=w.find(e=>"string"==typeof e.value?e.value.toLowerCase()===s.value.toLowerCase():e.value===s.value);t&&g(T(t.value,t.label)),R(e.target.value,v)}else R(e.target.value,"")}},b=e=>{f(e)},R=(e,t)=>{h(e,t,s.index),d(-1)},T=(e,t)=>cf(e)?`${e} - ${t}`:t;let N=[];return u&&cf(S.domain)&&!a&&Hg(S.domain.type)&&(N=(null===(t=null==e?void 0:e.contingentValues)||void 0===t?void 0:t.length)>0?e.contingentValues.map((e,t)=>{var r;const n=(r=e.code,!(!o||!o.includes(r)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,zu.jsx)("option",{value:e.code,style:n,children:T(e.code,e.name)},t)}):null===(r=null==I?void 0:I.codedValues)||void 0===r?void 0:r.map((e,t)=>(0,zu.jsx)("option",{value:e.code,children:T(e.code,e.name)},t))),(0,zu.jsxs)("div",{className:"attribute-table-field",style:{border:v.length?"1.2px solid red":"none"},children:[!u&&(0,zu.jsxs)("div",{onClick:()=>{s.editable&&d(s.index)},style:{borderRight:v.length?"6px solid red":"none",display:"flex",alignItems:"center"},children:[(0,zu.jsx)($p.Label,{size:"sm",className:"w-100 label2",centric:!0,style:{textOverflow:"ellipsis",width:100,marginBottom:0,textAlign:"left"},children:a||cf(S.domain)&&Hg(S.domain.type)?cf(p)?m:n("nullLabel"):"string"==typeof p&&p.length?p:"number"!=typeof p||isNaN(p)?cf(p)&&"date"===S.type?new Date(p).toLocaleDateString():n("nullLabel"):p.toString()}),(0,zu.jsx)("span",{style:{margin:"0.1rem"},children:v.length>0&&(0,zu.jsx)($p.Icon,{icon:Kg(),size:16,title:v,color:"red"})})]}),u&&!cf(S.domain)&&!a&&!Gg(S.type)&&(0,zu.jsx)($p.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!S.nullable,value:p,type:"text",onChange:e=>{b(e.currentTarget.value)},checkValidityOnAccept:e=>{if(!cf(e)||s.value===e||!cf(s.value)&&!e.length||s.contingentValError)return s.error.length?{valid:!1,msg:n(s.error)}:{valid:!0};const t=Bg(e,s.name,l);return t.hasError?(y(n(t.message)),"contingentValueError"===s.error&&y(n("contingentValueError")),R(e,t.message),{valid:!1,msg:n(t.message)}):(y(""),R(e,""),{valid:!0})}}),u&&!cf(S.domain)&&!a&&Gg(S.type)&&(0,zu.jsx)(pg.CalciteInputDatePicker,{scale:"s",valueAsDate:cf(p)?new Date(p):null,onCalciteInputDatePickerChange:e=>{var t,r;const i=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(s.value===i)return s.error.length?{valid:!1,msg:n(s.error)}:{valid:!0};const o=Bg(null===(r=e.target)||void 0===r?void 0:r.valueAsDate,s.name,l);return o.hasError?(y(n(o.message)),"contingentValueError"===s.error&&y(n("contingentValueError")),R(i,o.message),{valid:!1,msg:n(o.message)}):(y(""),R(i,""),{valid:!0})},placement:"top",overlayPositioning:"fixed"}),u&&cf(S.domain)&&!a&&Hg(S.domain.type)&&(0,zu.jsx)($p.Select,{size:"sm",className:"w-100",value:p,onChange:e=>{E(e)},children:N}),u&&a&&(0,zu.jsx)($p.Select,{size:"sm",className:"w-100",value:p,onChange:e=>{E(e)},children:w.map((e,t)=>(0,zu.jsx)("option",{value:e.value,children:T(e.value,e.label)},t))}),u&&cf(S.domain)&&Wg(S.domain.type)&&(0,zu.jsx)($p.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!S.nullable,value:p,onChange:e=>{b(e.currentTarget.value)},checkValidityOnAccept:e=>{if(s.value===e)return s.error.length?{valid:!1,msg:n(s.error)}:{valid:!0};const t=Vg(e,s.name,l);return t.hasError?(y(n(t.message)),"contingentValueError"===s.error&&y(n("contingentValueError")),R(e,t.message),{valid:!1,msg:n(t.message)}):(y(""),R(e,""),{valid:!0})}})]})}),Xg=Yg;var Qg=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const Zg=m(8547),ev=i.React.memo(e=>{const t=i.hooks.useTranslation(c),{tableIndex:r,eventDS:n,eventLayer:o,fieldInfos:s,useAlias:a,collapable:l,isExpanded:u,onItemChecked:d,onUpdateItem:h,onUpdateAll:p,onFieldGrpUpdated:f,tableLabel:m,isReset:g}=e,[v,y]=i.React.useState(!1),[S,I]=i.React.useState(""),[w,E]=i.React.useState(null),[b,R]=i.React.useState(NaN),[T,O]=i.React.useState(NaN),[C,L]=i.React.useState(u),[A,D]=i.React.useState(-1),_=i.React.useRef([]),P=i.React.useMemo(()=>{if(cf(n)){const e=null==n?void 0:n.layer;if(cf(e)&&cf(e.subtypes)&&(null==e?void 0:e.subtypes.length)>0)return y(!0),I(e.subtypeField),e.subtypes}return[]},[n]);i.React.useEffect(()=>{D(-1),O(-1),Qg(void 0,void 0,void 0,function*(){let t;const i=null==n?void 0:n.layer,o=yield(0,N.fetchEnterpriseFieldGroup)(i);if((null==o?void 0:o.length)>0){t=yield o.map(e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map(e=>(0,N.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase()))}));const n=yield(0,N.fetchEnterpriseContingentValues)(i),a=(0,N.setContingentValues)(n,t,i,b),l=(0,N.validateContingencyConstraints)(-1,"",-1,s,a);if((null==l?void 0:l.length)>0){const t=[];for(let e=0;e<(null==l?void 0:l.length);e++){const r=l[e];t.push(null==r?void 0:r.fieldGroup)}e.onFieldGrpUpdated(t,r)}else e.onFieldGrpUpdated([],r);E(a)}else E([])})},[n]),i.React.useEffect(()=>{g&&(O(-1),D(-1))},[g]),i.React.useEffect(()=>{if(cf(s)&&v){const e=s.find(e=>e.name.toLowerCase()===S.toLowerCase());e&&e.value!==b&&R(e.value)}A>-1&&cf(_.current)&&(_.current[A].setFocus(),D(-1))},[s]),i.React.useEffect(()=>{L(u)},[u]),i.React.useEffect(()=>{if(!isNaN(b)&&cf(P)){const e=P.findIndex(e=>e.code===b);if(e>-1){const t=P[e].defaultValues,r=_s(s);let n;for(n in t){const e=r.findIndex(e=>e.name===n);e>-1&&(Gg(r[e].type)?r[e].value=cf(t[n])?new Date(t[n]):null:n.toLowerCase()===S.toLowerCase()?r[e].value=b:r[e].value=t[n],r[e].error="")}k(r)}}},[b]);const x=(e,t,n)=>{const i=_s(s);i[e].value=t,i[e].error=n,w.forEach(e=>{const t=null==e?void 0:e.fields;null==i||i.forEach(e=>{const r=null==e?void 0:e.name;t.includes(r)&&(e.error="",e.contingentValError=!1)})});const o=(0,N.validateContingencyConstraints)(t,n,e,s,w);if((null==o?void 0:o.length)>0){const e=[];for(let t=0;t<(null==o?void 0:o.length);t++){const r=o[t];e.push(null==r?void 0:r.fieldGroup)}null==e||e.forEach(e=>{const t=null==e?void 0:e.fields;null==i||i.forEach(e=>{const r=null==e?void 0:e.name;t.includes(r)&&(e.error="contingentValueError",e.contingentValError=!0)})}),f(e,r)}else f([],r);p(i,r)},M=(e,t,n)=>{if(v){s[n].name.toLowerCase()===S.toLowerCase()?R(e):(null==w?void 0:w.length)>0?x(n,e,t):h(e,t,n,r)}else(null==w?void 0:w.length)>0?x(n,e,t):h(e,t,n,r);D(n)},k=e=>{p(e,r)},j=e=>{const r=cf(e.error)&&e.error.length,n=cf(e.default)&&e.default.length>0,i=cf(e.length)&&!isNaN(e.length);let o=e.type;return i&&(o=t("fieldTypeWithLength",{fieldType:e.type,length:e.length})),r?t("fieldInfoWithError",{name:e.name,alias:e.alias,type:o,nullable:e.nullable?t("trueKey"):t("falseKey"),default:n?e.default.toString():t("nullLabel"),editable:e.editable?t("trueKey"):t("falseKey"),error:"contingentValueError"===e.error?"Invalid contingent value in the field":t(e.error)}):t("fieldInfo",{name:e.name,alias:e.alias,type:o,nullable:e.nullable?t("trueKey"):t("falseKey"),editable:e.editable?t("trueKey"):t("falseKey"),default:n?e.default.toString():t("nullLabel")})},F=e=>{O(e),cf(_.current)&&A>-1&&_.current[A].setFocus()},U=e=>{const t=[];if(!(0,N.fieldsWithContingentValues)(w).has(e.name))return[];if(!w||0===w.length||!s||0===s.length)return[];const r=[];if((null==w?void 0:w.length)>0)for(const n of w){const i=null==n?void 0:n.contingencies,o=null==n?void 0:n.fields;if(i&&(null==o?void 0:o.includes(e.name)))for(const n of i){let i=null,o=!1;const a=Object.keys(n.values);null==a||a.forEach(t=>{const r=n.values[t];if(t===e.name)"code"===r.objectType&&(i=r.codedValue.code);else if("code"===r.objectType){const e=r.codedValue.code;s.some(r=>{if(r.name===t){const t=r.value;return(t===e||null===t)&&(o=!0),!0}return!1})}}),null!==i&&(o?t.push(i):r.push(i))}}return t};return(0,zu.jsxs)("div",{className:"attributes-table w-100 pt-3 px-3",css:i.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `,children:[l&&(0,zu.jsxs)($p.Label,{size:"sm",className:"event-layer-label title3",centric:!0,check:!0,style:{textOverflow:"ellipsis"},children:[(0,zu.jsx)($p.Checkbox,{checked:C,className:"event-layer-checkbox mr-2",onChange:(e,t)=>{d(t,r),L(t)}}),null==o?void 0:o.name]}),!l&&(0,zu.jsx)($p.Label,{size:"sm",className:"text-truncate w-100 mb-0 title3",centric:!0,style:{textOverflow:"ellipsis"},children:cf(m)?m:null==o?void 0:o.name}),(0,zu.jsxs)(pg.CalciteTable,{caption:"Attribute Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:l&&!C,children:[(0,zu.jsxs)(pg.CalciteTableRow,{slot:"table-header",children:[(0,zu.jsx)(pg.CalciteTableHeader,{heading:t("attribute")}),(0,zu.jsx)(pg.CalciteTableHeader,{heading:t("value")})]}),cf(s)&&s.map(e=>(0,zu.jsxs)(pg.CalciteTableRow,{children:[(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",children:(0,zu.jsxs)("div",{className:"w-100 d-flex",children:[(0,zu.jsx)($p.Label,{title:j(e),size:"sm",className:"text-truncate label2",centric:!0,style:{textOverflow:"ellipsis",marginBottom:0,textAlign:"left"},children:a?e.alias:e.name}),!e.editable&&(0,zu.jsx)($p.Icon,{className:"ml-auto my-auto",icon:Zg,size:16,style:{alignItems:"center"}})]})}),(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",ref:t=>{_.current[e.index]=t},onKeyDown:t=>{((e,t)=>{"Enter"===e.key&&O(t)})(t,e.index)},style:{border:"2px solid red"},children:(0,zu.jsx)(Xg,{validValues:U(e),contingentValues:(0,N.getContingentOptions)(e.name,w),fieldGroups:w,eventDS:n,isSubtype:e.name.toLowerCase()===S.toLowerCase(),fieldInfo:e,useAlias:a,selected:T===e.index,onSelectionChange:F,onUpdateItem:M})})]},e.index))]})]})}),tv=(0,n.withTheme)((0,n.withStyles)(ev,"AttributeTable"));var rv=m(23001),nv=m.n(rv),iv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const ov=e=>{const t=window.SVG,{className:r}=e,n=iv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:nv()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var sv=m(35737),av=m.n(sv),lv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const cv=e=>{const t=window.SVG,{className:r}=e,n=lv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:av()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))},uv=i.css`
  .esri-widget__heading {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    color: var(--ref-palette-black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`,dv=i.React.memo(e=>{const t=i.hooks.useTranslation(c),{intl:r,network:n,isReset:o,concurrenciesLocation:s,concurrenciesDateRange:a,onConcurrenciesLocationUpdated:l,locationConcurrency:u}=e,[d,h]=i.React.useState(!0),[p,f]=i.React.useState([]),[m,g]=i.React.useState(null);i.React.useEffect(()=>{const e=[];let t,r;s.concurrencies.forEach(n=>{n.fromDate===(null==a?void 0:a.fromDate)&&n.toDate===(null==a?void 0:a.toDate)&&u.sectionId===n.sectionId&&(e.push(n),n.isDominant&&(t=n),n.isChosen&&(r=n))}),1===e.length?g(e[0]):g(r||t),f(e)},[s,a]);i.React.useEffect(()=>{o&&(null==s||s.concurrencies.forEach(e=>{e.isDominant&&e.fromDate===a.fromDate&&e.toDate===(null==a?void 0:a.toDate)&&u.sectionId===e.sectionId&&g(e)}))},[o]);return(0,zu.jsxs)("div",{className:"concurrencies-table w-100 pt-3 px-3",css:i.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `,children:[(0,zu.jsx)("hr",{css:i.css`
          border: none;
          height: 1px;
          background-color: var(--ref-palette-neutral-400);
        `}),(0,zu.jsxs)("div",{className:"item-feature-info-component d-flex align-items-center p-2",css:uv,children:[(0,zu.jsx)($p.Button,{"aria-label":r.formatMessage({id:d?"collapse":"expand"}),className:(0,i.classNames)("p-0 jimu-outline-inside",{expanded:d}),type:"tertiary",icon:!0,size:"sm",onClick:e=>{((e,t)=>{e.stopPropagation(),e.target&&h(t)})(e,!d)},children:d?(0,zu.jsx)(cv,{size:"s"}):(0,zu.jsx)(ov,{size:"s",autoFlip:!0})}),(0,zu.jsx)("div",{className:"flex-grow-1",style:{fontWeight:500},children:t("measureAndRouteName",{measure:hg(u.fromMeasure,n.measurePrecision),routeName:cf(u.routeName)?u.routeName:u.routeId})})]}),(0,zu.jsxs)("div",{className:"selected-route mb-3",hidden:!d,children:[(0,zu.jsx)("div",{children:(0,zu.jsx)($p.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100",style:{textOverflow:"ellipsis"},children:t("selectedRouteName")})}),(0,zu.jsx)("div",{children:(0,zu.jsx)($p.Select,{size:"sm",css:(v=(null==m?void 0:m.isDominant)&&!(null==m?void 0:m.isAdded),i.React.useMemo(()=>v?i.css`
        .jimu-dropdown-button {
          color: blue;
        }
      `:i.css``,[v])),value:m,onChange:e=>{(e=>{var t;const r=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;g(r),s.concurrencies.forEach(e=>{e.fromDate===(null==r?void 0:r.fromDate)&&e.toDate===(null==r?void 0:r.toDate)&&(e.routeId===r.routeId?e.isChosen=!0:e.isChosen=!1)}),l(s)})(e)},disabled:p.length<2,children:null==p?void 0:p.map((e,t)=>(0,zu.jsx)(Option,{title:cf(e.routeName)?e.routeName:e.routeId,value:e,label:cf(e.routeName)?e.routeName:e.routeId,style:e.isDominant?{color:"#0000ff"}:{},children:cf(e.routeName)?e.routeName:e.routeId},t))})})]}),(0,zu.jsx)(pg.CalciteTable,{caption:"Concurrency Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:!d,children:(0,zu.jsxs)(pg.CalciteTableRow,{children:[(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",children:(0,zu.jsx)("div",{className:"w-100 d-flex",children:(0,zu.jsx)($p.Label,{title:t("selectedRouteMeasure",{units:af(n.unitsOfMeasure,r)}),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t("selectedRouteMeasure",{units:af(n.unitsOfMeasure,r)})})})}),(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",style:{border:"2px solid red"},children:hg(null==m?void 0:m.fromMeasure,n.measurePrecision)})]},0)})]});var v}),hv=(0,n.withTheme)((0,n.withStyles)(dv,"PointConcurrencyTable"));var pv=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const fv=i.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    .item-feature-info-component {
      border-color: var(--sys-color-primary-main);
      border-width: 2px;
    }
  }

  .esri-widget__heading {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    color: var(--ref-palette-black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`,mv=i.React.memo(e=>{const t=i.hooks.useTranslation(c),{intl:r,network:n,isReset:o,concurrenciesLocation:s,concurrenciesDateRange:a,onConcurrenciesLocationUpdated:l,locationConcurrency:u,networkDS:d,pickedConcurrencyGraphic:h}=e,[p,f]=i.React.useState(!0),[m,g]=i.React.useState([]),[v,y]=i.React.useState(null);i.React.useEffect(()=>{const e=[];let t,r;s.concurrencies.forEach(n=>{n.fromDate===(null==a?void 0:a.fromDate)&&n.toDate===(null==a?void 0:a.toDate)&&u.sectionId===n.sectionId&&(e.push(n),n.isDominant&&(t=n),n.isChosen&&(r=n))}),1===e.length?y(e[0]):y(r||t),g(e)},[s,a]);i.React.useEffect(()=>{o&&(null==s||s.concurrencies.forEach(e=>{e.isDominant&&e.fromDate===a.fromDate&&e.toDate===(null==a?void 0:a.toDate)&&u.sectionId===e.sectionId&&y(e)}))},[o]);const S=e=>{cf(e)?(h.removeAll(),h.add(e)):cf(h)&&h.removeAll()},I=i.React.useCallback((e,t,r,i)=>pv(void 0,void 0,void 0,function*(){const o=yield um(d,n,e,e,i,t.toString(),r.toString());S(yield Lg(yield xg(o),N.colorRed))}),[]);return(0,zu.jsxs)("div",{className:"concurrencies-table w-100 pt-3 px-3",css:i.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `,children:[(0,zu.jsx)("hr",{css:i.css`
          border: none;
          height: 1px;
          background-color: var(--ref-palette-neutral-400);
        `}),(0,zu.jsxs)("div",{className:"item-feature-info-component d-flex align-items-center p-2",css:fv,onClick:()=>{I(u.routeId,u.fromMeasure,u.toMeasure,u.fromDate)},children:[(0,zu.jsx)($p.Button,{"aria-label":r.formatMessage({id:p?"collapse":"expand"}),className:(0,i.classNames)("p-0 jimu-outline-inside",{expanded:p}),type:"tertiary",icon:!0,size:"sm",onClick:e=>{((e,t)=>{e.stopPropagation(),e.target&&f(t)})(e,!p)},children:p?(0,zu.jsx)(cv,{size:"s"}):(0,zu.jsx)(ov,{size:"s",autoFlip:!0})}),(0,zu.jsx)("div",{className:"flex-grow-1",style:{fontWeight:500},children:t("fromToMeasuresAndRouteName",{fromMeasure:hg(u.fromMeasure,n.measurePrecision),toMeasure:hg(u.toMeasure,n.measurePrecision),routeName:cf(s.routeName)?s.routeName:s.routeId})})]}),(0,zu.jsxs)("div",{className:"selected-route mb-3",hidden:!p,children:[(0,zu.jsx)("div",{children:(0,zu.jsx)($p.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100",style:{textOverflow:"ellipsis"},children:t("selectedRouteName")})}),(0,zu.jsx)("div",{children:(0,zu.jsx)($p.Select,{size:"sm",css:(w=(null==v?void 0:v.isDominant)&&!(null==v?void 0:v.isAdded),i.React.useMemo(()=>w?i.css`
          .jimu-dropdown-button {
            color: blue;
          }
        `:i.css``,[w])),value:v,onChange:e=>{(e=>{var t;const r=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;y(r),s.concurrencies.forEach(e=>{e.fromDate===(null==r?void 0:r.fromDate)&&e.toDate===(null==r?void 0:r.toDate)&&e.sectionId===(null==r?void 0:r.sectionId)&&(e.routeId===r.routeId?e.isChosen=!0:e.isChosen=!1)}),l(s)})(e)},disabled:m.length<2,children:null==m?void 0:m.map((e,t)=>(0,zu.jsx)(Option,{title:cf(e.routeName)?e.routeName:e.routeId,value:e,label:cf(e.routeName)?e.routeName:e.routeId,style:e.isDominant?{color:"#0000ff"}:{},children:cf(e.routeName)?e.routeName:e.routeId},t))})})]}),(0,zu.jsxs)(pg.CalciteTable,{caption:"Concurrency Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:!p,children:[(0,zu.jsxs)(pg.CalciteTableRow,{children:[(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",children:(0,zu.jsx)("div",{className:"w-100 d-flex",children:(0,zu.jsx)($p.Label,{title:t("selectedRouteFromMeasure",{units:af(n.unitsOfMeasure,r)}),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t("selectedRouteFromMeasure",{units:af(n.unitsOfMeasure,r)})})})}),(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",style:{border:"2px solid red"},children:hg(null==v?void 0:v.fromMeasure,n.measurePrecision)})]},0),(0,zu.jsxs)(pg.CalciteTableRow,{children:[(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",children:(0,zu.jsx)("div",{className:"w-100 d-flex",children:(0,zu.jsx)($p.Label,{title:t("selectedRouteToMeasure",{units:af(n.unitsOfMeasure,r)}),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t("selectedRouteToMeasure",{units:af(n.unitsOfMeasure,r)})})})}),(0,zu.jsx)(pg.CalciteTableCell,{alignment:"center",style:{border:"2px solid red"},children:hg(null==v?void 0:v.toMeasure,n.measurePrecision)})]},1)]})]});var w}),gv=(0,n.withTheme)((0,n.withStyles)(mv,"LineConcurrencyTable")),vv=i.React.memo(e=>{const{label:t,isDisabled:r,defaultItem:n,listItems:o,altItemDescriptions:s,onSelectionChanged:a}=e,[l,c]=i.React.useState(!1),u=i.React.useRef(null),d=i.React.useRef(null),[h,p]=i.React.useState(!1);i.React.useEffect(()=>{h&&(d.current&&(0,i.focusElementInKeyboardMode)(d.current,!0),u.current&&u.current.setFocus(),p(!1))},[h]);const f=(e,t)=>s&&(null==s?void 0:s.length)>0?s[e]:t;return(0,zu.jsxs)("div",{className:"inline-editing-dropdown",css:Kf(),children:[t.length>0&&(0,zu.jsx)($p.Label,{size:"sm",centric:!0,className:"text-truncate pb-0 mb-0 pt-3 px-3 w-100 title3",style:{textOverflow:"ellipsis"},children:t}),(!l||r)&&(0,zu.jsxs)("div",{className:"d-flex w-100 px-3",children:[(0,zu.jsx)($p.Label,{size:"sm",centric:!0,className:"text-truncate d-flex pb-0 mb-0 w-100 label2",style:{textOverflow:"ellipsis"},children:(()=>{if(s){const e=o.findIndex(e=>e===n);return e>-1?s[e]:n}return n})()}),(0,zu.jsx)(pg.CalciteButton,{ref:u,className:(0,i.classNames)("inline-editing-edit__action",{"d-none":1===o.length||r}),scale:"s",disabled:r||o.length<=1,iconStart:"pencil",appearance:"transparent",kind:"neutral",onClick:()=>{p(!0),c(!0)}})]}),l&&(0,zu.jsxs)("div",{className:"d-flex w-100 px-3",children:[(0,zu.jsx)($p.Select,{ref:d,className:"w-100",size:"sm",value:n,onChange:e=>{var t;t=e.target.value,p(!0),c(!1),a(t)},children:o.map((e,t)=>(0,zu.jsxs)("option",{value:e,children:[" ",f(t,e)]},t))}),(0,zu.jsx)(pg.CalciteButton,{scale:"s",iconStart:"x",appearance:"transparent",kind:"neutral",onClick:()=>{p(!0),c(!1)}})]})]})}),yv=(e,t)=>{var r,n,o,s,a,l,c,u,d,h,p,f,m,g,v;return i.css`
    & {
      width: ${i.polished.rem(null===(r=null==t?void 0:t.current)||void 0===r?void 0:r.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${i.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${i.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--sys-color-surface-paper);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(o=null===(n=null==e?void 0:e.sys.color)||void 0===n?void 0:n.primary)||void 0===o?void 0:o.dark};
      background-color: ${null===(a=null===(s=null==e?void 0:e.ref.palette)||void 0===s?void 0:s.neutral)||void 0===a?void 0:a[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(l=null==e?void 0:e.ref.palette)||void 0===l?void 0:l.black};
      background-color: ${null===(u=null===(c=null==e?void 0:e.ref.palette)||void 0===c?void 0:c.neutral)||void 0===u?void 0:u[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==e?void 0:e.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(p=null===(h=null==e?void 0:e.ref.palette)||void 0===h?void 0:h.neutral)||void 0===p?void 0:p[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(f=null==e?void 0:e.sys.color)||void 0===f?void 0:f.primary.main};
      color: ${null===(m=null==e?void 0:e.ref.palette)||void 0===m?void 0:m.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(g=null==e?void 0:e.ref.palette)||void 0===g?void 0:g.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(v=null==e?void 0:e.ref.palette)||void 0===v?void 0:v.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${i.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${i.polished.rem(40)};
      margin-top: ${i.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${i.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--sys-color-surface-paper-text) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${i.polished.rem(11)};
        min-height: ${i.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${i.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${i.polished.rem(8)};
          min-height: ${i.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${i.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--theme.sys.color.surface.background);
      }
    }
  `},Sv=[0,3],{useEffect:Iv,useRef:wv}=i.React,Ev=e=>{const t=wv(null),r=wv(null),{children:o,isOpen:s,reference:a,searchInputRef:l,autoFocus:c,className:u,isFocusWidtSearchInput:d,id:h,offset:p,version:f,toggle:m}=e,g=(0,n.useTheme)(),v=i.ReactRedux.useSelector(e=>{var t;const r=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==r?void 0:r[h])||void 0===t?void 0:t.state});Iv(()=>{var e;return(null==l?void 0:l.current)&&d&&(null===(e=l.current)||void 0===e||e.addEventListener("keydown",y,!0)),()=>{var e;d&&(null===(e=l.current)||void 0===e||e.removeEventListener("keydown",y,!0))}},[]);const y=i.hooks.useEventCallback(e=>{if(!s)return!1;const t=w()||[],n=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?r.current=setTimeout(()=>{(0,i.focusElementInKeyboardMode)(t[n],!0)}):"ArrowDown"===e.key&&(r.current=setTimeout(()=>{(0,i.focusElementInKeyboardMode)(t[0],!0)}))}),S=i.hooks.useEventCallback(e=>{if(!s)return;const n="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),s&&n))if(clearTimeout(r.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const n=w();let o=n.indexOf(e.target),s=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(o=0!==o?o-1:n.length-1,s=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(s=!1,o=o===n.length-1?0:o+1);const a=0===o&&!s,c=o===n.length-1&&s;r.current=d&&(a||c)?setTimeout(()=>{(0,i.focusElementInKeyboardMode)(l.current,!0)}):setTimeout(()=>{(0,i.focusElementInKeyboardMode)(Array.prototype.slice.call(t.current.querySelectorAll(".popper-box"))[0],!0),(0,i.focusElementInKeyboardMode)(n[o],!0)})}else if("End"===e.key){const e=w();r.current=setTimeout(()=>{(0,i.focusElementInKeyboardMode)(e[e.length-1],!0)})}else if("Home"===e.key){const e=w();r.current=setTimeout(()=>{(0,i.focusElementInKeyboardMode)(e[0],!0)})}else if(e.which>=48&&e.which<=90){const t=w(),n=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===n){r.current=setTimeout(()=>{(0,i.focusElementInKeyboardMode)(t[e],!0)});break}}}}),I=e=>{e.preventDefault(),E(e),(0,i.focusElementInKeyboardMode)(null==l?void 0:l.current)},w=()=>t?Array.prototype.slice.call(t.current.querySelectorAll('[role="button"]')).filter(e=>!e.disabled):[],E=e=>{m(e)};return(0,zu.jsx)("div",{children:(0,zu.jsx)($p.Popper,{autoFocus:c,placement:"bottom-start",open:s,toggle:E,css:yv(g,a),reference:a,version:f,className:(0,i.classNames)("result-list-popper",u,{"hide-popper":v===i.WidgetState.Closed}),offsetOptions:p||Sv,ref:t,children:(0,zu.jsx)("div",{onKeyDown:S,children:o})})})},{useRef:bv}=i.React,Rv=new(0,i.esri.Sanitizer),Tv=i.React.memo(e=>{const t=i.hooks.useTranslation(c),{className:r,reference:o,searchSuggestion:s,isOpen:a,searchText:l,id:u,searchInputRef:d,toggel:h,onRecordItemClick:p}=e,f=(0,n.useTheme)(),m=bv(!1),g=()=>{if((null==s?void 0:s.length)<2)return!1;let e=0,t=0;return null==s||s.forEach(r=>{var n;const i=null==r?void 0:r.icon;i&&(e+=1),(null===(n=r.suggestionItem)||void 0===n?void 0:n.length)>0&&i&&(t+=1)}),t>0&&e>0},v=(e,t=!1)=>{const r=null==e?void 0:e.suggestionItem;return null==r?void 0:r.map((r,n)=>{const o=Rv.sanitize(r.suggestionHtml);return(0,zu.jsx)($p.Button,{className:(0,i.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":t}),title:r.suggestion,role:"button",onClick:()=>{(e=>{p(e)})(r.suggestion)},children:(0,zu.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:o}})},`${null==e?void 0:e.layer}${n}`)})};return(0,zu.jsx)("div",{children:(0,zu.jsxs)(Ev,{isOpen:a,autoFocus:!1,reference:o,searchInputRef:d,isFocusWidtSearchInput:!0,toggle:h,id:u,className:(0,i.classNames)("result-list-con suggestion-list-con",r),children:[(()=>{let e=[];s.forEach(t=>{const r=(null==t?void 0:t.suggestionItem)||[];e=e.concat(r)});return l&&0===e.length})()&&(0,zu.jsx)($p.Button,{role:"button",className:"text-center py-2",disabled:!0,title:t("noResult",{searchText:l}),children:t("noResult",{searchText:l})}),(m.current=null,null==s?void 0:s.map((e,t)=>{var r,n,i;const o=(null==s?void 0:s.length)>1&&(null===(r=null==e?void 0:e.suggestionItem)||void 0===r?void 0:r.length)>0;return(0,zu.jsxs)("div",{role:"group","aria-label":null==e?void 0:e.layer,children:[o&&(0,zu.jsxs)($p.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==e?void 0:e.layer,children:[(null==e?void 0:e.icon)&&(0,zu.jsx)($p.Icon,{className:"mr-2",color:null===(n=null==f?void 0:f.sys.color)||void 0===n?void 0:n.primary.main,size:16,icon:null===(i=null==e?void 0:e.icon)||void 0===i?void 0:i.svg}),null==e?void 0:e.layer]}),v(e,g())]},`${null==e?void 0:e.layer}-${t}`)}))]})})}),Nv=Tv,Ov=i.React.memo(e=>{const{reset:t,widgetId:r,fieldName:n,fieldType:o,dataSource:s,isDataSourceReady:a,defaultValue:l,value:u,onChange:d,onAccept:h}=e,p=i.hooks.useTranslation(c),f=i.React.useRef(null),m=i.React.useRef(e=>{}),g=i.React.useRef(null!=l?l:null),v=i.React.useRef(null),y=i.React.useRef(null),S=i.React.useRef(null),I=i.React.useRef(!1),w=i.React.useRef(!1),[E,b]=i.React.useState(null!=l?l:null),[R,T]=i.React.useState(!1),[N,O]=i.React.useState([]);i.React.useEffect(()=>{b(null),A(null),setTimeout(()=>{g.current=null,S.current=null,v.current&&(v.current.select(),(0,i.focusElementInKeyboardMode)(v.current,!0),v.current.blur())},200)},[t]),i.React.useEffect(()=>{u!==E&&(D(u),v.current&&(v.current.value=u))},[u]),i.React.useEffect(()=>{m.current=kn(L,400)},[]);const C=i.React.useMemo(()=>s,[s]),L=i.hooks.useEventCallback(e=>{const t=wf(n,e,s);Promise.all([t]).then(e=>{const t=null==e?void 0:e[0];t&&O(t),g.current&&T(!0)}).catch(e=>null)}),A=e=>{cf(g)&&""!==g.current&&""===e&&setTimeout(()=>{v.current&&(v.current.select(),(0,i.focusElementInKeyboardMode)(v.current,!0),v.current.blur(),(0,i.focusElementInKeyboardMode)(v.current,!0))},200)},D=e=>{g.current=e,b(e)},_=()=>{(0,i.focusElementInKeyboardMode)(v.current),P(!0,!1)},P=(e=!1,t=!0)=>{e||(w.current=!1)};return(0,zu.jsx)("div",{className:"route-input",children:(0,zu.jsxs)("div",{ref:f,className:"d-flex w-100",children:[(0,zu.jsx)($p.TextInput,{"aria-label":p("routeIdLabel"),type:"text",className:"w-100",size:"sm",allowClear:!!E,disabled:!a,onBlur:()=>{y.current=setTimeout(()=>{I.current||T(!1),w.current||P(!1)},200)},value:E||"",ref:v,onChange:e=>{var t;S.current=null;const r=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==r?void 0:r.length)>2;if(A(r),D(r),d&&d(r),!n)return T(!1),!1;m.current(r)},checkValidityOnAccept:e=>new Promise(t=>{setTimeout(()=>{S.current&&(e=S.current);const r=C,s={};o===i.JimuFieldType.Number?s.where=`${n} LIKE ${e}`:s.where=`LOWER(${n}) LIKE LOWER('${e}')`;const a=r.queryCount(s).then(t=>0===t.count&&e.length>0?(h(e,!1),{valid:!1,msg:p("invalidRouteField")}):(h(e,!0),{valid:!0})).catch(t=>(h(e,!1),{valid:!1}));t(a)},200)})}),E&&(0,zu.jsx)(Nv,{isOpen:(R||(I.current=!1),R),reference:f,searchText:E,searchSuggestion:N,onRecordItemClick:(e,t)=>{if(t)return _(),!1;S.current=e,D(e)},id:r,searchInputRef:v})]})})}),Cv=Ov;var Lv=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};class Av extends i.React.PureComponent{constructor(e){super(e),this.state={lockInfo:null,toastMsg:"",toastMsgType:"warning",toastOpen:!1}}componentDidUpdate(e){return Lv(this,void 0,void 0,function*(){if(this.props.conflictPreventionEnabled){if(this.hasNullProps())return void this.clearMessage();if(!this.didChange(e))return void this.clearMessage();if(this.doAction())switch(this.props.lockInfo.lockAction){case ym.Acquire:yield this.doAcquireLock();break;case ym.QueryAndAcquire:yield this.doQueryAndAcquireLock();break;case ym.QueryAndRelease:yield this.doQueryAndReleaseLock();break;case ym.Query:yield this.doQueryLock();break;case ym.Release:yield this.doReleaseLock();break;case ym.Clear:this.clearMessage();case ym.None:}else this.clearMessage()}})}clearMessage(){cf(this.props.lockInfo)&&this.props.lockInfo.lockAction===ym.Clear&&(this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.props.onMessageClear&&this.props.onMessageClear())}shouldClearMessageState(){return""===this.state.toastMsg||!(!cf(this.props.lockInfo)||!cf(this.state.lockInfo)||this.props.lockInfo.routeOrLineId===this.state.lockInfo.routeOrLineId||this.props.lockInfo.networkId===this.state.lockInfo.networkId||this.props.lockInfo.eventServiceLayerIds===this.state.lockInfo.eventServiceLayerIds)}hasNullProps(){var e;return!cf(this.props.lockInfo)||(!cf(null===(e=this.props.lockInfo)||void 0===e?void 0:e.routeInfo)||!cf(this.props.featureDS))}didChange(e){var t,r,n,i,o,s,a,l;return!(cf(e.lockInfo)||!cf(this.props.lockInfo))||((null===(r=null===(t=e.lockInfo)||void 0===t?void 0:t.networkId)||void 0===r?void 0:r.toString())!==(null===(i=null===(n=this.props.lockInfo)||void 0===n?void 0:n.networkId)||void 0===i?void 0:i.toString())||((null===(s=null===(o=e.lockInfo)||void 0===o?void 0:o.eventServiceLayerIds)||void 0===s?void 0:s.toString())!==(null===(l=null===(a=this.props.lockInfo)||void 0===a?void 0:a.eventServiceLayerIds)||void 0===l?void 0:l.toString())||(!(cf(e.featureDS)||!cf(this.props.featureDS))||(!(!cf(e.featureDS)||!cf(this.props.featureDS)||e.featureDS.id===this.props.featureDS.id)||(!(cf(e.lockInfo.routeInfo)||!cf(this.props.lockInfo.routeInfo))||(e.lockInfo.routeInfo.routeId!==this.props.lockInfo.routeInfo.routeId||(e.lockInfo.routeInfo.lineId!==this.props.lockInfo.routeInfo.lineId||e.lockInfo.lockAction!==this.props.lockInfo.lockAction)))))))}doAction(){return!!cf(this.props.lockInfo.routeInfo)&&(!(!cf(this.props.lockInfo.routeInfo.routeId)||""===this.props.lockInfo.routeInfo.routeId)&&(!(!cf(this.props.lockInfo.networkId)||0===this.props.lockInfo.networkId.length)&&(!(!cf(this.props.lockInfo.eventServiceLayerIds)||0===this.props.lockInfo.eventServiceLayerIds.length)&&!!cf(this.props.featureDS))))}doQueryLock(){return Lv(this,void 0,void 0,function*(){const e=this.createLockInfoFromParams(),t=yield Im(this.props.featureDS,e,!0);this.setState({lockInfo:e}),this.props.onQueryComplete&&this.props.onQueryComplete(t,!0)})}doQueryAndAcquireLock(){return Lv(this,void 0,void 0,function*(){const e=this.createLockInfoFromParams(),t=yield Im(this.props.featureDS,e,!1);if(Lm(this.props.featureDS,t)){let r=yield wm(this.props.featureDS,t);if(r.acquireStatus===pm.EsriReconcileRequired){(yield Tm(this.props.featureDS))&&(r=yield wm(this.props.featureDS,t))}this.props.showAlert&&this.setAlert(r,t,!0),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&(r.acquireStatus===pm.EsriSuccess?this.props.onQueryAndAcquireComplete(t,r,!0):this.props.onQueryAndAcquireComplete(t,r,!1))}else this.shouldClearMessageState()&&this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&this.props.onQueryAndAcquireComplete(t,null,!0)})}doQueryAndReleaseLock(){return Lv(this,void 0,void 0,function*(){const e=this.createLockInfoFromParams(),t=yield Im(this.props.featureDS,e,!0);for(let r=0;r<t.details.length;r++)yield bm(this.props.featureDS,t.details[r],e);this.setState({lockInfo:e}),this.props.onQueryAndReleaseComplete&&this.props.onQueryAndReleaseComplete(t,!0)})}doAcquireLock(){return Lv(this,void 0,void 0,function*(){const e=this.createLockInfoFromParams();let t=yield wm(this.props.featureDS,e);if(t.acquireStatus===pm.EsriReconcileRequired){(yield Tm(this.props.featureDS))&&(t=yield wm(this.props.featureDS,e))}this.props.showAlert&&this.setAlert(t,e,!0),this.setState({lockInfo:e}),this.props.onAcquireComplete&&(t.acquireStatus===pm.EsriSuccess?this.props.onAcquireComplete(t,!0):this.props.onAcquireComplete(t,!1))})}doReleaseLock(){return Lv(this,void 0,void 0,function*(){const e=this.createLockInfoFromParams(),t=yield Rm(this.props.featureDS,e);this.setState({lockInfo:e}),this.props.onReleaseComplete&&(t.releaseStatus===fm.EsriSuccess?this.props.onReleaseComplete(t,!0):this.props.onReleaseComplete(t,!1))})}createLockInfoFromParams(){var e,t,r,n;if((null===(e=this.props.lockInfo.routeOrLineId)||void 0===e?void 0:e.length)===(null===(t=this.props.lockInfo.eventServiceLayerIds)||void 0===t?void 0:t.length)&&(null===(r=this.props.lockInfo.isLine)||void 0===r?void 0:r.length)===(null===(n=this.props.lockInfo.eventServiceLayerIds)||void 0===n?void 0:n.length)){return{networkId:this.props.lockInfo.networkId,routeOrLineId:this.props.lockInfo.routeOrLineId,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:this.props.lockInfo.isLine,status:pm.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:ym.None}}{const e=[],t=[];this.props.lockInfo.eventServiceLayerIds.forEach((r,n)=>{const i=""!==this.props.lockInfo.routeInfo.lineId&&cf(this.props.lockInfo.routeInfo.lineId);e.push(i?this.props.lockInfo.routeInfo.lineId:this.props.lockInfo.routeInfo.routeId),t.push(i)});return{networkId:this.props.lockInfo.networkId,routeOrLineId:e,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:t,status:pm.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:ym.None}}}getNameOrId(e){return""!==e.lineId&&""===e.lineName?e.lineId:""!==e.lineId&&""!==e.lineName?e.lineName:""!==e.routeName?e.routeName:e.routeId}getNameOrIdFromUnavailableLock(e){return cf(e.routeName)&&""!==e.routeName?e.routeName:cf(e.lineName)&&""!==e.lineName?e.lineName:cf(e.routeId)&&""!==e.routeId?e.routeId:cf(e.lineId)&&""!==e.lineId?e.lineId:void 0}setAlert(e,t,r){var n;let i="",o="info",s="";const a=(null===(n=null==t?void 0:t.details[0])||void 0===n?void 0:n.lrsNetworkName)||this.props.networkName,l=Cf(this.props.featureDS);switch(e.acquireStatus){case pm.EsriSuccess:s=this.getNameOrId(this.props.lockInfo.routeInfo),i=cf(this.props.lockInfo.routeInfo.lineId)&&""!==this.props.lockInfo.routeInfo.lineId?nf(this.props.intl,"YouAcquiredLockOnLine",{nameOrId:s,networkName:a,version:l}):nf(this.props.intl,"YouAcquiredLockOnRoute",{nameOrId:s,networkName:a,version:l}),o="info";break;case pm.EsriReconcileRequired:i=nf(this.props.intl,"ReconcileRequired"),o="error";break;case pm.EsriCouldNotAcquireAllLocks:const t=e.unavailableLocks[0].versionName,n=e.unavailableLocks[0].user;s=this.getNameOrIdFromUnavailableLock(e.unavailableLocks[0]),i=""===t?cf(this.props.lockInfo.routeInfo.lineId)&&""!==this.props.lockInfo.routeInfo.lineId?nf(this.props.intl,"UnavailableLockOnLineWithoutVersion",{nameOrId:s,networkName:a,lockUser:n}):nf(this.props.intl,"UnavailableLockOnRouteWithoutVersion",{nameOrId:s,networkName:a,lockUser:n}):cf(this.props.lockInfo.routeInfo.lineId)&&""!==this.props.lockInfo.routeInfo.lineId?nf(this.props.intl,"UnavailableLockOnLine",{nameOrId:s,networkName:a,lockUser:n,version:t}):nf(this.props.intl,"UnavailableLockOnRoute",{nameOrId:s,networkName:a,lockUser:n,version:t}),o="error";break;default:i="",o="info",r=!1}this.setState({toastMsg:i,toastMsgType:o,toastOpen:r})}render(){const{conflictPreventionEnabled:e}=this.props;return e&&cf(this.props.lockInfo)&&cf(this.props.lockInfo.routeInfo)&&cf(this.props.featureDS)&&this.props.showAlert&&""!==this.state.toastMsg?(0,zu.jsx)($p.Alert,{className:"lock-manager-alert w-100",size:"small",type:this.state.toastMsgType,text:this.state.toastMsg,closable:!0,withIcon:!0,open:this.state.toastOpen,onClose:()=>{this.setState({toastOpen:!1})}}):null}}var Dv=m(4108),_v=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Pv(e){const{config:t,widgetId:r,supportedLrsLayerTypes:n,useMapWidgetIds:o,mapViewsConfig:s,outputDataSourceType:a,onLrsLayersChanged:l,onViewChange:c}=e,[u,d]=i.React.useState(e.jimuMapView),[h,p]=i.React.useState(!1),f=i.React.useRef((0,i.Immutable)([])),m=null==o?void 0:o[0],g=i.React.useMemo(()=>_v(this,void 0,void 0,function*(){if(!u)return Promise.resolve([]);yield u.whenJimuMapViewLoaded(),yield u.whenAllJimuLayerViewLoaded();const e=u.getAllJimuLayerViews(),t=yield Promise.all(e.map(e=>_v(this,void 0,void 0,function*(){return yield e.getOrCreateLayerDataSource()}))),o=(0,N.GetUniqueLrsUrls)(t);if(0===o.size)return Promise.resolve([]);let s=[];for(const[e,a]of o){const o=i.SessionManager.getInstance().getSessionByUrl(e),l=(null==o?void 0:o.token)||"",c=Object.assign({f:"json"},l&&{token:l}),u=t.filter(e=>a.find(t=>t===e.id)),d=(0,N.getAllUseDs)(u,(0,i.Immutable)([])),h=yield(0,N.LoadLayers)(r,c,e,d);s=s.concat(h);const p=(0,N.getUnsupportedLayerIds)(h,n);p.length>0&&(s=s.filter(e=>!p.includes(e.id)))}return Promise.resolve(s)}),[u,n,r]),v=i.React.useCallback((e,t,r)=>_v(this,void 0,void 0,function*(){if(!t)return Promise.resolve((0,i.Immutable)([]));const r=[];yield t.whenJimuMapViewLoaded(),yield t.whenAllJimuLayerViewLoaded();const n=t.getAllJimuLayerViews(),{lrsLayers:o,disabledLayerIds:s}=e||{};for(const e of n){const t=yield g,n=e.id;if(!(0,N.isSupportedJimuLayerView)(e)||!e)continue;const i=e.isLayerVisible(),a=n.indexOf("-"),l=n.substring(a+1),c=(null==s?void 0:s.findIndex(e=>e===l))>-1,u=o&&o.find(e=>e.id===l&&!c),d=t&&t.find(e=>e.id===l&&!c);i&&!c&&(u?r.push(u):d&&r.push(d))}if((null==r?void 0:r.length)>0){const e=r.map(e=>e.id);r.sort((t,r)=>e.indexOf(t.id)-e.indexOf(r.id))}return Promise.resolve((0,i.Immutable)(r))}),[g]),y=i.React.useCallback(e=>{if(f.current.length!==e.length)return f.current=e,!0;return e.filter(e=>-1===f.current.findIndex(t=>t.id===e.id)).length>0&&(f.current=e,!0)},[f]),S=i.React.useCallback(e=>{var n;const o=(0,N.getAllDataSourcesLayer)(e,r,a);if(!o)return;let s=t;(null===(n=null==t?void 0:t.mapViewsConfig)||void 0===n?void 0:n[null==u?void 0:u.id])||(s=t.setIn(["mapViewsConfig",null==u?void 0:u.id],(0,i.Immutable)({lrsLayers:e}))),(0,Dv.getAppConfigAction)().editWidget({id:r,config:s,useDataSources:Object.values(o.useDataSourceMap)},o.outputDataSources).exec()},[r,a,t,u]),I=i.React.useCallback(()=>_v(this,void 0,void 0,function*(){var e,t;if(u){const n=null===(t=null===(e=null==s?void 0:s[null==u?void 0:u.id])||void 0===e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});u&&(yield u.whenJimuMapViewLoaded(),yield u.whenAllJimuLayerViewLoaded());const o=yield v(n,u,r);y(o)&&(S(o),l((0,i.Immutable)(o)))}else l((0,i.Immutable)([]))}),[u,l,s,v,r,y,S]),w=i.React.useCallback(e=>{d(e),c(e)},[c]),E=i.hooks.useLatest(I),b=i.React.useCallback(e=>{var t;null===(t=E.current)||void 0===t||t.call(E)},[E]),R=i.React.useCallback(e=>{var t;null===(t=E.current)||void 0===t||t.call(E)},[E]),T=i.React.useCallback(e=>{var t;e.fromRuntime&&(null===(t=E.current)||void 0===t||t.call(E))},[E]);return i.React.useEffect(()=>{const e=window.setTimeout(I,50);return()=>{window.clearTimeout(e)}},[I]),i.React.useEffect(()=>{if(!u||!u.view)return;u.addJimuLayerViewsVisibleChangeListener(b),u.addJimuLayerViewCreatedListener(R),u.addJimuLayerViewRemovedListener(T);const e=u;return h||(I(),p(!0)),()=>{e&&(e.removeJimuLayerViewsVisibleChangeListener(b),e.removeJimuLayerViewCreatedListener(R),e.removeJimuLayerViewRemovedListener(T))}},[h,u,I,R,T,b]),(0,zu.jsx)(sg.JimuMapViewComponent,{useMapWidgetId:m,onActiveViewChange:w})}var xv=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Mv(e){const{disabled:t,networkDs:r,eventDataSources:n,jimuMapView:o,hoverGraphic:s,onAttributesCopied:a}=e,l=i.hooks.useTranslation(c),u=i.React.useRef(null),d=i.React.useRef(null),[h,p]=i.React.useState(null),f=i.React.useRef(!1),m=i.React.useRef(!1),[g,v]=i.React.useState(!1),[y,S]=i.React.useState();i.React.useEffect(()=>{if(cf(r)){const e=r;cf(null==e?void 0:e.layer)&&p(null==e?void 0:e.layer)}cf(null==o?void 0:o.view)&&S(null==o?void 0:o.view.popupEnabled)},[null==o?void 0:o.view,r]),i.React.useEffect(()=>{g?I():w()},[g]);const I=()=>{u.current=null==o?void 0:o.view.on("pointer-move",T),d.current=null==o?void 0:o.view.on("pointer-down",N)},w=()=>{cf(u.current)&&(u.current.remove(),u.current=null),cf(d.current)&&(d.current.remove(),d.current=null),m.current&&(m.current=!1),f.current&&(f.current=!1)},E=()=>{cf(s)&&s.removeAll()},b=e=>{E(),cf(e)&&s.add(e)},R=(e,t)=>{const r=t.spatialReference,n=t.createQuery(),i="degrees"===r.unit?4:Math.max(3*r.metersPerUnit,3);return n.geometry=e,n.units="meters",n.returnGeometry=!0,n.returnM=!0,n.returnZ=!0,n.distance=(null==o?void 0:o.view.resolution)*i,n.spatialRelationship="intersects",n},T=e=>{cf(h)&&!f.current&&(0,sg.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/time/TimeExtent"]).then(t=>{let n=null,i=null;[n,i]=t,f.current=!0;const s=r.getCurrentQueryParams(),a=null==o?void 0:o.view.toMap(e),l=R(a,h);l.outFields=[],(null==s?void 0:s.time)&&(l.timeExtent=new i({start:s.time[0],end:s.time[1]})),l.gdbVersion=s.gdbVersion,h.queryFeatures(l).then(e=>xv(this,void 0,void 0,function*(){if(e.features.length>0){const t=e.features[0].geometry,r=n.getNearestCoordinate(t,a),i=n.getNearestVertex(t,a);i.distance<3*l.distance&&(r.coordinate=i.coordinate),b(yield Ag(yield Pg(r.coordinate))),f.current=!1}f.current&&(b(null),f.current=!1)}))})},N=e=>(cf(h)&&!m.current&&(e.stopPropagation(),(0,sg.loadArcGISJSAPIModules)(["esri/time/TimeExtent"]).then(t=>xv(this,void 0,void 0,function*(){let r=null;[r]=t,o.view.popupEnabled=!1,m.current=!0;const i=null==o?void 0:o.view.toMap(e),s=[];yield Promise.all(n.map(e=>xv(this,void 0,void 0,function*(){const t=e,n=R(i,null==t?void 0:t.layer);n.outFields=["*"];const o=t.getCurrentQueryParams();(null==o?void 0:o.time)&&(n.timeExtent=new r({start:o.time[0],end:o.time[1]})),n.gdbVersion=o.gdbVersion;const a=yield null==t?void 0:t.layer.queryFeatures(n).then(e=>{const t=[];if(e.features.length>0){const r=e.features[0].attributes;for(const e in r){const n={name:e,value:r[e]};t.push(n)}}return t}),l={layerId:t.layerId,fieldValuePair:a};s.push(l)}))).then(()=>{s.length>0&&a(s)}).finally(()=>{O()}).catch(()=>{O()})}))),Promise.resolve()),O=()=>{v(!1),w(),m.current=!1,setTimeout(()=>{o.view.popupEnabled=y,o.clearSelectedFeatures()},800),E()};return(0,zu.jsx)($p.Tooltip,{title:l("copyAttributes"),children:(0,zu.jsx)(pg.CalciteButton,{scale:"s",css:Kf(),iconStart:"eyedropper",appearance:g?"solid":"outline",kind:"brand",disabled:!!t||void 0,tabIndex:-1,onClick:()=>{v(!g)}})})}var kv=m(79298),jv=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Fv(e){const{intl:t,portalUrl:r,theme:n,widgetId:o,mode:s,useMapWidgetIds:a,lrsLayers:l,mapViewsConfig:c,supportedLrsTypes:u,requiredLrsTypes:d,outputDataSourceWidgetType:h="none",children:p,onLrsLayersUpdated:f,onMapViewsConfigUpdated:m,onMapWidgetSelected:g,onReset:v,onSelectionChanged:y}=e,S=i.hooks.useTranslation($p.defaultMessages,N.lrsDefaultMessages),[I,w]=i.React.useState([]),[E,b]=i.React.useState(),[R,T]=i.React.useState(),[O,C]=i.React.useState(!1),[L,A]=i.React.useState(!1),[D,_]=i.React.useState({}),P=i.React.useRef(null),x=s===N.ModeType.Map,M=!x&&(null==l?void 0:l.length)>0||x&&c&&Object.keys(c).length>0,k=(0,Co.useRef)(c||(0,i.Immutable)({})),j=e=>jv(this,void 0,void 0,function*(){const t=Object.values(e),r=t.map(e=>jv(this,void 0,void 0,function*(){yield e.whenJimuMapViewLoaded(),yield e.whenAllJimuLayerViewLoaded()}));return yield Promise.allSettled(r),t}),F=i.React.useCallback(e=>jv(this,void 0,void 0,function*(){w([]);const t=yield j(e);w(t),_((e=>{var t;const r={};for(const n of e){const e=(0,N.getDataSourceById)(n.dataSourceId),i=(null===(t=null==e?void 0:e.getLabel)||void 0===t?void 0:t.call(e))||"";r[n.id]=i}return r})(t)),C(1===t.length&&!t[0].dataSourceId),k.current=(0,i.Immutable)({})}),[C]),U=i.React.useCallback(()=>{v(P.current),P.current=null,A(!1)},[v]),B=i.React.useCallback(e=>{s!==e&&(P.current=e,M?A(!0):U())},[s,U,M]),V=i.React.useCallback(e=>{g(e,s)},[s,g]),G=i.React.useCallback(e=>{const t=(0,N.getAllDataSourcesLayer)(e,o,h);f(e,t)},[f,h,o]),$=i.React.useCallback((e,t,r)=>{const n=(0,i.Immutable)(k.current).set(e,t),s=(0,N.getAllDataSourcesMap)(n,o,h);k.current=n,m(n,D,s,r)},[D,m,h,o]);return(0,zu.jsxs)(kv.SettingSection,{role:"group",title:S("mode"),"aria-label":S("mode"),children:[(0,zu.jsxs)("div",{role:"radiogroup",className:"mb-4",children:[(0,zu.jsxs)($p.Label,{className:"d-flex align-items-center label2",children:[(0,zu.jsx)($p.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:!x,onChange:()=>{B(N.ModeType.Layer)}}),S("selectLayers")]}),(0,zu.jsxs)($p.Label,{className:"d-flex align-items-center label2",children:[(0,zu.jsx)($p.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:x,onChange:()=>{B(N.ModeType.Map)}}),S("interactWithMap")]})]}),!x&&(0,zu.jsx)(N.ImportMode,{widgetId:o,intl:t,lrsLayers:l,useMapWidgetIds:a,portalUrl:r,theme:n,mapEmpty:!1,supportedLrsTypes:u,requiredLrsTypes:d,onSettingChange:G,onMapWidgetSelected:V,onSelectionChanged:y,children:p}),x&&(0,zu.jsx)(N.MapMode,{intl:t,widgetId:o,portalUrl:r,mapViewsConfig:c,useMapWidgetIds:a,mapEmpty:O,jimuMapViews:I,viewGroup:E,activeMapView:R,supportedLrsTypes:u,requiredLrsTypes:d,onSettingChange:$,onMapWidgetSelected:V,onSelectionChanged:y,children:p}),x&&(0,zu.jsx)(sg.JimuMapViewComponent,{useMapWidgetId:null==a?void 0:a[0],onViewsCreate:F,onViewGroupCreate:e=>{b(e)},onActiveViewChange:e=>{T(e)}}),L&&(0,zu.jsx)($p.ConfirmDialog,{level:"warning",title:S("lrsChangeModeConfirmTitle"),hasNotShowAgainOption:!1,content:S("lrsChangeModeConfirmTips"),onConfirm:U,onClose:()=>{A(!1)}})]})}var Uv=m(53195),Bv=m.n(Uv),Vv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Gv=e=>{const t=window.SVG,{className:r}=e,n=Vv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Bv()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var $v=m(72529),Hv=m.n($v),Wv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const zv=e=>{const t=window.SVG,{className:r}=e,n=Wv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Hv()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var qv=m(93303),Jv=m.n(qv),Kv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Yv=e=>{const t=window.SVG,{className:r}=e,n=Kv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Jv()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var Xv=m(30655),Qv=m.n(Xv),Zv=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const ey=e=>{const t=window.SVG,{className:r}=e,n=Zv(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Qv()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var ty=m(94064),ry=m.n(ty),ny=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const iy=e=>{const t=window.SVG,{className:r}=e,n=ny(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:ry()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var oy=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const sy=e=>{const t=window.SVG,{className:r}=e,n=oy(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Kg()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var ay=m(98640);const ly=m(62838);function cy(e){const{activeLrsLayers:t,allLrsLayers:r,allowRemove:n,children:o,onLayerRemoved:s,onLayerOrderChanged:a,onSelectionChanged:l}=e,[u,d]=i.React.useState(-1),h=i.React.useRef(null),p=i.hooks.useTranslation(i.defaultMessages,c),f=i.React.useCallback(()=>{d(-1),l(-1)},[l]),m=i.React.useCallback((e,t)=>{t===u?(d(-1),l(-1)):(d(t),l(e))},[u,l]),g=i.React.useCallback(e=>n?[{label:p("remove"),iconProps:()=>({icon:ly,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,r=+t.itemKey;r===u&&f(),s(r)}}]:[],[n,p,f,s,u]),v=i.React.useMemo(()=>t.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:u===t,itemStateTitle:e.name,itemStateCommands:g(t)})).asMutable({deep:!0}),[g,t,u]),y=i.React.useCallback(e=>!!(0,N.getDataSourceById)(e),[]),S=i.React.useMemo(()=>(0,zu.jsx)($p.Alert,{variant:"text",form:"tooltip",size:"small",type:"error",text:p("dataSourceCreateError")}),[p]),I=i.React.useMemo(()=>(0,zu.jsx)($p.Alert,{variant:"text",form:"tooltip",size:"small",type:"error",text:p("missingParentNetwork")}),[p]),w=i.React.useCallback((e,r)=>{var n,i;const{itemJsons:o}=r.props,[s]=o,a=null===(i=null===(n=null==s?void 0:s.itemStateDetailContent)||void 0===n?void 0:n.useDataSource)||void 0===i?void 0:i.dataSourceId,l=(0,N.isParentNetworkAvailable)(+s.itemKey,t),c=y(a);return l&&c?null:l?c?void 0:S:I},[S,I,y,t]),E=i.React.useCallback((e,n)=>{const{itemJsons:[i]}=n.props,o=t.at(+i.itemKey);if(!o)return;const s=t.findIndex(e=>e.id===o.id),a=r.findIndex(e=>e.id===o.id);m(a,s)},[t,r,m]);return(0,zu.jsxs)(kv.SettingRow,{className:"w-100",flow:"no-wrap",children:[(0,zu.jsx)("div",{className:"w-100",ref:h,children:(0,zu.jsx)(ay.List,Object.assign({className:"py-1",itemsJson:v,dndEnabled:!0,onUpdateItem:(e,t)=>{if("handleDidDrop"===e.updateType){const{itemJsons:e}=t.props,[,r]=e;a(r.map(e=>e.itemStateDetailContent))}},renderOverrideItemDetailToggle:w,onClickItemBody:E},N.advancedActionMap))}),(0,zu.jsx)(kv.SidePopper,{position:"right",isOpen:u>=0&&!i.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:f,trigger:h.current,title:p("layerConfig"),children:o})]})}var uy=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const dy=()=>i.css`
  .map-layers-setting-row {
    width: calc(100% - 22px);
    max-width: calc(100% - 22px);

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;
      justify-content: flex-end;
      min-width: 20px;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;

        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }
`;function hy(e){var t;const{widgetId:r,intl:n,portalUrl:o,jimuMapView:s,mapViewConfig:a=(0,i.Immutable)({}),supportedLrsTypes:l,requiredLrsTypes:u,children:d,onChange:h,onSelectionChanged:p}=e,f=(null==a?void 0:a.configuredLayerIds)||(0,i.Immutable)([]),m=(null==a?void 0:a.enabledLayerIds)||(0,i.Immutable)([]),g=(null==a?void 0:a.disabledLayerIds)||(0,i.Immutable)([]),v=(null==a?void 0:a.unsupportedLayerIds)||(0,i.Immutable)([]),y=(null==a?void 0:a.lrsLayers)||(0,i.Immutable)([]),[S,I]=i.React.useState(!1),[w,E]=i.React.useState(!1),[b,R]=i.React.useState(!1),[T,O]=i.React.useState([]),[C,L]=i.React.useState(!1),[A,D]=i.React.useState(""),_=i.React.useRef(null),P=i.hooks.useTranslation($p.defaultMessages,c),x="3d"===(null===(t=s.view)||void 0===t?void 0:t.type),M=i.React.useMemo(()=>(0,N.getDataSourceById)(s.dataSourceId),[s.dataSourceId]),k=i.React.useMemo(()=>{var e;return(null===(e=null==M?void 0:M.getLabel)||void 0===e?void 0:e.call(M))||""},[M]),j=i.React.useMemo(()=>y.filter(e=>!g.includes(e.id)&&!v.includes(e.id)),[y,g,v]),F=e=>uy(this,void 0,void 0,function*(){yield e.whenJimuMapViewLoaded();const t=yield e.whenAllJimuLayerViewLoaded(),r=Object.values(t).filter(e=>!e.fromRuntime&&(0,N.isSupportedJimuLayerView)(e)),n=r.map(e=>e.createLayerDataSource());try{yield Promise.all(n)}catch(e){console.error(e)}return e.isActive||(yield(0,N.waitTime)(500)),r.filter(e=>!!e.getLayerDataSource())});i.React.useEffect(()=>{!function(){uy(this,void 0,void 0,function*(){const e=yield F(s);O(e),I(!0)})}()},[s]);i.React.useEffect(()=>{!function(){uy(this,void 0,void 0,function*(){if(S){const e=T.map(e=>e.getLayerDataSource()),t=(0,N.GetUniqueLrsUrls)(e);if(0===t.size)return;let c=[];for(const[n,s]of t){const t=i.SessionManager.getInstance().getSessionByUrl(o),a=(null==t?void 0:t.token)||"",l=Object.assign({f:"json"},a&&{token:a}),u=e.filter(e=>s.includes(e.id)),d=(0,N.getAllUseDs)(u,(0,i.Immutable)([])),h=yield(0,N.LoadLayers)(r,l,n,d);c=c.concat(h)}const d=c.some(e=>!f.includes(e.id));((e,t,r,i,o,s)=>{const a=e.map(e=>e.id),l=(0,N.getUnsupportedLayerIds)(e,r),c=a.filter(e=>!l.includes(e)),u=(0,N.validateLayers)(e,n,t,g.asMutable({deep:!0}));if(u)return E(!1),void D(u);E(!0),h(o,i.set("configuredLayerIds",a).set("enabledLayerIds",c).set("disabledLayerIds",g).set("unsupportedLayerIds",l).set("lrsLayers",e),s)})(c,u,l,a,s.id,d)}})}()},[S]);const U=i.React.useCallback(()=>{R(!0)},[]),B=i.React.useCallback(()=>{L(e=>!e)},[]),V=i.React.useCallback(()=>{R(!1)},[]),G=i.React.useCallback((e,t)=>{const r=y.asMutable({deep:!0}),i=(0,N.validateLayers)(r,n,u,t);D(i||""),h(s.id,a.set("configuredLayerIds",f).set("enabledLayerIds",e).set("disabledLayerIds",t).set("unsupportedLayerIds",v).set("lrsLayers",y),!0)},[y,n,u,h,s.id,a,f,v]),$=i.React.useCallback(e=>{h(s.id,a.set("configuredLayerIds",f).set("enabledLayerIds",m).set("disabledLayerIds",g).set("unsupportedLayerIds",v).set("lrsLayers",e),!0)},[f,g,m,s.id,a,h,v]),H=i.React.useCallback(e=>{p(e,s.id)},[s.id,p]),W=i.React.useMemo(()=>!(!S||0!==T.length||!A)||(!!(w&&T.length>0&&A)||!(w||!A)),[S,T,w,A]);return(0,zu.jsxs)(i.React.Fragment,{children:[(0,zu.jsxs)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-4",css:dy,children:[x?(0,zu.jsx)(zv,{className:"mr-2"}):(0,zu.jsx)(Gv,{className:"mr-2"}),(0,zu.jsx)(kv.SettingRow,{flow:"no-wrap",className:"map-layers-setting-row w-100",label:k,"aria-label":k,children:(0,zu.jsxs)("div",{className:"map-title-icon-container d-flex align-items-center",children:[!S&&!w&&(0,zu.jsx)("div",{className:"setting-loading-container",children:(0,zu.jsx)($p.Loading,{type:$p.LoadingType.Donut})}),W&&(0,zu.jsx)($p.Tooltip,{title:A,showArrow:!1,placement:"top",children:(0,zu.jsx)("span",{children:(0,zu.jsx)($p.Button,{className:"border-0",disabled:!S,type:"tertiary",icon:!0,size:"sm",children:(0,zu.jsx)(sy,{size:16,color:"var(--sys-color-warning-main)"})})})}),S&&T.length>0&&(0,zu.jsxs)(i.React.Fragment,{children:[(0,zu.jsx)($p.Tooltip,{title:P("selectLayers"),showArrow:!1,placement:"top",children:(0,zu.jsx)("span",{children:(0,zu.jsx)($p.Button,{ref:_,className:"map-layers-setting-btn mr-1 p-0 border-0",disabled:!S,type:"tertiary",icon:!0,size:"sm",onClick:U,children:(0,zu.jsx)(Yv,{size:16})})})}),y.length>0&&(0,zu.jsx)($p.Button,{className:"layer-list-toggle-btn p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:B,children:C?(0,zu.jsx)(iy,{size:16}):(0,zu.jsx)(ey,{size:16})})]})]})})]}),C&&y.length>0&&(0,zu.jsx)(cy,{activeLrsLayers:j,allLrsLayers:y,allowRemove:!1,children:d,onLayerOrderChanged:$,onSelectionChanged:H}),b&&(0,zu.jsx)(kv.SidePopper,{isOpen:!0,toggle:V,position:"right",trigger:_.current,title:P("selectLayers"),children:(0,zu.jsxs)(i.React.Fragment,{children:[(0,zu.jsx)(kv.SettingRow,{className:"w-100 pl-4 pr-4",label:k,"aria-label":k}),(0,zu.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4",children:(0,zu.jsx)(N.LrsViewSelector,{lrsLayer:y,enabledLayerIds:m,disabledLayerIds:g,unsupportedLayerIds:v,mapDataSourceLabel:k,onChange:G})})]})})]})}function py(e){const{intl:t,widgetId:r,mapViewsConfig:n,useMapWidgetIds:o,mapEmpty:s,jimuMapViews:a,viewGroup:l,requiredLrsTypes:c,supportedLrsTypes:u,activeMapView:d,children:h,onMapWidgetSelected:p,onSelectionChanged:f,onSettingChange:m}=e,g=(null==o?void 0:o.length)>0,v=i.hooks.useTranslation($p.defaultMessages),y=i.React.useCallback((e,t,r)=>{m(e,t,r)},[m]);return(0,zu.jsxs)(i.React.Fragment,{children:[(0,zu.jsx)(kv.SettingRow,{children:(0,zu.jsx)(kv.MapWidgetSelector,{useMapWidgetIds:o,onSelect:p})}),g&&!s&&a.map(i=>(0,zu.jsx)(hy,{intl:t,widgetId:r,portalUrl:e.portalUrl,jimuMapView:i,viewGroup:l,activeMapView:d,mapViewConfig:null==n?void 0:n[i.id],requiredLrsTypes:c,supportedLrsTypes:u,children:h,onChange:y,onSelectionChanged:f},i.id)),g&&s&&(0,zu.jsx)(kv.SettingRow,{children:(0,zu.jsx)($p.Alert,{tabIndex:0,type:"warning",className:"warningMsg",open:!0,text:v("noWebMapWebSceneTip")})})]})}var fy=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const my=()=>i.css`
  flex-direction: column;

  .map-layers-setting-row {
    width: 100%;

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;
      justify-content: flex-end;
      min-width: 20px;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;

        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }
`;function gy(e){const{widgetId:t,intl:r,portalUrl:n,mapWidgetIds:o,layers:s,requiredLrsTypes:a,supportedLrsTypes:l,children:u,onLayersAdded:d,onLayerRemoved:h,onClearAll:p,onLayerOrderChanged:f,onSelectionChanged:m}=e,g=i.hooks.useTranslation(c),[v,y]=i.React.useState(""),S=(null==s?void 0:s.length)>0,[I,w]=i.React.useState(!1),E=(0,Co.useRef)(!1),b=(0,Co.useRef)(!1),R=i.React.useCallback(()=>{w(e=>!e)},[]),T=i.React.useCallback(e=>{m(e,"")},[m]);return(0,zu.jsxs)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-3",css:my,children:[(0,zu.jsxs)(Co.Fragment,{children:[(0,zu.jsx)(kv.SettingRow,{flow:"no-wrap",className:"w-100",children:(0,zu.jsx)($p.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:()=>fy(this,void 0,void 0,function*(){if(y(""),null==o?void 0:o[0]){if(!E.current){E.current=!0,b.current=!0;try{const e=null==o?void 0:o[0],c=(0,N.getAllDatasourceFromMapWidgetId)(e),u=(0,N.GetUniqueLrsUrls)(c);if(0===u.size)return void y(g("noLrsLayersInMap"));let h=[];for(const[e,r]of u){const o=i.SessionManager.getInstance().getSessionByUrl(n),a=(null==o?void 0:o.token)||"",u=Object.assign({f:"json"},a&&{token:a}),d=c.filter(e=>r.find(t=>t===e.id)),p=(0,N.getAllUseDs)(d,s),f=yield(0,N.LoadLayers)(t,u,e,p);h=h.concat(f);const m=(0,N.getUnsupportedLayerIds)(h,l);m.length>0&&(h=h.filter(e=>!m.includes(e.id)))}E.current=!1,b.current=!1;const p=(0,N.validateLayers)(h,r,a,[]);if(p)return y(p),void d((0,i.Immutable)([]),!0);const f=(0,i.Immutable)(h);d(f,!0)}finally{E.current=!1,b.current=!1}}}else y(g("noMapSelected"))}),title:g("loadLayers"),"aria-label":g("loadLayers"),children:g("loadLayers")})}),s&&s.length>0&&(0,zu.jsx)(kv.SettingRow,{flow:"no-wrap",className:"w-100",children:(0,zu.jsx)($p.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:p,title:g("clearLayers"),"aria-label":g("clearLayers"),children:g("clearLayers")})}),(b.current||S||v.length>0)&&(0,zu.jsxs)(kv.SettingRow,{flow:"no-wrap",className:"map-layers-setting-row w-100",label:"Layers","aria-label":"Layers",children:[(0,zu.jsxs)("div",{className:"map-title-icon-container d-flex align-items-center",children:[b.current&&(0,zu.jsx)("div",{className:"setting-loading-container",children:(0,zu.jsx)($p.Loading,{type:$p.LoadingType.Donut})}),v.length>0&&(0,zu.jsx)($p.Tooltip,{title:g(v),showArrow:!1,placement:"top",children:(0,zu.jsx)("span",{children:(0,zu.jsx)($p.Button,{className:"border-0",disabled:!b.current,type:"tertiary",icon:!0,size:"sm",children:(0,zu.jsx)(sy,{size:16,color:"var(--sys-color-warning-main)"})})})})]}),S&&(0,zu.jsx)($p.Button,{className:"layer-list-toggle-btn p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:R,children:I?(0,zu.jsx)(iy,{size:16}):(0,zu.jsx)(ey,{size:16})})]})]}),I&&s.length>0&&(0,zu.jsx)(cy,{activeLrsLayers:s,allLrsLayers:s,children:u,allowRemove:!0,onLayerRemoved:h,onLayerOrderChanged:f,onSelectionChanged:T})]})}function vy(e){const{widgetId:t,useMapWidgetIds:r,intl:n,mapEmpty:o,lrsLayers:s,portalUrl:a,theme:l,supportedLrsTypes:c,requiredLrsTypes:u,children:d,onMapWidgetSelected:h,onSettingChange:p,onSelectionChanged:f}=e,m=(null==r?void 0:r.length)>0,g=i.hooks.useTranslation($p.defaultMessages),v=i.React.useCallback(e=>{var t;let r=null!=s?s:(0,i.Immutable)([]),n=null!==(t=null==s?void 0:s.length)&&void 0!==t?t:0;e.forEach(e=>{r=i.Immutable.set(r,n,e),n++}),p(r)},[s,p]),y=i.React.useCallback(e=>{p((0,i.Immutable)(e))},[p]),S=i.React.useCallback(()=>{p((0,i.Immutable)([]))},[p]),I=i.React.useCallback(e=>{const t=s.asMutable({deep:!0});t.splice(e,1),p((0,i.Immutable)(t))},[s,p]);return(0,zu.jsxs)(i.React.Fragment,{children:[(0,zu.jsx)(kv.SettingRow,{label:g("selectMapWidget")}),(0,zu.jsx)(kv.MapWidgetSelector,{useMapWidgetIds:r,onSelect:h}),m&&!o&&(0,zu.jsx)(gy,{widgetId:t,intl:n,layers:s,mapWidgetIds:r,portalUrl:a,theme:l,supportedLrsTypes:c,requiredLrsTypes:u,children:d,onLayersAdded:v,onClearAll:S,onLayerRemoved:I,onLayerOrderChanged:y,onSelectionChanged:f}),m&&o&&(0,zu.jsx)(kv.SettingRow,{children:(0,zu.jsx)($p.Alert,{tabIndex:0,type:"warning",className:"warningMsg",open:!0,text:g("noWebMapWebSceneTip")})})]})}var yy=m(31027),Sy=m.n(yy),Iy=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const wy=e=>{const t=window.SVG,{className:r}=e,n=Iy(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Sy()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))},Ey=e=>i.css`
    &.empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;
        .empty-placeholder-text {
          color: ${e.ref.palette.neutral[1e3]};
          font-size: 14px;
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${e.ref.palette.neutral[800]};
        }
      }
    }
  `;function by(e){const{isMapMode:t}=e,r=i.hooks.useTranslation(c,$p.defaultMessages),o=(0,n.useTheme)(),s=r(t?"noMapSelectedTips":"importLayersTips");return(0,zu.jsx)("div",{className:"empty-placeholder w-100",css:Ey(o),children:(0,zu.jsxs)("div",{className:"empty-placeholder-inner",children:[(0,zu.jsx)("div",{className:"empty-placeholder-icon",children:(0,zu.jsx)(wy,{size:48})}),(0,zu.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",children:s})]})})}var Ry=m(50170),Ty=m.n(Ry),Ny=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Oy=e=>{const t=window.SVG,{className:r}=e,n=Ny(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Ty()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))};var Cy=m(13424),Ly=m.n(Cy),Ay=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Dy=e=>{const t=window.SVG,{className:r}=e,n=Ay(e,["className"]),o=(0,i.classNames)("jimu-icon jimu-icon-component",r);return t?(0,zu.jsx)(t,Object.assign({className:o,src:Ly()},n)):(0,zu.jsx)("svg",Object.assign({className:o},n))},_y=(e,t,r,n,i,o)=>{const s=e.find(e=>e.layerType===N.LrsLayerType.UtilityNetwork),a=e.find(e=>e.layerType===N.LrsLayerType.Addressing),l=(e,r,n=!1)=>({itemKey:e,itemStateTitle:r,itemChildren:[],isItemSelectable:!1,itemStateChecked:!1,itemStateExpanded:t.includes(e)}),c={itemKey:"root item",itemStateTitle:"root item",itemChildren:[]},u={[o[0]]:l(o[0],o[0]),[o[1]]:l(o[1],o[1]),[o[2]]:l(o[2],o[2]),[o[3]]:l(o[3],o[3]),[o[4]]:l(o[4],o[4]),[o[5]]:l(o[5],o[5])};for(const r of e){const e=n.includes(r.id),l=!i.includes(r.id);let c=r.name;switch(s&&r.id===s.id&&(c=`${s.name} (UN)`),a&&r.id===a.id&&(c=`${a.name} (Addressing)`),u[r.id]={itemKey:r.id,itemStateTitle:c,itemChildren:[],isItemSelectable:l,itemStateChecked:e&&l,itemStateExpanded:t.includes(r.id)},r.layerType){case N.LrsLayerType.Network:u[o[2]].itemChildren.push(u[r.id]);break;case N.LrsLayerType.PointEvent:case N.LrsLayerType.LineEvent:case N.LrsLayerType.Event:u[o[3]].itemChildren.push(u[r.id]);break;case N.LrsLayerType.Intersection:u[o[4]].itemChildren.push(u[r.id]);break;case N.LrsLayerType.NonLrsPoint:case N.LrsLayerType.NonLrsLine:case N.LrsLayerType.NonLrs:u[o[5]].itemChildren.push(u[r.id]);break;case N.LrsLayerType.CalibrationPoint:case N.LrsLayerType.UtilityNetwork:case N.LrsLayerType.Addressing:case N.LrsLayerType.Centerline:u[o[1]].itemChildren.push(u[r.id])}}const d=o.slice(1,o.length);for(const e of d)u[e].itemChildren.sort((e,t)=>e.itemStateTitle.localeCompare(t.itemStateTitle)),u[r].itemChildren.push(u[e]);return c.itemChildren.push(u[r]),c},Py=(e,t)=>{if(!e.itemChildren||0===e.itemChildren.length)return e.itemStateTitle.toLowerCase().includes(t.toLowerCase())?e:null;const r=e.itemChildren.map(e=>Py(e,t)).filter(Boolean);return r.length>0&&(e.itemStateExpanded=!0),0===r.length?e.itemStateTitle.toLowerCase().includes(t.toLowerCase())?e:null:(e.itemChildren=r,e)};function xy(e){const{lrsLayer:t,mapDataSourceLabel:r,enabledLayerIds:n,disabledLayerIds:o,unsupportedLayerIds:s,onChange:a}=e,l=i.hooks.useTranslation(c,$p.defaultMessages),{useState:u,useEffect:d,useMemo:h,useRef:p}=i.React,[f,m]=u(""),[g,v]=u(!1),[y,S]=u(null),[I,w]=u(!0),[E,b]=u(!1),R=p(null),[T,N]=u([]),O=h(()=>[r,l("lrsMinimumSchema"),l("lrsNetwork"),l("lrsEvent"),l("lrsIntersection"),l("nonLrsLayer")],[]);d(()=>{N(O)},[]),d(()=>{if(0===t.length)return void w(!1);w(!0);const e=_y(t,T,r,n,s,O);S(e),w(!1)},[t,T,r,n,s,O]),d(()=>{g&&R.current&&((0,i.focusElementInKeyboardMode)(R.current,!0),R.current.select())},[g]);const C=h(()=>{if(f){const e=JSON.parse(JSON.stringify(y)),t=Py(e,f);if(t)return t;return{itemKey:"root item",itemStateTitle:"root item",itemChildren:[]}}return y},[y,f]),L=(e,t,r)=>{const n=JSON.parse(JSON.stringify(e)),i=[],o=[],s=[];n.itemChildren.forEach(function e(n){"itemStateChecked"===t&&r&&n.isItemSelectable?o.push(n.itemKey):"itemStateChecked"===t&&!r&&n.isItemSelectable?s.push(n.itemKey):"itemStateExpanded"===t&&i.push(n.itemKey),n.itemChildren&&n.itemChildren.length>0&&n.itemChildren.forEach(e)}),"itemStateChecked"===t?r?a(o,[]):a([],s):"itemStateExpanded"===t&&N(r?i:[])};return(0,zu.jsxs)("div",{className:(0,i.classNames)("component-layer-view-selector","w-100 h-100",e.className||""),children:[(0,zu.jsxs)("div",{className:"button-container",children:[(0,zu.jsx)($p.TextInput,{allowClear:!0,size:"sm",type:"text",className:(0,i.classNames)("search-input",{"d-none":!g}),value:f,placeholder:l("SearchLabel"),onChange:e=>{const t=e.target.value;m(t)},"aria-label":l("SearchLabel"),ref:R}),(0,zu.jsx)($p.Label,{className:(0,i.classNames)("layer-label label2",{"d-none":g}),title:l("layers"),check:!0,children:l("layers")}),(0,zu.jsxs)("div",{className:"right-buttons",children:[(0,zu.jsxs)($p.Dropdown,{className:(0,i.classNames)({"d-none":g}),isOpen:E,toggle:()=>{b(!E)},"aria-label":l("batchOptions"),children:[(0,zu.jsx)($p.DropdownButton,{className:"batch-option-btn",onClick:()=>{b(!E)},arrow:!1,icon:!0,type:"tertiary",variant:"text",size:"sm",title:l("batchOptions"),children:(0,zu.jsx)(Dy,{autoFlip:!0})}),(0,zu.jsx)($p.DropdownMenu,{children:[{value:"selectAll",label:l("selectAllAvailableLayers")},{value:"unselectAll",label:l("unselectAllAvailableLayers")},{value:"divider",divider:!0},{value:"expandAll",label:l("expandAllLayers")},{value:"collapseAll",label:l("collapseAllLayers")}].map(e=>(0,zu.jsx)($p.DropdownItem,{divider:e.divider,onClick:()=>{(e=>{switch(e){case"selectAll":L(y,"itemStateChecked",!0);break;case"unselectAll":L(y,"itemStateChecked",!1);break;case"expandAll":L(y,"itemStateExpanded",!0);break;case"collapseAll":L(y,"itemStateExpanded",!1)}})(e.value)},title:e.label,children:e.label},e.value))})]}),(0,zu.jsx)($p.Button,{type:"tertiary",size:"sm",icon:!0,title:l("SearchLabel"),onClick:()=>{v(!g),m("")},children:(0,zu.jsx)(Oy,{autoFlip:!0})})]})]}),(0,zu.jsx)("div",{className:"tree-container",children:I?(0,zu.jsx)($p.Loading,{className:"w-100 h-100",type:$p.LoadingType.Secondary}):(0,zu.jsx)(ay.Tree,{className:"w-100",collapseStyle:ay.TreeCollapseStyle.Arrow,dndEnabled:!1,onUpdateItem:(e,t)=>{var r,i;if(e.updateType===ay.TreeItemActionType.HandleExpandItem){const t=null===(r=e.currentItemJson)||void 0===r?void 0:r.itemKey,n=null===(i=e.changeItemJson)||void 0===i?void 0:i.itemStateExpanded;t&&N(e=>n?[...e,t]:e.filter(e=>e!==t))}if(e.updateType===ay.TreeItemActionType.HandleCheckboxChanged){const[t]=e.itemJsons,r=n?[...n]:[],i=o?[...o]:[];t.isItemSelectable&&t.itemStateChecked?(r.push(t.itemKey),i.splice(i.indexOf(t.itemKey),1)):t.isItemSelectable&&!1===t.itemStateChecked&&(r.splice(r.indexOf(t.itemKey),1),i.push(t.itemKey)),a(r,i)}},rootItemJson:C||y,isMultiSelection:!0,checkboxLinkage:!1,size:"sm",treeAlignmentType:ay.TreeAlignmentType.Intact,disableDoubleClickTitle:!0,treeStyle:ay.TreeStyle.Basic,singleLineText:!0,searchedText:f})})]})}const My=(0,n.withStyles)(xy,"LrsViewSelector");var ky=m(48993),jy=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function Fy(e,t,r,n,i){return jy(this,arguments,void 0,function*(e,t,r,n,i,o=!0){const s=(yield(0,sg.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],a=i+n.id,l=n.view.map.findLayerById(a);cf(l)&&n.view.map.remove(l);const c=new s({id:a,listMode:r,legendEnabled:!1,title:a,geometryType:t,source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ky.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!1,spatialReference:n.view.spatialReference,screenSizePerspectiveEnabled:!1,fields:e});return c.visible=o,n.view.map.add(c),c})}function Uy(e){return jy(this,void 0,void 0,function*(){const t=i.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(cf(t)){const e=t;return(null==e?void 0:e.layer)||(yield e.createJSAPILayerByDataSource())}return null})}function By(e,t){const r=e.find(e=>e.type===t);return cf(r)?r.clone():null}function Vy(e,t){const r=e.find(e=>e.name===t);return cf(r)?r.clone():null}function Gy(e,t){let r=t.replace(/[^a-zA-Z0-9_]+/g,""),n=0,i=!0;for(;i;){const o=r.toUpperCase();i=e.includes(o),i&&(n++,r=t.replace(/[^a-zA-Z0-9_]+/g,"")+"_"+n.toString())}return r}function $y(e,t){return e.filter(e=>t.includes(e.name))}function Hy(){return["SHAPE_LENGTH","SHAPE_LEN","SHAPELENGTH","SHAPELEN","SHAPE__LENGTH","SHAPE__LENGTH__","SE_LENGTH","ST_LENGTH","STLENGTH","DB2GSEST_LENGTH","DB2GSESDELENGTH","SDELENGTH","SHAPESTLENGTH","SDO_GEOMSDO_LENGTH"]}function Wy(e,t,r,n){return jy(this,void 0,void 0,function*(){const i=new(0,(yield(0,sg.loadArcGISJSAPIModules)(["esri/layers/support/Field"]))[0]);return i.name=e,i.alias=t,i.type=r,i.editable=n,i.defaultValue=null,i})}var zy=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function qy(e){return zy(this,void 0,void 0,function*(){return new Promise(function(t,r){const n={params:e.params,httpMethod:e.method};i.esri.restRequest.request(e.url,n).then(e=>{t(e)}).catch(e=>{t(e)})})})}function Jy(e){return zy(this,void 0,void 0,function*(){if(!e)return[];const t=e.url,r=e.layerId,n=i.SessionManager.getInstance().getSessionByUrl(t),o=n&&n.token?n.token:"";return qy({method:"POST",url:`${t}/queryDataElements`,params:{f:"json",layers:JSON.stringify([r]),token:o}}).then(e=>{var t,r;return null!==(r=null===(t=e.layerDataElements)||void 0===t?void 0:t[0].dataElement.fieldGroups)&&void 0!==r?r:[]})})}function Ky(e){return zy(this,void 0,void 0,function*(){if(!e)return[];const t=e.url,r=e.layerId,n=i.SessionManager.getInstance().getSessionByUrl(t),o=n&&n.token?n.token:"";return qy({method:"POST",url:t+"/queryContingentValues",params:{f:"json",layers:JSON.stringify([r]),token:o}}).then(e=>e)})}function Yy(e,t,r,n,i,o,s){const a={};if(cf(n))if(-1===e&&-1===r)n.forEach(e=>{a[e.name]=e.value});else{const t=n[r];n.forEach(r=>{a[r.name]=r.value,r.name===t.name&&(a[r.name]=e)})}else s.forEach(e=>{const t=o.attributes[e.name],r=e.alias.split(".")[1];a[r]=t});const l=[];for(const e of i){const t=e.isEditingRestrictive?"error":"warning";let r=!1;const n=e.contingencies.filter(e=>!e.isRetired);if(!n||0===n.length)return[];for(const e of n){let t=!0;for(const r in e.values){const n=e.values[r];if("any"!==n.objectType)if("null"===n.objectType){if(null!=a[r]){t=!1;break}}else if("code"===n.objectType){if(null!=n.codedValue&&a[r]!==n.codedValue.code){t=!1;break}}else if("range"===n.objectType){const e=a[r];if(null!=n.minValue&&null!=n.maxValue&&(e<n.minValue||e>n.maxValue)){t=!1;break}}}if(t){r=!0;break}}r||l.push({fieldGroup:e,type:t})}return l}function Xy(e,t,r){const n=e&&!Number.isNaN(e)?function(e,t){const r=e.domains;if(r)return r[t]||null;return null}(e,t):r.getFieldDomain(t);return"inherited"===(null==n?void 0:n.type)?r.getFieldDomain(t):n}function Qy(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function Zy(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function eS(e,t,r,n){const i=null==e?void 0:e.contingentValueSets;if(!i)return[];const o=null==i?void 0:i[0].fieldGroups;if(!o||0===(null==o?void 0:o.length))return[];const s=t.map(e=>{const t=o.find(t=>t.name===e.name);if(t){const o=t.contingencies.map(t=>{var o;const s=t.id,a=t.isRetired||!1,l=function(e,t){const r=null==t?void 0:t.sourceJSON;let n;r.subtypes&&(n=r.subtypes.find(t=>t.code===e));return n||null}(t.subtypeCode,r);if(Number.isNaN(n)||(null==l?void 0:l.code)===n){const n={};for(let s=0;s<e.fields.length;s++){const a=e.fields[s];let c=t.values[s];if("number"==typeof c||"string"==typeof c){const e=Xy(l,a,r),t=r.getField(a);if(Qy(t))c=i[0].stringDictionary[c];else if(Zy(t)){const e=new Date(`${c}+00:00`);c=e.getTime()}const s={codedValue:null===(o=null==e?void 0:e.codedValues)||void 0===o?void 0:o.find(e=>e.code===c),objectType:"code"};n[a]=s}else if("object"==typeof c){const e={minValue:c.minValue,maxValue:c.maxValue,objectType:"range"};n[a]=e}else if(c){const e={objectType:"any"};n[a]=e}else{const e={objectType:"null"};n[a]=e}}return{id:s,isRetired:a,subtype:l,values:n}}return null}),s=[];return null==o||o.forEach(e=>{null!==e&&s.push(e)}),{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:s}}return[]});return s}function tS(e){if(null==e)return null;const t=e.trim();let r="";for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);r+=n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||95===n||n>=128&&n<=65535?t[e]:"_"}return(r[0]>="0"&&r[0]<="9"||"_"===r[0])&&(r="F"+r),r||null}const rS=e=>{const t=[];if(null==e||0===(null==e?void 0:e.length))return[];for(const r of e){const e=[],{contingencies:n,fields:i,name:o}=r;for(const t of n)t.isRetired||e.push({values:t.values});e.length>0&&t.push({name:o,fields:i,contingencies:e})}return t};function nS(e,t){const r=new Map;if(!cf(t))return[...r.values()];const n=rS(t).slice();if(n)for(const t of n){const n=null==t?void 0:t.contingencies;for(const t of n){const n=null==t?void 0:t.values[e];if("code"===(null==n?void 0:n.objectType)||"null"===(null==n?void 0:n.objectType)){const{code:e,name:t}=n.codedValue&&"null"!==n.objectType?n.codedValue:{code:"",name:"No value"};r.has(e)||r.set(e,{name:t,code:e})}}}return[...r.values()]}function iS(e){if(!e)return new Set;const t=e.flatMap(e=>e.fields);return new Set(t)}var oS=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function sS(e){return i.DataSourceManager.getInstance().getDataSource(e)}function aS(e){const{widgetId:t,useDataSource:r}=e;return i.ReactRedux.useSelector(e=>{let n;n=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;const o=n.widgets[t].asMutable({deep:!0}),s=o.useDataSources;return s.includes(r)||s.push(r),n=n.setIn(["widgets",t],o),i.utils.changeAppConfig(n),!0})}function lS(e){var t,r,n,o,s;if(!e)return[];const a=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(n=null===(r=(0,i.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder)||void 0===n?void 0:n.appConfig:null===(o=(0,i.getAppStore)().getState())||void 0===o?void 0:o.appConfig;if(!a)return[];const l=null===(s=a.widgets[e])||void 0===s?void 0:s.useDataSources;if(!l)return[];let c=[];return l.map(e=>e.dataSourceId).forEach(e=>{const t=i.DataSourceManager.getInstance().getDataSource(e),r=null==t?void 0:t.getDataSourcesByType(i.DataSourceTypes.FeatureLayer);r&&(c=c.concat(r))}),c}function cS(e,t){if(!e)return null;const r=[];return e.forEach(e=>{var n;t.findIndex(t=>t.id===e.id)>-1||r.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(n=e.getRootDataSource())||void 0===n?void 0:n.id})}),r}function uS(e,t,r="none"){const n=e.asMutable({deep:!0}).reduce((e,n)=>{var o,s,a,l,c;const u=n.useDataSource,d=u.dataSourceId;if(e.useDataSourceMap[d]=e.useDataSourceMap[d]||u,e.useDataSourceMap[d].fields=u.fields,"sld"===r){const r=t+"_point_output",n=t+"_line_output",i="Dynamic Segmentation - Point",o="Dynamic Segmentation - Line";if(0===e.outputDataSources.length){const t=mS(r,i,"esriGeometryPoint"),s=mS(n,o,"esriGeometryPolyline");e.outputDataSources.push(t),e.outputDataSources.push(s)}}if("identify"===r&&"network"===(null===(o=null==n?void 0:n.layerType)||void 0===o?void 0:o.toLocaleLowerCase())){const r=i.DataSourceManager.getInstance().getDataSource(null===(s=n.useDataSource)||void 0===s?void 0:s.dataSourceId);if(r){const i=null===(a=(0,kv.getOutputJsonOriginDs)(r))||void 0===a?void 0:a.getDataSourceJson(),o=fS(t,i,n,!0);e.outputDataSources.push(o)}}if("searchByRoute"===r&&!n.isReferent&&n.layerType===qp.Network){const r=i.DataSourceManager.getInstance().getDataSource(null===(l=n.useDataSource)||void 0===l?void 0:l.dataSourceId);if(r){const i=null===(c=(0,kv.getOutputJsonOriginDs)(r))||void 0===c?void 0:c.getDataSourceJson(),o=hS(t,i,n,!0),s=hS(t,i,n,!1);e.outputDataSources.push(o),e.outputDataSources.push(s)}}return e},{useDataSourceMap:{},outputDataSources:[]});return n}function dS(e,t,r="none"){const n={useDataSourceMap:{},outputDataSources:[]};return Object.keys(e).forEach(o=>{const s=e[o];s&&s.lrsLayers&&s.lrsLayers.asMutable({deep:!0}).forEach(e=>{var o,s,a,l;const c=e.useDataSource;if(!c||!c.dataSourceId)return;const u=c.dataSourceId;if(n.useDataSourceMap[u]||(n.useDataSourceMap[u]=Object.assign({},c)),n.useDataSourceMap[u].fields=c.fields,"sld"===r){const e=t+"_point_output",r=t+"_line_output",i="Dynamic Segmentation - Point",o="Dynamic Segmentation - Line";if(0===n.outputDataSources.length){const t=mS(e,i,"esriGeometryPoint"),s=mS(r,o,"esriGeometryPolyline");n.outputDataSources.push(t),n.outputDataSources.push(s)}}if("identify"===r&&(null==e?void 0:e.layerType)===qp.Network){const r=i.DataSourceManager.getInstance().getDataSource(null===(o=e.useDataSource)||void 0===o?void 0:o.dataSourceId);if(r){const i=null===(s=(0,kv.getOutputJsonOriginDs)(r))||void 0===s?void 0:s.getDataSourceJson(),o=fS(t,i,e,!0);n.outputDataSources.push(o)}}if("searchByRoute"===r&&!e.isReferent&&e.layerType===qp.Network){const r=i.DataSourceManager.getInstance().getDataSource(null===(a=e.useDataSource)||void 0===a?void 0:a.dataSourceId);if(r){const i=null===(l=(0,kv.getOutputJsonOriginDs)(r))||void 0===l?void 0:l.getDataSourceJson(),o=hS(t,i,e,!0),s=hS(t,i,e,!1);n.outputDataSources.push(o),n.outputDataSources.push(s)}}})}),n}const hS=(e,t,r,n)=>{const i=n?`${r.name} point result`:`${r.name} line result`,o=n?r.networkInfo.outputPointDsId:r.networkInfo.outputLineDsId,s=pS(i,r);return{id:o,type:null==t?void 0:t.type,label:i,originDataSources:[r.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:s,geometryType:n?"esriGeometryPoint":"esriGeometryPolyline"}},pS=(e="",t)=>{const r={},n=i.DataSourceManager.getInstance().getDataSource(t.useDataSource.dataSourceId),o=null==n?void 0:n.getSchema().fields.asMutable({deep:!0}),s=[];return Object.keys(o).forEach(e=>{s.push(o[e])}),fg.forEach(e=>{s.push({alias:e.value,type:i.JimuFieldType.Number,jimuName:e.value,name:e.value})}),s.push({alias:gg.value,type:i.JimuFieldType.String,jimuName:gg.value,name:gg.value}),vg.forEach(e=>{s.push({alias:e.value,type:i.JimuFieldType.String,jimuName:e.value,name:e.value})}),mg.forEach(e=>{s.push({alias:e.value,type:i.JimuFieldType.String,jimuName:e.value,name:e.value})}),s.push({alias:Sg.at(0).value,type:i.JimuFieldType.String,jimuName:Sg.at(0).value,name:Sg.at(0).value}),s.push({alias:Sg.at(1).value,type:i.JimuFieldType.String,jimuName:Sg.at(1).value,name:Sg.at(1).value}),s.push({alias:Sg.at(2).value,type:i.JimuFieldType.String,jimuName:Sg.at(2).value,name:Sg.at(2).value}),s.push({alias:Sg.at(3).value,type:i.JimuFieldType.Date,jimuName:Sg.at(3).value,name:Sg.at(3).value}),s.push({alias:Sg.at(4).value,type:i.JimuFieldType.Date,jimuName:Sg.at(4).value,name:Sg.at(4).value}),s.push({alias:yg.value,type:i.JimuFieldType.String,jimuName:yg.value,name:yg.value}),null==s||s.forEach(e=>{r[null==e?void 0:e.jimuName]=e}),{label:e,idField:"OBJECTID",fields:r}},fS=(e,t,r,n)=>{var i;const o=`${r.name} point result`,s=null===(i=null==r?void 0:r.networkInfo)||void 0===i?void 0:i.outputPointDsId,a=yS(o,r);return{id:s,type:null==t?void 0:t.type,label:o,originDataSources:[r.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:a,geometryType:n?"esriGeometryPoint":"esriGeometryPolyline"}},mS=(e,t,r)=>{const n=SS(t),o=e+"__layer";return{id:e,type:i.DataSourceTypes.FeatureLayer,label:t,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:n,geometryType:r,layerId:o}},gS="objectid",vS={jimuName:gS,alias:"OBJECTID",type:i.JimuFieldType.Number,name:gS},yS=(e="",t)=>{const r={},n=i.DataSourceManager.getInstance().getDataSource(t.useDataSource.dataSourceId),o=null==n?void 0:n.getSchema().fields.asMutable({deep:!0}),s=[];return Object.keys(o).forEach(e=>{s.push(o[e])}),s.push({alias:fg[0].value,type:i.JimuFieldType.Number,jimuName:fg[0].value,name:fg[0].value}),null==s||s.forEach(e=>{r[null==e?void 0:e.jimuName]=e}),{label:e,idField:"OBJECTID",fields:r}},SS=(e="")=>({label:e,idField:vS.jimuName,fields:{[vS.jimuName]:vS}});function IS(e){return oS(this,void 0,void 0,function*(){const t=[];for(const r of e){let e;try{e=yield r.getOrCreateLayerDataSource()}catch(e){continue}e&&t.push(e)}return t})}function wS(e,t){if(cf(e))for(const r in e)if(e[r].lrsLayers)for(const n of e[r].lrsLayers)if(n.id===t.id)return n.networkInfo}function ES(e,t){if(cf(e))for(const r in e)if(e[r].lrsLayers)for(const n of e[r].lrsLayers)if(n.id===t.id)return n}function bS(e,t){if(cf(e))for(const r in e)if(e[r].lrsLayers)for(const n of e[r].lrsLayers){const e=t.eventLayers;for(const t of e)if(String(n.originName)===t)return n.eventInfo}}var RS=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function TS(e,t){const r=t+(null==e?void 0:e.id),n=null==e?void 0:e.view.map.findLayerById(r);cf(n)&&(null==e||e.view.map.remove(n))}function NS(e,t,r,n,o,s){return RS(this,void 0,void 0,function*(){const a=(yield(0,i.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],l=n+t.id,c=t.view.map.findLayerById(l);cf(c)&&t.view.map.remove(c);const u={type:"text",color:o||[0,0,0],haloColor:[255,255,255,.8],haloSize:1,font:{size:s||12}},d=new a({id:l,listMode:"hide",legendEnabled:!1,title:l,geometryType:"point",source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ky.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!0,screenSizePerspectiveEnabled:!1,fields:e,labelingInfo:[{labelExpressionInfo:{expression:r},symbol:u}]});return t.view.map.add(d),d})}function OS(e){return RS(this,void 0,void 0,function*(){if(!e||!(null==e?void 0:e.paths)||0===e.paths.length)return null;const t=yield(0,i.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/operators/lengthOperator"]),r=t[0],n=t[1].execute(e)/2;if(0<e.paths.length){const t=e.paths[0];let i,o,s,a,l,c,u,d,h,p=0;if(0===n)return e.getPoint(0,0);if(n>0)for(let f=1;f<t.length;f++){if(i=t[f-1][0],a=t[f-1][1],o=t[f][0],l=t[f][1],u=CS(i,a,o,l),p+=u,p===n)return e.getPoint(0,f);if(p>n)return d=u-(p-n),h=Math.atan2(l-a,o-i),s=d*Math.cos(h),c=d*Math.sin(h),new r({x:i+s,y:a+c,spatialReference:{wkid:e.spatialReference.wkid}})}}return null})}function CS(e,t,r,n){return Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2))}var LS=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};function AS(e,t,r,n){return LS(this,void 0,void 0,function*(){const i=hf(t),o=t.useRouteName?n.attributes[i.routeNameFieldName]:"",s=n.attributes[i.routeIdFieldName],a=n.attributes[i.fromDateFieldName],l=n.attributes[i.toDateFieldName],c=n.geometry,u=n.attributes[i.lineIdFieldName],d=n.attributes[i.lineNameFieldName];let h=new Date(Date.now());cf(l)&&h>l?h=Uf(a,r):h.setHours(0,0,0,0);let p=new Date(Date.now());if(cf(l)&&p>l?p=Uf(l,r):p.setHours(0,0,0,0),cf(l)||(p=null),!cf(c))return Object.assign(Object.assign({},e),{routeName:o,routeId:s,fromDate:cf(a)?Uf(a,r):null,toDate:cf(l)?Uf(l,r):null,selectedPolyline:null,fromMeasure:null,toMeasure:null,validRoute:!1,selectedFromDate:h,selectedToDate:p,lineName:d,lineId:u});const f=uf(c);try{return yield im(r,t,f,a,s).then(n=>{const i=Math.min(...n),f=Math.max(...n);return Object.assign(Object.assign({},e),{routeName:o,routeId:s,fromDate:cf(a)?Uf(a,r):null,toDate:cf(l)?Uf(l,r):null,selectedPolyline:c,fromMeasure:hg(i,t.measurePrecision),toMeasure:hg(f,t.measurePrecision),validRoute:!0,selectedFromDate:h,selectedToDate:p,lineName:d,lineId:u})})}catch(t){return Object.assign(Object.assign({},e),{routeName:o,routeId:s,fromDate:cf(a)?Uf(a,r):null,toDate:cf(l)?Uf(l,r):null,selectedPolyline:c,fromMeasure:null,toMeasure:null,validRoute:!1,selectedFromDate:h,selectedToDate:p,lineName:d,lineId:u})}})}function DS(e,t,r){return LS(this,void 0,void 0,function*(){let n=null;const i=t.networkInfo.useRouteName?e.routeName:e.routeId,o={fromMeasure:null,toRouteToMeasure:null};if(!i||0===i.trim().length)return o;const s=hf(t.networkInfo),a=s.fromDateFieldName,l=s.toDateFieldName;return cf(t.networkInfo)&&(yield If(i.trim(),t.networkInfo,r,!1,!0,"",e.fromDate).then(i=>LS(this,void 0,void 0,function*(){if(cf(i)&&(yield Promise.all(i.features.map(t=>{var r,i,o,s;const c=null===(r=null==t?void 0:t.attributes)||void 0===r?void 0:r[a],u=null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i[l],d=null===(o=e.fromDate)||void 0===o?void 0:o.getTime(),h=null===(s=e.toDate)||void 0===s?void 0:s.getTime();return c===d&&(u&&h&&u===h?n=t.geometry:u||e.toDate||(n=t.geometry)),t})),cf(n))){const i=uf(n);if(cf(i)){const n=yield im(r,t.networkInfo,i,e.fromDate,e.routeId),s=Math.min(...n),a=Math.max(...n);o.fromMeasure=hg(s,t.networkInfo.measurePrecision),o.toRouteToMeasure=hg(a,t.networkInfo.measurePrecision)}}})).catch(()=>o)),o})}var _S=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};const PS={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:ay.TreeItemActionType.RenderOverrideItem,children:[{name:ay.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:ay.TreeItemActionType.RenderOverrideItemContent,children:[{name:ay.TreeItemActionType.RenderOverrideItemBody,children:[{name:ay.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:ay.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:ay.TreeItemActionType.RenderOverrideItemDragHandle},{name:ay.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:ay.TreeItemActionType.RenderOverrideItemIcon},{name:ay.TreeItemActionType.RenderOverrideItemTitle},{name:ay.TreeItemActionType.RenderOverrideItemDetailToggle},{name:ay.TreeItemActionType.RenderOverrideItemCommands}]}]},{name:ay.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})};function xS(e,t){return e.reduce((e,r)=>{switch(r.layerType){case qp.Network:t.includes(r.id)||e.networks.push(r.name);break;case qp.Event:t.includes(r.id)||(r.eventInfo.isPointEvent||e.lineEvents.push(r.name),r.eventInfo.isPointEvent&&e.pointEvents.push(r.name));break;case qp.Intersection:t.includes(r.id)||e.intersections.push(r.name)}return e},{networks:[],lineEvents:[],pointEvents:[],intersections:[]})}function MS(e){if(e&&e.widgets)for(const t in e.widgets){const r=e.widgets[t];if("widgets/arcgis/arcgis-map/"===(null==r?void 0:r.uri))return(0,i.Immutable)([null==r?void 0:r.id])}}function kS(e,t){return!e&&!t||!e&&0===(null==t?void 0:t.length)||e===zp.Map}function jS(e){let t=e;if(t.includes("FeatureServer"))t=t.substring(0,t.indexOf("FeatureServer"));else{if(!t.includes("MapServer"))return"";t=t.substring(0,t.indexOf("MapServer"))}return t+"MapServer/exts/LRServer"}const FS=e=>({esriDecimalDegrees:.009,esriNauticalMiles:.54,esriIntNauticalMiles:.54,esriMiles:.62,esriIntMiles:.62,esriKilometers:1,esriYards:5468,esriIntYards:5468,esriFeet:1093.6,esriIntFeet:1093.6,esriDecimeters:1e4,esriMeters:1e3,esriInches:39370,esriIntInches:39370,esriCentimeters:1e5,esriMillimeters:1e6,esriPoints:2834640}[e]||1e3);function US(e,t,r,n,o){var s,a,l,c,u,d,h,p,f,m,g,v,y,S,I;const w={},E=`${Math.random()}`.slice(2),b=(null==o?void 0:o.fields)?Object.values(null==o?void 0:o.fields):[];w.networkUrl=n,w.datasetName=r.datasetName,w.derivedFromNetworkId=r.derivedFromNetworkId,w.routeIdFieldName=r.routeIdFieldName,w.routeIdFieldSchema=b.find(e=>w.routeIdFieldName===e.name),w.routeNameFieldName=r.routeNameFieldName,w.routeNameFieldSchema=b.find(e=>w.routeNameFieldName===e.name),w.routeIdFieldNames=r.routeIdFields;const R=b.filter(e=>{var t;return null===(t=w.routeIdFieldNames)||void 0===t?void 0:t.includes(e.name)});w.fromDateFieldName=r.fromDateFieldName,w.fromDateFieldSchema=b.find(e=>w.fromDateFieldName===e.name),w.toDateFieldName=r.toDateFieldName,w.toDateFieldSchema=b.find(e=>w.toDateFieldName===e.name),w.supportsLines=r.supportsLines,w.supportsLines&&(w.lineIdFieldName=null==r?void 0:r.lineIdFieldName,w.lineIdFieldSchema=b.find(e=>w.lineIdFieldName===e.name),w.lineNameFieldName=null==r?void 0:r.lineNameFieldName,w.lineNameFieldSchema=b.find(e=>w.lineNameFieldName===e.name),w.lineOrderFieldName=null==r?void 0:r.lineOrderFieldName,w.lineOrderFieldSchema=b.find(e=>w.lineOrderFieldName===e.name),w.useLineName=!!w.lineIdFieldName&&w.lineIdFieldName.length>0,w.useLineId=!!w.lineNameFieldName&&w.lineNameFieldName.length>0,w.useLineName?w.defaultLineIdentifier=Yp.LineName:w.useLineId&&(w.defaultLineIdentifier=Yp.LineId));const T=[];w.routeIdFieldNames&&w.routeIdFieldNames.forEach(e=>{w.routeIdFieldName!==e&&w.routeNameFieldName!==e&&T.push(e)}),w.defaultIdentifer=Kp.RouteId,w.supportsLines&&cf(null==w?void 0:w.routeNameFieldSchema)?w.defaultIdentifer=Kp.RouteName:(null===(s=w.routeIdFieldNames)||void 0===s?void 0:s.length)>1&&(w.defaultIdentifer=Kp.MultiField);const N=[];w.routeIdFieldName&&N.push(w.routeIdFieldSchema.alias),w.routeNameFieldName&&N.push(w.routeNameFieldSchema.alias),(null===(a=w.routeIdFields)||void 0===a?void 0:a.length)>1&&R.forEach(e=>{N.push(e.alias)}),N.push(fg[0].value),N.push(fg[1].value),w.routeIdFields=[],R.forEach(e=>{const t={field:e,enabled:!0};w.routeIdFields.push(t)});let O="";O=w.supportsLines&&cf(null==w?void 0:w.routeNameFieldSchema)?null===(l=w.routeNameFieldSchema)||void 0===l?void 0:l.jimuName:null===(c=w.routeIdFieldSchema)||void 0===c?void 0:c.jimuName,w.sortOptions=[];const C={jimuFieldName:O,order:i.OrderRule.Asc};w.sortOptions.push(C),w.searchRadius=FS(r.unitsOfMeasure),w.useRouteId=!!w.routeIdFieldName&&w.routeIdFieldName.length>0,w.useMultiField=!!w.routeIdFields&&w.routeIdFields.length>1,w.useRouteName=r.supportsLines&&cf(null==w?void 0:w.routeNameFieldSchema),cf(w.routeNameFieldName)&&w.routeIdFieldName.length&&(w.useRouteName=!0),w.measurePrecision=r.measurePrecision,w.unitsOfMeasure=r.unitsOfMeasure,w.mTolerance=null===(u=r.spatialReferenceInfo)||void 0===u?void 0:u.mTolerance,w.xyTolerance=null===(d=r.spatialReferenceInfo)||void 0===d?void 0:d.xyTolerance,w.lrsNetworkId=r.lrsNetworkId,w.isDerived=r.isDerived,w.useRouteId=!!w.routeIdFieldName&&w.routeIdFieldName.length>0,w.useMultiField=!!w.routeIdFields&&w.routeIdFields.length>1,w.useMeasure=!0,w.useCoordinate=!0,w.useReferent=!0,w.useLineAndMeasure=w.supportsLines,w.showLineAndMeasure=w.supportsLines,w.showAdditionalFields=!1,w.expandByDefault=!1,w.searchSingle=!0,w.searchMultiple=!0,w.searchRange=!0,w.defaultSpatialReferenceFrom=Xp.Lrs,w.defaultMethod=Jp.Measure,w.enabledMethods=[Jp.Measure];const L=[],A=r.eventLayers;A&&A.length>0&&A.forEach(e=>{L.push(e.name)}),w.eventLayers=L;const D=[],_=r.intersectionLayers;_&&_.length>0&&_.forEach(e=>{D.push(e.name)}),w.intersectionLayers=D,w.spatialReferenceInfo={wkid:null===(h=r.spatialReferenceInfo)||void 0===h?void 0:h.wkid,wkt:null===(p=r.spatialReferenceInfo)||void 0===p?void 0:p.wkt};const P=null==t?void 0:t.objectIdField,x=null==t?void 0:t.globalIdField,M=null==t?void 0:t.editFieldsInfo,k=[x,P];M&&(k.push(M.creationDateField),k.push(M.creatorField),k.push(M.editDateField),k.push(M.editorField));const j=b.find(e=>"Shape__Length"===e.name),F=[w.routeIdFieldName,w.fromDateFieldName,w.toDateFieldName];w.routeNameFieldName&&F.push(w.routeNameFieldName),w.supportsLines&&(F.push(w.lineIdFieldName),F.push(w.lineNameFieldName),F.push(w.lineOrderFieldName));const U=F.map(e=>cf(e)?e.toLowerCase():e),B=k.map(e=>cf(e)?e.toLowerCase():e),V=b.filter(e=>!U.includes(e.name.toLowerCase())&&!B.includes(e.name.toLowerCase())),G=[];V.forEach(e=>{var t,r,n,i,o,s;let a=!0;const l=null===(t=null==e?void 0:e.name)||void 0===t?void 0:t.toLocaleLowerCase();l!==(null==x?void 0:x.toLocaleLowerCase())&&l!==(null==P?void 0:P.toLocaleLowerCase())&&l!==(null===(r=M.creationDateField)||void 0===r?void 0:r.toLocaleLowerCase())&&l!==(null===(n=M.creatorField)||void 0===n?void 0:n.toLocaleLowerCase())&&l!==(null===(i=M.editDateField)||void 0===i?void 0:i.toLocaleLowerCase())&&l!==(null===(o=M.editorField)||void 0===o?void 0:o.toLocaleLowerCase())&&l!==(null===(s=null==j?void 0:j.name)||void 0===s?void 0:s.toLocaleLowerCase())||(a=!1);const c={field:e,enabled:a,editable:!0,description:""};G.push(c)}),w.lrsFields=[],w.attributeFields=G;const $=o.fields;w.layerFields=[];for(const e in $)k.includes(e)||w.layerFields.push($[e]);w.allFieldsDetails=b,w.objectIdFieldName=P,w.outputPointDsId=`${e}_output_point_${E}`,w.outputLineDsId=`${e}_output_line_${E}`,w.configId=E;const H=[];return H.push(null===(f=w.routeIdFieldSchema)||void 0===f?void 0:f.name),w.useRouteName&&H.push(null===(m=w.routeNameFieldSchema)||void 0===m?void 0:m.name),H.push(null===(g=w.fromDateFieldSchema)||void 0===g?void 0:g.name),H.push(null===(v=w.toDateFieldSchema)||void 0===v?void 0:v.name),w.lineIdFieldSchema&&H.push(null===(y=w.lineIdFieldSchema)||void 0===y?void 0:y.name),w.lineNameFieldSchema&&H.push(null===(S=w.lineNameFieldSchema)||void 0===S?void 0:S.name),w.lineOrderFieldSchema&&H.push(null===(I=w.lineOrderFieldSchema)||void 0===I?void 0:I.name),w.defaultChecked=H,w}function BS(e,t,r,n){const i={},o=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[];i.datasetName=e.datasetName,i.eventUrl=t,i.fromDateFieldName=e.fromDateFieldName,i.toDateFieldName=e.toDateFieldName,i.derivedFromMeasureFieldName=e.derivedFromMeasureFieldName,i.derivedRouteIdFieldName=e.derivedRouteIdFieldName,i.derivedRouteNameFieldName=e.derivedRouteNameFieldName,i.derivedToMeasureFieldName=e.derivedToMeasureFieldName,i.fromReferentLocationFieldName=e.fromReferentLocationFieldName,i.fromReferentMethodFieldName=e.fromReferentMethodFieldName,i.fromReferentOffsetFieldName=e.fromReferentOffsetFieldName,i.toReferentLocationFieldName=e.toReferentLocationFieldName,i.toReferentMethodFieldName=e.toReferentMethodFieldName,i.toReferentOffsetFieldName=e.toReferentOffsetFieldName,i.locErrorFieldName=e.locErrorFieldName,i.eventIdFieldName=e.eventIdFieldName,i.routeIdFieldName=e.routeIdFieldName,i.routeNameFieldName=e.routeNameFieldName,i.fromMeasureFieldName=e.fromMeasureFieldName,i.toRouteIdFieldName=e.toRouteIdFieldName,i.toRouteNameFieldName=e.toRouteNameFieldName,i.toMeasureFieldName=e.toMeasureFieldName,i.canSpanRoutes=e.canSpanRoutes;const s=e.type;i.isPointEvent="esriLRSPointEventLayer"===s;const a=[i.fromDateFieldName,i.toDateFieldName,i.derivedFromMeasureFieldName,i.derivedRouteIdFieldName,i.derivedRouteNameFieldName,i.derivedToMeasureFieldName,i.fromReferentLocationFieldName,i.fromReferentMethodFieldName,i.fromReferentOffsetFieldName,i.toReferentLocationFieldName,i.toReferentMethodFieldName,i.toReferentOffsetFieldName,i.locErrorFieldName,i.eventIdFieldName,i.routeIdFieldName,i.routeNameFieldName,i.fromMeasureFieldName,i.toRouteIdFieldName,i.toRouteNameFieldName,i.toMeasureFieldName],l=null==n?void 0:n.objectIdField,c=null==n?void 0:n.globalIdField,u=null==n?void 0:n.editFieldsInfo,d=["SHAPE_LENGTH","SHAPE_LEN","SHAPELENGTH","SHAPELEN","SHAPE__LENGTH","SHAPE__LENGTH__","SE_LENGTH","ST_LENGTH","STLENGTH","DB2GSEST_LENGTH","DB2GSESDELENGTH","SDELENGTH","SHAPESTLENGTH","SDO_GEOMSDO_LENGTH"];d.push(l),d.push(c),u&&(d.push(u.creationDateField),d.push(u.creatorField),d.push(u.editDateField),d.push(u.editorField));const h=a.map(e=>cf(e)?e.toLowerCase():e),p=d.map(e=>cf(e)?e.toLowerCase():e);i.lrsFields=o.filter(e=>h.includes(e.name.toLowerCase()));const f=o.filter(e=>!h.includes(e.name.toLowerCase())&&!p.includes(e.name.toLowerCase())),m=[];return f.forEach(e=>{const t={field:e,enabled:!0,editable:!0,description:""};m.push(t)}),i.attributeFields=m,i.parentNetworkId=e.lrsNetworkId,i}function VS(e,t,r){const n={},i=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],o=e.routeIdFieldName;return n.routeIdFieldSchema=i.find(e=>o===e.name),n.parentNetworkId=e.lrsNetworkId,n.url=t,n}function GS(e,t,r){const n={},i=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],o=e.routeIdFieldName;n.routeIdFieldNameSchema=i.find(e=>o===e.name);const s=e.networkFieldName;n.networkFieldNameSchema=i.find(e=>s===e.name);const a=e.fromDateFieldName;n.fromDateFieldNameSchema=i.find(e=>a===e.name);const l=e.toDateFieldName;n.toDateFieldNameSchema=i.find(e=>l===e.name);const c=e.measureFieldName;return n.measureFieldNameSchema=i.find(e=>c===e.name),n.url=t,n}function $S(e,t,r){const n={},i=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],o=e.centerlineIdFieldName;return n.centerlineIdFieldNameSchema=i.find(e=>o===e.name),n.url=t,n}function HS(e,t,r){const n={},i=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],o=e.routeIdFieldName;n.routeIdFieldNameSchema=i.find(e=>o===e.name);const s=e.fromMeasureFieldName;n.fromMeasureFieldNameSchema=i.find(e=>s===e.name);const a=e.toMeasureFieldName;return n.toMeasureFieldNameSchema=i.find(e=>a===e.name),n.url=t,n}function WS(e,t,r){const n={},i=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[],o=e.addressNumberFieldName;n.addressNumberFieldNameSchema=i.find(e=>o===e.name);const s=e.roadNameFieldName;n.roadNameFieldNameSchema=i.find(e=>s===e.name);const a=e.leftFromAddressFieldName;n.leftFromAddressFieldNameSchema=i.find(e=>a===e.name);const l=e.leftToAddressFieldName;n.leftToAddressFieldNameSchema=i.find(e=>l===e.name);const c=e.rightFromAddressFieldName;n.rightFromAddressFieldNameSchema=i.find(e=>c===e.name);const u=e.rightToAddressFieldName;return n.rightToAddressFieldNameSchema=i.find(e=>u===e.name),n.url=t,n}function zS(e,t,r,n){const i={};return i.url=t,n&&(i.referentProperties=qS(e,t,r)),i}function qS(e,t,r){const n={},i=[],o=[null==e?void 0:e.globalIdField],s=null==e?void 0:e.editFieldsInfo;s&&(o.push(s.creationDateField),o.push(s.creatorField),o.push(s.editDateField),o.push(s.editorField));const a=null==e?void 0:e.fields;(null==a?void 0:a.length)>0&&a.forEach(e=>{"esriFieldTypeDate"===(null==e?void 0:e.type)&&o.push(null==e?void 0:e.name)});const l=(null==r?void 0:r.fields)?Object.values(null==r?void 0:r.fields):[];for(const e of l)o.includes(e.name)||i.push(e);return n.isPoint="esriGeometryPoint"===(null==e?void 0:e.geometryType),n.defaultMethod=Jp.Referent,n.layerFields=i,n.url=t,n}function JS(e,t){if(!cf(t))return!1;const r=t[e];return!cf(r)||!cf(r.eventInfo)||r.layerType!==qp.Event||t.findIndex(e=>cf(e.networkInfo)&&e.networkInfo.lrsNetworkId===r.eventInfo.parentNetworkId)>-1}function KS(e,t,r,n,i=!1){var o,s;const a=(null===(o=e[n])||void 0===o?void 0:o.name)||"",l=e[n].index,c=t.lrsLayers.find(e=>e.name===a),u=c&&(null===(s=t.disabledLayerIds)||void 0===s?void 0:s.includes(c.id)),d=t.lrsLayers.findIndex(e=>e.name===a),h=c&&d!==l;if(-1===l||u){const o=t.lrsLayers.findIndex(e=>{var n,o,s,a;return e.layerType===r&&r===qp.Event?i===(null===(n=e.eventInfo)||void 0===n?void 0:n.isPointEvent)&&!(null===(o=t.disabledLayerIds)||void 0===o?void 0:o.includes(e.id)):e.layerType===r&&r===qp.Network&&(!(null===(s=e.networkInfo)||void 0===s?void 0:s.isDerived)&&!(null===(a=t.disabledLayerIds)||void 0===a?void 0:a.includes(e.id)))});if(o>-1)return e.set(n,{index:o,name:t.lrsLayers[o].name})}return l>-1&&h?e.set(n,{index:d,name:t.lrsLayers[d].name}):e}function YS(e,t,r){if(t&&t.index>=0){return{index:e.findIndex(e=>e.name===t.name),name:t.name}}if(0===e.length)return{index:-1,name:""};const n=e.findIndex(e=>e.layerType===qp.Event&&e.eventInfo.isPointEvent===r);return{index:n,name:n>=0?e[n].name:""}}function XS(e,t){if(t&&t.index>=0){return{index:e.findIndex(e=>e.name===t.name),name:t.name}}if(0===e.length)return{index:-1,name:""};const r=e.findIndex(e=>{var t;return e.layerType===qp.Network&&!(null===(t=e.networkInfo)||void 0===t?void 0:t.isDerived)});return{index:r,name:r>=0?e[r].name:""}}function QS(e){return _S(this,void 0,void 0,function*(){return yield Pm(e)})}function ZS(e,t,r){const n=e.attributeSet;if(!n||0===n.length)return"";if(n.find(e=>e.title===t))return t;if(1===n.length)return n[0].title;const i=n.some(e=>e.title===Ng),o=n.some(e=>e.title===Og);return r&&o?Og:!r&&i?Ng:n[0].title}function eI(e,t){return _S(this,arguments,void 0,function*(e,t,r=!1,n=!1){const o=e+"/attributeSets";let s=null;const a=i.SessionManager.getInstance().getSessionByUrl(t),l=a&&a.token?a.token:"";s=l?{f:"json",token:l}:{f:"json"};const c={attributeSet:[]};return yield Qf({method:"GET",url:o,params:s}).then(e=>{const t=e.attributeSets;return cf(t)&&t.forEach(e=>{if(r&&e.isPoint!==n)return;const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};c.attributeSet.push(t)}),c}).catch(e=>null)})}function tI(e,t,r,n){const i=r.findIndex(e=>e===qp.Network)>-1,o=r.findIndex(e=>e===qp.LineEvent)>-1,s=r.findIndex(e=>e===qp.PointEvent)>-1,a=r.findIndex(e=>e===qp.Intersection)>-1;if(0===e.length)return nf(t,"noLayersInMap");const l=e.filter(e=>e.layerType===qp.Network).map(e=>e.id);if(i&&0===l.length)return nf(t,"noNetworkLayersInMap");const c=l.filter(e=>!n.includes(e));if(i&&0===c.length)return nf(t,"noNetworkConfig");const u=e.filter(e=>e.layerType===qp.Event&&!e.eventInfo.isPointEvent).map(e=>e.id);if(o&&0===u.length)return nf(t,"noLineEventLayersInMap");const d=u.filter(e=>!n.includes(e));if(o&&0===d.length)return nf(t,"noLineEventConfig");const h=e.filter(e=>e.layerType===qp.Event&&e.eventInfo.isPointEvent).map(e=>e.id);if(s&&0===h.length)return nf(t,"noPointEventLayersInMap");const p=h.filter(e=>!n.includes(e));if(s&&0===p.length)return nf(t,"noPointEventConfig");const f=e.filter(e=>e.layerType===qp.Intersection).map(e=>e.id);if(a&&0===f.length)return nf(t,"noIntersectionLayers");const m=f.filter(e=>!n.includes(e));if(a&&0===m.length)return nf(t,"noIntersectionConfig");const g=e.map(e=>e.lrsId).filter((e,t,r)=>r.indexOf(e)===t);return g.length>1?nf(t,"multipleLrsInWebMap"):0===g.length?nf(t,"noLrsLayersInMap"):null}function rI(e,t){const r=[],n=t.find(e=>e===qp.Event),i=t.find(e=>e===qp.PointEvent),o=t.find(e=>e===qp.LineEvent),s=t.find(e=>e===qp.NonLrsLine),a=t.find(e=>e===qp.NonLrsPoint),l=t.find(e=>e===qp.NonLrs);return e.forEach(e=>{var c,u;const d=e.layerType===qp.Event,h=e.layerType===qp.NonLrs;if(d&&(n||i||o)){const t=e.layerType===qp.Event&&e.eventInfo.isPointEvent,n=e.layerType===qp.Event&&!e.eventInfo.isPointEvent;t&&!i&&r.push(e.id),n&&!o&&r.push(e.id)}if(h&&(l||s||a)){if(e.layerType===qp.NonLrs&&e.isReferent){const t=null===(c=e.nonLrsInfo)||void 0===c?void 0:c.referentProperties.isPoint,n=!(null===(u=e.nonLrsInfo)||void 0===u?void 0:u.referentProperties.isPoint);t&&!a&&r.push(e.id),n&&!s&&r.push(e.id)}else r.push(e.id)}const p=t.includes(qp.Centerline);e.layerType!==qp.Addressing||p||(e.addressingInfo.leftFromAddressFieldNameSchema||e.addressingInfo.leftToAddressFieldNameSchema||e.addressingInfo.rightFromAddressFieldNameSchema||e.addressingInfo.rightToAddressFieldNameSchema)&&r.push(e.id),e.layerType!==qp.UtilityNetwork||p||r.push(e.id),t.includes(e.layerType)||r.push(e.id)}),r}function nI(e,t,r){switch(t){case qp.Network:return`${e}/networkLayers/${r}`;case qp.LineEvent:case qp.PointEvent:case qp.Event:return`${e}/eventLayers/${r}`;case qp.Centerline:return`${e}/centerlineLayers/${r}`;case qp.CalibrationPoint:return`${e}/calibrationPointLayers/${r}`;case qp.Intersection:return`${e}/intersectionLayers/${r}`;case qp.UtilityNetwork:return`${e}/utilityNetworkLayers/${r}`;case qp.Addressing:return`${e}/addressLayers/${r}`;case qp.NonLrsLine:case qp.NonLrsPoint:case qp.NonLrs:return`${e}/nonLrsLayers/${r}`}}function iI(e){const t=new Map;return e&&0!==e.length?(e.forEach(e=>{var r,n;const i=null===(r=null==e?void 0:e.getDataSourceJson())||void 0===r?void 0:r.url,o=i?jS(i):null;o&&(t.has(o)?null===(n=t.get(o))||void 0===n||n.push(e.id):t.set(o,[e.id]))}),t):t}function oI(e,t,r,n){return _S(this,void 0,void 0,function*(){var i,o;try{const s=yield Qf({method:"GET",url:r,params:t});if(s){const a=null===(i=null==s?void 0:s.lrs[0])||void 0===i?void 0:i.id,l=null===(o=null==s?void 0:s.lrs[0])||void 0===o?void 0:o.name;return sI(e,t,r,n,a,l)}return aI(e,n)}catch(e){return[]}})}const sI=(e,t,r,n,i,o)=>_S(void 0,void 0,void 0,function*(){try{const s=yield Qf({method:"GET",url:r+"/layers",params:t});return cI(e,s,n,i,o)}catch(e){return[]}}),aI=(e,t)=>_S(void 0,void 0,void 0,function*(){return cI(e,null,t,"","")}),lI={[qp.Network]:"networkLayers",[qp.Event]:"eventLayers",[qp.Centerline]:"centerlineLayers",[qp.CalibrationPoint]:"calibrationPointLayers",[qp.Intersection]:"intersectionLayers",[qp.UtilityNetwork]:"utilityNetworkLayers",[qp.Addressing]:"addressLayers",[qp.NonLrs]:"nonLRSLayers",[qp.LineEvent]:"lineEventLayers",[qp.PointEvent]:"pointEventLayers",[qp.NonLrsPoint]:"nonLrsPointLayers",[qp.NonLrsLine]:"nonLrsLineLayers"};function cI(e,t,r,n,o){return _S(this,void 0,void 0,function*(){const s=new Map,a=new Map;if(t)for(const[e,r]of Object.entries(lI)){const n=t[r];Array.isArray(n)&&n.forEach(t=>{const r=Number.parseInt(t.id);s.set(r,e),a.set(r,t)})}return yield Promise.all(r.map(t=>_S(this,void 0,void 0,function*(){try{const r=yield i.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,i.Immutable)(t));if(!r)return null;const l=yield cm(r),c=Number.parseInt(l.layerId),u=s.get(c),d=a.get(c),h=r.url,p=jS(h),f=nI(p,u,c),m=r.getGeometryType(),g=null==r?void 0:r.getSchema(),v=(u===qp.Event||u===qp.CalibrationPoint||u===qp.Intersection||u===qp.NonLrs)&&"esriGeometryPoint"===m;let y={},S={},I={},w={},E={},b={},R={},T={};switch(u){case qp.Network:y=US(e,l,d,f,g);break;case qp.Event:S=BS(d,f,g,l),v&&(S.referentProperties=qS(l,f,g));break;case qp.Intersection:I=VS(d,f,g),v&&(I.referentProperties=qS(l,f,g));break;case qp.Centerline:w=$S(d,f,g);break;case qp.CalibrationPoint:E=GS(d,f,g),v&&(E.referentProperties=qS(l,f,g));break;case qp.UtilityNetwork:b=HS(d,f,g);break;case qp.Addressing:R=WS(d,f,g),v&&(R.referentProperties=qS(l,f,g));break;case qp.NonLrs:T=zS(l,h,g,v)}return{id:r.id,serviceId:c,name:r.getLabel(),originName:r.getLayerDefinition().name,lrsUrl:p,useDataSource:t,layerType:u,networkInfo:y||void 0,eventInfo:S||void 0,intersectionInfo:I||void 0,centerlineInfo:w||void 0,calibrationPointInfo:E||void 0,utilityNetworkInfo:b||void 0,addressingInfo:R||void 0,nonLrsInfo:T||void 0,displayField:l.displayField,useFieldAlias:!0,lrsId:n,lrsName:o,isReferent:v}}catch(e){return console.error("Error processing data source:",e),null}})))})}function uI(e,t,r,n){var i,o,s;if(kS(e.mode,e.lrsLayers)){if("lrsLayers"===t){const t=null===(o=null===(i=e.mapViewsConfig)||void 0===i?void 0:i[r])||void 0===o?void 0:o.lrsLayers;return t||e.lrsLayers}const a=null===(s=e.settingsPerView)||void 0===s?void 0:s[r];return a?null==a?void 0:a[t]:n||e[t]}return e[t]}function dI(e,t,r,n,i,o){var s;if(t.mode===zp.Map){const a=null===(s=t.settingsPerView)||void 0===s?void 0:s[i];if(a){const s=a.set(r,n),l=t.settingsPerView.set(i,s);o({id:e,config:t.set("settingsPerView",l)})}}else o({id:e,config:t.set(r,n)})}function hI(e){return _S(this,void 0,void 0,function*(){var t,r;const n=null===(t=(0,i.getAppStore)())||void 0===t?void 0:t.getState(),o=(0,N.isConflictPreventionEnabledSelector)(e,n);if(null===o){const t=null===(r=(0,i.getAppStore)())||void 0===r?void 0:r.dispatch,n=yield Pm(e);return(0,N.setConflictPreventionEnabled)(e,n,t),n}return o})}(0,n.registerStyles)("widgets/shared-code/lrs/ui",e),(0,n.registerStyles)("widgets/shared-code/lrs/settings-components",t)})(),g})())}}});