System.register(["jimu-theme","jimu-core","jimu-arcgis","calcite-components","jimu-ui","jimu-core/react","jimu-ui/advanced/map"],(function(e,t){var n={},r={},o={},i={},s={},a={},l={};return{setters:[function(e){n.registerStyles=e.registerStyles,n.useTheme=e.useTheme,n.withStyles=e.withStyles,n.withTheme=e.withTheme},function(e){r.JimuFieldType=e.JimuFieldType,r.React=e.React,r.ReactRedux=e.ReactRedux,r.SessionManager=e.SessionManager,r.WidgetState=e.WidgetState,r.classNames=e.classNames,r.css=e.css,r.dataSourceUtils=e.dataSourceUtils,r.esri=e.esri,r.getAppStore=e.getAppStore,r.hooks=e.hooks,r.jsx=e.jsx,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,r.polished=e.polished,r.utils=e.utils},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.CalciteButton=e.CalciteButton,i.CalciteInputDatePicker=e.CalciteInputDatePicker,i.CalciteTable=e.CalciteTable,i.CalciteTableCell=e.CalciteTableCell,i.CalciteTableHeader=e.CalciteTableHeader,i.CalciteTableRow=e.CalciteTableRow},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Checkbox=e.Checkbox,s.FloatingPanel=e.FloatingPanel,s.Icon=e.Icon,s.Label=e.Label,s.Popper=e.Popper,s.Select=e.Select,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages},function(e){a.default=e.default},function(e){l.DrawingElevationMode3D=e.DrawingElevationMode3D}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=i},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=r},68972:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=s},48993:e=>{"use strict";e.exports=l}},t={};function u(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,u),o.exports}u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{AttributeTable:()=>ho,ConvertUnits:()=>X,CopyAttributeTool:()=>ti,GetEsriUnits:()=>ne,GetSRUnits:()=>ee,GetUnits:()=>te,InlineEditableDropdown:()=>po,Intellisense:()=>Ro,IntellisenseTextInput:()=>Do,LockAcquireStatus:()=>To,LockAction:()=>Eo,LockManagerComponent:()=>Xo,LockReleaseStatus:()=>jo,LocksEndpointType:()=>Ao,LrsApplyEdits:()=>Ke,LrsLayerType:()=>li,QueryLock:()=>Co,QueryMapPointWithMeasureOnRoute:()=>Qe,QueryMeasureOnRoute:()=>ze,QueryPolylineOnRoute:()=>Je,QueryRouteMeasures:()=>Be,QueryRouteMeasuresAndDistances:()=>We,ReleasableStatus:()=>Lo,RoutePicker:()=>et,RoutePickerPopup:()=>nt,SearchMethod:()=>ui,VMSEndpoints:()=>Mo,acquireLock:()=>_o,colorBlack:()=>Te,colorCyan:()=>je,convertStationToNumber:()=>de,createLabelLayer:()=>ii,errorMessageDelay:()=>Fe,flash:()=>be,formatMessage:()=>Z,getCalciteBasicTheme:()=>ke,getCalciteButtonWithIconTheme:()=>xe,getDateToUTC:()=>ce,getDateWithTZOffset:()=>Re,getDateWithoutTZOffset:()=>we,getFeatureLayer:()=>He,getGDBVersion:()=>ve,getGeometryGraphic:()=>Ae,getHoverGraphic:()=>Me,getInitialEventInfoState:()=>me,getInitialRouteInfoState:()=>fe,getInitialRouteMeasurePickerInfoState:()=>he,getIntialLocksInfo:()=>Bo,getLocalTimeOffset:()=>Ie,getNetworkOutFields:()=>ie,getPolylineMidPoint:()=>si,getRouteFromEndMeasures:()=>oe,getSimpleLineGraphic:()=>Ce,getSimplePointGraphic:()=>Oe,getSuggestions:()=>ue,getUserSession:()=>pe,getVersionGuid:()=>Go,highlightColor:()=>De,isCodedDomain:()=>lt,isConflictPreventionEnabled:()=>Jo,isDate:()=>st,isDefaultVersion:()=>ye,isDefined:()=>re,isInWidgetController:()=>Ne,isNumber:()=>at,isRangeDomain:()=>ut,isWithinTolerance:()=>ge,messages:()=>Y,queryAllRoutesByLineId:()=>ae,queryEventsByEventObjectIds:()=>qe,queryEventsByRouteIdOrEventObjectId:()=>$e,queryLineId:()=>Ge,queryRouteId:()=>Ye,queryRouteIdOrName:()=>le,queryRouteIds:()=>Ze,queryRoutes:()=>Ve,queryRoutesByLineId:()=>se,releaseLock:()=>qo,removeLabelLayer:()=>oi,requestService:()=>Ue,setRouteInfoByRouteIdOrName:()=>di,shouldQueryRouteLock:()=>Wo,shouldTryAcquireLock:()=>zo,tryAutoReconcile:()=>Vo,tryReleaseLock:()=>$o,tryReleaseLockOnDefault:()=>Uo,validateField:()=>ot,validateRangeDomain:()=>it});var e={};u.r(e),u.d(e,{AttributeTable:()=>r});var t=u(1888),n=u(79244);const r=()=>n.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-attribute-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `;var o=u(62686);const i="object"==typeof global&&global&&global.Object===Object&&global;var s="object"==typeof self&&self&&self.Object===Object&&self;const a=i||s||Function("return this")();var l=/\s/;const d=function(e){for(var t=e.length;t--&&l.test(e.charAt(t)););return t};var f=/^\s+/;const m=function(e){return e?e.slice(0,d(e)+1).replace(f,""):e};const h=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const p=a.Symbol;var v=Object.prototype,y=v.hasOwnProperty,g=v.toString,b=p?p.toStringTag:void 0;const I=function(e){var t=y.call(e,b),n=e[b];try{e[b]=void 0;var r=!0}catch(e){}var o=g.call(e);return r&&(t?e[b]=n:delete e[b]),o};var S=Object.prototype.toString;const w=function(e){return S.call(e)};var R=p?p.toStringTag:void 0;const N=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":R&&R in Object(e)?I(e):w(e)};const k=function(e){return null!=e&&"object"==typeof e};const x=function(e){return"symbol"==typeof e||k(e)&&"[object Symbol]"==N(e)};var F=/^[-+]0x[0-9a-f]+$/i,D=/^0b[01]+$/i,T=/^0o[0-7]+$/i,j=parseInt;const L=function(e){if("number"==typeof e)return e;if(x(e))return NaN;if(h(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=h(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=m(e);var n=D.test(e);return n||T.test(e)?j(e.slice(2),n?2:8):F.test(e)?NaN:+e};var A=1/0;const M=function(e){return e?(e=L(e))===A||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const E=function(e){var t=M(e),n=t%1;return t==t?n?t-n:t:0};const P=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o};const O=Array.isArray;var C=p?p.prototype:void 0,_=C?C.toString:void 0;const U=function e(t){if("string"==typeof t)return t;if(O(t))return P(t,e)+"";if(x(t))return _?_.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};const $=function(e){return null==e?"":U(e)};var q=a.isFinite,V=Math.min;const G=function(e){var t=Math[e];return function(e,n){if(e=L(e),(n=null==n?0:V(E(n),292))&&q(e)){var r=($(e)+"e").split("e"),o=t(r[0]+"e"+(+r[1]+n));return+((r=($(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round");var B=u(99037),W=u(14321),z=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};const Q=1e3;var K;function H(e,t,r){return z(this,void 0,void 0,(function*(){const o={jimuName:e,type:n.JimuFieldType.String,esriType:K.String,name:e,alias:e,format:null};return function(e,t,r){return z(this,void 0,void 0,(function*(){const o={searchText:e,searchFields:r.map((e=>e.name)),dataSource:t,maxSuggestions:Q};return n.dataSourceUtils.querySuggestions(o).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{isFromSuggestion:!0}))),layer:null,icon:null};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,r,[o])}))}!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(K||(K={}));const J={eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."},Y=Object.assign({},J,W.defaultMessages);function Z(e,t,n){return e.formatMessage({id:t,defaultMessage:Y[t]},n)}const X=(e,t,n)=>{if(isNaN(e)||!t||!n||t===n)return e;const r={esriMeters:1,esriDecimalDegrees:899928005759e-17,esriNauticalMiles:.00053995680345572,esriIntNauticalMiles:.00053959318990227,esriMiles:.00062136994949496,esriIntMiles:.00062137119223733,esriKilometers:.001,esriYards:1.093611111115486,esriIntYards:1.093613298337708,esriFeet:3.280833333346457,esriIntFeet:3.280839895013123,esriDecimeters:10,esriInches:39.370078740157,esriIntInches:39.37007874015748,esriCentimeters:100,esriMillimeters:1e3,esriPoints:2834.645669291964};return t in r&&n in r?r[n]/r[t]*e:e};function ee(e){switch(e){case"esriFeet":case"esriIntFeet":return"esriSRUnit_Foot";case"esriMiles":return"esriSRUnit_StatuteMile";case"esriNauticalMiles":return"esriSRUnit_USNauticalMile";case"esriIntNauticalMiles":return"esriSRUnit_NauticalMile";case"esriMeters":return"esriSRUnit_Meter";case"esriKilometers":return"esriSRUnit_Kilometer"}}function te(e,t){switch(e){case"esriInches":return Z(t,"inches");case"esriPoints":return Z(t,"points");case"esriFeet":return Z(t,"feet");case"esriYards":return Z(t,"yards");case"esriMiles":return Z(t,"miles");case"esriNauticalMiles":return Z(t,"nauticalMiles");case"esriMillimeters":return Z(t,"millimeters");case"esriCentimeters":return Z(t,"centimeters");case"esriMeters":return Z(t,"meters");case"esriKilometers":return Z(t,"kilometers");case"esriDecimalDegrees":return Z(t,"decimalDegrees");case"esriDecimeters":return Z(t,"decimeters");case"esriIntFeet":return Z(t,"intFeet");default:return Z(t,"esriUnknownUnits")}}function ne(e,t){switch(e){case Z(t,"inches"):return"esriInches";case Z(t,"points"):return"esriPoints";case Z(t,"feet"):return"esriFeet";case Z(t,"yards"):return"esriYards";case Z(t,"miles"):return"esriMiles";case Z(t,"nauticalMiles"):return"esriNauticalMiles";case Z(t,"millimeters"):return"esriMillimeters";case Z(t,"centimeters"):return"esriCentimeters";case Z(t,"meters"):return"esriMeters";case Z(t,"kilometers"):return"esriKilometers";case Z(t,"decimalDegrees"):return"esriDecimalDegrees";case Z(t,"decimeters"):return"esriDecimeters";case Z(t,"intFeet"):return"esriIntFeet";default:return"unknownUnits"}}function re(e){return null!=e}const oe=e=>{var t;if(re(e)){const n=e;if((null===(t=n.paths)||void 0===t?void 0:t.length)>0){const e=n.getPoint(0,0),t=n.paths[n.paths.length-1].length-1;return[e,n.getPoint(n.paths.length-1,t)]}}return[null,null]},ie=e=>{const t={routeIdFieldName:"",routeNameFieldName:"",fromDateFieldName:"",toDateFieldName:"",lineIdFieldName:"",lineNameFieldName:"",lineOrderFieldName:""};return re(e)&&(t.routeIdFieldName=e.routeIdFieldSchema.name,t.routeNameFieldName=e.useRouteName?e.routeNameFieldSchema.name:"",t.fromDateFieldName=e.fromDateFieldSchema.name,t.toDateFieldName=e.toDateFieldSchema.name,t.lineIdFieldName=re(e.lineIdFieldSchema)?e.lineIdFieldSchema.name:"",t.lineNameFieldName=re(e.lineNameFieldSchema)?e.lineNameFieldSchema.name:"",t.lineOrderFieldName=re(e.lineOrderFieldSchema)?e.lineOrderFieldSchema.name:""),t},se=(e,t,n,r)=>{if(!(re(n)&&re(r)&&e.length&&t.length))return Promise.reject();const o=r.layer,i=o.createQuery();let s;s=(n.useRouteName,e.map((e=>`${n.routeNameFieldSchema.name} = '${e}'`)));const a=s.join(" OR "),l=`${n.lineIdFieldSchema.name} = '${t}' AND (${a})`,u=ie(n);return i.returnM=!0,i.outFields=[u.routeIdFieldName,u.fromDateFieldName,u.toDateFieldName],n.useRouteName&&i.outFields.push(u.routeNameFieldName),i.where=l,o.queryFeatures(i).then((e=>e)).catch((e=>Promise.reject()))},ae=(e,t,n)=>{if(!re(t)||!re(n))return Promise.reject();const r=n.layer,o=r.createQuery(),i=`${t.lineIdFieldSchema.name} = '${e}'`,s=ie(t);return o.returnM=!0,o.outFields=[s.routeIdFieldName,s.fromDateFieldName,s.toDateFieldName,s.lineOrderFieldName],t.useRouteName&&o.outFields.push(s.routeNameFieldName),o.where=i,r.queryFeatures(o).then((e=>e)).catch((e=>Promise.reject()))},le=(e,t,n,r=!1,o=!0,i="",s=null,a=!1)=>{if(!re(t)||!re(n)||!e.length)return Promise.reject();const l=n.layer;let u;if(u=!t.useRouteName||a?`${t.routeIdFieldSchema.name} = '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,re(s)){const e=`TIMESTAMP '${s.toISOString().slice(0,10)}'`;u=`${u} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}let c=u;r&&!o&&re(i)&&(c=`${t.lineIdFieldSchema.name} = '${i}' AND (${u})`);const d=l.createQuery();d.where=c;const f=ie(t);return d.returnM=!0,d.outFields=[f.routeIdFieldName,f.fromDateFieldName,f.toDateFieldName],t.useRouteName&&d.outFields.push(f.routeNameFieldName),t.supportsLines&&(d.outFields.push(f.lineIdFieldName),d.outFields.push(f.lineNameFieldName),d.outFields.push(f.lineOrderFieldName)),l.queryFeatures(d).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))},ue=(e,t,n)=>{const r=[],o=H(e,t,n);return r.push(o),Promise.all(r)},ce=e=>{const t=new Date(e);return re(t)?Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0):null};function de(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=100*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=1e3*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}return NaN}function fe(){return{routeId:"",toRouteId:"",lineId:"",toLineId:"",lineName:"",toLineName:"",routeLineOrder:NaN,toRouteLineOrder:NaN,routeName:"",toRouteName:"",fromMeasure:NaN,toMeasure:NaN,toRouteFromMeasure:NaN,toRouteToMeasure:NaN,fromDate:new Date(Date.now()),toRouteFromDate:new Date(Date.now()),toDate:null,toRouteToDate:null,selectedMeasure:NaN,selectedToMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null,selectedPoint:null,selectedToPoint:null,selectedPolyline:null,selectedToPolyline:null,validRoute:!1,validToRoute:!1}}function me(){return{eventUrl:"",fromDateFieldName:"",toDateFieldName:"",derivedFromMeasureFieldName:"",derivedRouteIdFieldName:"",derivedRouteNameFieldName:"",derivedToMeasureFieldName:"",fromReferentLocationFieldName:"",fromReferentMethodFieldName:"",fromReferentOffsetFieldName:"",toReferentLocationFieldName:"",toReferentMethodFieldName:"",toReferentOffsetFieldName:"",locErrorFieldName:"",eventIdFieldName:"",routeIdFieldName:"",routeNameFieldName:"",fromMeasureFieldName:"",toRouteIdFieldName:"",toRouteNameFieldName:"",toMeasureFieldName:"",lrsFields:null,attributeFields:null,parentNetworkId:NaN,useRouteName:!1,isPointEvent:!1,canSpanRoutes:!1,mergeCoincident:!1,retireOverlapping:!1,datasetName:""}}function he(){return{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1}}function pe(e){return n.SessionManager.getInstance().getSessionByUrl(e)}function ve(e){return e.getGDBVersion()||"sde.DEFAULT"}function ye(e){return"sde.default"===e.toLocaleLowerCase()||""===e}const ge=(e,t,n)=>!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&Math.abs(e-t)<=n,be=(e,t)=>{re(t)&&(e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll()}),800)}),800)}),800)}),800)}),800))};function Ie(e){const t=(new Date).getTimezoneOffset();return(t<0?1:-1)*(t<0?Math.abs(t)/60:t/60)*60*60*1e3+function(e){const t=Se(new Date(Date.now())),n=Se(e);return t&&!n?-36e5:!t&&n?36e5:0}(e)}function Se(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r}function we(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValueWithoutTzOffset(e,t));{const t=Ie(new Date(e));return new Date(e+t)}}function Re(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValue(e,t));{const t=Ie(new Date(e));return new Date(e-t)}}function Ne(e){let t=document.getElementById(e);for(;t&&!t.classList.contains("floating-panel");)if(t=t.parentElement,t&&t.classList.contains("floating-panel"))return!0;for(t=document.getElementById(e);t&&!t.classList.contains("panel-content");)if(t=t.parentElement,t&&t.classList.contains("panel-content"))return!0;return!1}function ke(){return n.css`
    --calcite-color-brand: var(--primary-400);
    --calcite-color-brand-press: var(--primary-400);
    --calcite-color-brand-hover: var(--primary-500);
  `}function xe(){return n.css`
    --calcite-ui-icon-color: var(--dark-900);
    --calcite-color-brand: var(--primary-400);
    --calcite-color-brand-press: var(--primary-400);
    --calcite-color-brand-hover: var(--primary-500);
  `}const Fe=1e4,De="#00FFFF",Te="#000000",je="#00FFFF";var Le=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};const Ae=(e,t,n,r)=>Le(void 0,void 0,void 0,(function*(){var o;switch(t||(t=De),null===(o=null==e?void 0:e.geometry)||void 0===o?void 0:o.type){case"point":return yield Ee(e,t,n).then((e=>e));case"polyline":return yield Pe(e,t,n,r).then((e=>e));default:return null}})),Me=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;const r={type:"simple-marker",style:"circle",size:6,color:Te};return new n({geometry:e.geometry,symbol:r,attributes:e.attributes})})),Ee=(e,t,n=3)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((r=>{let o=null;[o]=r;const i={type:"simple-marker",style:"circle",width:n,color:t||De,outline:{color:Te,width:1}};return new o({geometry:e.geometry,symbol:i,attributes:e.attributes})})),Pe=(e,t,n=9,r=!1)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((o=>{let i=null;[i]=o;let s={};s=r?{type:"simple-line",color:t||De,width:n,style:"solid",marker:{color:t||De,style:"arrow",placement:"end"},outline:{color:Te,width:1}}:{type:"simple-line",color:t||De,width:n,style:"solid",outline:{color:Te,width:1}};return new i({geometry:e.geometry,symbol:s,attributes:e.attributes})})),Oe=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})})),Ce=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})}));var _e=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function Ue(e){return _e(this,void 0,void 0,(function*(){return new Promise((function(t,r){const o={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,o).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function $e(e,t,r,o,i,s){return _e(this,void 0,void 0,(function*(){var a,l,u,c,d,f;const m=o.routeId,h=[];if(!re(o.selectedPoint)&&!re(s))return h;const p=null!==(l=null===(a=t.getTimeInfo())||void 0===a?void 0:a.timeExtent)&&void 0!==l?l:0,v=r.eventInfo.eventUrl.replace("/exts/LRServer/eventLayers",""),y=`${v}/query`,g=yield n.SessionManager.getInstance().getSessionByUrl(v).getToken(v);let b,I,S,w,R=t.getGDBVersion();if(R||(R=""),re(o.selectedPoint)){S=o.selectedPoint.toJSON?o.selectedPoint.toJSON():o.selectedPoint,w=o.distance>e?o.distance:"";let t="";if(r.eventInfo.canSpanRoutes)i.length>0&&(t=`${null===(u=r.eventInfo)||void 0===u?void 0:u.routeIdFieldName} IN ('${i.join("','")}')`);else{if(!(m&&m.length>0))return h;t=`${null===(c=r.eventInfo)||void 0===c?void 0:c.routeIdFieldName} = '${m}'`}if(re(o.fromDate)){if(o.fromDate){const e=`TIMESTAMP '${o.fromDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} <= ${r.eventInfo.fromDateFieldName}`}if(o.toDate){const e=`TIMESTAMP '${o.toDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} > ${r.eventInfo.fromDateFieldName}`}}I=t}else b=[s];let N=null===(f=null===(d=t.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===f?void 0:f.units;N&&(N=ee(N));const k={f:"json",token:g,returnGeometry:!1,time:p,gdbVersion:R,outSR:102100,objectIds:b,where:I,outFields:"*",spatialRel:"esriSpatialRelIntersects",geometryType:"esriGeometryPoint",geometry:S,distance:w,units:N};return Ue({method:"GET",url:y,params:k}).then((e=>_e(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:(k.distance=.2,k.units="esriSRUnit_Meter",Ue({method:"GET",url:y,params:k}).then((e=>_e(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:h})))).catch((e=>h)))})))).catch((e=>h))}))}function qe(e,t){return _e(this,void 0,void 0,(function*(){const n=[],r=null==e?void 0:e.layer,o=r.createQuery();return t.length>0?(o.objectIds=t,r.queryFeatures(o).then((e=>e&&e.features.length>0?e.features:n)).catch((e=>n))):n}))}function Ve(e,t,n){return _e(this,void 0,void 0,(function*(){var r,o;const i=[];let s="";n.routeId.length>0?s=`${t.routeIdFieldSchema.jimuName} = '${n.routeId}'`:n.routeName.length>0&&(s=`${t.routeNameFieldSchema.jimuName} = '${n.routeName}'`);const a={returnGeometry:!0,returnM:!0,returnZ:!0,where:s,orderByFields:[],time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0};return e.query(a).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function Ge(e,t,n){return _e(this,void 0,void 0,(function*(){var r,o;const i=[];let s="";if(!(n.length>0))return i;s=`${t.lineIdFieldSchema.jimuName} = '${n}'`;const a={where:s,time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0,outFields:[t.routeIdFieldSchema.name],notAddFieldsToClient:!0};return e.query(a).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function Be(e,t,r,o,i){return _e(this,void 0,void 0,(function*(){const s=[];if(!re(r)&&r.length)return s;const a=t.networkUrl,l=`${a}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ue({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:o,inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>_e(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{s.push(e.measure)}))})),s):s}))))}))}function We(e,t,r,o,i){return _e(this,void 0,void 0,(function*(){const s=[];if(!re(r)&&r.length)return s;const a=t.networkUrl,l=`${a}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ue({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:o,inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>_e(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{s.push({measure:e.measure,distance:e.distance})}))})),s):s}))))}))}function ze(e,t,r,o,i){return _e(this,void 0,void 0,(function*(){if(!r.length)return null;const s=t.networkUrl,a=`${s}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return Ue({method:"GET",url:a,params:{f:"json",token:l,locations:u,temporalViewDate:o,gdbVersion:c}}).then((e=>_e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Qe(e,t,r,o,i){return _e(this,void 0,void 0,(function*(){if(!r.length)return null;const s=t.networkUrl,a=`${s}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return Ue({method:"GET",url:a,params:{f:"json",token:l,locations:u,temporalViewDate:o,gdbVersion:c,outSR:102100}}).then((e=>_e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Ke(e,t,r){return _e(this,void 0,void 0,(function*(){const o=`${e}/applyEdits`,i=yield n.SessionManager.getInstance().getSessionByUrl(e).getToken(e),s=[];t.edits.forEach((e=>{s.push(e)}));return Ue({method:"POST",url:o,params:{f:"json",token:i,gdbVersion:r,edits:s}}).then((e=>_e(this,void 0,void 0,(function*(){const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))))}))}function He(e){return _e(this,void 0,void 0,(function*(){return yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((t=>{const[n]=t;let r;if(e.url.includes("MapServer")){let t="";t=e.url.substring(0,e.url.indexOf("MapServer")),t+="FeatureServer/"+e.layerId,r=new n({url:t})}else e.layer?r=e.layer:e.itemId&&(r=new n({portalItem:{id:e.itemId,portal:{url:e.portalUrl}}}));return r.load().then((()=>_e(this,void 0,void 0,(function*(){return yield Promise.resolve(r)}))))})).catch((e=>(console.warn(e),null)))}))}function Je(e,t,r,o,i,s,a){return _e(this,void 0,void 0,(function*(){if(!r.length||!o.length)return null;const l=t.networkUrl,u=`${l}/measureToGeometry`,c=yield n.SessionManager.getInstance().getSessionByUrl(l).getToken(l),d=[];d.push({routeId:r,toRouteId:o,fromMeasure:s,toMeasure:a});let f=e.getGDBVersion();f||(f="");return Ue({method:"GET",url:u,params:{f:"json",token:c,locations:d,temporalViewDate:i,gdbVersion:f}}).then((e=>_e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPolyline"===o.geometryType){const i=new r({wkid:e.spatialReference.wkid});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}const Ye=(e,t,n)=>{if(!re(t)||!re(n)||!e.length)return Promise.reject();const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} = '${e}'`,i.orderByFields=[t.fromDateFieldSchema.name],i.returnM=!0,i.outFields=[r.routeIdFieldName,r.fromDateFieldName,r.toDateFieldName],t.useRouteName&&i.outFields.push(r.routeNameFieldName),t.supportsLines&&(i.outFields.push(r.lineIdFieldName),i.outFields.push(r.lineNameFieldName),i.outFields.push(r.lineOrderFieldName)),o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))},Ze=(e,t,n)=>{if(!re(t)||!re(n)||!e.length||0===e.length)return Promise.reject();const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} IN ('${e.join("','")}')`,i.outFields=[r.routeIdFieldName,r.lineIdFieldName,r.lineOrderFieldName],o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))};var Xe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function et(e){const{type:t,active:r,networkDs:i,network:s,routeInfo:a,disabled:l,jimuMapView:u,hoverGraphic:c,isFrom:d=!1,canSpanRoutes:f=!1,useRouteStartMeasure:m=!1,useRouteEndMeasure:h=!1,onActiveChange:p,onRouteInfoUpdated:v,onMultiRouteSelect:y}=e,g=n.React.useRef(null),b=n.React.useRef(null),[I,S]=n.React.useState(null),w=n.React.useRef(!1),R=n.React.useRef(!1);n.React.useEffect((()=>{if(re(i)&&re(u)){const e=i;re(null==e?void 0:e.layer)&&S(null==e?void 0:e.layer)}}),[u,i]),n.React.useEffect((()=>{r?N():k()}),[r]);const N=()=>{g.current=null==u?void 0:u.view.on("pointer-move",T),b.current=null==u?void 0:u.view.on("pointer-down",j)},k=()=>{re(g.current)&&(g.current.remove(),g.current=null),re(b.current)&&(b.current.remove(),b.current=null),R.current&&(R.current=!1),w.current&&(w.current=!1)},x=()=>{re(c)&&c.removeAll()},F=e=>{x(),re(e)&&c.add(e)},D=e=>{const t=I.spatialReference,n=I.createQuery(),r="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);return n.geometry=e,n.units="meters",n.returnGeometry=!0,n.returnM=!0,n.returnZ=!0,n.distance=(null==u?void 0:u.view.resolution)*r,n.spatialRelationship="intersects",n},T=e=>{re(I)&&!w.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((n=>{let r=null,o=null;[r,o]=n,w.current=!0;const l=i.getCurrentQueryParams(),c=null==u?void 0:u.view.toMap(e),m=D(c),h=s.lineIdFieldSchema?s.lineIdFieldSchema.name:"",p=f?a.lineId:"";if(m.outFields=f?[h]:[],(null==l?void 0:l.time)&&(m.timeExtent=new o({start:l.time[0],end:l.time[1]})),m.gdbVersion=l.gdbVersion,"route-measure"===t)I.queryFeatures(m).then((e=>{e.features.forEach((e=>Xe(this,void 0,void 0,(function*(){const t=e.geometry;if(!f||f&&d){const e=r.nearestCoordinate(t,c),n=r.nearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),F(yield Me(yield Oe(e.coordinate))),w.current=!1,!0}if(f&&!d){if(e.attributes[h]===p){const e=r.nearestCoordinate(t,c),n=r.nearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),F(yield Me(yield Oe(e.coordinate))),w.current=!1,!0}}})))),w.current&&(F(null),w.current=!1)}));else{const e=s.routeIdFieldSchema?s.routeIdFieldSchema.name:"",t=s.fromDateFieldSchema?s.fromDateFieldSchema.name:"",n=s.lineIdFieldSchema?s.lineIdFieldSchema.name:"";m.outFields=f?[e,n,t]:[e,t];const o=d?a.routeId:a.toRouteId;I.queryFeatures(m).then((n=>{n.features.forEach((s=>Xe(this,void 0,void 0,(function*(){const l=s.attributes[e],u=Re(s.attributes[t],i).toLocaleDateString(),f=d?a.fromDate.toLocaleDateString():a.toRouteFromDate.toLocaleDateString();if(l===o&&u===f){const e=n.features[0].geometry,t=r.nearestCoordinate(e,c),o=r.nearestVertex(e,c);o.distance<3*m.distance&&(t.coordinate=o.coordinate),F(yield Me(yield Oe(t.coordinate))),w.current=!1}})))),w.current&&(F(null),w.current=!1)}))}}))},j=e=>Xe(this,void 0,void 0,(function*(){re(I)&&!R.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((n=>{let r=null,o=null;[r,o]=n;const l=I.popupEnabled;I.popupEnabled=!1,R.current=!0;const c=null==u?void 0:u.view.toMap(e),g=D(c),b=s.routeNameFieldSchema?s.routeNameFieldSchema.name:"",S=s.routeIdFieldSchema?s.routeIdFieldSchema.name:"",w=s.fromDateFieldSchema.name,N=s.toDateFieldSchema.name,F=s.lineIdFieldSchema?s.lineIdFieldSchema.name:"",T=s.lineNameFieldSchema?s.lineNameFieldSchema.name:"",j=s.lineOrderFieldSchema?s.lineOrderFieldSchema.name:"";g.outFields=[S,w,N],(f||""!==F)&&(g.outFields.push(F),g.outFields.push(T),g.outFields.push(j)),s.useRouteName&&g.outFields.push(b);const L=i.getCurrentQueryParams();(null==L?void 0:L.time)&&(g.timeExtent=new o({start:L.time[0],end:L.time[1]})),g.gdbVersion=L.gdbVersion,!d&&f&&(g.where=`${F} LIKE '%${a.lineId}'`);const A=[];I.queryFeatures(g).then((e=>Xe(this,void 0,void 0,(function*(){"route-measure"===t?yield Promise.all(e.features.map((e=>Xe(this,void 0,void 0,(function*(){const t=e.attributes[S],n=s.useRouteName?e.attributes[b]:"",o=(null==e?void 0:e.attributes[F])||"",l=(null==e?void 0:e.attributes[T])||"",u=(null==e?void 0:e.attributes[j])||"",p=e.attributes[w],v=e.attributes[N],y=oe(e.geometry),I=e.geometry,R=r.nearestCoordinate(I,c),k=r.nearestVertex(I,c);k.distance<3*g.distance&&(R.coordinate=k.coordinate),yield Be(i,s,y,p,t).then((c=>Xe(this,void 0,void 0,(function*(){const g=Math.min(...c),b=Math.max(...c);yield We(i,s,[R.coordinate],p,t).then((c=>{c.forEach((c=>{const S=c.measure;let w=new Date(Date.now());const N=p?Re(p,i):null,k=v?Re(v,i):null;re(k)&&w>k||re(p)&&w<N?w=N:w.setHours(0,0,0,0);let x=new Date(Date.now());re(k)&&x>k?x=k:x.setHours(0,0,0,0),(!re(v)||k>x)&&(x=null);let F=!1;!d||f||a.routeId===t&&a.routeName===n&&a.toRouteId===t&&a.toRouteName===n?d&&f&&!a.validToRoute&&(F=!0):F=!0,d&&o&&a.lineId!==o&&(F=!0);let D=!1;(d&&f&&!a.validToRoute||d&&o&&a.toLineId!==o||d&&!f&&a.routeId===a.toRouteId)&&(D=!0);let T=re(p)?Re(p,i):null,j=re(v)?Re(v,i):null;d&&f&&""!==a.toRouteId&&t!==a.toRouteId&&(T=a.toRouteFromDate,j=a.toRouteToDate);R.coordinate.hasZ=!0;const L={routeId:d?t:a.routeId,toRouteId:d?D?t:a.toRouteId:t,routeName:d?n:a.routeName,toRouteName:d?D?n:a.toRouteName:n,routeLineOrder:d?u:a.routeLineOrder,toRouteLineOrder:d?a.toRouteLineOrder:u,lineId:o,toLineId:o,lineName:l,toLineName:l,fromMeasure:d?G(g,s.measurePrecision):a.fromMeasure,toMeasure:d?G(b,s.measurePrecision):a.toMeasure,toRouteFromMeasure:d?D?G(g,s.measurePrecision):a.toRouteFromMeasure:G(g,s.measurePrecision),toRouteToMeasure:d?D?G(b,s.measurePrecision):a.toRouteToMeasure:G(b,s.measurePrecision),selectedMeasure:d?G(S,s.measurePrecision):a.selectedMeasure,distance:c.distance,selectedToMeasure:d?F?NaN:a.selectedToMeasure:G(S,s.measurePrecision),fromDate:d?re(p)?Re(p,i):null:a.fromDate,toDate:d?re(v)?Re(v,i):null:a.toDate,toRouteFromDate:T,toRouteToDate:j,selectedPoint:d?R.coordinate:a.selectedPoint,isNearestCoordinate:d,selectedToPoint:d?F?null:a.selectedToPoint:R.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?a.selectedToPolyline:e.geometry,selectedFromDate:d?w:a.selectedFromDate,selectedToDate:d?x:a.selectedToDate,validRoute:!!d||a.validRoute,validToRoute:!d||a.validToRoute};if(d){if(m){L.selectedMeasure=L.fromMeasure;const e=r.nearestCoordinate(I,y[0]);L.selectedPoint=e.coordinate}if(h&&(!f||L.routeId===L.toRouteId)){const e=r.nearestCoordinate(I,y[1]);L.selectedToMeasure=L.toRouteToMeasure,L.selectedToPoint=e.coordinate,L.selectedToPolyline=L.selectedPolyline}}else if(h&&f){const e=r.nearestCoordinate(I,y[1]);L.selectedToMeasure=L.toRouteToMeasure,L.selectedToPoint=e.coordinate}if(d)A.push(L);else{A.find((e=>e.routeId===L.routeId&&e.fromDate===L.fromDate))||A.push(L)}}))}))}))))}))))):yield Promise.all(e.features.map((e=>Xe(this,void 0,void 0,(function*(){const t=e.attributes[S],n=e.attributes[w]?Re(e.attributes[w],i):null,o=d?a.routeId:a.toRouteId,l=d?a.fromDate:a.toRouteFromDate;if(t===o&&n.toLocaleDateString()===l.toLocaleDateString()){const t=e.attributes[S],n=s.useRouteName?e.attributes[b]:"",o=e.attributes[w],l=e.attributes[N],u=f?e.attributes[j]:"",m=oe(e.geometry),h=e.geometry,p=r.nearestCoordinate(h,c),v=r.nearestVertex(h,c);v.distance<3*g.distance&&(p.coordinate=v.coordinate),m.push(p.coordinate),yield Be(i,s,m,o,t).then((r=>Xe(this,void 0,void 0,(function*(){const c=Math.min(...r),m=Math.max(...r);yield Be(i,s,[p.coordinate],o,t).then((r=>{r.forEach((r=>{let h=new Date(Date.now());re(l)&&h>l?h=Re(o,i):h.setHours(0,0,0,0);let v=new Date(Date.now());re(l)&&v>l?v=Re(l,i):v.setHours(0,0,0,0),re(l)||(v=null);let y=re(o)?Re(o,i):null,g=re(l)?Re(l,i):null;d&&f&&""!==a.toRouteId&&t!==a.toRouteId&&(y=a.toRouteFromDate,g=a.toRouteToDate);p.coordinate.hasZ=!0;const b={routeId:d?t:a.routeId,toRouteId:d?a.toRouteId:t,routeName:d?n:a.routeName,toRouteName:d?a.toRouteName:n,lineId:a.lineId,toLineId:a.toLineId,lineName:a.lineName,routeLineOrder:d?u:a.routeLineOrder,toRouteLineOrder:d?a.toRouteLineOrder:u,fromMeasure:d?G(c,s.measurePrecision):a.fromMeasure,toMeasure:d?G(m,s.measurePrecision):a.toMeasure,toRouteFromMeasure:d?a.toRouteFromMeasure:G(c,s.measurePrecision),toRouteToMeasure:d?a.toRouteToMeasure:G(m,s.measurePrecision),selectedMeasure:d?G(r,s.measurePrecision):a.selectedMeasure,selectedToMeasure:d?a.selectedToMeasure:G(r,s.measurePrecision),fromDate:d?re(o)?Re(o,i):null:a.fromDate,toDate:d?re(l)?Re(l,i):null:a.toDate,toRouteFromDate:y,toRouteToDate:g,selectedFromDate:a.selectedFromDate,selectedToDate:a.selectedToDate,selectedPoint:d?p.coordinate:a.selectedPoint,selectedToPoint:d?a.selectedToPoint:p.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?a.selectedToPolyline:e.geometry,validRoute:!!d||a.validRoute,validToRoute:!d||a.validToRoute};A.push(b)}))}))}))))}})))))})))).then((()=>{A.length>1?y(A):1===A.length&&((e,t=!1)=>{v(e,t),x()})(A[0],!0)})).finally((()=>{l&&(I.popupEnabled=!1),k(),p(),R.current=!1})).catch((()=>{k(),p(),R.current=!1}))})))}));return(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"select",css:xe(),disabled:!!l||void 0,appearance:r?"solid":"transparent",kind:r?"brand":"neutral",onClick:()=>{p()}})}var tt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function nt(e){const t=n.hooks.useTranslation(J),{isOpen:r,routeInfos:o,useRouteName:i,measurePrecision:s,isFrom:a,jimuMapView:l,graphicLayer:u,onRouteSelect:c,onRouteSelectCancel:d}=e,f=16,m=n.React.useRef(null),[h,p]=n.React.useState({x:0,y:0}),[v,y]=n.React.useState({width:500,height:250});n.React.useEffect((()=>{if(o.length){m.current=o[0];const e=R(),t=N();if(y({width:t,height:e}),b(a,0),re(l)&&re(l.view)){const e=a?o[0].selectedPoint:o[0].selectedToPoint;if(re(e)){const t=null==l?void 0:l.view.toScreen(e);if(t){const e=h;e.x=t.x+f,e.y=t.y+f;const n=w(t.x,t.y,null==l?void 0:l.view);n&&(e.x=n.x+f,e.y=n.y+f),p(e)}}}}}),[o]);const g=e=>tt(this,void 0,void 0,(function*(){b(a,e),m.current=o[e]})),b=(e,t)=>tt(this,void 0,void 0,(function*(){if(re(u)){if(u.removeAll(),e&&re(o[t].selectedPolyline)){const e=yield Ae(yield Ce(o[t].selectedPolyline),je,6);u.add(e)}if(!e&&re(o[t].selectedToPolyline)){const e=yield Ae(yield Ce(o[t].selectedToPolyline),je,6);u.add(e)}}})),I=()=>{re(u)&&u.removeAll()},S=()=>{I(),d()},w=(e,t,n)=>{if(!n)return;const r=N(),o=R(),i=e>=0&&t>=0&&e+r<=window.innerWidth&&t+o<=window.innerHeight,s=n.width-e+32,a=n.height-t+32;return i?null:(e+r>window.innerWidth&&(e=window.innerWidth-r-s),t+o>window.innerHeight&&(t=window.innerHeight-o-a),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},R=n.React.useCallback((()=>{const e=250;return 2===o.length?e:3===o.length?290:4===o.length?330:o.length>=5?370:e}),[o]),N=n.React.useCallback((()=>i?700:500),[i]),k=n.React.useCallback((e=>{p(e)}),[]),x=n.React.useCallback(((e,t)=>{const n=R(),r=N();e.height<=n&&(e.height=n),e.width<=r&&(e.width=r),e.height>370&&(e.height=370),e.width>700&&(e.width=700),y(e),p(t)}),[R,N]);return(0,n.jsx)("div",null,r&&(0,n.jsx)(W.FloatingPanel,{headerTitle:t("selectRouteLabel"),size:v,defaultPosition:h,position:h,disableActivateOverlay:!1,dragBounds:"body",onDrag:k,onResize:x,onLeave:S,onHeaderClose:S},(0,n.jsx)("div",{css:ke()},(null==o?void 0:o.length)&&(0,n.jsx)(B.CalciteTable,{pageSize:5,caption:t("routePicker"),striped:!0,bordered:!0,"selection-mode":"single",scale:"s"},(0,n.jsx)("calcite-table-row",{slot:"table-header"},i&&(0,n.jsx)("calcite-table-header",{heading:t("routeNameLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("routeIdLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("fromDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("toDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("measureLabel")})),o.map(((e,t)=>(0,n.jsx)(B.CalciteTableRow,{key:t,selected:0===t,onCalciteTableRowSelect:()=>{g(t)}},i&&(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},a?e.routeName:e.toRouteName)),(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},a?e.routeId:e.toRouteId)),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.fromDate)?e.fromDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.toDate)?e.toDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},G(a?e.selectedMeasure:e.selectedToMeasure,s))))))),(0,n.jsx)("div",{className:"pt-1 d-flex justify-content-center"},(0,n.jsx)(W.Button,{className:"mr-2",style:{width:"100px"},type:"secondary",onClick:S},t("cancel")),(0,n.jsx)(W.Button,{className:"ml-2",style:{width:"100px"},type:"primary",onClick:()=>{I(),re(m.current)&&c(m.current)}},t("ok"))))))}const rt=function(e){return null===e};function ot(e,t,n){const r={hasError:!1,message:""},o=n,i=(null==o?void 0:o.layer.fields).find((e=>e.name===t));if(i){if(!re(e)&&i.nullable)return r;if(re(e)||i.nullable||(r.hasError=!0,r.message="nonNullable"),"string"==typeof e&&0===e.length&&i.nullable)return r;"string"!=typeof e||0!==e.length||i.nullable||(r.hasError=!0,r.message="nonNullable"),"small-integer"===i.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-32768||t>32767)return!1;return!0}(e)||(r.hasError=!0,r.message="invalidShort"):"integer"===i.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-2147483648||t>2147483647)return!1;return!0}(e)||(r.hasError=!0,r.message="invalidInteger"):"single"===i.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(r.hasError=!0,r.message="invalidSingle"):"double"===i.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(r.hasError=!0,r.message="invalidDouble"):"string"===i.type?function(e,t){if(re(e)&&e.length>t)return!1;return!0}(e,i.length)||(r.hasError=!0,r.message="invalidString"):"date"===i.type&&(function(e){return!isNaN(Date.parse(e))}(e)||(r.hasError=!0,r.message="invalidDate"))}return r}function it(e,t,n){const r={hasError:!1,message:""},o=n,i=(null==o?void 0:o.layer.fields).find((e=>e.name===t)),s=i.domain;if(re(i)&&re(s)&&"range"===i.domain.type){const t=s;if(i.nullable&&(rt(e)||!re(e)||""===e))return r;if("number"==typeof t.minValue&&"number"==typeof t.maxValue){const n=Number(e);isNaN(n)&&(r.hasError=!0,r.message="invalidRange"),(n<t.minValue||n>t.maxValue)&&(r.hasError=!0,r.message="invalidRange")}else if("string"==typeof t.minValue&&"string"==typeof t.maxValue&&"string"==typeof e){const n=new Date(e),o=new Date(t.minValue),i=new Date(t.minValue);(n<o||n>i)&&(r.hasError=!0,r.message="invalidRange")}}return r}function st(e){return"date"===e}function at(e){return"small-integer"===e||"big-integer"===e||"integer"===e||"single"===e||"double"===e||"long"===e}function lt(e){return"coded-value"===e}function ut(e){return"range"===e}const ct=n.React.memo((e=>{const t=n.hooks.useTranslation(J),{fieldInfo:r,isSubtype:o,eventDS:i,selected:s,onSelectionChange:a,onUpdateItem:l}=e,[u,c]=n.React.useState(r.value),[d,f]=n.React.useState(""),[m,h]=n.React.useState(r.error);n.React.useEffect((()=>{if(re(r)){if(c(r.value),h(r.error),re(p.domain)&&lt(p.domain.type))if(re(r.value)){const e=v.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===r.value.toLowerCase():e.code===r.value));re(e)?f(S(e.code,e.name)):f("")}else f("");if(o){const e=y.find((e=>"string"==typeof e.value?e.value.toLowerCase()===r.value.toLowerCase():e.value===r.value));f(e?S(e.value,e.label):"")}}}),[r]);const p=n.React.useMemo((()=>{const e=i,t=(null==e?void 0:e.layer.fields).find((e=>e.name===r.name));return t||(c(t.defaultValue),null)}),[i,r.name]),v=n.React.useMemo((()=>{if(re(p)&&re(p.domain)&&"coded-value"===p.domain.type){const e=p.domain.codedValues.some((e=>null===e.code&&e.name===t("nullLabel")));return p.nullable&&!e&&p.domain.codedValues.unshift({code:null,name:t("nullLabel")}),p.domain}return null}),[p]),y=n.React.useMemo((()=>{if(o){const e=null==i?void 0:i.layer;if(re(e)&&re(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}const t=null==i?void 0:i.getFieldCodedValueList(p.name);if(t)return t}return[]}),[i,p.name,o]),g=e=>{if(e.target.value!==u){if(c(e.target.value),re(r.value)&&re(p.domain)&&lt(p.domain.type)){const e=v.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===r.value.toLowerCase():e.code===r.value));e&&f(S(e.code,e.name))}if(o){const e=y.find((e=>"string"==typeof e.value?e.value.toLowerCase()===r.value.toLowerCase():e.value===r.value));e&&f(S(e.value,e.label))}I(e.target.value,m)}},b=e=>{c(e)},I=(e,t)=>{l(e,t,r.index),a(-1)},S=(e,t)=>re(e)?`${e} - ${t}`:t;return(0,n.jsx)("div",{className:"attribute-table-field"},!s&&(0,n.jsx)("div",{onClick:()=>{r.editable&&a(r.index)},style:{borderRight:m.length?"6px solid red":"none"}},(0,n.jsx)(W.Label,{size:"sm",className:"w-100",style:{textOverflow:"ellipsis",width:100,marginBottom:0,alignItems:"center",textAlign:"left"}},o||re(p.domain)&&lt(p.domain.type)?re(u)?d:t("nullLabel"):"string"==typeof u&&u.length?u:"number"!=typeof u||isNaN(u)?re(u)&&"date"===p.type?new Date(u).toLocaleDateString():t("nullLabel"):u.toString())),s&&!re(p.domain)&&!o&&!st(p.type)&&(0,n.jsx)(W.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!p.nullable,value:u,type:"text",onChange:e=>{b(e.currentTarget.value)},checkValidityOnAccept:e=>{if(!re(e)||r.value===e||!re(r.value)&&!e.length)return r.error.length?{valid:!1,msg:t(r.error)}:{valid:!0};const n=ot(e,r.name,i);return n.hasError?(h(t(n.message)),I(e,n.message),{valid:!1,msg:t(n.message)}):(h(""),I(e,""),{valid:!0})}}),s&&!re(p.domain)&&!o&&st(p.type)&&(0,n.jsx)(B.CalciteInputDatePicker,{scale:"s",valueAsDate:re(u)?new Date(u):null,onCalciteInputDatePickerChange:e=>{var n,o;const s=null===(n=e.target)||void 0===n?void 0:n.valueAsDate;if(r.value===s)return r.error.length?{valid:!1,msg:t(r.error)}:{valid:!0};const a=ot(null===(o=e.target)||void 0===o?void 0:o.valueAsDate,r.name,i);return a.hasError?(h(t(a.message)),I(s,a.message),{valid:!1,msg:t(a.message)}):(h(""),I(s,""),{valid:!0})},placement:"top",overlayPositioning:"fixed"}),s&&re(p.domain)&&!o&&lt(p.domain.type)&&(0,n.jsx)(W.Select,{size:"sm",className:"w-100",value:u,onChange:e=>{g(e)}},v.codedValues.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.code},S(e.code,e.name))))),s&&o&&(0,n.jsx)(W.Select,{size:"sm",className:"w-100",value:u,onChange:e=>{g(e)}},y.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.value},S(e.value,e.label))))),s&&re(p.domain)&&ut(p.domain.type)&&(0,n.jsx)(W.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!p.nullable,value:u,onChange:e=>{b(e.currentTarget.value)},checkValidityOnAccept:e=>{if(r.value===e)return r.error.length?{valid:!1,msg:t(r.error)}:{valid:!0};const n=it(e,r.name,i);return n.hasError?(h(t(n.message)),I(e,n.message),{valid:!1,msg:t(n.message)}):(h(""),I(e,""),{valid:!0})}}))}));const dt=function(){this.__data__=[],this.size=0};const ft=function(e,t){return e===t||e!=e&&t!=t};const mt=function(e,t){for(var n=e.length;n--;)if(ft(e[n][0],t))return n;return-1};var ht=Array.prototype.splice;const pt=function(e){var t=this.__data__,n=mt(t,e);return!(n<0)&&(n==t.length-1?t.pop():ht.call(t,n,1),--this.size,!0)};const vt=function(e){var t=this.__data__,n=mt(t,e);return n<0?void 0:t[n][1]};const yt=function(e){return mt(this.__data__,e)>-1};const gt=function(e,t){var n=this.__data__,r=mt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function bt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bt.prototype.clear=dt,bt.prototype.delete=pt,bt.prototype.get=vt,bt.prototype.has=yt,bt.prototype.set=gt;const It=bt;const St=function(){this.__data__=new It,this.size=0};const wt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Rt=function(e){return this.__data__.get(e)};const Nt=function(e){return this.__data__.has(e)};const kt=function(e){if(!h(e))return!1;var t=N(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const xt=a["__core-js_shared__"];var Ft,Dt=(Ft=/[^.]+$/.exec(xt&&xt.keys&&xt.keys.IE_PROTO||""))?"Symbol(src)_1."+Ft:"";const Tt=function(e){return!!Dt&&Dt in e};var jt=Function.prototype.toString;const Lt=function(e){if(null!=e){try{return jt.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var At=/^\[object .+?Constructor\]$/,Mt=Function.prototype,Et=Object.prototype,Pt=Mt.toString,Ot=Et.hasOwnProperty,Ct=RegExp("^"+Pt.call(Ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const _t=function(e){return!(!h(e)||Tt(e))&&(kt(e)?Ct:At).test(Lt(e))};const Ut=function(e,t){return null==e?void 0:e[t]};const $t=function(e,t){var n=Ut(e,t);return _t(n)?n:void 0};const qt=$t(a,"Map");const Vt=$t(Object,"create");const Gt=function(){this.__data__=Vt?Vt(null):{},this.size=0};const Bt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Wt=Object.prototype.hasOwnProperty;const zt=function(e){var t=this.__data__;if(Vt){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Wt.call(t,e)?t[e]:void 0};var Qt=Object.prototype.hasOwnProperty;const Kt=function(e){var t=this.__data__;return Vt?void 0!==t[e]:Qt.call(t,e)};const Ht=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Vt&&void 0===t?"__lodash_hash_undefined__":t,this};function Jt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Jt.prototype.clear=Gt,Jt.prototype.delete=Bt,Jt.prototype.get=zt,Jt.prototype.has=Kt,Jt.prototype.set=Ht;const Yt=Jt;const Zt=function(){this.size=0,this.__data__={hash:new Yt,map:new(qt||It),string:new Yt}};const Xt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const en=function(e,t){var n=e.__data__;return Xt(t)?n["string"==typeof t?"string":"hash"]:n.map};const tn=function(e){var t=en(this,e).delete(e);return this.size-=t?1:0,t};const nn=function(e){return en(this,e).get(e)};const rn=function(e){return en(this,e).has(e)};const on=function(e,t){var n=en(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function sn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}sn.prototype.clear=Zt,sn.prototype.delete=tn,sn.prototype.get=nn,sn.prototype.has=rn,sn.prototype.set=on;const an=sn;const ln=function(e,t){var n=this.__data__;if(n instanceof It){var r=n.__data__;if(!qt||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new an(r)}return n.set(e,t),this.size=n.size,this};function un(e){var t=this.__data__=new It(e);this.size=t.size}un.prototype.clear=St,un.prototype.delete=wt,un.prototype.get=Rt,un.prototype.has=Nt,un.prototype.set=ln;const cn=un;const dn=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const fn=function(){try{var e=$t(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const mn=function(e,t,n){"__proto__"==t&&fn?fn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var hn=Object.prototype.hasOwnProperty;const pn=function(e,t,n){var r=e[t];hn.call(e,t)&&ft(r,n)&&(void 0!==n||t in e)||mn(e,t,n)};const vn=function(e,t,n,r){var o=!n;n||(n={});for(var i=-1,s=t.length;++i<s;){var a=t[i],l=r?r(n[a],e[a],a,n,e):void 0;void 0===l&&(l=e[a]),o?mn(n,a,l):pn(n,a,l)}return n};const yn=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};const gn=function(e){return k(e)&&"[object Arguments]"==N(e)};var bn=Object.prototype,In=bn.hasOwnProperty,Sn=bn.propertyIsEnumerable,wn=gn(function(){return arguments}())?gn:function(e){return k(e)&&In.call(e,"callee")&&!Sn.call(e,"callee")};const Rn=wn;const Nn=function(){return!1};var kn="object"==typeof exports&&exports&&!exports.nodeType&&exports,xn=kn&&"object"==typeof module&&module&&!module.nodeType&&module,Fn=xn&&xn.exports===kn?a.Buffer:void 0;const Dn=(Fn?Fn.isBuffer:void 0)||Nn;var Tn=/^(?:0|[1-9]\d*)$/;const jn=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Tn.test(e))&&e>-1&&e%1==0&&e<t};const Ln=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var An={};An["[object Float32Array]"]=An["[object Float64Array]"]=An["[object Int8Array]"]=An["[object Int16Array]"]=An["[object Int32Array]"]=An["[object Uint8Array]"]=An["[object Uint8ClampedArray]"]=An["[object Uint16Array]"]=An["[object Uint32Array]"]=!0,An["[object Arguments]"]=An["[object Array]"]=An["[object ArrayBuffer]"]=An["[object Boolean]"]=An["[object DataView]"]=An["[object Date]"]=An["[object Error]"]=An["[object Function]"]=An["[object Map]"]=An["[object Number]"]=An["[object Object]"]=An["[object RegExp]"]=An["[object Set]"]=An["[object String]"]=An["[object WeakMap]"]=!1;const Mn=function(e){return k(e)&&Ln(e.length)&&!!An[N(e)]};const En=function(e){return function(t){return e(t)}};var Pn="object"==typeof exports&&exports&&!exports.nodeType&&exports,On=Pn&&"object"==typeof module&&module&&!module.nodeType&&module,Cn=On&&On.exports===Pn&&i.process;const _n=function(){try{var e=On&&On.require&&On.require("util").types;return e||Cn&&Cn.binding&&Cn.binding("util")}catch(e){}}();var Un=_n&&_n.isTypedArray;const $n=Un?En(Un):Mn;var qn=Object.prototype.hasOwnProperty;const Vn=function(e,t){var n=O(e),r=!n&&Rn(e),o=!n&&!r&&Dn(e),i=!n&&!r&&!o&&$n(e),s=n||r||o||i,a=s?yn(e.length,String):[],l=a.length;for(var u in e)!t&&!qn.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||jn(u,l))||a.push(u);return a};var Gn=Object.prototype;const Bn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Gn)};const Wn=function(e,t){return function(n){return e(t(n))}};const zn=Wn(Object.keys,Object);var Qn=Object.prototype.hasOwnProperty;const Kn=function(e){if(!Bn(e))return zn(e);var t=[];for(var n in Object(e))Qn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const Hn=function(e){return null!=e&&Ln(e.length)&&!kt(e)};const Jn=function(e){return Hn(e)?Vn(e):Kn(e)};const Yn=function(e,t){return e&&vn(t,Jn(t),e)};const Zn=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var Xn=Object.prototype.hasOwnProperty;const er=function(e){if(!h(e))return Zn(e);var t=Bn(e),n=[];for(var r in e)("constructor"!=r||!t&&Xn.call(e,r))&&n.push(r);return n};const tr=function(e){return Hn(e)?Vn(e,!0):er(e)};const nr=function(e,t){return e&&vn(t,tr(t),e)};var rr="object"==typeof exports&&exports&&!exports.nodeType&&exports,or=rr&&"object"==typeof module&&module&&!module.nodeType&&module,ir=or&&or.exports===rr?a.Buffer:void 0,sr=ir?ir.allocUnsafe:void 0;const ar=function(e,t){if(t)return e.slice();var n=e.length,r=sr?sr(n):new e.constructor(n);return e.copy(r),r};const lr=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const ur=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[o++]=s)}return i};const cr=function(){return[]};var dr=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols;const mr=fr?function(e){return null==e?[]:(e=Object(e),ur(fr(e),(function(t){return dr.call(e,t)})))}:cr;const hr=function(e,t){return vn(e,mr(e),t)};const pr=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e};const vr=Wn(Object.getPrototypeOf,Object);const yr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)pr(t,mr(e)),e=vr(e);return t}:cr;const gr=function(e,t){return vn(e,yr(e),t)};const br=function(e,t,n){var r=t(e);return O(e)?r:pr(r,n(e))};const Ir=function(e){return br(e,Jn,mr)};const Sr=function(e){return br(e,tr,yr)};const wr=$t(a,"DataView");const Rr=$t(a,"Promise");const Nr=$t(a,"Set");const kr=$t(a,"WeakMap");var xr="[object Map]",Fr="[object Promise]",Dr="[object Set]",Tr="[object WeakMap]",jr="[object DataView]",Lr=Lt(wr),Ar=Lt(qt),Mr=Lt(Rr),Er=Lt(Nr),Pr=Lt(kr),Or=N;(wr&&Or(new wr(new ArrayBuffer(1)))!=jr||qt&&Or(new qt)!=xr||Rr&&Or(Rr.resolve())!=Fr||Nr&&Or(new Nr)!=Dr||kr&&Or(new kr)!=Tr)&&(Or=function(e){var t=N(e),n="[object Object]"==t?e.constructor:void 0,r=n?Lt(n):"";if(r)switch(r){case Lr:return jr;case Ar:return xr;case Mr:return Fr;case Er:return Dr;case Pr:return Tr}return t});const Cr=Or;var _r=Object.prototype.hasOwnProperty;const Ur=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&_r.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const $r=a.Uint8Array;const qr=function(e){var t=new e.constructor(e.byteLength);return new $r(t).set(new $r(e)),t};const Vr=function(e,t){var n=t?qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Gr=/\w*$/;const Br=function(e){var t=new e.constructor(e.source,Gr.exec(e));return t.lastIndex=e.lastIndex,t};var Wr=p?p.prototype:void 0,zr=Wr?Wr.valueOf:void 0;const Qr=function(e){return zr?Object(zr.call(e)):{}};const Kr=function(e,t){var n=t?qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const Hr=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return qr(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Vr(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Kr(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Br(e);case"[object Symbol]":return Qr(e)}};var Jr=Object.create;const Yr=function(){function e(){}return function(t){if(!h(t))return{};if(Jr)return Jr(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const Zr=function(e){return"function"!=typeof e.constructor||Bn(e)?{}:Yr(vr(e))};const Xr=function(e){return k(e)&&"[object Map]"==Cr(e)};var eo=_n&&_n.isMap;const to=eo?En(eo):Xr;const no=function(e){return k(e)&&"[object Set]"==Cr(e)};var ro=_n&&_n.isSet;const oo=ro?En(ro):no;var io="[object Arguments]",so="[object Function]",ao="[object Object]",lo={};lo[io]=lo["[object Array]"]=lo["[object ArrayBuffer]"]=lo["[object DataView]"]=lo["[object Boolean]"]=lo["[object Date]"]=lo["[object Float32Array]"]=lo["[object Float64Array]"]=lo["[object Int8Array]"]=lo["[object Int16Array]"]=lo["[object Int32Array]"]=lo["[object Map]"]=lo["[object Number]"]=lo[ao]=lo["[object RegExp]"]=lo["[object Set]"]=lo["[object String]"]=lo["[object Symbol]"]=lo["[object Uint8Array]"]=lo["[object Uint8ClampedArray]"]=lo["[object Uint16Array]"]=lo["[object Uint32Array]"]=!0,lo["[object Error]"]=lo[so]=lo["[object WeakMap]"]=!1;const uo=function e(t,n,r,o,i,s){var a,l=1&n,u=2&n,c=4&n;if(r&&(a=i?r(t,o,i,s):r(t)),void 0!==a)return a;if(!h(t))return t;var d=O(t);if(d){if(a=Ur(t),!l)return lr(t,a)}else{var f=Cr(t),m=f==so||"[object GeneratorFunction]"==f;if(Dn(t))return ar(t,l);if(f==ao||f==io||m&&!i){if(a=u||m?{}:Zr(t),!l)return u?gr(t,nr(a,t)):hr(t,Yn(a,t))}else{if(!lo[f])return i?t:{};a=Hr(t,f,l)}}s||(s=new cn);var p=s.get(t);if(p)return p;s.set(t,a),oo(t)?t.forEach((function(o){a.add(e(o,n,r,o,t,s))})):to(t)&&t.forEach((function(o,i){a.set(i,e(o,n,r,i,t,s))}));var v=d?void 0:(c?u?Sr:Ir:u?tr:Jn)(t);return dn(v||t,(function(o,i){v&&(o=t[i=o]),pn(a,i,e(o,n,r,i,t,s))})),a};const co=function(e){return uo(e,5)},fo=u(8547),mo=n.React.memo((e=>{const t=n.hooks.useTranslation(J),{tableIndex:r,eventDS:o,eventLayer:i,fieldInfos:s,useAlias:a,collapable:l,isExpanded:u,onItemChecked:c,onUpdateItem:d,onUpdateAll:f,tableLabel:m,isReset:h}=e,[p,v]=n.React.useState(!1),[y,g]=n.React.useState(""),[b,I]=n.React.useState(NaN),[S,w]=n.React.useState(NaN),[R,N]=n.React.useState(u),[k,x]=n.React.useState(-1),F=n.React.useRef([]),D=n.React.useMemo((()=>{if(re(o)){const e=null==o?void 0:o.layer;if(re(e)&&re(e.subtypes)&&(null==e?void 0:e.subtypes.length)>0)return v(!0),g(e.subtypeField),e.subtypes}return[]}),[o]);n.React.useEffect((()=>{h&&(w(-1),x(-1))}),[h]),n.React.useEffect((()=>{if(re(s)&&p){const e=s.find((e=>e.name.toLowerCase()===y.toLowerCase()));e&&e.value!==b&&I(e.value)}k>-1&&re(F.current)&&(F.current[k].setFocus(),x(-1))}),[s]),n.React.useEffect((()=>{N(u)}),[u]),n.React.useEffect((()=>{if(!isNaN(b)&&re(D)){const e=D.findIndex((e=>e.code===b));if(e>-1){const t=D[e].defaultValues,n=co(s);let r;for(r in t){const e=n.findIndex((e=>e.name===r));e>-1&&(st(n[e].type)?n[e].value=re(t[r])?new Date(t[r]):null:r.toLowerCase()===y.toLowerCase()?n[e].value=b:n[e].value=t[r],n[e].error="")}j(n)}}}),[b]);const T=(e,t,n)=>{if(p){s[n].name.toLowerCase()===y.toLowerCase()?I(e):d(e,t,n,r)}else d(e,t,n,r);x(n)},j=e=>{f(e,r)},L=e=>{const n=re(e.error)&&e.error.length,r=re(e.default)&&e.default.length>0,o=re(e.length)&&!isNaN(e.length);let i=e.type;return o&&(i=t("fieldTypeWithLength",{fieldType:e.type,length:e.length})),n?t("fieldInfoWithError",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel"),editable:e.editable?t("trueKey"):t("falseKey"),error:t(e.error)}):t("fieldInfo",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),editable:e.editable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel")})},A=e=>{w(e),re(F.current)&&k>-1&&F.current[k].setFocus()};return(0,n.jsx)("div",{className:"attributes-table w-100 pt-3 px-3",css:n.css`
  --calcite-color-brand: var(--primary-400);
  --calcite-color-brand-press: var(--primary-400);
  --calcite-color-brand-hover: var(--primary-500);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `},l&&(0,n.jsx)(W.Label,{size:"sm",className:"event-layer-label",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,n.jsx)(W.Checkbox,{checked:R,className:"event-layer-checkbox mr-2",onChange:(e,t)=>{c(t,r),N(t)}}),null==i?void 0:i.name),!l&&(0,n.jsx)(W.Label,{size:"sm",className:"text-truncate w-100 mb-0",centric:!0,style:{textOverflow:"ellipsis",fontWeight:500}},re(m)?m:null==i?void 0:i.name),(0,n.jsx)(B.CalciteTable,{caption:"Attribute Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:l&&!R},(0,n.jsx)(B.CalciteTableRow,{slot:"table-header"},(0,n.jsx)(B.CalciteTableHeader,{heading:t("attribute")}),(0,n.jsx)(B.CalciteTableHeader,{heading:t("value")})),re(s)&&s.map((e=>(0,n.jsx)(B.CalciteTableRow,{key:e.index},(0,n.jsx)(B.CalciteTableCell,{alignment:"center"},(0,n.jsx)("div",{className:"w-100 d-flex"},(0,n.jsx)(W.Label,{title:L(e),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},a?e.alias:e.name),!e.editable&&(0,n.jsx)(W.Icon,{className:"ml-auto my-auto",icon:fo,size:16,style:{alignItems:"center"}}))),(0,n.jsx)(B.CalciteTableCell,{alignment:"center",ref:t=>{F.current[e.index]=t},onKeyDown:t=>{((e,t)=>{"Enter"===e.key&&w(t)})(t,e.index)}},(0,n.jsx)(ct,{eventDS:o,isSubtype:e.name.toLowerCase()===y.toLowerCase(),fieldInfo:e,useAlias:a,selected:S===e.index,onSelectionChange:A,onUpdateItem:T})))))))})),ho=(0,t.withTheme)((0,t.withStyles)(mo,"AttributeTable")),po=n.React.memo((e=>{const{label:t,isDisabled:r,defaultItem:o,listItems:i,altItemDescriptions:s,onSelectionChanged:a}=e,[l,u]=n.React.useState(!1),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(!1);n.React.useEffect((()=>{f&&(d.current&&d.current.focus(),c.current&&c.current.setFocus(),m(!1))}),[f]);return(0,n.jsx)("div",{className:"inline-editing-dropdown",css:xe()},t.length>0&&(0,n.jsx)(W.Label,{size:"sm",centric:!0,className:"text-truncate pb-0 mb-0 pt-3 px-3 w-100",style:{textOverflow:"ellipsis",fontWeight:500}},t),(!l||r)&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(W.Label,{size:"sm",centric:!0,className:"text-truncate d-flex pb-0 mb-0 w-100",style:{textOverflow:"ellipsis"}},(()=>{if(s){const e=i.findIndex((e=>e===o));return e>-1?s[e]:o}return o})()),(0,n.jsx)(B.CalciteButton,{ref:c,className:(0,n.classNames)("inline-editing-edit__action",{"d-none":1===i.length||r}),scale:"s",disabled:r||i.length<=1,iconStart:"pencil",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!0)}})),l&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(W.Select,{ref:d,className:"w-100",size:"sm",value:o,onChange:e=>{var t;t=e.target.value,m(!0),u(!1),a(t)}},i.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e}," ",((e,t)=>s&&(null==s?void 0:s.length)>0?s[e]:t)(t,e))))),(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"x",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!1)}})))})),vo=(e,t)=>{var r,o,i,s,a,l,u,c,d,f,m,h,p,v,y;return n.css`
    & {
      width: ${n.polished.rem(null===(r=null==t?void 0:t.current)||void 0===r?void 0:r.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${n.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(o=null==e?void 0:e.sys.color)||void 0===o?void 0:o.secondary)||void 0===i?void 0:i.dark};
      background-color: ${null===(a=null===(s=null==e?void 0:e.ref.palette)||void 0===s?void 0:s.neutral)||void 0===a?void 0:a[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(l=null==e?void 0:e.ref.palette)||void 0===l?void 0:l.black};
      background-color: ${null===(c=null===(u=null==e?void 0:e.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==e?void 0:e.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(m=null===(f=null==e?void 0:e.ref.palette)||void 0===f?void 0:f.neutral)||void 0===m?void 0:m[200]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(h=null==e?void 0:e.sys.color)||void 0===h?void 0:h.primary.main};
      color: ${null===(p=null==e?void 0:e.ref.palette)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(v=null==e?void 0:e.ref.palette)||void 0===v?void 0:v.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(y=null==e?void 0:e.ref.palette)||void 0===y?void 0:y.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${n.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${n.polished.rem(40)};
      margin-top: ${n.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${n.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${n.polished.rem(11)};
        min-height: ${n.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${n.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${n.polished.rem(8)};
          min-height: ${n.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${n.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},yo=[0,3],{useEffect:go,useRef:bo}=n.React,Io=e=>{const r=bo(null),o=bo(null),{children:i,isOpen:s,reference:a,searchInputRef:l,autoFocus:u,className:c,isFocusWidtSearchInput:d,id:f,offset:m,version:h,toggle:p}=e,v=(0,t.useTheme)(),y=n.ReactRedux.useSelector((e=>{var t;const n=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==n?void 0:n[f])||void 0===t?void 0:t.state}));go((()=>{var e;return(null==l?void 0:l.current)&&d&&(null===(e=l.current)||void 0===e||e.addEventListener("keydown",g,!0)),()=>{var e;d&&(null===(e=l.current)||void 0===e||e.removeEventListener("keydown",g,!0))}}),[]);const g=n.hooks.useEventCallback((e=>{if(!s)return!1;const t=S()||[],n=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?o.current=setTimeout((()=>{t[n].focus()})):"ArrowDown"===e.key&&(o.current=setTimeout((()=>{t[0].focus()})))})),b=n.hooks.useEventCallback((e=>{if(!s)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),s&&t))if(clearTimeout(o.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=S();let n=t.indexOf(e.target),i=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(n=0!==n?n-1:t.length-1,i=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(i=!1,n=n===t.length-1?0:n+1);const s=0===n&&!i,a=n===t.length-1&&i;o.current=d&&(s||a)?setTimeout((()=>{var e;null===(e=l.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(r.current.querySelectorAll(".popper-box"))[0].focus(),t[n].focus()}))}else if("End"===e.key){const e=S();o.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=S();o.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=S(),n=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===n){o.current=setTimeout((()=>{t[e].focus()}));break}}}})),I=e=>{var t;e.preventDefault(),w(e),null===(t=null==l?void 0:l.current)||void 0===t||t.focus()},S=()=>r?Array.prototype.slice.call(r.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],w=e=>{p(e)};return(0,n.jsx)("div",null,(0,n.jsx)(W.Popper,{autoFocus:u,placement:"bottom-start",open:s,toggle:w,css:vo(v,a),reference:a,version:h,className:(0,n.classNames)("result-list-popper",c,{"hide-popper":y===n.WidgetState.Closed}),offset:m||yo,popperNodeRef:r},(0,n.jsx)("div",{onKeyDown:b},i)))},{useRef:So}=n.React,wo=new(0,n.esri.Sanitizer),Ro=n.React.memo((e=>{const r=n.hooks.useTranslation(J),{className:o,reference:i,searchSuggestion:s,isOpen:a,searchText:l,id:u,searchInputRef:c,toggel:d,onRecordItemClick:f}=e,m=(0,t.useTheme)(),h=So(!1),p=()=>{if((null==s?void 0:s.length)<2)return!1;let e=0,t=0;return null==s||s.forEach((n=>{var r;const o=null==n?void 0:n.icon;o&&(e+=1),(null===(r=n.suggestionItem)||void 0===r?void 0:r.length)>0&&o&&(t+=1)})),t>0&&e>0},v=(e,t=!1)=>{const r=null==e?void 0:e.suggestionItem;return null==r?void 0:r.map(((r,o)=>{const i=wo.sanitize(r.suggestionHtml);return(0,n.jsx)(W.Button,{className:(0,n.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":t}),key:`${null==e?void 0:e.layer}${o}`,title:r.suggestion,role:"button",onClick:()=>{(e=>{f(e)})(r.suggestion)}},(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))};return(0,n.jsx)("div",null,(0,n.jsx)(Io,{isOpen:a,autoFocus:!1,reference:i,searchInputRef:c,isFocusWidtSearchInput:!0,toggle:d,id:u,className:(0,n.classNames)("result-list-con suggestion-list-con",o)},(()=>{let e=[];s.forEach((t=>{const n=(null==t?void 0:t.suggestionItem)||[];e=e.concat(n)}));return l&&0===e.length})()&&(0,n.jsx)(W.Button,{role:"button",className:"text-center py-2",disabled:!0,title:r("noResult",{searchText:l})},r("noResult",{searchText:l})),(h.current=null,null==s?void 0:s.map(((e,t)=>{var r,o,i;const a=(null==s?void 0:s.length)>1&&(null===(r=null==e?void 0:e.suggestionItem)||void 0===r?void 0:r.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${t}`,role:"group","aria-label":null==e?void 0:e.layer},a&&(0,n.jsx)(W.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(W.Icon,{className:"mr-2",color:null===(o=null==m?void 0:m.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null===(i=null==e?void 0:e.icon)||void 0===i?void 0:i.svg}),null==e?void 0:e.layer),v(e,p()))})))))}));const No=function(){return a.Date.now()};var ko=Math.max,xo=Math.min;const Fo=function(e,t,n){var r,o,i,s,a,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,i=o;return r=o=void 0,u=t,s=e.apply(i,n)}function p(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-u>=i}function v(){var e=No();if(p(e))return y(e);a=setTimeout(v,function(e){var n=t-(e-l);return d?xo(n,i-(e-u)):n}(e))}function y(e){return a=void 0,f&&r?m(e):(r=o=void 0,s)}function g(){var e=No(),n=p(e);if(r=arguments,o=this,l=e,n){if(void 0===a)return function(e){return u=e,a=setTimeout(v,t),c?m(e):s}(l);if(d)return clearTimeout(a),a=setTimeout(v,t),m(l)}return void 0===a&&(a=setTimeout(v,t)),s}return t=L(t)||0,h(n)&&(c=!!n.leading,i=(d="maxWait"in n)?ko(L(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=l=o=a=void 0},g.flush=function(){return void 0===a?s:y(No())},g},Do=n.React.memo((e=>{const{reset:t,widgetId:r,fieldName:o,fieldType:i,dataSource:s,isDataSourceReady:a,onChange:l,onAccept:u}=e,c=n.hooks.useTranslation(J),d=n.React.useRef(null),f=n.React.useRef((e=>{})),m=n.React.useRef(null),h=n.React.useRef(null),p=n.React.useRef(null),v=n.React.useRef(null),y=n.React.useRef(!1),g=n.React.useRef(!1),[b,I]=n.React.useState(null),[S,w]=n.React.useState(!1),[R,N]=n.React.useState([]);n.React.useEffect((()=>{I(null),F(null),setTimeout((()=>{h.current.select(),h.current.focus(),h.current.blur()}),200)}),[t]),n.React.useEffect((()=>{f.current=Fo(x,400)}),[]);const k=n.React.useMemo((()=>s),[s]),x=n.hooks.useEventCallback((e=>{const t=ue(o,e,s);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];t&&N(t),m.current&&w(!0)})).catch((e=>{}))})),F=e=>{re(m)&&""!==m.current&&""===e&&setTimeout((()=>{h.current.select(),h.current.focus(),h.current.blur()}),200)},D=e=>{m.current=e,I(e)},T=()=>{var e;null===(e=h.current)||void 0===e||e.focus(),j(!0,!1)},j=(e=!1,t=!0)=>{e||(g.current=!1)};return(0,n.jsx)("div",{className:"route-input"},(0,n.jsx)("div",{ref:d,className:"d-flex w-100"},(0,n.jsx)(W.TextInput,{"aria-label":c("routeIdLabel"),type:"text",className:"w-100",size:"sm",allowClear:!!b,disabled:!a,onBlur:()=>{p.current=setTimeout((()=>{y.current||w(!1),g.current||j(!1)}),200)},value:b||"",ref:h,onChange:e=>{var t;v.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,r=(null==n?void 0:n.length)>2;if(F(n),D(n),l(n),!r)return w(!1),!1;f.current(n)},checkValidityOnAccept:e=>new Promise((t=>{setTimeout((()=>{v.current&&(e=v.current);const r=k,s={};i===n.JimuFieldType.Number?s.where=`${o} LIKE ${e}`:s.where=`LOWER(${o}) LIKE LOWER('${e}')`;const a=r.queryCount(s).then((t=>0===t.count&&e.length>0?(u(e,!1),{valid:!1,msg:c("invalidRouteField")}):(u(e,!0),{valid:!0}))).catch((t=>(u(e,!1),{valid:!1})));t(a)}),200)}))}),b&&(0,n.jsx)(Ro,{isOpen:(S||(y.current=!1),S),reference:d,searchText:b,searchSuggestion:R,onRecordItemClick:(e,t)=>{if(t)return T(),!1;v.current=e,D(e)},id:r,searchInputRef:h})))}));var To,jo,Lo,Ao,Mo,Eo,Po=u(68972);!function(e){e.EsriSuccess="esriSuccess",e.EsriReconcileRequired="esriReconcileRequired",e.EsriWrongReconcileVersion="esriWrongReconcileVersion",e.EsriConflictsDuringReconcile="esriConflictsDuringReconcile",e.EsriCouldNotAcquireAllLocks="esriCouldNotAcquireAllLocks",e.EsriActiveEditSessionOnVersion="esriActiveEditSessionOnVersion"}(To||(To={})),function(e){e.EsriSuccess="esriSuccess",e.EsriPostRequired="esriPostRequired",e.EsriWrongPostVersion="esriWrongPostVersion",e.EsriCouldNotReleaseAllLocks="esriCouldNotReleaseAllLocks",e.EsriCouldNotReleaseAllLocksPostRequired="esriCouldNotReleaseAllLocksPostRequired",e.EsriCouldNotReleaseAllLocksOwnedByOtherUsers="esriCouldNotReleaseAllLocksOwnedByOtherUsers",e.EsriCouldNotReleaseAllLocksActiveEditSession="esriCouldNotReleaseAllLocksActiveEditSession",e.EsriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault="esriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault"}(jo||(jo={})),function(e){e.No="no",e.Yes="yes",e.OnPost="onPost",e.Undefined="undefined"}(Lo||(Lo={})),function(e){e[e.Acquire=0]="Acquire",e[e.Release=1]="Release",e[e.Query=2]="Query",e[e.Locks=3]="Locks"}(Ao||(Ao={})),function(e){e[e.Reconcile=0]="Reconcile",e[e.Versions=1]="Versions",e[e.StartRead=2]="StartRead",e[e.StopRead=3]="StopRead",e[e.StartEdit=4]="StartEdit",e[e.StopEdit=5]="StopEdit"}(Mo||(Mo={})),function(e){e[e.Query=0]="Query",e[e.QueryAndAcquire=1]="QueryAndAcquire",e[e.QueryAndRelease=2]="QueryAndRelease",e[e.Acquire=3]="Acquire",e[e.Release=4]="Release",e[e.Clear=5]="Clear",e[e.None=6]="None"}(Eo||(Eo={}));var Oo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function Co(e,t,r){return Oo(this,void 0,void 0,(function*(){if(!Yo(t,e,!1))return t;const o=pe(e.url);return function(e){return Oo(this,void 0,void 0,(function*(){const t=Qo(e,Ao.Locks),r={f:"json",token:(0,n.getAppStore)().getState().token};return yield Ue({method:"GET",url:t,params:r}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs[0])||void 0===t?void 0:t.lockTableFields)||null}))}))}(e.url).then((n=>function(e,t,n,r,o){return Oo(this,void 0,void 0,(function*(){const i=Qo(e.url,Ao.Query);let s=`${n.routeIdFieldName} IN ('${t.routeOrLineId.join("','")}')`;s+=` AND ${n.networkIdFieldName} IN (${t.networkId.toString()})`;return Ue({method:"GET",url:i,params:{f:"json",token:r.token,where:s,returnReleasableStatus:o}}).then((e=>e))}))}(e,t,n,o,r).then((e=>re(e)?(t.details=e.locks,t):(t.details=[],t)))))}))}function _o(e,t){return Oo(this,void 0,void 0,(function*(){const n={acquireStatus:To.EsriCouldNotAcquireAllLocks,acquiredLocks:[],unavailableLocks:[]};if(!Yo(t,e,!0))return n;const r=pe(e.url),o=ve(e),i=Qo(e.url,Ao.Acquire),s=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?s.push({lineId:t.routeOrLineId[n],layerId:e}):s.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ue({method:"GET",url:i,params:{f:"json",token:r.token,editVersion:o,acquireLocks:s}}).then((e=>e))}))}function Uo(e,t){return Oo(this,void 0,void 0,(function*(){if(!Yo(t,e,!0))return!1;if(ye(ve(e))){return(yield qo(e,t)).releaseStatus===jo.EsriSuccess}}))}function $o(e,t,n){return Oo(this,void 0,void 0,(function*(){if(!re(t)||!re(n))return!1;const r=pe(e.url),o=ve(e);if(t.user===r.username&&t.versionName===o&&n.eventServiceLayerIds.includes(t.layerId))return!0;if(t.releasableStatus===Lo.Yes){const r={routeOrLineId:[t.routeId],eventServiceLayerIds:[t.layerId],isLine:[n.isLine[0]],networkId:[t.lrsNetworkId],status:n.status,details:[],routeInfo:n.routeInfo,lockAction:n.lockAction};return(yield qo(e,r)).releaseStatus===jo.EsriSuccess}}))}function qo(e,t){return Oo(this,void 0,void 0,(function*(){if(!Yo(t,e,!0))return null;const n=Qo(e.url,Ao.Release),r=pe(e.url),o=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?o.push({lineId:t.routeOrLineId[n],layerId:e}):o.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ue({method:"GET",url:n,params:{f:"json",token:r.token,releaseLocks:o}}).then((e=>e))}))}function Vo(e){return Oo(this,void 0,void 0,(function*(){const t=pe(e.url),r=yield Go(e.url,ve(e));if(!re(r)||""===r)return!1;const o=r.replace("{","").replace("}",""),i=Ko(e.url,Mo.Reconcile,o);let s="{"+n.utils.getUUID()+"}";s=s.replace(/[_]/g,"-");const a={token:t.token,sessionId:s,abortIfConflicts:!0,conflictDetection:"byAttribute",withPost:!0,saveEdits:!0},l=Ko(e.url,Mo.StartRead,o),u=Ko(e.url,Mo.StartEdit,o),c=Ko(e.url,Mo.StopRead,o),d=Ko(e.url,Mo.StopEdit,o);let f=!1;return yield Ue({method:"POST",url:l,params:a}).then((e=>Oo(this,void 0,void 0,(function*(){e.success&&(yield Ue({method:"POST",url:u,params:a}).then((e=>Oo(this,void 0,void 0,(function*(){e.success&&(yield Ue({method:"POST",url:i,params:a}).then((e=>Oo(this,void 0,void 0,(function*(){e.success&&(f=!0,yield Ue({method:"POST",url:d,params:a}).then((e=>Oo(this,void 0,void 0,(function*(){e.success&&(yield Ue({method:"POST",url:c,params:a}).then((e=>{})))})))))})))))})))))})))),f}))}function Go(e,t){return Oo(this,void 0,void 0,(function*(){if(ye(t))return"";const n=Ko(e,Mo.Versions),r={f:"json",token:pe(e).token};return yield Ue({method:"GET",url:n,params:r}).then((e=>{let n="";return e.versions.forEach((e=>{e.versionName===t&&(n=e.versionGuid)})),n}))}))}function Bo(){return{routeInfo:null,networkId:[],routeOrLineId:[],eventServiceLayerIds:[],isLine:[],status:To.EsriSuccess,details:[],lockAction:Eo.None}}function Wo(e){return""!==e.routeId||""!==e.lineId}function zo(e,t){if(0===t.details.length)return!0;const n=pe(e.url),r=t.details.filter((e=>e.user===n.username));if(0===r.length)return!0;const o=ve(e),i=r.filter((e=>e.versionName===o));if(0===i.length)return!0;const s=Object.assign([],t.eventServiceLayerIds);for(let e=0;e<i.length;e++){if(""===i[e].eventFeatureClassName)return!1;re(s)&&s.includes(i[e].layerId)&&s.splice(s.indexOf(i[e].layerId),1)}return!re(s)||0!==s.length}function Qo(e,t){let n=Ho(e);switch(n+="MapServer/exts/LRServer/",t){case Ao.Acquire:n+="Locks/acquire";break;case Ao.Release:n+="Locks/release";break;case Ao.Query:n+="Locks/query";break;case Ao.Locks:n+="locks"}return n}function Ko(e,t,n){let r=Ho(e);switch(r+="VersionManagementServer/",t){case Mo.Reconcile:r+=`versions/${n}/reconcile`;break;case Mo.Versions:r+="versions";break;case Mo.StartRead:r+=`versions/${n}/startReading`;break;case Mo.StopRead:r+=`versions/${n}/stopReading`;break;case Mo.StartEdit:r+=`versions/${n}/startEditing`;break;case Mo.StopEdit:r+=`versions/${n}/stopEditing`}return r}function Ho(e){return e.includes("MapServer")?e.substring(0,e.lastIndexOf("MapServer")):e.includes("FeatureServer")?e.substring(0,e.lastIndexOf("FeatureServer")):""}function Jo(e){return Oo(this,void 0,void 0,(function*(){const t=Qo(e,Ao.Locks),r={f:"json",token:(0,n.getAppStore)().getState().token};return yield Ue({method:"GET",url:t,params:r}).then((e=>(null==e?void 0:e.lrs[0].conflictPreventionEnabled)||!1))}))}function Yo(e,t,n){return!(!re(e)||!re(t))&&!(n&&!function(e){return e.eventServiceLayerIds.length===e.routeOrLineId.length&&e.eventServiceLayerIds.length===e.isLine.length}(e))}var Zo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};class Xo extends Po.default.PureComponent{constructor(e){super(e),this.state={lockInfo:null,toastMsg:"",toastMsgType:"warning",toastOpen:!1}}componentDidUpdate(e){return Zo(this,void 0,void 0,(function*(){if(this.props.conflictPreventionEnabled){if(this.hasNullProps())return void this.clearMessage();if(!this.didChange(e))return void this.clearMessage();if(this.doAction())switch(this.props.lockInfo.lockAction){case Eo.Acquire:yield this.doAcquireLock();break;case Eo.QueryAndAcquire:yield this.doQueryAndAcquireLock();break;case Eo.QueryAndRelease:yield this.doQueryAndReleaseLock();break;case Eo.Query:yield this.doQueryLock();break;case Eo.Release:yield this.doReleaseLock();break;case Eo.Clear:this.clearMessage();case Eo.None:}else this.clearMessage()}}))}clearMessage(){re(this.props.lockInfo)&&this.props.lockInfo.lockAction===Eo.Clear&&(this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.props.onMessageClear&&this.props.onMessageClear())}shouldClearMessageState(){return""===this.state.toastMsg||!(!re(this.props.lockInfo)||!re(this.state.lockInfo)||this.props.lockInfo.routeOrLineId===this.state.lockInfo.routeOrLineId||this.props.lockInfo.networkId===this.state.lockInfo.networkId||this.props.lockInfo.eventServiceLayerIds===this.state.lockInfo.eventServiceLayerIds)}hasNullProps(){var e;return!re(this.props.lockInfo)||(!re(null===(e=this.props.lockInfo)||void 0===e?void 0:e.routeInfo)||!re(this.props.featureDS))}didChange(e){return!(re(e.lockInfo)||!re(this.props.lockInfo))||(e.lockInfo.networkId.toString()!==this.props.lockInfo.networkId.toString()||(e.lockInfo.eventServiceLayerIds.toString()!==this.props.lockInfo.eventServiceLayerIds.toString()||(!(re(e.featureDS)||!re(this.props.featureDS))||(!(!re(e.featureDS)||!re(this.props.featureDS)||e.featureDS.id===this.props.featureDS.id)||(!(re(e.lockInfo.routeInfo)||!re(this.props.lockInfo.routeInfo))||(e.lockInfo.routeInfo.routeId!==this.props.lockInfo.routeInfo.routeId||(e.lockInfo.routeInfo.lineId!==this.props.lockInfo.routeInfo.lineId||e.lockInfo.lockAction!==this.props.lockInfo.lockAction)))))))}doAction(){return!!re(this.props.lockInfo.routeInfo)&&(!(!re(this.props.lockInfo.routeInfo.routeId)||""===this.props.lockInfo.routeInfo.routeId)&&(!(!re(this.props.lockInfo.networkId)||0===this.props.lockInfo.networkId.length)&&(!(!re(this.props.lockInfo.eventServiceLayerIds)||0===this.props.lockInfo.eventServiceLayerIds.length)&&!!re(this.props.featureDS))))}doQueryLock(){return Zo(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Co(this.props.featureDS,e,!0);this.setState({lockInfo:e}),this.props.onQueryComplete&&this.props.onQueryComplete(t,!0)}))}doQueryAndAcquireLock(){return Zo(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Co(this.props.featureDS,e,!1);if(zo(this.props.featureDS,t)){let n=yield _o(this.props.featureDS,t);if(n.acquireStatus===To.EsriReconcileRequired){(yield Vo(this.props.featureDS))&&(n=yield _o(this.props.featureDS,t))}this.props.showAlert&&this.setAlert(n,t,!0),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&(n.acquireStatus===To.EsriSuccess?this.props.onQueryAndAcquireComplete(t,n,!0):this.props.onQueryAndAcquireComplete(t,n,!1))}else this.shouldClearMessageState()&&this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&this.props.onQueryAndAcquireComplete(t,null,!0)}))}doQueryAndReleaseLock(){return Zo(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Co(this.props.featureDS,e,!0);for(let n=0;n<t.details.length;n++)yield $o(this.props.featureDS,t.details[n],e);this.setState({lockInfo:e}),this.props.onQueryAndReleaseComplete&&this.props.onQueryAndReleaseComplete(t,!0)}))}doAcquireLock(){return Zo(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams();let t=yield _o(this.props.featureDS,e);if(t.acquireStatus===To.EsriReconcileRequired){(yield Vo(this.props.featureDS))&&(t=yield _o(this.props.featureDS,e))}this.props.showAlert&&this.setAlert(t,e,!0),this.setState({lockInfo:e}),this.props.onAcquireComplete&&(t.acquireStatus===To.EsriSuccess?this.props.onAcquireComplete(t,!0):this.props.onAcquireComplete(t,!1))}))}doReleaseLock(){return Zo(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield qo(this.props.featureDS,e);this.setState({lockInfo:e}),this.props.onReleaseComplete&&(t.releaseStatus===jo.EsriSuccess?this.props.onReleaseComplete(t,!0):this.props.onReleaseComplete(t,!1))}))}createLockInfoFromParams(){const e=[],t=[];this.props.lockInfo.eventServiceLayerIds.forEach(((n,r)=>{const o=""!==this.props.lockInfo.routeInfo.lineId;e.push(o?this.props.lockInfo.routeInfo.lineId:this.props.lockInfo.routeInfo.routeId),t.push(o)}));return{networkId:this.props.lockInfo.networkId,routeOrLineId:e,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:t,status:To.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:Eo.None}}getNameOrId(e){return""!==e.lineId&&""===e.lineName?e.lineId:""!==e.lineId&&""!==e.lineName?e.lineName:""!==e.routeName?e.routeName:e.routeId}getNameOrIdFromUnavailableLock(e){return re(e.routeName)&&""!==e.routeName?e.routeName:re(e.lineName)&&""!==e.lineName?e.lineName:re(e.routeId)&&""!==e.routeId?e.routeId:re(e.lineId)&&""!==e.lineId?e.lineId:void 0}setAlert(e,t,n){var r;let o="",i="info",s="";const a=(null===(r=null==t?void 0:t.details[0])||void 0===r?void 0:r.lrsNetworkName)||this.props.networkName,l=ve(this.props.featureDS);switch(e.acquireStatus){case To.EsriSuccess:s=this.getNameOrId(this.props.lockInfo.routeInfo),o=""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"YouAcquiredLockOnLine",{nameOrId:s,networkName:a,version:l}):Z(this.props.intl,"YouAcquiredLockOnRoute",{nameOrId:s,networkName:a,version:l}),i="info";break;case To.EsriReconcileRequired:o=Z(this.props.intl,"ReconcileRequired"),i="error";break;case To.EsriCouldNotAcquireAllLocks:const t=e.unavailableLocks[0].versionName,r=e.unavailableLocks[0].user;s=this.getNameOrIdFromUnavailableLock(e.unavailableLocks[0]),o=""===t?""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLineWithoutVersion",{nameOrId:s,networkName:a,lockUser:r}):Z(this.props.intl,"UnavailableLockOnRouteWithoutVersion",{nameOrId:s,networkName:a,lockUser:r}):""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLine",{nameOrId:s,networkName:a,lockUser:r,version:t}):Z(this.props.intl,"UnavailableLockOnRoute",{nameOrId:s,networkName:a,lockUser:r,version:t}),i="error";break;default:o="",i="info",n=!1}this.setState({toastMsg:o,toastMsgType:i,toastOpen:n})}render(){const{conflictPreventionEnabled:e}=this.props;return e&&re(this.props.lockInfo)&&re(this.props.lockInfo.routeInfo)&&re(this.props.featureDS)&&this.props.showAlert&&""!==this.state.toastMsg?Po.default.createElement(W.Alert,{className:"lock-manager-alert w-100",size:"small",type:this.state.toastMsgType,text:this.state.toastMsg,closable:!0,withIcon:!0,open:this.state.toastOpen,onClose:()=>{this.setState({toastOpen:!1})}}):null}}var ei=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function ti(e){const{disabled:t,networkDs:r,eventDataSources:i,jimuMapView:s,hoverGraphic:a,onAttributesCopied:l}=e,u=n.hooks.useTranslation(J),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(null),h=n.React.useRef(!1),p=n.React.useRef(!1),[v,y]=n.React.useState(!1),[g,b]=n.React.useState();n.React.useEffect((()=>{if(re(r)){const e=r;re(null==e?void 0:e.layer)&&m(null==e?void 0:e.layer)}re(null==s?void 0:s.view)&&b(null==s?void 0:s.view.popupEnabled)}),[null==s?void 0:s.view,r]),n.React.useEffect((()=>{v?I():S()}),[v]);const I=()=>{c.current=null==s?void 0:s.view.on("pointer-move",k),d.current=null==s?void 0:s.view.on("pointer-down",x)},S=()=>{re(c.current)&&(c.current.remove(),c.current=null),re(d.current)&&(d.current.remove(),d.current=null),p.current&&(p.current=!1),h.current&&(h.current=!1)},w=()=>{re(a)&&a.removeAll()},R=e=>{w(),re(e)&&a.add(e)},N=(e,t)=>{const n=t.spatialReference,r=t.createQuery(),o="degrees"===n.unit?4:Math.max(3*n.metersPerUnit,3);return r.geometry=e,r.units="meters",r.returnGeometry=!0,r.returnM=!0,r.returnZ=!0,r.distance=(null==s?void 0:s.view.resolution)*o,r.spatialRelationship="intersects",r},k=e=>{re(f)&&!h.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((t=>{let n=null,o=null;[n,o]=t,h.current=!0;const i=r.getCurrentQueryParams(),a=null==s?void 0:s.view.toMap(e),l=N(a,f);l.outFields=[],(null==i?void 0:i.time)&&(l.timeExtent=new o({start:i.time[0],end:i.time[1]})),l.gdbVersion=i.gdbVersion,f.queryFeatures(l).then((e=>ei(this,void 0,void 0,(function*(){if(e.features.length>0){const t=e.features[0].geometry,r=n.nearestCoordinate(t,a),o=n.nearestVertex(t,a);o.distance<3*l.distance&&(r.coordinate=o.coordinate),R(yield Me(yield Oe(r.coordinate))),h.current=!1}h.current&&(R(null),h.current=!1)}))))}))},x=e=>ei(this,void 0,void 0,(function*(){re(f)&&!p.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((t=>ei(this,void 0,void 0,(function*(){let n=null;[n]=t,s.view.popupEnabled=!1,p.current=!0;const r=null==s?void 0:s.view.toMap(e),o=[];yield Promise.all(i.map((e=>ei(this,void 0,void 0,(function*(){const t=e,i=N(r,null==t?void 0:t.layer);i.outFields=["*"];const s=t.getCurrentQueryParams();(null==s?void 0:s.time)&&(i.timeExtent=new n({start:s.time[0],end:s.time[1]})),i.gdbVersion=s.gdbVersion;const a=yield null==t?void 0:t.layer.queryFeatures(i).then((e=>ei(this,void 0,void 0,(function*(){const t=[];if(e.features.length>0){const n=e.features[0].attributes;for(const e in n){const r={name:e,value:n[e]};t.push(r)}}return t})))),l={layerId:t.layerId,fieldValuePair:a};o.push(l)}))))).then((()=>{o.length>0&&l(o)})).finally((()=>{F()})).catch((()=>{F()}))})))))})),F=()=>{y(!1),S(),p.current=!1,setTimeout((()=>{s.view.popupEnabled=g,s.clearSelectedFeatures()}),800),w()};return(0,n.jsx)(W.Tooltip,{title:u("copyAttributes")},(0,n.jsx)(B.CalciteButton,{scale:"s",css:xe(),iconStart:"eyedropper",appearance:v?"solid":"outline",kind:"brand",disabled:!!t||void 0,tabIndex:-1,onClick:()=>{y(!v)}}))}var ni=u(48993),ri=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function oi(e,t){const n=t+e.id,r=e.view.map.findLayerById(n);re(r)&&e.view.map.remove(r)}function ii(e,t,r,o,i,s){return ri(this,void 0,void 0,(function*(){const a=(yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],l=o+t.id,u=t.view.map.findLayerById(l);re(u)&&t.view.map.remove(u);const c={type:"text",color:i||[0,0,0],haloColor:[255,255,255,.8],haloSize:1,font:{size:s||12}},d=null==e?void 0:e.layer.fields,f=new a({id:l,listMode:"hide",legendEnabled:!1,title:l,geometryType:"point",source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ni.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!0,screenSizePerspectiveEnabled:!1,fields:d,labelingInfo:[{labelExpressionInfo:{expression:r},symbol:c}]});return t.view.map.add(f),f}))}function si(e){return ri(this,void 0,void 0,(function*(){const t=yield(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/geometryEngine"]),r=t[0],o=t[1].planarLength(e)/2;if(0<e.paths.length){const t=e.paths[0];let n,i,s,a,l,u,c,d,f,m=0;if(0===o)return e.getPoint(0,0);if(o>0)for(let h=1;h<t.length;h++){if(n=t[h-1][0],a=t[h-1][1],i=t[h][0],l=t[h][1],c=ai(n,a,i,l),m+=c,m===o)return e.getPoint(0,h);if(m>o)return d=c-(m-o),f=Math.atan2(l-a,i-n),s=d*Math.cos(f),u=d*Math.sin(f),new r({x:n+s,y:a+u,spatialReference:{wkid:e.spatialReference.wkid}})}}return null}))}function ai(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var li,ui,ci=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};function di(e,t,n,r){return ci(this,void 0,void 0,(function*(){const o=ie(t),i=t.useRouteName?r.attributes[o.routeNameFieldName]:"",s=r.attributes[o.routeIdFieldName],a=r.attributes[o.fromDateFieldName],l=r.attributes[o.toDateFieldName],u=r.geometry,c=oe(u),d=r.attributes[o.lineIdFieldName],f=r.attributes[o.lineNameFieldName];let m=new Date(Date.now());re(l)&&m>l?m=Re(a,n):m.setHours(0,0,0,0);let h=new Date(Date.now());return re(l)&&h>l?h=Re(l,n):h.setHours(0,0,0,0),re(l)||(h=null),yield Be(n,t,c,a,s).then((r=>ci(this,void 0,void 0,(function*(){const o=Math.min(...r),c=Math.max(...r);return Object.assign(Object.assign({},e),{routeName:i,routeId:s,fromDate:re(a)?Re(a,n):null,toDate:re(l)?Re(l,n):null,selectedPolyline:u,fromMeasure:G(o,t.measurePrecision),toMeasure:G(c,t.measurePrecision),validRoute:!0,selectedFromDate:m,selectedToDate:h,lineName:f,lineId:d})}))))}))}!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(li||(li={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT"}(ui||(ui={})),(0,t.registerStyles)("widgets/shared-code/lrs/ui",e)})(),c})())}}}));