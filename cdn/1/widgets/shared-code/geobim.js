/*! For license information please see geobim.js.LICENSE.txt */
System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/geobim","jimu-arcgis","jimu-ui","jimu-core/react"],function(e,t){var r={},n={},i={},s={},o={},a={};return{setters:[function(e){r.Fragment=e.Fragment,r.css=e.css,r.jsx=e.jsx,r.jsxs=e.jsxs},function(e){n.DataSourceComponent=e.DataSourceComponent,n.Immutable=e.Immutable,n.React=e.React,n.ReactRedux=e.ReactRedux,n.ServiceManager=e.ServiceManager,n.SessionManager=e.SessionManager,n.createIntl=e.createIntl,n.createIntlCache=e.createIntlCache,n.css=e.css,n.getAppStore=e.getAppStore,n.i18n=e.i18n,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,n.lodash=e.lodash},function(e){i.ExBThemeSpacing=e.ExBThemeSpacing,i.GeoBimFeatureServiceError=e.GeoBimFeatureServiceError,i.MapSelection=e.MapSelection,i.apsAuthenticatedSelector=e.apsAuthenticatedSelector,i.areRecordArraysEqual=e.areRecordArraysEqual,i.getAllFeatureServiceIds=e.getAllFeatureServiceIds,i.getGeoBIMFeatureServiceError=e.getGeoBIMFeatureServiceError,i.getLocation=e.getLocation,i.getMapViewName=e.getMapViewName,i.inWidgetMessageContainerStyle=e.inWidgetMessageContainerStyle,i.inWidgetMessageLinkStyle=e.inWidgetMessageLinkStyle,i.useApsAuth=e.useApsAuth,i.useGeoBIM=e.useGeoBIM,i.useSessionManager=e.useSessionManager},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,s.zoomToUtils=e.zoomToUtils},function(e){o.Alert=e.Alert},function(e){a.Fragment=e.Fragment,a.createContext=e.createContext,a.createElement=e.createElement,a.default=e.default,a.forwardRef=e.forwardRef,a.useCallback=e.useCallback,a.useContext=e.useContext,a.useEffect=e.useEffect,a.useInsertionEffect=e.useInsertionEffect,a.useMemo=e.useMemo,a.useRef=e.useRef,a.useState=e.useState}],execute:function(){e((()=>{var e,t,l={14321:e=>{"use strict";e.exports=o},38512:e=>{"use strict";e.exports=i},62686:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=r},68972:e=>{"use strict";e.exports=a},69920:(e,t,r)=>{"use strict";r.d(t,{$:()=>Ja,A:()=>Hc,B:()=>bl,C:()=>Qc,D:()=>_c,E:()=>qa,F:()=>fl,G:()=>ll,H:()=>Oa,I:()=>Cl,J:()=>il,K:()=>ol,L:()=>_l,M:()=>ch,N:()=>Bu,O:()=>ca,P:()=>pl,Q:()=>yh,R:()=>Yc,S:()=>qd,T:()=>nh,U:()=>np,V:()=>uh,W:()=>Ch,X:()=>dh,Y:()=>zd,Z:()=>Gd,_:()=>_h,a:()=>jl,a0:()=>Ih,a1:()=>gh,a2:()=>Uh,a3:()=>$h,a4:()=>Bh,a5:()=>pa,a6:()=>gl,a7:()=>yl,a8:()=>oc,a9:()=>Ko,aa:()=>Rs,ab:()=>ta,ac:()=>Zo,ad:()=>wo,ae:()=>Qo,af:()=>Ns,ag:()=>So,ah:()=>bo,ai:()=>Es,aj:()=>Ho,ak:()=>ea,al:()=>Xo,am:()=>$o,an:()=>Bo,ao:()=>Mo,ap:()=>_o,aq:()=>Ts,ar:()=>oi,as:()=>at,at:()=>ai,au:()=>ui,av:()=>y,aw:()=>b,b:()=>Id,c:()=>Sa,d:()=>vl,e:()=>_a,f:()=>ul,g:()=>Dd,h:()=>ml,i:()=>cl,j:()=>ic,k:()=>yc,l:()=>Ha,m:()=>Hu,n:()=>Qa,o:()=>ua,p:()=>Fc,q:()=>yu,r:()=>Za,s:()=>rl,t:()=>fa,u:()=>dl,v:()=>tc,w:()=>Nu,x:()=>hl,y:()=>Yo,z:()=>Tp});var n,i,s,o,a,l,c,u,d,h,p,f=r(68972),m=r(67386),g=Object.defineProperty,v=(e,t,r)=>((e,t,r)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const y="7.110.1";var w=(e=>(e[e.OK=0]="OK",e))(w||{}),b=(e=>(e[e.INTERNAL_ERROR=0]="INTERNAL_ERROR",e[e.NOT_VIEWABLE=1]="NOT_VIEWABLE",e))(b||{});class _ extends Error{constructor(e,t,r,n){super(r),this.name=e,this.errorCode=t,this.internalMessage=r,this.internalErrorCode=n,Object.setPrototypeOf(this,_.prototype)}}var S,I={exports:{}},E={};var A;var R=(A||(A=1,I.exports=function(){if(S)return E;S=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(t,r,n){var i=null;if(void 0!==n&&(i=""+n),void 0!==r.key&&(i=""+r.key),"key"in r)for(var s in n={},r)"key"!==s&&(n[s]=r[s]);else n=r;return r=n.ref,{$$typeof:e,type:t,key:i,ref:void 0!==r?r:null,props:n}}return E.Fragment=t,E.jsx=r,E.jsxs=r,E}()),I.exports);var k=function(){function e(e){var t=this;this._insertTag=function(e){var r;r=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,r),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var r=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{r.insertRule(e,r.cssRules.length)}catch(e){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach(function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)}),this.tags=[],this.ctr=0},e}(),T="-ms-",C="-moz-",O="-webkit-",D="comm",j="rule",x="decl",P="@keyframes",N=Math.abs,L=String.fromCharCode,U=Object.assign;function F(e){return e.trim()}function M(e,t,r){return e.replace(t,r)}function $(e,t){return e.indexOf(t)}function B(e,t){return 0|e.charCodeAt(t)}function V(e,t,r){return e.slice(t,r)}function q(e){return e.length}function z(e){return e.length}function G(e,t){return t.push(e),e}var W=1,H=1,J=0,K=0,Y=0,Z="";function X(e,t,r,n,i,s,o){return{value:e,root:t,parent:r,type:n,props:i,children:s,line:W,column:H,length:o,return:""}}function Q(e,t){return U(X("",null,null,"",null,null,0),e,{length:-e.length},t)}function ee(){return Y=K>0?B(Z,--K):0,H--,10===Y&&(H=1,W--),Y}function te(){return Y=K<J?B(Z,K++):0,H++,10===Y&&(H=1,W++),Y}function re(){return B(Z,K)}function ne(){return K}function ie(e,t){return V(Z,e,t)}function se(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function oe(e){return W=H=1,J=q(Z=e),K=0,[]}function ae(e){return Z="",e}function le(e){return F(ie(K-1,de(91===e?e+2:40===e?e+1:e)))}function ce(e){for(;(Y=re())&&Y<33;)te();return se(e)>2||se(Y)>3?"":" "}function ue(e,t){for(;--t&&te()&&!(Y<48||Y>102||Y>57&&Y<65||Y>70&&Y<97););return ie(e,ne()+(t<6&&32==re()&&32==te()))}function de(e){for(;te();)switch(Y){case e:return K;case 34:case 39:34!==e&&39!==e&&de(Y);break;case 40:41===e&&de(e);break;case 92:te()}return K}function he(e,t){for(;te()&&e+Y!==57&&(e+Y!==84||47!==re()););return"/*"+ie(t,K-1)+"*"+L(47===e?e:te())}function pe(e){for(;!se(re());)te();return ie(e,K)}function fe(e){return ae(me("",null,null,null,[""],e=oe(e),0,[0],e))}function me(e,t,r,n,i,s,o,a,l){for(var c=0,u=0,d=o,h=0,p=0,f=0,m=1,g=1,v=1,y=0,w="",b=i,_=s,S=n,I=w;g;)switch(f=y,y=te()){case 40:if(108!=f&&58==B(I,d-1)){-1!=$(I+=M(le(y),"&","&\f"),"&\f")&&(v=-1);break}case 34:case 39:case 91:I+=le(y);break;case 9:case 10:case 13:case 32:I+=ce(f);break;case 92:I+=ue(ne()-1,7);continue;case 47:switch(re()){case 42:case 47:G(ve(he(te(),ne()),t,r),l);break;default:I+="/"}break;case 123*m:a[c++]=q(I)*v;case 125*m:case 59:case 0:switch(y){case 0:case 125:g=0;case 59+u:-1==v&&(I=M(I,/\f/g,"")),p>0&&q(I)-d&&G(p>32?ye(I+";",n,r,d-1):ye(M(I," ","")+";",n,r,d-2),l);break;case 59:I+=";";default:if(G(S=ge(I,t,r,c,u,i,a,w,b=[],_=[],d),s),123===y)if(0===u)me(I,t,S,S,b,s,d,a,_);else switch(99===h&&110===B(I,3)?100:h){case 100:case 108:case 109:case 115:me(e,S,S,n&&G(ge(e,S,S,0,0,i,a,w,i,b=[],d),_),i,_,d,a,n?b:_);break;default:me(I,S,S,S,[""],_,0,a,_)}}c=u=p=0,m=v=1,w=I="",d=o;break;case 58:d=1+q(I),p=f;default:if(m<1)if(123==y)--m;else if(125==y&&0==m++&&125==ee())continue;switch(I+=L(y),y*m){case 38:v=u>0?1:(I+="\f",-1);break;case 44:a[c++]=(q(I)-1)*v,v=1;break;case 64:45===re()&&(I+=le(te())),h=re(),u=d=q(w=I+=pe(ne())),y++;break;case 45:45===f&&2==q(I)&&(m=0)}}return s}function ge(e,t,r,n,i,s,o,a,l,c,u){for(var d=i-1,h=0===i?s:[""],p=z(h),f=0,m=0,g=0;f<n;++f)for(var v=0,y=V(e,d+1,d=N(m=o[f])),w=e;v<p;++v)(w=F(m>0?h[v]+" "+y:M(y,/&\f/g,h[v])))&&(l[g++]=w);return X(e,t,r,0===i?j:a,l,c,u)}function ve(e,t,r){return X(e,t,r,D,L(Y),V(e,2,-2),0)}function ye(e,t,r,n){return X(e,t,r,x,V(e,0,n),V(e,n+1,-1),n)}function we(e,t){for(var r="",n=z(e),i=0;i<n;i++)r+=t(e[i],i,e,t)||"";return r}function be(e,t,r,n){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case x:return e.return=e.return||e.value;case D:return"";case P:return e.return=e.value+"{"+we(e.children,n)+"}";case j:e.value=e.props.join(",")}return q(r=we(e.children,n))?e.return=e.value+"{"+r+"}":""}function _e(e){var t=Object.create(null);return function(r){return void 0===t[r]&&(t[r]=e(r)),t[r]}}var Se=function(e,t,r){for(var n=0,i=0;n=i,i=re(),38===n&&12===i&&(t[r]=1),!se(i);)te();return ie(e,K)},Ie=function(e,t){return ae(function(e,t){var r=-1,n=44;do{switch(se(n)){case 0:38===n&&12===re()&&(t[r]=1),e[r]+=Se(K-1,t,r);break;case 2:e[r]+=le(n);break;case 4:if(44===n){e[++r]=58===re()?"&\f":"",t[r]=e[r].length;break}default:e[r]+=L(n)}}while(n=te());return e}(oe(e),t))},Ee=new WeakMap,Ae=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,r=e.parent,n=e.column===r.column&&e.line===r.line;"rule"!==r.type;)if(!(r=r.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||Ee.get(r))&&!n){Ee.set(e,!0);for(var i=[],s=Ie(t,i),o=r.props,a=0,l=0;a<s.length;a++)for(var c=0;c<o.length;c++,l++)e.props[l]=i[a]?s[a].replace(/&\f/g,o[c]):o[c]+" "+s[a]}}},Re=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ke(e,t){switch(function(e,t){return 45^B(e,0)?(((t<<2^B(e,0))<<2^B(e,1))<<2^B(e,2))<<2^B(e,3):0}(e,t)){case 5103:return O+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return O+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return O+e+C+e+T+e+e;case 6828:case 4268:return O+e+T+e+e;case 6165:return O+e+T+"flex-"+e+e;case 5187:return O+e+M(e,/(\w+).+(:[^]+)/,O+"box-$1$2"+T+"flex-$1$2")+e;case 5443:return O+e+T+"flex-item-"+M(e,/flex-|-self/,"")+e;case 4675:return O+e+T+"flex-line-pack"+M(e,/align-content|flex-|-self/,"")+e;case 5548:return O+e+T+M(e,"shrink","negative")+e;case 5292:return O+e+T+M(e,"basis","preferred-size")+e;case 6060:return O+"box-"+M(e,"-grow","")+O+e+T+M(e,"grow","positive")+e;case 4554:return O+M(e,/([^-])(transform)/g,"$1"+O+"$2")+e;case 6187:return M(M(M(e,/(zoom-|grab)/,O+"$1"),/(image-set)/,O+"$1"),e,"")+e;case 5495:case 3959:return M(e,/(image-set\([^]*)/,O+"$1$`$1");case 4968:return M(M(e,/(.+:)(flex-)?(.*)/,O+"box-pack:$3"+T+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+O+e+e;case 4095:case 3583:case 4068:case 2532:return M(e,/(.+)-inline(.+)/,O+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(q(e)-1-t>6)switch(B(e,t+1)){case 109:if(45!==B(e,t+4))break;case 102:return M(e,/(.+:)(.+)-([^]+)/,"$1"+O+"$2-$3$1"+C+(108==B(e,t+3)?"$3":"$2-$3"))+e;case 115:return~$(e,"stretch")?ke(M(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==B(e,t+1))break;case 6444:switch(B(e,q(e)-3-(~$(e,"!important")&&10))){case 107:return M(e,":",":"+O)+e;case 101:return M(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+O+(45===B(e,14)?"inline-":"")+"box$3$1"+O+"$2$3$1"+T+"$2box$3")+e}break;case 5936:switch(B(e,t+11)){case 114:return O+e+T+M(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return O+e+T+M(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return O+e+T+M(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return O+e+T+e+e}return e}var Te,Ce=[function(e,t,r,n){if(e.length>-1&&!e.return)switch(e.type){case x:e.return=ke(e.value,e.length);break;case P:return we([Q(e,{value:M(e.value,"@","@"+O)})],n);case j:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return we([Q(e,{props:[M(t,/:(read-\w+)/,":-moz-$1")]})],n);case"::placeholder":return we([Q(e,{props:[M(t,/:(plac\w+)/,":"+O+"input-$1")]}),Q(e,{props:[M(t,/:(plac\w+)/,":-moz-$1")]}),Q(e,{props:[M(t,/:(plac\w+)/,T+"input-$1")]})],n)}return""})}}],Oe=function(e){var t=e.key;if("css"===t){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))})}var n,i,s=e.stylisPlugins||Ce,o={},a=[];n=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(e){for(var t=e.getAttribute("data-emotion").split(" "),r=1;r<t.length;r++)o[t[r]]=!0;a.push(e)});var l,c,u,d,h=[be,(d=function(e){l.insert(e)},function(e){e.root||(e=e.return)&&d(e)})],p=(c=[Ae,Re].concat(s,h),u=z(c),function(e,t,r,n){for(var i="",s=0;s<u;s++)i+=c[s](e,t,r,n)||"";return i});i=function(e,t,r,n){l=r,we(fe(e?e+"{"+t.styles+"}":t.styles),p),n&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new k({key:t,container:n,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:i};return f.sheet.hydrate(a),f},De={exports:{}},je={};var xe,Pe,Ne;function Le(){return xe||(xe=1,De.exports=function(){if(Te)return je;Te=1;var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,f=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,v=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var h=e.$$typeof;switch(h){case t:switch(e=e.type){case l:case c:case n:case s:case i:case d:return e;default:switch(e=e&&e.$$typeof){case a:case u:case f:case p:case o:return e;default:return h}}case r:return h}}}function b(e){return w(e)===c}return je.AsyncMode=l,je.ConcurrentMode=c,je.ContextConsumer=a,je.ContextProvider=o,je.Element=t,je.ForwardRef=u,je.Fragment=n,je.Lazy=f,je.Memo=p,je.Portal=r,je.Profiler=s,je.StrictMode=i,je.Suspense=d,je.isAsyncMode=function(e){return b(e)||w(e)===l},je.isConcurrentMode=b,je.isContextConsumer=function(e){return w(e)===a},je.isContextProvider=function(e){return w(e)===o},je.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},je.isForwardRef=function(e){return w(e)===u},je.isFragment=function(e){return w(e)===n},je.isLazy=function(e){return w(e)===f},je.isMemo=function(e){return w(e)===p},je.isPortal=function(e){return w(e)===r},je.isProfiler=function(e){return w(e)===s},je.isStrictMode=function(e){return w(e)===i},je.isSuspense=function(e){return w(e)===d},je.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===c||e===s||e===i||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===p||e.$$typeof===o||e.$$typeof===a||e.$$typeof===u||e.$$typeof===g||e.$$typeof===v||e.$$typeof===y||e.$$typeof===m)},je.typeOf=w,je}()),De.exports}!function(){if(Ne)return Pe;Ne=1;var e=Le(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},n={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function s(r){return e.isMemo(r)?n:i[r.$$typeof]||t}i[e.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[e.Memo]=n;var o=Object.defineProperty,a=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,c=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=Object.prototype;Pe=function e(t,n,i){if("string"!=typeof n){if(d){var h=u(n);h&&h!==d&&e(t,h,i)}var p=a(n);l&&(p=p.concat(l(n)));for(var f=s(t),m=s(n),g=0;g<p.length;++g){var v=p[g];if(!(r[v]||i&&i[v]||m&&m[v]||f&&f[v])){var y=c(n,v);try{o(t,v,y)}catch(e){}}}}return t}}();var Ue=function(e,t,r){var n=e.key+"-"+t.name;!1===r&&void 0===e.registered[n]&&(e.registered[n]=t.styles)};var Fe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Me=/[A-Z]|^ms/g,$e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Be=function(e){return 45===e.charCodeAt(1)},Ve=function(e){return null!=e&&"boolean"!=typeof e},qe=_e(function(e){return Be(e)?e:e.replace(Me,"-$&").toLowerCase()}),ze=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace($e,function(e,t,r){return We={name:t,styles:r,next:We},t})}return 1===Fe[e]||Be(e)||"number"!=typeof t||0===t?t:t+"px"};function Ge(e,t,r){if(null==r)return"";var n=r;if(void 0!==n.__emotion_styles)return n;switch(typeof r){case"boolean":return"";case"object":var i=r;if(1===i.anim)return We={name:i.name,styles:i.styles,next:We},i.name;var s=r;if(void 0!==s.styles){var o=s.next;if(void 0!==o)for(;void 0!==o;)We={name:o.name,styles:o.styles,next:We},o=o.next;return s.styles+";"}return function(e,t,r){var n="";if(Array.isArray(r))for(var i=0;i<r.length;i++)n+=Ge(e,t,r[i])+";";else for(var s in r){var o=r[s];if("object"!=typeof o){var a=o;Ve(a)&&(n+=qe(s)+":"+ze(s,a)+";")}else if(Array.isArray(o)&&"string"==typeof o[0]&&null==t)for(var l=0;l<o.length;l++)Ve(o[l])&&(n+=qe(s)+":"+ze(s,o[l])+";");else{var c=Ge(e,t,o);switch(s){case"animation":case"animationName":n+=qe(s)+":"+c+";";break;default:n+=s+"{"+c+"}"}}}return n}(e,t,r);case"function":if(void 0!==e){var a=We,l=r(e);return We=a,Ge(e,t,l)}}return r}var We,He=/label:\s*([^\s;{]+)\s*(;|$)/g;var Je=!!f.useInsertionEffect&&f.useInsertionEffect||function(e){return e()},Ke=f.createContext("undefined"!=typeof HTMLElement?Oe({key:"css"}):null);Ke.Provider;var Ye=function(e){return(0,f.forwardRef)(function(t,r){var n=(0,f.useContext)(Ke);return e(t,n,r)})},Ze=f.createContext({}),Xe={}.hasOwnProperty,Qe="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",et=function(e,t){var r={};for(var n in t)Xe.call(t,n)&&(r[n]=t[n]);return r[Qe]=e,r},tt=function(e){var t=e.cache,r=e.serialized,n=e.isStringTag;return Ue(t,r,n),Je(function(){return function(e,t,r){Ue(e,t,r);var n=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var i=t;do{e.insert(t===i?"."+n:"",i,e.sheet,!0),i=i.next}while(void 0!==i)}}(t,r,n)}),null},rt=Ye(function(e,t,r){var n=e.css;"string"==typeof n&&void 0!==t.registered[n]&&(n=t.registered[n]);var i=e[Qe],s=[n],o="";"string"==typeof e.className?o=function(e,t,r){var n="";return r.split(" ").forEach(function(r){void 0!==e[r]?t.push(e[r]+";"):r&&(n+=r+" ")}),n}(t.registered,s,e.className):null!=e.className&&(o=e.className+" ");var a=function(e,t,r){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n=!0,i="";We=void 0;var s=e[0];null==s||void 0===s.raw?(n=!1,i+=Ge(r,t,s)):i+=s[0];for(var o=1;o<e.length;o++)i+=Ge(r,t,e[o]),n&&(i+=s[o]);He.lastIndex=0;for(var a,l="";null!==(a=He.exec(i));)l+="-"+a[1];return{name:function(e){for(var t,r=0,n=0,i=e.length;i>=4;++n,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),r=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&r)+(59797*(r>>>16)<<16);switch(i){case 3:r^=(255&e.charCodeAt(n+2))<<16;case 2:r^=(255&e.charCodeAt(n+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(n)))+(59797*(r>>>16)<<16)}return(((r=1540483477*(65535&(r^=r>>>13))+(59797*(r>>>16)<<16))^r>>>15)>>>0).toString(36)}(i)+l,styles:i,next:We}}(s,void 0,f.useContext(Ze));o+=t.key+"-"+a.name;var l={};for(var c in e)Xe.call(e,c)&&"css"!==c&&c!==Qe&&(l[c]=e[c]);return l.className=o,r&&(l.ref=r),f.createElement(f.Fragment,null,f.createElement(tt,{cache:t,serialized:a,isStringTag:"string"==typeof i}),f.createElement(i,l))}),nt=rt,it=function(e,t,r){return Xe.call(t,"css")?R.jsx(nt,et(e,t),r):R.jsx(e,t,r)};const st="GeoBIM.Issues",ot=class e{constructor(t,r){v(this,"viewer",null),v(this,"domContainer"),v(this,"resizeObserver"),v(this,"options"),v(this,"isResizing",!1),v(this,"selectedIds"),v(this,"currentUrn"),v(this,"currentDoc"),v(this,"currentViewableId",null),v(this,"currentModel"),v(this,"dbProps",[]),v(this,"onModelViewerResize",()=>{null!==this.viewer?this.isResizing||(this.viewer.resize(),this.isResizing=!0,setTimeout(()=>{this.isResizing=!1},100)):this.isResizing=!1}),v(this,"handleModelRootLoaded",async()=>{const e=await Promise.all([this.onModelViewerEvent(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT),this.onModelViewerEvent(Autodesk.Viewing.GEOMETRY_LOADED_EVENT)]);if(null!=this.selectedIds){const t=null!=e[0].model?e[0].model:e[1].model;null!=t&&await this.selectBIMComponents(this.selectedIds,t)}}),v(this,"findDbId",(e,t)=>{for(const r of t){const t=e.find(e=>e.properties.some(e=>r===e.displayValue.toString()));if(null!=t)return t.dbId}}),this.domContainer=t,this.resizeObserver=new ResizeObserver(this.onModelViewerResize),this.resizeObserver.observe(this.domContainer),this.options={...e.defaultOptions,...r}}async loadViewerLib(e){return await new Promise(t=>{const r="aps-viewer-lib",n=window,i=n.define;if(null===document.getElementById(r)){const s=document.createElement("link");s.rel="stylesheet",s.href=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${e}/style.min.css`,document.body.appendChild(s);const o=document.createElement("script");return o.onerror=()=>{console.error("Model Viewer: Cannot load viewer library script"),t(!1)},o.onload=()=>{o.id=r,n.define=i,t(!0)},o.src=`https://developer.api.autodesk.com/modelderivative/v2/viewers/${e}/viewer3D.min.js`,n.define=(...e)=>{if(e.length>0){const t=e[0],r=n.Hammer;if("function"==typeof t&&t()===r)return}return i(...e)},void document.body.appendChild(o)}t(!0)})}async initializeEnv(){const e=null!=this.options.version?this.options.version:y;await this.loadViewerLib(e),await this.registerIssuesExtension(),await new Promise(e=>{let t=null;Autodesk.Viewing.FeatureFlags.set("DS_ENDPOINTS",!0),Autodesk.Viewing.Initializer({env:"AutodeskProduction",api:"derivativeV2",getAccessToken:e=>{void 0!==e&&this.options.getAccessToken().then(r=>{if(null===r.accessToken)throw new Error("Model Viewer: Access token is null.");t=r.accessToken,e(t,r.expiresInSeconds??600)}).catch(r=>{console.error("Model Viewer: Cannot get access token. Retrying in 60 seconds.",r),e(t??"",60)})}},()=>{e()})})}async registerIssuesExtension(){const{GeoBIMIssuesExtension:e}=await r.e("extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_GeoBimIssuesExtension-h-51c80b").then(r.bind(r,99510));Autodesk.Viewing.theExtensionManager.registerExtension(st,e)}parseLinkUrl(e){const t=e.split("/versions/");return t.length<2?"":Autodesk.Viewing.toUrlSafeBase64(decodeURIComponent(t[t.length-1]))}async loadDocument(e){return await new Promise((t,r)=>{var n;const i=null==(n=this.viewer)?void 0:n.getVisibleModels();null==i||i.forEach(e=>{var t;null==(t=this.viewer)||t.unloadModel(e)}),Autodesk.Viewing.Document.load(e,e=>{t(e)},(e,t,n)=>{r(new _(t,b.INTERNAL_ERROR,n.toLocaleString(),e))})})}async initializeViewer(){var e;null==(e=this.viewer)||e.finish(),this.viewer=new Autodesk.Viewing.GuiViewer3D(this.domContainer);const t=this.viewer.start();return this.onModelViewerEvent(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.handleModelRootLoaded,!1),t}async start(){return await this.initializeEnv(),await this.initializeViewer()}async loadModel(e,t,r){const n=this.selectedIds;this.selectedIds=r;const i=e.startsWith("http")?this.parseLinkUrl(e):Autodesk.Viewing.toUrlSafeBase64(decodeURIComponent(e));try{let e;this.currentUrn===i?e=this.currentDoc:(await this.initializeViewer(),e=await this.loadDocument(`urn:${i}`),this.currentUrn=i,this.currentDoc=e);const s=this.viewer;if(null===s||void 0===e)return;const o=void 0!==t?e.getRoot().findByGuid(t):e.getRoot().getDefaultGeometry();if(null==o)throw new _("Processing Error",b.NOT_VIEWABLE,"File cannot be previewed in Viewer.");const a=null==o?void 0:o.id;if(this.currentViewableId!==a&&(this.currentViewableId=a,null!==s)){const t=Promise.all([this.addEventListener(s,Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT),this.addEventListener(s,Autodesk.Viewing.GEOMETRY_LOADED_EVENT)]),r=await s.loadDocumentNode(e,o,{keepCurrentModels:!1,preserveView:!1});return await this.loadExtensions(),await t,r}if(void 0!==r&&r!==n){const e=s.getAllModels();if(e.length>0){const t=e[0];return await this.selectBIMComponents(r,t),t}}}catch(e){throw e instanceof _?e:new _("GeoBIM APS Model Viewer Error",(null==e?void 0:e.errorCode)??b.INTERNAL_ERROR,e)}}async addEventListener(e,t,r,n=!0){return await new Promise(i=>{const s=o=>{n&&e.removeEventListener(t,s),void 0!==r&&r(o),i(o)};e.addEventListener(t,s)})}async showIssues(e){const t=this.viewer;if(null!==t){const r=t.getExtension(st)??null;null!==r&&await r.showBIMIssues(e)}}async loadExtension(e,t){var r;return await(null==(r=this.viewer)?void 0:r.loadExtension(e,t))??null}async onModelViewerEvent(e,t,r=!0){return await new Promise(n=>{var i;const s=i=>{var o;r&&(null==(o=this.viewer)||o.removeEventListener(e,s)),null!=t&&t(i),n(i)};null==(i=this.viewer)||i.addEventListener(e,s)})}async selectBIMComponents(e,t){const r=this.viewer;if(null===r)return;r.clearSelection();const n=t;if((null==e?void 0:e.length)>0&&null!=n){let t;this.currentModel===n?t=this.dbProps:(t=await n.getPropertyDb().executeUserFunction(function userFunction(e){const t=[];return e.enumObjects(r=>{const n=e.getObjectProperties(r);t.push(n)}),t}),this.dbProps=t,this.currentModel=n);const i=this.findDbId(t,e);if(void 0!==i)return r.fitToView([i],n),void r.select([i],n)}r.fitToView([],n),r.select([],n)}async loadExtensions(){if(null!=this.options.extensions){const e=this.options.extensions.map(async e=>"string"!=typeof e?await this.loadExtension(e.extensionId,e.options):await this.loadExtension(e));await Promise.all(e)}}resize(){var e;null==(e=this.viewer)||e.resize()}dispose(){var e;null==(e=this.viewer)||e.tearDown()}};v(ot,"defaultOptions",{extensions:["Autodesk.DocumentBrowser",st],version:y});let at=ot;var lt=Object.defineProperty,ct=(e,t,r)=>((e,t,r)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r),ut=Object.defineProperty,dt=(e,t,r)=>((e,t,r)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);dt(class{constructor(){dt(this,"globalId"),dt(this,"objectId"),dt(this,"creationDate"),dt(this,"creator"),dt(this,"editDate"),dt(this,"editor")}},"fields",["globalId","objectId","creationDate","creator","editDate","editor"]);var ht=(e=>(e.ViewerUrl="ViewerUrl",e.BIMDocument="BIMDocument",e.DocumentName="DocumentName",e.ScheduleFeature="ScheduleFeature",e.Custom="Custom",e))(ht||{});function pt(e,t){return function(){return e.apply(t,arguments)}}const{toString:ft}=Object.prototype,{getPrototypeOf:mt}=Object,{iterator:gt,toStringTag:vt}=Symbol,yt=(e=>t=>{const r=ft.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),wt=e=>(e=e.toLowerCase(),t=>yt(t)===e),bt=e=>t=>typeof t===e,{isArray:_t}=Array,St=bt("undefined");const It=wt("ArrayBuffer");const Et=bt("string"),At=bt("function"),Rt=bt("number"),kt=e=>null!==e&&"object"==typeof e,Tt=e=>{if("object"!==yt(e))return!1;const t=mt(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||vt in e||gt in e)},Ct=wt("Date"),Ot=wt("File"),Dt=wt("Blob"),jt=wt("FileList"),xt=wt("URLSearchParams"),[Pt,Nt,Lt,Ut]=["ReadableStream","Request","Response","Headers"].map(wt);function Ft(e,t,{allOwnKeys:r=!1}={}){if(null===e||typeof e>"u")return;let n,i;if("object"!=typeof e&&(e=[e]),_t(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function Mt(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const $t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bt=e=>!St(e)&&e!==$t;const Vt=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&mt(Uint8Array)),qt=wt("HTMLFormElement"),zt=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Gt=wt("RegExp"),Wt=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Ft(r,(r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)}),Object.defineProperties(e,n)};const Ht=wt("AsyncFunction"),Jt=(Zt="function"==typeof setImmediate,Xt=At($t.postMessage),Zt?setImmediate:Xt?(Qt=`axios@${Math.random()}`,er=[],$t.addEventListener("message",({source:e,data:t})=>{e===$t&&t===Qt&&er.length&&er.shift()()},!1),e=>{er.push(e),$t.postMessage(Qt,"*")}):e=>setTimeout(e)),Kt=typeof queueMicrotask<"u"?queueMicrotask.bind($t):typeof process<"u"&&process.nextTick||Jt,Yt={isArray:_t,isArrayBuffer:It,isBuffer:function(e){return null!==e&&!St(e)&&null!==e.constructor&&!St(e.constructor)&&At(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||At(e.append)&&("formdata"===(t=yt(e))||"object"===t&&At(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&It(e.buffer),t},isString:Et,isNumber:Rt,isBoolean:e=>!0===e||!1===e,isObject:kt,isPlainObject:Tt,isReadableStream:Pt,isRequest:Nt,isResponse:Lt,isHeaders:Ut,isUndefined:St,isDate:Ct,isFile:Ot,isBlob:Dt,isRegExp:Gt,isFunction:At,isStream:e=>kt(e)&&At(e.pipe),isURLSearchParams:xt,isTypedArray:Vt,isFileList:jt,forEach:Ft,merge:function e(){const{caseless:t}=Bt(this)&&this||{},r={},n=(n,i)=>{const s=t&&Mt(r,i)||i;Tt(r[s])&&Tt(n)?r[s]=e(r[s],n):Tt(n)?r[s]=e({},n):_t(n)?r[s]=n.slice():r[s]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Ft(arguments[e],n);return r},extend:(e,t,r,{allOwnKeys:n}={})=>(Ft(t,(t,n)=>{r&&At(t)?e[n]=pt(t,r):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,o;const a={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=!1!==r&&mt(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:yt,kindOfTest:wt,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(_t(e))return e;let t=e.length;if(!Rt(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[gt]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:qt,hasOwnProperty:zt,hasOwnProp:zt,reduceDescriptors:Wt,freezeMethods:e=>{Wt(e,(t,r)=>{if(At(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];if(At(n)){if(t.enumerable=!1,"writable"in t)return void(t.writable=!1);t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return _t(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Mt,global:$t,isContextDefined:Bt,isSpecCompliantForm:function(e){return!!(e&&At(e.append)&&"FormData"===e[vt]&&e[gt])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(kt(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=_t(e)?[]:{};return Ft(e,(e,t)=>{const s=r(e,n+1);!St(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:Ht,isThenable:e=>e&&(kt(e)||At(e))&&At(e.then)&&At(e.catch),setImmediate:Jt,asap:Kt,isIterable:e=>null!=e&&At(e[gt])};var Zt,Xt,Qt,er;function tr(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Yt.inherits(tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Yt.toJSONObject(this.config),code:this.code,status:this.status}}});const rr=tr.prototype,nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{nr[e]={value:e}}),Object.defineProperties(tr,nr),Object.defineProperty(rr,"isAxiosError",{value:!0}),tr.from=(e,t,r,n,i,s)=>{const o=Object.create(rr);return Yt.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),tr.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function ir(e){return Yt.isPlainObject(e)||Yt.isArray(e)}function sr(e){return Yt.endsWith(e,"[]")?e.slice(0,-2):e}function or(e,t,r){return e?e.concat(t).map(function(e,t){return e=sr(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const ar=Yt.toFlatObject(Yt,{},null,function(e){return/^is[A-Z]/.test(e)});function lr(e,t,r){if(!Yt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=Yt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Yt.isUndefined(t[e])})).metaTokens,i=r.visitor||c,s=r.dots,o=r.indexes,a=(r.Blob||typeof Blob<"u"&&Blob)&&Yt.isSpecCompliantForm(t);if(!Yt.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Yt.isDate(e))return e.toISOString();if(!a&&Yt.isBlob(e))throw new tr("Blob is not supported. Use a Buffer instead.");return Yt.isArrayBuffer(e)||Yt.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,i){let a=e;if(e&&!i&&"object"==typeof e)if(Yt.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(Yt.isArray(e)&&function(e){return Yt.isArray(e)&&!e.some(ir)}(e)||(Yt.isFileList(e)||Yt.endsWith(r,"[]"))&&(a=Yt.toArray(e)))return r=sr(r),a.forEach(function(e,n){!Yt.isUndefined(e)&&null!==e&&t.append(!0===o?or([r],n,s):null===o?r:r+"[]",l(e))}),!1;return!!ir(e)||(t.append(or(i,r,s),l(e)),!1)}const u=[],d=Object.assign(ar,{defaultVisitor:c,convertValue:l,isVisitable:ir});if(!Yt.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!Yt.isUndefined(r)){if(-1!==u.indexOf(r))throw Error("Circular reference detected in "+n.join("."));u.push(r),Yt.forEach(r,function(r,s){!0===(!(Yt.isUndefined(r)||null===r)&&i.call(t,r,Yt.isString(s)?s.trim():s,n,d))&&e(r,n?n.concat(s):[s])}),u.pop()}}(e),t}function cr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function ur(e,t){this._pairs=[],e&&lr(e,this,t)}const dr=ur.prototype;function hr(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function pr(e,t,r){if(!t)return e;const n=r&&r.encode||hr;Yt.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let s;if(s=i?i(t,r):Yt.isURLSearchParams(t)?t.toString():new ur(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}dr.append=function(e,t){this._pairs.push([e,t])},dr.toString=function(e){const t=e?function(t){return e.call(this,t,cr)}:cr;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class fr{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Yt.forEach(this.handlers,function(t){null!==t&&e(t)})}}const mr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gr={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:ur,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},vr=typeof window<"u"&&typeof document<"u",yr="object"==typeof navigator&&navigator||void 0,wr=vr&&(!yr||["ReactNative","NativeScript","NS"].indexOf(yr.product)<0),br=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,_r=vr&&window.location.href||"http://localhost",Sr={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:vr,hasStandardBrowserEnv:wr,hasStandardBrowserWebWorkerEnv:br,navigator:yr,origin:_r},Symbol.toStringTag,{value:"Module"})),...gr};function Ir(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),a=i>=e.length;return s=!s&&Yt.isArray(n)?n.length:s,a?(Yt.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!Yt.isObject(n[s]))&&(n[s]=[]),t(e,r,n[s],i)&&Yt.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}(n[s])),!o)}if(Yt.isFormData(e)&&Yt.isFunction(e.entries)){const r={};return Yt.forEachEntry(e,(e,n)=>{t(function(e){return Yt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null}const Er={transitional:mr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=Yt.isObject(e);if(i&&Yt.isHTMLForm(e)&&(e=new FormData(e)),Yt.isFormData(e))return n?JSON.stringify(Ir(e)):e;if(Yt.isArrayBuffer(e)||Yt.isBuffer(e)||Yt.isStream(e)||Yt.isFile(e)||Yt.isBlob(e)||Yt.isReadableStream(e))return e;if(Yt.isArrayBufferView(e))return e.buffer;if(Yt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return lr(e,new Sr.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return Sr.isNode&&Yt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Yt.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return lr(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(Yt.isString(e))try{return(t||JSON.parse)(e),Yt.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Er.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Yt.isResponse(e)||Yt.isReadableStream(e))return e;if(e&&Yt.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r)throw"SyntaxError"===e.name?tr.from(e,tr.ERR_BAD_RESPONSE,this,null,this.response):e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Sr.classes.FormData,Blob:Sr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Yt.forEach(["delete","get","head","post","put","patch"],e=>{Er.headers[e]={}});const Ar=Yt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Rr=Symbol("internals");function kr(e){return e&&String(e).trim().toLowerCase()}function Tr(e){return!1===e||null==e?e:Yt.isArray(e)?e.map(Tr):String(e)}function Cr(e,t,r,n,i){if(Yt.isFunction(n))return n.call(this,t,r);if(i&&(t=r),Yt.isString(t)){if(Yt.isString(n))return-1!==t.indexOf(n);if(Yt.isRegExp(n))return n.test(t)}}let Or=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=kr(t);if(!i)throw new Error("header name must be a non-empty string");const s=Yt.findKey(n,i);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=Tr(e))}const s=(e,t)=>Yt.forEach(e,(e,r)=>i(e,r,t));if(Yt.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Yt.isString(e)&&(e=e.trim())&&!(e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))(e))s((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!(!r||t[r]&&Ar[r])&&("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(Yt.isObject(e)&&Yt.isIterable(e)){let r,n,i={};for(const t of e){if(!Yt.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(r=i[n])?Yt.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,r);return this}get(e,t){if(e=kr(e)){const r=Yt.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(Yt.isFunction(t))return t.call(this,e,r);if(Yt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=kr(e)){const r=Yt.findKey(this,e);return!(!r||void 0===this[r]||t&&!Cr(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=kr(e)){const i=Yt.findKey(r,e);i&&(!t||Cr(0,r[i],i,t))&&(delete r[i],n=!0)}}return Yt.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];(!e||Cr(0,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return Yt.forEach(this,(n,i)=>{const s=Yt.findKey(r,i);if(s)return t[s]=Tr(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(i):String(i).trim();o!==i&&delete t[i],t[o]=Tr(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Yt.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&Yt.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(e=>r.set(e)),r}static accessor(e){const t=(this[Rr]=this[Rr]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=kr(e);t[n]||(function(e,t){const r=Yt.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})})}(r,e),t[n]=!0)}return Yt.isArray(e)?e.forEach(n):n(e),this}};function Dr(e,t){const r=this||Er,n=t||r,i=Or.from(n.headers);let s=n.data;return Yt.forEach(e,function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function jr(e){return!(!e||!e.__CANCEL__)}function xr(e,t,r){tr.call(this,e??"canceled",tr.ERR_CANCELED,t,r),this.name="CanceledError"}function Pr(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new tr("Request failed with status code "+r.status,[tr.ERR_BAD_REQUEST,tr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Or.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Yt.reduceDescriptors(Or.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}}),Yt.freezeMethods(Or),Yt.inherits(xr,tr,{__CANCEL__:!0});const Nr=(e,t,r=3)=>{let n=0;const i=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=n[o];i||(i=l),r[s]=a,n[s]=l;let u=o,d=0;for(;u!==s;)d+=r[u++],u%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}}(50,250);return function(e,t){let r,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),a=t-i;a>=s?o(e,t):(r=e,n||(n=setTimeout(()=>{n=null,o(r)},s-a)))},()=>r&&o(r)]}(r=>{const s=r.loaded,o=r.lengthComputable?r.total:void 0,a=s-n,l=i(a);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},Lr=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Ur=e=>(...t)=>Yt.asap(()=>e(...t)),Fr=Sr.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Sr.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Sr.origin),Sr.navigator&&/(msie|trident)/i.test(Sr.navigator.userAgent)):()=>!0,Mr=Sr.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const o=[e+"="+encodeURIComponent(t)];Yt.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),Yt.isString(n)&&o.push("path="+n),Yt.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function $r(e,t,r){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Br=e=>e instanceof Or?{...e}:e;function Vr(e,t){t=t||{};const r={};function n(e,t,r,n){return Yt.isPlainObject(e)&&Yt.isPlainObject(t)?Yt.merge.call({caseless:n},e,t):Yt.isPlainObject(t)?Yt.merge({},t):Yt.isArray(t)?t.slice():t}function i(e,t,r,i){return Yt.isUndefined(t)?Yt.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Yt.isUndefined(t))return n(void 0,t)}function o(e,t){return Yt.isUndefined(t)?Yt.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t,r)=>i(Br(e),Br(t),0,!0)};return Yt.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);Yt.isUndefined(o)&&s!==a||(r[n]=o)}),r}const qr=e=>{const t=Vr({},e);let r,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=t;if(t.headers=a=Or.from(a),t.url=pr($r(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Yt.isFormData(n))if(Sr.hasStandardBrowserEnv||Sr.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(r=a.getContentType())){const[e,...t]=r?r.split(";").map(e=>e.trim()).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...t].join("; "))}if(Sr.hasStandardBrowserEnv&&(i&&Yt.isFunction(i)&&(i=i(t)),i||!1!==i&&Fr(t.url))){const e=s&&o&&Mr.read(o);e&&a.set(s,e)}return t},zr=typeof XMLHttpRequest<"u"&&function(e){return new Promise(function(t,r){const n=qr(e);let i=n.data;const s=Or.from(n.headers).normalize();let o,a,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:p}=n;function f(){c&&c(),u&&u(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const n=Or.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Pr(function(e){t(e),f()},function(e){r(e),f()},{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:e,request:m}),m=null}m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){!m||4!==m.readyState||0===m.status&&(!m.responseURL||0!==m.responseURL.indexOf("file:"))||setTimeout(g)},m.onabort=function(){m&&(r(new tr("Request aborted",tr.ECONNABORTED,e,m)),m=null)},m.onerror=function(){r(new tr("Network Error",tr.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||mr;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new tr(t,i.clarifyTimeoutError?tr.ETIMEDOUT:tr.ECONNABORTED,e,m)),m=null},void 0===i&&s.setContentType(null),"setRequestHeader"in m&&Yt.forEach(s.toJSON(),function(e,t){m.setRequestHeader(t,e)}),Yt.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),d&&"json"!==d&&(m.responseType=n.responseType),p&&([l,u]=Nr(p,!0),m.addEventListener("progress",l)),h&&m.upload&&([a,c]=Nr(h),m.upload.addEventListener("progress",a),m.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{m&&(r(!t||t.type?new xr(null,e,m):t),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===Sr.protocols.indexOf(v)?r(new tr("Unsupported protocol "+v+":",tr.ERR_BAD_REQUEST,e)):m.send(i||null)})},Gr=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const i=function(e){if(!r){r=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof tr?t:new xr(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new tr(`timeout ${t} of ms exceeded`,tr.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:a}=n;return a.unsubscribe=()=>Yt.asap(o),a}},Wr=function*(e,t){let r=e.byteLength;if(r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},Hr=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},Jr=(e,t,r,n)=>{const i=async function*(e,t){for await(const r of Hr(e))yield*Wr(r,t)}(e,t);let s,o=0,a=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return a(),void e.close();let s=n.byteLength;if(r){let e=o+=s;r(e)}e.enqueue(new Uint8Array(n))}catch(e){throw a(e),e}},cancel:e=>(a(e),i.return())},{highWaterMark:2})},Kr="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Yr=Kr&&"function"==typeof ReadableStream,Zr=Kr&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Xr=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Qr=Yr&&Xr(()=>{let e=!1;const t=new Request(Sr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),en=Yr&&Xr(()=>Yt.isReadableStream(new Response("").body)),tn={stream:en&&(e=>e.body)};Kr&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!tn[t]&&(tn[t]=Yt.isFunction(e[t])?e=>e[t]():(e,r)=>{throw new tr(`Response type '${t}' is not supported`,tr.ERR_NOT_SUPPORT,r)})})})(new Response);const rn=async(e,t)=>Yt.toFiniteNumber(e.getContentLength())??(async e=>null==e?0:Yt.isBlob(e)?e.size:Yt.isSpecCompliantForm(e)?(await new Request(Sr.origin,{method:"POST",body:e}).arrayBuffer()).byteLength:Yt.isArrayBufferView(e)||Yt.isArrayBuffer(e)?e.byteLength:(Yt.isURLSearchParams(e)&&(e+=""),Yt.isString(e)?(await Zr(e)).byteLength:void 0))(t),nn=Kr&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:h}=qr(e);c=c?(c+"").toLowerCase():"text";let p,f=Gr([i,s&&s.toAbortSignal()],o);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(l&&Qr&&"get"!==r&&"head"!==r&&0!==(g=await rn(u,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(Yt.isFormData(n)&&(e=r.headers.get("content-type"))&&u.setContentType(e),r.body){const[e,t]=Lr(g,Nr(Ur(l)));n=Jr(r.body,65536,e,t)}}Yt.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:f,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:i?d:void 0});let s=await fetch(p);const o=en&&("stream"===c||"response"===c);if(en&&(a||o&&m)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Yt.toFiniteNumber(s.headers.get("content-length")),[r,n]=a&&Lr(t,Nr(Ur(a),!0))||[];s=new Response(Jr(s.body,65536,r,()=>{n&&n(),m&&m()}),e)}c=c||"text";let v=await tn[Yt.findKey(tn,c)||"text"](s,e);return!o&&m&&m(),await new Promise((t,r)=>{Pr(t,r,{data:v,headers:Or.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(t){throw m&&m(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message)?Object.assign(new tr("Network Error",tr.ERR_NETWORK,e,p),{cause:t.cause||t}):tr.from(t,t&&t.code,e,p)}}),sn={http:null,xhr:zr,fetch:nn};Yt.forEach(sn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const on=e=>`- ${e}`,an=e=>Yt.isFunction(e)||null===e||!1===e,ln=e=>{e=Yt.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){let t;if(r=e[s],n=r,!an(r)&&(n=sn[(t=String(r)).toLowerCase()],void 0===n))throw new tr(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new tr("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(on).join("\n"):" "+on(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function cn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new xr(null,e)}function un(e){return cn(e),e.headers=Or.from(e.headers),e.data=Dr.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),ln(e.adapter||Er.adapter)(e).then(function(t){return cn(e),t.data=Dr.call(e,e.transformResponse,t),t.headers=Or.from(t.headers),t},function(t){return jr(t)||(cn(e),t&&t.response&&(t.response.data=Dr.call(e,e.transformResponse,t.response),t.response.headers=Or.from(t.response.headers))),Promise.reject(t)})}const dn="1.9.0",hn={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{hn[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const pn={};hn.transitional=function(e,t,r){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new tr(n(i," has been removed"+(t?" in "+t:"")),tr.ERR_DEPRECATED);return t&&!pn[i]&&(pn[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},hn.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};const fn={assertOptions:function(e,t,r){if("object"!=typeof e)throw new tr("options must be an object",tr.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],r=void 0===t||o(t,s,e);if(!0!==r)throw new tr("option "+s+" must be "+r,tr.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new tr("Unknown option "+s,tr.ERR_BAD_OPTION)}},validators:hn},mn=fn.validators;let gn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new fr,response:new fr}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const r=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?r&&!String(e.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+r):e.stack=r}catch{}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Vr(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;void 0!==r&&fn.assertOptions(r,{silentJSONParsing:mn.transitional(mn.boolean),forcedJSONParsing:mn.transitional(mn.boolean),clarifyTimeoutError:mn.transitional(mn.boolean)},!1),null!=n&&(Yt.isFunction(n)?t.paramsSerializer={serialize:n}:fn.assertOptions(n,{encode:mn.function,serialize:mn.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fn.assertOptions(t,{baseUrl:mn.spelling("baseURL"),withXsrfToken:mn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Yt.merge(i.common,i[t.method]);i&&Yt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=Or.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let c,u,d=0;if(!a){const e=[un.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=o.length;let h=t;for(d=0;d<u;){const e=o[d++],t=o[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{c=un.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return pr($r((e=Vr(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Yt.forEach(["delete","get","head","options"],function(e){gn.prototype[e]=function(t,r){return this.request(Vr(r||{},{method:e,url:t,data:(r||{}).data}))}}),Yt.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,i){return this.request(Vr(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}gn.prototype[e]=t(),gn.prototype[e+"Form"]=t(!0)});const vn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vn).forEach(([e,t])=>{vn[t]=e});const yn=function e(t){const r=new gn(t),n=pt(gn.prototype.request,r);return Yt.extend(n,gn.prototype,r,{allOwnKeys:!0}),Yt.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Vr(t,r))},n}(Er);yn.Axios=gn,yn.CanceledError=xr,yn.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,i){r.reason||(r.reason=new xr(e,n,i),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},yn.isCancel=jr,yn.VERSION=dn,yn.toFormData=lr,yn.AxiosError=tr,yn.Cancel=yn.CanceledError,yn.all=function(e){return Promise.all(e)},yn.spread=function(e){return function(t){return e.apply(null,t)}},yn.isAxiosError=function(e){return Yt.isObject(e)&&!0===e.isAxiosError},yn.mergeConfig=Vr,yn.AxiosHeaders=Or,yn.formToJSON=e=>Ir(Yt.isHTMLForm(e)?new FormData(e):e),yn.getAdapter=ln,yn.HttpStatusCode=vn,yn.default=yn;const{Axios:wn,AxiosError:bn,CanceledError:_n,isCancel:Sn,CancelToken:In,VERSION:En,all:An,Cancel:Rn,isAxiosError:kn,spread:Tn,toFormData:Cn,AxiosHeaders:On,HttpStatusCode:Dn,formToJSON:jn,getAdapter:xn,mergeConfig:Pn}=yn,Nn=class e{constructor(){return ct(this,"cache",[]),ct(this,"set",(e,t,r)=>{this.recordExists(e,r)||this.cache.push({url:e,body:r,result:t})}),ct(this,"get",(e,t)=>{const r=this.cache.find(r=>null!=t?r.url===e&&r.body===t:r.url===e);return null!=r?r.result:null}),ct(this,"recordExists",(e,t)=>null!=this.get(e,t)),null!=e.instance?e.instance:(e.instance=this,this)}};ct(Nn,"instance");let Ln=Nn;class Un{constructor(e){ct(this,"getToken"),ct(this,"cache",new Ln),ct(this,"getData",async e=>{if(this.cache.recordExists(e))return this.cache.get(e);try{const t=await this.getToken(),r=await yn.get(e,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return this.cache.set(e,r),r}catch(t){return console.error(`API call '${e}' fails with exception:`,t),null}}),this.getToken=e}}const Fn=class e extends Un{constructor(){super(...arguments),ct(this,"dataManagementBaseUrl","https://developer.api.autodesk.com/data/v1"),ct(this,"getUser",async()=>{try{const e=await this.getData("https://api.userprofile.autodesk.com/userinfo");return null==e?void 0:e.data}catch{return null}}),ct(this,"getHubs",async()=>{var e;const t=await this.getData("https://developer.api.autodesk.com/project/v1/hubs");return(null==(e=null==t?void 0:t.data)?void 0:e.data)??[]}),ct(this,"getHubRegion",async t=>{var r;const n=(await this.getHubs()).find(e=>e.id===t);return(null==(r=null==n?void 0:n.attributes)?void 0:r.region)??e.DEFAULT_REGION}),ct(this,"getProjects",async e=>{var t;const r=`https://developer.api.autodesk.com/project/v1/hubs/${e}/projects`,n=await this.getData(r);return(null==(t=null==n?void 0:n.data)?void 0:t.data)??[]}),ct(this,"getBIMDocument",async({projectId:e,itemId:t,versionId:r})=>{if(void 0!==t){const r=await this.getLatestVersion(e,t);if(this.isBIMDocumentDeleted(r))throw new Error("Document is deleted");return r}if(void 0!==r){const t=await this.getVersion(e,r);if(this.isBIMDocumentDeleted(t))throw new Error("Document is deleted");return t}throw new Error("Invalid parameters")}),ct(this,"getProject",async(e,t)=>{var r;const n=`https://developer.api.autodesk.com/project/v1/hubs/${e}/projects/${t}`,i=await this.getData(n);return null==(r=null==i?void 0:i.data)?void 0:r.data}),ct(this,"isBIMDocumentDeleted",e=>{var t,r;const n=null==(r=null==(t=null==e?void 0:e.attributes)?void 0:t.extension)?void 0:r.type;return(null==n?void 0:n.length)>0&&n.endsWith("Deleted")}),ct(this,"getItemVersions",async(e,t)=>{var r;const n=await this.getData(`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}/versions`);return(null==(r=null==n?void 0:n.data)?void 0:r.data)??[]}),ct(this,"getLatestVersion",async(e,t)=>{var r,n,i;const s=await this.getItemTipVersion(e,t);if(!1===(null==(i=null==(n=null==(r=null==s?void 0:s.attributes)?void 0:r.extension)?void 0:n.type)?void 0:i.includes("Deleted")))return s;const o=await this.getItemVersions(e,t);return null==o||o.sort((e,t)=>{var r,n;return(null==(r=null==t?void 0:t.attributes)?void 0:r.versionNumber)-(null==(n=null==e?void 0:e.attributes)?void 0:n.versionNumber)}),null==o?void 0:o.find(e=>{var t,r,n;return!(null!=(n=null==(r=null==(t=null==e?void 0:e.attributes)?void 0:t.extension)?void 0:r.type)&&n.includes("Deleted"))})}),ct(this,"getItemTipVersion",async(e,t)=>{var r;const n=await this.getData(`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}/tip`);return null==(r=null==n?void 0:n.data)?void 0:r.data}),ct(this,"getItem",async(e,t)=>{var r,n;const i=`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}`;return null==(n=null==(r=await this.getData(i))?void 0:r.data)?void 0:n.data}),ct(this,"getVersion",async(e,t)=>{var r;const n=await this.getData(`${this.dataManagementBaseUrl}/projects/${e}/versions/${encodeURIComponent(t)}`);return null==(r=null==n?void 0:n.data)?void 0:r.data}),ct(this,"searchFolder",async(e,t,r)=>{var n,i,s,o,a,l,c,u,d;let h=null,p=[];const f=this.buildFilter(r);if(0===f.length)return[];let m=`${this.dataManagementBaseUrl}/projects/${e}/folders/${t}/search?${f}`;do{null!=(null==(s=null==(i=null==(n=null==h?void 0:h.data)?void 0:n.links)?void 0:i.next)?void 0:s.href)&&(m=h.data.links.next.href),h=await this.getData(m);const e=null==(a=null==(o=null==h?void 0:h.data)?void 0:o.data)?void 0:a.length;void 0!==e&&e>0&&(p=p.concat((null==(l=null==h?void 0:h.data)?void 0:l.data)??[]))}while(null!=(null==(d=null==(u=null==(c=null==h?void 0:h.data)?void 0:c.links)?void 0:u.next)?void 0:d.href));return p}),ct(this,"buildFilter",e=>{if(""===e||"function"!=typeof(null==e?void 0:e.toString))return"";const t=e.toString(),r=[t];t.toLocaleLowerCase()!==t&&r.push(t.toLocaleLowerCase()),t.toLocaleUpperCase()!==t&&r.push(t.toLocaleUpperCase()),this.capitalizeFirstLetter(t)!==t&&r.push(this.capitalizeFirstLetter(t));const n=r.reduce((e,t)=>`${e}filter[attributes.displayName]-contains=${t}&`,"");return n.substring(0,n.length-1)}),ct(this,"capitalizeFirstLetter",e=>{if(0===e.length)return"";const t=e.codePointAt(0);if(null==t)return"";const r=t>65535?2:1;return String.fromCodePoint(t).toUpperCase()+e.slice(r)}),ct(this,"getForgeData",async e=>{var t,r,n;const i=[];if(e.length>0)for(let s=0;s<e.length;s++)try{let o=e[s];for(;null!=o;){const e=await this.getData(o);o=null==(n=null==(r=null==(t=e.data)?void 0:t.links)?void 0:r.next)?void 0:n.href,i.push(e)}}catch(e){return console.warn(e),null}else try{const e=await this.getData("https://developer.api.autodesk.com/project/v1/hubs");i.push(e)}catch(e){return console.warn(e),null}return i})}};ct(Fn,"DEFAULT_REGION","US");let Mn=Fn;var $n=(e=>(e.HUBS="hubs",e.PROJECTS="projects",e.FOLDERS="folders",e.ITEMS="items",e.MODEL_SETS="model-set",e.VERSIONS="versions",e.MODEL_SET_VERSION="model-set-version",e))($n||{});class Bn{constructor(e){ct(this,"baseUrl","https://developer.api.autodesk.com/modelderivative/v2"),ct(this,"getToken"),ct(this,"getFormats",async()=>{const e=await this.getToken(),t=`${this.baseUrl}/designdata/formats`,r=await yn.get(t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});return null==r?void 0:r.data}),this.getToken=e}}class Vn{constructor(e,t){ct(this,"_filter",""),ct(this,"parentAPS"),ct(this,"dataManagement"),ct(this,"root",null),ct(this,"search",async(e,t)=>{if(0===t.length)return e;if(null!=this.root&&t===this._filter)return this.root;this._filter=t;const r=JSON.parse(JSON.stringify(e)),n=r.item;return n.type===$n.HUBS?await this.searchHub(r,t):n.type===$n.PROJECTS?await this.searchProject(r,t):console.warn("Search root item is not a hub or project"),this.pruneNodes(null,r),r}),ct(this,"searchHub",async(e,t)=>{null!=e.children&&await Promise.all(e.children.map(async r=>{r.children=null,await this.searchProject(r,t),(null==r.children||0===r.children.length)&&this.removeNode(e,r)}))}),ct(this,"searchProject",async(e,t)=>{var r,n,i,s,o,a,l;await this.addProjectTopFolders(e);const c=e.item,u=null==(i=null==(n=null==(r=c.relationships)?void 0:r.rootFolder)?void 0:n.data)?void 0:i.id,d=await this.dataManagement.searchFolder(c.id,u,t);if(null==d||0===(null==d?void 0:d.length))return;const h=await this.filterInvalidSearchItems(d);for(let t=0;t<h.length;t++){const r=h[t],n=await this.createNode(r);if(null!=n&&null!=(null==(o=null==(s=r.links)?void 0:s.webView)?void 0:o.href)&&(null==(l=null==(a=r.links)?void 0:a.webView)?void 0:l.href.length)>0){const t=this.getParentFolderId(r.links.webView.href),i=`https://developer.api.autodesk.com/data/v1/projects/${c.id}/folders/${t}`;await this.buildParentFolders(e,n,i)}}}),ct(this,"pruneNodes",(e,t)=>{if(null==t.item)return;const r=t.item;if(r.type!==$n.HUBS&&r.type!==$n.PROJECTS&&r.type!==$n.FOLDERS)return;if(null!=t.children)for(let e=t.children.length-1;e>=0;e--)this.pruneNodes(t,t.children[e]);let n=!1;r.type===$n.FOLDERS&&(n=r.attributes.hidden),(r.type===$n.PROJECTS||r.type===$n.FOLDERS)&&(null==t.children||0===t.children.length||n)&&null!=e&&this.removeNode(e,t)}),ct(this,"filterInvalidSearchItems",async e=>{const t=await this.parentAPS.getViewerFormats();return e.filter(e=>this.parentAPS.isValidViewerFormat(e,t))}),ct(this,"removeNode",(e,t)=>{if(null!=e.children)for(let r=0;r<e.children.length;r++)if(e.children[r].id===t.id){e.children.splice(r,1);break}}),ct(this,"addProjectTopFolders",async e=>{const t=e.item;if(null==t||null==t.relationships.rootFolder||null==t.relationships.topFolders)return;const r=await this.dataManagement.getForgeData([t.relationships.topFolders.links.related.href]);if(null!=r)for(let t=0;t<r.length;t++){const n=r[t];if(0!==n.data.data.length)for(let t=0;t<n.data.data.length;t++){const r=await this.createNode(n.data.data[t]);null!=r&&this.addChild(e,r)}}}),ct(this,"buildParentFolders",async(e,t,r)=>{var n,i,s,o,a,l,c,u,d,h,p,f,m;if(null==r||0===r.length)return;const g=e.item,v=await this.dataManagement.getForgeData([r]);for(let r=0;r<v.length;r++){const y=v[r];if(null==(null==(n=null==y?void 0:y.data)?void 0:n.data)||(null==(o=null==(s=null==(i=g.relationships)?void 0:i.rootFolder)?void 0:s.data)?void 0:o.id)===y.data.data.id)return void this.addChild(e,t);const w=this.findNode(e,y.data.data.id);if(null!=w)return void this.addChild(w,t);const b=await this.createNode(y.data.data);if(null==b)return void this.addChild(e,t);if((null==(c=null==(l=null==(a=g.relationships)?void 0:a.rootFolder)?void 0:l.data)?void 0:c.id)===(null==(h=null==(d=null==(u=y.data.data.relationships)?void 0:u.parent)?void 0:d.data)?void 0:h.id))this.addChild(e,b);else{const t=null==(m=null==(f=null==(p=y.data.data.relationships)?void 0:p.parent)?void 0:f.data)?void 0:m.id,r=`https://developer.api.autodesk.com/data/v1/projects/${g.id}/folders/${t}`;await this.buildParentFolders(e,b,r)}this.addChild(b,t)}}),ct(this,"findNode",(e,t)=>{if(e.id===t)return e;if(null!=e.children&&e.children.length>0)for(let r=0;r<e.children.length;r++){const n=this.findNode(e.children[r],t);if(null!=n)return n}return null}),ct(this,"addChild",(e,t)=>{null==e.children?e.children=[t]:e.children.push(t)}),ct(this,"getParentFolderId",e=>e.includes("docs.b360")?this.getBIM360ParentFolderId(e):this.getACCParentFolderId(e)),ct(this,"getBIM360ParentFolderId",e=>{const t=e.split("/"),r=t.findIndex(e=>"folders"===e);return-1!==r?t[r+1]:""}),ct(this,"getACCParentFolderId",e=>{const t=e.split("?");if(t.length<2)return"";const r=t[1].split("&").find(e=>e.toLocaleLowerCase().startsWith("folderurn")),n=null!=r?r.split("="):[];return n.length>1?n[1]:""}),ct(this,"createNode",async e=>await this.parentAPS.mapAPSItemToIRepositoryItem(e)),this.parentAPS=e,this.dataManagement=t}}class qn{constructor(e){ct(this,"getRegionUrl",e=>{var t;return null==(t=this.getRegionInfo(e))?void 0:t.regionUrl}),ct(this,"getDocumentsRoot",(e,t)=>{var r,n;return this.getValidatedUrl(null==(n=null==(r=this.getRegionInfo(e))?void 0:r[t])?void 0:n.documentsRoot)}),ct(this,"getProjectRoot",(e,t)=>{var r,n;return this.getValidatedUrl(null==(n=null==(r=this.getRegionInfo(e))?void 0:r[t])?void 0:n.projectRoot)}),ct(this,"getRegionInfo",e=>{var t;return null==(t=this.regionsInfo)?void 0:t.regions[e]}),ct(this,"getValidatedUrl",e=>{var t;return 0===(null==(t=null==e?void 0:e.trim())?void 0:t.length)?void 0:e}),this.regionsInfo=e}}const zn={US:{regionUrl:"",ACC:{documentsRoot:"https://acc.autodesk.com",projectRoot:"https://acc.autodesk.com"},BIM360:{documentsRoot:"https://docs.b360.autodesk.com",projectRoot:"https://insight.b360.autodesk.com"}},EMEA:{regionUrl:"/regions/eu",ACC:{documentsRoot:"https://acc.autodesk.eu",projectRoot:"https://acc.autodesk.eu"},BIM360:{documentsRoot:"https://docs.b360.eu.autodesk.com",projectRoot:"https://insight.b360.eu.autodesk.com"}},APAC:{regionUrl:"/regions/apac",ACC:{documentsRoot:"https://acc.apac.autodesk.com",projectRoot:"https://acc.apac.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},AUS:{regionUrl:"/regions/aus",ACC:{documentsRoot:"https://acc.aus.autodesk.com",projectRoot:"https://acc.aus.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},GBR:{regionUrl:"/regions/gbr",ACC:{documentsRoot:"https://acc.gbr.autodesk.com",projectRoot:"https://acc.gbr.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},DEU:{regionUrl:"/regions/deu",ACC:{documentsRoot:"https://acc.deu.autodesk.com",projectRoot:"https://acc.deu.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},JPN:{regionUrl:"/regions/jpn",ACC:{documentsRoot:"https://acc.jpn.autodesk.com",projectRoot:"https://acc.jpn.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},CAN:{regionUrl:"/regions/can",ACC:{documentsRoot:"https://acc.can.autodesk.com",projectRoot:"https://acc.can.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},IND:{regionUrl:"/regions/ind",ACC:{documentsRoot:"https://acc.ind.autodesk.com",projectRoot:"https://acc.ind.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}}},Gn={regions:zn},Wn=Object.freeze(Object.defineProperty({__proto__:null,default:Gn,regions:zn},Symbol.toStringTag,{value:"Module"})),Hn=class e extends Un{constructor(){super(...arguments),ct(this,"getApsIssueJson",e=>{var t;return{id:e.id,title:e.title,displayId:e.displayId,description:e.description,status:e.status,published:e.published,target_urn:null==(t=e.linkedDocuments[0])?void 0:t.urn,issueSubtypeId:e.issueSubtypeId,issueTypeId:e.issueTypeId,createdAt:e.createdAt,updatedAt:e.updatedAt,locationDetails:e.locationDetails,dueDate:e.dueDate,rootCauseId:e.rootCauseId,ownerId:e.ownerId,linkedDocuments:e.linkedDocuments}})}async getIssue(t,r){var n;const i=e.baseUrl+`/projects/${t}/issues/${r}`,s=null==(n=await this.getData(i))?void 0:n.data;return null!=s?this.getApsIssueJson(s):null}static async getIssueSourceURL(e,t,r,n){var i,s;const o=null==(i=t.sourceData)?void 0:i.id;if(void 0!==o){let i=`${r}/docs/issues/projects/${e}/issues?issueId=${o}`;if(void 0!==(null==(s=t.sourceData)?void 0:s.target_urn)&&void 0!==n){const t=n.replace(`${r}/docs/files/projects/${e}?`,"").split("&");i=`${r}/docs/files/projects/${e}?folderUrn=${t[0].replace("folderUrn=","")}&entityId=${t[1].replace("entityId=","")}&viewModel=detail&moduleId=folders&issueId=${o}`}return i}}};ct(Hn,"baseUrl","https://developer.api.autodesk.com/construction/issues/v1");let Jn=Hn;const Kn=class e extends Un{constructor(){super(...arguments),ct(this,"getApsIssueJson",e=>{var t;return{id:e.id,title:e.title,displayId:e.displayId,description:e.description,status:e.status,target_urn:null==(t=e.linkedDocuments[0])?void 0:t.urn,issueSubtypeId:e.issueSubtypeId,issueTypeId:e.issueTypeId,createdAt:e.createdAt,updatedAt:e.updatedAt,locationDetails:e.locationDetails,dueDate:e.dueDate,rootCauseId:e.rootCauseId,ownerId:e.ownerId,linkedDocuments:e.linkedDocuments}})}async getIssue(t,r){var n;const i=e.baseUrl+`/containers/${t}/issues/${r}`,s=null==(n=await this.getData(i))?void 0:n.data;return null!=s?this.getApsIssueJson(s):null}static async getIssueSourceURL(e,t,r,n){var i,s;const o=null==(i=t.sourceData)?void 0:i.id;if(void 0!==o){let i=`${r}/projects/${e}/issues/${o}`;const a=null==(s=t.sourceData)?void 0:s.target_urn;if(void 0!==a&&void 0!==n){i=`${r}/projects/${e}/folders/${n.replace(`${r}/projects/${e}/folders/`,"").split("/")[0]}/detail/viewer/items/${a}/issues/${o}`}return i}}};ct(Kn,"baseUrl","https://developer.api.autodesk.com/issues/v2");let Yn=Kn;const Zn="APS";function Xn(e){return e.sourceType===Zn}const Qn=class e extends Un{constructor(t){super(t),ct(this,"issuesACC"),ct(this,"issuesBIM360"),ct(this,"getIssue",async(t,r)=>{var n,i,s;if(null==t)return null;const o=e.getProjectType(t),a=encodeURIComponent(r),l=t.id.replace("b.",""),c=null==(s=null==(i=null==(n=t.relationships)?void 0:n.issues)?void 0:i.data)?void 0:s.id;let u=null;switch(o){case"ACC":u=await this.issuesACC.getIssue(l,a);break;case"BIM360":u=await this.issuesBIM360.getIssue(c,a)}return null!==u?function(e,t){return{projectId:t,sourceType:Zn,sourceData:e}}(u,l):null}),this.issuesACC=new Jn(t),this.issuesBIM360=new Yn(t)}static isAPSIssue(t){return t.sourceType===e.ISSUE_SOURCE_TYPE}async getIssueSourceURL(t,r,n,i){var s;const o=e.getProjectType(t),a=null==(s=t.id)?void 0:s.replace("b.","");switch(o){case"ACC":return await Jn.getIssueSourceURL(a,r,n,i);case"BIM360":return await Yn.getIssueSourceURL(a,r,n,i)}}};ct(Qn,"ISSUE_SOURCE_TYPE","APS"),ct(Qn,"getProjectType",e=>{var t,r,n;return null==(n=null==(r=null==(t=null==e?void 0:e.attributes)?void 0:t.extension)?void 0:r.data)?void 0:n.projectType});let ei=Qn;const ti=e=>/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(e),ri=e=>{if("string"==typeof e)try{return decodeURIComponent(e)}catch{}return e};let ni=class e{constructor(e,t){ct(this,"id"),this.urn=e,this.source=t;const r=null==e?void 0:e.trim(),n=ti(r)?window.atob(r):r;this.urn=n;const i=null==n?void 0:n.split(/:|\./);this.id=i.length>0?i[i.length-1]:n}static fromUrn(t){return new e(t,t)}static fromUrl(t){return t.includes("docs.b360")?e.getItemIdFromB360Url(t):t.includes("acc.autodesk")?e.getItemIdFromACCUrl(t):t.includes("api.autodesk")?e.getItemIdFromDataManagementUrl(t):null}static getItemIdFromB360Url(t){return e.getItemIdFromUrl(t,"/","items")}static getItemIdFromACCUrl(t){return e.getItemIdFromUrl(t,"=","entityId")}static getItemIdFromDataManagementUrl(t){return e.getItemIdFromUrl(t,"/","versions")}static getItemIdFromUrl(t,r,n){const i=t.split(r),s=i.findIndex(e=>e.includes(n));if(s>-1){let r=i[s+1];return r=(null==r?void 0:r.split(/\?|&/))[0],new e(r,t)}return null}};const ii=class e{constructor(e,t){ct(this,"tokenInfo"),ct(this,"dataManagement"),ct(this,"derivatives"),ct(this,"issues"),ct(this,"search"),ct(this,"regions"),ct(this,"bimAccounts"),ct(this,"accountFilter"),ct(this,"supportedViewerFormats"),ct(this,"getProviderName",()=>"Autodesk"),ct(this,"setToken",e=>{this.tokenInfo=e}),ct(this,"getToken",async()=>{const e=this.tokenInfo.access_token??await this.tokenInfo.getToken();if(null===e)throw new Error("Invalid Token: token is null");return e}),ct(this,"getUser",async()=>{const e=await this.dataManagement.getUser();return`${null==e?void 0:e.name}`}),ct(this,"checkPermissions",async e=>void 0!==e.url&&e.url.length>0),ct(this,"setAccountFilter",e=>{this.accountFilter=e}),ct(this,"getDocument",async e=>{const t=e,r=t.projectId,n=t.itemId.replace("urn:","").replace("_","/"),i=ti(n)?window.atob(n):t.itemId,s=i.split("?")[0].replace("fs.file:vf.","dm.lineage:"),o=i.length>1?i.split("?")[1]:void 0,a=await this.getDocumentWithAttributes({projectId:r,itemId:s,versionId:o});return null===a?null:await this.validateAndFilterDocument(a)}),ct(this,"getDocumentItem",async e=>{const t=this.getProjectIdFromItemUrl(e.links.self.href),r=await this.getAttributes(t,e.attributes),n={displayName:(null==r?void 0:r.displayName)??"",fileName:(null==r?void 0:r.name)??"",url:e.links.self.href,attributes:r};return await this.validateAndFilterDocument(n)}),ct(this,"validateAndFilterDocument",async e=>{if(!this.isValidDocument(e))return null;const t=this.accountFilter;if(null==t)return e;const r=await this.filterDocuments([e],t);return null===r||0===r.length?null:r[0]}),ct(this,"getDocumentByUrl",async e=>(await this.runViewerUrlRule({viewerUrl:e}))[0]),ct(this,"getDocumentByRule",async(e,t)=>{const r=this.accountFilter;let n=[];if(e===ht.BIMDocument){const e=t;n=await this.runBIMDocumentRule(e)}else if(e===ht.ViewerUrl){const e=t;n=await this.runViewerUrlRule(e)}else{if(e!==ht.DocumentName)throw ht.ScheduleFeature,new Error(`Rule ${e} not supported`);{if(null==r)throw new Error("geobimAccounts is required for DocumentName rule");const e=t,i=await this.getFilteredAccounts(r);null!==i&&(n=await this.runDocumentNameRule(e,i))}}return null==r?n:await this.filterDocuments(n,r)??[]}),ct(this,"searchRepository",async(e,t)=>await this.search.search(e,t)),ct(this,"mapAPSItemToIRepositoryItem",async e=>{if(e.type===$n.ITEMS||e.type===$n.VERSIONS){const t=await this.getDocumentItem(e);return{id:e.id,label:(null==t?void 0:t.displayName)??"",document:t,item:null,children:null}}return{id:e.id,label:e.attributes.name,document:null,item:e,children:null}}),ct(this,"getIssue",async(e,t)=>{const r=await this.getBimAccount(e),n=null==r?void 0:r.id;if(void 0!==n){const r=await this.dataManagement.getProject(n,e),i=await this.issues.getIssue(r,t);return null!==i&&(i.sourceUrl=await this.getIssueSourceUrl(r,n,i)),i}return null}),ct(this,"isDocumentIssue",(e,t)=>{const r=t.url;if(void 0!==r){const t=ni.fromUrl(ri(r)),n=ni.fromUrn(e);if(null!==t)return t.id===n.id}return!1}),ct(this,"isValidDocument",e=>{var t,r;if(null===e)return!1;const n=null==(t=e.attributes)?void 0:t.accountName,i=null==(r=e.attributes)?void 0:r.projectName;return null!=n&&(null==n?void 0:n.length)>0&&null!=i&&(null==i?void 0:i.length)>0}),ct(this,"getAllAccounts",async()=>{var e;if(void 0!==this.bimAccounts)return this.bimAccounts;const t={},r=(await this.dataManagement.getHubs()).filter(e=>{var t,r;return"hubs:autodesk.bim360:Account"===(null==(r=null==(t=e.attributes)?void 0:t.extension)?void 0:r.type)});for(const n of r)if(void 0!==n.id){const r=(await this.dataManagement.getProjects(n.id)).map(e=>({id:e.id,name:e.attributes.name}));t[n.id]={id:n.id,projects:r,name:null==(e=n.attributes)?void 0:e.name}}return this.bimAccounts=t,this.bimAccounts}),ct(this,"checkAccountAccess",async e=>{const t=await this.getAllAccounts();return Object.keys(t).some(t=>t===e.accountId)}),ct(this,"getFilteredAccounts",async e=>{var t;if(null==e)return{};if(!await this.checkAccountAccess(e))return null;const r={},n=await this.getAllAccounts(),i=e;if(null!=i.projectIds&&i.projectIds.length>0){const e=null==(t=Object.values(n[i.accountId].projects))?void 0:t.filter(e=>{var t;return null==(t=i.projectIds)?void 0:t.includes(e.id)});r[i.accountId]={id:i.accountId,name:n[i.accountId].name,projects:e}}else r[i.accountId]=n[i.accountId];return r}),ct(this,"filterDocuments",async(e,t)=>{const r=await this.getFilteredAccounts(t);return null===r?null:e.filter(e=>{var t,n;const i=null==(t=e.attributes)?void 0:t.accountName;if(null==i)return!1;const s=Object.values(r).find(e=>e.name===i);if(null==s)return!1;const o=null==(n=e.attributes)?void 0:n.projectName;return null!=o&&null!=s.projects.find(e=>e.name===o)})}),ct(this,"runBIMDocumentRule",async e=>{const t=[],r=e.projectId,n=e.itemId,i=await this.getDocumentWithAttributes({projectId:r,itemId:n});return null!==i&&this.isValidDocument(i)&&t.push(i),t}),ct(this,"runViewerUrlRule",async e=>{const t=this.getProjectIdFromUrl(e.viewerUrl),r=this.getItemIdFromUrl(e.viewerUrl),n=await this.getDocumentWithAttributes({projectId:t,itemId:r});return null===n?[]:this.isValidDocument(n)?[n]:[]}),ct(this,"getProjectIdFromUrl",e=>e.includes("docs.b360")?this.getProjectIdFromB360Url(e):e.includes("acc.autodesk")?this.getProjectIdFromACCUrl(e):""),ct(this,"getProjectIdFromB360Url",e=>{const t=e.split("/"),r=t.findIndex(e=>"projects"===e);return r>-1?`b.${t[r+1]}`:""}),ct(this,"getProjectIdFromACCUrl",e=>{const t=e.split("/");return t.findIndex(e=>"projects"===e)>-1?"b."+t[6].split("?")[0]:""}),ct(this,"getItemIdFromUrl",e=>e.includes("docs.b360")?this.getItemIdFromB360Url(e):e.includes("acc.autodesk")?this.getItemIdFromACCUrl(e):""),ct(this,"getItemIdFromB360Url",e=>{const t=e.split("/"),r=t.findIndex(e=>"items"===e);return r>-1?decodeURIComponent(t[r+1]):""}),ct(this,"getItemIdFromACCUrl",e=>{const t=e.split("="),r=t.findIndex(e=>e.includes("entityId"));return r>-1?decodeURIComponent(t[r+1]):""}),ct(this,"runDocumentNameRule",async(e,t)=>{const r=[],n=e.documentName;for(const e of Object.values(t))for(const t of e.projects){const i=await this.runDocumentNameRuleOnProject(e.id,t.id,n);r.push(...i)}return r}),ct(this,"runDocumentNameRuleOnProject",async(e,t,r)=>{var n,i,s,o;const a=[],l=await this.dataManagement.getProject(e,t),c=null==(s=null==(i=null==(n=null==l?void 0:l.relationships)?void 0:n.rootFolder)?void 0:i.data)?void 0:s.id;if(null==c)return a;const u=await this.dataManagement.searchFolder(t,c,r.trim()),d=await this.getViewerFormats();for(const e of u){if(!this.isValidViewerFormat(e,d))continue;const r=await this.getAttributes(t,e.attributes);a.push({displayName:e.attributes.displayName,fileName:e.attributes.name,url:null==(o=e.links)?void 0:o.self.href,attributes:r})}return a}),ct(this,"getAttributes",async(e,t)=>{if(null==t)return;const r=["name","displayName","versionNumber","createUserName"],n={accountName:"",projectName:""};Object.keys(t).forEach(e=>{r.includes(e)&&(n[e]=t[e].toString())});const i=await this.getAllAccounts(),s=Object.values(i).find(t=>t.projects.some(t=>t.id===e));null!=(null==s?void 0:s.name)&&(n.accountName=s.name);const o=null==s?void 0:s.projects.find(t=>t.id===e);return null!=(null==o?void 0:o.name)&&(n.projectName=o.name),n}),ct(this,"getRepositoryItems",async e=>{if(null===e&&null!==this.accountFilter&&!await this.checkAccountAccess(this.accountFilter))return null;const t=this.getChildUrls(e),r=await this.dataManagement.getForgeData(t);if(null==r)return null;const n=[],i=this.accountFilter,s=await this.getViewerFormats();for(let e=0;e<r.length;e++){const t=r[e],o=[...t.data.data,...t.data.included??[]];for(let e=0;e<o.length;e++){const t=o[e];if((null==i||await this.filterResult(t,i,s))&&t.type!==$n.ITEMS){const e=await this.mapAPSItemToIRepositoryItem(t);null!=e&&n.push(e)}}}return n}),ct(this,"getChildUrls",e=>{const t=null==e?void 0:e.item;switch(null==t?void 0:t.type){case $n.HUBS:return this.getHubChildUrls(t);case $n.PROJECTS:return this.getProjectChildUrls(t);case $n.FOLDERS:return this.getFolderChildUrls(t);default:return[]}}),ct(this,"getHubChildUrls",e=>null==e.relationships.projects?[]:[e.relationships.projects.links.related.href]),ct(this,"getProjectChildUrls",e=>null==e.relationships.topFolders?[]:[e.relationships.topFolders.links.related.href]),ct(this,"getFolderChildUrls",e=>null==e.relationships.contents?[]:[e.relationships.contents.links.related.href]),ct(this,"getProjectIdFromItemUrl",e=>{const t=e.split("/"),r=t.findIndex(e=>"projects"===e);return r>-1?t[r+1]:""}),ct(this,"filterResult",async(e,t,r)=>{const n=await this.getFilteredAccounts(t);return null!==n&&(e.type===$n.HUBS?null!=n[e.id]:e.type===$n.PROJECTS?null!=Object.values(n).find(t=>null!=t.projects.find(t=>t.id===e.id)):e.type!==$n.ITEMS&&e.type!==$n.VERSIONS||this.isValidViewerFormat(e,r))}),ct(this,"isValidViewerFormat",(e,t)=>{if(e.type!==$n.ITEMS&&e.type!==$n.VERSIONS)return!1;const r=this.getFileType(e);return null!=r&&t.some(e=>e.toLowerCase()===(null==r?void 0:r.toLowerCase()))}),ct(this,"getViewerFormats",async()=>{var e;if(null!=this.supportedViewerFormats)return this.supportedViewerFormats;const t=await this.derivatives.getFormats(),r=(null==(e=null==t?void 0:t.formats)?void 0:e.svf2)??[];return this.supportedViewerFormats=r.concat(this.getForgeViewerAdditionalSupportedFormats().filter(e=>!r.includes(e))),this.supportedViewerFormats}),ct(this,"getFileType",e=>{var t,r;if(e.type===$n.VERSIONS){const r=e;return null!=r.attributes.fileType?null==(t=r.attributes.fileType)?void 0:t.toLowerCase():null}return(null==(r=e.attributes.displayName.split(".").pop())?void 0:r.toLowerCase())??null}),ct(this,"getForgeViewerAdditionalSupportedFormats",()=>["jpg","jpeg","png"]),ct(this,"getDocumentWithAttributes",async e=>{const t=await this.dataManagement.getBIMDocument(e);if(null===(t??null))return null;const r=await this.getAttributes(e.projectId,t.attributes);return{displayName:t.attributes.displayName,fileName:t.attributes.name,url:t.links.self.href,attributes:r}}),this.setToken(e.tokenInfo),this.dataManagement=new Mn(this.getToken),this.derivatives=new Bn(this.getToken),this.issues=new ei(this.getToken),this.search=new Vn(this,this.dataManagement),this.regions=new qn(t),this.accountFilter=null}static async create(t){const r=await this.getApsRegionsInfo(t);return new e(t,r)}async getIssueSourceUrl(e,t,r){var n,i,s;const{projectType:o}=e.attributes.extension.data,a=await this.dataManagement.getHubRegion(t),l=this.regions.getDocumentsRoot(a,o);if(void 0===l)return;const c=null==(n=null==r?void 0:r.sourceData)?void 0:n.linkedDocuments;if(void 0!==c&&c.length>0){const t=c[0].urn;if(void 0!==t){const n=await this.dataManagement.getItem(e.id,t),o=null==(s=null==(i=null==n?void 0:n.links)?void 0:i.webView)?void 0:s.href;if(void 0!==o)return await this.issues.getIssueSourceURL(e,r,l,ri(o))}}}async getBimAccount(e){const t=this.accountFilter;if(null!==t){const r=await this.getFilteredAccounts(t);return null===r?void 0:Object.values(r).find(t=>null!=t.projects.find(t=>t.id===e))}}};ct(ii,"getApsRegionsInfo",async e=>{const t=e.apsRegionsInfoUrl;if(null!==t){const e=await ii.getApsRegionsInfoFromPortal(t);if(null!==e)return e}return Wn}),ct(ii,"getApsRegionsInfoFromPortal",async e=>{try{const t=await fetch(e);if(null!=t&&t.ok)return await t.text()}catch(e){console.error("Unable to fetch APS regions config so using default regions config.",e)}return null});const si=(0,f.createContext)(void 0);function oi({options:e,children:t}){const[r,n]=(0,f.useState)(null),[i,s]=(0,f.useState)(null),[o,a]=(0,f.useState)(!1),[l,c]=(0,f.useState)(!1),[u,d]=(0,f.useState)(null),[h,p]=(0,f.useState)(null),[m,g]=(0,f.useState)(void 0),[v,y]=(0,f.useState)(void 0),[S,I]=(0,f.useState)(void 0);(0,f.useEffect)(()=>{l&&null!=(null==i?void 0:i.current)&&!o&&a(!0)},[o,i,l]),(0,f.useEffect)(()=>{(async()=>{if(null!==e&&null!=(null==i?void 0:i.current)&&o){const t=new at(i.current,e),r=await t.start();if(r===w.OK)n(t),d(null);else{const e=new _("GeoBIM APS Model Viewer Provider Error",b.INTERNAL_ERROR,"Initialization Error Code:",r);d(e)}}})()},[e,o,i]),(0,f.useEffect)(()=>{(async()=>{if(null!==r&&null!==h)try{d(null),await r.loadModel(h,m,v??[]),await r.showIssues(S??[])}catch(e){const t=e instanceof _?e:new _("GeoBIM APS Model Viewer Provider Error",b.INTERNAL_ERROR,e.message);d(t)}})()},[r,h,m,v,S]);const E=(0,f.useCallback)(()=>{c(!1),null!==r&&r.dispose(),n(null),d(null),s(null),a(!1),p(null),I(void 0),g(void 0)},[r]),A=(0,f.useCallback)(e=>{(null==i?void 0:i.current)!==(null==e?void 0:e.current)&&(E(),s(e))},[E,i]),R=(0,f.useCallback)(e=>{c(e)},[]),k=(0,f.useCallback)(()=>{null!==r&&r.resize()},[r]),T=(0,f.useCallback)((e,t,r,n=[])=>{p(e),g(t),y(r);const i=[];for(const e of n)Xn(e)&&i.push(e);I(i)},[]),C=(0,f.useMemo)(()=>({viewerVisible:l,viewerError:u,setModelViewerContainerRef:A,showModelViewer:R,resizeModelViewer:k,viewDocument:T,unloadModelViewer:E}),[l,u,A,R,k,T,E]);return it(si.Provider,{value:C,children:t})}function ai(){const e=(0,f.useContext)(si);if(void 0===e)throw new Error("Must call useModelViewer inside of ModelViewerProvider");return e}const li=(0,m.css)({label:"viewerContainer",position:"relative",height:"100%",width:"100%"}),ci=(0,m.css)({label:"hiddenViewerContainer",position:"relative",height:"1px",width:"1px",zIndex:-1});function ui(){const{viewerVisible:e,setModelViewerContainerRef:t,unloadModelViewer:r}=ai(),n=(0,f.useRef)(null),[i,s]=(0,f.useState)(!1),[o,a]=(0,f.useState)(!1);return(0,f.useEffect)(()=>(a(!1),()=>{a(!0)}),[]),(0,f.useEffect)(()=>(null==(null==n?void 0:n.current)||o||i||(t(n),s(!0)),()=>{o&&(r(),s(!1))}),[i,t,r,o]),it("div",{css:e?li:ci,ref:n})}const di=new Set(["children","localName","ref","style","className"]),hi=new WeakMap,pi=(e,t,r,n,i)=>{const s=null==i?void 0:i[t];void 0===s?(e[t]=r,null==r&&t in HTMLElement.prototype&&e.removeAttribute(t)):r!==n&&((e,t,r)=>{let n=hi.get(e);void 0===n&&hi.set(e,n=new Map);let i=n.get(t);void 0!==r?void 0===i?(n.set(t,i={handleEvent:r}),e.addEventListener(t,i)):i.handleEvent=r:void 0!==i&&(n.delete(t),e.removeEventListener(t,i))})(e,s,r)},fi=({react:e,tagName:t,elementClass:r,events:n,displayName:i})=>{const s=new Set(Object.keys(n??{})),o=e.forwardRef((i,o)=>{const a=e.useRef(new Map),l=e.useRef(null),c={},u={};for(const[e,t]of Object.entries(i))di.has(e)?c["className"===e?"class":e]=t:s.has(e)||e in r.prototype?u[e]=t:c[e]=t;return e.useLayoutEffect(()=>{if(null===l.current)return;const e=new Map;for(const t in u)pi(l.current,t,i[t],a.current.get(t),n),a.current.delete(t),e.set(t,i[t]);for(const[e,t]of a.current)pi(l.current,e,void 0,t,n);a.current=e}),e.useLayoutEffect(()=>{var e;null==(e=l.current)||e.removeAttribute("defer-hydration")},[]),c.suppressHydrationWarning=!0,e.createElement(t,{...c,ref:e.useCallback(e=>{l.current=e,"function"==typeof o?o(e):null!==o&&(o.current=e)},[o])})});return o.displayName=i??r.name,o};var mi=class{resolve(e){}reject(e){}constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};function gi(e,t,r){const{subscribe:n}=function(e){const t=e.join(","),r=vi[t];if(void 0!==r)return r;const n=new Set,i=new MutationObserver(e=>n.forEach(t=>t(e)));globalThis.document&&i.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const s={subscribe:e=>(n.add(e),()=>{n.delete(e),0===n.size&&(i.disconnect(),vi[t]=void 0)})};return vi[t]=s,s}(t);return n(t=>{const n=t.some(t=>function(e,t){let r=e;for(;r;){if(r===t)return!0;if(!r.parentNode)return!1;r=r.parentNode instanceof ShadowRoot?r.parentNode.host:r.parentNode}return!1}(e,t.target));n&&r()})}var vi={};function yi(e,t,r){const n=function(e,t){var r,n;let i=e;for(;i;){const e=null==(r=i.closest)?void 0:r.call(i,t);if(e)return e;const s=null==(n=i.getRootNode)?void 0:n.call(i);if(s===globalThis.document)return null;i=s.host}return null}(e,`[${t}]`);return(null==n?void 0:n.getAttribute(t))??r}function wi(e,t,...r){try{return null==e?void 0:e.call(t,...r)}catch(t){console.error(t,e)}}async function bi(e,t,...r){try{const n=null==e?void 0:e.call(t,...r);return n instanceof Promise?await n:n}catch(t){console.error(t,e)}}var _i=new Set(["ar","bg","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","no","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),Si="en",Ii={pt:"pt-PT",nb:"no",zh:"zh-CN"};async function Ei(e,t,r=""){const n=`${t}/${r}`,i=`${n}${e}.json`;return Ai[i]??(Ai[i]=Ri(e,n)),await Ai[i]}var Ai={};async function Ri(e,t){const r=`${t}${e}.json`;try{const e=await fetch(r);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===Si?{}:await Ri(Si,t)}function ki(e){var t;const r=yi(e,"lang",(null==(t=globalThis.navigator)?void 0:t.language)||Si);return{lang:r,t9nLocale:Ti(r)}}function Ti(e){const[t,r]=e.split("-"),n=t.toLowerCase();let i=n;return r&&(i=`${n}-${r.toUpperCase()}`),i=Ii[i]??i,_i.has(i)?i:r?Ti(n):Si}function Ci(e,t,r,n){let i;const s=()=>{(async function(e,t,r=e.tagName.toLowerCase().split("-").slice(1).join("-")){const{lang:n,t9nLocale:i}=ki(e),s=`${t}/${r}/t9n`,o="messages.",a=null===r?{}:await Ei(i,s,o);return{lang:n,t9nLocale:i,t9nStrings:a}})(e,t(),n).then(e=>{(null==i?void 0:i.lang)===e.lang&&i.t9nLocale===e.t9nLocale&&i.t9nStrings===e.t9nStrings||r(e),i=e}).catch(console.error)};return queueMicrotask(s),gi(e,["lang"],s)}var Oi=e=>e.replace(Di,(e,t)=>`${0===t?"":"-"}${e.toLowerCase()}`),Di=/[A-Z]+(?![a-z])|[A-Z]/gu;var ji=4;function xi(e){return void 0!==e}function Pi(e){var t,r;let n=e;for(;n=n.parentNode??n.host;)if(null==(t=null==n?void 0:n.constructor)?void 0:t.lumina){const t=n;return(null==(r=t.manager)?void 0:r.loadedCalled)||t._offspring.push(e),t._postLoad.promise}return!1}var Ni=Object.defineProperty;var Li=globalThis.HTMLElement??function(e){const t=e.split(":");return 1===t.length?[t[0],Oi(t[0])]:t};function Ui([e,t]){this[e]=t}(class extends Li{constructor(){super(),this._store={},this._pendingAttributes=[],this._postLoad=new mi,this._postLoaded=new mi,this._offspring=[],this._saveInstanceProperties();const e=this.constructor;e._LitConstructor?this._initializeComponent({a:e._LitConstructor}):e._loadPromise.then(this._initializeComponent.bind(this)).catch(e=>{this._postLoaded.reject(e),setTimeout(()=>{throw e})})}static _initializePrototype(){var e,t,r;null==(e=this._properties)||e.forEach(this._bindProp,this),null==(t=this._asyncMethods)||t.forEach(this._bindAsync,this),null==(r=this._syncMethods)||r.forEach(this._bindSync,this)}static _bindProp(e){Ni(this.prototype,e,{configurable:!0,enumerable:!0,get(){return this._store[e]},set(t){this._store[e]=t}})}static _bindAsync(e){Ni(this.prototype,e,{async value(...t){this._litElement||await this._postLoaded.promise;const r=this._litElement;return await r[e](...t)},configurable:!0})}static _bindSync(e){Ni(this.prototype,e,{value(...t){return this._litElement[e](...t)},configurable:!0})}get manager(){var e;return null==(e=this._litElement)?void 0:e.manager}_saveInstanceProperties(){var e;const t=this.constructor,r=this;null==(e=t._properties)||e.forEach(e=>{Object.hasOwn(this,e)&&(this._store[e]=r[e],delete r[e])})}attributeChangedCallback(e,t,r){var n;null==(n=this._litElement)||n.attributeChangedCallback(e,t,r),this._litElement||this._pendingAttributes.push(e)}connectedCallback(){var e,t;this._litElement?null==(t=(e=this._litElement).connectedCallback)||t.call(e):queueMicrotask(()=>{this._ancestorLoad=Pi(this)})}disconnectedCallback(){var e,t;null==(t=null==(e=this._litElement)?void 0:e.disconnectedCallback)||t.call(e)}async componentOnReady(){return await this._postLoaded.promise,this}_initializeComponent(e){var t;const r=this.constructor,n=r._name,i=this._store,s=Object.values(e).find(e=>e.tagName===n);const o=`${n}--lazy`;let a=s;for(;a&&!Object.hasOwn(a,"lumina");)a=Object.getPrototypeOf(a);!function(e){const t=e.prototype,r=Element.prototype;Object.hasOwn(t,"isConnected")||(t.setAttribute=function(e,t){r.setAttribute.call(this.el,e,t)},t.removeAttribute=function(e){r.removeAttribute.call(this.el,e)},Ni(t,"isConnected",{get(){return Reflect.get(r,"isConnected",this.el)}}));0}(a);!r._LitConstructor&&(r._LitConstructor=s,customElements.define(o,s)),s.lazy=this;const l=document.createElement(o);s.lazy=void 0,this._litElement=l,this._store=l,this._pendingAttributes.forEach(e=>{const t=this.getAttribute(e);l.attributeChangedCallback(e,null,t)}),Object.entries(i).forEach(Ui,l);const c=this.isConnected;(c||this._ancestorLoad)&&(null==(t=l.connectedCallback)||t.call(l),c||l.disconnectedCallback())}addController(){}requestUpdate(){var e;null==(e=this._litElement)||e.requestUpdate()}}).lumina=!0;var Fi={};var Mi,$i=Symbol.for("controller");function Bi(e){Mi!==e&&(Mi=e,queueMicrotask(()=>{Mi===e&&(Mi=void 0)}))}function Vi(e){return Mi}var qi,zi=[];function Gi(e){if(void 0===e)return void(zi=[]);const t=zi.indexOf(e);zi=-1===t?[...zi,e]:zi.slice(0,t+1),queueMicrotask(()=>{zi=[]})}function Wi(){return zi}var Hi,Ji=async(e,t)=>{const r=Yi(e);if(void 0===r)return e;if(await r.ready,"function"==typeof t){0;const e=r.watchExports(r=>t(r,e))}return r.exports},Ki=async e=>{const t=Yi(e);return await t.ready,t},Yi=e=>{const t=Vi().manager.internals.resolveExports(e);if(void 0!==t)return t;if((e=>"object"==typeof e&&null!==e&&($i in e||"hostConnected"in e||"hostDisconnected"in e||"hostUpdate"in e||"hostUpdated"in e))(e))return e;const r=function(){const e=qi;return qi=void 0,e}();return void 0!==r?r:void 0},Zi={readOnly:!1},Xi=new WeakMap;Hi=$i;var Qi=class{constructor(e){this._callbacks={hostConnected:[],hostDisconnected:[],hostLoad:[],hostLoaded:[],hostUpdate:[],hostUpdated:[],hostDestroy:[],hostLifecycle:[]},this._ready=new mi,this._lifecycleCleanups=[],this.connectedCalled=!1,this._loadCalled=!1,this.loadedCalled=!1,this[Hi]=!0,this.ready=this._ready.promise,this._exports=rs(this),this._exportWatchers=new Set;const t=e??Vi(new.target.name);this.component=t,this.component.addController(this);void 0===this.component.manager||(Gi(this),queueMicrotask(()=>this.catchUpLifecycle()))}catchUpLifecycle(){const{manager:e}=this.component;!e.connectedCalled||this.connectedCalled||this.triggerConnected();!e._loadCalled||this.triggerLoad().then(()=>{!e.loadedCalled||this.triggerLoaded()}).catch(console.error)}get exports(){return this._exports}set exports(e){const t=this._exports;t!==e&&(this._exports=e,this._exportWatchers.forEach(wi),this.connectedCalled&&!1!==this.assignedProperty&&this.component.requestUpdate(this.assignedProperty,t)),this._ready.resolve(e)}setProvisionalExports(e,t=!0){this._exports=t?rs(e):e,this._exportWatchers.forEach(wi)}watchExports(e){const t=()=>e(this._exports);return this._exportWatchers.add(t),()=>{this._exportWatchers.delete(t)}}get use(){return Bi(this.component),Ji}get useRef(){return Bi(this.component),Ki}get useRefSync(){return Bi(this.component),Yi}controllerRemoved(){this.component.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){this._callbacks.hostConnected.push(e)}onDisconnected(e){this._callbacks.hostDisconnected.push(e)}onLoad(e){this._callbacks.hostLoad.push(e)}onLoaded(e){this._callbacks.hostLoaded.push(e)}onUpdate(e){this._callbacks.hostUpdate.push(e)}onUpdated(e){this._callbacks.hostUpdated.push(e)}onDestroy(e){this._callbacks.hostDestroy.push(e)}onLifecycle(e){this._callbacks.hostLifecycle.push(e),this.connectedCalled&&this.component.el.isConnected&&this._callLifecycle(e)}triggerConnected(){const e=this;e.hostConnected&&wi(e.hostConnected,e),this._callbacks.hostConnected.forEach(wi),this.triggerLifecycle(),this.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&wi(e.hostDisconnected,e),this._callbacks.hostDisconnected.forEach(wi),this._lifecycleCleanups.forEach(wi),this._lifecycleCleanups=[]}async triggerLoad(){if(this._loadCalled)return;this._loadCalled=!0;const e=this;e.hostLoad&&await bi(e.hostLoad,e),this._callbacks.hostLoad.length>0&&await Promise.allSettled(this._callbacks.hostLoad.map(bi)),this._ready.resolve(this._exports)}triggerLoaded(){if(this.loadedCalled)return;const e=this;e.hostLoaded&&wi(e.hostLoaded,e),this._callbacks.hostLoaded.forEach(wi),this.loadedCalled=!0}triggerUpdate(e){const t=this;t.hostUpdate&&wi(t.hostUpdate,t,e),this._callbacks.hostUpdate.forEach(es,e)}triggerUpdated(e){const t=this;t.hostUpdated&&wi(t.hostUpdated,t,e),this._callbacks.hostUpdated.forEach(es,e)}triggerDestroy(){const e=this;e.hostDestroy&&wi(e.hostDestroy,e),this._callbacks.hostDestroy.forEach(wi)}triggerLifecycle(){const e=this;e.hostLifecycle&&this._callLifecycle(()=>e.hostLifecycle()),this._callbacks.hostLifecycle.forEach(this._callLifecycle,this)}_callLifecycle(e){Bi(this.component);const t=wi(e);(Array.isArray(t)?t:[t]).forEach(e=>{"function"==typeof e?this._lifecycleCleanups.push(e):"object"==typeof e&&"function"==typeof e.remove&&this._lifecycleCleanups.push(e.remove)})}};function es(e){wi(e,void 0,this)}var ts=Qi;function rs(e){if("object"!=typeof e&&"function"!=typeof e||null===e)return e;const t=new Proxy(e,{get(e,r,n){if(!ns.has(r)||!(r in e)||e[r]!==t)return r in e||r in Promise.prototype||"symbol"==typeof r?"function"==typeof e?e[r]:Reflect.get(e,r,n):void 0},set:(e,t,r,n)=>Reflect.set(e,t,r,n)});return t}var ns=new Set(["exports","_exports"]);var is=void 0;function ss(){Array.from((null==is?void 0:is.entries())??[]).forEach(([e,{callbacks:t}])=>{const r=Object.keys(e);t.forEach(e=>e(r))}),is=void 0}function os(e,t,r){var n;const i=t;const s=e.manager.internals;(n=s.allWatchers)[i]??(n[i]=[]);const o=s.allWatchers[i],a=r,l=(e,t,r)=>wi(a,null,e,t,r);return o.push(l),()=>{const e=o.indexOf(l);-1!==e&&o.splice(e,1)}}var as=class{constructor(e){this.enabledWatchers={},this.allWatchers={},this.enableReadonly=()=>{if(this.enableReadonly=void 0,!this.component.manager.isLit)return;const e=this.component.manager.internals;Object.entries(e.members).forEach(([t,[r]])=>{var n;2048&r&&((n=e.setters)[t]??(n[t]=[]),e.setters[t].push(e.readonlySetter))})},this.trackedValue=us,this.keyTrackers=[],this.getters={},this.setters={},this.accessorGetter={},this.accessorSetter={},this._exports=new WeakMap,this.readonlySetter=(e,t,r)=>{if(Zi.readOnly)return e;throw new Error(`Cannot assign to read-only property "${r}" of ${this.component.el.tagName.toLowerCase()}. Trying to assign "${String(e)}"`)},this.component=e}firePropTrackers(e,t){const r=this.keyTrackers;this.trackedValue=us,this.keyTrackers=[],r.forEach(r=>r(e,t))}getSetProxy(e){const t=this.component,r=t.constructor.prototype;if(this._getSetProxy(r,e,"class"),t.manager.isLit)return;const n=t.el.constructor.prototype;r!==n&&this._getSetProxy(n,e,"html")}_getSetProxy(e,t,r){const n=((e,t)=>{var r,n;return null==(n=null==(r=e.manager.internals.members)?void 0:r[t])?void 0:n[0]})(this.component,t);let i;do{i=Object.getOwnPropertyDescriptor(e,t)}while(!i&&(e=Object.getPrototypeOf(e)));if(!i)return;const s=i.get,o=i.set,a=cs in s,l=cs in o;if(a&&l)return;const c=!a,u=!l,d=c?function(){let e=s.call(this);const r=Xi.get(this);if(void 0===r)return e;const n=r.manager.internals;e=n.accessorGetter[t](e,t);const i=n.getters[t]??ls;for(let r=0;r<i.length;r++)e=i[r](e,t);return e}:s,h=u?function(e){var r;const i=s.call(this),a=Xi.get(this);if(void 0===a)return void o.call(this,e);let l=a.manager.isLit?e??void 0:function(e,t=8){return null==e||"object"==typeof e||"function"==typeof e?e:4&t?"false"!==e&&(""===e||!!e):2&t?Number.parseFloat(e):1&t?String(e):e}(e,n);const c=a.manager.internals;if(l===i)o.call(this,l);else{const e=c.setters[t]??ls;for(let r=0;r<e.length&&(l=e[r](l,i,t),l!==i);r++);l=c.accessorSetter[t](l,i,t),o.call(this,l),l!==i&&(null==(r=c.enabledWatchers[t])||r.forEach(e=>e(l,i,t)))}c.keyTrackers.length>0&&(null==c||c.firePropTrackers(t,e))}:o;c&&(d[cs]=!0),u&&(h[cs]=!0),Object.defineProperty(e,t,{...i,get:d,set:h})}markExports(e,t){("object"==typeof t&&null!==t||"function"==typeof t)&&this._exports.set(t,e)}resolveExports(e){return"object"==typeof e&&null!==e||"function"==typeof e?this._exports.get(e):void 0}},ls=[],cs=Symbol(),us=Symbol();function ds(e=[Vi(),...Wi()],t,r){const n=Array.isArray(e)?e:[e];let i=n.length+1;const s=e=>{i-=1,void 0!==e&&(i=Math.min(i,0)),0===i&&t(e)};n.forEach(e=>function(e,t,r){const n=Object.keys(e),i=n.length;void 0===is&&queueMicrotask(ss),is??(is=new Map);let s=is.get(e);return void 0===s&&(s={callbacks:[],keyCount:i},is.set(e,s)),s.keyCount!==i&&(s.callbacks.forEach(e=>e(n)),s.callbacks=[],s.keyCount=i),s.callbacks.push(n=>{const s=e=>wi(t,null,e),o=n[i];void 0===o?s(void 0):e[o]===r?s(o):s(void 0)}),r}(e,t=>s(void 0===t?void 0:{key:t,host:e,isReactive:!1}),r));const o=n.find(e=>"manager"in e&&"object"==typeof e.manager&&e.manager.component===e);return o&&function(e,t,r){const n=e.manager.internals;n.trackedValue!==us&&n.trackedValue!==r&&n.firePropTrackers(void 0,void 0),0===n.keyTrackers.length&&queueMicrotask(()=>n.firePropTrackers(void 0,void 0)),n.trackedValue=r,n.keyTrackers.push((e,n)=>wi(t,void 0,r===n?e:void 0))}(o,e=>s(void 0===e?void 0:{key:e,host:o,isReactive:!0}),r),r}var hs=class extends ts{constructor(e,t){const r="addController"in e;const n=new Set;const i=e;if(i.addController=function(t){var r;n.add(t),!($i in t)&&e.renderRoot&&e.el.isConnected&&(null==(r=t.hostConnected)||r.call(t))},i.removeController=function(e){var t;n.delete(e),null==(t=e.controllerRemoved)||t.call(e)},!r){const r=t??e.constructor.__forceUpdate;i.requestUpdate=()=>r(e)}super(e),this.internals=new as(this.component),this.destroyed=!1,this._updatePromise=new mi,this._originalLifecycles={},this.isLit=r,this.component.manager=this,function(e,t){var r;if(t){const t=e.constructor.elementProperties;e.manager.internals.members=Object.fromEntries(Array.from(t,([e,t])=>t.noAccessor?void 0:[e,[(t.readOnly?2048:0)|(t.state?32:16)]]).filter(xi))}else{const t=e.constructor,n=(null==(r=t.__registerControllers)?void 0:r.call(t,e))??void 0;if(t.__registerControllers=void 0,"object"!=typeof n)throw new Error("Failed to retrieve component meta");e.manager.internals.members=Object.fromEntries(Object.entries(n).filter(([e,[t]])=>!!(63&t)))}}(e,r),this._controllers=n,this.exports=void 0,this.hasDestroy=ps in this.component&&"function"==typeof this.component.destroy,this._bindLifecycleMethods();const s=this.internals;Object.keys(s.members).forEach(e=>{s.accessorGetter[e]=ms,s.accessorSetter[e]=ms,s.getSetProxy(e)}),r?this.internals.enabledWatchers=this.internals.allWatchers:Object.defineProperty(e,"updateComplete",{get:async()=>await this._updatePromise.promise}),queueMicrotask(s.enableReadonly),Bi(e),Xi.set(e.el,e),Xi.set(e,e)}_bindLifecycleMethods(){const e=this.component,t=this.isLit,r=e.el===e;this._originalLifecycles={_connectedCallback:t||r?void 0:e.connectedCallback,_disconnectedCallback:t||r?void 0:e.disconnectedCallback,_load:t?e.load:e.componentWillLoad,_loaded:t?e.loaded:e.componentDidLoad,_willUpdate:t?void 0:e.componentWillUpdate,_updated:t?void 0:e.componentDidUpdate,_destroy:e.destroy};const n=this._connectedCallback.bind(this),i=this._disconnectedCallback.bind(this),s=this._update.bind(this),o=this._updated.bind(this);t?e.constructor.prototype.addController.call(e,{hostConnected:n,hostDisconnected:i,hostUpdate:s,hostUpdated:o}):(e.connectedCallback=n,e.disconnectedCallback=i,e.componentWillLoad=this._load.bind(this),e.componentDidLoad=this._loaded.bind(this),e.componentWillUpdate=s,e.componentDidUpdate=o),this.hasDestroy&&(e.destroy=this.destroy.bind(this))}_connectedCallback(){var e,t;if(this.destroyed){const e=this.component.el.tagName.toLowerCase();throw this.component.el.remove(),new Error(`The ${e} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${ps} prop.`)}void 0!==this._autoDestroyTimeout&&clearTimeout(this._autoDestroyTimeout);const r=this.internals;r.enabledWatchers=r.allWatchers,ss(),null==(e=r.enableReadonly)||e.call(r),this._controllers.forEach(gs),null==(t=this._originalLifecycles._connectedCallback)||t.call(this.component)}_disconnectedCallback(){var e;this.destroyed||(this._controllers.forEach(vs),null==(e=this._originalLifecycles._disconnectedCallback)||e.call(this.component),this.hasDestroy&&this._setAutoDestroyTimeout())}async _load(){var e;await Promise.allSettled(Array.from(this._controllers,ys)),await(null==(e=this._originalLifecycles._load)?void 0:e.call(this.component)),this.hasDestroy&&os(this.component,ps,()=>this._setAutoDestroyTimeout())}_loaded(){var e;this._controllers.forEach(ws),null==(e=this._originalLifecycles._loaded)||e.call(this.component)}_update(){var e;const t=this.component;return this._controllers.forEach(bs,t.$changes),null==(e=this._originalLifecycles._willUpdate)?void 0:e.call(this.component)}_updated(){var e;const t=this.component;if(this._controllers.forEach(_s,t.$changes),null==(e=this._originalLifecycles._updated)||e.call(this.component),this.isLit)t.$changes=new Map;else{const e=this._updatePromise;this._updatePromise=new mi,e.resolve(!0)}}async destroy(){var e;if(!this.destroyed){if(this.component.el.isConnected){this.hasDestroy=!1;try{this.component.el.remove()}finally{this.hasDestroy=!0}}this._autoDestroyTimeout=void 0,this.destroyed=!0,this._controllers.forEach(Ss),this._controllers.clear(),await(null==(e=this._originalLifecycles._destroy)?void 0:e.call(this.component))}}_setAutoDestroyTimeout(){if(void 0!==this._autoDestroyTimeout&&clearTimeout(this._autoDestroyTimeout),!this.component.el.isConnected&&!this.component.autoDestroyDisabled){const e=()=>{this.destroy().catch(console.error)};this._autoDestroyTimeout=function(e,t){const r=t/ji;let n=0;const i=setInterval(()=>{n+=r,n>=t&&(clearInterval(i),e())},r);return i}(e,fs)}}};var ps="autoDestroyDisabled",fs=1e3,ms=e=>e;function gs(e){"triggerConnected"in e?e.triggerConnected():wi(e.hostConnected,e)}function vs(e){"triggerDisconnected"in e?e.triggerDisconnected():wi(e.hostDisconnected,e)}async function ys(e){"triggerLoad"in e?await e.triggerLoad():await bi(e.hostLoad,e)}function ws(e){"triggerLoaded"in e?e.triggerLoaded():wi(e.hostLoaded,e)}function bs(e){"triggerUpdate"in e?e.triggerUpdate(this):wi(e.hostUpdate,e,this)}function _s(e){"triggerUpdated"in e?e.triggerUpdated(this):wi(e.hostUpdated,e,this)}function Ss(e){"triggerDestroy"in e?e.triggerDestroy():wi(e.hostDestroy,e)}var Is,Es=e=>t=>As(t,e),As=(Is=class extends Qi{constructor(e,t){super(e);const r=this.exports;try{Bi(this.component);const e=t(this.component,this),n=this.exports!==r;if(e instanceof Promise){n||this.setProvisionalExports(e);const t=e.then(e=>{this.exports=e,super.catchUpLifecycle()}).catch(e=>{this._ready.reject(e),console.error(e)});this.onLoad(async()=>await t)}else n&&void 0===e||(this.exports=e),queueMicrotask(()=>super.catchUpLifecycle())}catch(e){this._ready.reject(e),console.error(e)}}catchUpLifecycle(){}},(...e)=>{const t=Wi(),r=new Is(...e),n=r.exports;Gi(t.at(-1));const i=r.component.manager.internals;var s;return i.markExports(r,n),r.watchExports(e=>i.markExports(r,e)),qi!==(s=r)&&(qi=s,queueMicrotask(()=>{qi===s&&(qi=void 0)})),ds([r.component,...t].reverse(),e=>void 0===e?void 0:function(e,{host:t,key:r,isReactive:n},i){const s=t,o=s[r]!==e.exports,a=s[r]!==i,l=i!==e.exports;o&&!a&&l&&(s[r]=e.exports);const c=t===e.component;if(c){if(n){const t=e.component.manager.internals;a&&t.markExports(e,s[r]),os(e.component,r,r=>{r!==e.exports&&t.markExports(e,r)})}e.assignedProperty=n?void 0:r}e.watchExports(()=>{var t;if(s[r]===e.exports)return;const n=e.component.manager;(null==(t=n.internals.setters[r])?void 0:t.includes(n.internals.readonlySetter))?function(e){Zi.readOnly=!0;try{return e()}finally{Zi.readOnly=!1}}(()=>{s[r]=e.exports}):s[r]=e.exports})}(r,e,n),n)}),Rs=(e,t)=>new ks(e,t),ks=class extends Qi{constructor(e,t){super(),this._attributes=e,this._callback=t,this._observer=new MutationObserver(r=>{r.forEach(r=>{e.includes(r.attributeName)&&t.call(this.component,this.component.el.getAttribute(r.attributeName),r.oldValue,r.attributeName)})})}hostConnected(){this._attributes.forEach(e=>{this.component.el.hasAttribute(e)&&this._callback.call(this.component,null,this.component.el.getAttribute(e),e)}),this._observer.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this._attributes})}hostDisconnected(){this._observer.disconnect()}},Ts=e=>(t={})=>As(void 0,(r,n)=>{const i=ki(r.el),s={_lang:i.lang,_t9nLocale:i.t9nLocale,_loading:!0},o=r;function a(e){const t=n.exports,r=t._original??t,i=Cs(r,e);e&&(i._original=r),n.exports=i}return n.onLifecycle(()=>Ci(r.el,()=>e("./assets"),({t9nLocale:e,t9nStrings:t,lang:i})=>{const s={...t,_lang:i,_t9nLocale:e,_loading:!1};n.exports=s;const l=t.componentLabel;"string"==typeof l&&"label"in r&&null==r.label&&(r.label??(r.label=l)),a(o.messageOverrides)},t.name)),"messageOverrides"in o&&n.onLifecycle(()=>os(o,"messageOverrides",a)),t.blocking?(n.setProvisionalExports(s,!1),n.ready):s});function Cs(e,t){if(!t)return e;const r={...e};return Object.entries(t).forEach(([t,n])=>{r[t]="object"==typeof n?Cs(e[t],n):n??e[t]}),r}const Os=globalThis,Ds=Os.ShadowRoot&&(void 0===Os.ShadyCSS||Os.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,js=Symbol(),xs=new WeakMap;let Ps=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==js)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Ds&&void 0===e){const r=void 0!==t&&1===t.length;r&&(e=xs.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&xs.set(t,e))}return e}toString(){return this.cssText}};const Ns=(e,...t)=>{const r=1===e.length?e[0]:t.reduce((t,r,n)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+e[n+1],e[0]);return new Ps(r,e,js)},Ls=Ds?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const r of e.cssRules)t+=r.cssText;return(e=>new Ps("string"==typeof e?e:e+"",void 0,js))(t)})(e):e,{is:Us,defineProperty:Fs,getOwnPropertyDescriptor:Ms,getOwnPropertyNames:$s,getOwnPropertySymbols:Bs,getPrototypeOf:Vs}=Object,qs=globalThis,zs=qs.trustedTypes,Gs=zs?zs.emptyScript:"",Ws=qs.reactiveElementPolyfillSupport,Hs=(e,t)=>e,Js={toAttribute(e,t){switch(t){case Boolean:e=e?Gs:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},Ks=(e,t)=>!Us(e,t),Ys={attribute:!0,type:String,converter:Js,reflect:!1,useDefault:!1,hasChanged:Ks};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),qs.litPropertyMetadata??(qs.litPropertyMetadata=new WeakMap);let Zs=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Ys){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const r=Symbol(),n=this.getPropertyDescriptor(e,r,t);void 0!==n&&Fs(this.prototype,e,n)}}static getPropertyDescriptor(e,t,r){const{get:n,set:i}=Ms(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){const s=null==n?void 0:n.call(this);null==i||i.call(this,t),this.requestUpdate(e,s,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Ys}static _$Ei(){if(this.hasOwnProperty(Hs("elementProperties")))return;const e=Vs(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Hs("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Hs("properties"))){const e=this.properties,t=[...$s(e),...Bs(e)];for(const r of t)this.createProperty(r,e[r])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,r]of t)this.elementProperties.set(e,r)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const e of r)t.unshift(Ls(e))}else void 0!==e&&t.push(Ls(e));return t}static _$Eu(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),null==(e=this.constructor.l)||e.forEach(e=>e(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),void 0!==this.renderRoot&&this.isConnected&&(null==(t=e.hostConnected)||t.call(e))}removeController(e){var t;null==(t=this._$EO)||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(Ds)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const r of t){const t=document.createElement("style"),n=Os.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=r.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostConnected)?void 0:t.call(e)})}enableUpdating(e){}disconnectedCallback(){var e;null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostDisconnected)?void 0:t.call(e)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){var r;const n=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,n);if(void 0!==i&&!0===n.reflect){const s=(void 0!==(null==(r=n.converter)?void 0:r.toAttribute)?n.converter:Js).toAttribute(t,n.type);this._$Em=e,null==s?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(e,t){var r,n;const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),o="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null==(r=e.converter)?void 0:r.fromAttribute)?e.converter:Js;this._$Em=s,this[s]=o.fromAttribute(t,e.type)??(null==(n=this._$Ej)?void 0:n.get(s))??null,this._$Em=null}}requestUpdate(e,t,r){var n;if(void 0!==e){const i=this.constructor,s=this[e];if(r??(r=i.getPropertyOptions(e)),!((r.hasChanged??Ks)(s,t)||r.useDefault&&r.reflect&&s===(null==(n=this._$Ej)?void 0:n.get(e))&&!this.hasAttribute(i._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:n,wrapped:i},s){r&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,s??t??this[e]),!0!==i||void 0!==s)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===n&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,r]of e){const{wrapped:e}=r,n=this[t];!0!==e||this._$AL.has(t)||void 0===n||this.C(t,void 0,r,n)}}let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostUpdate)?void 0:t.call(e)}),this.update(r)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(r)}willUpdate(e){}_$AE(e){var t;null==(t=this._$EO)||t.forEach(e=>{var t;return null==(t=e.hostUpdated)?void 0:t.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};Zs.elementStyles=[],Zs.shadowRootOptions={mode:"open"},Zs[Hs("elementProperties")]=new Map,Zs[Hs("finalized")]=new Map,null==Ws||Ws({ReactiveElement:Zs}),(qs.reactiveElementVersions??(qs.reactiveElementVersions=[])).push("2.1.0");const Xs=globalThis,Qs=Xs.trustedTypes,eo=Qs?Qs.createPolicy("lit-html",{createHTML:e=>e}):void 0,to="$lit$",ro=`lit$${Math.random().toFixed(9).slice(2)}$`,no="?"+ro,io=`<${no}>`,so=document,oo=()=>so.createComment(""),ao=e=>null===e||"object"!=typeof e&&"function"!=typeof e,lo=Array.isArray,co="[ \t\n\f\r]",uo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ho=/-->/g,po=/>/g,fo=RegExp(`>|${co}(?:([^\\s"'>=/]+)(${co}*=${co}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),mo=/'/g,go=/"/g,vo=/^(?:script|style|textarea|title)$/i,yo=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),wo=yo(1),bo=yo(2),_o=Symbol.for("lit-noChange"),So=Symbol.for("lit-nothing"),Io=new WeakMap,Eo=so.createTreeWalker(so,129);function Ao(e,t){if(!lo(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==eo?eo.createHTML(t):t}let Ro=class e{constructor({strings:t,_$litType$:r},n){let i;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[c,u]=((e,t)=>{const r=e.length-1,n=[];let i,s=2===t?"<svg>":3===t?"<math>":"",o=uo;for(let t=0;t<r;t++){const r=e[t];let a,l,c=-1,u=0;for(;u<r.length&&(o.lastIndex=u,l=o.exec(r),null!==l);)u=o.lastIndex,o===uo?"!--"===l[1]?o=ho:void 0!==l[1]?o=po:void 0!==l[2]?(vo.test(l[2])&&(i=RegExp("</"+l[2],"g")),o=fo):void 0!==l[3]&&(o=fo):o===fo?">"===l[0]?(o=i??uo,c=-1):void 0===l[1]?c=-2:(c=o.lastIndex-l[2].length,a=l[1],o=void 0===l[3]?fo:'"'===l[3]?go:mo):o===go||o===mo?o=fo:o===ho||o===po?o=uo:(o=fo,i=void 0);const d=o===fo&&e[t+1].startsWith("/>")?" ":"";s+=o===uo?r+io:c>=0?(n.push(a),r.slice(0,c)+to+r.slice(c)+ro+d):r+ro+(-2===c?t:d)}return[Ao(e,s+(e[r]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),n]})(t,r);if(this.el=e.createElement(c,n),Eo.currentNode=this.el.content,2===r||3===r){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(i=Eo.nextNode())&&l.length<a;){if(1===i.nodeType){if(i.hasAttributes())for(const e of i.getAttributeNames())if(e.endsWith(to)){const t=u[o++],r=i.getAttribute(e).split(ro),n=/([.?@])?(.*)/.exec(t);l.push({type:1,index:s,name:n[2],strings:r,ctor:"."===n[1]?Do:"?"===n[1]?jo:"@"===n[1]?xo:Oo}),i.removeAttribute(e)}else e.startsWith(ro)&&(l.push({type:6,index:s}),i.removeAttribute(e));if(vo.test(i.tagName)){const e=i.textContent.split(ro),t=e.length-1;if(t>0){i.textContent=Qs?Qs.emptyScript:"";for(let r=0;r<t;r++)i.append(e[r],oo()),Eo.nextNode(),l.push({type:2,index:++s});i.append(e[t],oo())}}}else if(8===i.nodeType)if(i.data===no)l.push({type:2,index:s});else{let e=-1;for(;-1!==(e=i.data.indexOf(ro,e+1));)l.push({type:7,index:s}),e+=ro.length-1}s++}}static createElement(e,t){const r=so.createElement("template");return r.innerHTML=e,r}};function ko(e,t,r=e,n){var i,s;if(t===_o)return t;let o=void 0!==n?null==(i=r._$Co)?void 0:i[n]:r._$Cl;const a=ao(t)?void 0:t._$litDirective$;return(null==o?void 0:o.constructor)!==a&&(null==(s=null==o?void 0:o._$AO)||s.call(o,!1),void 0===a?o=void 0:(o=new a(e),o._$AT(e,r,n)),void 0!==n?(r._$Co??(r._$Co=[]))[n]=o:r._$Cl=o),void 0!==o&&(t=ko(e,o._$AS(e,t.values),o,n)),t}let To=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:r}=this._$AD,n=((null==e?void 0:e.creationScope)??so).importNode(t,!0);Eo.currentNode=n;let i=Eo.nextNode(),s=0,o=0,a=r[0];for(;void 0!==a;){if(s===a.index){let t;2===a.type?t=new Co(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new Po(i,this,e)),this._$AV.push(t),a=r[++o]}s!==(null==a?void 0:a.index)&&(i=Eo.nextNode(),s++)}return Eo.currentNode=so,n}p(e){let t=0;for(const r of this._$AV)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},Co=class e{get _$AU(){var e;return(null==(e=this._$AM)?void 0:e._$AU)??this._$Cv}constructor(e,t,r,n){this.type=2,this._$AH=So,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=n,this._$Cv=(null==n?void 0:n.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=ko(this,e,t),ao(e)?e===So||null==e||""===e?(this._$AH!==So&&this._$AR(),this._$AH=So):e!==this._$AH&&e!==_o&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>lo(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==So&&ao(this._$AH)?this._$AA.nextSibling.data=e:this.T(so.createTextNode(e)),this._$AH=e}$(e){var t;const{values:r,_$litType$:n}=e,i="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Ro.createElement(Ao(n.h,n.h[0]),this.options)),n);if((null==(t=this._$AH)?void 0:t._$AD)===i)this._$AH.p(r);else{const e=new To(i,this),t=e.u(this.options);e.p(r),this.T(t),this._$AH=e}}_$AC(e){let t=Io.get(e.strings);return void 0===t&&Io.set(e.strings,t=new Ro(e)),t}k(t){lo(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,i=0;for(const s of t)i===r.length?r.push(n=new e(this.O(oo()),this.O(oo()),this,this.options)):n=r[i],n._$AI(s),i++;i<r.length&&(this._$AR(n&&n._$AB.nextSibling,i),r.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for(null==(r=this._$AP)||r.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,null==(t=this._$AP)||t.call(this,e))}},Oo=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,n,i){this.type=1,this._$AH=So,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=So}_$AI(e,t=this,r,n){const i=this.strings;let s=!1;if(void 0===i)e=ko(this,e,t,0),s=!ao(e)||e!==this._$AH&&e!==_o,s&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=ko(this,n[r+o],t,o),a===_o&&(a=this._$AH[o]),s||(s=!ao(a)||a!==this._$AH[o]),a===So?e=So:e!==So&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}s&&!n&&this.j(e)}j(e){e===So?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},Do=class extends Oo{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===So?void 0:e}},jo=class extends Oo{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==So)}},xo=class extends Oo{constructor(e,t,r,n,i){super(e,t,r,n,i),this.type=5}_$AI(e,t=this){if((e=ko(this,e,t,0)??So)===_o)return;const r=this._$AH,n=e===So&&r!==So||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,i=e!==So&&(r===So||n);n&&this.element.removeEventListener(this.name,this,r),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;"function"==typeof this._$AH?this._$AH.call((null==(t=this.options)?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},Po=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){ko(this,e)}};const No=Xs.litHtmlPolyfillSupport;null==No||No(Ro,Co),(Xs.litHtmlVersions??(Xs.litHtmlVersions=[])).push("3.3.0");const Lo=globalThis;let Uo=class extends Zs{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;const t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,r)=>{const n=(null==r?void 0:r.renderBefore)??t;let i=n._$litPart$;if(void 0===i){const e=(null==r?void 0:r.renderBefore)??null;n._$litPart$=i=new Co(t.insertBefore(oo(),e),e,void 0,r??{})}return i._$AI(e),i})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null==(e=this._$Do)||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null==(e=this._$Do)||e.setConnected(!1)}render(){return _o}};Uo._$litElement$=!0,Uo.finalized=!0,null==(n=Lo.litElementHydrateSupport)||n.call(Lo,{LitElement:Uo});const Fo=Lo.litElementPolyfillSupport;null==Fo||Fo({LitElement:Uo}),(Lo.litElementVersions??(Lo.litElementVersions=[])).push("4.2.0");const Mo={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},$o=e=>(...t)=>({_$litDirective$:e,values:t});let Bo=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};const Vo=$o(class extends Bo{constructor(e){var t;if(super(e),e.type!==Mo.ATTRIBUTE||"class"!==e.name||(null==(t=e.strings)?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(e){return" "+Object.keys(e).filter(t=>e[t]).join(" ")+" "}update(e,[t]){var r,n;if(void 0===this.st){this.st=new Set,void 0!==e.strings&&(this.nt=new Set(e.strings.join(" ").split(/\s/).filter(e=>""!==e)));for(const e in t)t[e]&&!(null==(r=this.nt)?void 0:r.has(e))&&this.st.add(e);return this.render(t)}const i=e.element.classList;for(const e of this.st)e in t||(i.remove(e),this.st.delete(e));for(const e in t){const r=!!t[e];r===this.st.has(e)||(null==(n=this.nt)?void 0:n.has(e))||(r?(i.add(e),this.st.add(e)):(i.remove(e),this.st.delete(e)))}return _o}}),qo="important",zo=" !"+qo,Go=$o(class extends Bo{constructor(e){var t;if(super(e),e.type!==Mo.ATTRIBUTE||"style"!==e.name||(null==(t=e.strings)?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(e){return Object.keys(e).reduce((t,r)=>{const n=e[r];return null==n?t:t+`${r=r.includes("-")?r:r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(e,[t]){const{style:r}=e.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(t)),this.render(t);for(const e of this.ft)null==t[e]&&(this.ft.delete(e),e.includes("-")?r.removeProperty(e):r[e]=null);for(const e in t){const n=t[e];if(null!=n){this.ft.add(e);const t="string"==typeof n&&n.endsWith(zo);e.includes("-")||t?r.setProperty(e,t?n.slice(0,-11):n,t?qo:""):r[e]=n}}return _o}});var Wo=(e="",t={},r=Vi())=>{const n={emit:n=>{""===e&&ss();const i=new CustomEvent(e,{detail:n,cancelable:!0,bubbles:!0,composed:!0,...t});return r.el.dispatchEvent(i),i}};return""===e&&ds(void 0,t=>{e=t.key},n),n},Ho=Wo.bind(null,""),Jo=()=>{},Ko=(i=class extends Uo{constructor(){var e,t,r,n;super(),this.el=this.constructor.lazy??this,this.manager=new hs(this,n),this._postLoad=(null==(e=this.constructor.lazy)?void 0:e._postLoad)??new mi,this._offspring=(null==(t=this.constructor.lazy)?void 0:t._offspring)??[],this._postLoaded=(null==(r=this.constructor.lazy)?void 0:r._postLoaded)??new mi,this._enableUpdating=this.enableUpdating,this.enableUpdating=Jo;const s=i.prototype.shouldUpdate;this.shouldUpdate!==s&&(this._originalShouldUpdate=this.shouldUpdate,this.shouldUpdate=s)}static finalizeStyles(e){var t;const r=super.finalizeStyles(e),n=this.shadowRootOptions===Fi;return void 0===(null==(t=this.runtime)?void 0:t.commonStyles)||n?r:[this.runtime.commonStyles,...r]}static createProperty(e,t){const r="number"==typeof t?t:Array.isArray(t)?t[0]:0,n=Array.isArray(t)?t[1]:void 0;super.createProperty(e,{attribute:!!(1&r&&"string"==typeof e)&&Oi(e),reflect:!!(2&r),type:4&r?Boolean:8&r?Number:void 0,state:!!(16&r),readOnly:!!(32&r),noAccessor:!!(64&r),...n})}connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const e=!this.manager.connectedCalled;super.connectedCallback(),e&&queueMicrotask(()=>this._load().catch(e=>{this._postLoaded.reject(e),setTimeout(()=>{throw e})}))}createRenderRoot(){const e=this.el.shadowRoot,t=this.constructor,r=t.shadowRootOptions,n=e??(r===Fi?this.el:this.el.attachShadow(r));if(Object.defineProperty(this,"shadowRoot",{value:n}),e)return Uo.prototype.createRenderRoot.call(this),e;if(this.isConnected){const e=n.getRootNode();0,e.adoptedStyleSheets=[...e.adoptedStyleSheets,...t.elementStyles.map(e=>"styleSheet"in e?e.styleSheet:e)]}return n}async _load(){const e=this.el._ancestorLoad??Pi(this.el);e&&await e,await this.manager._load(),this._enableUpdating(!0),this.performUpdate(),this._postLoad.resolve(),await Promise.resolve();const t=this._offspring.filter(e=>{var t;return!(null==(t=e.manager)?void 0:t.loadedCalled)});t.length&&await Promise.allSettled(t.map(async e=>await e.componentOnReady())),this._offspring.length=0,this.el.setAttribute(this.constructor.runtime.hydratedAttribute,""),this.manager._loaded(),this._postLoaded.resolve()}shouldUpdate(e){var t;return this.$changes=e,(null==(t=this._originalShouldUpdate)?void 0:t.call(this,e))??!0}listen(e,t,r){const n=(null==t?void 0:t.bind(this))??t;this.manager.onLifecycle(()=>(this.el.addEventListener(e,n,r),()=>this.el.removeEventListener(e,n,r)))}listenOn(e,t,r,n){const i=(null==r?void 0:r.bind(this))??r;this.manager.onLifecycle(()=>(e.addEventListener(t,i,n),()=>e.removeEventListener(t,i,n)))}async componentOnReady(){return await this._postLoaded.promise,this}},i.lumina=!0,i);function Yo(e){let t;const r=e=>{var r;t=new URL(e,(null==(r=globalThis.location)?void 0:r.href)||void 0).href},n={...e,getAssetPath(e){var r;const n=new URL(e,t);return n.origin!==(null==(r=globalThis.location)?void 0:r.origin)?n.href:n.pathname},setAssetPath:r,customElement(e,t){t.runtime=n,t.tagName=e,customElements.get(e)||customElements.define(e,t)}};return r(e.defaultAssetPath),n}Ko.$createEvent=Wo;var Zo=e=>"object"==typeof e&&null!=e?Vo(e):e,Xo=e=>"object"==typeof e&&null!=e?Go(e):e,Qo=So;function ea(e,t,r){null==r?e.removeAttribute(t):e.setAttribute(t,r)}var ta={toAttribute:e=>!0===e?"":!1===e?null:e},ra={},na=(e,t)=>({tagName:e,events:t});const ia=((e,t)=>r=>{const n=r.tagName;let i=ra;const s={name:n,get prototype(){var e;if(void 0===i){if(i=null==(e=customElements.get(n))?void 0:e.prototype,!i)throw new Error(`Custom element "${n}" not found`);Object.defineProperty(s,"prototype",{value:i})}return i}},o=t({...r,react:e,elementClass:s});return i=void 0,o})(f.default,fi);na("calcite-action",{}),na("calcite-list",{onCalciteListChange:"calciteListChange",onCalciteListDragEnd:"calciteListDragEnd",onCalciteListDragStart:"calciteListDragStart",onCalciteListFilter:"calciteListFilter",onCalciteListOrderChange:"calciteListOrderChange"}),na("calcite-list-item",{onCalciteListItemClose:"calciteListItemClose",onCalciteListItemSelect:"calciteListItemSelect",onCalciteListItemSortHandleBeforeClose:"calciteListItemSortHandleBeforeClose",onCalciteListItemSortHandleBeforeOpen:"calciteListItemSortHandleBeforeOpen",onCalciteListItemSortHandleClose:"calciteListItemSortHandleClose",onCalciteListItemSortHandleOpen:"calciteListItemSortHandleOpen",onCalciteListItemToggle:"calciteListItemToggle"}),na("calcite-loader",{}),na("calcite-notice",{onCalciteNoticeBeforeClose:"calciteNoticeBeforeClose",onCalciteNoticeBeforeOpen:"calciteNoticeBeforeOpen",onCalciteNoticeClose:"calciteNoticeClose",onCalciteNoticeOpen:"calciteNoticeOpen"}),na("calcite-panel",{onCalcitePanelClose:"calcitePanelClose",onCalcitePanelScroll:"calcitePanelScroll",onCalcitePanelToggle:"calcitePanelToggle"});let sa;function oa(e){return"function"==typeof sa[e]?sa[e]=sa[e](globalThis):sa[e]}function aa(e,t,r){if(null==e&&null==t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function la(e,t){return null!=e}function ca(e,t){let r;for(r in e)e.hasOwnProperty(r)&&void 0===e[r]&&delete e[r];return e}function ua(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;const t=function(e){if(function(e){var t;return"Int8Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Uint8Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Uint8ClampedArray"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Int16Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Uint16Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Int32Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Uint32Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Float32Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e)||function(e){var t;return"Float64Array"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)}(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[r,n]of e)t.set(r,ua(n));return t}if(e instanceof Set){const t=new Set;for(const r of e)t.add(ua(r));return t}return null}(e);if(null!=t)return t;if(function(e){return"function"==typeof e.clone}(e))return e.clone();if(function(e){return"function"==typeof e.map&&"function"==typeof e.forEach}(e))return e.map(ua);if(function(e){return"function"==typeof e.notifyChange&&"function"==typeof e.watch}(e))throw new Error("Trying to clone an unclonable Accessor instance");const r={};for(const t of Object.getOwnPropertyNames(e))r[t]=ua(e[t]);return r}function da(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function ha(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof(null==e?void 0:e.getTime)&&"function"==typeof(null==t?void 0:t.getTime)&&e.getTime()===t.getTime()||!1}function pa(e,t){return e===t||(null==e||"string"==typeof e?e===t:"number"==typeof e?e===t||"number"==typeof t&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&aa(e,t):e instanceof Set?t instanceof Set&&function(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}(e,t):e instanceof Map?t instanceof Map&&function(e,t){if(e.size!==t.size)return!1;for(const[r,n]of e){const e=t.get(r);if(e!==n||void 0===e&&!t.has(r))return!1}return!0}(e,t):!!da(e)&&da(t)&&function(e,t){if(null===e||null===t)return!1;const r=Object.keys(e);if(null===t||Object.keys(t).length!==r.length)return!1;for(const n of r)if(e[n]!==t[n]||!Object.prototype.hasOwnProperty.call(t,n))return!1;return!0}(e,t))}function fa(e,t){if(null!=t)return t[e]||ga(e.split("."),!1,t)}function ma(e,t,r){const n=e.split("."),i=n.pop(),s=ga(n,!0,r);s&&i&&(s[i]=t)}function ga(e,t,r){let n=r;for(const r of e){if(null==n)return;if(!(r in n)){if(!t)return;n[r]={}}n=n[r]}return n}function va(e,t,r){return t?Object.keys(t).reduce((e,n)=>{let i=e[n],s=t[n];return i===s?e:void 0===i?(e[n]=ua(s),e):(Array.isArray(s)||Array.isArray(e)?(i=i?Array.isArray(i)?e[n]=i.slice():e[n]=[i]:e[n]=[],s&&(Array.isArray(s)||(s=[s]),r?s.forEach(e=>{i.includes(e)||i.push(e)}):e[n]=s.slice())):s&&"object"==typeof s?e[n]=va(i,s,r):e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[n]=s),e)},e||{}):e}sa=(null==(s=globalThis.dojoConfig)?void 0:s.has)||(null==(o=globalThis.esriConfig)?void 0:o.has)?{...null==(a=globalThis.dojoConfig)?void 0:a.has,...null==(l=globalThis.esriConfig)?void 0:l.has}:{},oa.add=(e,t,r,n)=>{(n||void 0===sa[e])&&(sa[e]=t),r&&oa(e)},oa.cache=sa,oa.add("big-integer-warning-enabled",!0),oa.add("esri-deprecation-warnings",!0),oa.add("esri-tests-disable-screenshots",!1),oa.add("esri-tests-use-full-window",!1),oa.add("esri-tests-post-to-influx",!0),oa.add("esri-cim-animations-enable-status","enabled"),oa.add("esri-cim-animations-spotlight",!1),oa.add("esri-cim-animations-freeze-time",!1),oa.add("enable-feature:multiple-highlights",!0),(()=>{var e;oa.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const t="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(oa.add("host-browser",t),oa.add("host-node","object"==typeof globalThis.process&&(null==(e=globalThis.process.versions)?void 0:e.node)&&globalThis.process.versions.v8),oa.add("dom",t),oa("host-browser")){const e=navigator,t=e.userAgent,r=e.appVersion,n=parseFloat(r);if(oa.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),oa.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),oa.add("khtml",r.includes("Konqueror")?n:void 0),oa.add("edge",parseFloat(t.split("Edge/")[1])||void 0),oa.add("opr",parseFloat(t.split("OPR/")[1])||void 0),oa.add("webkit",!oa("wp")&&!oa("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),oa.add("chrome",!oa("edge")&&!oa("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),oa.add("android",!oa("wp")&&parseFloat(t.split("Android ")[1])||void 0),oa.add("safari",!r.includes("Safari")||oa("wp")||oa("chrome")||oa("android")||oa("edge")||oa("opr")?void 0:parseFloat(r.split("Version/")[1])),oa.add("mac",r.includes("Macintosh")),!oa("wp")&&/(iPhone|iPod|iPad)/.test(t)){const e=RegExp.$1.replace(/P/,"p"),r=/OS ([\d_]+)/.test(t)?RegExp.$1:"1",n=parseFloat(r.replace(/_/,".").replaceAll("_",""));oa.add(e,n),oa.add("ios",n)}oa("webkit")||(!t.includes("Gecko")||oa("wp")||oa("khtml")||oa("edge")||oa.add("mozilla",n),oa("mozilla")&&oa.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&oa.add("esri-mobile",t),r&&oa.add("esri-iPhone",r),oa.add("esri-geolocation",!!navigator.geolocation)}oa.add("esri-wasm","WebAssembly"in globalThis),oa.add("esri-performance-mode-frames-between-render",20),oa.add("esri-force-performance-mode",!1),oa.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=!1===globalThis.crossOriginIsolated;return e&&!t}),oa.add("wasm-simd",()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))),oa.add("esri-atomics","Atomics"in globalThis),oa.add("esri-workers","Worker"in globalThis),oa.add("web-feat:cache","caches"in globalThis),oa.add("esri-workers-arraybuffer-transfer",!oa("safari")||Number(oa("safari"))>=12),oa.add("workers-pool-size",8),oa.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),oa.add("featurelayer-simplify-payload-size-factors",[1,1,4]),oa.add("featurelayer-fast-triangulation-enabled",!0),oa.add("featurelayer-animation-enabled",!0),oa.add("featurelayer-snapshot-enabled",!0),oa.add("featurelayer-snapshot-point-min-threshold",8e4),oa.add("featurelayer-snapshot-point-max-threshold",4e5),oa.add("featurelayer-snapshot-point-coverage",.1),oa.add("featurelayer-query-max-depth",4),oa.add("featurelayer-query-pausing-enabled",!1),oa.add("featurelayer-advanced-symbols",!1),oa.add("featurelayer-pbf",!0),oa.add("featurelayer-pbf-statistics",!1),oa.add("feature-layers-workers",!0),oa.add("feature-polyline-generalization-factor",1),oa.add("mapview-transitions-duration",200),oa.add("mapview-essential-goto-duration",200),oa.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),oa.add("mapserver-pbf-version-support",10.81),oa.add("mapservice-popup-identify-max-tolerance",20),oa.add("request-queue-concurrency-hosted",16),oa.add("request-queue-concurrency-non-hosted",4),oa.add("curve-densification-coarse-segments",128),oa.add("curve-densification-max-segments",2e3),oa.add("curve-densification-min-segments",3),oa.add("curve-densification-pixels-per-segment",16),oa.add("view-readyState-waiting-delay",1e3),oa.add("gradient-depth-bias",.01),oa.add("gradient-depth-epsilon",1e-8),oa("host-webworker")||oa("host-browser")&&(oa.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),oa.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{oa.add("esri-image-decode",!0,!0,!0)}).catch(()=>{oa.add("esri-image-decode",!1,!0,!0)})}return!1}),oa.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();let ya=class{constructor(e,t={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=t,this.apiValues=[],this.jsonValues=[],this._apiToJSON=function(e){const t={};for(const r in e)t[e[r]]=r;return t}(e),this.apiValues=wa(this._apiToJSON),this.jsonValues=wa(this._jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,r)=>{const n=this.toJSON(e);void 0!==n&&ma(r,n,t)},this.write.isJSONMapWriter=!0}toJSON(e){if(null==e)return null;if(this._apiToJSON.hasOwnProperty(e)){const t=this._apiToJSON[e];return this._options.useNumericKeys?+t:t}return this._options.ignoreUnknown?null:e}fromJSON(e){return null!=e&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function wa(e){const t=[];for(const r in e)t.push(r);return t.sort(),t}const ba={remove:()=>{}};function _a(e){return e?{remove(){e&&(e(),e=void 0)}}:ba}function Sa(e){return _a(()=>function(e){e.forEach(e=>null==e?void 0:e.remove())}(e))}let Ia,Ea;const Aa=(null==(c=globalThis.esriConfig)?void 0:c.locale)??(null==(u=globalThis.dojoConfig)?void 0:u.locale),Ra=null==(d=globalThis.document)?void 0:d.documentElement;function ka(){var e;const t=null==Ra?void 0:Ra.getAttribute("lang"),r=null==(e=globalThis.navigator)?void 0:e.language;return Aa??t??r??"en"}function Ta(){return void 0===Ea&&(Ea=ka()),Ea}const Ca=[];function Oa(e){return Ca.push(e),_a(()=>Ca.splice(Ca.indexOf(e),1))}const Da=[];function ja(e){return Da.push(e),_a(()=>Da.splice(Da.indexOf(e),1))}function xa(){const e=Ia??ka();Ea!==e&&([...Da].forEach(t=>t(e)),Ea=e,[...Ca].forEach(t=>t(e)))}null==(h=globalThis.addEventListener)||h.call(globalThis,"languagechange",xa),Ra&&new MutationObserver(()=>{xa()}).observe(Ra,{attributeFilter:["lang"]});const Pa="system",Na="unknown",La="UTC",Ua=Intl.DateTimeFormat().resolvedOptions().timeZone,Fa={"short-date-short-time":{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}};!function(e,t){new ya(e,{ignoreUnknown:!0,...t})}({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});const Ma={ar:"ar-u-nu-latn-ca-gregory"};let $a=new WeakMap;const Ba=Fa["short-date-short-time"];function Va(e){let t=$a.get(e);if(!t){const r=Ta(),n=Ma[r]||r,i=function(e){switch(e){case Pa:return Ua;case Na:return La;default:return e}}(e.timeZone??Pa),s={...e,timeZone:i};t=new Intl.DateTimeFormat(n,s),$a.set(e,t)}return t}function qa(e,t=Ba){return Va(t).format(e)}ja(()=>{$a=new WeakMap});const za={ar:"ar-u-nu-latn"};let Ga=new WeakMap,Wa={};function Ha(e,t){return Object.is(e,-0)&&(e=0),function(e){const t=e||Wa;if(!Ga.has(t)){const r=Ta(),n=za[Ta()]||r;Ga.set(t,new Intl.NumberFormat(n,e))}return Ga.get(t)}(t).format(e)}ja(()=>{Ga=new WeakMap,Wa={}});const Ja={apiKey:void 0,applicationName:"",applicationUrl:null==(p=globalThis.location)?void 0:p.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:62e3,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(function(e,t,r=!1){va(e,t,r)}(Ja,globalThis.esriConfig,!0),delete Ja.has),!Ja.assetsPath){{const e="4.32";Ja.assetsPath=`https://js.arcgis.com/${e}/@arcgis/core/assets`}Ja.defaultAssetsPath=Ja.assetsPath}const Ka=/\{([^}]+)\}/g;function Ya(e){return e??""}function Za(e,t){return t?e.replaceAll(Ka,"object"==typeof t?(e,r)=>Ya(fa(r,t)):(e,r)=>Ya(t(r))):e}const Xa={info:0,warn:1,error:2,none:3};let Qa=class e{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=t.level&&(this.level=t.level),null!=t.writer&&(this.writer=t.writer),this._module=t.module,e._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");-1!==r&&(this._parent=e.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(t){return t="string"!=typeof t?t.declaredClass:t,e._loggers.get(t)||new e({module:t})}_log(t,r,...n){if(this._matchLevel(t)){if("always"!==r&&!e._throttlingDisabled){const i=function(...e){const t=(e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]";return function(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(JSON.stringify(e,t))}(n),s=this._loggedMessages[t].get(i);if("once"===r&&null!=s||"oncePerTick"===r&&s&&s>=e._tickCounter)return;this._loggedMessages[t].set(i,e._tickCounter),e._scheduleTickCounterIncrement()}for(const e of Ja.log.interceptors)if(e(t,this.module,...n))return;this._inheritedWriter()(t,this.module,...n)}}_parentWithMember(e,t){let r=this;for(;null!=r;){const t=r[e];if(null!=t)return t;r=r.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",el)}_matchLevel(e){const t=Ja.log.level||"warn";return Xa[this._parentWithMember("level",t)]<=Xa[e]}static _scheduleTickCounterIncrement(){e._tickCounterScheduled||(e._tickCounterScheduled=!0,Promise.resolve().then(()=>{e._tickCounter++,e._tickCounterScheduled=!1}))}};function el(e,t,...r){console[e](`[${t}]`,...r)}Qa._loggers=new Map,Qa._tickCounter=0,Qa._tickCounterScheduled=!1,Qa._throttlingDisabled=!1;let tl=class{constructor(e,t,r=void 0){this.name=e,this.details=r,this.message=(t&&function(e,t){return e.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(e,r)=>""===r?"$":(fa(r,t)??"").toString())}(t,r))??""}toString(){return"["+this.name+"]: "+this.message}},rl=class e extends tl{constructor(e,t,r){super(e,t,r)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return ua(t)}catch(e){return"[object]"}}))}}catch(e){throw Qa.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new e(t.name,t.message,t.details)}};rl.prototype.type="error";const nl=function(e){return{setTimeout:(t,r)=>{const n=e.setTimeout(t,r);return _a(()=>e.clearTimeout(n))}}}(globalThis);function il(e){return function(e){return null!=e&&"object"==typeof e&&"on"in e&&"function"==typeof e.on}(e)||sl(e)}function sl(e){return null!=e&&"object"==typeof e&&"addEventListener"in e&&"function"==typeof e.addEventListener}function ol(e,t,r){if(!il(e))throw new TypeError("target is not a Evented or EventTarget object");return sl(e)?function(e,t,r,n){if(Array.isArray(t)){const i=t.slice();for(const t of i)e.addEventListener(t,r,n);return _a(()=>{for(const t of i)e.removeEventListener(t,r,n)})}return e.addEventListener(t,r,n),_a(()=>e.removeEventListener(t,r,n))}(e,t,r):e.on(t,r)}function al(e,t,r){if(!il(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const n=ol(e,t,t=>{n.remove(),r.call(e,t)});return n}function ll(e){return null==e||e.destroy(),null}function cl(e){return null==e||e.remove(),null}function ul(e){return null==e||e.abort(),null}function dl(e="Aborted"){return new rl("AbortError",e)}function hl(e){return e instanceof AbortSignal?e:(null==e?void 0:e.signal)??void 0}function pl(e){const t=hl(e);return null!=t&&t.aborted}function fl(e){if(!vl(e))throw e}function ml(e,t){const r=hl(e);if(null!=r){if(!r.aborted)return al(r,"abort",()=>t());t()}}function gl(e,t){const r=hl(e);if(null!=r)return function(e,t="Aborted"){if(pl(e))throw dl(t)}(r),al(r,"abort",()=>t(dl()))}function vl(e){return"AbortError"===(null==e?void 0:e.name)}function yl(e){return e&&"function"==typeof e.then}function wl(e){return yl(e)?e:Promise.resolve(e)}function bl(e,t=-1){let r,n,i,s,o=null;const a=(...l)=>{if(r){n=l,s&&s.reject(dl()),s=_l();const e=s.promise;if(o){const e=o;o=null,e.abort()}return e}if(i=s||_l(),s=null,t>0){const n=new AbortController;r=wl(e(...l,n.signal));const i=r;(function(e,t,r){const n=new AbortController;return ml(r,()=>n.abort()),new Promise((r,i)=>{let s=setTimeout(()=>{s=0,r(t)},e);ml(n,()=>{s&&(clearTimeout(s),i(dl()))})})})(t).then(()=>{r===i&&(s?n.abort():o=n)})}else r=1,r=wl(e(...l));const c=()=>{const e=n;n=i=r=o=null,null!=e&&a(...e)},u=r,d=i;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function _l(){let e,t;const r=new Promise((r,n)=>{e=r,t=n}),n=t=>{e(t)};return n.resolve=t=>e(t),n.reject=e=>t(e),n.timeout=(e,t)=>nl.setTimeout(()=>n.reject(t),e),n.promise=r,n}const Sl=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Il={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function El(e){if(function(e){return e in Il}(e)){const t=Il[e];return!0===t?e:t}return null}const Al=[],Rl=new Map;function kl(e){for(const t of Rl.keys())Ol(e.pattern,t)&&Rl.delete(t)}function Tl(e){return Al.includes(e)||(kl(e),Al.unshift(e)),_a(()=>{const t=Al.indexOf(e);t>-1&&(Al.splice(t,1),kl(e))})}async function Cl(e){const t=Ta();Rl.has(e)||Rl.set(e,async function(e,t){const r=[];for(const n of Al)if(Ol(n.pattern,e))try{return await n.fetchMessageBundle(e,t)}catch(e){r.push(e)}if(r.length)throw new rl("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r});throw new rl("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const r=Rl.get(e);return r&&await Dl.add(r),r}function Ol(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}ja(()=>{Rl.clear()});const Dl=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=_l())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}};function jl(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}"function"==typeof SuppressedError&&SuppressedError;const xl=new WeakMap;function Pl(e,t,r={}){if(oa("esri-deprecation-warnings")){const{moduleName:n}=r;!function(e,t,r={}){if(oa("esri-deprecation-warnings")){const{replacement:n,version:i,see:s,warnOnce:o}=r;let a=t;if(n&&(a+=`\n\t\u{1f6e0}\ufe0f Replacement: ${n}`),i&&(a+=`\n\t\u2699\ufe0f Version: ${i}`),s)if(Array.isArray(s)){a+="\n\t\u{1f517} See for more details:";for(const e of s)a+=`\n\t\t${e}`}else a+=`\n\t\u{1f517} See ${s} for more details.`;!function(e,t,r=!1){const n=`\u{1f6d1} DEPRECATED - ${t}`;if(!r)return void e.warn(n);let i=xl.get(e);i||(i=new Set,xl.set(e,i)),i.has(t)||(i.add(t),e.warn(n))}(e,a,o)}}(e,"Function: "+((n?n+"::":"")+t+"()"),r)}}function Nl(e){return null!=e&&"function"==typeof e[Symbol.iterator]}let Ll=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(Nl(e)){const r=this._getOrCreateGroup(t);for(const t of e)Ml(t)&&r.push(t)}else Ml(e)&&this._getOrCreateGroup(t).push(e);return this}forEach(e,t){if("function"==typeof e)this._groups.forEach(t=>t.forEach(e));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(Ul(e))}remove(e){if("string"!=typeof e&&Nl(e)){for(const t of e)this.remove(t);return this}return this.has(e)?(Fl(this._getGroup(e)),this._groups.delete(Ul(e)),this):this}removeAll(){return this._groups.forEach(Fl),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(Ul(e),t),t}_getGroup(e){return this._groups.get(Ul(e))}};function Ul(e){return e||"_default_"}function Fl(e){for(const t of e)t instanceof Ll?t.removeAll():t.remove()}function Ml(e){return null!=e&&(!!e.remove||e instanceof Ll)}const $l=Symbol("Accessor-beforeDestroy");function Bl(e){return e.__accessor__??null}function Vl(e,t,r){return ql(e,t,r?{policy:r,path:""}:null)}function ql(e,t,r){return t?Object.keys(t).reduce((e,n)=>{const i=n;let s=null,o="merge";if(r&&(s=r.path?`${r.path}.${n}`:n,o=r.policy(s)),"replace"===o)return e[i]=t[i],e;if("replace-arrays"===o&&Array.isArray(e[i]))return e[i]=t[i],e;if(void 0===e[i])return e[i]=ua(t[i]),e;let a=e[i],l=t[i];if(a===l)return e;if(Array.isArray(l)||Array.isArray(e))a=a?Array.isArray(a)?e[i]=a.slice():e[i]=[a]:e[i]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(e=>{a.includes(e)||a.push(e)}));else if(l&&"object"==typeof l)if(r){const t=r.path;r.path=s,e[i]=ql(a,l,r),r.path=t}else e[i]=ql(a,l,null);else e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[i]=l);return e},e||{}):e}function zl(e){return Array.isArray(e)?e:e.split(".")}function Gl(e){return e.includes(",")?e.split(",").map(e=>e.trim()):[e.trim()]}function Wl(e,t,r,n){const i=function(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...Gl(r));return t}return Gl(e)}(t);if(1!==i.length){const t=i.map(t=>n(e,t,r));return Sa(t)}return n(e,i[0],r)}function Hl(e,t){const r="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(r,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.at(e)}const n=Bl(t);return function(e,t){var r;return null!=(null==(r=null==e?void 0:e.metadata)?void 0:r[t])}(n,r)?n.get(r):t[r]}function Jl(e,t,r){if(null==e)return e;const n=Hl(t[r],e);return!n&&r<t.length-1?void 0:r===t.length-1?n:Jl(n,t,r+1)}function Kl(e,t,r=0){return"string"!=typeof t||t.includes(".")?Jl(e,zl(t),r):Hl(t,e)}function Yl(e,t){return Kl(e,t)}function Zl(e,t){return void 0!==Kl(t,e)}var Xl,Ql;function ec(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){t=Object.create(t);for(const e in t)t[e]=ua(t[e]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function tc(e,t){const r=ec(e);let n=r[t];return n||(n=r[t]={}),n}(Ql=Xl||(Xl={}))[Ql.INITIALIZING=0]="INITIALIZING",Ql[Ql.CONSTRUCTING=1]="CONSTRUCTING",Ql[Ql.CONSTRUCTED=2]="CONSTRUCTED",Ql[Ql.DESTROYED=3]="DESTROYED";const rc=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function nc(e){return rc.test(e)?"replace":"merge"}let ic=class e{constructor(e,t,r,n=1,i=0){this._ctor=e,this._acquireFunction=t,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(i),this._initialSize=i;for(let e=0;e<i;e++)this._pool[e]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...t){let r;if(e.test.disabled)r=new this._ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...t):function(e){return(null==e?void 0:e.acquire)&&"function"==typeof e.acquire}(r)&&r.acquire(...t),r}release(t){t&&!e.test.disabled&&(this._releaseFunction?this._releaseFunction(t):function(e){return(null==e?void 0:e.release)&&"function"==typeof e.release}(t)&&t.release(),this._pool.push(t))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}};ic.test={disabled:!1};let sc=class{constructor(e,t){this._observers=e,this._observer=t}remove(){!function(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}(this._observers,this._observer)}},oc=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return ac;null==this._observers&&(this._observers=[]);const t=this._observers;let r=!1,n=!1;const i=t.length;for(let s=0;s<i;++s){const i=t[s];if(i.destroyed)n=!0;else if(i===e){r=!0;break}}return r||(t.push(e),n&&this._removeDestroyedObservers()),new sc(t,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||0===e.length)return;const t=e.length;let r=0;for(let n=0;n<t;++n){for(;n+r<t&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<t))break;e[n]=e[n+r]}}e.length=t-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(null!=e){for(const t of e)t.onCommitted();this._observers=null}}};const ac=_a();var lc,cc,uc;function dc(e){switch(e){case"defaults":return lc.DEFAULTS;case"service":return lc.SERVICE;case"portal-item":return lc.PORTAL_ITEM;case"web-scene":return lc.WEB_SCENE;case"web-map":return lc.WEB_MAP;case"link-chart":return lc.LINK_CHART;case"user":return lc.USER;default:return null}}function hc(e){switch(e){case lc.DEFAULTS:return"defaults";case lc.SERVICE:return"service";case lc.PORTAL_ITEM:return"portal-item";case lc.WEB_SCENE:return"web-scene";case lc.WEB_MAP:return"web-map";case lc.LINK_CHART:return"link-chart";case lc.USER:return"user"}}function pc(e){return hc(e)}!function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"}(lc||(lc={})),lc.USER,(uc=cc||(cc={}))[uc.Dirty=1]="Dirty",uc[uc.Overridden=2]="Overridden",uc[uc.Computing=4]="Computing",uc[uc.NonNullable=8]="NonNullable",uc[uc.HasDefaultValue=16]="HasDefaultValue",uc[uc.DepTrackingInitialized=32]="DepTrackingInitialized",uc[uc.AutoTracked=64]="AutoTracked",uc[uc.ExplicitlyTracking=128]="ExplicitlyTracking";let fc=class{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){var e;null==(e=this.accessed)||e.clear(),this.clear()}onAccessed(e){null!=this._observer&&e!==this._observer&&(null==this.accessed&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){null!=this._observer&&(this.clear(),null!=this.accessed&&(null==this._handles&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(null!=this._handles){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}};const mc=new fc,gc=[];let vc=mc;function yc(e){vc.onAccessed(e)}let wc=!1,bc=!1;function _c(e,t,r){if(wc)return Sc(e,t,r);let n=null;return Ic(e),n=t.call(r),Ec(),n}function Sc(e,t,r){const n=wc;wc=!0,Ic(e);let i=null;try{i=t.call(r)}catch(e){bc&&Qa.getLogger("esri.core.accessorSupport.tracking").error(e)}return Ec(),wc=n,i}function Ic(e){vc=e,gc.push(e)}function Ec(){const e=gc.length;if(e>1){const t=gc.pop();vc=gc[e-2],t.onTrackingEnd()}else if(1===e){const e=gc.pop();vc=mc,e.onTrackingEnd()}else vc=mc}function Ac(e,t){if(t.flags&cc.DepTrackingInitialized)return;t.flags|=cc.DepTrackingInitialized;const r=bc;bc=!1,t.flags&cc.AutoTracked?Sc(t.trackingTarget,t.metadata.get,e):kc(e,t),bc=r}const Rc=[];function kc(e,t){t.flags&cc.ExplicitlyTracking||(t.flags|=cc.ExplicitlyTracking,Sc(t.trackingTarget,()=>{const r=t.metadata.dependsOn||Rc;for(const t of r)if("string"!=typeof t||t.includes(".")){const r=zl(t);for(let t=0,n=e;t<r.length&&null!=n&&"object"==typeof n;++t)n=Tc(n,r[t],t!==r.length-1)}else Tc(e,t,!1)}),t.flags&=~cc.ExplicitlyTracking)}function Tc(e,t,r){const n="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(n,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.at(t)}const i=Bl(e);if(i){const t=i.propertiesByName.get(n);t&&(yc(t),Ac(e,t))}return r?e[n]:void 0}let Cc=class extends oc{constructor(e,t){super(),this.propertyName=e,this.metadata=t,this.trackingTarget=new fc(this),this.flags=0,this.flags=cc.Dirty|(t.nonNullable?cc.NonNullable:0)|(t.hasOwnProperty("value")?cc.HasDefaultValue:0)|(void 0===t.get?cc.DepTrackingInitialized:0)|(void 0===t.dependsOn?cc.AutoTracked:0)}destroy(){this.flags&cc.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&yc(this);const t=e.store,r=this.propertyName,n=this.flags,i=t.get(r);if(n&cc.Computing)return i;if(~n&cc.Dirty&&t.has(r))return i;this.flags|=cc.Computing;const s=e.host;let o;n&cc.AutoTracked?o=_c(this.trackingTarget,this.metadata.get,s):(kc(s,this),o=this.metadata.get.call(s)),this.flags|=cc.DepTrackingInitialized,t.set(r,o,lc.COMPUTED);const a=t.get(r);return a===i?this.flags&=~cc.Dirty:function(e,t){_c(mc,e,t)}(this.commit,this),this.flags&=~cc.Computing,a}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~cc.Dirty,this.onCommitted()}onInvalidated(){~this.flags&cc.Overridden&&(this.flags|=cc.Dirty);const e=this._observers;if(e&&e.length>0)for(const t of e)t.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onCommitted()}}},Oc=class e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new e;return this._values.forEach((e,n)=>{t&&t.has(n)||r.set(n,ua(e))}),r}get(e){return this._values.get(e)}originOf(){return lc.USER}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function Dc(e,t,r){return void 0!==e}function jc(e,t,r,n){return!(void 0===e||null==r&&e.flags&cc.NonNullable&&(n.lifecycle,Xl.INITIALIZING,1))}let xc=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Xl.INITIALIZING,this.store=new Oc,this.mutable=!0,this._origin=lc.USER;const t=this.host.constructor.__accessorMetadata__;for(const e in t){const r=new Cc(e,t[e]);this.propertiesByName.set(e,r)}this.metadata=t}initialize(){this.lifecycle=Xl.CONSTRUCTING}constructed(){this.lifecycle=Xl.CONSTRUCTED}destroy(){this.lifecycle=Xl.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Xl.INITIALIZING}get(e){const t=this.propertiesByName.get(e);if(t.metadata.get)return t.getComputed(this);this.mutable&&yc(t);const r=this.store;return r.has(e)?r.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.propertiesByName.get(e);if(void 0!==t&&t.flags&cc.HasDefaultValue)return"defaults"}return hc(t)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const t=this.propertiesByName.get(e);if(Dc(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const r=this.propertiesByName.get(e);Dc(r)&&this._internalSet(r,t)}getDependsInfo(e,t,r){const n=this.propertiesByName.get(t);if(!Dc(n))return"";const i=new fc,s=_c(i,()=>{var t;return null==(t=n.metadata.get)?void 0:t.call(e)});let o=`${r}${e.declaredClass.split(".").pop()}.${t}: ${s}\n`;const a=i.accessed??new Set;if(0===a.size)return o;r+="  ";for(const e of a)e instanceof Cc&&(o+=`${r}${e.propertyName}: undefined\n`);return o}setAtOrigin(e,t,r){const n=this.propertiesByName.get(e);if(Dc(n))return this._setAtOrigin(n,t,r)}isOverridden(e){const t=this.propertiesByName.get(e);return void 0!==t&&!!(t.flags&cc.Overridden)}clearOverride(e){const t=this.propertiesByName.get(e);t&&t.flags&cc.Overridden&&(t.flags&=~cc.Overridden,t.notifyChange())}override(e,t){const r=this.propertiesByName.get(e);if(!jc(r,0,t,this))return;const n=r.metadata.cast;if(n){const e=this._cast(n,t),{valid:r,value:i}=e;if(Pc.release(e),!r)return;t=i}r.flags|=cc.Overridden,this._internalSet(r,t)}set(e,t){const r=this.propertiesByName.get(e);if(!jc(r,0,t,this))return;const n=r.metadata.cast;if(n){const e=this._cast(n,t),{valid:r,value:i}=e;if(Pc.release(e),!r)return;t=i}const i=r.metadata.set;i?i.call(this.host,t):this._internalSet(r,t)}setDefaultOrigin(e){this._origin=dc(e)}getDefaultOrigin(){return hc(this._origin)}notifyChange(e){const t=this.propertiesByName.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.propertiesByName.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.propertiesByName.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const r=this.lifecycle!==Xl.INITIALIZING?this._origin:lc.DEFAULTS;this._setAtOrigin(e,t,r)}_setAtOrigin(e,t,r){const n=this.store,i=e.propertyName;n.has(i,r)&&ha(t,n.get(i))&&~e.flags&cc.Overridden&&r===n.originOf(i)||(e.invalidate(),n.set(i,t,r),e.commit(),Ac(this.host,e))}_cast(e,t){const r=Pc.acquire();return r.valid=!0,r.value=t,e&&(r.value=e.call(this.host,t,r)),r}};const Pc=new ic(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});function Nc(e,t,r){if(e&&t)if("object"==typeof t)for(const r of Object.getOwnPropertyNames(t))Nc(e,r,t[r]);else{if(t.includes(".")){const n=t.split("."),i=n.splice(-1,1)[0];return void Nc(Yl(e,n),i,r)}const n=e.__accessor__;null!=n&&function(e,t){if(oa("esri-unknown-property-errors")&&!function(e,t){return null!=t.metadata[e]}(e,t))throw new rl("set:unknown-property",function(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}(e,t))}(t,n),e[t]=r}}var Lc;function Uc(e){e.length=0}!function(e){e[e.Ignore=0]="Ignore",e[e.Destroy=1]="Destroy",e[e.ThrowError=2]="ThrowError"}(Lc||(Lc={}));let Fc=class{constructor(e=50,t=50){this._pool=new ic(Array,void 0,Uc,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Mc.acquire()}static release(e){return Mc.release(e)}static prune(){Mc.prune()}};const Mc=new Fc(100);const $c=[];function Bc(e){$c.push(e),1===$c.length&&queueMicrotask(()=>{const e=$c.slice();$c.length=0;for(const t of e)t()})}let Vc=class{constructor(e,t=30){this.name=e,this._counter=0,this._samples=new Array(t)}push(e){null!=e&&(this._samples[++this._counter%this._samples.length]=e)}set(e){null!=e&&(this._samples[this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,t)=>e-t)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,t)=>e+t,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var qc;!function(e){const t=(e,t,r,n)=>{let i=t,s=t;const o=r>>>1,a=e[i-1];for(;s<=o;){s=i<<1,s<r&&n(e[s-1],e[s])<0&&++s;const t=e[s-1];if(n(t,a)<=0)break;e[i-1]=t,i=s}e[i-1]=a},r=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,n,i,s){void 0===n&&(n=0),void 0===i&&(i=e.length),void 0===s&&(s=r);for(let r=i>>>1;r>n;r--)t(e,r,i,s);const o=n+1;for(let r=i-1;r>n;r--){const i=e[n];e[n]=e[r],e[r]=i,t(e,o,r,s)}},e.iterableSort=function*(e,n,i,s){void 0===n&&(n=0),void 0===i&&(i=e.length),void 0===s&&(s=r);for(let r=i>>>1;r>n;r--)t(e,r,i,s),yield;const o=n+1;for(let r=i-1;r>n;r--){const i=e[n];e[n]=e[r],e[r]=i,t(e,o,r,s),yield}}}(qc||(qc={}));let zc=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}};const Gc=[],Wc={willDispatch:!1};function Hc(e){const t=new zc(e);return Gc.push(t),Wc.willDispatch||(Wc.willDispatch=!0,Bc(Jc)),t}function Jc(){for(;Gc.length;){const e=Gc.shift();e.isActive&&e.callback()}Wc.willDispatch=!1}function Kc(e){return function(e=1,t){const r=_l(),n=()=>{pl(t)?r.reject(dl()):0===e?r():(--e,Bc(()=>n()))};return n(),r.promise}(1,e)}async function Yc(e){await Kc(e),await new Promise(t=>requestAnimationFrame(()=>{(null==e?void 0:e.aborted)||t()}))}["prepare","preRender","render","postRender","update","finish"].map(e=>new Vc(e)),new Vc("total");let Zc=0;function Xc(){return++Zc}let Qc=class extends fc{constructor(e){super(new eu(e)),this._observer&&tu.register(this,new WeakRef(this._observer),this)}destroy(){var e,t;this._observer&&tu.unregister(this._observer),null==(e=this.accessed)||e.clear(),this.clear(),null==(t=this._observer)||t.destroy()}},eu=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=ru}};const tu=new FinalizationRegistry(e=>{var t;null==(t=e.deref())||t.destroy()});function ru(){}let nu=!1;const iu=[];function su(e,t){let r=new Qc(function s(){if(!r||i)return;if(nu)return void function(e){iu.includes(e)||iu.unshift(e)}(s);const o=n;r.clear(),nu=!0,i=!0,n=_c(r,e),i=!1,nu=!1,t(n,o),function(){for(;iu.length;)iu.pop()()}()}),n=null,i=!1;return i=!0,n=_c(r,e),i=!1,_a(function(){r&&(r.destroy(),r=null,n=null)})}function ou(e,t){let r=new Qc(function(){t(n,i)}),n=null;function i(){return r?(r.clear(),n=_c(r,e),n):null}return i(),_a(function(){r&&(r.destroy(),r=null),n=null})}var au;!function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"}(au||(au={}));let lu=class{constructor(){this.uid=Xc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,t,r,n,i){return this.pool.acquire(au.Untracked,e,t,r,n,i,ha)}static acquireTracked(e,t,r,n){return this.pool.acquire(au.Tracked,e,t,r,null,null,n)}notify(e,t){this.type===au.Untracked?this.callback.call(this.target,e,t,this.path,this.target):this.callback.call(null,e,t,void 0,void 0)}acquire(e,t,r,n,i,s,o){this.uid=Xc(),this.removed=!1,this.type=e,this.oldValue=t,this.callback=r,this.getValue=n,this.target=i,this.path=s,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Xc(),this.removed=!0}};lu.pool=new class extends ic{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const t=super.acquire(...e);return this._set.delete(t),t}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}(lu);const cu=new Fc,uu=new Set;let du;function hu(e){uu.delete(e),uu.add(e),du||(du=Hc(fu))}function pu(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function fu(){let e=10;for(;du&&e--;){du=null;const e=mu(),t=cu.acquire();for(const r of e){const e=r.uid;pu(r),e===r.uid&&r.removed&&t.push(r)}for(const e of uu)e.removed&&(t.push(e),uu.delete(e));for(const e of t)lu.pool.release(e);cu.release(t),cu.release(e),gu.forEach(e=>e())}}function mu(){const e=cu.acquire();e.length=uu.size;let t=0;for(const r of uu)e[t]=r,++t;return uu.clear(),e}const gu=new Set;function vu(e,t,r,n=!1){return e.__accessor__&&e.__accessor__.lifecycle!==Xl.DESTROYED?n?function(e,t,r){const n=Wl(e,t,r,(e,t,r)=>{let i=!1;return su(()=>Kl(e,t),(s,o)=>{e.__accessor__.lifecycle!==Xl.DESTROYED?i||(i=!0,ha(o,s)||r.call(e,s,o,t,e),i=!1):n.remove()})});return n}(e,t,r):function(e,t,r){let n=Wl(e,t,r,(e,t,r)=>{let i,s,o=ou(()=>Kl(e,t),(o,a)=>{var l;(null==(l=e.__accessor__)?void 0:l.lifecycle)===Xl.DESTROYED||i&&i.uid!==s?n.remove():(i||(i=lu.acquireUntracked(o,r,a,e,t),s=i.uid),hu(i))});return _a(()=>{o.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,hu(i)),i=null),n=o=null})});return n}(e,t,r):_a()}function yu(e,t,r=!1,n=pa){return r?function(e,t,r){let n=!1;return su(e,(e,i)=>{n||(n=!0,r(i,e)||t(e,i),n=!1)})}(e,t,n):function(e,t,r){let n,i,s=ou(e,(e,o)=>{n&&n.uid!==i?s.remove():(n||(n=lu.acquireTracked(e,t,o,r),i=n.uid),hu(n))});return _a(()=>{s.remove(),n&&(n.uid!==i||n.removed||(n.removed=!0,hu(n)),n=null),s=null})}(e,t,n)}function wu(e,t,r){const n=e.get(t);if(void 0!==n)return n;const i=r();return e.set(t,i),i}const bu=()=>Qa.getLogger("esri.core.accessorSupport.ensureTypes");function _u(e){return null==e?e:new Date(e)}function Su(e){return null==e?e:!!e}function Iu(e){return null==e?e:e.toString()}function Eu(e){return null==e?e:Math.round(parseFloat(e))}function Au(e){return null}function Ru(e){return(null==e?void 0:e.constructor)&&void 0!==e.constructor.__accessorMetadata__}function ku(e,t){return null!=t&&e&&!(t instanceof e)}function Tu(e){return e&&"isCollection"in e}function Cu(e){return(null==e?void 0:e.Type)?"function"==typeof e.Type?e.Type:e.Type.base:null}function Ou(e,t){return!!Ru(t)&&(bu().error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+ju(e)+"'"),!0)}function Du(e,t){return null==t?t:Tu(e)?function(e,t){if(!(null==t?void 0:t.constructor)||!Tu(t.constructor))return Ou(e,t)?t:new e(t);const r=Cu(e.prototype.itemType),n=Cu(t.constructor.prototype.itemType);return r?n?r===n?t:r.prototype.isPrototypeOf(n.prototype)?new e(t):(Ou(e,t),t):new e(t):t}(e,t):ku(e,t)?Ou(e,t)?t:new e(t):t}function ju(e){var t;return(null==(t=null==e?void 0:e.prototype)?void 0:t.declaredClass)||"unknown"}const xu=new WeakMap;function Pu(e){switch(e){case Number:return e=>function(e,t=0){return null==e?e:(e=parseFloat(e),isNaN(e)?t:e)}(e);case Vu:return Eu;case Boolean:return Su;case String:return Iu;case Date:return _u;case qu:return Au;default:return wu(xu,e,()=>Du.bind(null,e))}}function Nu(e,t){const r=Pu(e);return 1===arguments.length?r:r(t)}function Lu(e,t,r){return 1===arguments.length?Lu.bind(null,e):t?Array.isArray(t)?t.map(t=>e(t,r)):[e(t,r)]:t}function Uu(e,t,r){return 0!==t&&Array.isArray(r)?r.map(r=>Uu(e,t-1,r)):e(r)}function Fu(e,t,r){if(2===arguments.length)return r=>Fu(e,t,r);if(!r)return r;r=Uu(e,t,r);let n=t,i=r;for(;n>0&&Array.isArray(i);)n--,i=i[0];if(void 0!==i)for(let e=0;e<n;e++)r=[r];return r}function Mu(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!("string"===r||"number"===r||"function"===r&&e.length>1)})}function $u(e,t){if(2===arguments.length)return $u(e).call(null,t);const r=new Set,n=e.filter(e=>"function"!=typeof e),i=e.filter(e=>"function"==typeof e);for(const t of e)"string"!=typeof t&&"number"!=typeof t||r.add(t);let s=null,o=null;return(e,t)=>{if(null==e)return e;const a=typeof e,l="string"===a||"number"===a;return l&&(r.has(e)||i.some(e=>"string"===a&&e===String||"number"===a&&e===Number))||"object"===a&&i.some(t=>!ku(e,t))?e:(l&&n.length?(s||(s=n.map(e=>"string"==typeof e?`'${e}'`:`${e}`).join(", ")),bu().error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${s}`)):"object"==typeof e&&i.length?(o||(o=i.map(e=>ju(e)).join(", ")),bu().error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${o}`)):bu().error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function Bu(e,t){if(2===arguments.length)return Bu(e).call(null,t);const r={},n=[],i=[];for(const t in e.typeMap){const s=e.typeMap[t];r[t]=Nu(s),n.push(ju(s)),i.push(t)}const s="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!ku(e.base,t))return t;if(null==t)return t;const o=s(t)||e.defaultKeyValue,a=r[o];if(!a)return bu().error("Accessor#set",`Invalid property value, value needs to be one of '${n.join("', '")}', or a plain object that can autocast (having .type = '${i.join("', '")}')`),null;if(!ku(e.typeMap[o],t))return t;if("string"==typeof e.key&&!Ru(t)){const r={};for(const n in t)n!==e.key&&(r[n]=t[n]);return a(r)}return a(t)}}let Vu=class{},qu=class{};function zu(e){switch(e.type){case"native":return Nu(e.value);case"array":return Lu(zu(e.value));case"one-of":return function(e){let t=null;return(r,n)=>Wu(r,e)?r:(null==t&&(t=Gu(e)),bu().error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),n&&(n.valid=!1),null)}(e);default:return null}}function Gu(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Vu:return"integer";case Date:return"date";case qu:return"null";default:return ju(e.value)}case"array":return`array of ${Gu(e.value)}`;case"one-of":{const t=e.values.map(e=>Gu(e));return`one of ${t.slice(0,-1)} or ${t[t.length-1]}`}}return"unknown"}function Wu(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case Vu:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e;case qu:return null===e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(e=>!Wu(e,t.value));case"one-of":return t.values.some(t=>Wu(e,t))}}function Hu(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const n=Object.getOwnPropertyDescriptor(t,r),i=tc(t,r);n&&(n.get||n.set?(i.get=n.get||i.get,i.set=n.set||i.set):"value"in n&&("value"in e&&Qa.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),i.value=e.value=n.value)),null!=e.readOnly&&(i.readOnly=e.readOnly);const s=e.aliasOf;if(s){const e="string"==typeof s?s:s.source,t="string"==typeof s?null:!0===s.overridable;let n;i.dependsOn=[e],i.get=function(){let t=Yl(this,e);if("function"==typeof t){n||(n=e.split(".").slice(0,-1).join("."));const r=Yl(this,n);r&&(t=t.bind(r))}return t},i.readOnly||(i.set=t?function(e){this._override(r,e)}:function(t){Nc(this,e,t)})}const o=e.type,a=e.types;if(!i.cast){let t;o?t=function(e){let t=0,r=e;if(function(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}(e))return zu(e);for(;Array.isArray(r)&&1===r.length&&"string"!=typeof r[0]&&"number"!=typeof r[0];)r=r[0],t++;const n=r;if(Mu(n))return 0===t?$u(n):Fu($u(n),t);if(1===t)return function(e,t){return 1===arguments.length?Lu(t=>Nu(e,t)):Lu(t=>Nu(e,t),t)}(n);if(t>1)return function(e,t,r){return 2===arguments.length?Fu(t=>Nu(e,t),t):Fu(t=>Nu(e,t),t,r)}(n,t);const i=e;return i.from?i.from:Nu(i)}(o):a&&(t=Array.isArray(a)?Lu(Bu(a[0])):Bu(a)),e.cast=function(e,t){if(e||t)return e?t?(r,n)=>t(e(r,n),n):e:t}(e.cast,t)}(function(e,t){Vl(e,t,nc)})(i,e),e.range&&(i.cast=function(e,t){return r=>{let n=e(r);return null!=t.step&&(n=Math.round(n/t.step)*t.step),null!=t.min&&(n=Math.max(t.min,n)),null!=t.max&&(n=Math.min(t.max,n)),n}}(i.cast,e.range))}}let Ju=class extends tl{constructor(e,t,r){super(e,t,r)}};function Ku(e){var t;return!!e&&(null==(t=e.prototype)?void 0:t.declaredClass)&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}Ju.prototype.type="warning";const Yu=()=>Qa.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Zu(e,t,r){var n,i;e&&(!r&&!t.read||(null==(n=t.read)?void 0:n.reader)||!1===(null==(i=t.read)?void 0:i.enabled)||function(e){return"types"in e?nd(e.types):rd(e.type)}(e)&&ma("read.reader",function(e){var t,r;const n=e.ndimArray??0;if(n>1)return function(e){const t=Xu(e),r=Qu.bind(null,t),n=e.ndimArray??0;return(e,t,i)=>{if(null==e)return e;e=r(e,i,n);let s=n,o=e;for(;s>0&&Array.isArray(o);)s--,o=o[0];if(void 0!==o)for(let t=0;t<s;t++)e=[e];return e}}(e);if(1===n)return ed(e);if("type"in e&&td(e.type)){const n=null==(r=null==(t=e.type.prototype)?void 0:t.itemType)?void 0:r.Type,i=ed("function"==typeof n?{type:n}:{types:n});return(t,r,n)=>{const s=i(t,r,n);return s?new e.type(s):s}}return Xu(e)}(e),t))}function Xu(e){return"type"in e?function(e){return e.prototype.read?(t,r,n)=>{if(null==t)return t;const i=typeof t;if("object"!==i)return void Yu().error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${i}'`);const s=new e;return s.read(t,n),s}:e.fromJSON}(e.type):function(e){let t=null;const r=e.errorContext??"type",n=e.validate;return(i,s,o)=>{if(null==i)return i;const a=typeof i;if("object"!==a)return void Yu().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=function(e){var t,r;const n={};for(const i in e.typeMap){const s=e.typeMap[i],o=ec(s.prototype);if("function"==typeof e.key)continue;const a=o[e.key];if(!a)continue;if((null==(t=a.json)?void 0:t.type)&&Array.isArray(a.json.type)&&1===a.json.type.length&&"string"==typeof a.json.type[0]){n[a.json.type[0]]=s;continue}const l=null==(r=a.json)?void 0:r.write;if(!(null==l?void 0:l.writer)){n[i]=s;continue}const c=l.target,u="string"==typeof c?c:e.key,d={};l.writer(i,d,u),d[u]&&(n[d[u]]=s)}return n}(e));const l=e.key;if("string"!=typeof l)return;const c=i[l],u=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!u){const e=`Type '${c||"unknown"}' is not supported`;return(null==o?void 0:o.messages)&&i&&o.messages.push(new Ju(`${r}:unsupported`,e,{definition:i,context:o})),void Yu().error(e)}const d=new u;return d.read(i,o),n?n(d):d}}(e.types)}function Qu(e,t,r,n){return 0!==n&&Array.isArray(t)?t.map(t=>Qu(e,t,r,n-1)):e(t,void 0,r)}function ed(e){const t=Xu(e);return(e,r,n)=>{if(null==e)return e;if(Array.isArray(e)){const r=[];for(const i of e){const e=t(i,void 0,n);void 0!==e&&r.push(e)}return r}const i=t(e,void 0,n);return void 0!==i?[i]:void 0}}function td(e){if(!Ku(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?rd(t.Type):nd(t.Type))}function rd(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||td(e))}function nd(e){for(const t in e.typeMap)if(!rd(e.typeMap[t]))return!1;return!0}function id(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function sd(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function od(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}function ad(e,t){if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const r=(null==e?void 0:e.ndimArray)??0;e&&(1===r||"type"in e&&Ku(e.type))?t.write.writer=dd:r>1?t.write.writer=function(e){return(t,r,n,i)=>{let s;if(null===t)s=null;else{s=hd(t,i,e);let r=e,n=s;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(void 0!==n)for(let e=0;e<r;e++)s=[s]}ma(n,s,r)}}(r):t.types?Array.isArray(t.types)?t.write.writer=function(e){return(t,r,n,i)=>t&&Array.isArray(t)?cd(t.filter(t=>ld(t,e,i)),r,n,i):cd(t,r,n,i)}(t.types[0]):t.write.writer=function(e){return(t,r,n,i)=>t?ld(t,e,i)?cd(t,r,n,i):void 0:cd(t,r,n,i)}(t.types):t.write.writer=cd}function ld(e,t,r){for(const r in t.typeMap)if(e instanceof t.typeMap[r])return!0;if(null==r?void 0:r.messages){const n=t.errorContext??"type",i=`Values of type '${("function"!=typeof t.key?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new rl(`${n}:unsupported`,i,{definition:e,context:r})),Qa.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(i)}return!1}function cd(e,t,r,n){ma(r,ud(e,n),t)}function ud(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?function(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}(e):e}function dd(e,t,r,n){let i;null===e?i=null:e&&"function"==typeof e.map?(i=e.map(e=>ud(e,n)),"function"==typeof i.toArray&&(i=i.toArray())):i=[ud(e,n)],ma(r,i,t)}function hd(e,t,r){return 0!==r&&Array.isArray(e)?e.map(e=>hd(e,t,r-1)):ud(e,t)}function pd(e,t){return md(e,"read",null==t?void 0:t.origin)}function fd(e,t){return md(e,"write",null==t?void 0:t.origin)}function md(e,t,r){let n=null==e?void 0:e.json;if((null==n?void 0:n.origins)&&r){let e;e="link-chart"===r?n.origins[r]&&("any"===t||t in n.origins[r])?n.origins[r]:n.origins["web-map"]:n.origins[r],e&&("any"===t||t in e)&&(n=e)}return n}function gd(e){var t;const r=function(e){return e.json.types?wd(e.json):e.type?yd(e):wd(e)}(e);if(e.json.origins)for(const n in e.json.origins){const i=e.json.origins[n],s=i.types?vd(i):r;Zu(s,i,!1),i.types&&!i.write&&(null==(t=e.json.write)?void 0:t.enabled)&&(i.write={...e.json.write}),ad(s,i)}Zu(r,e.json,!0),ad(r,e.json)}function vd(e){return e.type?yd(e):wd(e)}function yd(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!Mu(r);)r=r[0],t++;return{type:r,ndimArray:t}}function wd(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function bd(e){(function(e){if(e.json||(e.json={}),sd(e.json),od(e.json),id(e.json),e.json.origins)for(const t in e.json.origins)sd(e.json.origins[t]),od(e.json.origins[t]),id(e.json.origins[t]);return!0})(e)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const e in r)if(t[e]){const n=t[e];r[e].forEach(e=>{t[e]=n}),delete t[e]}}}(e),gd(e))}const _d=new Set,Sd=new Set;function Id(e){return t=>{e??(e="esri.core.Accessor"),t.prototype.declaredClass=e,function(e){const t=e.prototype,r=ec(t),n={};for(const e of Object.getOwnPropertyNames(r)){const t=r[e];bd(t),n[e]={enumerable:!0,configurable:!0,get:Ed(e,t),set(r){const n=this.__accessor__;if(void 0!==n){if(n.mutable)return n.initialized&&t.readOnly?Ad("read-only",e):n.lifecycle===Xl.CONSTRUCTED&&t.constructOnly?Ad("construct-only",e):void n.set(e,r)}else Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:r})}}}Object.defineProperties(e.prototype,n)}(t);const r=[],n=[];let i=t.prototype;for(;i;)i.hasOwnProperty("initialize")&&!_d.has(i.initialize)&&(_d.add(i.initialize),r.push(i.initialize)),i.hasOwnProperty("destroy")&&!Sd.has(i.destroy)&&(Sd.add(i.destroy),n.push(i.destroy)),i=Object.getPrototypeOf(i);_d.clear(),Sd.clear();const s=class extends t{constructor(...e){if(super(...e),this.constructor===s&&"function"==typeof this.postscript){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=r.length-1;e>=0;e--)r[e].call(this)}}),n.length){let e=!1;const t=this[$l];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0,t.call(this);for(let e=0;e<n.length;e++)n[e].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};s.__accessorMetadata__=ec(t.prototype),s.prototype.declaredClass=e;const o=(e||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function Ed(e,t){return null==t.get?function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0===r)return;t.mutable&&yc(r);const n=t.store;return n.has(e)?n.get(e):r.metadata.value}:function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0!==r)return r.getComputed(t)}}const Ad=(e,t)=>{Qa.getLogger("esri.core.Accessor").error(`cannot assign to ${e} property '${t}'`)};var Rd,kd;function Td(e){var t;if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return(null==(t=e.constructor)?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const Cd=Symbol("Accessor-Handles"),Od=Symbol("Accessor-Initialized");let Dd=class e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const i=this;class s extends i{constructor(...e){super(...e),this.inherited=null,n&&n.apply(this,e)}}ec(s.prototype);for(const t in e){const r=e[t];s.prototype[t]="function"==typeof r?function(...e){const n=this.inherited;let s;this.inherited=function(...e){if(i.prototype[t])return i.prototype[t].apply(this,e)};try{s=r.apply(this,e)}catch(e){throw this.inherited=n,e}return this.inherited=n,s}:e[t]}for(const e in t){Hu(Td(t[e]))(s.prototype,e)}return Id(r)(s)}static freeze(t){return t instanceof e?t.__accessor__.mutable=!1:Object.freeze(t),t}static isFrozen(t){return t instanceof e?!t.__accessor__.mutable:Object.isFrozen(t)}constructor(...t){var r;if(this[Rd]=null,this[kd]=!1,this.constructor===e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const n=new xc(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:n}),t.length>0&&(n.ctorArgs=(null==(r=this.normalizeCtorArgs)?void 0:r.apply(this,t))??t[0])}postscript(){const e=this.__accessor__,t=e.ctorArgs;e.initialize(),t&&(this.set(t),e.ctorArgs=null),e.constructed(),this.initialize(),this[Od]=!0}initialize(){}[$l](){this[Cd]=ll(this[Cd])}destroy(){var e;this.destroyed||(function(e){for(const t of uu.values())t.target===e&&(t.removed=!0)}(this),this.__accessor__.destroy(),null==(e=void 0)||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[Od]}get destroyed(){var e;return(null==(e=this.__accessor__)?void 0:e.lifecycle)===Xl.DESTROYED||!1}commitProperty(e){Yl(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return Nc(this,e,t),this}watch(e,t,r){return Pl(Qa.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-core-reactiveUtils.html#watch",warnOnce:!0}),vu(this,e,t,r)}addHandles(e,t){if(this.destroyed){const t=Array.isArray(e)?e:[e];for(const e of t)e.remove();return}(this[Cd]??(this[Cd]=new Ll)).add(e,t)}removeHandles(e){var t;null==(t=this[Cd])||t.remove(e)}removeAllHandles(){var e;null==(e=this[Cd])||e.removeAll()}removeHandlesReference(e){var t;null==(t=this[Cd])||t.removeReference(e)}hasHandles(e){var t;return!0===(null==(t=this[Cd])?void 0:t.has(e))}_override(e,t){void 0===t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,t){null==t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}};Rd=Cd,kd=Od;let jd=class e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new e;return this._values.forEach((e,n)=>{t&&t.has(n)||r.set(n,ua(e.value),e.origin)}),r}get(e,t){t=this._normalizeOrigin(t);const r=this._values.get(e);return null==t||(null==r?void 0:r.origin)===t?null==r?void 0:r.value:void 0}originOf(e){var t;return(null==(t=this._values.get(e))?void 0:t.origin)??lc.USER}keys(e){e=this._normalizeOrigin(e);const t=[...this._values.keys()];return null==e?t:t.filter(t=>{var r;return(null==(r=this._values.get(t))?void 0:r.origin)===e})}set(e,t,r){if((r=this._normalizeOrigin(r))===lc.DEFAULTS){const t=this._values.get(e);if(null!=(null==t?void 0:t.origin)&&t.origin>r)return}this._values.set(e,new xd(t,r))}delete(e,t){var r;null!=(t=this._normalizeOrigin(t))&&(null==(r=this._values.get(e))?void 0:r.origin)!==t||this._values.delete(e)}has(e,t){var r;return null!=(t=this._normalizeOrigin(t))?(null==(r=this._values.get(e))?void 0:r.origin)===t:this._values.has(e)}forEach(e){this._values.forEach(({value:t},r)=>e(t,r))}_normalizeOrigin(e){if(null!=e)return e===lc.DEFAULTS?e:lc.USER}};class xd{constructor(e,t){this.value=e,this.origin=t}}function Pd(e,t,r){if(!(null==e?void 0:e.read)||!1===e.read.enabled||!e.read.source)return!1;const n=e.read.source;if("string"==typeof n){if(n===t)return!0;if(n.includes(".")&&0===n.indexOf(t)&&Zl(n,r))return!0}else for(const e of n){if(e===t)return!0;if(e.includes(".")&&0===e.indexOf(t)&&Zl(e,r))return!0}return!1}function Nd(e,t,r,n,i){let s=pd(t[r],i);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(s)&&(e[r]=!0);for(const o of Object.getOwnPropertyNames(t))s=pd(t[o],i),Pd(s,r,n)&&(e[o]=!0)}function Ld(e,t,r,n){const i=function(e,t){return md(e,"any",null==t?void 0:t.origin)}(r.metadata[t],n),s=null==i?void 0:i.default;if(void 0===s)return;const o="function"==typeof s?s.call(e,t,n):s;void 0!==o&&r.set(t,o)}const Ud={origin:"service"};function Fd(e,t,r,n,i){var s,o;const a={};return null==(o=null==(s=t.write)?void 0:s.writer)||o.call(e,n,a,r,i),a}function Md(e,t,r,n,i,s){if(!(null==n?void 0:n.write))return!1;const o=Yl(e,r);if(!i&&n.write.overridePolicy){const t=n.write.overridePolicy.call(e,o,r,s??void 0);void 0!==t&&(i=t)}if(i||(i=n.write),!i||!1===i.enabled)return!1;if(i.layerContainerTypes&&(null==s?void 0:s.layerContainerType)&&!i.layerContainerTypes.includes(s.layerContainerType))return!1;if((null===o&&!i.allowNull&&!i.writerEnsuresNonNull||void 0===o)&&i.isRequired){const t=new rl("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return t&&(null==s?void 0:s.messages)?s.messages.push(t):t&&!s&&Qa.getLogger("esri.core.accessorSupport.write").error(t.name,t.message),!1}return void 0!==o&&(!(null===o&&!i.allowNull&&!i.writerEnsuresNonNull)&&(!(!(i.alwaysWriteDefaults||t.store.multipleOriginsSupported&&t.store.originOf(r)!==lc.DEFAULTS)&&function(e,t,r,n,i){const s=n.default;if(void 0===s)return!1;if(null!=n.defaultEquals)return n.defaultEquals(i);if("function"==typeof s){if(Array.isArray(i)){return aa(s.call(e,t,r??void 0),i)}return!1}return s===i}(e,r,s,n,o))&&!(!i.ignoreOrigin&&(null==s?void 0:s.origin)&&t.store.multipleOriginsSupported&&t.store.originOf(r)<dc(s.origin))))}const $d=e=>{let t=class extends e{constructor(...e){super(...e);const t=Bl(this),r=t.store,n=new jd;t.store=n,function(e,t,r){t.keys().forEach(e=>{r.set(e,t.get(e),lc.DEFAULTS)});const n=e.metadata;Object.keys(n).forEach(t=>{e.internalGet(t)&&r.set(t,e.internalGet(t),lc.DEFAULTS)})}(t,r,n)}read(e,t){!function(e,t,r=Ud){if(!t||"object"!=typeof t)return;const n=Bl(e),i=n.metadata,s={};for(const e of Object.getOwnPropertyNames(t))Nd(s,i,e,t,r);n.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const s=pd(i[o],r).read,a=null==s?void 0:s.source;let l;l=a&&"string"==typeof a?Kl(t,a):t[o],(null==s?void 0:s.reader)&&(l=s.reader.call(e,l,t,r)),void 0!==l&&n.set(o,l)}if(!r||!r.ignoreDefaults){n.setDefaultOrigin("defaults");for(const t of Object.getOwnPropertyNames(i))s[t]||Ld(e,t,n,r)}n.setDefaultOrigin("user")}(this,e,t)}write(e,t){return function(e,t,r){var n,i;if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return Vl(t,e.toJSON(r));const s=Bl(e),o=s.metadata;for(const a in o){const l=fd(o[a],r);if(!Md(e,s,a,l,void 0,r))continue;const c=Yl(e,a),u=Fd(e,l,l.write&&"string"==typeof l.write.target?l.write.target:a,c,r);Object.keys(u).length>0&&(t=Vl(t,u),(null==(i=null==(n=null==r?void 0:r.resources)?void 0:n.pendingOperations)?void 0:i.length)&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>Vl(t,u,()=>"replace-arrays"))),(null==r?void 0:r.writtenProperties)&&r.writtenProperties.push({target:e,propName:a,oldOrigin:pc(s.store.originOf(a)),newOrigin:r.origin}))}return t}(this,e??{},t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return Bd.call(this,e,t)}};return t=jl([Id("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Bd(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let Vd=class extends($d(Dd)){};Vd=jl([Id("esri.core.JSONSupport")],Vd),function(e){e.JSONSupportMixin=$d,e.isSerializable=function(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}}(Vd||(Vd={}));const qd=Vd;function zd(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function Gd(e){const t=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,n=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return t.test(e)?e=e.replace(t,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):n.test(e)&&(e=e.replace(n,"https://qaext.arcgis.com")),e}const Wd=()=>Qa.getLogger("esri.core.urlUtils"),Hd=Ja.request,Jd="esri/config: esriConfig.request.proxyUrl is not set.",Kd=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Yd=/^\s*http:/i,Zd=/^\s*https:/i,Xd=/^\s*file:/i,Qd=/:\d+$/,eh=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,th=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),rh=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let nh=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=this.uri.match(th);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=this.authority.match(rh),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}};const ih={};let sh=new nh(Ja.applicationUrl);const oh=function(){const e=sh.path,t=e.slice(0,e.lastIndexOf("/")+1);return`${sh.scheme}://${sh.host}${null!=sh.port?`:${sh.port}`:""}${t}`}();let ah=oh;const lh=()=>sh;function ch(e){if(!e)return null;const t={path:null,query:null},r=new nh(e),n=e.indexOf("?");return null===r.query?t.path=e:(t.path=e.slice(0,n),t.query=uh(r.query)),r.fragment&&(t.hash=r.fragment,null===r.query&&(t.path=t.path.slice(0,t.path.length-(r.fragment.length+1)))),t}function uh(e){const t=e.split("&"),r={};for(const e of t){if(!e)continue;const t=e.indexOf("=");let n,i;t<0?(n=decodeURIComponent(e),i=""):(n=decodeURIComponent(e.slice(0,t)),i=decodeURIComponent(e.slice(t+1)));let s=r[n];"string"==typeof s&&(s=r[n]=[s]),Array.isArray(s)?s.push(i):r[n]=i}return r}function dh(e,t){return e?Object.keys(e).map(r=>{const n=e[r];if(null==n)return"";const i=encodeURIComponent(r)+"=",s=null==t?void 0:t[r];return s?i+encodeURIComponent(s(n)):Array.isArray(n)?n.map(e=>qd.isSerializable(e)?i+encodeURIComponent(JSON.stringify(e)):i+encodeURIComponent(e)).join("&"):qd.isSerializable(n)?i+encodeURIComponent(JSON.stringify(n)):i+encodeURIComponent(n)}).filter(e=>e).join("&"):""}function hh(e=!1){let t,r=Hd.proxyUrl;if("string"==typeof e){t=function(e){return null!=e&&Zd.test(e)||"https"===sh.scheme&&Oh(e)}(e);const n=gh(e);n&&(r=n.proxyUrl)}else t=!!e;if(!r)throw Wd().warn(Jd),new rl("urlUtils:proxy-not-set",Jd);return t&&xh()&&(r=jh(r)),ch(r)}const ph={path:"",query:""};function fh(e){const t=e.indexOf("?");return-1!==t?(ph.path=e.slice(0,t),ph.query=e.slice(t+1)):(ph.path=e,ph.query=null),ph}function mh(e){return(e=Ph(e=function(e){return e.endsWith("/")?e:`${e}/`}(e=fh(e).path),!0)).toLowerCase()}function gh(e){const t=Hd.proxyRules,r=mh(e);for(let e=0;e<t.length;e++)if(0===r.indexOf(t[e].urlPrefix))return t[e]}function vh(e,t=Hd.interceptors){const r=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t);if(t)for(const e of t)if(Array.isArray(e.urls)){if(e.urls.some(r))return e}else if(r(e.urls))return e;return null}function yh(e,t,r=!1){if(!e||!t)return!1;const n=Lh(e),i=Lh(t);return!(!r&&n.scheme!==i.scheme)&&null!=n.host&&null!=i.host&&n.host.toLowerCase()===i.host.toLowerCase()&&n.port===i.port}function wh(e){if("string"==typeof e){if(!Rh(e))return!0;e=Lh(e)}if(yh(e,sh))return!0;const t=Hd.trustedServers||[];for(let r=0;r<t.length;r++){const n=bh(t[r]);for(let t=0;t<n.length;t++)if(yh(e,n[t]))return!0}return!1}function bh(e){return ih[e]||(Dh(e)||Oh(e)?ih[e]=[new nh(_h(e))]:ih[e]=[new nh(`http://${e}`),new nh(`https://${e}`)]),ih[e]}function _h(e,t=ah,r){return Oh(e)?(null==r?void 0:r.preserveProtocolRelative)?e:"http"===sh.scheme&&sh.authority===Ah(e).slice(2)?`http:${e}`:`https:${e}`:Dh(e)?e:Eh("/"===e[0]?function(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return-1===r?e:e.slice(0,r)}(t):t,e)}function Sh(e,t=ah,r){if(null==e||!Rh(e))return e;const n=Ih(e),i=n.toLowerCase(),s=Ih(t).toLowerCase().replace(/\/+$/,""),o=r?Ih(r).toLowerCase().replace(/\/+$/,""):null;if(o&&0!==s.indexOf(o))return e;const a=(e,t,r)=>-1===(r=e.indexOf(t,r))?e.length:r;let l=a(i,"/",i.indexOf("//")+2),c=-1;for(;i.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==i.length);)l=a(i,"/",l+1);if(-1===c)return e;if(o&&c<o.length)return e;e=n.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let t=0;t<u;t++)e=`../${e}`;else e=`./${e}`;return e}function Ih(e){return function(e){const t=Hd.httpsDomains;if(!function(e){return null!=e&&Yd.test(e)||"http"===sh.scheme&&Oh(e)}(e))return e;const r=e.indexOf("/",7);let n;if(n=-1===r?e:e.slice(0,r),n=n.toLowerCase().slice(7),Qd.test(n)){if(!n.endsWith(":80"))return e;n=n.slice(0,-3),e=e.replace(":80","")}return"http"===sh.scheme&&n===sh.authority&&!eh.test(e)||(xh()&&n===sh.authority||t&&t.some(e=>n===e||n.endsWith(`.${e}`))||xh()&&!gh(e))&&(e=jh(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=fh(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=_h(e=e.trim()))))}function Eh(...e){const t=e.filter(la);if(!(null==t?void 0:t.length))return;const r=[];if(Rh(t[0])){const e=t[0],n=e.indexOf("//");-1!==n&&(r.push(e.slice(0,n+1)),function(e){return null!=e&&Xd.test(e)}(t[0])&&(r[0]+="/"),t[0]=e.slice(n+2))}else"/"===t[0][0]&&r.push("");const n=t.reduce((e,t)=>t?e.concat(t.split("/")):e,[]);for(let e=0;e<n.length;e++){const t=n[e];".."===t&&r.length>0&&".."!==r[r.length-1]?r.pop():(!t&&e===n.length-1||t&&("."!==t||0===r.length))&&r.push(t)}return r.join("/")}function Ah(e,t=!1){if(null==e||kh(e)||Th(e))return null;let r=e.indexOf("://");if(-1===r&&Oh(e))r=2;else{if(-1===r)return null;r+=3}const n=e.indexOf("/",r);return-1!==n&&(e=e.slice(0,n)),t&&(e=Ph(e,!0)),e}function Rh(e){return Oh(e)||Dh(e)}function kh(e){return null!=e&&"blob:"===e.slice(0,5)}function Th(e){return null!=e&&"data:"===e.slice(0,5)}function Ch(e){return function(e){const t=new Uint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return btoa(r)}(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}function Oh(e){return null!=e&&"/"===e[0]&&"/"===e[1]}function Dh(e){return null!=e&&Kd.test(e)}function jh(e){return Oh(e)?`https:${e}`:e.replace(Yd,"https:")}function xh(){return"https"===sh.scheme}function Ph(e,t=!1){return Oh(e)?e.slice(2):(e=e.replace(Kd,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function Nh(e,t,r){if(!(t&&r&&e&&Rh(e)))return e;const n=e.indexOf("//"),i=e.indexOf("/",n+2),s=e.indexOf(":",n+2),o=Math.min(i<0?e.length:i,s<0?e.length:s);return e.slice(n+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,n+2)}${r}${e.slice(o)}`}function Lh(e){return"string"==typeof e?new nh(_h(e)):(e.scheme||(e.scheme=sh.scheme),e)}function Uh(e,t){if(!t)return e;const r=ch(e),n=r.query||{};for(const[e,r]of Object.entries(t))null!=r&&(n[e]=r);const i=dh(n);return i?`${r.path}?${i}`:r.path}function Fh(e){if(null==e)return null;const t=e.match(Mh);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}const Mh=/([^.]*)\.([^/]*)$/;let $h;function Bh(e){$h=e}function Vh(e,t){var r;const n=null==(r=null==t?void 0:t.url)?void 0:r.path;if(e&&n&&(e=_h(e,n,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=Sh(e,t.portalItem.itemUrl);null!=r&&Gh.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return(e=Hh(e,null==t?void 0:t.portal))&&zh.test(e)?Jh(e):e}function qh(e,t,r=Yh.YES){var n,i;if(null==(e=e&&zh.test(e)?Kh(e):e))return e;!Rh(e)&&(null==t?void 0:t.blockedRelativeUrls)&&t.blockedRelativeUrls.push(e);let s=_h(e);if(t){const r=(null==(n=t.verifyItemRelativeUrls)?void 0:n.rootPath)||(null==(i=t.url)?void 0:i.path);if(r){const n=Hh(r,t.portal),i=Hh(s,t.portal);s=Sh(i,n,n),null!=s&&s!==i&&s!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(s)}}return s=Wh(s,null==t?void 0:t.portal),Rh(s)&&(s=Ih(s)),(null==t?void 0:t.resources)&&(null==t?void 0:t.portalItem)&&!Rh(s)&&!Th(s)&&r===Yh.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(s),compress:!1}),s}Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose")),oa("host-webworker")||globalThis.$arcgis||Object.defineProperty(globalThis,"$arcgis",{configurable:!1,enumerable:!0,writable:!1,value:{}}),oa("host-webworker");const zh=/\/items\/([^/]+)\/resources\/(.*)/,Gh=/^\.\/resources\//;function Wh(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Nh(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function Hh(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,n=lh();return yh(n,`${n.scheme}://${r}`)?Nh(e,t.portalHostname,r):Nh(e,r,t.portalHostname)}function Jh(e){if(!e)return e||null;let t=e;return t&&$h&&!$h.findCredential(t)&&(t=Gd(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}function Kh(e){if(!e)return e||null;let t=e;return t=t.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),t=t.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),t=t.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),t&&$h&&!$h.findCredential(t)&&(t=Gd(t)),t}var Yh;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(Yh||(Yh={})),Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return Yh},ensureMainOnlineDomain:Wh,fromCDNUrl:Kh,fromJSON:Vh,itemIdFromResourceUrl:function(e){const t=(null==e?void 0:e.match(zh))??null;return(null==t?void 0:t[1])??null},prefixAndFilenameFromResourceUrl:function(e){const t=(null==e?void 0:e.match(zh))??null;if(null==t)return null;const r=t[2],n=r.lastIndexOf("/");if(-1===n){const{path:e,extension:t}=Fh(r);return{prefix:null,filename:e,extension:t}}const{path:i,extension:s}=Fh(r.slice(n+1));return{prefix:r.slice(0,n),filename:i,extension:s}},read:function(e,t,r){return Vh(e,r)},toCDNUrl:Jh,toJSON:qh,write:function(e,t,r,n){const i=qh(e,n);void 0!==i&&(t[r]=i)}},Symbol.toStringTag,{value:"Module"}));const Zh=Object.values({mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"});function Xh(e){let t=Ah(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Zh.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${Zh.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i");const Qh=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function ep(e,t){return!(!Ja.apiKey||!function(e){const t=Ah(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!Qh.has(t)&&!e.endsWith("/sharing/rest/generateToken")}(e))}function tp(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const rp="Timeout exceeded";async function np(e,t){var n;e instanceof URL&&(e=e.toString()),(null==t?void 0:t.query)instanceof URLSearchParams&&(t.query=uh(t.query.toString().replaceAll("+"," ")));const i=Th(e),s=kh(e);s||i||(e=Ih(e));const o={url:e,requestOptions:{...t}},a=e=>({data:e,getAllHeaders:up,getHeader:up,httpStatus:200,requestOptions:o.requestOptions,url:o.url}),l=vh(e,sp.internalInterceptors);if(l){const e=await vp(l,o);if(null!=e)return a(e)}let c=vh(e);if(c){const e=await vp(c,o);if(null!=e)return a(e);c.after||c.error||(c=null)}if(e=o.url,"image"===(t=o.requestOptions).responseType&&(oa("host-webworker")||oa("host-node")))throw pp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),o);if("head"===t.method){if(t.body)throw pp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),o);if(i||s)throw pp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),o)}if(await async function(){oa("host-webworker")&&!ip&&(ip=await r.e("extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_request-CXsEkrhk_js").then(r.bind(r,54063)))}(),ip)return ip.execute(e,t);const u=new AbortController,d=ml(t,()=>u.abort()),h={controller:u,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:c,params:o,redoRequest:!1,useIdentity:sp.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},p=t.useRequestQueue?async function(e){const t=function(e){let t,r;return"string"==typeof e?(t=Ah(e,!0),r=Xh(e)):(t=e.origin,r=Xh(e.toString())),null==t?null:{origin:t,isHosted:r}}(e.params.url);if(!t)return bp(e);const{QueueProcessor:n}=await r.e("extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_QueueProcessor-BuLJKcsM_js").then(r.bind(r,53667)),i=wu(wp,t.origin,()=>{const e=t.isHosted?oa("request-queue-concurrency-hosted"):oa("request-queue-concurrency-non-hosted");return new n({concurrency:e,process:e=>{if(pl(e.params.requestOptions))throw pp("",dl("Request canceled"),e.params);return bp(e)}})});return i.push(e)}(h):bp(h),f=await p.finally(()=>null==d?void 0:d.remove());return null==(n=null==c?void 0:c.after)||n.call(c,f),f}let ip;const sp=Ja.request,op="FormData"in globalThis,ap=new Set([499,498,403,401]),lp=new Set(["COM_0056","COM_0057","SB_0008"]),cp=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],up=()=>null,dp=Symbol();function hp(e){const t=Ah(e);return!t||t.endsWith(".arcgis.com")||np._corsServers.includes(t)||wh(t)}function pp(e,t,r,n){let i="Error";const s={url:r.url,requestOptions:r.requestOptions,getAllHeaders:up,getHeader:up,ssl:!1};if(t instanceof rl)return t.details?(t.details=ua(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=s,t;if(t){const e=n&&(()=>Array.from(n.headers)),r=n&&(e=>n.headers.get(e)),o=null==n?void 0:n.status,a=t.message;a&&(i=a),e&&r&&(s.getAllHeaders=e,s.getHeader=r),s.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||o||0,s.subCode=t.subcode,s.messageCode=t.messageCode,"string"==typeof t.details?s.messages=[t.details]:s.messages=t.details,s.raw=dp in t?t[dp]:t}return vl(t)?dl():new rl(e,i,s)}async function fp(){$h||await r.e("vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_IdentityManager-5e96e2").then(r.bind(r,57892)).then(e=>e.I)}function mp(e){return cp.some(t=>t.test(e))}async function gp(e){let t=e.params.url;const r=e.params.requestOptions,n=e.fetchOptions??{},i=kh(t)||Th(t),s=r.responseType||"json",o=i?0:null!=r.timeout?r.timeout:sp.timeout;let a=!1;if(!i){e.useSSL&&(t=jh(t));let i={...r.query};e.credentialToken&&(i.token=e.credentialToken);let s=dh(i);oa("esri-url-encodes-apostrophe")&&(s=s.replaceAll("'","%27"));const o=t.length+1+s.length;let l;a="delete"===r.method||"post"===r.method||"put"===r.method||!!r.body||o>sp.maxUrlLength;const c=r.useProxy||!!gh(t);if(c){const e=hh(t);l=e.path,!a&&l.length+1+o>sp.maxUrlLength&&(a=!0),e.query&&(i={...e.query,...i})}if("HEAD"===n.method&&(a||c)){if(a){if(o>sp.maxUrlLength)throw pp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw pp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(c)throw pp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(n.method="delete"===r.method?"DELETE":"put"===r.method?"PUT":"POST",r.body?t=Uh(t,i):(n.body=dh(i),n.headers||(n.headers={}),n.headers["Content-Type"]="application/x-www-form-urlencoded")):t=Uh(t,i),c&&(e.useProxy=!0,t=`${l}?${t}`),i.token&&op&&n.body instanceof FormData&&!zd(t)&&n.body.set("token",i.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!yh(t,lh()))if(wh(t))e.withCredentials=!0;else if($h){const r=$h.findServerInfo(t);(null==r?void 0:r.webTierAuth)&&(e.withCredentials=!0)}e.withCredentials&&(n.credentials="include",function(e){const t=Ja.request.crossOriginNoCorsDomains;if(t){let r=Ah(e);if(r)return r=r.toLowerCase(),!yh(r,lh())&&t[r]<Date.now()-36e5}return!1}(t)&&await async function(e){var t;const r=ch(e);e=r.path,"json"===(null==(t=r.query)?void 0:t.f)&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}const n=Ja.request.crossOriginNoCorsDomains,i=Ah(e);n&&i&&(n[i.toLowerCase()]=Date.now())}(a?Uh(t,i):t))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,e.controller.abort()},o));try{if("native-request-init"===r.responseType)c=n,c.url=t,r.signal?c.signal=r.signal:delete c.signal;else if("image"!==r.responseType||"default"!==n.cache||"GET"!==n.method||a||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(r.headers)||!i&&!e.useProxy&&sp.proxyUrl&&!hp(t)){if(np._beforeFetch&&await np._beforeFetch(t,n),l=await fetch(t,n),np._afterFetch&&await np._afterFetch(l),e.useProxy||function(e){const t=Ah(e);t&&!np._corsServers.includes(t)&&np._corsServers.push(t)}(t),"native"===r.responseType)c=l;else if("HEAD"!==n.method)if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),"json"===s||"xml"===s||"document"===s)if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=yp(c,"application/xml");break;case"document":c=yp(c,"text/html")}else c=null;if(c){if("array-buffer"===s||"blob"===s){const e=l.headers.get("Content-Type");if(e&&/application\/json|text\/plain/i.test(e)&&c["blob"===s?"size":"byteLength"]<=750)try{const e=await new Response(c).json();e.error&&(c=e)}catch{}}"image"===s&&c instanceof Blob&&(c=await Sp(URL.createObjectURL(c),e,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Sp(t,e)}catch(n){if("AbortError"===n.name){if(d)throw new Error(rp);throw dl("Request canceled")}if(!(!l&&n instanceof TypeError&&sp.proxyUrl)||r.body||"delete"===r.method||"head"===r.method||"post"===r.method||"put"===r.method||e.useProxy||hp(t))throw n;e.redoRequest=!0,function(e){const t={proxyUrl:e.proxyUrl,urlPrefix:mh(e.urlPrefix)},r=Hd.proxyRules,n=t.urlPrefix;let i=r.length;for(let e=0;e<r.length;e++){const t=r[e].urlPrefix;if(0===n.indexOf(t)){if(n.length===t.length)return-1;i=e;break}0===t.indexOf(n)&&(i=e+1)}r.splice(i,0,t)}({proxyUrl:sp.proxyUrl,urlPrefix:Ah(t)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function vp(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,n;try{n=await e.before(t)}catch(e){r=pp("request:interceptor",e,t)}if((n instanceof Error||n instanceof rl)&&(r=pp("request:interceptor",n,t)),r)throw e.error&&e.error(r),r;return n}}function yp(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}np._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],np._beforeFetch=void 0,np._afterFetch=void 0;const wp=new Map;async function bp(e){var t,r;let n,i;await async function(e){var t;const r=e.params.url,n=e.params.requestOptions,i=e.controller.signal,s=n.body;let o=null,a=null;if(op&&"HTMLFormElement"in globalThis&&(s instanceof FormData?o=s:s instanceof HTMLFormElement&&(o=new FormData(s))),"string"==typeof s&&(a=s),e.fetchOptions={cache:n.cacheBust?"no-cache":"default",credentials:"same-origin",headers:n.headers||{},method:"head"===n.method?"HEAD":"GET",mode:"cors",priority:sp.priority,redirect:"follow",signal:i},(o||a)&&(e.fetchOptions.body=o||a),"anonymous"===n.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(r)||(null==(t=n.query)?void 0:t.token)||(null==o?void 0:o.get("token"))),!e.hasToken&&ep(r)&&(n.query||(n.query={}),n.query.token=Ja.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!mp(r)&&!pl(i)){let t;"immediate"===n.authMode?(await fp(),t=await $h.getCredential(r,{signal:i}),e.credential=t):"no-prompt"===n.authMode?(await fp(),t=await $h.getCredential(r,{prompt:!1,signal:i}).catch(()=>{}),e.credential=t):$h&&(t=$h.findCredential(r)),t&&(e.credentialToken=t.token,e.useSSL=!!t.ssl)}}(e);try{do{[n,i]=await gp(e)}while(!await _p(e,n,i))}catch(r){const i=pp("request:server",r,e.params,n);throw i.details.ssl=e.useSSL,(null==(t=e.interceptor)?void 0:t.error)&&e.interceptor.error(i),i}const s=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(s)){if(!e.hasToken&&!e.credentialToken&&(null==(r=i.user)?void 0:r.username)&&!wh(s)){const e=Ah(s,!0);e&&sp.trustedServers.push(e)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&function(e){Ja.request.crossOriginNoCorsDomains||(Ja.request.crossOriginNoCorsDomains={});const t=Ja.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[Ah(r)??""]=0:(t[Ah("http://"+r)??""]=0,t[Ah("https://"+r)??""]=0)}(i.authorizedCrossOriginNoCorsDomains)}const o=e.credential;if(o&&$h){const e=$h.findServerInfo(o.server);let t=null==e?void 0:e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=$h.findCredential(t,o.userId);e&&-1===$h._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:i,getAllHeaders:n?()=>Array.from(n.headers):up,getHeader:n?e=>n.headers.get(e):up,httpStatus:(null==n?void 0:n.status)??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function _p(e,t,r){var n;if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||"native"===i.responseType||"native-request-init"===i.responseType)return!0;let s,o;if(r&&(r.error&&"object"==typeof r.error?s=r.error:"error"===r.status&&Array.isArray(r.messages)&&(s={...r},s[dp]=r,s.details=r.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[dp]=r,s;let a,l=null;s&&(o=Number(s.code),l=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=null==a?void 0:a.toUpperCase());const c=i.authMode;if(403===o&&(4===l||(null==(n=s.message)?void 0:n.toLowerCase().includes("ssl"))&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===o)&&void 0!==o&&ap.has(o)&&!mp(e.params.url)&&(403!==o||(!a||!lp.has(a))&&(null==l||2===l&&e.credentialToken))){await fp();try{const t=await $h.getCredential(e.params.url,{error:pp("request:server",s,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===c)return e.credential=void 0,e.credentialToken=void 0,!1;s=t}}if(s)throw s;return!0}function Sp(e,t,r=!1){const n=t.controller.signal,i=new Image;return t.withCredentials?i.crossOrigin="use-credentials":i.crossOrigin="anonymous",i.alt="",i.fetchPriority=sp.priority,i.src=e,function(e,t,r=!1,n){return new Promise((i,s)=>{if(pl(n))return void s(tp());let o=()=>{c(),s(new Error(`Unable to load ${t}`))},a=()=>{const t=e;c(),i(t)},l=()=>{if(!e)return;const t=e;c(),t.src="",s(tp())};const c=()=>{oa("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,null!=n&&n.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};null!=n&&n.addEventListener("abort",l),oa("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}(i,e,r,n)}async function Ip(e,t,r,n){const i=t.exec(r);if(!i)throw new rl("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const s=i[1]?`${i[1]}/`:"",o=i[2],a=function(e){if(!Sl.test(e))return null;const t=Sl.exec(e);if(null===t)return null;const[,r,n]=t;return El(r+(n?"-"+n.toUpperCase():""))??El(r)}(n),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await Ep(e(c))}catch(t){if(c===l)throw new rl("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:t});try{u=await Ep(e(l))}catch(e){throw new rl("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:e})}}return u}async function Ep(e){if(null!=kp.fetchBundleAsset)return kp.fetchBundleAsset(e);const t=await np(e,{responseType:"text"});return JSON.parse(t.data)}class Ap{constructor({base:e="",pattern:t,location:r=new URL(window.location.href)}){let n;n="string"==typeof r?e=>new URL(e,new URL(r,window.location.href)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return Ip(this.getAssetUrl,this.matcher,e,t)}}function Rp(e){return new Ap(e)}const kp={};function Tp(e){if(!Ja.assetsPath)throw Qa.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new rl("assets:path-not-set","config.assetsPath is not set");return Eh(Ja.assetsPath,e)}Tl(Rp({pattern:"esri/",location:Tp}));(0,m.css)({label:"linkExplorerContent",width:"calc(100%-1px)"}),(0,m.css)({label:"documentListItem","&:hover, &:active":{textDecoration:"underline"}}),(0,m.css)({label:"documentTitle",fontWeight:"var(--calcite-font-weight-medium)"}),(0,m.css)({label:"documentDescription",color:"var(--calcite-ui-text-3)",fontSize:"var(--calcite-font-size--2\t)"})},79244:e=>{"use strict";e.exports=n}},c={};function u(e){var t=c[e];if(void 0!==t)return t.exports;var r=c[e]={exports:{}};return l[e](r,r.exports,u),r.exports}u.m=l,u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.f={},u.e=e=>Promise.all(Object.keys(u.f).reduce((t,r)=>(u.f[r](e,t),t),[])),u.u=e=>"extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_GeoBimIssuesExtension-h-51c80b"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_GeoBimIssuesExtension-h-51c80b.js":"extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_request-CXsEkrhk_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_request-CXsEkrhk_js.js":"vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_IdentityManager-5e96e2"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_IdentityManager-5e96e2.js":"extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_QueueProcessor-BuLJKcsM_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_QueueProcessor-BuLJKcsM_js.js":"vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_component-TYR5cS-i_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_component-TYR5cS-i_js.js":"vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_index-DkZ3-LH6_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_index-DkZ3-LH6_js.js":"vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_index-KugAaPfh_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_index-KugAaPfh_js.js":"vendors-extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_index-C5QRxkcF_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_index-C5QRxkcF_js.js":"extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_index-BYqwKOQd_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_index-BYqwKOQd_js.js":"extensions_widgets_shared-code_lib_geobim_node_modules_geobim_ui_dist_index-CRxkxqsO_js"===e?"widgets/shared-code/chunks/lib_geobim_node_modules_geobim_ui_dist_index-CRxkxqsO_js.js":void 0,u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="exb-client:",u.l=(r,n,i,s)=>{if(e[r])e[r].push(n);else{var o,a;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+i){o=d;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,u.nc&&o.setAttribute("nonce",u.nc),o.setAttribute("data-webpack",t+i),o.src=r),e[r]=[n];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(e=>e(n)),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),a&&document.head.appendChild(o)}},u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="",(()=>{var e={"widgets/shared-code/geobim":0};u.f.j=(t,r)=>{var n=u.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((r,i)=>n=e[t]=[r,i]);r.push(n[2]=i);var s=u.p+u.u(t),o=new Error;u.l(s,r=>{if(u.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,n[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var n,i,[s,o,a]=r,l=0;if(s.some(t=>0!==e[t])){for(n in o)u.o(o,n)&&(u.m[n]=o[n]);if(a)a(u)}for(t&&t(r);l<s.length;l++)i=s[l],u.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkexb_client=self.webpackChunkexb_client||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{APSDefaultModelViewerVersion:()=>Wo.av,ApsLogIn:()=>ae,ExBThemeSpacing:()=>Lo,FeatureServiceErrors:()=>pe,GeoBIMContext:()=>y,GeoBIMProvider:()=>b,GeoBIMStoreExtension:()=>ro,GeoBIMWidgetNames:()=>t,GeoBimFeatureServiceError:()=>i,HEADER_LINE_HEIGHT:()=>No,MapSelection:()=>oe,ModelViewer:()=>Wo.as,ModelViewerErrorCodes:()=>Wo.aw,ModelViewerProvider:()=>Wo.ar,ReactModelViewer:()=>Wo.au,UserTypeNotPermissible:()=>fe,apsAuthenticatedSelector:()=>no,apsErrorSelector:()=>io,areFeatureDocumentLinksEqual:()=>ee,areIDocumentsEqual:()=>Q,areModelViewerLinkedDocumentsEqual:()=>X,areRecordArraysEqual:()=>F,defaultSharedMessages:()=>e,geoBIMWidgetContainerStyle:()=>Fo,getAllFeatureServiceIds:()=>q,getFeatureAttribute:()=>O,getFeatureTitle:()=>C,getGeoBIMFeatureServiceError:()=>G,getLocation:()=>Go,getMapViewName:()=>z,hidableContainerStyle:()=>qo,inWidgetMessageContainerStyle:()=>$o,inWidgetMessageLinkStyle:()=>Bo,isBuildingSceneLayer:()=>R,isDocumentRepositoryItem:()=>Y,isNodeRepositoryItem:()=>K,loadingContainerStyle:()=>Vo,modelViewerDisabledSelector:()=>oo,modelViewerLinkedDocumentSelector:()=>so,repositoryItemHasChildren:()=>Z,selectionWarningStyle:()=>Uo,setModelViewerDisabled:()=>we,setModelViewerLinkedDocument:()=>ye,useApsAuth:()=>Ye,useDocuments:()=>Io,useGeoBIM:()=>Xe,useLinks:()=>wo,useMap:()=>rt,useModelViewer:()=>Wo.at,useMultipleSelectionWarning:()=>Po,useSessionManager:()=>fo,useSharedMessages:()=>Co,widgetHeaderStyle:()=>Mo});var e={};u.r(e),u.d(e,{default:()=>zo});var t,r,n,i,s,o=u(67386),a=u(79244),l=u(38512);!function(e){e.DOCUMENT_EXPLORER="document-explorer",e.DOCUMENT_VIEWER="document-viewer",e.LINK_EXPLORER="link-explorer"}(t||(t={})),function(e){e.FEATURE="Feature Layer",e.SCENE="Scene Layer"}(r||(r={})),function(e){e.FEATURE="feature"}(n||(n={})),function(e){e.NONE="NONE",e.NO_FEATURE_SERVICE="NO_FEATURE_SERVICE",e.MULTIPLE_FEATURE_SERVICES="MULTIPLE_FEATURE_SERVICES"}(i||(i={})),function(e){e.NO_FEATURE_SERVICE="NO_FEATURE_SERVICE",e.SINGLE_FEATURE_SERVICE="SINGLE_FEATURE_SERVICE",e.MULTIPLE_FEATURE_SERVICES="MULTIPLE_FEATURE_SERVICES"}(s||(s={}));var c=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useCallback:h,useState:p,createContext:f,useMemo:m,useEffect:g}=a.React,{useSelector:v}=a.ReactRedux,y=f(void 0),w=e=>{switch(null==e?void 0:e.featureServiceStatus){case s.MULTIPLE_FEATURE_SERVICES:return l.GeoBimFeatureServiceError.MULTIPLE_FEATURE_SERVICES;case s.NO_FEATURE_SERVICE:return l.GeoBimFeatureServiceError.NO_FEATURE_SERVICE;default:return l.GeoBimFeatureServiceError.NONE}};function b(e){const{mapWidgetId:t,widgetId:r,children:n,widgetState:i}=e,a=v(e=>(0,l.apsAuthenticatedSelector)(e)),[u,d]=p(null),f=null==u?void 0:u.id,[b,_]=p(new Map),S=m(()=>b.get(null!=f?f:""),[f,b]),[I,E]=p(!0),[A,R]=p(!1),[k,T]=p(!1),[C,O]=p([]),{isGeoBIMProjectService:D,sessionManagerInitialized:j,LinksService:x,GeoBIMDocumentService:P,DocumentsService:N,projectServiceLoading:L,projectServiceInitialized:U,isUserAuthorized:F}=(0,l.useSessionManager)(S),{apsLogin:M}=(0,l.useApsAuth)(),$=null!=t&&""!==t;null==t&&null!=u&&d(null);const B=h(e=>c(this,void 0,void 0,function*(){const t=yield(0,l.getAllFeatureServiceIds)(e),r=yield Promise.all(t.map(e=>c(this,void 0,void 0,function*(){return yield D(e)})));return t.filter((e,t)=>r[t])}),[D]);g(function(){let e=!1;const t=(e,t)=>{const r=1===t.length?t[0]:null,n=(e=>{switch(e.length){case 0:return s.NO_FEATURE_SERVICE;case 1:return s.SINGLE_FEATURE_SERVICE;default:return s.MULTIPLE_FEATURE_SERVICES}})(t);_(t=>new Map(t.set(e,{sessionId:e,featureServiceId:r,featureServiceStatus:n})))};return(()=>{c(this,void 0,void 0,function*(){if(j){if(null!=f&&null==S){E(!0);const r=yield B(u);if(e)return;t(f,r)}E(!1),R(!0)}else E(!0)})})(),()=>{e=!0}},[S,u,f,B,j]);const V=h(e=>{T(e)},[T]),q=h(e=>{(null==e?void 0:e.id)!==f&&(null!=f&&null==S&&E(!0),d(e))},[f,S]),z=h(e=>{O(e)},[O]),G=h(()=>{a||M()},[a,M]),W=m(()=>w(S),[S]),H=m(()=>L||I,[I,L]),J=m(()=>({selectionUpdating:k,geoBIMLoading:H,geoBIMInitialized:A,projectServiceInitialized:U,currentView:u,currentGeoBIMView:S,apsAuthenticated:a,geoBIMError:W,selectedFeatures:C,LinksService:x,GeoBIMDocumentService:P,DocumentsService:N,hasMapWidget:$,userHasPermission:F,onApsLogin:G,widgetState:i}),[k,H,A,U,u,S,a,W,C,x,P,N,$,F,G,i]);return(0,o.jsxs)(y.Provider,{value:J,children:[null!=t&&(0,o.jsx)(l.MapSelection,{mapWidgetId:t,widgetId:r,onSelectionUpdating:V,onActiveViewChange:q,onSelectionChange:z}),n]})}var _=u(62686);const S=["DisplayName","Title","Name"],I=["Name","FamilyType","Family","DocName"],E="DocName";function A(e,t,r){return e&&t?T(e)===T(t)&&(!r||a.lodash.isDeepEqual(e.attributes,t.attributes)):e===t}function R(e){return"building-scene"===e.type}function k(e){var t;const r=D(e);if(null==r)return null;if(L(r,"objectIdField"))return null!==(t=r.objectIdField)&&void 0!==t?t:null;return x(e.attributes,"objectId")}function T(e){const t=k(e),r=e.attributes;if(t){const e=r[t];return null!=e?e:null}return null}function C(e){if(null==e)return null;const t=function(e){const t=D(e);if(null==t)return null;if(R(t)&&L(t,"displayField")&&t.displayField===E)return null;if(L(t,"displayField")&&""!==t.displayField){const r=e.attributes[t.displayField];return null!=r?r:null}return null}(e);if(null!==t)return t;if(null==e.layer)return null;const r=R(e.layer)?I:S;for(const t of r){const r=O(e,t);if(null!=r&&""!==r)return r}return null}function O(e,t){return P(e.attributes,t)}function D(e){return null!=e.layer&&R(e.layer)&&"sourceLayer"in e&&null!=e.sourceLayer?e.sourceLayer:null!=e.layer?e.layer:null}function j(e){var t,r;const{layer:n}=e;if(null==n)return null;if(L(n,"portalItem")){return null!==(t=n.portalItem.id)&&void 0!==t?t:null}if(L(n,"url")){const e=n.url;return null!=e?e:null}if(L(n,"parent")&&null!=n.parent&&null!==P(n.parent,"portalItem")){return null!==(r=n.parent.portalItem.id)&&void 0!==r?r:null}return null}function x(e,t){const r=Object.keys(e).find(e=>e.toLowerCase()===t.toLowerCase());return null!=r?r:null}function P(e,t){const r=x(e,t);return null===r?null:N(e,r)?e[r]:null}function N(e,t){return t in e}function L(e,t){if(!N(e,t))return!1;return null!=e[t]}var U=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};function F(e,t){var r,n;if(null==e||null==t)return e===t;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const s=e[i],o=t[i];if((null===(r=s.dataSource)||void 0===r?void 0:r.id)!==(null===(n=o.dataSource)||void 0===n?void 0:n.id)||!A(s.feature,o.feature,!0))return!1}return!0}function M(e,t,r,i){return U(this,void 0,void 0,function*(){const s=yield function(e,t,r){return U(this,void 0,void 0,function*(){const i=yield e.whenAllJimuLayerViewLoaded(),s=Object.values(i).find(e=>{var i;if(e.type!==n.FEATURE)return!1;const s=e.layer;return s.layerId===t&&(null===(i=s.portalItem)||void 0===i?void 0:i.id)===r});return null!=s?s:null})}(e,r,i);if(null===s)return;const o=yield function(e){return U(this,void 0,void 0,function*(){let t;try{if(t=e.getLayerDataSource(),t||(t=yield e.createLayerDataSource()),!t)return null}catch(t){return console.warn(`Failed to get layer DataSource fo Layer View ${e.id}:`,t),null}return yield t.ready(),t})}(s);if(null===o)return;const a=yield o.queryById(t.toString());yield s.selectFeatureById(t,a),yield function(e,t){return U(this,void 0,void 0,function*(){const r=t.feature.geometry;null!=r&&"extent"in r&&null!=r.extent?yield _.zoomToUtils.zoomTo(e.view,r.extent,{}):console.warn("zoomToDataRecord - Feature has no geometry extent:",t)})}(e,a)})}var $=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const B=["Documents","Issues","Schedules","BIMProjects","Location Notes","Line Notes","Area Notes"],V=["Accounts","Links","Jobs"];function q(e){return $(this,void 0,void 0,function*(){if(null==e)return[];const t=new Set,r=e.jimuLayerViews;if(null==r)return[];const n=Object.values(r).filter(e=>J(e));for(const e of n){const r=yield e.createLayerDataSource();if(!r)continue;yield r.ready();const n=r.getLayerDefinition().serviceItemId;t.add(n)}return Array.from(t)})}function z(e){var t;const r=e.getMapDataSource();return null!==(t=null==r?void 0:r.getLabel())&&void 0!==t?t:""}function G(e){return $(this,void 0,void 0,function*(){const t=yield function(e){return $(this,void 0,void 0,function*(){const t=a.ServiceManager.getInstance(),r=new Set,n=yield e.whenAllJimuLayerViewLoaded();for(const e in n){const i=n[e];if(!J(i))continue;const s=i.layer.url;if(null==s)continue;const o=yield t.fetchServiceInfo(s);if(W(o)){const e=o.definition;r.add(e.serviceItemId)}}return r.size})}(e);switch(t){case 0:return i.NO_FEATURE_SERVICE;case 1:return i.NONE;default:return i.MULTIPLE_FEATURE_SERVICES}})}function W(e){var t,r;const n=e.definition,i=null===(t=n.layers)||void 0===t?void 0:t.map(e=>e.name),s=B.every(e=>{var t;return null!==(t=null==i?void 0:i.includes(e))&&void 0!==t&&t}),o=null===(r=n.tables)||void 0===r?void 0:r.map(e=>e.name),a=V.every(e=>{var t;return null!==(t=null==o?void 0:o.includes(e))&&void 0!==t&&t});return s&&a}function H(e){return J(e)}function J(e){return"feature"===e.type}function K(e){return null===e.document}function Y(e){return null!==e.document}function Z(e){return!Y(e)&&(null===e.children||e.children.length>0)}function X(e,t){var r,n,i,s,o,l;return null==e||null==t?e===t:(null===(r=e.document)||void 0===r?void 0:r.displayName)===(null===(n=t.document)||void 0===n?void 0:n.displayName)&&(null===(i=e.document)||void 0===i?void 0:i.fileName)===(null===(s=t.document)||void 0===s?void 0:s.fileName)&&(null===(o=e.document)||void 0===o?void 0:o.url)===(null===(l=t.document)||void 0===l?void 0:l.url)&&a.lodash.isDeepEqual(e.selectedIds,t.selectedIds)}function Q(e,t){return null==e||null==t?e===t:e.displayName===t.displayName&&e.fileName===t.fileName&&e.url===t.url&&a.lodash.isDeepEqual(e.attributes,t.attributes)}function ee(e,t){if(null==e||null==t)return e===t;if(r=e.feature,n=t.feature,!(null==r||null==n?r===n:r.objectId===n.objectId&&a.lodash.isDeepEqual(r.attributes,n.attributes)))return!1;var r,n;const i=e.documents,s=t.documents;if(i.length!==s.length)return!1;for(let e=0;e<i.length;e++){if(!Q(i[e],s[e]))return!1}return!0}var te=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useRef:re,useState:ne,useEffect:ie,useCallback:se}=a.React,oe=e=>{const{mapWidgetId:t,onSelectionUpdating:r,onSelectionChange:n,onActiveViewChange:i,widgetId:s}=e,[l,c]=ne(null),u=re(null),[d,h]=ne(null),[p,f]=ne(null),[m,g]=ne(null),[v,y]=ne(!1),w=re([]),b=se(e=>{F(w.current,e)||(w.current=e,n&&n(e))},[n]),S=se(e=>{var t;if(!(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id))return!1;const r=e.layer.id;return!(null==d?void 0:d.find(e=>e.includes(r.toString())))},[d]);ie(function(){let e=!1;return(()=>{te(this,void 0,void 0,function*(){const[t]=yield(0,_.loadArcGISJSAPIModules)(["esri/core/reactiveUtils"]);e||g(t)})})(),()=>{e=!0}},[]),ie(function(){let e=null,t=null,r=null;return(()=>{if(!m||!(null==l?void 0:l.view.popup)||!n||null===d)return;const i=l.view;null!=i.popup&&(e=m.watch(()=>{var e;return null===(e=i.popup)||void 0===e?void 0:e.selectedFeature},e=>{(e=>{if(!e||!S(e))return;b([{feature:e,dataSource:null}])})(e)}),t=m.when(()=>{var e;return null===(e=i.popup)||void 0===e?void 0:e.visible},()=>{null!=r&&(r.remove(),r=null),r=m.when(()=>{var e;return!(null===(e=i.popup)||void 0===e?void 0:e.visible)},()=>{b([])},{once:!0})}))})(),()=>{null!=e&&(e.remove(),e=null),null!=t&&(t.remove(),t=null),null!=r&&(r.remove(),r=null)}},[l,S,d,n,b,m]),ie(function(){r&&r(v)},[r,v]);const I=e=>te(void 0,void 0,void 0,function*(){var t;const r=null===(t=e.view.popup)||void 0===t?void 0:t.selectedFeature;if(r&&S(r)){return b([{feature:r,dataSource:null}]),void y(!1)}if(u.current=e.id,u.current!==e.id)return;const n=yield e.whenAllJimuLayerViewLoaded();if(u.current!==e.id)return;const i=Object.values(n).filter(e=>H(e)),s=[],o=e.getMapDataSource();if(!o)return b([]),void y(!1);yield o.ready(),o.areChildDataSourcesCreated()||(yield o.childDataSourcesReady());for(const t of i){yield t.ready();let r=t.getLayerDataSource();if(r||(r=yield t.createLayerDataSource()),!r)continue;if(yield r.ready(),u.current!==e.id)return;const n=r.getSelectedRecordIds();for(const t of n){const n=yield r.queryById(t);if(u.current!==e.id)return;if(n&&s.push(n),s.length>1)return b(s),void y(!1)}}b(s),y(!1)}),E=e=>te(void 0,void 0,void 0,function*(){const t=yield e.whenAllJimuLayerViewLoaded(),r=Object.values(t).filter(e=>H(e)),n=Object.values(r).map(e=>e.layerDataSourceId);h(n),f(e.dataSourceId)});return(0,o.jsx)(o.Fragment,{children:t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_.JimuMapViewComponent,{useMapWidgetId:t,onActiveViewChange:e=>{(e=>{te(void 0,void 0,void 0,function*(){if(!e)return c(null),h(null),void f(null);y(!0),b([]);const t=yield e.whenJimuMapViewLoaded();c(t),i&&i(t),n&&(yield I(t),yield E(t))})})(e)}}),(()=>{if(!l||!p||null==d||0===d.length)return[];return d.map(e=>{const t=(0,a.Immutable)({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:p});return(0,o.jsx)(a.DataSourceComponent,{widgetId:s,useDataSource:t,onSelectionChange:()=>{y(!0),I(l)}},e)})})()]})})},ae=e=>{const{theme:t,logInLinkText:r,loginMessageFirstLine:n,loginMessageSecondLine:i}=e,{onApsLogin:s}=(0,l.useGeoBIM)();return(0,o.jsx)("div",{css:(0,l.inWidgetMessageContainerStyle)(t),children:(0,o.jsxs)("p",{children:[(0,o.jsx)("a",{css:(0,l.inWidgetMessageLinkStyle)(t),href:"",target:"_blank",rel:"noopener noreferrer",onClick:e=>{e.preventDefault(),s()},children:r}),n,(0,o.jsx)("br",{}),i]})})};var le=u(14321),ce=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useState:ue,useCallback:de}=a.React,he=e=>(0,a.css)({label:"featureServiceErrorContainerStyle",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",gap:e.sys.spacing(l.ExBThemeSpacing.Two)}),pe=e=>{const{useMapWidgetIds:t,errorType:r,noFeatureServiceErrorText:n,multipleFeatureServicesErrorText:i,infoMessageText:s,theme:a}=e,[c,u]=ue(new Map),d=de(e=>ce(void 0,void 0,void 0,function*(){const t=new Map;for(const r in e){const n=e[r],i=(0,l.getMapViewName)(n),s=yield(0,l.getGeoBIMFeatureServiceError)(n);t.set(i,s)}u(t)}),[]);return(0,o.jsxs)("div",{css:he(a),children:[(0,o.jsx)(_.JimuMapViewComponent,{useMapWidgetId:t?t[0]:"",onViewsChange:e=>{d(e)}}),(()=>{const e=[...new Set(c.values())],t=[];return e.forEach(e=>{e===l.GeoBimFeatureServiceError.NO_FEATURE_SERVICE?t.push((0,o.jsx)(le.Alert,{fullWidth:!0,type:r,withIcon:!0,text:n},e)):e===l.GeoBimFeatureServiceError.MULTIPLE_FEATURE_SERVICES&&t.push((0,o.jsx)(le.Alert,{fullWidth:!0,type:r,withIcon:!0,text:i},e))}),t.length>0&&""!==s&&t.push((0,o.jsx)(le.Alert,{fullWidth:!0,type:"info",withIcon:!0,text:s},"info")),t})()]})},fe=e=>{const{theme:t,userTypeNotPermissibleLinkText:r,userTypeNotPermissibleText:n}=e;return(0,o.jsx)("div",{css:(0,l.inWidgetMessageContainerStyle)(t),children:(0,o.jsxs)("p",{children:[n,(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),(0,o.jsx)("a",{css:(0,l.inWidgetMessageLinkStyle)(t),href:"https://www.esri.com/en-us/arcgis/products/user-types/overview",target:"_blank",rel:"noopener noreferrer",children:r})]})})};var me;function ge(e,t){t({type:me.SetApsAuthenticated,payload:e})}function ve(e,t){t({type:me.SetApsError,payload:e})}function ye(e,t,r,n){const i={modelViewerWidgetId:e,document:t,selectedIds:r};n({type:me.SetModelViewerLinkedDocument,payload:i})}function we(e,t,r){const n={modelViewerWidgetId:e,disabled:t};r({type:me.SetModelViewerDisabled,payload:n})}!function(e){e.SetApsAuthenticated="SET_APS_AUTHENTICATED",e.SetApsError="SET_APS_ERROR",e.SetModelViewerLinkedDocument="SET_MODEL_VIEWER_LINKED_DOCUMENT",e.SetModelViewerDisabled="SET_MODEL_VIEWER_DISABLED"}(me||(me={}));var be=Object.defineProperty,_e=(e,t,r)=>((e,t,r)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);_e(class{constructor(){_e(this,"globalId"),_e(this,"objectId"),_e(this,"creationDate"),_e(this,"creator"),_e(this,"editDate"),_e(this,"editor")}},"fields",["globalId","objectId","creationDate","creator","editDate","editor"]);var Se=(e=>(e.INFO="info",e.WARNING="warning",e.DANGER="danger",e))(Se||{});class Ie extends Error{constructor(e){super(e.message),_e(this,"_message"),_e(this,"_severity"),_e(this,"_intl"),_e(this,"errorType","GeoBIM_Error"),this._message=e.message,this._severity=e.severity??"info",this._intl=e.intl}get message(){return this._message}get severity(){return this._severity}get intl(){return this._intl}}var Ee=(e=>(e.CODE="code",e.ERROR="error",e.ERROR_DESCRIPTION="error_description",e.STATE="state",e))(Ee||{}),Ae=(e=>(e.APS_LOGIN_WINDOW_EVENT="geobim-aps-login-window-event",e.APS_LOGIN_CALLBACK_EVENT="geobim-aps-login-callback-event",e))(Ae||{}),Re=Object.defineProperty,ke=(e,t,r)=>((e,t,r)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const Te={devext:{hosts:["devext.arcgis.com","localhost"],clientId:"Rbr9tlIpobcRuxEToJ9OVsuSSEtFSNaI"},qa:{hosts:["qaext.arcgis.com","mapsqa.arcgis.com"],clientId:"EMRsxdOAQA4Ha7XmM3Mbki7TufnCnGgC"},prod:{hosts:["arcgis.com"],clientId:"EpgT7BA0Ty2iOyOCy06RTRBlcESRA1c6"},portal:{hosts:["esri.com"],clientId:"fgl7ZH20xaY048WvBDGxXDfOId2FmlC4"}};var Ce=(e=>(e.APS_LOGIN_ABORTED="aps_login_aborted",e))(Ce||{});function Oe(e){return function(e){return null!=(null==e?void 0:e.accessToken)&&""!==(null==e?void 0:e.accessToken)&&null!=(null==e?void 0:e.refreshToken)&&""!==(null==e?void 0:e.refreshToken)&&null!=(null==e?void 0:e.accessTokenExpiry)&&""!==(null==e?void 0:e.accessTokenExpiry)}(e)||De(e)}function De(e){const t=null===(null==e?void 0:e.errorDescription)||"string"==typeof(null==e?void 0:e.errorDescription);return null!=(null==e?void 0:e.error)&&""!==(null==e?void 0:e.error)&&t}const je="Authorize";function xe(e){if(null==e)return{error:"GP Auth Service Error",errorDescription:"Auth Service did not respond"};const t=e.results.find(e=>"response"===e.paramName);if(void 0===t)return{error:"GP Auth Service Error",errorDescription:"APS Token Response not found"};const r=t.value;if(function(e){return null!=(null==e?void 0:e.exception)}(r))return{error:"GP Auth Service Exception",errorDescription:r.exception};const n=1e3*r.expires_in,i=Date.now()+n;return{accessToken:r.access_token,accessTokenExpiry:i.toString(),refreshToken:r.refresh_token,expiresInSeconds:r.expires_in}}class Pe{constructor(e,t,r){ke(this,"_portal"),ke(this,"_getToken"),ke(this,"_executeTask"),ke(this,"executeAuthTask",async(e,t,r)=>{await this._portal.load();const n=function(e){var t,r;const n=null==(r=null==(t=e.helperServices)?void 0:t.geoBIM)?void 0:r.authUrl;return null!=n?`${n}/${je}`:`${function(e){switch(!0){case e.endsWith("devext.arcgis.com"):case e.endsWith("devext.arcgis.com/"):return"https://geobimservicesdev.arcgis.com/arcgis/rest/services/";case e.endsWith("mapsqa.arcgis.com"):case e.endsWith("mapsqa.arcgis.com/"):case e.endsWith("qaext.arcgis.com"):case e.endsWith("qaext.arcgis.com/"):return"https://geobimservicesqa.arcgis.com/arcgis/rest/services/";default:return"https://geobimservices.arcgis.com/arcgis/rest/services/"}}(e.url)}GeoBIMAuth/GPServer/${je}`}(this._portal);if(null===n)return null;const i=await this._getToken();return null===i?null:await this._executeTask(n,i,e,t,r)}),this._portal=e,this._getToken=t,this._executeTask=r}}const Ne="geoBimApsLoginWindowActive",Le="true",Ue="geoBimApsToken";class Fe{constructor(e,t,r){ke(this,"_gpAuthService"),ke(this,"_loginWindow",null),ke(this,"_loginWindowPolling",null),ke(this,"_refreshTokenTask",null),ke(this,"_portalUrl",""),ke(this,"getAPSToken",async()=>{const e=this.getTokenFromStorage();if(null===e||De(e))return null;if(function(e){if(null==(null==e?void 0:e.accessTokenExpiry)||isNaN(parseInt(e.accessTokenExpiry)))return!1;const t=parseInt(e.accessTokenExpiry)-6e4,r=new Date;return new Date(t)>r}(e))return e;const t=await this.refreshTokenRequest(e.refreshToken);return null===t?(this.setAPSAuthError("Refresh Token Request Failed","User must be logged in to ArcGIS before logging in to Autodesk."),null):(this.saveTokenToStorage(t),De(t)?null:t)}),ke(this,"getToken",async()=>{var e;return(null==(e=await this.getAPSToken())?void 0:e.accessToken)??null}),ke(this,"onLoginWindowMessage",e=>{const t=new URL(this.getAPSRedirectUri());e.origin===t.origin&&(e=>{const t=Object.values(Ae);return null!=e&&"object"==typeof e&&t.includes(e.source)&&"string"==typeof e.message})(e.data)&&e.data.source===Ae.APS_LOGIN_CALLBACK_EVENT&&(window.removeEventListener("message",this.onLoginWindowMessage),this.parseLoginWindowMessage(e))}),this._portalUrl=e.url,this._gpAuthService=new Pe(e,t,r),this.closeAPSLoginWindow(),window.onbeforeunload=()=>{this.closeAPSLoginWindow()}}getAPSAuthError(){const e=this.getTokenFromStorage();return De(e)?e.error===Ce.APS_LOGIN_ABORTED?new Ie({message:e.errorDescription??"",severity:Se.WARNING}):new Ie({message:e.errorDescription??"",severity:Se.DANGER}):null}clearAPSAuthError(){De(this.getTokenFromStorage())&&this.removeTokenFromStorage()}async openAPSLoginWindow(){if(this.isLoginWindowActive())return void(null!==this._loginWindow&&!this._loginWindow.closed&&this._loginWindow.focus());this.setLoginWindowActive(!0),this.removeTokenFromStorage();const e=new URL("https://developer.api.autodesk.com/authentication/v2/authorize"),t=await this.getAPSClientId();null!==t?(e.searchParams.append("client_id",t),e.searchParams.append("response_type","code"),e.searchParams.append("redirect_uri",this.getAPSRedirectUri()),e.searchParams.append("state",window.location.origin),e.searchParams.append("scope","data:read data:write bucket:read account:read"),this._loginWindow=window.open(e,"_blank"),null!==this._loginWindow?(window.addEventListener("message",this.onLoginWindowMessage),this._loginWindowPolling=setInterval(()=>{(null===this._loginWindow||this._loginWindow.closed)&&this.onLoginWindowCloseEarly()},1e3)):(this.setAPSAuthError("Popup Blocker Active","Login window blocked by a popup blocker. Please allow popups on this site and try again."),this.setLoginWindowActive(!1))):this.setAPSAuthError("APS Client ID Error","Unable to resolve APS Client ID for your domain.")}async apsLogout(){this.closeAPSLoginWindow(),this.removeTokenFromStorage()}isLoginWindowActive(){return localStorage.getItem(Ne)===Le}getAPSRegionsInfoUrl(){return`${this._portalUrl}/apps/geobim/autodeskRegionsConfig.json`}async refreshTokenRequest(e){if(null!=this._refreshTokenTask)return await this._refreshTokenTask;this._refreshTokenTask=this.refreshToken(e);const t=await this._refreshTokenTask;return this._refreshTokenTask=null,t}async refreshToken(e){const t={params:{refresh_token:e}};return xe(await this._gpAuthService.executeAuthTask(t))}async parseLoginWindowMessage(e){const t=JSON.parse(e.data.message);if(void 0!==t[Ee.CODE]){const e=t[Ee.CODE];await this.getTokenFromCode(e)}else if(void 0!==t[Ee.ERROR]){const e=t[Ee.ERROR],r=void 0!==t[Ee.ERROR_DESCRIPTION]&&""!==t[Ee.ERROR_DESCRIPTION]?t[Ee.ERROR_DESCRIPTION]:null;this.setAPSAuthError(e,r)}this.closeAPSLoginWindow()}async getTokenFromCode(e){const t={params:{auth_code:e,redirect_uri:this.getAPSRedirectUri()}},r=xe(await this._gpAuthService.executeAuthTask(t));this.saveTokenToStorage(r)}clearLoginWindowPolling(){null!==this._loginWindowPolling&&(clearInterval(this._loginWindowPolling),this._loginWindowPolling=null)}closeAPSLoginWindow(){window.removeEventListener("message",this.onLoginWindowMessage),this.clearLoginWindowPolling(),null!==this._loginWindow&&(this._loginWindow.close(),this._loginWindow=null),this.setLoginWindowActive(!1)}async onLoginWindowCloseEarly(){window.removeEventListener("message",this.onLoginWindowMessage),this.clearLoginWindowPolling(),this.setLoginWindowActive(!1),this.setAPSAuthError(Ce.APS_LOGIN_ABORTED,"Window closed before login was completed.")}setLoginWindowActive(e){if(e===this.isLoginWindowActive())return;e?localStorage.setItem(Ne,Le):localStorage.setItem(Ne,"");const t=new BroadcastChannel(Ae.APS_LOGIN_WINDOW_EVENT),r={source:Ae.APS_LOGIN_WINDOW_EVENT,message:e.toString()};t.postMessage(r),t.close()}setAPSAuthError(e,t){const r={error:e,errorDescription:t};this.saveTokenToStorage(r)}getTokenFromStorage(){const e=localStorage.getItem(Ue);if(null===e)return null;let t;try{t=JSON.parse(e)}catch{return null}return Oe(t)?t:null}saveTokenToStorage(e){Oe(e)&&(localStorage.setItem(Ue,JSON.stringify(e)),window.dispatchEvent(new Event("storage")))}removeTokenFromStorage(){null!==localStorage.getItem(Ue)&&(localStorage.removeItem(Ue),window.dispatchEvent(new Event("storage")))}async getAPSClientId(){const e=new URLSearchParams(window.location.search).get("aps_client_id");if(null!=e&&""!==e)return e;try{const e=`${this._portalUrl}/apps/geobim/autodesk.json`,t=await fetch(e);if(null!=t&&t.ok){const e=await t.json();if(null!=(null==e?void 0:e.clientId))return e.clientId}}catch{}for(const e in Te){const t=Te[e].hosts,r=Te[e].clientId;for(const e of t)if(this._portalUrl.includes(e))return r}return null}getAPSRedirectUri(){return`${this._portalUrl}/apps/geobim/aps-auth/`}}var Me=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const $e=(e,t,...r)=>Me(void 0,[e,t,...r],void 0,function*(e,t,r={},n,i){const s=Object.assign(Object.assign({},r),{token:t}),[o]=yield(0,_.loadArcGISJSAPIModules)(["esri/rest/geoprocessor"]),a=o;return yield a.execute(e,s,n,i)});var Be=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ve{constructor(){this.getToken=()=>Promise.resolve(a.SessionManager.getInstance().getMainSession().token),void 0===Ve._initialized&&(Ve._initialized=new Promise(e=>{Ve._resolveInitialized=e}))}static getInstance(){return null===Ve._instance&&(Ve._instance=new Ve),Ve._instance}initialize(){return Be(this,void 0,void 0,function*(){if(!Ve._isInitialized&&!Ve._isInitializing){Ve._isInitializing=!0;const[e]=yield(0,a.loadArcGISJSAPIModules)(["esri/portal/Portal"]),t=new e({url:(0,a.getAppStore)().getState().portalUrl});Ve._ApsAuthService=new Fe(t,this.getToken,$e),Ve._isInitializing=!1,this.setInitialized()}return Ve._initialized})}getApsAuthService(){return Ve._ApsAuthService}setInitialized(){Ve._isInitialized||(Ve._isInitialized=!0,Ve._resolveInitialized())}}Ve._instance=null,Ve._isInitialized=!1,Ve._isInitializing=!1,Ve._ApsAuthService=null;var qe=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useCallback:ze,useEffect:Ge,useMemo:We,useState:He}=a.React,{useDispatch:Je}=a.ReactRedux,Ke="arcgis.com",Ye=()=>{const e=We(()=>Ve.getInstance(),[]),[t,r]=He(null),n=null!==t,i=Je();Ge(function(){let t=!1;return(()=>{qe(this,void 0,void 0,function*(){if(n)return;yield e.initialize();const i=e.getApsAuthService();t||null===i||r(i)})})(),()=>{t=!0}},[e,n,t]),Ge(function(){let e=!1;const r=()=>{if(!n)return;const e=t.getAPSAuthError();null!==e&&console.warn("APS Error:",e),ve(e,i)};return(()=>{qe(this,void 0,void 0,function*(){if(!n)return;const s=yield t.getToken();if(!e){ge(null!==s,i);ve(t.getAPSAuthError(),i),window.addEventListener("storage",r)}})})(),()=>{e=!0,window.removeEventListener("storage",r)}},[n,t,i]);const s=ze(()=>qe(void 0,void 0,void 0,function*(){if(!n)return null;ge(!1,i),yield t.openAPSLoginWindow(),yield new Promise(e=>{const t=new BroadcastChannel(Ae.APS_LOGIN_WINDOW_EVENT);t.onmessage=r=>{"false"===r.data.message&&(t.close(),e(!0))}});const e=yield t.getAPSToken();return ge(null!==e,i),e}),[n,t,i]),o=ze(()=>qe(void 0,void 0,void 0,function*(){n&&(yield t.apsLogout(),ge(!1,i))}),[n,t,i]),a=ze(()=>qe(void 0,void 0,void 0,function*(){if(!n)return null;const e=yield t.getAPSToken();return null!==e?(ge(!0,i),e):(ge(!1,i),yield s())}),[n,t,s,i]),c=ze(()=>{if(n){const e=(0,l.getLocation)().hostname;return e===Ke||(null==e?void 0:e.endsWith(`.${Ke}`))||"localhost"===e||console.log("Default region info being used for Enterprise deployment."),null}return null},[n]),u=ze(()=>{n&&t.clearAPSAuthError()},[n,t]);return We(()=>({apsLogin:s,apsLogout:o,getApsAuthToken:a,getApsRegionsInfoUrl:c,userClearApsError:u,apsAuthLoaded:n}),[n,s,o,a,c,u])},{useContext:Ze}=a.React,Xe=()=>{const e=Ze(y);if(void 0===e)throw new Error("useGeoBIM must be used within a GeoBIMProvider");return e};var Qe=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useCallback:et,useMemo:tt}=a.React,rt=()=>{const{currentView:e}=Xe(),t=et((t,r,n)=>Qe(void 0,void 0,void 0,function*(){null!==e&&(yield M(e,t,r,n))}),[e]);return tt(()=>({zoomToFeature:t}),[t])};var nt=Object.defineProperty,it=(e,t,r)=>((e,t,r)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const st=["Documents","Issues","Schedules","BIMProjects","Location Notes","Line Notes","Area Notes"],ot=["Accounts","Links","Jobs"],at=["Location Notes","Line Notes","Area Notes"];class lt{constructor(e,t){it(this,"documentRepository"),it(this,"projectDataService"),it(this,"getDocument",async e=>{const t=this.documentRepository.getGeoBIMDocumentProps(e);return null==t?null:await(await this.projectDataService.documentDataService()).getDocument(t)}),it(this,"getLayer",async()=>(await this.projectDataService.documentDataService()).layer),this.documentRepository=e,this.projectDataService=t}}const ct=async(e,t)=>{let r=[];for(let n=0;n<t.length;n++){const i=t[n];if("BIM360"===i.linkType){const t=await ut(e,i.linkDefinition);r=r.concat(t)}}return r},ut=async(e,t)=>{const r=[],n=JSON.parse(t);for(let t=0;t<n.documentIds.length;t++){const i={projectId:n.projectId,itemId:n.documentIds[t].urn},s=await e.getDocument(i);null!=s&&r.push(s)}return r};function dt(e,t){if((null==e?void 0:e.length)>0&&null!=t)return e.find(e=>e.toLowerCase()===t.toLowerCase())}class ht{constructor(){it(this,"globalId"),it(this,"objectId"),it(this,"creationDate"),it(this,"creator"),it(this,"editDate"),it(this,"editor")}}it(ht,"fields",["globalId","objectId","creationDate","creator","editDate","editor"]);var pt=(e=>(e.BIM360="BIM360",e.URL="URL",e.LINKRULE="LINKRULE",e.LINKACCOUNT="LINKACCOUNT",e))(pt||{});var ft=(e=>(e.ViewerUrl="ViewerUrl",e.BIMDocument="BIMDocument",e.DocumentName="DocumentName",e.ScheduleFeature="ScheduleFeature",e.Custom="Custom",e))(ft||{});const mt=async(e,t,r)=>{let n=[],i=null;const s=vt(t);gt(r,t,s);for(let o=0;o<r.length;o++){const a=r[o];if(a.linkType===pt.LINKRULE){const r=await _t(e,t,a.linkDefinition);if(0===r.length)continue;wt(a,s)?null===i&&(i=r[0]):bt(a)&&(i=r[0]),n=n.concat(r)}null!==i&&(i.isDefault=!0)}return n},gt=(e,t,r)=>{if(null===r||yt(e,r))return;const n=JSON.stringify({rule:`${ft.ViewerUrl}({"viewerUrl":"$${r}"})`}),i={linkType:pt.LINKRULE,linkDefinition:n,itemId:t.layer.portalItemId,layerId:t.layer.layerId};e.push(i)},vt=e=>null==(null==e?void 0:e.attributes)?null:Object.keys(e.attributes).find(e=>e.toLowerCase()==="SharedView".toLowerCase())??null,yt=(e,t)=>{for(let r=0;r<e.length;r++){const n=e[r];if(wt(n,t))return!0}return!1},wt=(e,t)=>{if(null===t)return!1;if(e.linkType===pt.LINKRULE){const r=JSON.parse(e.linkDefinition);if(Et(r.rule)===ft.ViewerUrl&&r.rule.includes(t))return!0}return!1},bt=e=>{if(e.linkType===pt.LINKRULE){const t=JSON.parse(e.linkDefinition);if(Et(t.rule)===ft.BIMDocument)return!0}return!1},_t=async(e,t,r)=>{const n=JSON.parse(r),i=Et(n.rule),s=At(n.rule);return i===ft.ScheduleFeature?(console.warn("LinkRuleName.ScheduleFeature is not currently supported in this release."),[]):await St(e,s,t,i)},St=async(e,t,r,n)=>{const i=JSON.parse(t);if(n===ft.ViewerUrl&&"string"==typeof i)return await It(e,r,i);const s={};return Object.keys(i).forEach(e=>{const t=Rt(r,i[e]);null!==t&&(s[e]=t)}),Object.keys(s).length===Object.keys(i).length?await e.getDocumentByRule(n,s):[]},It=async(e,t,r)=>{const n={},i=Rt(t,r);return n.viewerUrl=i,await e.getDocumentByRule(ft.ViewerUrl,n)},Et=e=>e.split(/[()]/)[0],At=e=>{const t=e.split(/[()]/);return t.length>1?t[1]:""},Rt=(e,t)=>{if("string"!=typeof t||(e=>"$"!==(null==e?void 0:e.substring(0,1)))(t))return t;const r=(e=>"$"===(null==e?void 0:e.substring(0,1))?null==e?void 0:e.substring(1):"")(t);return 0===r.length?null:((e,t)=>Object.prototype.hasOwnProperty.call(e.attributes,t))(e,r)?e.attributes[r]:null},kt=async(e,t,r)=>{if(!Tt(r)||null==r.geometry)return[];const n=await t.getDocumentsByIntersection(r);return await Ct(e,n)},Tt=e=>void 0!==e.layer&&void 0!==at.find(t=>{var r;return null==(r=e.layer.title)?void 0:r.startsWith(t)}),Ct=async(e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(void 0===i.projectId||void 0===i.itemId)continue;const s={projectId:i.projectId,itemId:i.itemId},o=await e.getDocument(s);null!=o&&r.push(o)}return r};class Ot extends ht{constructor(e){super(),it(this,"issueGUID"),it(this,"projectId"),it(this,"project"),it(this,"itemId"),it(this,"id"),it(this,"identifier"),it(this,"status"),it(this,"type"),it(this,"subType"),it(this,"createdAt"),it(this,"syncedAt"),it(this,"updatedAt"),it(this,"title"),it(this,"location"),it(this,"assignedTo"),it(this,"company"),it(this,"dueDate"),it(this,"linkedDocument"),it(this,"rootCause"),it(this,"owner"),it(this,"description"),it(this,"locationDescription"),it(this,"documentId"),it(this,"fields",ht.fields.concat(["issueGUID","projectId","project","itemId","id","identifier","status","type","subType","createdAt","syncedAt","updatedAt","title","location","assignedTo","company","dueDate","linkedDocument","rootCause","description","locationDescription","owner","documentId","AutodeskType"]));const t=Object.keys(e.attributes);for(const r in this){const n=dt(t,r);void 0!==n&&(this[r]=e.attributes[n])}}}class Dt{constructor(e,t){it(this,"documentRepositoryService"),it(this,"projectDataService"),it(this,"getLinks",async e=>null!=this.projectDataService?await this.getLinksFromProject(e):await this.getLinksWithNoProject(e)),it(this,"getLinksWithNoProject",async e=>({feature:e,documents:await mt(this.documentRepositoryService,e,[])})),it(this,"getLinksFromProject",async e=>{if(null==this.projectDataService)throw new Error("GeoBIM Project feature services not available");const t=await(await this.projectDataService.linkDataService()).getLinkRecords(e.layer.portalItemId,e.layer.layerId,e.objectId),r=await this.projectDataService.documentDataService(),n=[...await ct(this.documentRepositoryService,t),...await mt(this.documentRepositoryService,e,t),...await kt(this.documentRepositoryService,r,e)].filter((e,t,r)=>!this.isDuplicateLink(e,t,r));return{feature:e,documents:await this.addRelatedBIMIssuesToDocument(e,n)}}),it(this,"addRelatedBIMIssuesToDocument",async(e,t)=>{var r;if(!await(null==(r=this.projectDataService)?void 0:r.isIssueFeature(e.layer)))return t;const n=new Ot(e),{id:i,itemId:s,projectId:o}=n;if(null==i||null==s||null==o)return t;const a=[];for(const e of t)a.push({...e,issue:await this.getLinkedBimIssue(e,n)});return a}),it(this,"getLinkedBimIssue",async(e,t)=>{const{id:r,itemId:n,projectId:i}=t;if(void 0!==r&&void 0!==n&&void 0!==i&&this.documentRepositoryService.isDocumentIssue(n,e))return await this.documentRepositoryService.getIssue(i,r)??void 0}),it(this,"isDuplicateLink",(e,t,r)=>t!==r.findIndex(t=>t.url===e.url)),it(this,"addLinks",async e=>{if(null==this.projectDataService)throw new Error("Cannot add link: GeoBIM Project feature service not available");const t=e.feature;if(!(t.objectId>0&&t.layer.portalItemId.length>0&&t.layer.layerId>=0&&e.documents.length>0))throw new Error("Invalid parameters");await(await this.projectDataService.linkDataService()).addLinks(e)}),this.documentRepositoryService=e,this.projectDataService=t}}class jt{constructor(e){it(this,"projectDataService"),it(this,"getAccounts",async(e,t)=>await(await this.projectDataService.accountDataService()).getAccountRecords(e,t)),it(this,"getAccountFilter",async(e,t)=>{var r;const n=await this.getAccounts(e,t);return null==n||0===n.length?null:(null==(r=n[0])?void 0:r.connectionInfo)??null}),this.projectDataService=e}}class xt{constructor(e,t,r){it(this,"documentsService"),it(this,"projectDataService"),it(this,"_accountCoreService"),it(this,"_linkCoreService"),it(this,"_geoBIMDocumentService"),it(this,"_projectServiceId"),it(this,"getLayerById",async e=>null==this.projectDataService?null:await this.projectDataService.getLayer(e)),it(this,"setAccountFilterOnDataService",async()=>{if(null==this.documentsService)return;if(null==this.accountCoreService)return void this.documentsService.setAccountFilter(null);const e=await this.accountCoreService.getAccountFilter(this.documentsService.getProviderName());this.documentsService.setAccountFilter(e)}),this.projectDataService=e,this.documentsService=t,this._projectServiceId=r}get projectServiceId(){return this._projectServiceId}get accountCoreService(){return null==this.projectDataService?null:(null==this._accountCoreService&&(this._accountCoreService=new jt(this.projectDataService)),this._accountCoreService)}get linkCoreService(){return null==this._linkCoreService&&(this._linkCoreService=new Dt(this.documentsService,this.projectDataService)),this._linkCoreService}get geoBIMDocumentService(){return null==this.projectDataService?null:(null==this._geoBIMDocumentService&&(this._geoBIMDocumentService=new lt(this.documentsService,this.projectDataService)),this._geoBIMDocumentService)}}class Pt{constructor(e){it(this,"_documentsService"),it(this,"getDocument",async e=>await this._documentsService.getDocument(e)),it(this,"checkPermissions",async e=>await this._documentsService.checkPermissions(e)),it(this,"getRepositoryItems",async e=>await this._documentsService.getRepositoryItems(e)),it(this,"searchRepository",async(e,t)=>await this._documentsService.searchRepository(e,t)),this._documentsService=e}}class Nt{constructor(e){it(this,"documentDataRepository"),it(this,"arcGISDataService"),it(this,"_projectCoreServices",{}),it(this,"_documentDataCoreService"),it(this,"getProjectCoreService",async e=>{const t=e??"noGeoBIMProjectServiceId";if(void 0===this._projectCoreServices[t]){const r=await this.createProjectCoreService(e??null,this.arcGISDataService,this.documentDataRepository);this._projectCoreServices[t]=r}const r=this._projectCoreServices[t];return await r.setAccountFilterOnDataService(),r}),it(this,"createProjectCoreService",async(e,t,r)=>{await t.load();const n=null!=e?t.projectDataService(e):null;return new xt(n,r,e)}),it(this,"initializeDataServices",e=>new Pt(e)),it(this,"selectFeature",async e=>{const t=e.layerId??0,r=void 0===this._projectCoreServices[e.serviceId]?await this.arcGISDataService.getLayer(e.serviceId,t):await this._projectCoreServices[e.serviceId].getLayerById(t);return null==r?null:await this.arcGISDataService.getFeature(r,e.objectId)}),it(this,"getFeatureService",async e=>await this.arcGISDataService.getFeatureService(e)),it(this,"isProjectService",e=>{const t=e.layers.map(e=>e.title),r=st.every(e=>t.includes(e)),n=e.tables.map(e=>e.title),i=ot.every(e=>n.includes(e));return r&&i}),this.documentDataRepository=e.documentDataService,this.arcGISDataService=e.arcGISDataService,this._documentDataCoreService=this.initializeDataServices(this.documentDataRepository)}get projectServiceIds(){return Object.keys(this._projectCoreServices)}get documentDataCoreService(){return this._documentDataCoreService}}const Lt="GeoBIM_Error";var Ut=(e=>(e.INFO="info",e.WARNING="warning",e.DANGER="danger",e))(Ut||{});class Ft extends Error{constructor(e){super(e.message),it(this,"_message"),it(this,"_severity"),it(this,"_intl"),it(this,"errorType",Lt),this._message=e.message,this._severity=e.severity??"info",this._intl=e.intl}get message(){return this._message}get severity(){return this._severity}get intl(){return this._intl}}function Mt(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function $t(e){return Object.keys(e).some(t=>{let r=e[t];if(!r)return!1;r&&r.toParam&&(r=r.toParam());switch(r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function Bt(e){const t={};return Object.keys(e).forEach(r=>{var n,i;let s=e[r];if(s&&s.toParam&&(s=s.toParam()),!s&&0!==s&&"boolean"!=typeof s&&"string"!=typeof s)return;let o;switch(s.constructor.name){case"Array":const e=null===(i=null===(n=s[0])||void 0===n?void 0:n.constructor)||void 0===i?void 0:i.name;o="Array"===e?s:"Object"===e?JSON.stringify(s):s.join(",");break;case"Object":o=JSON.stringify(s);break;case"Date":o=s.valueOf();break;case"Function":o=null;break;case"Boolean":o=s+"";break;default:o=s}(o||0===o||"string"==typeof o||Array.isArray(o))&&(t[r]=o)}),t}function Vt(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map(t=>Vt(e,t)).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function qt(e){const t=Bt(e);return Object.keys(t).map(e=>Vt(e,t[e])).join("&")}const zt=globalThis.FormData;globalThis.File,globalThis.Blob;class Gt extends Error{constructor(e,t,r,n,i){super(e);const s=new.target.prototype;Object.setPrototypeOf(this,s),e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=i}}const Wt={noCorsDomains:[],crossOriginNoCorsDomains:{},pendingNoCorsRequests:{}},Ht="ARCGIS_REST_JS_NO_CORS";globalThis[Ht]||(globalThis[Ht]=Object.assign({},Wt));const Jt=globalThis[Ht];function Kt(e){const t=new URL(e).origin;-1===Jt.noCorsDomains.indexOf(t)&&Jt.noCorsDomains.push(t)}function Yt(e){let t=!1;if(Jt.noCorsDomains.length){const r=new URL(e).origin.toLowerCase();t=Jt.noCorsDomains.some(e=>r.includes(e))}return t}const Zt="@esri/arcgis-rest-js";class Xt extends Gt{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",r,n,i){super(e,t,r,n,i),this.name="ArcGISAuthError",this.message="AUTHENTICATION_ERROR_CODE"===t?e:`${t}: ${e}`;const s=new.target.prototype;Object.setPrototypeOf(this,s)}retry(e,t=1){let r=0;const n=(i,s)=>{r+=1,e(this.url,this.options).then(e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return Qt(this.url,t)}).then(e=>{i(e)}).catch(e=>{"ArcGISAuthError"===e.name&&r<t?n(i,s):e.name===this.name&&e.message===this.message&&r>=t?s(this):s(e)})};return new Promise((e,t)=>{n(e,t)})}}function Qt(e,t){const r=globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}},n=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},r),t),{params:Object.assign(Object.assign({},r.params),t.params),headers:Object.assign(Object.assign({},r.headers),t.headers)}),{httpMethod:i,rawResponse:s}=n,o=Object.assign({f:"json"},n.params);let a=null;const l={method:i,signal:n.signal,credentials:n.credentials||"same-origin"};let c;if(Yt(e)&&(l.credentials="include"),n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(l.credentials="include"),"string"==typeof n.authentication){const e=n.authentication;c={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)},n.authentication.startsWith("AAPK")||n.authentication.startsWith("AAPT")||n.authentication.startsWith("AATK")||n.authentication.startsWith("AAST")||n.suppressWarnings||globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING||(u="Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.",console&&console.warn&&console.warn.apply(console,[u]),globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=!0)}else c=n.authentication;var u;const d=e;let h=!1;"undefined"!=typeof window&&(h=function(e,t){var r;if((t||window)&&e){const n=null===(r=(t=t||window).location)||void 0===r?void 0:r.origin;return e.startsWith(n)}return!1}(e));const p=!h&&function(e){let t=!1;if(Yt(e)){const r=new URL(e).origin.toLowerCase(),n=Jt.crossOriginNoCorsDomains[r]||0;Date.now()-36e5>n&&(t=!0)}return t}(e);n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(l.credentials="include");let f=Promise.resolve();return p&&(l.credentials="include",f=function(e){const t=new URL(e);e=t.origin+t.pathname,t.search.includes("f=json")&&(e+="?f=json");const r=t.origin;return Jt.pendingNoCorsRequests[r]||(Jt.pendingNoCorsRequests[r]=fetch(e,{mode:"no-cors",credentials:"include",cache:"no-store"}).then(e=>{-1===Jt.noCorsDomains.indexOf(r)&&Jt.noCorsDomains.push(r),Jt.crossOriginNoCorsDomains[r.toLowerCase()]=Date.now(),delete Jt.pendingNoCorsRequests[r]}).catch(e=>(delete Jt.pendingNoCorsRequests[r],Promise.reject(new Error(`no-cors request to ${r} failed`))))),Jt.pendingNoCorsRequests[r]}(e)),f.then(()=>c?c.getToken(e).catch(t=>(t.url=e,t.options=n,a=t,Promise.resolve(""))):Promise.resolve("")).then(t=>{t.length&&(o.token=t),c&&c.getDomainCredentials&&(l.credentials=c.getDomainCredentials(e));const r={};if("GET"===l.method){o.token&&n.hideToken&&"undefined"==typeof window&&(r["X-Esri-Authorization"]=`Bearer ${o.token}`,delete o.token);const i=""===qt(o)?e:e+"?"+qt(o);n.maxUrlLength&&i.length>n.maxUrlLength||!n.maxUrlLength&&i.length>2e3||o.token&&n.hideToken?(l.method="POST",t.length&&n.hideToken&&(o.token=t,delete r["X-Esri-Authorization"])):e=i}const i=new RegExp("/items/.+/updateResources").test(e);return"POST"===l.method&&(l.body=function(e,t){const r=$t(e)||t,n=Bt(e);if(r){const e=new zt;return Object.keys(n).forEach(t=>{if("undefined"!=typeof Blob&&n[t]instanceof Blob){const r=n.fileName||n[t].name||t;e.append(t,n[t],r)}else e.append(t,n[t])}),e}return qt(e)}(o,i)),l.headers=Object.assign(Object.assign({},r),n.headers),("undefined"==typeof window||window&&void 0===window.document)&&!l.headers.referer&&(l.headers.referer=Zt),$t(o)||i||(l.headers["Content-Type"]="application/x-www-form-urlencoded"),globalThis.fetch?globalThis.fetch(e,l):Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.Request}).then(({fetch:t})=>t(e,l))}).then(t=>{if(!t.ok)return t.json().then(r=>{const{status:i,statusText:s}=t,{message:o,details:a}=r.error,l=`${o}. ${a?a.join(" "):""}`.trim();throw new Gt(l,`HTTP ${i} ${s}`,r,e,n)}).catch(r=>{if("ArcGISRequestError"===r.name)throw r;const{status:i,statusText:s}=t;throw new Gt(s,`HTTP ${i}`,t,e,n)});if(s)return t;switch(o.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}}).then(t=>{if("json"!==o.f&&"geojson"!==o.f||s)return t;{const r=function(e,t,r,n,i){if(e.code>=400){const{message:r,code:i}=e;throw new Gt(r,i,e,t,n)}if(e.error){const{message:r,code:s,messageCode:o}=e.error,a=o||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s)throw i||new Xt(r,a,e,t,n);throw new Gt(r,a,e,t,n)}if("failed"===e.status||"failure"===e.status){let r,i="UNKNOWN_ERROR_CODE";try{r=JSON.parse(e.statusMessage).message,i=JSON.parse(e.statusMessage).code}catch(t){r=e.statusMessage||e.message}throw new Gt(r,i,e,t,n)}return e}(t,d,0,n,a);if(t&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(e)&&Array.isArray(t.authorizedCrossOriginNoCorsDomains)&&t.authorizedCrossOriginNoCorsDomains.forEach(e=>{e=e.toLowerCase(),/^https?:\/\//.test(e)?Kt(e):(Kt("http://"+e),Kt("https://"+e))}),a){const t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+864e5)},a=null}return r}})}function er(e,t={params:{f:"json"}}){const{request:r}=t,n=Mt(t,["request"]);return r?r(e,n):Qt(e,n).catch(e=>e instanceof Xt&&t.authentication&&"string"!=typeof t.authentication&&t.authentication.canRefresh&&t.authentication.refreshCredentials?e.retry(()=>t.authentication.refreshCredentials(),1):Promise.reject(e))}var tr,rr;!function(e){e.TOKEN_REFRESH_FAILED="TOKEN_REFRESH_FAILED",e.GENERATE_TOKEN_FOR_SERVER_FAILED="GENERATE_TOKEN_FOR_SERVER_FAILED",e.REFRESH_TOKEN_EXCHANGE_FAILED="REFRESH_TOKEN_EXCHANGE_FAILED",e.NOT_FEDERATED="NOT_FEDERATED",e.UNKNOWN_ERROR_CODE="UNKNOWN_ERROR_CODE"}(tr||(tr={}));class nr extends Error{constructor(e="UNKNOWN_ERROR",t=tr.UNKNOWN_ERROR_CODE,r,n,i){super(e);const s=new.target.prototype;Object.setPrototypeOf(this,s),this.name="ArcGISTokenRequestError",this.message=`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=i}}class ir extends Error{constructor(){super("The user has denied your authorization request.");const e=new.target.prototype;Object.setPrototypeOf(this,e),this.name="ArcGISAccessDeniedError"}}Error;function sr(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError",e.ArcGISAccessDeniedError="ArcGISAccessDeniedError",e.ArcGISTokenRequestError="ArcGISTokenRequestError"}(rr||(rr={}));const or=3e5;function ar(e,t){const r=t;return r.rawResponse=!1,er(e,r).then(e=>{if("token"in e&&"expires"in e)return{token:e.token,username:t.params.username,expires:new Date(e.expires)};const r={token:e.access_token,username:e.username,expires:new Date(Date.now()+1e3*e.expires_in-or),ssl:!0===e.ssl};return e.refresh_token&&(r.refreshToken=e.refresh_token),e.refresh_token_expires_in&&(r.refreshTokenExpires=new Date(Date.now()+1e3*e.refresh_token_expires_in-or)),r})}class lr{constructor(e){this.portal=e.portal?sr(e.portal):"https://www.arcgis.com/sharing/rest",this._username=e.username}get username(){return this._username?this._username:this._user&&this._user.username?this._user.username:void 0}getUsername(){return this.username?Promise.resolve(this.username):this.getUser().then(e=>e.username)}getUser(e){if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);{const t=`${this.portal}/community/self`,r=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=er(t,r).then(e=>(this._user=e,this._pendingUserRequest=null,e)),this._pendingUserRequest}}clearCachedUserInfo(){this._user=null}}function cr(e){return!e||e.length<=0?{}:e.replace(/^#/,"").replace(/^\?/,"").split("&").reduce((e,t)=>{const{key:r,value:n}=function(e){const[t,r]=e.split("=");return{key:decodeURIComponent(t),value:decodeURIComponent(r)}}(t);return e[r]=n,e},{})}const ur=/^https?:\/\/(\S+)\.arcgis\.com.+/;function dr(e){return ur.test(e)}function hr(e){if(!ur.test(e))return null;const t=e.match(ur)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function pr(e,t){const r=sr(function(e){if(!ur.test(e))return e;switch(hr(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=sr(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(r)}function fr(e,t=window){return!t&&window&&(t=window),t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function mr(e){!e&&window&&(e=window);return fr(e.crypto.getRandomValues(new Uint8Array(32)))}function gr(e,t,r){return"string"!=typeof t&&t?JSON.stringify(Object.assign({id:e},t)):JSON.stringify({id:e,originalUrl:r})}class vr extends lr{constructor(e){if(super(e),this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?sr(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.server=e.server,this.referer=e.referer,this.state=e.state,this.federatedServers={},this.trustedDomains=[],e.server){const t=this.getServerRootUrl(e.server);this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}get token(){return this._token}get tokenExpires(){return this._tokenExpires}get refreshToken(){return this._refreshToken}get refreshTokenExpires(){return this._refreshTokenExpires}get canRefresh(){return!(!this.username||!this.password)||!!(this.clientId&&this.refreshToken&&this.redirectUri)}static beginOAuth2(e,t){!t&&window&&(t=window);const{portal:r,provider:n,clientId:i,expiration:s,redirectUri:o,popup:a,popupWindowFeatures:l,locale:c,params:u,style:d,pkce:h,state:p}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",locale:"",style:"",pkce:!0},e),f=function(e,t){return"string"==typeof e?e:"object"==typeof e?e.id:mr(t)}(p,t),m=`ARCGIS_REST_JS_AUTH_STATE_${i}`;t.localStorage.setItem(m,f);let g=`${sr(r)}/oauth2/authorize`;const v={client_id:i,response_type:h?"code":"token",expiration:s,redirect_uri:o,state:gr(f,p,t.location.href),locale:c,style:d};let y;if("arcgis"!==n&&(g=`${sr(r)}/oauth2/social/authorize`,v.socialLoginProviderName=n,v.autoAccountCreateForSocial=!0),h){const e=mr(t),r=`ARCGIS_REST_JS_CODE_VERIFIER_${i}`;t.localStorage.setItem(r,e),y=function(e,t=window){if(!t&&window&&(t=window),e&&t.isSecureContext&&t.crypto&&t.crypto.subtle){const r=(new t.TextEncoder).encode(e);return t.crypto.subtle.digest("SHA-256",r).then(e=>fr(new Uint8Array(e),t))}return Promise.resolve(null)}(e,t).then(function(t){v.code_challenge_method=t?"S256":"plain",v.code_challenge=t||e})}else y=Promise.resolve();return y.then(()=>(g=`${g}?${qt(v)}`,u&&(g=`${g}&${qt(u)}`),a?new Promise((e,n)=>{t.addEventListener(`arcgis-rest-js-popup-auth-${i}`,t=>{if("access_denied"===t.detail.error){const e=new ir;return n(e),e}if(t.detail.errorMessage){const e=new Xt(t.detail.errorMessage,t.detail.error);return n(e),e}e(new vr({clientId:i,portal:r,ssl:t.detail.ssl,token:t.detail.token,tokenExpires:t.detail.expires,username:t.detail.username,refreshToken:t.detail.refreshToken,refreshTokenExpires:t.detail.refreshTokenExpires,redirectUri:o,state:t.detail.state}))},{once:!0}),t.open(g,"oauth-window",l),t.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-start"))}):void(t.location.href=g)))}static completeOAuth2(e,t){!t&&window&&(t=window);const{portal:r,clientId:n,popup:i,pkce:s,redirectUri:o}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",popup:!0,pkce:!0},e),a=`ARCGIS_REST_JS_AUTH_STATE_${n}`,l=t.localStorage.getItem(a),c=cr(s?t.location.search.replace(/^\?/,""):t.location.hash.replace(/^#/,"")),u=c&&c.state?JSON.parse(c.state):void 0;function d(e,r,s){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:{error:r,errorMessage:e}})),void t.close()):(s&&t.history.replaceState(t.history.state,"",s),"access_denied"===r?Promise.reject(new ir):Promise.reject(new Xt(e,r)))}function h(e,s){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:Object.assign(Object.assign({},e),{state:s})})),void t.close()):(s.originalUrl&&t.history.replaceState(t.history.state,"",s.originalUrl),new vr({clientId:n,portal:r,ssl:e.ssl,token:e.token,tokenExpires:e.expires,username:e.username,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,redirectUri:o||location.href.replace(location.search,""),state:s}))}if(!l||!u)return d("No authentication state was found, call `ArcGISIdentityManager.beginOAuth2(...)` to start the authentication process.","no-auth-state");if(u.id!==l)return d("Saved client state did not match server sent state.","mismatched-auth-state");if(c.error){const e=c.error;return d(c.error_description||"Unknown error",e,u.originalUrl)}if(s&&c.code){const e=sr(`${r}/oauth2/token/`),i=`ARCGIS_REST_JS_CODE_VERIFIER_${n}`,s=t.localStorage.getItem(i);return t.localStorage.removeItem(i),ar(e,{httpMethod:"POST",params:{client_id:n,code_verifier:s,grant_type:"authorization_code",redirect_uri:o||location.href.replace(location.search,""),code:c.code}}).then(e=>h(Object.assign(Object.assign({},e),u),u)).catch(e=>d(e.originalMessage,e.code,u.originalUrl))}return!s&&c.access_token?Promise.resolve(h(Object.assign({token:c.access_token,expires:new Date(Date.now()+1e3*parseInt(c.expires_in,10)),ssl:"true"===c.ssl,username:c.username},u),u)):d("Unknown error","oauth-error",u.originalUrl)}static fromParent(e,t){let r;return!t&&window&&(t=window),new Promise((n,i)=>{r=e=>{if(e.source===t.parent&&e.data)try{return n(vr.parentMessageHandler(e))}catch(e){return i(e)}},t.addEventListener("message",r,!1),t.parent.postMessage({type:"arcgis:auth:requestCredential"},e)}).then(e=>(t.removeEventListener("message",r,!1),e))}static authorize(e,t){const{portal:r,clientId:n,expiration:i,redirectUri:s,state:o}=Object.assign({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),a={client_id:n,expiration:i,response_type:"code",redirect_uri:s};o&&(a.state=o);const l=`${r}/oauth2/authorize?${qt(a)}`;t.writeHead(301,{Location:l}),t.end()}static exchangeAuthorizationCode(e,t){const{portal:r,clientId:n,redirectUri:i}=Object.assign({portal:"https://www.arcgis.com/sharing/rest"},e);return ar(`${r}/oauth2/token`,{params:{grant_type:"authorization_code",client_id:n,redirect_uri:i,code:t}}).then(e=>new vr({clientId:n,portal:r,ssl:e.ssl,redirectUri:i,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,token:e.token,tokenExpires:e.expires,username:e.username})).catch(e=>{throw new nr(e.message,tr.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)})}static deserialize(e){const t=JSON.parse(e);return new vr({clientId:t.clientId,refreshToken:t.refreshToken,refreshTokenExpires:t.refreshTokenExpires?new Date(t.refreshTokenExpires):void 0,username:t.username,password:t.password,token:t.token,tokenExpires:t.tokenExpires?new Date(t.tokenExpires):void 0,portal:t.portal,ssl:t.ssl,tokenDuration:t.tokenDuration,redirectUri:t.redirectUri,server:t.server})}static fromCredential(e,t){const r=void 0===e.ssl||e.ssl,n=e.expires||Date.now()+72e5;return t.hasServer?new vr({server:e.server,ssl:r,token:e.token,username:e.userId,tokenExpires:new Date(n)}):new vr({portal:sr(e.server.includes("sharing/rest")?e.server:e.server+"/sharing/rest"),ssl:r,token:e.token,username:e.userId,tokenExpires:new Date(n)})}static parentMessageHandler(e){if("arcgis:auth:credential"===e.data.type){const t=e.data.credential;return function(e){return"string"==typeof e.userId||"number"==typeof e.expires}(t)?vr.fromCredential(t,{hasPortal:!0,hasServer:!1,server:t.server}):new vr(t)}if("arcgis:auth:error"===e.data.type){const t=new Error(e.data.error.message);throw t.name=e.data.error.name,t}throw new Error("Unknown message type.")}static destroy(e){return function(e){const t=`${sr(e.portal||"https://www.arcgis.com/sharing/rest")}/oauth2/revokeToken/`,r=e.token,n=e.clientId;delete e.portal,delete e.clientId,delete e.token;const i=Object.assign(Object.assign({},e),{httpMethod:"POST",params:{client_id:n,auth_token:r}});return er(t,i).then(e=>{if(!e.success)throw new Gt("Unable to revoke token",500,e,t,i);return e})}({clientId:e.clientId,portal:e.portal,token:e.refreshToken||e.token})}static fromToken(e){const t=new vr(e);return t.getUser().then(()=>t)}static signIn(e){const t=new vr(e);return t.getUser().then(()=>t)}toCredential(){return{expires:this.tokenExpires.getTime(),server:this.server||this.portal,ssl:this.ssl,token:this.token,userId:this.username}}getPortal(e){if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);{const t=`${this.portal}/portals/self`,r=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=er(t,r).then(e=>(this._portalInfo=e,this._pendingPortalRequest=null,e)),this._pendingPortalRequest}}getToken(e,t){return function(e,t){const r=dr(e),n=dr(t),i=hr(e),s=hr(t);return!(!r||!n||i!==s)}(this.portal,e)||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)}validateAppAccess(e){return this.getToken(this.portal).then(t=>function(e,t,r="https://www.arcgis.com/sharing/rest"){return er(`${r}/oauth2/validateAppAccess`,{method:"POST",params:{f:"json",client_id:t,token:e}})}(t,e))}toJSON(){return{type:"ArcGISIdentityManager",clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires||void 0,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires||void 0,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,server:this.server}}serialize(){return JSON.stringify(this)}enablePostMessageAuth(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)}disablePostMessageAuth(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)}refreshCredentials(e){return this.clearCachedUserInfo(),this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new nr("Unable to refresh token. No refresh token or password present.",tr.TOKEN_REFRESH_FAILED))}getServerRootUrl(e){const[t]=sr(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/),[r,n,i]=t.match(/(https?:\/\/)(.+)/),[s,...o]=i.split("/");return`${n}${s.toLowerCase()}/${o.join("/")}`}getDomainCredentials(e){return this.trustedDomains&&this.trustedDomains.length?(e=e.toLowerCase(),this.trustedDomains.some(t=>e.startsWith(t.toLowerCase()))?"include":"same-origin"):"same-origin"}signOut(){return vr.destroy(this)}createPostMessageHandler(e){return t=>{const r=e.indexOf(t.origin)>-1,n="arcgis:auth:requestCredential"===t.data.type,i=this.tokenExpires.getTime()>Date.now();if(r&&n){let e={};if(i){const t=this.toCredential();t.server=t.server.replace("/sharing/rest",""),e={type:"arcgis:auth:credential",credential:t}}else e={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Token was expired, and not returned to the child application"}};t.source.postMessage(e,t.origin)}}}getTokenForServer(e,t){const r=this.getServerRootUrl(e),n=this.federatedServers[r];return n&&n.expires&&n.expires.getTime()>Date.now()?Promise.resolve(n.token):(this._pendingTokenRequests[r]||(this._pendingTokenRequests[r]=this.fetchAuthorizedDomains().then(()=>er(`${r}/rest/info`,{credentials:this.getDomainCredentials(e)}).then(n=>{if(n.owningSystemUrl){if(pr(n.owningSystemUrl,this.portal))return er(`${n.owningSystemUrl}/sharing/rest/info`,t);throw new nr(`${e} is not federated with ${this.portal}.`,tr.NOT_FEDERATED)}if(n.authInfo&&void 0!==this.federatedServers[r])return Promise.resolve({authInfo:n.authInfo});throw new nr(`${e} is not federated with any portal and is not explicitly trusted.`,tr.NOT_FEDERATED)}).then(e=>this.token&&this.tokenExpires.getTime()<Date.now()?this.server?this.refreshCredentials().then(()=>({token:this.token,expires:this.tokenExpires})):this.refreshCredentials().then(()=>this.generateTokenForServer(e.authInfo.tokenServicesUrl,r)):this.generateTokenForServer(e.authInfo.tokenServicesUrl,r)).then(e=>(this.federatedServers[r]=e,delete this._pendingTokenRequests[r],e.token)))),this._pendingTokenRequests[r])}generateTokenForServer(e,t){return er(e,{params:{token:this.token,serverUrl:t,expiration:this.tokenDuration}}).then(e=>({token:e.token,expires:new Date(e.expires-3e5)})).catch(e=>{throw new nr(e.message,tr.GENERATE_TOKEN_FOR_SERVER_FAILED,e.response,e.url,e.options)})}getFreshToken(e){return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshCredentials(e).then(()=>(this._pendingTokenRequests[this.portal]=null,this.token))),this._pendingTokenRequests[this.portal])}refreshWithUsernameAndPassword(e){const t={username:this.username,password:this.password,expiration:this.tokenDuration,client:"referer",referer:this.referer?this.referer:"undefined"!=typeof window&&void 0!==window.document&&window.location&&window.location.origin?window.location.origin:Zt};return(this.server?er(`${this.getServerRootUrl(this.server)}/rest/info`).then(r=>er(r.authInfo.tokenServicesUrl,Object.assign({params:t},e))):er(`${this.portal}/generateToken`,Object.assign({params:t},e))).then(e=>(this.updateToken(e.token,new Date(e.expires)),this)).catch(e=>{throw new nr(e.message,tr.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)})}refreshWithRefreshToken(e){if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()-864e5<Date.now())return this.exchangeRefreshToken(e);const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return ar(`${this.portal}/oauth2/token`,t).then(e=>this.updateToken(e.token,e.expires)).catch(e=>{throw new nr(e.message,tr.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)})}updateToken(e,t){return this._token=e,this._tokenExpires=t,this}exchangeRefreshToken(e){const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return ar(`${this.portal}/oauth2/token`,t).then(e=>(this._token=e.token,this._tokenExpires=e.expires,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this)).catch(e=>{throw new nr(e.message,tr.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)})}fetchAuthorizedDomains(){return this.server||!this.portal?Promise.resolve(this):this.getPortal().then(e=>(e.authorizedCrossOriginDomains&&e.authorizedCrossOriginDomains.length&&(this.trustedDomains=e.authorizedCrossOriginDomains.filter(e=>!e.startsWith("http://")).map(e=>e.startsWith("https://")?e:`https://${e}`)),this))}}function yr(e){return console.log("DEPRECATED:, 'UserSession' is deprecated. Use 'ArcGISIdentityManager' instead."),new vr(e)}var wr;yr.beginOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.beginOAuth2' is deprecated. Use 'ArcGISIdentityManager.beginOAuth2' instead."),vr.beginOAuth2(...e)},yr.completeOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.completeOAuth2()' is deprecated. Use 'ArcGISIdentityManager.completeOAuth2()' instead."),e.length<=1&&console.warn("WARNING:, 'UserSession.completeOAuth2()' is now async and returns a promise the resolves to an instance of `ArcGISIdentityManager`."),vr.completeOAuth2(...e)},yr.fromParent=function(...e){return console.warn("DEPRECATED:, 'UserSession.fromParent' is deprecated. Use 'ArcGISIdentityManager.fromParent' instead."),vr.fromParent(...e)},yr.authorize=function(...e){return console.warn("DEPRECATED:, 'UserSession.authorize' is deprecated. Use 'ArcGISIdentityManager.authorize' instead."),vr.authorize(...e)},yr.exchangeAuthorizationCode=function(...e){return console.warn("DEPRECATED:, 'UserSession.exchangeAuthorizationCode' is deprecated. Use 'ArcGISIdentityManager.exchangeAuthorizationCode' instead."),vr.exchangeAuthorizationCode(...e)},yr.fromCredential=function(...e){return console.log("DEPRECATED:, 'UserSession.fromCredential' is deprecated. Use 'ArcGISIdentityManager.fromCredential' instead."),console.warn("WARNING:, 'UserSession.fromCredential' now requires a `ServerInfo` object from the JS API as a second parameter."),vr.fromCredential(...e)},yr.deserialize=function(...e){return console.log("DEPRECATED:, 'UserSession.deserialize' is deprecated. Use 'ArcGISIdentityManager.deserialize' instead."),vr.deserialize(...e)},function(e){e.Success="Succeeded",e.Failed="Failed",e.Waiting="Waiting",e.Cancelled="Cancelled",e.Cancelling="Cancelling",e.New="New",e.Executing="Executing",e.Submitted="Submitted",e.Failure="Failure",e.TimedOut="TimedOut",e.Error="Error",e.Status="Etatus",e.Unknown="Unknown"}(wr||(wr={}));function br(e,t){return er(_r(e,t),Object.assign({httpMethod:"GET"},t))}const _r=(e,t)=>`${"string"==typeof t?t:function(e={}){return e.portal?sr(e.portal):e.authentication&&"string"!=typeof e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}(t)}/content/items/${e}`;var Sr=Object.defineProperty,Ir=(e,t,r)=>((e,t,r)=>t in e?Sr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const Er={aps_data:{},geobim_data:{notAGeoBIMItem:"{GeobimItemTitle} is not a valid GeoBIM Project or App Item.",geobimItemFailedLoad:"GeoBIM Item failed to load: {LoadStatus}",geobimServiceFailedLoad:"GeoBIM Feature Service item failed to load: {LoadStatus}",geobimServiceNotALayer:"GeoBIM Feature Service item id {FeatureServiceId} is not a layer.",serviceIsNotReady:"GeoBIM Project Service is not ready",layerDoesNotExist:"Project Layer {Name} does not exist in GeoBIM Feature Service",serviceInvalidType:"Service of type {LayerType} is not a valid GeoBIM Feature Service",layerIdDoesNotExist:"GeoBIM Project Layer with ID of {LayerId} does not exist",layerInvalidType:"Layer of type {LayerType} is not a valid GeoBIM Feature Layer",geobimServiceNotAService:"GeoBIM Feature Service item id {FeatureServiceId} is not a service.",layerUrlDoesNotExist:"This layer does not exist: {ServiceUrl}",serviceUrlUndefined:"Service item, {FeatureServiceId}, url is undefined",layerDoesNotHaveObjectId:"Layer {ServiceUrl} does not have an ObjectId field",featureNotFound:"Feature with id {ObjectId} was not found in layer {ServiceUrl}",serviceIsNotDefined:"The project has no feature service.",notImplemented:"This method is not implemented: {Name}.",unknown:"Unknown"}},Ar="geobim_data";function Rr(e){const t=function(e,t,r){const n=Object.assign(Object.assign({params:{}},r),e);return n.params=t.reduce((t,r)=>((e[r]||"boolean"==typeof e[r]||"number"==typeof e[r]&&0===e[r])&&(t[r]=e[r]),t),n.params),["params","httpMethod","rawResponse","authentication","hideToken","portal","credentials","maxUrlLength","headers","signal","suppressWarnings","request"].reduce((e,t)=>(n[t]&&(e[t]=n[t]),e),{})}(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:Object.assign({where:"1=1",outFields:"*"},e.params)});return er(`${sr(e.url)}/query`,t)}var kr=Object.defineProperty,Tr=(e,t,r)=>((e,t,r)=>t in e?kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);function Cr(e,t){if((null==e?void 0:e.length)>0&&null!=t)return e.find(e=>e.toLowerCase()===t.toLowerCase())}class Or{constructor(){Tr(this,"globalId"),Tr(this,"objectId"),Tr(this,"creationDate"),Tr(this,"creator"),Tr(this,"editDate"),Tr(this,"editor")}}Tr(Or,"fields",["globalId","objectId","creationDate","creator","editDate","editor"]);class Dr extends Or{constructor(e){super(),Tr(this,"linkType"),Tr(this,"linkDefinition"),Tr(this,"itemId"),Tr(this,"layerId"),Tr(this,"featureId"),Tr(this,"licenseDetails"),Tr(this,"fields",Or.fields.concat(["linkType","linkDefinition","itemId","resourceId","featureId","licenseDetails"]));for(const t in this){const r=Cr(Object.keys(e.attributes),t);void 0!==r&&("resourceId"===t?this.layerId=parseInt(e.attributes[r]):this[t]=e.attributes[r])}}}var jr=(e=>(e.ViewerUrl="ViewerUrl",e.BIMDocument="BIMDocument",e.DocumentName="DocumentName",e.ScheduleFeature="ScheduleFeature",e.Custom="Custom",e))(jr||{}),xr=(e=>(e.Documents="Documents",e.Issues="Issues",e.Schedules="Schedules",e.BIMProjects="BIMProjects",e.Accounts="Accounts",e.Links="Links",e.Jobs="Jobs",e.LocationNotes="Location Notes",e.LineNotes="Line Notes",e.AreaNotes="Area Notes",e))(xr||{});class Pr extends Or{constructor(e){super(),Tr(this,"name"),Tr(this,"type"),Tr(this,"connectionInfo"),Tr(this,"licenseDetails"),Tr(this,"fields",Or.fields.concat(["name","type","authDetails"]));const t=Object.keys(e.attributes);for(const r in this)if("connectionInfo"===r){const r=Cr(t,"authDetails");if(void 0===r)continue;this.connectionInfo=JSON.parse(e.attributes[r])}else{const n=Cr(t,r);if(void 0===n)continue;this[r]=e.attributes[n]}}}class Nr extends Or{constructor(e){super(),Tr(this,"lastModifiedTime"),Tr(this,"projectId"),Tr(this,"itemId"),Tr(this,"versionId"),Tr(this,"displayName"),Tr(this,"boundary"),Tr(this,"spatialReference"),Tr(this,"hidden"),Tr(this,"outlier"),Tr(this,"outlierMessage"),Tr(this,"shapeArea"),Tr(this,"shapeLength"),Tr(this,"fields",Or.fields.concat(["lastModifiedTime","projectId","itemId","versionId","displayName","boundary","spatialReference","hidden","outlier","outlierMessage","shapeArea","shapeLength","docOffset"]));for(const t in this){const r=Cr(Object.keys(e.attributes),t);void 0!==r&&(this[t]=e.attributes[r])}}}var Lr=(e=>(e.INFO="info",e.WARNING="warning",e.DANGER="danger",e))(Lr||{});class Ur extends Error{constructor(e){super(e.message),Tr(this,"_message"),Tr(this,"_severity"),Tr(this,"_intl"),Tr(this,"errorType","GeoBIM_Error"),this._message=e.message,this._severity=e.severity??"info",this._intl=e.intl}get message(){return this._message}get severity(){return this._severity}get intl(){return this._intl}}const Fr=e=>new Ur({message:Er.geobim_data.notAGeoBIMItem.replace("{GeobimItemTitle}",e),severity:Lr.DANGER,intl:{id:"notAGeoBIMItem",messageGroupId:Ar,substitutions:{GeobimItemTitle:e}}}),Mr=e=>new Ur({message:Er.geobim_data.geobimServiceNotAService.replace("{FeatureServiceId}",e),severity:Lr.DANGER,intl:{id:"geobimServiceNotAService",messageGroupId:Ar,substitutions:{FeatureServiceId:e}}}),$r=e=>new Ur({message:Er.geobim_data.serviceUrlUndefined.replace("{FeatureServiceId}",e),severity:Lr.DANGER,intl:{id:"serviceUrlUndefined",messageGroupId:Ar,substitutions:{FeatureServiceId:e}}});class Br{constructor(e){Ir(this,"_session"),Ir(this,"getFeature",async(e,t)=>{const r=await function(e){const t=`${sr(e.url)}/${e.id}`,r=Object.assign({httpMethod:"GET"},e);return er(t,r).then(e=>r.rawResponse?e:e.feature)}({url:e.url,id:t,authentication:this._session});if(null==r)throw((e,t)=>new Ur({message:Er.geobim_data.featureNotFound.replace("{ObjectId}",e.toString()).replace("{ServiceUrl}",t),severity:Lr.DANGER,intl:{id:"featureNotFound",messageGroupId:Ar,substitutions:{ObjectId:e.toString(),ServiceUrl:t}}}))(t,e.url);return this.mapIRestFeatureToIFeature(t,r,e)}),Ir(this,"getLayer",async(e,t)=>{const r=await this.getFeatureServiceUrl(e);return await this.getLayerFromUrl(`${r}/${t}`,e,t)}),Ir(this,"getLayerFromUrl",async(e,t,r)=>{const n=await function(e){return er(sr(e.url),e)}({url:e,authentication:this._session});if(null==n)throw(e=>new Ur({message:Er.geobim_data.layerUrlDoesNotExist.replace("{ServiceUrl}",e),severity:Lr.DANGER,intl:{id:"layerDoesNotExist",messageGroupId:Ar,substitutions:{ServiceUrl:e}}}))(e);return this.mapILayerDefinitionToILayer(n,e,t,r)}),Ir(this,"queryFeatures",async(e,t)=>{var r;const n={authentication:this._session,url:e.url,...t},i=await Rr(n);if(null==i)return[];if((null==(r=i.features)?void 0:r.length)<=0)return[];if(void 0===i.objectIdFieldName)throw(e=>new Ur({message:Er.geobim_data.layerDoesNotHaveObjectId.replace("{ServiceUrl}",e),severity:Lr.DANGER,intl:{id:"layerDoesNotHaveObjectId",messageGroupId:Ar,substitutions:{ServiceUrl:e}}}))(n.url);const s=i.objectIdFieldName;return i.features.map(t=>this.mapIRestFeatureToIFeature(t.attributes[s],t,e))}),Ir(this,"getItem",async e=>{const t=await br(e,{authentication:this._session});return this.mapIRestItemtoIItem(t)}),Ir(this,"getFeatureService",async e=>{const t=await this.getFeatureServiceUrl(e),r=await this.getFeatureServiceFromUrl(`${t}`);return this.mapIFeatureServiceDefinitionToIFeatureService(r,t,e)}),Ir(this,"getFeatureServiceFromUrl",async e=>await function(e){return er(sr(e.url),e)}({url:e,authentication:this._session})),Ir(this,"getFeatureServiceUrl",async e=>{try{const t=await br(e,{authentication:this._session});if("Feature Service"!==t.type)throw Mr(e);if(void 0===t.url)throw $r(e);return t.url}catch{throw Mr(e)}}),this._session=e}mapIRestFeatureToIFeature(e,t,r){return{objectId:e,attributes:t.attributes,layer:r}}mapILayerDefinitionToILayer(e,t,r,n){return{id:e.name??"",portalItemId:r,layerId:n,type:e.type??"",title:e.name??"",displayField:e.displayField??"",objectIdField:e.objectIdField??"",url:t,fields:void 0===e.fields?[]:e.fields.map(e=>({name:e.name,type:e.type,alias:e.alias}))}}mapITableToILayer(e,t,r,n){return{id:e.name??"",portalItemId:r,layerId:n,type:"table",title:e.name??"",displayField:"",objectIdField:"",url:t,fields:[]}}mapIRestItemtoIItem(e){return e}mapIFeatureServiceDefinitionToIFeatureService(e,t,r){return{portalItemId:r,description:e.description??"",url:t,layers:e.layers.map(e=>this.mapILayerDefinitionToILayer(e,t,r,e.id??0)),tables:e.tables.map(e=>null!=e.layerDefinition?this.mapILayerDefinitionToILayer(e.layerDefinition,t,r,e.id??0):this.mapITableToILayer(e,t,r,e.id??0))}}}class Vr{constructor(e,t){Ir(this,"_layer"),Ir(this,"_queryService"),this._queryService=e,this._layer=t}get ArcGISRestService(){return this._queryService}get layer(){return this._layer}}class qr extends Vr{constructor(){super(...arguments),Ir(this,"getLinkRecords",async(e,t,r)=>{const n=this.getServiceFieldName("ResourceId"),i=this.getServiceFieldName("ItemId"),s=this.getServiceFieldName("FeatureId"),o=`${n} = '${t}' AND ${i} = '${e}' AND (${s} = ${r} OR ${s} IS NULL)`,a=await this.ArcGISRestService.queryFeatures(this.layer,{url:this.layer.url,where:o});return(null==a?void 0:a.length)>0?a.map(e=>new Dr(e)):[]}),Ir(this,"addLinks",async e=>{}),Ir(this,"getServiceFieldName",e=>{var t;const r=null==(t=this.layer.fields)?void 0:t.find(t=>t.name.toLowerCase()===e.toLowerCase());return(null==r?void 0:r.name)??e})}}class zr extends Vr{constructor(){super(...arguments),Ir(this,"getAccountRecords",async(e,t)=>{const r=this.getServiceFieldName("Name"),n=this.getServiceFieldName("Type"),i=`${r} = '${e}' ${void 0!==t&&t.length>0?`AND ${n} = '${t}'`:""}`,s=await this.ArcGISRestService.queryFeatures(this.layer,{url:this.layer.url,where:i});return(null==s?void 0:s.length)>0?s.map(e=>new Pr(e)):[]}),Ir(this,"getServiceFieldName",e=>{var t;const r=null==(t=this.layer.fields)?void 0:t.find(t=>t.name.toLowerCase()===e.toLowerCase());return(null==r?void 0:r.name)??e})}}class Gr extends Vr{constructor(){super(...arguments),Ir(this,"getDocumentsByIntersection",async e=>{var t;const r=await this.ArcGISRestService.queryFeatures(this.layer,{url:this.layer.url,geometry:this.getQueryGeometry(e),geometryType:this.getQueryGeometryType(e),inSR:(null==(t=e.geometry)?void 0:t.spatialReference)??"3857"});return(null==r?void 0:r.length)>0?r.map(e=>new Nr(e)):[]}),Ir(this,"getQueryGeometry",e=>{if(null==(null==e?void 0:e.geometry))return;const t=e.geometry;switch(e.geometry.type){case"point":{const e=t;return{x:e.x,y:e.y}}case"polyline":return{paths:t.paths};case"polygon":return{rings:t.rings};default:throw new Error("Unsupported geometry type")}}),Ir(this,"getQueryGeometryType",e=>{if(null!=(null==e?void 0:e.geometry))switch(e.geometry.type){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":return"esriGeometryPolygon";default:throw new Error("Unsupported geometry type")}}),Ir(this,"getDocument",async e=>{const{projectId:t,itemId:r}=e,n=await this.ArcGISRestService.queryFeatures(this.layer,{url:this.layer.url,where:`projectId = '${t}' AND itemId = '${r}'`,outFields:["*"]});return 0===n.length?null:new Nr(n[0])})}}class Wr{constructor(e,t){Ir(this,"_linkDataService"),Ir(this,"_accountDataService"),Ir(this,"_documentDataService"),Ir(this,"featureServiceItem"),Ir(this,"featureService"),Ir(this,"geobimSourceItemId"),Ir(this,"arcGISRestService"),Ir(this,"projectLayers",{}),Ir(this,"getGeoBIMProjectIdFromAppItem",e=>{var t,r;const n=null==(r=null==(t=e.properties)?void 0:t.geobim)?void 0:r.parentId;if(null!=n)return n;throw Fr(e.id)}),Ir(this,"getGeoBIMServiceFromItem",e=>{if(null==e.featureServiceId||null==e.featureServiceName)throw new Ur({message:Er.geobim_data.serviceIsNotDefined,severity:Lr.DANGER,intl:{id:"serviceIsNotDefined",messageGroupId:Ar,substitutions:{}}});return{id:e.featureServiceId,name:e.featureServiceName}}),Ir(this,"getFeatureServiceItem",async()=>(void 0!==this.featureServiceItem||(this.featureServiceItem=await this.getFeatureServiceItemFromId(this.geobimSourceItemId)),this.featureServiceItem)),Ir(this,"getFeatureServiceItemFromId",async e=>{var t;const r=await this.arcGISRestService.getItem(e);if("GeoBIM Project"===r.type){const e=null==(t=r.properties)?void 0:t.geobim;if(null==e)throw Fr(r.title);const n=this.getGeoBIMServiceFromItem(e);return await this.getFeatureServiceItemFromId(n.id)}if("GeoBIM Application"===r.type){const e=this.getGeoBIMProjectIdFromAppItem(r);return await this.getFeatureServiceItemFromId(e)}if("Feature Service"!==r.type)throw Mr(this.featureServiceItem.id);return r}),Ir(this,"getFeatureServiceUrl",async()=>{const e=await this.getFeatureServiceItem();if(void 0===e.url)throw $r(this.featureServiceItem.id);return e.url}),Ir(this,"getFeatureService",async()=>{if(void 0!==this.featureService)return this.featureService;const e=await this.getFeatureServiceUrl();return this.featureService=await this.arcGISRestService.getFeatureServiceFromUrl(e),this.featureService}),Ir(this,"isValidLayerId",async e=>await this.isValidTableLayerId(e)||await this.isValidLayerLayerId(e)),Ir(this,"isValidTableLayerId",async e=>void 0!==(await this.getFeatureService()).tables.find(t=>t.id===e)),Ir(this,"isValidLayerLayerId",async e=>void 0!==(await this.getFeatureService()).layers.find(t=>t.id===e)),Ir(this,"getLayerIdFromName",async e=>{let t=await this.getLayerIdFromTableName(e);if(-1!==t||(t=await this.getLayerIdFromLayerName(e),-1!==t))return t;throw(e=>new Ur({message:Er.geobim_data.layerDoesNotExist.replace("{Name}",e),severity:Lr.DANGER,intl:{id:"layerDoesNotExist",messageGroupId:Ar,substitutions:{TableName:e}}}))(e)}),Ir(this,"getLayerIdFromTableName",async e=>{var t;return(null==(t=(await this.getFeatureService()).tables.find(t=>{var r;return(null==(r=t.name)?void 0:r.toLowerCase())===e.toLowerCase()}))?void 0:t.id)??-1}),Ir(this,"getLayerIdFromLayerName",async e=>{var t;return(null==(t=(await this.getFeatureService()).layers.find(t=>{var r;return(null==(r=t.name)?void 0:r.toLowerCase())===e.toLowerCase()}))?void 0:t.id)??-1}),Ir(this,"getAccountsService",async()=>{if(void 0!==this._accountDataService)return this._accountDataService;const e=await this.getLayerIdFromName(xr.Accounts),t=await this.getLayer(e);return this._accountDataService=new zr(this.arcGISRestService,t),this._accountDataService}),Ir(this,"getLinksService",async()=>{if(void 0!==this._linkDataService)return this._linkDataService;const e=await this.getLayerIdFromTableName(xr.Links),t=await this.getLayer(e);return this._linkDataService=new qr(this.arcGISRestService,t),this._linkDataService}),Ir(this,"getDocumentsService",async()=>{if(void 0!==this._documentDataService)return this._documentDataService;const e=await this.getLayerIdFromLayerName(xr.Documents),t=await this.getLayer(e);return this._documentDataService=new Gr(this.arcGISRestService,t),this._documentDataService}),Ir(this,"linkDataService",async()=>await this.getLinksService()),Ir(this,"accountDataService",async()=>await this.getAccountsService()),Ir(this,"documentDataService",async()=>await this.getDocumentsService()),Ir(this,"getLayer",async e=>{if(void 0!==this.projectLayers[e])return this.projectLayers[e];if(!await this.isValidLayerId(e))throw(e=>new Ur({message:Er.geobim_data.layerIdDoesNotExist.replace("{LayerId}",e.toString()),severity:Lr.DANGER,intl:{id:"layerIdDoesNotExist",messageGroupId:Ar,substitutions:{LayerId:e.toString()}}}))(e);const t=await this.getFeatureServiceItem(),r=await this.getFeatureServiceUrl(),n=await this.arcGISRestService.getLayerFromUrl(`${r}/${e}`,t.id,e);return this.projectLayers[e]=n,n}),Ir(this,"isIssueFeature",async e=>{const t=await this.getFeatureServiceItem(),r=await this.getLayerIdFromName(xr.Issues);return e.portalItemId===t.id&&e.layerId===r}),this.arcGISRestService=e,this.geobimSourceItemId=t}}class Hr{constructor(e){Ir(this,"loadPromise"),Ir(this,"_credentialsProvider"),Ir(this,"_session"),Ir(this,"queryService"),Ir(this,"_projectDataService",{}),Ir(this,"load",async()=>{void 0===this.loadPromise&&(this.loadPromise=this.initializeService()),await this.loadPromise}),Ir(this,"initializeService",async()=>{const{credential:e,serverInfo:t}=this._credentialsProvider();this.refreshToken(e,t)}),Ir(this,"refreshToken",(e,t)=>{if(void 0===this._session)this._session=vr.fromCredential(e,t);else{const t=e.expires??null;null!==t?this._session.updateToken(e.token,new Date(t)):console.warn("Cannot update token without an expiry date")}const r=e.expires-Date.now()-2e3,n=Math.max(1e3,r);setTimeout(()=>{const{credential:e,serverInfo:t}=this._credentialsProvider();this.refreshToken(e,t)},n)}),Ir(this,"getFeatureService",async e=>await this.ArcGISRestService.getFeatureService(e)),Ir(this,"projectDataService",e=>(void 0!==this._projectDataService[e]||(this._projectDataService[e]=new Wr(this.ArcGISRestService,e)),this._projectDataService[e])),Ir(this,"getItem",async e=>await this.ArcGISRestService.getItem(e)),Ir(this,"getLayer",async(e,t)=>await this.ArcGISRestService.getLayer(e,t)),Ir(this,"getFeature",async(e,t)=>await this.ArcGISRestService.getFeature(e,t)),Ir(this,"queryFeatures",async(e,t)=>await this.ArcGISRestService.queryFeatures(e,{url:e.url,where:t})),this._credentialsProvider=e}get ArcGISRestService(){if(void 0!==this.queryService)return this.queryService;if(void 0===this._session)throw new Error("Service not initialized");return this.queryService=new Br(this._session),this.queryService}}var Jr=(e=>(e.HUBS="hubs",e.PROJECTS="projects",e.FOLDERS="folders",e.ITEMS="items",e.MODEL_SETS="model-set",e.VERSIONS="versions",e.MODEL_SET_VERSION="model-set-version",e))(Jr||{});const Kr=e=>{var t,r;if(null===e)return!1;const n=null==(t=e.attributes)?void 0:t.accountName,i=null==(r=e.attributes)?void 0:r.projectName;return null!=n&&n.length>0&&null!=i&&i.length>0},Yr=async(e,t)=>{var r,n;if(void 0===(null==(n=null==(r=e.links)?void 0:r.self)?void 0:n.href))return null;const i=e.links.self.href,s=e.attributes.displayName,o=e.attributes.name,a=Xr(i),l=Qr(e.id),c={accountName:await t.getProjectsAccountName(a),projectName:await t.getProjectName(a),projectId:a,itemId:l,name:o,displayName:s,versionNumber:e.attributes.versionNumber.toString(),createUserName:e.attributes.createUserName};null!=e.id&&(c.versionId=e.id);const u={displayName:s,fileName:o,url:i,isDefault:!1,attributes:c};return Kr(u)?u:null},Zr=(e,t=null)=>{var r;return e.type===Jr.VERSIONS?{id:e.id??"",label:(null==t?void 0:t.displayName)??"",document:t,item:null,children:null}:{id:e.id??"",label:(null==(r=e.attributes)?void 0:r.name)??"",document:null,item:e,children:null}},Xr=e=>{if(null==e)return"";const t=e.split("/"),r=t.findIndex(e=>"projects"===e);return r>-1?t[r+1]:""},Qr=e=>null==e?"":e.split("?")[0].replace("fs.file:vf.","dm.lineage:");class en{constructor(e,t){Ir(this,"_filter",""),Ir(this,"accounts"),Ir(this,"dataManagement"),Ir(this,"root",null),Ir(this,"search",async(e,t)=>{if(0===t.length)return e;if(null!=this.root&&t===this._filter)return this.root;this._filter=t;const r=JSON.parse(JSON.stringify(e)),n=r.item;return n.type===Jr.HUBS?await this.searchHub(r,t):n.type===Jr.PROJECTS?await this.searchProject(r,t):console.warn("Search root item is not a hub or project"),this.pruneNodes(null,r),r}),Ir(this,"searchHub",async(e,t)=>{null!=e.children&&await Promise.all(e.children.map(async r=>{r.children=null,await this.searchProject(r,t),(null==r.children||0===r.children.length)&&this.removeNode(e,r)}))}),Ir(this,"searchProject",async(e,t)=>{var r,n,i,s,o,a,l;await this.addProjectTopFolders(e);const c=e.item,u=null==(i=null==(n=null==(r=c.relationships)?void 0:r.rootFolder)?void 0:n.data)?void 0:i.id;if(void 0===c.id||void 0===u)return;const d=await this.dataManagement.searchFolder(c.id,u,t);if(null==d||0===(null==d?void 0:d.length))return;const h=await this.removeInvalidItems(d);for(let t=0;t<h.length;t++){const r=h[t],n=await this.createNode(r);if(null!=n&&null!=(null==(o=null==(s=r.links)?void 0:s.webView)?void 0:o.href)&&(null==(l=null==(a=r.links)?void 0:a.webView)?void 0:l.href.length)>0){const t=this.getParentFolderId(r.links.webView.href),i=`https://developer.api.autodesk.com/data/v1/projects/${c.id}/folders/${t}`;await this.buildParentFolders(e,n,i)}}}),Ir(this,"pruneNodes",(e,t)=>{if(null==t.item)return;const r=t.item;if(r.type===Jr.HUBS||r.type===Jr.PROJECTS||r.type===Jr.FOLDERS){if(null!=t.children)for(let e=t.children.length-1;e>=0;e--)this.pruneNodes(t,t.children[e]);null!=e&&(r.type===Jr.FOLDERS&&r.attributes.hidden||this.isEmptyProjectOrFolder(t))&&this.removeNode(e,t)}}),Ir(this,"isEmptyProjectOrFolder",e=>{const t=e.item;return!(t.type!==Jr.PROJECTS&&t.type!==Jr.FOLDERS||null!=e.children&&0!==e.children.length)}),Ir(this,"removeInvalidItems",async e=>{const t=[];for(const r of e)await this.dataManagement.isValidViewerFormat(r)&&t.push(r);return t}),Ir(this,"removeNode",(e,t)=>{if(null!=e.children)for(let r=0;r<e.children.length;r++)if(e.children[r].id===t.id){e.children.splice(r,1);break}}),Ir(this,"addProjectTopFolders",async e=>{var t,r,n,i,s;const o=e.item;if(null==o||void 0===(null==(t=o.relationships)?void 0:t.rootFolder)||void 0===(null==(s=null==(i=null==(n=null==(r=o.relationships)?void 0:r.topFolders)?void 0:n.links)?void 0:i.related)?void 0:s.href))return;const a=await this.dataManagement.getContent([o.relationships.topFolders.links.related.href]);if(null!=a)for(let t=0;t<a.length;t++){const r=a[t].type===Jr.FOLDERS?a[t]:null;if(null!==r){const t=await this.createNode(r);null!=t&&this.addChild(e,t)}}}),Ir(this,"buildParentFolders",async(e,t,r)=>{var n,i,s,o,a,l,c,u,d,h,p,f;if(null==r||0===r.length)return;const m=e.item;if(void 0===(null==m?void 0:m.id))return;const g=await this.dataManagement.getContent([r]);if(null!=g&&0!==g.length)for(let r=0;r<g.length;r++){const v=g[r];if((null==(s=null==(i=null==(n=m.relationships)?void 0:n.rootFolder)?void 0:i.data)?void 0:s.id)===v.id)return void this.addChild(e,t);const y=this.findNode(e,v.id??"");if(null!=y)return void this.addChild(y,t);const w=await this.createNode(v);if(null==w)return void this.addChild(e,t);if((null==(l=null==(a=null==(o=m.relationships)?void 0:o.rootFolder)?void 0:a.data)?void 0:l.id)===(null==(d=null==(u=null==(c=v.relationships)?void 0:c.parent)?void 0:u.data)?void 0:d.id))this.addChild(e,w);else if(void 0!==(null==(f=null==(p=null==(h=v.relationships)?void 0:h.parent)?void 0:p.data)?void 0:f.id)){const t=v.relationships.parent.data.id,r=`https://developer.api.autodesk.com/data/v1/projects/${m.id}/folders/${t}`;await this.buildParentFolders(e,w,r)}this.addChild(w,t)}}),Ir(this,"findNode",(e,t)=>{if(e.id===t)return e;if(null!=e.children&&e.children.length>0)for(let r=0;r<e.children.length;r++){const n=this.findNode(e.children[r],t);if(null!=n)return n}return null}),Ir(this,"addChild",(e,t)=>{null==e.children?e.children=[t]:e.children.push(t)}),Ir(this,"getParentFolderId",e=>e.includes("docs.b360")?this.getBIM360ParentFolderId(e):this.getACCParentFolderId(e)),Ir(this,"getBIM360ParentFolderId",e=>{const t=e.split("/"),r=t.findIndex(e=>"folders"===e);return-1!==r?t[r+1]:""}),Ir(this,"getACCParentFolderId",e=>{const t=e.split("?");if(t.length<2)return"";const r=t[1].split("&").find(e=>e.toLocaleLowerCase().startsWith("folderurn")),n=null!=r?r.split("="):[];return n.length>1?n[1]:""}),Ir(this,"createNode",async e=>{if(e.type===Jr.VERSIONS){const t=await Yr(e,this.accounts);return Zr(e,t)}return Zr(e,null)}),this.accounts=e,this.dataManagement=t}}class tn{constructor(e){Ir(this,"getRegionUrl",e=>{var t;return null==(t=this.getRegionInfo(e))?void 0:t.regionUrl}),Ir(this,"getDocumentsRoot",(e,t)=>{var r,n;return this.getValidatedUrl(null==(n=null==(r=this.getRegionInfo(e))?void 0:r[t])?void 0:n.documentsRoot)}),Ir(this,"getProjectRoot",(e,t)=>{var r,n;return this.getValidatedUrl(null==(n=null==(r=this.getRegionInfo(e))?void 0:r[t])?void 0:n.projectRoot)}),Ir(this,"getRegionInfo",e=>{var t;return null==(t=this.regionsInfo)?void 0:t.regions[e]}),Ir(this,"getValidatedUrl",e=>{var t;return 0===(null==(t=null==e?void 0:e.trim())?void 0:t.length)?void 0:e}),this.regionsInfo=e}}const rn={US:{regionUrl:"",ACC:{documentsRoot:"https://acc.autodesk.com",projectRoot:"https://acc.autodesk.com"},BIM360:{documentsRoot:"https://docs.b360.autodesk.com",projectRoot:"https://insight.b360.autodesk.com"}},EMEA:{regionUrl:"/regions/eu",ACC:{documentsRoot:"https://acc.autodesk.eu",projectRoot:"https://acc.autodesk.eu"},BIM360:{documentsRoot:"https://docs.b360.eu.autodesk.com",projectRoot:"https://insight.b360.eu.autodesk.com"}},APAC:{regionUrl:"/regions/apac",ACC:{documentsRoot:"https://acc.apac.autodesk.com",projectRoot:"https://acc.apac.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},AUS:{regionUrl:"/regions/aus",ACC:{documentsRoot:"https://acc.aus.autodesk.com",projectRoot:"https://acc.aus.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},GBR:{regionUrl:"/regions/gbr",ACC:{documentsRoot:"https://acc.gbr.autodesk.com",projectRoot:"https://acc.gbr.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},DEU:{regionUrl:"/regions/deu",ACC:{documentsRoot:"https://acc.deu.autodesk.com",projectRoot:"https://acc.deu.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},JPN:{regionUrl:"/regions/jpn",ACC:{documentsRoot:"https://acc.jpn.autodesk.com",projectRoot:"https://acc.jpn.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},CAN:{regionUrl:"/regions/can",ACC:{documentsRoot:"https://acc.can.autodesk.com",projectRoot:"https://acc.can.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}},IND:{regionUrl:"/regions/ind",ACC:{documentsRoot:"https://acc.ind.autodesk.com",projectRoot:"https://acc.ind.autodesk.com"},BIM360:{documentsRoot:"",projectRoot:""}}},nn={regions:rn},sn=Object.freeze(Object.defineProperty({__proto__:null,default:nn,regions:rn},Symbol.toStringTag,{value:"Module"})),on=class e{constructor(e){Ir(this,"dataManagement"),this.dataManagement=e}async getIssue(t,r){const n=e.baseUrl+`/projects/${t}/issues/${r}`;return await this.dataManagement.getIssueByUrl(n)}static async getIssueSourceURL(e,t,r,n){var i,s;const o=null==(i=t.sourceData)?void 0:i.id;if(void 0!==o){let i=`${r}/docs/issues/projects/${e}/issues?issueId=${o}`;if(void 0!==(null==(s=t.sourceData)?void 0:s.target_urn)&&void 0!==n){const t=n.replace(`${r}/docs/files/projects/${e}?`,"").split("&");i=`${r}/docs/files/projects/${e}?folderUrn=${t[0].replace("folderUrn=","")}&entityId=${t[1].replace("entityId=","")}&viewModel=detail&moduleId=folders&issueId=${o}`}return i}}};Ir(on,"baseUrl","https://developer.api.autodesk.com/construction/issues/v1");let an=on;const ln=class e{constructor(e){Ir(this,"dataManagement"),this.dataManagement=e}async getIssue(t,r){const n=e.baseUrl+`/containers/${t}/issues/${r}`;return await this.dataManagement.getIssueByUrl(n)}static async getIssueSourceURL(e,t,r,n){var i,s;const o=null==(i=t.sourceData)?void 0:i.id;if(void 0!==o){let i=`${r}/projects/${e}/issues/${o}`;const a=null==(s=t.sourceData)?void 0:s.target_urn;if(void 0!==a&&void 0!==n){i=`${r}/projects/${e}/folders/${n.replace(`${r}/projects/${e}/folders/`,"").split("/")[0]}/detail/viewer/items/${a}/issues/${o}`}return i}}};Ir(ln,"baseUrl","https://developer.api.autodesk.com/issues/v2");let cn=ln;const un=class e{constructor(t){Ir(this,"issuesACC"),Ir(this,"issuesBIM360"),Ir(this,"getIssue",async(t,r)=>{var n,i,s,o;if(null==t)return null;const a=e.getProjectType(t),l=encodeURIComponent(r),c=null==(n=t.id)?void 0:n.replace("b.",""),u=null==(o=null==(s=null==(i=t.relationships)?void 0:i.issues)?void 0:s.data)?void 0:o.id;if(void 0===c||void 0===u)return console.warn("Project does not have a valid projectId or containerId.",t),null;let d=null;switch(a){case"ACC":d=await this.issuesACC.getIssue(c,l);break;case"BIM360":d=await this.issuesBIM360.getIssue(u,l)}return null!==d?function(e,t){return{projectId:t,sourceType:"APS",sourceData:e}}(d,c):null}),this.issuesACC=new an(t),this.issuesBIM360=new cn(t)}static isAPSIssue(t){return t.sourceType===e.ISSUE_SOURCE_TYPE}async getIssueSourceURL(t,r,n,i){var s;const o=e.getProjectType(t),a=null==(s=t.id)?void 0:s.replace("b.","");switch(o){case"ACC":return await an.getIssueSourceURL(a,r,n,i);case"BIM360":return await cn.getIssueSourceURL(a,r,n,i)}}};Ir(un,"ISSUE_SOURCE_TYPE","APS"),Ir(un,"getProjectType",e=>{var t,r,n;return null==(n=null==(r=null==(t=null==e?void 0:e.attributes)?void 0:t.extension)?void 0:r.data)?void 0:n.projectType});let dn=un;const hn=e=>/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(e),pn=e=>{if("string"==typeof e)try{return decodeURIComponent(e)}catch{}return e};class fn{constructor(e,t){Ir(this,"id"),this.urn=e,this.source=t;const r=null==e?void 0:e.trim(),n=hn(r)?window.atob(r):r;this.urn=n;const i=null==n?void 0:n.split(/:|\./);this.id=i.length>0?i[i.length-1]:n}static fromUrn(e){return new fn(e,e)}static fromUrl(e){return e.includes("docs.b360")?fn.getItemIdFromB360Url(e):e.includes("acc.autodesk")?fn.getItemIdFromACCUrl(e):e.includes("api.autodesk")?fn.getItemIdFromDataManagementUrl(e):null}static getItemIdFromB360Url(e){return fn.getItemIdFromUrl(e,"/","items")}static getItemIdFromACCUrl(e){return fn.getItemIdFromUrl(e,"=","entityId")}static getItemIdFromDataManagementUrl(e){return fn.getItemIdFromUrl(e,"/","versions")}static getItemIdFromUrl(e,t,r){const n=e.split(t),i=n.findIndex(e=>e.includes(r));if(i>-1){let t=n[i+1];return t=(null==t?void 0:t.split(/\?|&/))[0],new fn(t,e)}return null}}function mn(e,t){return function(){return e.apply(t,arguments)}}const{toString:gn}=Object.prototype,{getPrototypeOf:vn}=Object,{iterator:yn,toStringTag:wn}=Symbol,bn=(e=>t=>{const r=gn.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),_n=e=>(e=e.toLowerCase(),t=>bn(t)===e),Sn=e=>t=>typeof t===e,{isArray:In}=Array,En=Sn("undefined");const An=_n("ArrayBuffer");const Rn=Sn("string"),kn=Sn("function"),Tn=Sn("number"),Cn=e=>null!==e&&"object"==typeof e,On=e=>{if("object"!==bn(e))return!1;const t=vn(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||wn in e||yn in e)},Dn=_n("Date"),jn=_n("File"),xn=_n("Blob"),Pn=_n("FileList"),Nn=_n("URLSearchParams"),[Ln,Un,Fn,Mn]=["ReadableStream","Request","Response","Headers"].map(_n);function $n(e,t,{allOwnKeys:r=!1}={}){if(null===e||typeof e>"u")return;let n,i;if("object"!=typeof e&&(e=[e]),In(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function Bn(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Vn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qn=e=>!En(e)&&e!==Vn;const zn=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&vn(Uint8Array)),Gn=_n("HTMLFormElement"),Wn=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Hn=_n("RegExp"),Jn=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};$n(r,(r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)}),Object.defineProperties(e,n)};const Kn=_n("AsyncFunction"),Yn=((e,t)=>e?setImmediate:t?((e,t)=>(Vn.addEventListener("message",({source:r,data:n})=>{r===Vn&&n===e&&t.length&&t.shift()()},!1),r=>{t.push(r),Vn.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))("function"==typeof setImmediate,kn(Vn.postMessage)),Zn=typeof queueMicrotask<"u"?queueMicrotask.bind(Vn):typeof process<"u"&&process.nextTick||Yn,Xn={isArray:In,isArrayBuffer:An,isBuffer:function(e){return null!==e&&!En(e)&&null!==e.constructor&&!En(e.constructor)&&kn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||kn(e.append)&&("formdata"===(t=bn(e))||"object"===t&&kn(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&An(e.buffer),t},isString:Rn,isNumber:Tn,isBoolean:e=>!0===e||!1===e,isObject:Cn,isPlainObject:On,isReadableStream:Ln,isRequest:Un,isResponse:Fn,isHeaders:Mn,isUndefined:En,isDate:Dn,isFile:jn,isBlob:xn,isRegExp:Hn,isFunction:kn,isStream:e=>Cn(e)&&kn(e.pipe),isURLSearchParams:Nn,isTypedArray:zn,isFileList:Pn,forEach:$n,merge:function e(){const{caseless:t}=qn(this)&&this||{},r={},n=(n,i)=>{const s=t&&Bn(r,i)||i;On(r[s])&&On(n)?r[s]=e(r[s],n):On(n)?r[s]=e({},n):In(n)?r[s]=n.slice():r[s]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&$n(arguments[e],n);return r},extend:(e,t,r,{allOwnKeys:n}={})=>($n(t,(t,n)=>{r&&kn(t)?e[n]=mn(t,r):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,o;const a={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=!1!==r&&vn(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:bn,kindOfTest:_n,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(In(e))return e;let t=e.length;if(!Tn(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[yn]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:Gn,hasOwnProperty:Wn,hasOwnProp:Wn,reduceDescriptors:Jn,freezeMethods:e=>{Jn(e,(t,r)=>{if(kn(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];if(kn(n)){if(t.enumerable=!1,"writable"in t)return void(t.writable=!1);t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return In(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Bn,global:Vn,isContextDefined:qn,isSpecCompliantForm:function(e){return!!(e&&kn(e.append)&&"FormData"===e[wn]&&e[yn])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(Cn(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=In(e)?[]:{};return $n(e,(e,t)=>{const s=r(e,n+1);!En(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:Kn,isThenable:e=>e&&(Cn(e)||kn(e))&&kn(e.then)&&kn(e.catch),setImmediate:Yn,asap:Zn,isIterable:e=>null!=e&&kn(e[yn])};function Qn(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Xn.inherits(Qn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xn.toJSONObject(this.config),code:this.code,status:this.status}}});const ei=Qn.prototype,ti={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ti[e]={value:e}}),Object.defineProperties(Qn,ti),Object.defineProperty(ei,"isAxiosError",{value:!0}),Qn.from=(e,t,r,n,i,s)=>{const o=Object.create(ei);return Xn.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Qn.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function ri(e){return Xn.isPlainObject(e)||Xn.isArray(e)}function ni(e){return Xn.endsWith(e,"[]")?e.slice(0,-2):e}function ii(e,t,r){return e?e.concat(t).map(function(e,t){return e=ni(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const si=Xn.toFlatObject(Xn,{},null,function(e){return/^is[A-Z]/.test(e)});function oi(e,t,r){if(!Xn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=Xn.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Xn.isUndefined(t[e])});const n=r.metaTokens,i=r.visitor||c,s=r.dots,o=r.indexes,a=(r.Blob||typeof Blob<"u"&&Blob)&&Xn.isSpecCompliantForm(t);if(!Xn.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Xn.isDate(e))return e.toISOString();if(!a&&Xn.isBlob(e))throw new Qn("Blob is not supported. Use a Buffer instead.");return Xn.isArrayBuffer(e)||Xn.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,i){let a=e;if(e&&!i&&"object"==typeof e)if(Xn.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(Xn.isArray(e)&&function(e){return Xn.isArray(e)&&!e.some(ri)}(e)||(Xn.isFileList(e)||Xn.endsWith(r,"[]"))&&(a=Xn.toArray(e)))return r=ni(r),a.forEach(function(e,n){!Xn.isUndefined(e)&&null!==e&&t.append(!0===o?ii([r],n,s):null===o?r:r+"[]",l(e))}),!1;return!!ri(e)||(t.append(ii(i,r,s),l(e)),!1)}const u=[],d=Object.assign(si,{defaultVisitor:c,convertValue:l,isVisitable:ri});if(!Xn.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!Xn.isUndefined(r)){if(-1!==u.indexOf(r))throw Error("Circular reference detected in "+n.join("."));u.push(r),Xn.forEach(r,function(r,s){!0===(!(Xn.isUndefined(r)||null===r)&&i.call(t,r,Xn.isString(s)?s.trim():s,n,d))&&e(r,n?n.concat(s):[s])}),u.pop()}}(e),t}function ai(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function li(e,t){this._pairs=[],e&&oi(e,this,t)}const ci=li.prototype;function ui(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function di(e,t,r){if(!t)return e;const n=r&&r.encode||ui;Xn.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let s;if(s=i?i(t,r):Xn.isURLSearchParams(t)?t.toString():new li(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}ci.append=function(e,t){this._pairs.push([e,t])},ci.toString=function(e){const t=e?function(t){return e.call(this,t,ai)}:ai;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class hi{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Xn.forEach(this.handlers,function(t){null!==t&&e(t)})}}const pi={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fi={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:li,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},mi=typeof window<"u"&&typeof document<"u",gi="object"==typeof navigator&&navigator||void 0,vi=mi&&(!gi||["ReactNative","NativeScript","NS"].indexOf(gi.product)<0),yi=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,wi=mi&&window.location.href||"http://localhost",bi={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:mi,hasStandardBrowserEnv:vi,hasStandardBrowserWebWorkerEnv:yi,navigator:gi,origin:wi},Symbol.toStringTag,{value:"Module"})),...fi};function _i(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),a=i>=e.length;return s=!s&&Xn.isArray(n)?n.length:s,a?(Xn.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!Xn.isObject(n[s]))&&(n[s]=[]),t(e,r,n[s],i)&&Xn.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}(n[s])),!o)}if(Xn.isFormData(e)&&Xn.isFunction(e.entries)){const r={};return Xn.forEachEntry(e,(e,n)=>{t(function(e){return Xn.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null}const Si={transitional:pi,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=Xn.isObject(e);if(i&&Xn.isHTMLForm(e)&&(e=new FormData(e)),Xn.isFormData(e))return n?JSON.stringify(_i(e)):e;if(Xn.isArrayBuffer(e)||Xn.isBuffer(e)||Xn.isStream(e)||Xn.isFile(e)||Xn.isBlob(e)||Xn.isReadableStream(e))return e;if(Xn.isArrayBufferView(e))return e.buffer;if(Xn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return oi(e,new bi.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return bi.isNode&&Xn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Xn.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return oi(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(Xn.isString(e))try{return(t||JSON.parse)(e),Xn.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Si.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Xn.isResponse(e)||Xn.isReadableStream(e))return e;if(e&&Xn.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r)throw"SyntaxError"===e.name?Qn.from(e,Qn.ERR_BAD_RESPONSE,this,null,this.response):e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bi.classes.FormData,Blob:bi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xn.forEach(["delete","get","head","post","put","patch"],e=>{Si.headers[e]={}});const Ii=Xn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ei=Symbol("internals");function Ai(e){return e&&String(e).trim().toLowerCase()}function Ri(e){return!1===e||null==e?e:Xn.isArray(e)?e.map(Ri):String(e)}function ki(e,t,r,n,i){if(Xn.isFunction(n))return n.call(this,t,r);if(i&&(t=r),Xn.isString(t)){if(Xn.isString(n))return-1!==t.indexOf(n);if(Xn.isRegExp(n))return n.test(t)}}let Ti=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=Ai(t);if(!i)throw new Error("header name must be a non-empty string");const s=Xn.findKey(n,i);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=Ri(e))}const s=(e,t)=>Xn.forEach(e,(e,r)=>i(e,r,t));if(Xn.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Xn.isString(e)&&(e=e.trim())&&!(e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))(e))s((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!(!r||t[r]&&Ii[r])&&("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(Xn.isObject(e)&&Xn.isIterable(e)){let r,n,i={};for(const t of e){if(!Xn.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(r=i[n])?Xn.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,r);return this}get(e,t){if(e=Ai(e)){const r=Xn.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(Xn.isFunction(t))return t.call(this,e,r);if(Xn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ai(e)){const r=Xn.findKey(this,e);return!(!r||void 0===this[r]||t&&!ki(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=Ai(e)){const i=Xn.findKey(r,e);i&&(!t||ki(0,r[i],i,t))&&(delete r[i],n=!0)}}return Xn.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];(!e||ki(0,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return Xn.forEach(this,(n,i)=>{const s=Xn.findKey(r,i);if(s)return t[s]=Ri(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(i):String(i).trim();o!==i&&delete t[i],t[o]=Ri(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Xn.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&Xn.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(e=>r.set(e)),r}static accessor(e){const t=(this[Ei]=this[Ei]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=Ai(e);t[n]||(function(e,t){const r=Xn.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})})}(r,e),t[n]=!0)}return Xn.isArray(e)?e.forEach(n):n(e),this}};function Ci(e,t){const r=this||Si,n=t||r,i=Ti.from(n.headers);let s=n.data;return Xn.forEach(e,function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function Oi(e){return!(!e||!e.__CANCEL__)}function Di(e,t,r){Qn.call(this,e??"canceled",Qn.ERR_CANCELED,t,r),this.name="CanceledError"}function ji(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Qn("Request failed with status code "+r.status,[Qn.ERR_BAD_REQUEST,Qn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Ti.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Xn.reduceDescriptors(Ti.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}}),Xn.freezeMethods(Ti),Xn.inherits(Di,Qn,{__CANCEL__:!0});const xi=(e,t,r=3)=>{let n=0;const i=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=n[o];i||(i=l),r[s]=a,n[s]=l;let u=o,d=0;for(;u!==s;)d+=r[u++],u%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}}(50,250);return function(e,t){let r,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),a=t-i;a>=s?o(e,t):(r=e,n||(n=setTimeout(()=>{n=null,o(r)},s-a)))},()=>r&&o(r)]}(r=>{const s=r.loaded,o=r.lengthComputable?r.total:void 0,a=s-n,l=i(a);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},Pi=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Ni=e=>(...t)=>Xn.asap(()=>e(...t)),Li=bi.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,bi.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(bi.origin),bi.navigator&&/(msie|trident)/i.test(bi.navigator.userAgent)):()=>!0,Ui=bi.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const o=[e+"="+encodeURIComponent(t)];Xn.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),Xn.isString(n)&&o.push("path="+n),Xn.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Fi(e,t,r){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Mi=e=>e instanceof Ti?{...e}:e;function $i(e,t){t=t||{};const r={};function n(e,t,r,n){return Xn.isPlainObject(e)&&Xn.isPlainObject(t)?Xn.merge.call({caseless:n},e,t):Xn.isPlainObject(t)?Xn.merge({},t):Xn.isArray(t)?t.slice():t}function i(e,t,r,i){return Xn.isUndefined(t)?Xn.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Xn.isUndefined(t))return n(void 0,t)}function o(e,t){return Xn.isUndefined(t)?Xn.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t,r)=>i(Mi(e),Mi(t),0,!0)};return Xn.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);Xn.isUndefined(o)&&s!==a||(r[n]=o)}),r}const Bi=e=>{const t=$i({},e);let r,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=t;if(t.headers=a=Ti.from(a),t.url=di(Fi(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Xn.isFormData(n))if(bi.hasStandardBrowserEnv||bi.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(r=a.getContentType())){const[e,...t]=r?r.split(";").map(e=>e.trim()).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...t].join("; "))}if(bi.hasStandardBrowserEnv&&(i&&Xn.isFunction(i)&&(i=i(t)),i||!1!==i&&Li(t.url))){const e=s&&o&&Ui.read(o);e&&a.set(s,e)}return t},Vi=typeof XMLHttpRequest<"u"&&function(e){return new Promise(function(t,r){const n=Bi(e);let i=n.data;const s=Ti.from(n.headers).normalize();let o,a,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:p}=n;function f(){c&&c(),u&&u(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const n=Ti.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());ji(function(e){t(e),f()},function(e){r(e),f()},{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:e,request:m}),m=null}m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){!m||4!==m.readyState||0===m.status&&(!m.responseURL||0!==m.responseURL.indexOf("file:"))||setTimeout(g)},m.onabort=function(){m&&(r(new Qn("Request aborted",Qn.ECONNABORTED,e,m)),m=null)},m.onerror=function(){r(new Qn("Network Error",Qn.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||pi;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new Qn(t,i.clarifyTimeoutError?Qn.ETIMEDOUT:Qn.ECONNABORTED,e,m)),m=null},void 0===i&&s.setContentType(null),"setRequestHeader"in m&&Xn.forEach(s.toJSON(),function(e,t){m.setRequestHeader(t,e)}),Xn.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),d&&"json"!==d&&(m.responseType=n.responseType),p&&([l,u]=xi(p,!0),m.addEventListener("progress",l)),h&&m.upload&&([a,c]=xi(h),m.upload.addEventListener("progress",a),m.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{m&&(r(!t||t.type?new Di(null,e,m):t),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===bi.protocols.indexOf(v)?r(new Qn("Unsupported protocol "+v+":",Qn.ERR_BAD_REQUEST,e)):m.send(i||null)})},qi=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const i=function(e){if(!r){r=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Qn?t:new Di(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Qn(`timeout ${t} of ms exceeded`,Qn.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:a}=n;return a.unsubscribe=()=>Xn.asap(o),a}},zi=function*(e,t){let r=e.byteLength;if(r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},Gi=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},Wi=(e,t,r,n)=>{const i=async function*(e,t){for await(const r of Gi(e))yield*zi(r,t)}(e,t);let s,o=0,a=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return a(),void e.close();let s=n.byteLength;if(r){let e=o+=s;r(e)}e.enqueue(new Uint8Array(n))}catch(e){throw a(e),e}},cancel:e=>(a(e),i.return())},{highWaterMark:2})},Hi="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Ji=Hi&&"function"==typeof ReadableStream,Ki=Hi&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Yi=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Zi=Ji&&Yi(()=>{let e=!1;const t=new Request(bi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Xi=Ji&&Yi(()=>Xn.isReadableStream(new Response("").body)),Qi={stream:Xi&&(e=>e.body)};Hi&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Qi[t]&&(Qi[t]=Xn.isFunction(e[t])?e=>e[t]():(e,r)=>{throw new Qn(`Response type '${t}' is not supported`,Qn.ERR_NOT_SUPPORT,r)})})})(new Response);const es=async(e,t)=>Xn.toFiniteNumber(e.getContentLength())??(async e=>null==e?0:Xn.isBlob(e)?e.size:Xn.isSpecCompliantForm(e)?(await new Request(bi.origin,{method:"POST",body:e}).arrayBuffer()).byteLength:Xn.isArrayBufferView(e)||Xn.isArrayBuffer(e)?e.byteLength:(Xn.isURLSearchParams(e)&&(e+=""),Xn.isString(e)?(await Ki(e)).byteLength:void 0))(t),ts=Hi&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:h}=Bi(e);c=c?(c+"").toLowerCase():"text";let p,f=qi([i,s&&s.toAbortSignal()],o);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(l&&Zi&&"get"!==r&&"head"!==r&&0!==(g=await es(u,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(Xn.isFormData(n)&&(e=r.headers.get("content-type"))&&u.setContentType(e),r.body){const[e,t]=Pi(g,xi(Ni(l)));n=Wi(r.body,65536,e,t)}}Xn.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:f,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:i?d:void 0});let s=await fetch(p);const o=Xi&&("stream"===c||"response"===c);if(Xi&&(a||o&&m)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Xn.toFiniteNumber(s.headers.get("content-length")),[r,n]=a&&Pi(t,xi(Ni(a),!0))||[];s=new Response(Wi(s.body,65536,r,()=>{n&&n(),m&&m()}),e)}c=c||"text";let v=await Qi[Xn.findKey(Qi,c)||"text"](s,e);return!o&&m&&m(),await new Promise((t,r)=>{ji(t,r,{data:v,headers:Ti.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(t){throw m&&m(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message)?Object.assign(new Qn("Network Error",Qn.ERR_NETWORK,e,p),{cause:t.cause||t}):Qn.from(t,t&&t.code,e,p)}}),rs={http:null,xhr:Vi,fetch:ts};Xn.forEach(rs,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const ns=e=>`- ${e}`,is=e=>Xn.isFunction(e)||null===e||!1===e,ss=e=>{e=Xn.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){let t;if(r=e[s],n=r,!is(r)&&(n=rs[(t=String(r)).toLowerCase()],void 0===n))throw new Qn(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Qn("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(ns).join("\n"):" "+ns(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function os(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Di(null,e)}function as(e){return os(e),e.headers=Ti.from(e.headers),e.data=Ci.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),ss(e.adapter||Si.adapter)(e).then(function(t){return os(e),t.data=Ci.call(e,e.transformResponse,t),t.headers=Ti.from(t.headers),t},function(t){return Oi(t)||(os(e),t&&t.response&&(t.response.data=Ci.call(e,e.transformResponse,t.response),t.response.headers=Ti.from(t.response.headers))),Promise.reject(t)})}const ls="1.9.0",cs={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{cs[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const us={};cs.transitional=function(e,t,r){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new Qn(n(i," has been removed"+(t?" in "+t:"")),Qn.ERR_DEPRECATED);return t&&!us[i]&&(us[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},cs.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};const ds={assertOptions:function(e,t,r){if("object"!=typeof e)throw new Qn("options must be an object",Qn.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],r=void 0===t||o(t,s,e);if(!0!==r)throw new Qn("option "+s+" must be "+r,Qn.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new Qn("Unknown option "+s,Qn.ERR_BAD_OPTION)}},validators:cs},hs=ds.validators;let ps=class{constructor(e){this.defaults=e||{},this.interceptors={request:new hi,response:new hi}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const r=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?r&&!String(e.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+r):e.stack=r}catch{}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=$i(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;void 0!==r&&ds.assertOptions(r,{silentJSONParsing:hs.transitional(hs.boolean),forcedJSONParsing:hs.transitional(hs.boolean),clarifyTimeoutError:hs.transitional(hs.boolean)},!1),null!=n&&(Xn.isFunction(n)?t.paramsSerializer={serialize:n}:ds.assertOptions(n,{encode:hs.function,serialize:hs.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ds.assertOptions(t,{baseUrl:hs.spelling("baseURL"),withXsrfToken:hs.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Xn.merge(i.common,i[t.method]);i&&Xn.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=Ti.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let c,u,d=0;if(!a){const e=[as.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=o.length;let h=t;for(d=0;d<u;){const e=o[d++],t=o[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{c=as.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return di(Fi((e=$i(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Xn.forEach(["delete","get","head","options"],function(e){ps.prototype[e]=function(t,r){return this.request($i(r||{},{method:e,url:t,data:(r||{}).data}))}}),Xn.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,i){return this.request($i(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}ps.prototype[e]=t(),ps.prototype[e+"Form"]=t(!0)});const fs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(fs).forEach(([e,t])=>{fs[t]=e});const ms=function e(t){const r=new ps(t),n=mn(ps.prototype.request,r);return Xn.extend(n,ps.prototype,r,{allOwnKeys:!0}),Xn.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e($i(t,r))},n}(Si);ms.Axios=ps,ms.CanceledError=Di,ms.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,i){r.reason||(r.reason=new Di(e,n,i),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},ms.isCancel=Oi,ms.VERSION=ls,ms.toFormData=oi,ms.AxiosError=Qn,ms.Cancel=ms.CanceledError,ms.all=function(e){return Promise.all(e)},ms.spread=function(e){return function(t){return e.apply(null,t)}},ms.isAxiosError=function(e){return Xn.isObject(e)&&!0===e.isAxiosError},ms.mergeConfig=$i,ms.AxiosHeaders=Ti,ms.formToJSON=e=>_i(Xn.isHTMLForm(e)?new FormData(e):e),ms.getAdapter=ss,ms.HttpStatusCode=fs,ms.default=ms;const{Axios:gs,AxiosError:vs,CanceledError:ys,isCancel:ws,CancelToken:bs,VERSION:_s,all:Ss,Cancel:Is,isAxiosError:Es,spread:As,toFormData:Rs,AxiosHeaders:ks,HttpStatusCode:Ts,formToJSON:Cs,getAdapter:Os,mergeConfig:Ds}=ms,js=class e{constructor(){return Ir(this,"cache",[]),Ir(this,"initializeCache",e=>{this.cache.push(...e)}),Ir(this,"set",(e,t,r)=>{this.recordExists(e,r)||this.cache.push({url:e,body:r,result:t})}),Ir(this,"get",(e,t)=>{const r=this.cache.find(r=>null!=t?r.url===e&&r.body===t:r.url===e);return null!=r?r.result:null}),Ir(this,"recordExists",(e,t)=>null!=this.get(e,t)),null!=e.instance?e.instance:(e.instance=this,this)}};Ir(js,"instance");let xs=js;class Ps{constructor(e){Ir(this,"getToken"),Ir(this,"cache",new xs),Ir(this,"getData",async e=>{if(this.cache.recordExists(e))return this.cache.get(e);try{const t=await this.getToken(),r=await ms.get(e,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return this.cache.set(e,r),r}catch(t){return console.error(`API call '${e}' fails with exception:`,t),null}}),this.getToken=e}}class Ns{constructor(e){Ir(this,"dataManagementAPI"),Ir(this,"supportedViewerFormats"),Ir(this,"getIssueByUrl",async e=>await this.dataManagementAPI.getIssueDataByUrl(e)),Ir(this,"getUser",async()=>await this.dataManagementAPI.getUser()),Ir(this,"getHubs",async()=>await this.dataManagementAPI.getHubs()),Ir(this,"getHubRegion",async e=>{var t;const r=(await this.dataManagementAPI.getHubs()).find(t=>t.id===e);return(null==(t=null==r?void 0:r.attributes)?void 0:t.region)??"US"}),Ir(this,"getProjects",async e=>await this.dataManagementAPI.getProjects(e)),Ir(this,"getBIMDocument",async({projectId:e,itemId:t,versionId:r})=>{if(void 0===t&&void 0===r)throw new Error("Invalid parameters: itemId or versionId must be provided");let n=null;return void 0!==t?n=await this.getLatestVersion(e,t):void 0!==r&&(n=await this.dataManagementAPI.getVersion(e,r)),null===n||n.isDeleted?null:n}),Ir(this,"getProject",async(e,t)=>await this.dataManagementAPI.getProject(e,t)??null),Ir(this,"getLatestVersion",async(e,t)=>{const r=await this.dataManagementAPI.getItemTipVersion(e,t);if(null===r)return null;if(!r.isDeleted)return r;const n=await this.dataManagementAPI.getItemVersions(e,t);return null==n||n.sort((e,t)=>{var r,n;return(null==(r=null==t?void 0:t.attributes)?void 0:r.versionNumber)-(null==(n=null==e?void 0:e.attributes)?void 0:n.versionNumber)}),(null==n?void 0:n.find(e=>!e.isDeleted))??null}),Ir(this,"searchFolder",async(e,t,r)=>{const n=this.buildFilter(r);return 0===n.length?[]:await this.dataManagementAPI.searchFolder(e,t,n)}),Ir(this,"buildFilter",e=>{if(""===e||"function"!=typeof(null==e?void 0:e.toString))return"";const t=e.toString(),r=[t];t.toLocaleLowerCase()!==t&&r.push(t.toLocaleLowerCase()),t.toLocaleUpperCase()!==t&&r.push(t.toLocaleUpperCase()),this.capitalizeFirstLetter(t)!==t&&r.push(this.capitalizeFirstLetter(t));const n=r.reduce((e,t)=>`${e}filter[attributes.displayName]-contains=${t}&`,"");return n.substring(0,n.length-1)}),Ir(this,"capitalizeFirstLetter",e=>{if(0===e.length)return"";const t=e.codePointAt(0);if(null==t)return"";const r=t>65535?2:1;return String.fromCodePoint(t).toUpperCase()+e.slice(r)}),Ir(this,"getContent",async e=>{var t,r,n,i;const s=[];if(e.length>0)for(let o=0;o<e.length;o++){let a=e[o];for(;null!=a;){const e=await this.dataManagementAPI.getDataByUrl(a);a=void 0!==(null==(r=null==(t=e.links)?void 0:t.next)?void 0:r.href)?null==(i=null==(n=e.links)?void 0:n.next)?void 0:i.href:null;const o=Array.isArray(e.data)?e.data:[],l=Array.isArray(e.included)?e.included:[];s.push(...o,...l)}}else try{const e=await this.getHubs();s.push(...e)}catch(e){return console.warn(e),null}return s}),Ir(this,"isValidViewerFormat",async e=>{if(e.type!==Jr.ITEMS&&e.type!==Jr.VERSIONS)return!1;const t=await this.getViewerFormats();if(void 0===e.attributes.fileType)return!1;const r=e.attributes.fileType.toLowerCase();return t.some(e=>e.toLowerCase()===r)}),Ir(this,"getViewerFormats",async()=>{var e;if(null!=this.supportedViewerFormats)return this.supportedViewerFormats;const t=await this.dataManagementAPI.getFormats(),r=(null==(e=null==t?void 0:t.formats)?void 0:e.svf2)??[];return this.supportedViewerFormats=r.concat(this.getModelViewerAdditionalSupportedFormats().filter(e=>!r.includes(e))),this.supportedViewerFormats}),Ir(this,"getModelViewerAdditionalSupportedFormats",()=>["jpg","jpeg","png"]),this.dataManagementAPI=e}}class Ls{constructor(e){Ir(this,"apsDataAPI"),Ir(this,"developerAPIBaseUrl","https://developer.api.autodesk.com"),Ir(this,"dataManagementBaseUrl",`${this.developerAPIBaseUrl}/data/v1`),Ir(this,"derivativeBaseUrl",`${this.developerAPIBaseUrl}/modelderivative/v2`),Ir(this,"getUser",async()=>{const e=await this.apsDataAPI.getData("https://api.userprofile.autodesk.com/userinfo");return(null==e?void 0:e.data)??null}),Ir(this,"getHubs",async()=>{var e,t;const r=await this.apsDataAPI.getData(`${this.developerAPIBaseUrl}/project/v1/hubs`);return(null==(t=null==(e=null==r?void 0:r.data)?void 0:e.data)?void 0:t.map(e=>this.createApsHub(e)))??[]}),Ir(this,"getProjects",async e=>{var t,r;const n=`${this.developerAPIBaseUrl}/project/v1/hubs/${e}/projects`,i=await this.apsDataAPI.getData(n);return(null==(r=null==(t=null==i?void 0:i.data)?void 0:t.data)?void 0:r.map(e=>this.createApsProject(e)))??[]}),Ir(this,"getProject",async(e,t)=>{var r;const n=`${this.developerAPIBaseUrl}/project/v1/hubs/${e}/projects/${t}`,i=await this.apsDataAPI.getData(n);return void 0!==(null==(r=null==i?void 0:i.data)?void 0:r.data)?this.createApsProject(i.data.data):null}),Ir(this,"getItemVersions",async(e,t)=>{var r,n;const i=await this.apsDataAPI.getData(`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}/versions`);return(null==(n=null==(r=null==i?void 0:i.data)?void 0:r.data)?void 0:n.map(e=>this.createApsVersion(e)))??[]}),Ir(this,"getItemTipVersion",async(e,t)=>{var r;const n=await this.apsDataAPI.getData(`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}/tip`);return void 0!==(null==(r=null==n?void 0:n.data)?void 0:r.data)?this.createApsVersion(n.data.data):null}),Ir(this,"getItem",async(e,t)=>{var r;const n=`${this.dataManagementBaseUrl}/projects/${e}/items/${encodeURIComponent(t)}`,i=await this.apsDataAPI.getData(n);return void 0!==(null==(r=null==i?void 0:i.data)?void 0:r.data)?this.createApsItems(i.data.data):null}),Ir(this,"getVersion",async(e,t)=>{var r;const n=await this.apsDataAPI.getData(`${this.dataManagementBaseUrl}/projects/${e}/versions/${encodeURIComponent(t)}`);return void 0!==(null==(r=null==n?void 0:n.data)?void 0:r.data)?this.createApsVersion(n.data.data):null}),Ir(this,"searchFolder",async(e,t,r)=>{var n,i,s,o,a,l,c,u,d;let h=null,p=[];if(0===r.length)return[];let f=`${this.dataManagementBaseUrl}/projects/${e}/folders/${t}/search?${r}`;do{null!=(null==(s=null==(i=null==(n=null==h?void 0:h.data)?void 0:n.links)?void 0:i.next)?void 0:s.href)&&(f=h.data.links.next.href),h=await this.apsDataAPI.getData(f);const e=null==(a=null==(o=null==h?void 0:h.data)?void 0:o.data)?void 0:a.length;void 0!==e&&e>0&&(p=p.concat((null==(l=null==h?void 0:h.data)?void 0:l.data)??[]))}while(null!=(null==(d=null==(u=null==(c=null==h?void 0:h.data)?void 0:c.links)?void 0:u.next)?void 0:d.href));return p.map(e=>this.createApsVersion(e))}),Ir(this,"getDataByUrl",async e=>{var t,r,n;const i={data:[],included:[]};try{const s=await this.apsDataAPI.getData(e);if(null!=(null==(t=null==s?void 0:s.data)?void 0:t.links)&&(i.links=s.data.links),null!=(null==(r=null==s?void 0:s.data)?void 0:r.data)){const e=(Array.isArray(s.data.data)?s.data.data:[s.data.data]).map(e=>this.createApsRepositoryItem(e)).filter(e=>null!==e);i.data.push(...e)}if(null!=(null==(n=null==s?void 0:s.data)?void 0:n.included)){const e=(Array.isArray(s.data.included)?s.data.included:[s.data.included]).map(e=>this.createApsRepositoryItem(e)).filter(e=>null!==e);i.included.push(...e)}}catch(e){console.error(e)}return i}),Ir(this,"getIssueDataByUrl",async e=>{try{const t=await this.apsDataAPI.getData(e);if(null!=(null==t?void 0:t.data))return this.getApsIssueJson(t.data)}catch(e){console.error(e)}return null}),Ir(this,"getApsIssueJson",e=>{var t;return{id:e.id,title:e.title,displayId:e.displayId,description:e.description,status:e.status,published:e.published,target_urn:null==(t=e.linkedDocuments[0])?void 0:t.urn,issueSubtypeId:e.issueSubtypeId,issueTypeId:e.issueTypeId,createdAt:e.createdAt,updatedAt:e.updatedAt,locationDetails:e.locationDetails,dueDate:e.dueDate,rootCauseId:e.rootCauseId,ownerId:e.ownerId,linkedDocuments:e.linkedDocuments}}),Ir(this,"getFormats",async()=>{const e=`${this.derivativeBaseUrl}/designdata/formats`,t=await this.apsDataAPI.getData(e);return null==t?void 0:t.data}),Ir(this,"createApsRepositoryItem",e=>{switch(e.type){case Jr.HUBS:return this.createApsHub(e);case Jr.PROJECTS:return this.createApsProject(e);case Jr.VERSIONS:return this.createApsVersion(e);case Jr.FOLDERS:return this.createApsFolder(e);case Jr.ITEMS:return this.createApsItems(e);default:return console.error("Unsupported data type: ",e.type),null}}),Ir(this,"createApsProject",e=>{var t,r;return{id:e.id,type:Jr.PROJECTS,attributes:{name:null==(t=e.attributes)?void 0:t.name,extension:null==(r=e.attributes)?void 0:r.extension},relationships:e.relationships}}),Ir(this,"createApsHub",e=>{var t,r;return{id:e.id,type:Jr.HUBS,attributes:{name:(null==(t=e.attributes)?void 0:t.name)??"",region:(null==(r=e.attributes)?void 0:r.region)??"US"},relationships:e.relationships}}),Ir(this,"createApsFolder",e=>{var t,r,n,i,s,o,a,l,c;return{id:e.id,type:Jr.FOLDERS,attributes:{name:e.attributes.name,displayName:e.attributes.displayName,hidden:e.attributes.hidden},links:e.links,relationships:{contents:null==(t=e.relationships)?void 0:t.contents,parent:{data:{type:null==(i=null==(n=null==(r=e.relationships)?void 0:r.parent)?void 0:n.data)?void 0:i.type,id:(null==(a=null==(o=null==(s=e.relationships)?void 0:s.parent)?void 0:o.data)?void 0:a.id)??""},links:null==(c=null==(l=e.relationships)?void 0:l.parent)?void 0:c.links}}}}),Ir(this,"createApsVersion",e=>{var t,r;const n=null==(r=null==(t=null==e?void 0:e.attributes)?void 0:t.extension)?void 0:r.type,i=(null==n?void 0:n.length)>0&&n.endsWith("Deleted");return{id:e.id,type:Jr.VERSIONS,isDeleted:i,attributes:{name:e.attributes.name,displayName:e.attributes.displayName,versionNumber:e.attributes.versionNumber,fileType:e.attributes.fileType,createTime:e.attributes.createTime,createUserId:e.attributes.createUserId,createUserName:e.attributes.createUserName,lastModifiedTime:e.attributes.lastModifiedTime,lastModifiedUserId:e.attributes.lastModifiedUserId,lastModifiedUserName:e.attributes.lastModifiedUserName},links:e.links}}),Ir(this,"createApsItems",e=>{var t;return{id:e.id,type:Jr.ITEMS,attributes:{displayName:e.attributes.displayName,hidden:e.attributes.hidden,createTime:e.attributes.createTime,createUserId:e.attributes.createUserId,createUserName:e.attributes.createUserName,lastModifiedTime:e.attributes.lastModifiedTime,lastModifiedUserId:e.attributes.lastModifiedUserId,lastModifiedUserName:e.attributes.lastModifiedUserName,fileType:null==(t=e.attributes.displayName.split(".").pop())?void 0:t.toLowerCase()},links:e.links,relationships:e.relationships}}),this.apsDataAPI=e}}class Us{constructor(e){Ir(this,"dataManagement"),Ir(this,"bimAccounts"),Ir(this,"checkAccountAccess",async e=>{if(null==e)return!0;const t=await this.getAllAccounts();return Object.keys(t).some(t=>t===e.accountId)}),Ir(this,"getAccounts",async e=>{const t=await this.getAllAccounts();if(null==e)return t;if(!await this.checkAccountAccess(e))return null;const r={},n=e;if(null!=n.projectIds&&n.projectIds.length>0){const e=null!=t[n.accountId].projects?t[n.accountId].projects.filter(e=>{var t;return(null==(t=n.projectIds)?void 0:t.includes(e.id))??!1}):[];r[n.accountId]={id:n.accountId,name:t[n.accountId].name,projects:e}}else r[n.accountId]=t[n.accountId];return r}),Ir(this,"getProjectsAccount",async(e,t=null)=>{const r=await this.getAccounts(t);return null===r?null:Object.values(r).find(t=>t.projects.some(t=>t.id===e))??null}),Ir(this,"getProjectsAccountName",async(e,t=null)=>{const r=await this.getProjectsAccount(e,t);return(null==r?void 0:r.name)??""}),Ir(this,"getProjectsAccountId",async(e,t=null)=>{const r=await this.getProjectsAccount(e,t);return(null==r?void 0:r.id)??""}),Ir(this,"getProjectName",async e=>{const t=await this.getAllAccounts(),r=Object.values(t).find(t=>t.projects.some(t=>t.id===e)),n=null==r?void 0:r.projects.find(t=>t.id===e);return(null==n?void 0:n.name)??""}),Ir(this,"getAccountByName",async(e,t=null)=>{const r=await this.getAccounts(t);return null===r?null:Object.values(r).find(t=>t.name===e)??null}),Ir(this,"getAllAccounts",async()=>{var e;if(void 0!==this.bimAccounts)return this.bimAccounts;const t={},r=await this.dataManagement.getHubs();for(const n of r)if(void 0!==n.id){const r=await this.dataManagement.getProjects(n.id),i=[];r.forEach(e=>{var t;void 0!==e.id&&void 0!==(null==(t=e.attributes)?void 0:t.name)&&i.push({id:e.id,name:e.attributes.name})}),t[n.id]={id:n.id,projects:i,name:null==(e=n.attributes)?void 0:e.name}}return this.bimAccounts=t,this.bimAccounts}),this.dataManagement=e}}const Fs=class e{constructor(e,t,r){Ir(this,"tokenInfo"),Ir(this,"dataManagement"),Ir(this,"issues"),Ir(this,"search"),Ir(this,"regions"),Ir(this,"accounts"),Ir(this,"accountFilter"),Ir(this,"getProviderName",()=>"Autodesk"),Ir(this,"setToken",e=>{this.tokenInfo=e}),Ir(this,"getToken",async()=>{const e=this.tokenInfo.access_token??await this.tokenInfo.getToken();if(null===e||0===e.length)throw new Error("Invalid Token: token is null");return e}),Ir(this,"getUser",async()=>{const e=await this.dataManagement.getUser();return`${null==e?void 0:e.name}`}),Ir(this,"checkPermissions",async e=>void 0!==e.url&&e.url.length>0),Ir(this,"setAccountFilter",e=>{this.accountFilter=e}),Ir(this,"getFilter",e=>e??this.accountFilter),Ir(this,"getDocument",async(e,t)=>{const r=this.getFilter(t),n=e,i=n.projectId,s=n.itemId.replace("urn:","").replace("_","/"),o=hn(s)?window.atob(s):n.itemId,a=o.split("?")[0].replace("fs.file:vf.","dm.lineage:"),l=o.length>1?o.split("?")[1]:void 0,c=await this.createDocumentFromProps({projectId:i,itemId:a,versionId:l});return null===c?null:await this.filterDocument(c,r)}),Ir(this,"createDocumentFromVersion",async e=>await Yr(e,this.accounts)),Ir(this,"getGeoBIMDocumentProps",e=>{var t,r;return null==(null==(t=e.attributes)?void 0:t.projectId)||null==(null==(r=e.attributes)?void 0:r.itemId)?null:{projectId:e.attributes.projectId,itemId:e.attributes.itemId}}),Ir(this,"getDocumentByUrl",async e=>await this.runViewerUrlRule({viewerUrl:e})),Ir(this,"getDocumentByRule",async(e,t,r)=>{const n=this.getFilter(r);let i=[];if(e===jr.BIMDocument){const e=t;i=await this.runBIMDocumentRule(e)}else if(e===jr.ViewerUrl){const e=t,r=await this.runViewerUrlRule(e);i=null!==r?[r]:[]}else{if(e!==jr.DocumentName)throw jr.ScheduleFeature,new Error(`Rule ${e} not supported`);{if(null==n)throw new Error("geobimAccounts is required for DocumentName rule");const e=t,r=await this.accounts.getAccounts(n);null!==r&&(i=await this.runDocumentNameRule(e,r))}}return null==n?i:await this.filterDocuments(i,n)??[]}),Ir(this,"searchRepository",async(e,t)=>await this.search.search(e,t)),Ir(this,"createRepositoryItem",async e=>{const t=e.type===Jr.VERSIONS?await this.createDocumentFromVersion(e):null;return Zr(e,t)}),Ir(this,"getIssue",async(e,t,r)=>{const n=this.getFilter(r),i=await this.accounts.getProjectsAccountId(e,n);if(0===i.length)return null;const s=await this.dataManagement.getProject(i,e);if(null===s)return null;const o=await this.issues.getIssue(s,t);return null!==o&&(o.sourceUrl=await this.getIssueSourceUrl(s,i,o)),o}),Ir(this,"isDocumentIssue",(e,t)=>{const r=t.url;if(void 0!==r){const t=fn.fromUrl(pn(r)),n=fn.fromUrn(e);if(null!==t)return t.id===n.id}return!1}),Ir(this,"filterDocument",async(e,t=null)=>{if(null==t)return e;const r=await this.filterDocuments([e],t);return null===r||0===r.length?null:r[0]}),Ir(this,"filterDocuments",async(e,t)=>{const r=await this.accounts.getAccounts(t);return null===r?null:e.filter(e=>{var t,n;const i=null==(t=e.attributes)?void 0:t.accountName,s=null==(n=e.attributes)?void 0:n.projectName;if(null==i||null==s)return!1;const o=Object.values(r).find(e=>e.name===i);return null!=o&&null!=o.projects.find(e=>e.name===s)})}),Ir(this,"runBIMDocumentRule",async e=>{const t=[],r=e.projectId,n=e.itemId,i=await this.createDocumentFromProps({projectId:r,itemId:n});return null!==i&&Kr(i)&&t.push(i),t}),Ir(this,"runViewerUrlRule",async e=>{const t=this.getProjectIdFromUrl(e.viewerUrl),r=this.getItemIdFromUrl(e.viewerUrl),n=await this.createDocumentFromProps({projectId:t,itemId:r});return null===n||Kr(n)?n:null}),Ir(this,"getProjectIdFromUrl",e=>e.includes("docs.b360")?this.getProjectIdFromB360Url(e):e.includes("acc.autodesk")?this.getProjectIdFromACCUrl(e):""),Ir(this,"getProjectIdFromB360Url",e=>{const t=e.split("/"),r=t.findIndex(e=>"projects"===e);return r>-1?`b.${t[r+1]}`:""}),Ir(this,"getProjectIdFromACCUrl",e=>{const t=e.split("/");return t.findIndex(e=>"projects"===e)>-1?"b."+t[6].split("?")[0]:""}),Ir(this,"getItemIdFromUrl",e=>e.includes("docs.b360")?this.getItemIdFromB360Url(e):e.includes("acc.autodesk")?this.getItemIdFromACCUrl(e):""),Ir(this,"getItemIdFromB360Url",e=>{const t=e.split("/"),r=t.findIndex(e=>"items"===e);return r>-1?decodeURIComponent(t[r+1]):""}),Ir(this,"getItemIdFromACCUrl",e=>{const t=e.split("="),r=t.findIndex(e=>e.includes("entityId"));return r>-1?decodeURIComponent(t[r+1]):""}),Ir(this,"runDocumentNameRule",async(e,t)=>{const r=[],n=e.documentName;for(const e of Object.values(t))for(const t of e.projects){const i=await this.runDocumentNameRuleOnProject(e.id,t.id,n);r.push(...i)}return r}),Ir(this,"runDocumentNameRuleOnProject",async(e,t,r)=>{var n,i,s;const o=[],a=await this.dataManagement.getProject(e,t);if(void 0===a)return o;const l=null==(s=null==(i=null==(n=null==a?void 0:a.relationships)?void 0:n.rootFolder)?void 0:i.data)?void 0:s.id;if(null==l)return o;const c=await this.dataManagement.searchFolder(t,l,r.trim());for(const e of c){if(!await this.dataManagement.isValidViewerFormat(e))continue;const t=await Yr(e,this.accounts);null!==t&&o.push(t)}return o}),Ir(this,"getRepositoryItems",async(e,t)=>{const r=this.getFilter(t);if(null===e&&!await this.accounts.checkAccountAccess(r))return null;const n=this.getChildUrls(e),i=await this.dataManagement.getContent(n);if(null==i)return null;const s=[];for(let e=0;e<i.length;e++){const t=i[e];if(t.type!==Jr.ITEMS&&(null==r||await this.filterResult(t,r))){const e=t.type===Jr.VERSIONS?await this.createDocumentFromVersion(t):null,r=Zr(t,e);null!=r&&s.push(r)}}return s}),Ir(this,"getChildUrls",e=>{const t=null==e?void 0:e.item;switch(null==t?void 0:t.type){case Jr.HUBS:return this.getHubChildUrls(t);case Jr.PROJECTS:return this.getProjectChildUrls(t);case Jr.FOLDERS:return this.getFolderChildUrls(t);default:return[]}}),Ir(this,"getHubChildUrls",e=>{var t,r,n,i;return void 0===(null==(i=null==(n=null==(r=null==(t=e.relationships)?void 0:t.projects)?void 0:r.links)?void 0:n.related)?void 0:i.href)?[]:[e.relationships.projects.links.related.href]}),Ir(this,"getProjectChildUrls",e=>{var t,r,n,i;return void 0===(null==(i=null==(n=null==(r=null==(t=e.relationships)?void 0:t.topFolders)?void 0:r.links)?void 0:n.related)?void 0:i.href)?[]:[e.relationships.topFolders.links.related.href]}),Ir(this,"getFolderChildUrls",e=>{var t,r,n,i;return void 0===(null==(i=null==(n=null==(r=null==(t=e.relationships)?void 0:t.contents)?void 0:r.links)?void 0:n.related)?void 0:i.href)?[]:[e.relationships.contents.links.related.href]}),Ir(this,"filterResult",async(e,t)=>{if(void 0===e.id)return!1;const r=await this.accounts.getAccounts(t);return null!==r&&(e.type===Jr.HUBS?null!=r[e.id]:e.type===Jr.PROJECTS?null!=Object.values(r).find(t=>null!=t.projects.find(t=>t.id===e.id)):e.type!==Jr.ITEMS&&e.type!==Jr.VERSIONS||await this.dataManagement.isValidViewerFormat(e))}),Ir(this,"createDocumentFromProps",async e=>{const t=await this.dataManagement.getBIMDocument(e);return null===t?null:await Yr(t,this.accounts)}),this.tokenInfo=e.tokenInfo,this.dataManagement=r,this.issues=new dn(this.dataManagement),this.regions=new tn(t),this.accounts=new Us(this.dataManagement),this.search=new en(this.accounts,this.dataManagement),this.accountFilter=null}static async create(t){const r=new Ps(t.tokenInfo.getToken),n=new Ls(r),i=new Ns(n),s=await this.getApsRegionsInfo(t);return new e(t,s,i)}async getIssueSourceUrl(e,t,r){var n,i,s;const{projectType:o}=e.attributes.extension.data,a=await this.dataManagement.getHubRegion(t),l=this.regions.getDocumentsRoot(a,o);if(void 0===l)return;const c=null==(n=null==r?void 0:r.sourceData)?void 0:n.linkedDocuments;if(void 0!==c&&c.length>0){const t=c[0].urn;if(void 0!==t){const n=await this.dataManagement.getBIMDocument({projectId:e.id,itemId:t}),o=null==(s=null==(i=null==n?void 0:n.links)?void 0:i.webView)?void 0:s.href;if(void 0!==o)return await this.issues.getIssueSourceURL(e,r,l,pn(o))}}}};Ir(Fs,"getApsRegionsInfo",async e=>{const t=e.apsRegionsInfoUrl;if(null!==t){const e=await Fs.getApsRegionsInfoFromPortal(t);if(null!==e)return e}return sn}),Ir(Fs,"getApsRegionsInfoFromPortal",async e=>{try{const t=await fetch(e);if(null!=t&&t.ok)return await t.text()}catch(e){console.error("Unable to fetch APS regions config so using default regions config.",e)}return null});let Ms=Fs;var $s=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Bs{constructor(e){if(this._documentCoreService=null,this._documentCoreService=e,null===this._documentCoreService)throw new Error("DocumentCoreService is null!")}getDocument(e){return $s(this,void 0,void 0,function*(){if(null===this._documentCoreService)return null;return yield this._documentCoreService.getDocument(e)})}getRepositoryItems(e){return $s(this,void 0,void 0,function*(){if(null===this._documentCoreService)return null;return yield this._documentCoreService.getRepositoryItems(e)})}searchRepository(e,t){return $s(this,void 0,void 0,function*(){if(null===this._documentCoreService)return null;return yield this._documentCoreService.searchRepository(e,t)})}}var Vs,qs,zs=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e.FeatureLayer="feature",e.MapImageLayer="map-image",e.TileLayer="tile",e.GroupLayer="group",e.SceneLayer="scene",e.ImageryLayer="imagery",e.ImageryTileLayer="imagery-tile",e.ElevationLayer="elevation",e.OrientedImageryLayer="oriented-imagery",e.VectorTileLayer="vector-tile",e.KMLLayer="kml",e.CSVLayer="csv",e.GeoJSONLayer="geojson",e.WFSLayer="wfs",e.WMSLayer="wms",e.WMTSLayer="wmts",e.BuildingSceneLayer="building-scene",e.BuildingComponentSubLayer="building-component",e.BuildingGroupSubLayer="building-group"}(Vs||(Vs={})),function(e){e.AUTOCAD_ID_FIELD="Handle",e.IFC_ID_FIELD="GlobalId",e.REVIT_ID_FIELD="ObjectId",e.IFC_ID_FIELD2="Tag"}(qs||(qs={}));const Gs=[qs.IFC_ID_FIELD,qs.REVIT_ID_FIELD,qs.AUTOCAD_ID_FIELD,qs.IFC_ID_FIELD2];class Ws{constructor(e){if(this.getFeatureBimIds=e=>{const t=[];for(const r of Gs){const n=this.getFeatureAttribute(e,r);null!==n&&n.trim().length>0&&t.push(n)}return t},this.getFeatureAttribute=(e,t)=>{var r,n;if(null==(null==e?void 0:e.attributes))return null;const i=this.getAttributeFields(e).find(e=>e.toLowerCase()===t.toLowerCase());if(!i)return null;return null!==(n=null===(r=e.attributes[i])||void 0===r?void 0:r.toString())&&void 0!==n?n:null},this.getAttributeFields=e=>{var t,r;const n=e.attributes,i=Object.keys(n);if((null===(t=e.layer)||void 0===t?void 0:t.type)===Vs.FeatureLayer){const t=e.layer;return i.filter(e=>e!==t.objectIdField)}if((null===(r=e.layer)||void 0===r?void 0:r.type)===Vs.BuildingSceneLayer){const t=e.layer.allSublayers.find(e=>L(e,"objectIdField")),r=null!=t&&L(t,"objectIdField")?t.objectIdField:"ObjectId";return i.filter(e=>e.toLowerCase()!==r.toLowerCase())}if(e.layer&&L(e.layer,"objectIdField")){const t=e.layer.objectIdField;return i.filter(e=>e!==t)}return i},null===e)throw new Error("LinkCoreService is null!");this._linkCoreService=e}getFeatureDocumentLinks(e){return zs(this,void 0,void 0,function*(){const t=this.mapFeatureDataRecordToIFeature(e);if(null===t)return null;return yield this._linkCoreService.getLinks(t)})}mapFeatureDataRecordToIFeature(e){return this.mapGraphicToIFeature(e.feature)}mapGraphicToIFeature(e){var t,r,n;const i=e.layer;if(!i)return null;const s=e.attributes,o=this.mapGraphicGeometryToIGeometry(e.geometry),a=this.getFeatureBimIds(e),l=null!==(t=T(e))&&void 0!==t?t:0,c=null!==(r=j(e))&&void 0!==r?r:"",u=L(i,"layerId")?i.layerId:0,d=L(i,"displayField")?i.displayField:null,h=k(e),p=L(i,"url")&&null!=i.url?i.url:"";return{objectId:l,attributes:s,geometry:null!=o?o:void 0,bimIds:a,layer:{id:i.id,portalItemId:c,layerId:u,type:i.type,title:null!==(n=i.title)&&void 0!==n?n:null,displayField:d,objectIdField:h,url:p}}}mapGraphicGeometryToIGeometry(e){var t,r,n,i,s,o,a,l;if(null==e)return null;switch(e.type){case"point":{const n=e;return{type:"point",hasM:n.hasM,hasZ:n.hasZ,x:n.x,y:n.y,z:n.z,spatialReference:{wkid:null!==(t=n.spatialReference.wkid)&&void 0!==t?t:void 0,wkt:null!==(r=n.spatialReference.wkt)&&void 0!==r?r:void 0}}}case"multipoint":{const t=e;return{type:"polyline",hasM:t.hasM,hasZ:t.hasZ,points:t.points,spatialReference:{wkid:null!==(n=t.spatialReference.wkid)&&void 0!==n?n:void 0,wkt:null!==(i=t.spatialReference.wkt)&&void 0!==i?i:void 0}}}case"polyline":{const t=e;return{type:"polyline",hasM:t.hasM,hasZ:t.hasZ,paths:t.paths,spatialReference:{wkid:null!==(s=t.spatialReference.wkid)&&void 0!==s?s:void 0,wkt:null!==(o=t.spatialReference.wkt)&&void 0!==o?o:void 0}}}case"polygon":{const t=e;return{type:"polygon",hasM:t.hasM,hasZ:t.hasZ,rings:t.rings,spatialReference:{wkid:null!==(a=t.spatialReference.wkid)&&void 0!==a?a:void 0,wkt:null!==(l=t.spatialReference.wkt)&&void 0!==l?l:void 0}}}default:return console.warn(`GeoBIM Link Service: Unhandled geometry type: ${e.type}.`),null}}}var Hs=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Js{constructor(e){if(this.getGeoBIMDocument=e=>Hs(this,void 0,void 0,function*(){return null===e?null:yield this._geoBIMDocumentService.getDocument(e)}),this.getDocumentsLayer=()=>Hs(this,void 0,void 0,function*(){return yield this._geoBIMDocumentService.getLayer()}),null===e)throw new Error("GeoBIMDocumentService is null!");this._geoBIMDocumentService=e}}class Ks{constructor(e){if(this._projectCoreService=null,this._linksService=null,this._geoBIMDocumentService=null,this._projectCoreService=e,null===this._projectCoreService)throw new Error("ProjectCoreService is null!")}getLinksService(){if(null==this._linksService){if(null===this._projectCoreService)throw new Error("ProjectCoreService is null!");this._linksService=new Ws(this._projectCoreService.linkCoreService)}return this._linksService}getGeoBIMDocumentsService(){if(null==this._geoBIMDocumentService){if(null===this._projectCoreService)throw new Error("ProjectCoreService is null!");null!==this._projectCoreService.geoBIMDocumentService&&(this._geoBIMDocumentService=new Js(this._projectCoreService.geoBIMDocumentService))}return this._geoBIMDocumentService}}var Ys=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Zs{constructor(){void 0===Zs._initialized&&(Zs._initialized=new Promise(e=>{Zs._resolveInitialized=e}))}static getInstance(){return null===Zs._instance&&(Zs._instance=new Zs),Zs._instance}initialize(e,t){return Ys(this,void 0,void 0,function*(){return Zs._isInitialized||Zs._isInitializing||(Zs._isInitializing=!0,Zs._coreService=yield this.initializeCoreService(e,(0,a.getAppStore)().getState().portalUrl,t),yield this.setPortal(),Zs._isInitializing=!1,this.setInitialized()),Zs._initialized})}getProjectService(e,t){return Ys(this,void 0,void 0,function*(){if(!Zs._isInitialized||!Zs._coreService)return null;const e=yield Zs._coreService.getProjectCoreService(t);return new Ks(e)})}isGeoBIMProjectService(e){return Ys(this,void 0,void 0,function*(){if(!Zs._isInitialized||!Zs._coreService||null==e||""===e)return!1;try{const t=yield Zs._coreService.getFeatureService(e);return null!=t&&Zs._coreService.isProjectService(t)}catch(e){return!1}})}getDocumentsService(){return null==Zs._documentsService&&Zs._isInitialized&&null!==Zs._coreService&&(Zs._documentsService=new Bs(Zs._coreService.documentDataCoreService)),Zs._documentsService}getCoreService(){return Zs._coreService}isUserAuthorized(){if(null===Zs._portal)return!1;if(Zs._portal.user){const e=Zs._portal.user;return null!=(null==e?void 0:e.userLicenseTypeId)&&"viewerUT"!==e.userLicenseTypeId}return!1}initializeCoreService(e,t,r){return Ys(this,void 0,void 0,function*(){try{const[n]=yield(0,_.loadArcGISJSAPIModules)(["esri/identity/IdentityManager"]),i=n;if(null==t||""===t)throw new Error("Portal URL is not defined");const s=new Hr(()=>{var e,r,n,s;const o=`${t}/sharing/rest`,a=i.findCredential(o),l={expires:null!==(e=a.expires)&&void 0!==e?e:0,server:a.server,ssl:a.ssl,token:a.token,userId:a.userId},c=i.findServerInfo(o);return{credential:l,serverInfo:{server:null!==(r=c.server)&&void 0!==r?r:"",hasPortal:null!==(n=c.hasPortal)&&void 0!==n&&n,hasServer:null!==(s=c.hasServer)&&void 0!==s&&s}}});yield s.load();const o=yield Ms.create({tokenInfo:{getToken:e},apsRegionsInfoUrl:r}),a=new Nt({documentDataService:o,arcGISDataService:s});return Zs._coreService=a,Zs._coreService}catch(e){if(console.error("Error initializing Core Service:",e),null!=(n=e)&&"object"==typeof n&&n.errorType===Lt)throw e;if(e instanceof Error)throw new Ft({message:e.message,severity:Ut.DANGER});throw new Ft({message:"string"==typeof e?e:"An unknown error occurred",severity:Ut.DANGER})}var n})}setInitialized(){Zs._isInitialized||(Zs._isInitialized=!0,Zs._resolveInitialized())}setPortal(){return Ys(this,void 0,void 0,function*(){if(null!==Zs._portal)return;const[e]=yield(0,_.loadArcGISJSAPIModules)(["esri/portal/Portal"]),t=new e({url:(0,a.getAppStore)().getState().portalUrl});Zs._portal=yield t.load()})}}Zs._instance=null,Zs._isInitialized=!1,Zs._isInitializing=!1,Zs._coreService=null,Zs._documentsService=null,Zs._portal=null;const Xs=(e,t)=>{const r="modelViewerLinkedDocuments",{modelViewerWidgetId:n,document:i,selectedIds:s}=t.payload;if(null==n)return e;const o=e.getIn(["disabledModelViewers"]).getIn([n]),l=function(e,t,r){if(null==e||null==t)return!1;const n=e.document,i=e.selectedIds;return!!Q(n,t)&&!a.lodash.isDeepEqual(i,r)}(e.getIn([r]).getIn([n]),i,s);if(!0===o&&!l)return e;const c={document:i,selectedIds:s};return e.setIn([r,n],c)},Qs=(e,t,r)=>{switch(t.type){case me.SetApsAuthenticated:return((e,t)=>{const r=t.payload;return e.set("apsAuthenticated",r)})(e,t);case me.SetApsError:return((e,t)=>{const r=t.payload;return e.set("apsError",r)})(e,t);case me.SetModelViewerLinkedDocument:return Xs(e,t);case me.SetModelViewerDisabled:return((e,t)=>{const{modelViewerWidgetId:r,disabled:n}=t.payload;return null==r?e:e.setIn(["disabledModelViewers",r],n)})(e,t)}},eo="geoBIMState",to=(0,a.Immutable)({apsAuthenticated:!1,apsError:null,modelViewerLinkedDocuments:new Map,disabledModelViewers:new Map},{});class ro{constructor(){this.id="geobim-store-extension"}getActions(){return Object.values(me)}getStoreKey(){return eo}getInitLocalState(){return to}getReducer(){return Qs}}function no(e){var t,r;return null!==(r=null===(t=null==e?void 0:e[eo])||void 0===t?void 0:t.apsAuthenticated)&&void 0!==r&&r}function io(e){var t,r;return null!==(r=null===(t=null==e?void 0:e[eo])||void 0===t?void 0:t.apsError)&&void 0!==r?r:null}function so(e,t){var r;if(null==e||""===e)return null;const n=null===(r=null==t?void 0:t[eo])||void 0===r?void 0:r.modelViewerLinkedDocuments;if(null==n)return null;const i=n.getIn([e]);return null==i?null:i}function oo(e,t){var r;if(null==e||""===e)return!1;const n=null===(r=null==t?void 0:t[eo])||void 0===r?void 0:r.disabledModelViewers;if(null==n)return!1;const i=n.getIn([e]);return null!=i&&i}var ao=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useEffect:lo,useMemo:co,useState:uo,useCallback:ho}=a.React,{useSelector:po}=a.ReactRedux,fo=e=>{const{getApsAuthToken:t,apsAuthLoaded:r,getApsRegionsInfoUrl:n}=(0,l.useApsAuth)(),i=co(()=>Zs.getInstance(),[]),[s,o]=uo(!1),[a,c]=uo(!1),[u,d]=uo(!1),[h,p]=uo(null),f=po(e=>no(e));lo(function(){let e=!1;return(()=>{ao(this,void 0,void 0,function*(){r&&f&&(yield i.initialize(()=>ao(this,void 0,void 0,function*(){var e,r;return null!==(r=null===(e=yield t())||void 0===e?void 0:e.accessToken)&&void 0!==r?r:""}),n()),e||d(!0))})})(),()=>{e=!0}},[i,r,f,t,n]),lo(function(){let t=!1;return(()=>{ao(this,void 0,void 0,function*(){if(u&&null!=e){o(!0);const r=yield i.getProjectService(e.sessionId,e.featureServiceId);t||(p(r),o(!1),c(!0))}})})(),()=>{t=!0}},[i,e,u]);const m=co(()=>!h||s?null:h.getLinksService(),[h,s]),g=co(()=>!h||s?null:h.getGeoBIMDocumentsService(),[h,s]),v=co(()=>u?i.getDocumentsService():null,[i,u]),y=ho(e=>ao(void 0,void 0,void 0,function*(){return!(!u||null==e||""===e)&&(yield i.isGeoBIMProjectService(e))}),[i,u]),w=co(()=>!!u&&i.isUserAuthorized(),[i,u]);return co(()=>({LinksService:m,GeoBIMDocumentService:g,DocumentsService:v,isGeoBIMProjectService:y,projectServiceLoading:s,projectServiceInitialized:a,sessionManagerInitialized:u,isUserAuthorized:w}),[m,g,v,y,s,a,u,w])};var mo=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useMemo:go,useState:vo,useEffect:yo}=a.React,wo=()=>{const[e,t]=vo(null),{selectedFeatures:r,geoBIMInitialized:n,LinksService:i}=Xe(),[s,o]=vo([]),[a,c]=vo(!1),[u,d]=vo(!1);(0,l.areRecordArraysEqual)(r,s)||o(r),yo(function(){let e=!1;return(()=>{mo(this,void 0,void 0,function*(){if(n&&i){d(!0);try{if(0===s.length||s.length>1)return void t(null);c(!0);const r=s[0],n=yield i.getFeatureDocumentLinks(r);e||t(n)}finally{e||c(!1)}}})})(),()=>{e=!0}},[n,i,s]);return go(()=>({featureDocumentLinks:e,linksLoading:a,linksInitialized:u}),[e,a,u])};var bo=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useCallback:_o,useMemo:So}=a.React,Io=()=>{const{geoBIMInitialized:e,DocumentsService:t,GeoBIMDocumentService:r,currentGeoBIMView:n,geoBIMLoading:i,projectServiceInitialized:o}=Xe(),a=So(()=>e&&!i&&o&&null!==t,[t,e,i,o]),l=_o((e,r)=>bo(void 0,void 0,void 0,function*(){if(!a||null===t||null==n)return null;const i=yield t.searchRepository(e,r);return null==(null==i?void 0:i.children)||0===i.children.length?null:i}),[t,n,a]),c=_o(()=>bo(void 0,void 0,void 0,function*(){if(!a||null==n||null===t)return null;const e=yield t.getRepositoryItems(null);if(null==e||0===e.length)return null;const r=e[0],i=yield t.getRepositoryItems(r),s=JSON.parse(JSON.stringify(i));return Object.assign(Object.assign({},r),{children:s})}),[t,n,a]),u=_o(e=>bo(void 0,void 0,void 0,function*(){if(!a||null==n||null===t)return[];return yield t.getRepositoryItems(e)}),[t,n,a]),d=_o(e=>bo(void 0,void 0,void 0,function*(){return null===r||null===e||(null==n?void 0:n.featureServiceStatus)!==s.SINGLE_FEATURE_SERVICE?null:yield r.getGeoBIMDocument(e)}),[r,n]),h=_o(()=>bo(void 0,void 0,void 0,function*(){return null===r?null:yield r.getDocumentsLayer()}),[r]);return So(()=>({searchRepository:l,getRoot:c,getChildren:u,getGeoBIMDocument:d,getDocumentsLayer:h,useDocumentsReady:a}),[u,h,d,c,l,a])};var Eo=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const{useEffect:Ao,useMemo:Ro,useState:ko,useCallback:To}=a.React,Co=(e,t)=>{const[r,n]=ko(!1),[i,s]=ko(),o=Ro(()=>(0,a.createIntlCache)(),[]);Ao(()=>{let i=!1;return Eo(void 0,void 0,void 0,function*(){if(r)return;let l=(0,a.getAppStore)().getState().appContext.locale,c={};if(void 0!==t)if(l=a.i18n.getLocaleToLoad(l,t),l)try{c=yield a.i18n.loadLocaleMessages("widgets/shared-code/lib/geobim/translations",l)}catch(e){console.warn("Failed to load shared messages, default messages will be used for:",l)}else l=t.length>0?t[0]:"en";else l="en";if(!i){const t=Object.assign({},e.messages,c);s((0,a.createIntl)({locale:l,messages:t},o)),n(!0)}}),()=>{i=!0}},[o,e,r,t]);const l=To((e,t,n)=>r&&i?i.formatMessage({id:e,defaultMessage:t[e]},n):t[e]||e,[i,r]);return Ro(()=>({translateMessage:l}),[l])},{useRef:Oo,useCallback:Do,useMemo:jo,useState:xo}=a.React,Po=(e,t=!0)=>{const r=Oo(null),[n,i]=xo(!1);F(r.current,e)||(r.current=e,t&&(e.length>1?i(!0):1===e.length&&i(!1)));const s=Do(()=>{i(!1)},[]);return jo(()=>({multipleFeatureSelectionWarning:n,cancelMultipleFeatureSelectionWarning:s}),[n,s])},No="32px";var Lo;!function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.Eleven=11]="Eleven",e[e.Twelve=12]="Twelve"}(Lo||(Lo={}));const Uo=e=>(0,a.css)({label:"selectionWarningStyle",padding:e.sys.spacing(Lo.Six),"div.jimu-alert-panel":{width:"unset !important"}}),Fo=e=>(0,a.css)({label:"geoBIMWidgetContainerStyle",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",height:"100%",width:"100%",overflow:"hidden"}),Mo=e=>(0,a.css)({label:"widgetHeaderStyle",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",lineHeight:No,padding:e.sys.spacing(Lo.Three),color:e.sys.color.surface.overlayText,backgroundColor:e.sys.color.surface.overlay,borderBottom:`solid 1px ${e.sys.color.divider.primary}`}),$o=e=>(0,a.css)({label:"inWidgetMessageContainerStyle",flexBasis:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:e.sys.spacing(Lo.Six)}),Bo=e=>(0,a.css)({label:"inWidgetMessageLinkStyle",color:`${e.sys.color.surface.paperText} !important`,textDecoration:"underline !important",cursor:"pointer","&:hover":{color:`${e.sys.color.action.link.hover} !important`}}),Vo=e=>(0,a.css)({label:"loadingContainerStyle",position:"absolute",width:"100%",height:"100%"}),qo=(e,t)=>(0,a.css)({height:t?"0":"100%",visibility:t?"hidden":"visible"}),zo={geobim_logInLink:"Log in",geobim_logInTip:"(All widgets requiring Autodesk authentication will also be logged in.)",geobim_noFeatureServiceSettingsWarning:"One or more sources do not contain feature layers from a GeoBIM project.",geobim_multipleFeatureServicesSettingsWarning:"One or more sources contain feature layers from multiple GeoBIM projects.",geobim_featureServicesSettingsTip:"Please use a source containing feature layers from a single GeoBIM project.",geobim_bimCloudConnectionSettingsTip:"Sources containing elements from BIM Cloud Connection will still be supported.",geobim_itemInaccessible:"Item cannot be accessed.",noGeoBIMFeatureServiceError:"No GeoBIM Feature Service found in this View. Please use a Web Map or Web Scene that contains layers from only one GeoBIM Feature Service.",multipleGeoBIMFeatureServicesError:"Multiple GeoBIM Feature Services were found in this View. Please use a Web Map or Web Scene that contains layers from only one GeoBIM Feature Service.",selectMapSetting:"Select a Map Widget.",geobimNoneSetting:"None",geobim_userTypeNote:"A Contributor or higher ArcGIS user type is needed to use the {widget_name} widget. Reach out to your GIS administrator to confirm your license or request an upgrade.",geobim_userTypeLink:"Learn more about user types."},Go=()=>window.location;var Wo=u(69920)})(),d})())}}});