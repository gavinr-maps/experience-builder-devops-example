/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1"],{73897:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_append_select:()=>u});var o=i(7263),a=i(71700),n=i(76173),s=i(99907),r=i(31670),d=i(11246),l=i(58603),c=i(24125),p=i(5992),m=i(39274),h=i(7652);i(11935),i(11163),i(28944),i(59296),i(2174),i(28926),i(70506),i(99004),i(94788),i(71695),i(66488),i(46581),i(65215),i(50852),i(51325),i(86537),i(49712),i(90079),i(57399),i(67575),i(15437),i(73596),i(91253),i(43780),i(59673);const u=class{constructor(e){(0,o.r)(this,e),this.newItemUpdatePage=(0,o.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,o.c)(this,"newItemToggleNavigationEnabled",7),this.workflowComplete=(0,o.c)(this,"workflowComplete",7),this.insertOnly=!1,this.isCloudItem=!1,this.isUrlItem=!1,this.options={add:{icon:"add-features",updateType:"add",hidden:!1,disabled:!1},update:{icon:"update-features",updateType:"update",hidden:!1,disabled:!1},upsert:{icon:"add-and-update-features",updateType:"upsert",hidden:!1,disabled:!1},overwrite:{icon:"overwrite-features",updateType:"overwrite",hidden:!1,disabled:!1}},this.syncAppendOptions=()=>{if(!a.a.appendOptions&&this.item){const e=this.item;a.a.appendOptions={serviceInfo:e.serviceInfo,adminServiceInfo:e.adminServiceInfo,cloudProviderInfo:e.cloudProviderInfo,sourceData:e.sourceData,layers:e.layers,isSDS:e.isSDS,itemData:e.itemData,publishParameters:e.publishParameters}}},this.selected="add",this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}handleNext(){let e;const{item:t,selected:i,layer:o,layerId:n,appendLayerEntry:s}=this;a.a.addAppendSelectOption=i;const{layers:r,cloudProviderInfo:d}=a.a.appendOptions;if(!s&&"overwrite"!==i&&r.length>1)e="appendSelectLayer";else{if(d&&"overwrite"===i){if(a.a.newItemMode="file",d){const{id:e,mimeType:i,zipItemType:o,cloudProvider:a}=d;return this.assignCloudItemStore(d),void this.handleOverwriteURL(t,e,i,o,a)}return void this.handleOverwriteURL(t)}if(s){let e=null!=o?o:r[n];e||(e=r[0]),a.a.sourceDataLayer=e}else a.a.sourceDataLayer=r[0];e="appendUpload"}this.newItemUpdatePage.emit(e)}createOptions(){const{serviceInfo:e,sourceData:t,cloudProviderInfo:i,isSDS:o,adminServiceInfo:n}=a.a.appendOptions,s=!1===e.sourceSchemaChangesAllowed,d=(!t||t.inRecycleBin)&&!i,l="GeoPackage"===(null==t?void 0:t.type)&&r.c.portal.isPortal;(-1!==(r.c.portal.isPortal&&!o?e.capabilities:n.capabilities).indexOf("ChangeTracking")||e.syncEnabled)&&(this.insertOnly=!0,this.options.overwrite.disabled=!0,this.options.update.disabled=!0,this.options.upsert.disabled=!0),(this.appendLayerEntry||l||"Service Definition"===(null==t?void 0:t.type)||d||s)&&(this.options.overwrite.disabled=!0)}createOverwriteNextText(){switch(!0){case this.isCloudItem:return"signInAndOverwrite";case this.isUrlItem:return"overwriteAndComplete";default:return"next"}}async componentWillLoad(){var e,t,i,o,n,r,d,l;this.selected=a.a.addAppendSelectOption||"add",this.i18n=s.u.i18n.appendSelect,this.item=a.a.existingItem,this.appendLayerEntry=void 0!==a.a.layerId||!!a.a.sublayer,this.layerId=a.a.layerId,this.layer=a.a.sublayer,this.syncAppendOptions(),this.item&&(a.a.id=null,a.a.dateFieldsTimeReference=null!==(n=null!==(t=null===(e=a.a.appendOptions.publishParameters)||void 0===e?void 0:e.dateFieldsTimeReference)&&void 0!==t?t:null===(o=null===(i=a.a.appendOptions.publishParameters)||void 0===i?void 0:i.layers)||void 0===o?void 0:o[0].dateFieldsTimeReference)&&void 0!==n?n:null===(r=a.a.appendOptions.layers)||void 0===r?void 0:r[0].dateFieldsTimeReference,this.isUrlItem=!!(null===(d=a.a.appendOptions.cloudProviderInfo)||void 0===d?void 0:d.url),this.isCloudItem=!!(null===(l=a.a.appendOptions.cloudProviderInfo)||void 0===l?void 0:l.cloudProvider),this.createOptions())}assignCloudItemStore(e){const{cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:n,cloudFileType:s,zipItemType:r}=e;a.a.cloudProvider=(0,l.d)(t),a.a.cloudProviderResource={cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:n,cloudFileType:s,zipItemType:r}}async setUpCloud(e){const t=(0,l.e)(e),{result:i,error:o}=await(0,p.g)(t);return o?(this.handleError(),null):i}async handleOverwriteURL(e,t,i,o,u){var g,v,f,w,x,y,b;let T,I,$;this.loading=!0,this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting;const k=a.a.appendOptions.cloudProviderInfo;if(a.a.fileName=e.title,a.a.title=e.title,k.cloudProvider){I="zip"===i?o:n.A[i],$=[a.a.type];const e=await this.setUpCloud(u);switch(await(0,d.t)(200),u){case"googleConnect":T=(0,l.f)(t,i,e);break;case"dropBoxConnect":T=(0,l.i)(t,e);break;case"oneDriveConnect":T=(0,l.h)(t,e)}}else{"geojson"===k.mimeType?a.a.geoJSONResource={fileName:k.fileName,url:k.url,mimeType:k.mimeType}:a.a.csvResource={fileName:k.fileName,url:k.url,mimeType:k.mimeType};const e=null!==(g=a.a.csvResource)&&void 0!==g?g:a.a.geoJSONResource;I=n.A[e.mimeType],T=e.url,$=[I]}a.a.dataUrl=T,a.a.type=I,a.a.typeKeywords=$,a.a.overwrite=!0;try{this.newItemToggleNavigationEnabled.emit(!1),await(0,m.x)();const{appendOptions:t}=a.a,i=await(0,p.a)(e,r.c.portal,r.c.user,t,a.a.id),o=await(0,c.p)({itemId:null!==(f=null===(v=t.sourceData)||void 0===v?void 0:v.id)&&void 0!==f?f:e.id,user:r.c.user,title:(null==e?void 0:e.title)||"",itemOwnerUrl:(0,h.g)(await(0,h.h)(this.item.owner,r.c.portal),r.c.portal)},i);await(0,p.u)(i.publishParameters,e,null===(x=null===(w=o.result)||void 0===w?void 0:w.services)||void 0===x?void 0:x[0].serviceItemId),await this.checkStatus({itemId:e.id,jobId:null===(b=null===(y=o.result)||void 0===y?void 0:y.services)||void 0===b?void 0:b[0].jobId},null==o?void 0:o.result)}catch(e){this.handleError()}}async checkStatus(e,t){var i;this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting,this.newItemToggleNavigationEnabled.emit(!0);const o=await(0,m.g)(e.itemId,{jobId:e.jobId}),n=null==o?void 0:o.status,r=Object.assign({id:null===(i=null==t?void 0:t.services)||void 0===i?void 0:i[0].serviceItemId,item:Object.assign({},a.a),overwriteStatus:n,appendType:a.a.addAppendSelectOption},t);return"completed"===(null==o?void 0:o.status.toLowerCase())?(r.overwriteStatus=null==o?void 0:o.status,this.workflowComplete.emit(r),null):("failed"===(null==o?void 0:o.status.toLowerCase())&&this.handleError(),o)}handleError(){s.u.nextText="next",this.newItemToggleNavigationEnabled.emit(!0),this.loading=!1,this.error={title:s.u.i18n.error,description:s.u.i18n.appendUpload.errors.errorWhileUpload}}render(){const{i18n:e,options:t,insertOnly:i,error:a,loaderType:n,loading:r,loaderMessage:d}=this;return(0,o.h)(o.H,{key:"b3bc523a3a0a9b709bfa3297f21474e273c0bbc3",class:{"overflow-hidden":r}},(0,o.h)("arcgis-new-item-loader",{key:"a916f6aae90f03b872977c7cb7cf692cdcca0cf1",type:n,active:r,text:d}),(0,o.h)("div",{key:"2dc800d0c0a65f47ac4d8fb37d4dbc14bd8490e9",class:"header"},i?e.insertOnlyEnabled:e.chooseUpdate),(0,o.h)("div",{key:"88699a1e2beb28729d7e66ec620dff78e37cbf87",class:"tile-select"},Object.keys(t).map((i=>{const{icon:a,hidden:n,disabled:r}=t[i];return(0,o.h)("calcite-tile-select",{key:i,checked:this.selected===i,heading:e.options[i].title,icon:a,name:"append-select-update",width:"full",type:"radio",value:i,class:"tile-card",hidden:n,disabled:r,inputEnabled:!0,onCalciteTileSelectChange:e=>{this.selected=e.target.value,s.u.nextText="overwrite"===this.selected?this.createOverwriteNextText():"next"}})}))),(0,o.h)("arcgis-new-item-alert",{key:"29ac93383c4b0fd788cd672a77ab33edcf5c7f18",heading:null==a?void 0:a.title,description:null==a?void 0:a.description,active:!!a,onAlertDismiss:()=>this.error=null}))}get el(){return(0,o.d)(this)}};u.style=".tile-select{margin-right:0.75rem;margin-left:0.75rem;margin-top:1rem;display:grid;padding-bottom:6rem;font-size:1.125rem}@media (min-width: 480px){.tile-select{grid-template-columns:repeat(2, 1fr)}}.tile-card:hover{--tw-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.08), 0 2px 8px 0 rgba(0, 0, 0, 0.04);--tw-shadow-colored:0 4px 16px 0 var(--tw-shadow-color), 0 2px 8px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.header{margin-left:0.75rem;font-size:1rem;font-weight:500}.insert-only-info{margin-left:0.75rem;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-1)}"},58603:(e,t,i)=>{i.d(t,{a:()=>y,b:()=>d,c:()=>r,d:()=>T,e:()=>b,f:()=>g,g:()=>x,h:()=>f,i:()=>p});var o=i(31670);function a(e,t,i,o,a){return new Promise(((n,s)=>{const r=new XMLHttpRequest;r.open(e,t,!1),o&&r.setRequestHeader("Authorization",o),a&&r.setRequestHeader("Content-type",a),i?r.send(i):r.send();const d=JSON.parse(r.responseText);r.status>=400&&s(JSON.parse(r.responseText)),n(d)}))}function n(e,t){return new Promise(((i,o)=>{t=t.replace(/[[]/,"[").replace(/[]]/,"]");const a=new RegExp(`[?&#]${t}=([^&#]*)`).exec(e);null==a?o("InvalidToken"):i(a[1])}))}function s(e,t){return new Promise(((i,o)=>{const a=`${window.location.protocol}//${window.location.hostname}`,n=`https://${t}/home/cloudDriveOauth-callback.html${`?cloudUrl=${e}&currentSourceUrl=${a}&portalHostName=${t}`}`,s=document.createElement("iframe");s.src=n,s.className="hide",document.body.appendChild(s);const r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"===r?"onmessage":"message",(e=>{e.origin===`https://${t}`&&("popupBlocked"!==e.data&&"windowClosed"!==e.data||o(e.data),i(e.data))}),!1)}))}const r={csv:"file-csv",excel:"file-excel",zip:"file-zip",geojson:"file-code",sheet:"file-report",cad:"file-cad",gpx:"file-gpx",png:"file-image",jpg:"file-image",jpeg:"file-image",tiff:"file-image",gif:"file-image",pdf:"file-pdf",docx:"file-word"},d={csv:"CSV",excel:"Excel",zip:"Zip File",geojson:"GeoJSON",googlesheets:"Google Sheets",cad:"CAD",gpx:"GPX",png:"Image",jpg:"Image",jpeg:"Image",tiff:"Image",gif:"Image",pdf:"PDF",docx:"Microsoft Word",pptx:"Microsoft PowerPoint"},l={csv:".csv",excel:".xls",zip:".zip",geojson:".geojson",googlesheets:""};function c(e){const t=e.split("."),i=t[t.length-1].toLowerCase();return{xls:"excel",xlsx:"excel",csv:"csv",zip:"zip",geojson:"geojson",json:"geojson"}[i]||i}function p(e,t){return`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`}class m{constructor(){this.nextStart=0}async connect(){const{config:e,portal:t}=o.c,i=`dropbox${Math.floor(Date.now()/1e3)}`,a=document.documentElement.lang||"en-US",r=`https://www.dropbox.com/oauth2/authorize?redirect_uri=${`https://${t.portalHostname}/home/cloudDriveOauth-callback2.html`}&response_type=token&client_id=${e.dropboxClientId}&locale=${a}&state=${i}`;return new Promise((async(e,o)=>{try{const a=await s(r,t.portalHostname),d=await n(a,"state");i!==d&&o("invalidState");const l=await n(a,"access_token");this.token=l,e(l)}catch(e){o(e)}}))}search(e={}){const{token:t}=this;return new Promise((async i=>{const{searchText:o,dropdownFilter:n,next:s}=e,r=`Bearer ${t}`,d=o?` ${o}`:"",p=s?this.nextStart:0;let m=l[n];"excel"===n&&(m="xls");const h=`{"path":"","query":"${d} ${m}","mode": "filename","max_results":10,"start":${p}}`,u=await a("POST","https://api.dropboxapi.com/2/files/search",h,r,"application/json");this.nextStart=u.start;i({files:u.matches.filter((e=>{var t;return"file"===(null===(t=e.metadata)||void 0===t?void 0:t[".tag"])})).map((({metadata:{id:e,name:i,size:o}})=>({id:e,name:i,mimeType:c(i),downloadUrl:`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`,size:o}))),next:!!u.more})}))}}function h(e){return e.indexOf("spreadsheetml.sheet")>-1||e.indexOf("ms-excel")>-1?"excel":e.indexOf("application/zip")>-1?"zip":e.indexOf("application/octet-stream")>-1||e.indexOf("application/json")>-1?"geojson":e.indexOf("google-apps.spreadsheet")>-1?"googlesheets":e.indexOf("text/csv")>-1?"csv":"zip"}const u={csv:'(mimeType="text/csv")',excel:'(mimeType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"ormimeType="application/vnd.ms-excel")',zip:'(mimeType="application/x-zip-compressed"ormimeType="application/zip")',geojson:'(name contains "json" or name contains "geojson")and(mimeType="application/octet-stream"ormimeType="application/json")',googlesheets:'(mimeType="application/vnd.google-apps.spreadsheet")'};function g(e,t,i){const o=`https://www.googleapis.com/drive/v3/files/${e}`,a=`&httpHeaders={"Authorization":"Bearer&#32;${i}"}`,n=`${o}/export?mimeType=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet${a}`,s=`${o}?alt=media${a}`;return t.indexOf("google-apps")>-1||t.indexOf("googlesheets")>-1?n:s}class v{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,r=a.portalHostname,d=document.documentElement.lang||"en-US",l=`google${Math.floor(Date.now()/1e3)}`,c=`https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/drive.readonly&redirect_uri=${`https://${r}/home/cloudDriveOauth-callback2.html`}&response_type=token&client_id=${i.googleClientId}&hl=${d}&state=${l}`;try{const i=await s(c,r);l!==await n(i,"state")&&t("invalidState"),this.token=await n(i,"access_token"),e(this.token)}catch(e){t(e)}}))}async search(e={}){return new Promise((async t=>{const{searchText:i,next:o,dropdownFilter:n}=e,s=`${`https://www.googleapis.com/drive/v3/files?access_token=${this.token}&pageSize=10&fields=incompleteSearch,nextPageToken,files(id,kind,mimeType,name)`}&q=${i?`name contains '${i}' and trashed = false and`:"trashed = false and"}${u[n]}${o?`&pageToken=${this.nextToken}`:""}`,r=await a("GET",s,null,null,"application/json");this.nextToken=r.nextPageToken;t({files:r.files.map((({id:e,name:t,mimeType:i})=>({id:e,name:t,mimeType:h(i),downloadUrl:g(e,i,this.token)}))),next:!!r.nextPageToken})}))}}function f(e,t){return`https://graph.microsoft.com/v1.0/me/drive/items/${e}/content?httpHeaders={"Authorization":"Bearer&#32;${t}"}`}class w{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,r=a.portalHostname,d=document.documentElement.lang||"en-US",l=`onedrive${Math.floor(Date.now()/1e3)}`,c=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?scope=files.read&redirect_uri=${`https://${r}/home/cloudDriveOauth-callback2.html`}&response_type=token&client_id=${i.oneDriveClientId}&locale=${d}&state=${l}`;try{const i=await s(c,r);l!==await n(i,"state")&&t("invalidState"),this.token=await n(i,"access_token"),e(this.token)}catch(e){t(e)}}))}search(e={}){return new Promise((async t=>{const{searchText:i,dropdownFilter:o,next:n}=e,s=`Bearer ${this.token}`,r=`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${i||""} ${l[o]||""}')?select=name,id,file,size&top=10`,d=n?this.nextLink:r,p=await a("GET",d,null,s,"application/json");this.nextLink=p["@odata.nextLink"];t({files:p.value.map((({size:e,id:t,name:i})=>({size:e,id:t,name:i,mimeType:c(i),downloadUrl:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/content?httpHeaders={"Authorization":"Bearer ${this.token}"}`}))),next:!!p["@odata.nextLink"]})}))}}function x(e){return new{dropbox:m,"google drive":v,onedrive:w}[e]}function y(e){return{dropbox:"dropBoxConnect","google drive":"googleConnect",onedrive:"oneDriveConnect"}[e]}function b(e){return new{dropBoxConnect:m,googleConnect:v,oneDriveConnect:w}[e]}function T(e){return{dropBoxConnect:"dropbox",googleConnect:"google drive",oneDriveConnect:"onedrive"}[e]}}}]);