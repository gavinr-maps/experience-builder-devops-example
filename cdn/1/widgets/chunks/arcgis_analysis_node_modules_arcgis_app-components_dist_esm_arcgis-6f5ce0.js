/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0"],{14188:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_append_upload:()=>b});var a=t(7263),s=t(31670),n=t(73596),l=t(51325),o=t(39274),r=t(74186),d=t(71700),p=t(50852),c=t(5992),h=t(99907),u=t(76173),y=t(86537),m=t(7380),v=t(63262),f=t(7652);t(11935),t(94788),t(49712),t(90079),t(57399),t(65215),t(66488),t(46581),t(28926),t(70506),t(99004),t(67575),t(15437),t(91253),t(43780),t(59673),t(59296),t(2174),t(81232),t(77040),t(28944),t(71695),t(24125),t(11163);async function g(){try{await(0,p.d)(d.a.id,{permanentDelete:!0}),d.a.id=null}catch(e){console.warn("Delete item failed",e)}}const b=class{constructor(e){(0,a.r)(this,e),this.fileSelect=(0,a.c)(this,"fileSelect",7),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.sourceName="",this.itemTypes=[{value:"File Geodatabase",icon:"data",publishable:!0},{value:"Shapefile",icon:"file-zip",publishable:!0}],this.insideModal=!0,this.fullHeight=!0,this.selectedZipFile="File Geodatabase",this.step="upload",this.loading=void 0,this.loaderMessage=void 0,this.loaderType="indeterminate",this.error=void 0,this.overwriteProcess=!1,this.file=void 0,this.header=void 0,this.description=void 0}async handlePrev(e){if(e.preventDefault(),!this.loading){if("analyzeZip"===this.step)return d.a.file=null,void(this.step="upload");d.a.appendOptions.layers.length>1&&(d.a.sourceDataLayer=null),this.newItemPrevPage.emit()}}async handleNext(){var e;if(this.overwriteProcess&&"overwrite"===d.a.addAppendSelectOption){const{addAppendSelectOption:i}=d.a,t=Object.assign({id:null===(e=this.publishResponse)||void 0===e?void 0:e.id,appendType:i,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus},this.publishResponse);this.workflowComplete.emit(t)}else if(d.a.file){if("zip"===d.a.extension)if(this.step="analyzeZip",d.a.type=y.a[this.selectedZipFile].type,"overwrite"===d.a.addAppendSelectOption)d.a.id=this.item.id,await this.handleOverwrite();else{await this.uploadAndAnalyzeFile()&&this.nextStep()}}else this.handleError({code:"providePath"})}async fileSelectHandler(e){var i;const t=e.detail.file;d.a.originalFileName=t.name;const{title:a,fileName:s,extension:r}=(0,n.s)(t,!0);if("overwrite"===d.a.addAppendSelectOption&&!(0,n.v)(d.a.originalFileName,this.sourceName))return void this.handleError({code:"useSameFileName"});if(l.i.title=a,d.a.file=t,d.a.fileName=s,d.a.newItemMode="file",d.a.extension=r,d.a.type="zip"===d.a.extension&&this.isEnterprise?"Shapefile":(0,m.f)(r,this.validTypes)[0].type,d.a.addAsUniqueFile=!0,"esriGeometryMultiPatch"===(null===(i=d.a.sourceDataLayer)||void 0===i?void 0:i.geometryType)&&"File Geodatabase"!==d.a.type&&"Shapefile"!==d.a.type&&"update"!==d.a.addAppendSelectOption)return this.step="upload",void this.handleError({code:"multiPatchRestriction"});const p=(null==t?void 0:t.size)>o.M&&"zip"===d.a.extension,c="overwrite"!==d.a.addAppendSelectOption&&!this.isEnterprise,h="overwrite"===d.a.addAppendSelectOption&&(null==t?void 0:t.size)>o.M;if("overwrite"!==d.a.addAppendSelectOption||p)if("zip"===d.a.extension&&(c||h))this.step="analyzeZip";else{this.step="analyze";await this.uploadAndAnalyzeFile()&&this.nextStep()}else await this.handleOverwrite()}async componentWillLoad(){var e,i;const{existingItem:t,addAppendSelectOption:a}=d.a,{config:n,portal:l}=s.c;this.item=t,this.sourceName=(null===(e=d.a.appendOptions.sourceData)||void 0===e?void 0:e.name)||this.item.name,this.i18n=h.u.i18n.appendUpload,this.config=n,this.isEnterprise=l.isPortal;const o=null===(i=d.a.appendOptions.sourceData)||void 0===i?void 0:i.type;this.allowedExtensions="overwrite"===a?(0,m.m)(["geojson"===o.toLowerCase()?"GeoJson":o]):l.isPortal?u.c:u.d,this.header=this.i18n.selectData,this.description="",this.validTypes=Object.values(y.a).filter((e=>e.appendUploadFormat)),d.a.id&&await g(),d.a.file=null}async handleOverwrite(){const{existingItem:e,file:i,keepDescription:t,fileName:a,appendOptions:n}=d.a;h.u.nextText="proceed";const o=e;this.loading=!0,this.overwriteProcess=!0,this.newItemToggleNavigationEnabled.emit(!1),this.loaderMessage=h.u.i18n.append.appendLoadingMessages.overwriting;const r=(0,f.g)(await(0,f.h)(this.item.owner,s.c.portal),s.c.portal),{error:p}=await(0,c.f)(n.sourceData,r,{file:i,overwrite:!0,keepDescription:t,fileName:a,existingItemId:o.id});if(p)return this.handleError(p),this.loading=!1,!1;try{const{result:i,error:t}=await(0,c.p)(e,l.i.title,s.c.portal,s.c.user,d.a.appendOptions);if(t)throw t;this.publishResponse=i,this.updateAndCheckStatus(o)}catch(p){return this.handleError({code:"unhandledError"}),this.loading=!1,!1}}async updateAndCheckStatus(e){var i;const{result:t}=await(0,c.r)(e);this.newItemToggleNavigationEnabled.emit(!0);const a=await(0,o.g)(e.id,{success:null==t?void 0:t.success});this.overwriteStatus=null==a?void 0:a.status;const s=Object.assign({id:null===(i=this.publishResponse)||void 0===i?void 0:i.id,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus,appendType:d.a.addAppendSelectOption},this.publishResponse);if("completed"===(null==a?void 0:a.status.toLowerCase()))return s.overwriteStatus=null==a?void 0:a.status,void this.workflowComplete.emit(s);"failed"===(null==a?void 0:a.status.toLowerCase())&&(h.u.nextText="next",this.loading=!1,this.handleError({code:"unhandledError"}))}nextStep(){var e,i,t;let a="appendSelectLayer";const{analyzeResults:s}=d.a,n=s.publishParameters;if(1===(null===(e=s.publishParameters.layers)||void 0===e?void 0:e.length)||!s.publishParameters.layers){if(d.a.dataLayer=null!==(t=null===(i=null==n?void 0:n.layers)||void 0===i?void 0:i[0])&&void 0!==t?t:n,"update"!==d.a.addAppendSelectOption){if(!(0,v.c)(d.a.dataLayer,d.a.sourceDataLayer,d.a.type))return void this.handleError({code:"incompatibleGeometries"})}a="Microsoft Excel"!==d.a.type&&"CSV"!==d.a.type||"esriGeometryPoint"!==(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.geometryType)||"Table"===(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.type)?"add"!==d.a.addAppendSelectOption||d.a.backupLayerFields.some((e=>"esriFieldTypeDate"===e.type))&&!this.isEnterprise?"appendKeyPairSelect":"appendMatchFields":"csvLocationFields"}this.newItemToggleNavigationEnabled.emit(!0),this.newItemUpdatePage.emit(a)}updateLoader(e,i){this.loaderType=e,this.loaderMessage=i}async uploadAndAnalyzeFile(){const{file:e,originalFileName:i,type:t}=d.a,{portal:a,user:n,config:l,lang:p}=s.c;this.loading=!0,this.newItemToggleNavigationEnabled.emit(!1),this.updateLoader((null==e?void 0:e.size)>o.M?"determinate":"indeterminate",h.u.i18n.append.appendLoadingMessages.uploading.replace("${fileName}",i));let c=null;return({error:c}=await(0,o.x)()),c?(this.handleError(c),!1):(this.updateLoader("indeterminate",this.i18n.analyzing),({error:c}=await(0,r.a)({analyzeArgs:{type:"item",itemid:d.a.id,workflow:"append"},itemArgs:{itemType:t},configArgs:{portal:a,user:n,config:l,lang:p},initialize:!0})),c&&(this.handleError(c),d.a.id&&await g()),!c)}async handleError(e){this.newItemToggleNavigationEnabled.emit(!0);let i=h.u.i18n.error,t=this.i18n.errors.errorWhileUpload;switch(e.code){case"exceedsFileSize":t=this.i18n.errors.errorExceedFileSize;break;case"invalidFileGeodatabase":i=h.u.i18n.itemProperties.invalidGeodatabase.title,t=h.u.i18n.itemProperties.invalidGeodatabase.description;break;case"invalidShapefile":i=h.u.i18n.itemProperties.invalidShapefile.title,t=h.u.i18n.itemProperties.invalidShapefile.description;break;case"useSameFileName":t=this.i18n.errors.sameFileName.replace("${x}",this.sourceName);break;case"providePath":t=this.i18n.errors.providePath;break;case"incompatibleGeometries":i=h.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=h.u.i18n.appendSelectLayer.sameGeometryWarningDescription;break;case"multiPatchRestriction":i=h.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=this.i18n.errors.multiPatchErrorDescription;break;case"unhandledError":"overwrite"===d.a.addAppendSelectOption&&(t=this.i18n.errors.errorUpdate)}("incompatibleGeometries"===e.code||"multiPatchRestriction"===e.code&&d.a.id)&&(d.a.file=null,await g()),this.loading=!1,this.error={title:i,description:t}}renderPickZip(){const e=this.itemTypes.map((({value:e,icon:i})=>({optionTitle:this.i18n[e].title,value:e,description:this.i18n[e].description,icon:i})));return(0,a.h)("calcite-label",{class:"zip-select"},(0,a.h)("div",{class:"zip-select-heading"},this.i18n.itemType),(0,a.h)("calcite-tile-select-group",{layout:"vertical",class:"tile-select"},Object.keys(e).map((i=>{const{icon:t,value:s,optionTitle:n,description:l}=e[i];return(0,a.h)("calcite-tile-select",{key:s,checked:s===this.selectedZipFile,heading:n,description:l,icon:t,name:"select-zip-file-for-append","input-enabled":!0,width:"full",type:"radio",value:s,onCalciteTileSelectChange:e=>{this.selectedZipFile=e.target.value}})}))))}render(){const{i18n:e,error:i,loaderType:t,loaderMessage:s,step:n,loading:l,config:o,sourceName:r,validTypes:p,allowedExtensions:c,isEnterprise:h}=this,u="overwrite"===d.a.addAppendSelectOption;u&&(this.header=e.selectData,this.description=e.sameFileNameDescription.replace("${fileName}",r));const y=h&&u?"120004189":"120001300",m=`${o.helpBase}${o.helpMap[y]}`;return(0,a.h)(a.H,{key:"d7c752a958b848014769c8d787460237c1e07108",class:{"overflow-hidden":l}},(0,a.h)("arcgis-new-item-loader",{key:"42c515318ef22f1327b7e2bdca3f1f7b5bf97f5a",type:t,active:l,text:s}),"analyzeZip"!==n&&(0,a.h)("div",{key:"2ebb7b1b7677bf606183db4d3d24f91bb901d0e2",class:{"upload-step":!0,"upload-step--header-with-description":u}},(0,a.h)("arcgis-new-item-description",{key:"6e908543897f9afbc9a00bbf89becc8c0e0e26ce",header:this.header,content:this.description})),"analyzeZip"!==n&&(0,a.h)("div",{key:"a009f9cd32dc829996e0e928f41fd508b255703e",class:{"file-browser-container":!0,"file-browser-container--has-description":u}},(0,a.h)("arcgis-file-browser",{key:"067e3214dace7520bbe4057cd2e60a22eb8fe53a",cloud:!1,validTypes:p,allowedExtensions:c,insideModal:!0,config:o,helpText:e.learnMore,helpLink:m,helpIdType:"append",fullHeight:!0})),"analyzeZip"===n&&(0,a.h)("div",{key:"3040d10ecd48d0e12d8292c66b2aba79bbf66e0e",class:"analyze-step"},(0,a.h)("arcgis-new-item-input-readonly",{key:"22b52f14ca9a6959d779c76b76c51d5914658969",label:e.file}),"zip"===d.a.extension&&this.renderPickZip()),(0,a.h)("arcgis-new-item-alert",{key:"bf592e40271ee917fa772c300c0e9e09c82d2bf2",heading:null==i?void 0:i.title,description:null==i?void 0:i.description,link:{href:null==i?void 0:i.link,title:null==i?void 0:i.linkText},active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.d)(this)}};b.style=":host{overflow:hidden}.file-browser-container{display:block;height:95%}.file-browser-container--has-description{display:block;height:90%}.upload-step{margin-bottom:0px;display:block}.upload-step--header-with-description{margin-bottom:0.75rem;display:block}.read-only{z-index:50;display:block}.zip-select-heading{font-weight:500}"},63262:(e,i,t)=>{function a(e){var i,t;const{dataLayer:a,type:s,sourceDataLayer:n}=e,l=null!==(i=null==a?void 0:a.geometryType)&&void 0!==i?i:null===(t=null==a?void 0:a.layerInfo)||void 0===t?void 0:t.geometryType;if("Microsoft Excel"===s||"CSV"===s){if(("address"===a.locationType&&a.addressFields||"coordinates"===a.locationType)&&"esriGeometryPoint"===(null==n?void 0:n.geometryType))return null;if(!l||"none"===a.locationType||"Table"===(null==n?void 0:n.type))return{title:"noGeometryMatchTitle",description:"noGeometryTableMessage"};if((null==n?void 0:n.geometryType)!==l)return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}else if((null==n?void 0:n.geometryType)!==(null==a?void 0:a.geometryType))return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}function s(e,i,t){return"Microsoft Excel"===t||"CSV"===t?"Table"===(null==i?void 0:i.type)||("esriGeometryPoint"===(null==i?void 0:i.geometryType)&&"none"===(null==e?void 0:e.locationType)||"esriGeometryPoint"===(null==i?void 0:i.geometryType)&&(!!e.addressFields||"none"!==e.locationType)):"Table"===(null==i?void 0:i.type)||(null==e?void 0:e.geometryType)===(null==i?void 0:i.geometryType)}t.d(i,{c:()=>s,v:()=>a})},7380:(e,i,t)=>{t.d(i,{a:()=>r,f:()=>n,i:()=>o,m:()=>l});var a=t(11246),s=t(86537);function n(e,i){let t;t=i?i.map((e=>e.type)):Object.keys(s.a);let a=[];return t.forEach((i=>{var t;(null===(t=s.a[i].fileExt)||void 0===t?void 0:t.indexOf(e))>=0&&a.push(s.a[i])})),a}function l(e){return e?(0,a.b)(e.flatMap((e=>{var i;return null===(i=s.a[e])||void 0===i?void 0:i.fileExt})).filter((e=>!!e))):null}const o=e=>e/1024/1024>50,r=e=>e/1024/1024>20}}]);