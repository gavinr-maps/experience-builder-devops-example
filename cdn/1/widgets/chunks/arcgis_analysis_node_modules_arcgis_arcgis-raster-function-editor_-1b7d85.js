"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-1b7d85"],{60567:(e,t,a)=>{a.d(t,{N:()=>l,R:()=>i});const i={CORE:"CORE",STANDARD:"STANDARD"},l={INTEGER:"integer",FLOAT:"float"}},21497:(e,t,a)=>{a.r(t),a.d(t,{rfx_cte_weighted_overlay_table_editor:()=>v});var i=a(17002),l=(a(5294),a(62559)),r=a(14385),s=a(15517),n=a(15195),o=a(19562),c=(a(23795),a(17902),a(56451),a(68852),a(37757)),d=(a(588),a(71802),a(44345),a(33752),a(60567));const h="rfx-cte-weighted-overlay-table-editor",u={colorRed:`${h}__color-red`,grid:`${h}__grid`,layerColumn:`${h}__layer-column`,influenceColumn:`${h}__influence-column`,fieldColumn:`${h}__field-column`,valueColumn:`${h}__value-column`,scaleColumn:`${h}__scale-column`},f="weightedOverlayTableHelpClickHandler",g="remapTableHelpClickHandler",p="scalesHelpClickHandler",m=[{key:"1-3",label:"1-3"},{key:"1-5",label:"1-5"},{key:"1-7",label:"1-7"},{key:"1-9",label:"1-9"},{key:"1-10",label:"1-10"},{key:"1-20",label:"1-20"},{key:"1-25",label:"1-25"},{key:"1-50",label:"1-50"},{key:"1-75",label:"1-75"},{key:"1-100",label:"1-100"}],b={influence:{numberType:d.N.INTEGER,min:0,max:100}},v=class{constructor(e){(0,i.r)(this,e),this.rfxArgumentChange=(0,i.c)(this,"rfxArgumentChange",7),this.helpActionClickEventHandlers=new Map,this.scalesOptions=m,this.refreshRemapsGrid=()=>{const e=this.getRemapGridData();(0,r.o)(e)||(this.remapsGridSchema={...this.remapsGridSchema,gridOptions:e})},this.handleGridRowClick=e=>{const{detail:{gridOptions:t,rowIndex:a}}=e;a<0||a>t?.length-1||(this.selectedRowId=a,this.refreshRemapsGrid())},this.updateValue_weightedOverlayTable=async e=>{const{detail:{gridOptions:t,rowIndex:a,columnName:i}}=e,l=this.inputArgs;if((0,r.o)(t)||(0,r.o)(l))return;const s=[],n=[],o=[];let d=0,h=!1,u=!1,f=!1;t.forEach(((e,a)=>{if(a===t.length-1)return;const{layer:i,influence:l,field:h}=e;if((0,r.o)(i)||(0,r.o)(h))return;s.push(i),o.push(h);let u=(0,c.p)(l);((0,r.o)(u)||isNaN(u))&&(u=0===a?100:0),d+=u,n.push(u/100)})),d!==this.sumOfInfluence&&(h=!0,this.updateSumOfInfluenceElement(d)),u="layer"===i,f="field"===i;const g=l.Rasters,p=l.Influences,m=l.Fields,b=l.Remaps;let v;if(f&&m.value?.[a]===o[a]&&(f=!1),(0,r.o)(g.value)?g.value={elements:s,type:"ArgumentArray"}:g.value.elements=s,p.value=n,m.value=o,t.length>this.weightedOverlayGridOptionsLength?v=t[a]:t.length<this.weightedOverlayGridOptionsLength?(this.deleteLayerRemapStr(a),this.selectedRowId=a+1):t.length===this.weightedOverlayGridOptionsLength&&(h||(v=t[a])),b?.value&&(u&&v?.layer||f)){this.selectedRowId=a;const e=t.length-1;await this.initLayerRemapStr(v,a,e)}this.refreshRemapsGrid(),this.weightedOverlayGridOptionsLength=t.length},this.updateValue_remapTable=e=>{const{detail:{gridOptions:t}}=e,a=this.inputArgs;if((0,r.o)(t)||(0,r.o)(a))return;const i=a.Remaps,l=i?.value?.length;if((0,r.o)(l)||l<1||this.selectedRowId<0||this.selectedRowId>l-1)return;let s="";const n=t.length-1;t.forEach((function(e,t){const{value:a,scale:i}=e;if(!(0,r.o)(a)&&!(0,r.o)(i?.value)){let e=a;const l=i.value;"string"==typeof a&&(e=a.indexOf(" ")>-1?"'"+a+"'":a),s+=e+" "+l,t<n-1&&(s+=" ; ")}})),i.value[this.selectedRowId]=s},this.updateValue_scales=async e=>{e.stopPropagation();const t=e.target.value.replace(/\s/g,"").split("-");if(2!==t.length)return;const a=parseInt(t[0],10),i=parseInt(t[1],10);if(isNaN(a)||isNaN(i)||a>i)return;this.evalScales={evalFrom:a,evalTo:i},this.inputArgs.EvalFrom.value=a,this.inputArgs.EvalTo.value=i;const l=this.selectedRowId,r=this.weightedOverlayGridSchema.gridOptions?.[l],s=this.weightedOverlayGridSchema.gridOptions?.length;await this.initLayerRemapStr(r,l,s),this.refreshRemapsGrid()},this.weightedOverlayGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.remapsGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.sumOfInfluence=0,this.evalScales=void 0,this.widgetArgs=void 0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.b)(this.hostElement,(0,i.g)(".")));const{inputArgs:e,inputLayers:t}=this.widgetArgs;this.inputArgs=e,this.inputLayers=t,this.initScalesSelectOptions(),await this.initGrids()}componentDidLoad(){this.attachHelpClickEventHandlers()}attachHelpClickEventHandlers(){const e=this.widgetArgs.onHelpActionClick({heading:this.strings.weightedOverlayTable,referenceElement:this.weightedOverlayTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_weightedoverlaytable});this.helpActionClickEventHandlers.set(f,e);const t=this.widgetArgs.onHelpActionClick({heading:this.strings.remapTable,referenceElement:this.remapTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_remaptable});this.helpActionClickEventHandlers.set(g,t);const a=this.widgetArgs.onHelpActionClick({heading:this.strings.scales,referenceElement:this.scalesLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_scales});this.helpActionClickEventHandlers.set(p,a)}async getSelectedLayer(e){const t=(0,s.g)(e),a=this.inputLayers.find((e=>e.url===t));if(a&&(await a.load(),(0,r.m)(a)))try{a.rasterInfo=await a.generateRasterInfo(a.rasterFunction)}catch(e){console.error(e)}return a}getScaleOptions(){const e=[];for(let t=this.evalScales.evalFrom;t<=this.evalScales.evalTo;t++)e.push({key:t.toString(),label:t.toString()});return e.push({key:"NODATA",label:"NODATA"}),e.push({key:"RESTRICTED",label:"RESTRICTED"}),e}getDefaultGridOption_weightedOverlayTable(){return{id:0,layer:void 0,field:void 0,influence:0}}getDefaultGridOption_remapTable(){return{id:0,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}}}getRemapGridData(){const e=this.inputArgs?.Remaps,t=this.selectedRowId,a=[];if(t<0||t>e?.value?.length-1)return a;if(e?.value?.[t]){e.value[t].split(";").forEach(((e,t)=>{const i=e.trim().match(/(?:[^\s']+|'[^']*')+/g);if((0,r.o)(i)||2!==i.length)return;let l=i[0];const s=i[1];l.indexOf("'")>-1&&(l=l.replace(/[']+/g,"")),a.push({id:t,value:l,scale:{options:this.getScaleOptions(),value:s}})}));const i=a.length;a.push({id:i,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}})}else a.push(this.getDefaultGridOption_remapTable());return a}async readArgValues(){if((0,r.o)(this.inputArgs))return;const e=this.inputArgs,t=[],a=e.Rasters,i=e.Fields,l=e.Influences,n=e.Remaps,o=a?.value?.elements??a?.value??[];let c=[],d=0,h=0;if((0,r.o)(a)||(0,r.o)(i)||(0,r.o)(l)||(0,r.o)(n)||(d=Math.max(o?.length||0,i.value?.length||0,l.value?.length||0,n.value?.length||0),n.value=n.value??[]),0===d||isNaN(d))return t.push(this.getDefaultGridOption_weightedOverlayTable()),c.push(this.getDefaultGridOption_remapTable()),[t,c];for(;h<d;){const e=o?.[h],a=e?.value;(0,r.o)(a?.url)||(e.value=await(0,s.w)(a,this.inputLayers)),t.push({id:h,rasterElement:e,layer:e,field:i?.value?.[h],influence:l?.value&&((100*l.value[h]).toFixed(2)||(h>0?0:100))}),h+=1}if(n?.value?.length>0)t?.length>0&&t[0]?.layer&&t[0]?.field&&(this.selectedRowId=0,c=this.getRemapGridData());else for(let e=0;e<d;e++)n.value.push("");return[t,c]}async initGrids(){const e={layer:{allowScalar:!1,label:this.strings.layer,uiType:n.G.raster,style:u.layerColumn},influence:{label:this.strings.influence,uiType:n.G.number,style:u.influenceColumn,validationRule:b.influence},field:{label:this.strings.field,uiType:n.G.field,style:u.fieldColumn}},t={value:{label:this.strings.value,uiType:n.G.textInput,style:u.valueColumn},scale:{label:this.strings.scale,uiType:n.G.select,style:u.scaleColumn}},a=await this.readArgValues(),i=a[0],l=a[1];this.weightedOverlayGridOptionsLength=(i?.length??0)+1,this.weightedOverlayGridSchema={...this.weightedOverlayGridSchema,gridLayout:e,gridOptions:i},this.remapsGridSchema={...this.remapsGridSchema,gridLayout:t,gridOptions:l}}initScalesSelectOptions(){if((0,r.o)(this.inputArgs))return;const{EvalFrom:e,EvalTo:t}=this.inputArgs,a=e?.value??1,i=t?.value??9;this.evalScales={evalFrom:a,evalTo:i};const l=`${a}-${i}`;this.scalesOptions.some((e=>e.key===l))||this.scalesOptions.push({key:l,label:l})}updateSumOfInfluenceElement(e){this.sumOfInfluence=e,e>100?this.sumOfInfluenceElement.classList.add(u.colorRed):this.sumOfInfluenceElement.classList.remove(u.colorRed)}async initLayerRemapStr(e,t,a){if((0,r.o)(e)||t<0||a<=0||t>a-1)return;const{layer:i,field:l}=e,{evalFrom:s,evalTo:n}=this.evalScales;if((0,r.o)(i)||(0,r.o)(l))return;let o="";if(!(0,r.o)(i.value?.url)){const e=await this.getSelectedLayer(i.value?.url);if((0,r.o)(e))return;if(e.sourceJSON?.hasRasterAttributeTable&&l){const t=(0,r.m)(e)?e.serviceRasterInfo.attributeTable:e.rasterInfo.attributeTable,a=t?.features;if((0,r.o)(a))return;const i=a.map((e=>e.attributes[l])).filter((function(e,t,a){return a.indexOf(e)===t}));i?.length>1&&!isNaN(i[0])&&i.sort((function(e,t){return e-t}));o=i.map((function(e,t){"string"==typeof e&&(e=e.indexOf(" ")>-1?"'"+e+"'":e);return`${e} ${t+s<=n?t+s:s}`})).join(" ; ")}}const c=t,d=this.inputArgs.Remaps;this.inputArgs.Fields.value.splice(c,1,l),d.value.length===a&&d.value.splice(c,1,o),d.value.length<a&&d.value.splice(c,0,o)}deleteLayerRemapStr(e){this.inputArgs.Remaps.value.splice(e,1)}render(){return(0,i.h)("div",{key:"19786f9b890b9267ec9759d56aeba10d99847adb"},(0,i.h)("calcite-label",{key:"980335f8958520e4bf5a41966f0f4e6873b372f5",alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.weightedOverlayTableLabelElement=e}},(0,i.h)("rfx-label",{key:"d0cab23473de35fc28ff01fd6e02cfd47a178032",label:this.strings.weightedOverlayTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(f)()}),(0,i.h)("rfx-grid",{key:"40cac62cec48be19db08c16b8d03011e1586a160",canAdd:this.weightedOverlayGridSchema.canAdd,class:u.grid,gridLayout:this.weightedOverlayGridSchema.gridLayout,gridOptions:this.weightedOverlayGridSchema.gridOptions,hasBorder:this.weightedOverlayGridSchema.hasBorder,hasHeader:this.weightedOverlayGridSchema.hasHeader,hasIdColumn:this.weightedOverlayGridSchema.hasIdColumn,inputLayers:this.widgetArgs.inputLayers,onRfxGridRowClick:this.handleGridRowClick,onRfxGridOptionChange:this.updateValue_weightedOverlayTable,rfxBrowseLayerClick:this.widgetArgs.onRfxBrowseLayerClick})),(0,i.h)("calcite-label",{key:"efc8b2815409c7f6c02ccf9566c26d04b28f1af1",alignment:"start",scale:o.U.Scale,layout:"inline-space-between"},(0,i.h)("span",{key:"b307b561b72bd5b81b2dd7b185674b76c57f670c"},this.strings.sumOfInfluence),(0,i.h)("span",{key:"5b9ef012046c6b1d7e86e79af626632eff5e36f2",ref:e=>{this.sumOfInfluenceElement=e}},this.sumOfInfluence)),(0,i.h)("calcite-label",{key:"4c10e244a74fdaf8c86e88eb01fe1a61a11f3426",alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.remapTableLabelElement=e}},(0,i.h)("rfx-label",{key:"b6fbf675c56128d6c5314a87a6f80de98f87a8c7",label:this.strings.remapTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(g)()}),(0,i.h)("rfx-grid",{key:"62e89ad1db7ea37ae397fa74a21c9512ce40fee1",canAdd:this.remapsGridSchema.canAdd,class:u.grid,gridLayout:this.remapsGridSchema.gridLayout,gridOptions:this.remapsGridSchema.gridOptions,hasBorder:this.remapsGridSchema.hasBorder,hasHeader:this.remapsGridSchema.hasHeader,hasIdColumn:this.remapsGridSchema.hasIdColumn,onRfxGridOptionChange:this.updateValue_remapTable})),(0,i.h)("calcite-label",{key:"f5528056dfbf83be15ba3b6b126693e9a06415fe",alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.scalesLabelElement=e}},(0,i.h)("rfx-label",{key:"7ad5bdcd94b7578a87398d0390b85641e8444643",label:this.strings.scales,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(p)()}),(0,i.h)("rfx-dtex-common-select",{key:"f20809fcf824c821f1db4b80ab233b56c9abb493",mode:this.widgetArgs.mode,allowCustomValues:!0,options:this.scalesOptions,onRfxArgumentChange:this.updateValue_scales,value:`${this.evalScales.evalFrom}-${this.evalScales.evalTo}`})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.a)(this)}};v.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-cte-weighted-overlay-table-editor__grid table{width:100%;table-layout:fixed}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__color-red{color:red}.rfx-cte-weighted-overlay-table-editor__layer-column{width:40%}.rfx-cte-weighted-overlay-table-editor__influence-column{width:16%}.rfx-cte-weighted-overlay-table-editor__field-column{width:30%}.rfx-cte-weighted-overlay-table-editor__scale-column{width:30%}";a(63716),a(55448),a(2924),a(11840),a(52373),a(440),a(66744),a(38146)},37757:(e,t,a)=>{a.d(t,{a:()=>c,f:()=>o,i:()=>r,p:()=>n,s:()=>s});var i=a(62559),l=a(14385);function r(e){return null!=e&&!1===Number.isNaN(e)&&!0===Number.isFinite(e)}function s(e,t){let a;if(null!==e){const i="string"==typeof e?Number.parseFloat(e):e;r(i)?a=i:r(t)&&(a=t)}return void 0===a?"":`${a}`}function n(e){if(""!==e)return Number.parseFloat(e)}function o(e,t=3){if(!(0,l.o)(e))return Number.parseFloat(e.toFixed(t))}function c(e,t){let a="";if(!(0,l.o)(e)&&!Number.isNaN(e)){const l=(0,i.g)().locale;a=Intl.NumberFormat(l,t).format(Number(e))}return a}},19562:(e,t,a)=>{a.d(t,{C:()=>l,U:()=>i,a:()=>r});const i={Scale:"s",PopoverTimer:60},l={s:"s",m:"m",l:"l"},r={absolute:"absolute",fixed:"fixed"}}}]);