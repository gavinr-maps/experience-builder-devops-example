/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920"],{99004:(e,i,t)=>{t.d(i,{c:()=>a,g:()=>n});var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},37430:(e,i,t)=>{t.d(i,{c:()=>d,g:()=>c,h:()=>p});var a=t(71700),n=t(76173),r=t(28944),s=t(86537),l=t(99907),o=function(e,i){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)i.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]])}return t};function d(e,i){var t;const a=(null==e?void 0:e.type)||null,n=(null==i?void 0:i.type)||null;return n&&(n===a||(null===(t={esriFieldTypeSmallInteger:["esriFieldTypeSmallInteger"],esriFieldTypeInteger:["esriFieldTypeInteger","esriFieldTypeSmallInteger"],esriFieldTypeSingle:["esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeDouble:["esriFieldTypeDouble","esriFieldTypeSingle","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],esriFieldTypeDate:["esriFieldTypeDate"],esriFieldTypeString:["esriFieldTypeString","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeDate","esriFieldTypeGUID","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset","esriFieldTypeBigInteger"],esriFieldTypeGUID:["esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeOID:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger"],esriFieldTypeGlobalID:["esriFieldTypeGlobalID","esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeDateOnly:["esriFieldTypeDateOnly"],esriFieldTypeTimeOnly:["esriFieldTypeTimeOnly"],esriFieldTypeTimestampOffset:["esriFieldTypeTimestampOffset"],esriFieldTypeBigInteger:["esriFieldTypeBigInteger"]}[a])||void 0===t?void 0:t.includes(n)))}function c(e){var i;const{timezone:t,analyzeResults:l,type:d,fieldMappings:c,dataLayer:p,id:u,uidPair:h,addAppendSelectOption:m,sourceDataLayer:g}=e;let f,y;const{publishParameters:v}=l,F=o(l,["publishParameters"]),b="upsert"===m||"update"===m,T=function(e){const i=e.filter((e=>e.source!==n.N)),t=i.map((({source:e,name:i})=>({source:e,name:i})));return t}(c),w=function(e){const i=e.map((e=>e.name));return i}(T),x={dateFieldsTimeReference:{timeZone:t||"UTC",respectsDaylightSaving:!0}},I={sourceTableName:p.name,fieldMappings:(null==T?void 0:T.length)?JSON.stringify(T):null,upsert:b,skipInserts:"update"===m,skipUpdates:!1,useGlobalIds:b&&"esriFieldTypeGlobalID"===(null==h?void 0:h.type),updateGeometry:!b||"attributeAndGeometry"===a.a.addAppendSelectUpdateTypeOption,appendFields:w.length?JSON.stringify(w):null,appendItemId:u,appendUploadFormat:s.a[a.a.type].appendUploadFormat,rollbackOnFailure:!0};"Table"===g.type&&(v.locationType="none");const S=o(v,["layers"]);if("CSV"===d)v.layerInfo.dateFieldsTimeReference=x.dateFieldsTimeReference,y=Object.assign(Object.assign(Object.assign({},x),v),F);else if("Microsoft Excel"===d){const e=function(e,i){const t=Object.assign({},e);t.locationType=(null==i?void 0:i.locationType)||e.locationType,"address"===t.locationType?(t.addressFields=i.addressFields,t.sourceCountry=i.sourceCountry):"coordinates"===t.locationType&&(t.coordinateFieldType=i.coordinateFieldType,"LatitudeAndLongitude"===t.coordinateFieldType?(t.latitudeFieldName=i.latitudeFieldName,t.longitudeFieldName=i.longitudeFieldName):t.coordinateFieldName=i.coordinateFieldName);return t}((0,r.a)({},!0),S);e.dateFieldsTimeReference=x.dateFieldsTimeReference,S.name=p.name,y=Object.assign(Object.assign(Object.assign(Object.assign({},x),{layers:[e]}),S),F)}else y=Object.assign(Object.assign(Object.assign({},x),v),F);return f=Object.assign(Object.assign({},I),{appendSourceInfo:JSON.stringify(y)}),"add"===m?f.upsertMatchingField=g.objectIdField||(null===(i=g.uniqueField)||void 0===i?void 0:i.name):b&&(null==h?void 0:h.isUniqueIndex)&&(f.upsertMatchingField=null==h?void 0:h.name),f}function p(e,i){const t=i.appendErrorMessages;let a=l.u.i18n.error,n=t.appendError;switch(e.code){case"invalidUniqueIdentifier":a=t.invalidUniqueIdentifier.title,n=t.invalidUniqueIdentifier.description;break;case"cannotAddNullData":a=t.cannotAddNullData.title,n=t.cannotAddNullData.description;break;case"exceededMaxFieldLength":a=t.exceededMaxFieldLength.title,n=t.exceededMaxFieldLength.description;break;case"invalidFieldType":a=t.invalidFieldType.title,n=t.invalidFieldType.description}return{title:a,description:n}}},51566:(e,i,t)=>{t.d(i,{a:()=>s});var a=t(46581),n=t(37430),r=t(39274);async function s(e){var i;const t=(0,n.g)(e),s=`${null===(i=e.existingItem)||void 0===i?void 0:i.url}/${e.sourceDataLayer.id}/append`;try{const i=await(0,a.r)(s,t,{},"post"),{status:n,recordCount:l}=await(0,r.g)(e.id,{},null==i?void 0:i.statusUrl);return{result:{status:n,recordCount:l}}}catch(e){let i="unhandledError";const t={error:e}.error.description.toLowerCase();switch(!0){case t.includes("the create unique index statement terminated because a duplicate key was found for the object name"):i="invalidUniqueIdentifier";break;case t.includes("does not allow nulls"):i="cannotAddNullData";break;case t.includes("the value violates the maxlength limit of this column"):i="exceededMaxFieldLength";break;case t.includes("input string was not in a correct format"):i="invalidFieldType"}return console.error(e),{error:{code:i,message:JSON.stringify(e)}}}}},76173:(e,i,t)=>{t.d(i,{A:()=>l,N:()=>n,a:()=>s,b:()=>r,c:()=>d,d:()=>o,u:()=>a});const a=["esriFieldTypeOID","esriFieldTypeGlobalID"],n="<None>",r={"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel",geopackage:"geoPackage"},s={Shapefile:"shapefile","File Geodatabase":"fileGeodatabase",CSV:"csv","Microsoft Excel":"excel",GeoJson:"geojson",GeoPackage:"geoPackage"},l={csv:"CSV",excel:"Microsoft Excel",shapefile:"Shapefile",fgdb:"File Geodatabase",geojson:"GeoJson",googlesheets:"Microsoft Excel"},o=["zip","csv","xls","xlsx","geojson","gpkg","json"],d=["zip","csv","xls","xlsx"]},38092:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_append_match_fields:()=>c});var a=t(7263),n=t(71700),r=t(76173),s=t(99907),l=t(37430),o=t(50852),d=t(51566);t(11935),t(28944),t(59296),t(2174),t(28926),t(70506),t(99004),t(94788),t(31670),t(71695),t(66488),t(46581),t(65215),t(86537),t(7652),t(51325),t(39274),t(49712),t(90079),t(57399),t(67575),t(15437),t(73596),t(91253),t(43780),t(59673);const c=class{constructor(e){(0,a.r)(this,e),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemDisableCloseButtons=(0,a.c)(this,"newItemDisableCloseButtons",7),this.validatedFields=[],this.ITEMS_PER_PAGE=15,this.fields=void 0,this.i18n=void 0,this.fieldMatches=[],this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0,this.currentStart=1,this.filteredFields=[],this.searchTerm=""}handleNext(){const e=this.validateMatchings();e?this.error=e:(n.a.fieldMappings=this.fieldMatches,"add"!==this.appendSelection?this.newItemUpdatePage.emit("appendSelectUpdate"):this.handleAppend())}validateMatchings(){if(!this.fieldMatches.every((e=>e.source===r.N))){const e=this.fieldMatches.filter((e=>!e.disabled&&!e.nullable&&e.source===r.N)),i=e.every((e=>e.defaultValue&&!e.isUniqueIndex));return e.length<=0||"update"===this.appendSelection||i&&"add"===this.appendSelection?null:{title:this.i18n.errors.nonNullableErrorTitle,description:this.i18n.errors.nonNullableErrorDescription}}return{title:this.errorLabel,description:this.i18n.errors.noMatchedFields}}disableModalButtons(e){this.newItemToggleNavigationEnabled.emit(!e),this.newItemDisableCloseButtons.emit(e)}async handleAppend(){var e,i,t;const{sourceDataLayer:a,existingItem:r,timezone:c,analyzeResults:p,type:u,fieldMappings:h,dataLayer:m,id:g,uidPair:f,addAppendSelectOption:y}=n.a;this.disableModalButtons(!0),this.loading=!0,this.loaderMessage=s.u.i18n.append.appendLoadingMessages.appendCloseNotice;const v=await(0,d.a)({sourceDataLayer:a,existingItem:r,timezone:c,analyzeResults:p,type:u,fieldMappings:h,dataLayer:m,id:g,uidPair:f,addAppendSelectOption:y});if("completed"!==(null===(i=null===(e=null==v?void 0:v.result)||void 0===e?void 0:e.status)||void 0===i?void 0:i.toLowerCase()))this.disableModalButtons(!1),this.loading=!1,this.newItemToggleNavigationEnabled.emit(!0),this.error=(0,l.h)(null!==(t=null==v?void 0:v.error)&&void 0!==t?t:{code:"unhandledError"},{appendErrorMessages:s.u.i18n.append.appendErrorMessages});else{await(0,o.d)(n.a.id,{permanentDelete:!0});const e=Object.assign({appendType:n.a.addAppendSelectOption},v);this.workflowComplete.emit(e)}}async handlePrev(e){var i;this.loading||"add"!==this.appendSelection||(null===(i=n.a.analyzeResults.publishParameters.layers)||void 0===i?void 0:i.length)>1||(e.preventDefault(),this.newItemPrevPage.emit())}handleFieldChange(e){const i=Object.assign({},e.detail);this.validateFieldMappings(this.validatedFields,i)}sortFields(){this.fieldMatches=this.fieldMatches.sort((function(e,i){const t=e.name.toLowerCase(),a=i.name.toLowerCase();return t<a?-1:t>a?1:0}))}validateFieldMappings(e,i){if(i.initialMatch=i.source,i.source!==this.noneString){const t=e.filter((e=>e.source===i.source));if((null==t?void 0:t.length)>0){const i=t[0].idx;e[i].initialMatch=this.noneString,e[i].source=this.noneString}}if(e[i.idx]=i,this.validatedFields=e,this.fieldMatches=[...this.validatedFields],this.sortFields(),this.searchTerm.length>0){const{currentStart:e}=this;this.fetchFields(this.searchTerm),this.currentStart=e}}setNextText(){s.u.nextText="add"===this.appendSelection?"addAndComplete":"next"}componentWillLoad(){const{addAppendSelectOption:e,uidPair:i,sourceDataLayer:t,backupLayerFields:a}=n.a;this.i18n=s.u.i18n.appendMatchFields,this.errorLabel=s.u.i18n.error,this.noneString=s.u.i18n.appendKeyValuePair.noneField,this.appendSelection=e;const r=a,l="csv"===t.type?[t.layerInfo]:t.fields,o="upsert"===this.appendSelection||"update"===this.appendSelection;this.setNextText(),this.selectedKeyPair=i;let d="add"===this.appendSelection?0:1;l.forEach((e=>{"esriFieldTypeOID"===(null==e?void 0:e.type)||"esriFieldTypeGlobalID"===(null==e?void 0:e.type)||!e.editable||o&&e.name===this.selectedKeyPair.name||(this.fieldMatches.push(this.createFieldMapping(e,r,d)),this.validatedFields.push(this.createFieldMapping(e,r,d)),d++)})),"add"!==this.appendSelection&&(this.fieldMatches.unshift(this.selectedKeyPair),this.validatedFields.unshift(this.selectedKeyPair)),this.sortFields()}createFieldMapping(e,i,t){const a=n.a.dataLayer.addressFields?Object.values(n.a.dataLayer.addressFields):null;let r=this.noneString;const s=[{source:this.noneString,name:e.name,type:"None",idx:t}];return i.forEach((i=>{!(0,l.c)(e,i)||"add"!==this.appendSelection&&i.name===this.selectedKeyPair.source||(s.push({source:i.name,name:e.name,type:e.type,idx:t}),e.name.toLowerCase()!==i.name.toLowerCase()||e.type!==i.type&&!(null==a?void 0:a.find((e=>e===i.displayName||e===i.name)))||"add"!==this.appendSelection&&i.name===this.selectedKeyPair.source||(r=i.name))})),{source:r,name:e.name,nullable:e.nullable,type:e.type,idx:t,isUniqueIndex:e.isUniqueIndex,defaultValue:e.defaultValue,initialMatch:r,possibleMatches:s}}fetchFields(e){this.searchTerm=e.toLowerCase();const i=this.fieldMatches.filter((e=>e.name.toLowerCase().includes(this.searchTerm,0)));this.currentStart=1,this.filteredFields=i}render(){const{i18n:e,error:i,ITEMS_PER_PAGE:t,fieldMatches:r,currentStart:l,filteredFields:o,searchTerm:d}=this,{originalFileName:c,existingItem:p}=n.a;if(!p)return;const u={originalField:{header:e.originalField.header,moreInfo:e.originalField.moreInfo.replace("${featureLayerName}",p.title)},uploadedField:{header:e.uploadedField.header,moreInfo:e.uploadedField.moreInfo.replace("${uploadedFileName}",c)}},h=e.description.replace("${uploadedFileName}",c).replace("${featureLayerName}",p.title),m=d.length>0?o:r,g=m.length>0,f=m.length>t,y=null==m?void 0:m.slice(l-1,l+t-1);return(0,a.h)(a.H,{class:{"overflow-hidden":this.loading}},(0,a.h)("arcgis-new-item-loader",{type:this.loaderType,active:this.loading,text:this.loaderMessage}),(0,a.h)("div",{class:"header"}," ",e.header," "),(0,a.h)("div",{class:"description"},h),(0,a.h)("div",{class:"search-bar"},(0,a.h)("calcite-input",{icon:"search",class:"search-match-fields",placeholder:s.u.i18n.layerSearch.search,onCalciteInputInput:e=>{const i=e.target.value;this.fetchFields(i)}})),(0,a.h)("div",{class:"row",role:"row"},Object.keys(u).map((e=>{const{header:i,moreInfo:t}=u[e];return(0,a.h)("span",{class:"header-cell",role:"columnheader","aria-sort":"none"},i,(0,a.h)("arcgis-information",{class:"header-popover",label:t,placement:"top-start",paddedContent:!0},(0,a.h)("p",{class:"popover-content"},t)))}))),g?(0,a.h)("div",{class:"fields-scroll-container",role:"table"},y.map((e=>(0,a.h)("arcgis-new-item-append-match-field",{key:e.source,onFieldChange:this.handleFieldChange.bind(this),field:e,role:"row"})))):(0,a.h)("calcite-input-message",{class:"no-fields",icon:!0,status:"valid"},this.i18n.errors.noFields),f&&(0,a.h)("div",{class:"pagination"},(0,a.h)("calcite-pagination",{scale:"m",class:"pagination-component",totalItems:m.length,pageSize:t,startItem:this.currentStart,onCalcitePaginationChange:e=>{this.currentStart=e.target.startItem}})),(0,a.h)("arcgis-new-item-alert",{heading:null==i?void 0:i.title,description:null==i?void 0:i.description,link:{href:null==i?void 0:i.link,title:null==i?void 0:i.linkText},active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.d)(this)}};c.style=".fields-container{display:flex;height:100%;flex-direction:column;overflow-y:auto;overflow-x:hidden}.field-table{margin-bottom:1.5rem;display:flex;flex-direction:column;overflow:auto}.search-container{display:flex;width:100%}.field-search{margin-right:0.5rem;width:50%}.field-select{width:50%}.field-name-column{margin-right:0.5rem;width:50%}.match-field-name-column{width:50%}.fields-scroll-container{margin-bottom:0.75rem;display:flex;flex-direction:column;padding-bottom:0.75rem;border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.header-row{display:flex;align-content:flex-start;justify-content:center;gap:0.25rem;padding:0.25rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.header-cell{display:flex;width:100%;font-size:1rem}.hide{display:none}.not-visible{visibility:hidden;height:0px}.cell{box-sizing:border-box;width:100%}.cell label{margin-top:0.75rem}.row{margin-bottom:0.75rem;display:flex;align-items:center;justify-content:space-between;gap:0.25rem;padding:0.25rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0}.append-timezone{border-top:0.063rem solid var(--calcite-color-foreground-3)}.from-to-fields{display:flex;flex-direction:row}.description{margin-bottom:1rem;font-size:0.875rem;font-weight:300}.header{margin-bottom:0.5rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.no-fields{margin-bottom:1.5rem}.popover-icon{cursor:pointer;color:var(--calcite-color-text-3);margin-inline-start:0.75rem;margin-top:0.125rem}.popover-content{margin:0px;font-size:0.75rem;font-weight:400}.header-popover{margin-top:-0.313rem}.search-match-fields{margin-bottom:1rem}.pagination-component{display:flex;justify-content:center}"},70506:(e,i,t)=>{t.d(i,{e:()=>r});var a,n=t(99004),r={exports:{}};a=r.exports,n.c,function(e){var i={Promise:"undefined"!=typeof window?window.Promise:void 0},t="4.24",a="next";function n(e){if(e.toLowerCase()===a)return a;var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}function r(e){return void 0===e&&(e=t),"https://js.arcgis.com/".concat(e,"/")}function s(e){void 0===e&&(e=t);var i=r(e),s=n(e);if(s!==a&&3===s.major){var l=s.minor<=10?"js/":"";return"".concat(i).concat(l,"esri/css/esri.css")}return"".concat(i,"esri/themes/light/main.css")}function l(e){var i=document.createElement("link");return i.rel="stylesheet",i.href=e,i}function o(e,i){if(i){var t=document.querySelector(i);t.parentNode.insertBefore(e,t)}else document.head.appendChild(e)}function d(e){return document.querySelector('link[href*="'.concat(e,'"]'))}function c(e){return!e||n(e)?s(e):e}function p(e,i){var t=c(e),a=d(t);return a||o(a=l(t),i),a}var u={};function h(e){var i=document.createElement("script");return i.type="text/javascript",i.src=e,i.setAttribute("data-esri-loader","loading"),i}function m(e,i,t){var a;t&&(a=g(e,t));var n=function(){i(e),e.removeEventListener("load",n,!1),a&&e.removeEventListener("error",a,!1)};e.addEventListener("load",n,!1)}function g(e,i){var t=function(a){i(a.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",t,!1)};return e.addEventListener("error",t,!1),t}function f(e){void 0===e&&(e={}),u=e}function y(){return document.querySelector("script[data-esri-loader]")}function v(){var e=window.require;return e&&e.on}function F(e){void 0===e&&(e={});var t={};[u,e].forEach((function(e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}));var a=t.version,n=t.url||r(a);return new i.Promise((function(e,i){var r=y();if(r){var s=r.getAttribute("src");s!==n?i(new Error("The ArcGIS API for JavaScript is already loaded (".concat(s,")."))):v()?e(r):m(r,e,i)}else if(v())i(new Error("The ArcGIS API for JavaScript is already loaded."));else{var l=t.css;l&&p(!0===l?a:l,t.insertCssBefore),m(r=h(n),(function(){r.setAttribute("data-esri-loader","loaded"),e(r)}),i),document.body.appendChild(r)}}))}function b(e){return new i.Promise((function(i,t){var a=window.require.on("error",t);window.require(e,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.remove(),i(e)}))}))}function T(e,i){if(void 0===i&&(i={}),v())return b(e);var t=y(),a=t&&t.getAttribute("src");return!i.url&&a&&(i.url=a),F(i).then((function(){return b(e)}))}e.utils=i,e.loadModules=T,e.getScript=y,e.isLoaded=v,e.loadScript=F,e.setDefaultOptions=f,e.loadCss=p,Object.defineProperty(e,"__esModule",{value:!0})}(a)},28926:(e,i,t)=>{t.d(i,{l:()=>n});var a=t(70506);const n=async(e,i)=>(await a.e.exports.loadModules(e,i)).map((e=>e.__esModule&&e.default?e.default:e))}}]);