/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-af5396.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-af5396"],{32449:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_color_size_slider:()=>N,arcgis_smart_mapping_heatmap_slider:()=>M,arcgis_smart_mapping_panels_chart:()=>z,arcgis_smart_mapping_panels_chart_size:()=>E,arcgis_smart_mapping_panels_color:()=>B,arcgis_smart_mapping_panels_color_size:()=>V,arcgis_smart_mapping_panels_color_size_univariate:()=>T,arcgis_smart_mapping_panels_compare:()=>O,arcgis_smart_mapping_panels_dot_density:()=>P,arcgis_smart_mapping_panels_heatmap:()=>I,arcgis_smart_mapping_panels_predominance:()=>F,arcgis_smart_mapping_panels_predominance_size:()=>D,arcgis_smart_mapping_panels_relationship:()=>R,arcgis_smart_mapping_panels_relationship_size:()=>L,arcgis_smart_mapping_panels_simple:()=>A,arcgis_smart_mapping_panels_type:()=>_,arcgis_smart_mapping_panels_type_size:()=>H});var s=i(7263),a=(i(77040),i(70506),i(82646)),l=i(89936),o=i(95875),n=i(13521),r=i(43025),d=i(90367),c=i(59101),h=i(12234),u=i(11246),p=i(58233),m=i(96432),g=i(75148),b=i(32118),v=i(99680),S=i(93143),f=i(64164),y=i(96034);i(99004),i(62159),i(78613),i(11935),i(1991),i(28926),i(64391),i(75002);function C(e,t){let i,s,a,l,o,n,r,d,c,h,u=e.slice(0),p=0,m=t&&null!=t.tolerance?t.tolerance:2,g=t&&t.indexes,b=!(!t||null==t.strictBounds)&&t.strictBounds;const v=(e,t)=>e-t;if(g)g.sort(v);else for(g=[],r=0;r<u.length;r++)g.push(r);for(r=0;r<g.length;r++)if(h=g[r],i=u[h],s=0===h?void 0:u[h-1],a=h===u.length-1?void 0:u[h+1],l=k(i),o=l.fractional,o){for(d=0,c=!1;d<=o&&!c;)n=w(i,d),p=b&&0===r?n[1]:n[0],c=x(i,p,s,a,m),d++;c&&(u[h]=p)}return u}function k(e){let t=String(e),i=t.match(/^-?(\d+)(\.(\d+))?$/i),s={integer:0,fractional:0};if(i&&i[1])s.integer=i[1].split("").length,s.fractional=i[3]?i[3].split("").length:0;else if(t.toLowerCase().indexOf("e")>-1){let e,i,a=t.split("e"),l=a[0],o=a[1];if(l&&o){const t=Number(l);let a=Number(o);i=a>0,i||(a=Math.abs(a)),e=k(t),i?(e.integer+=a,a>e.fractional?e.fractional=0:e.fractional-=a):(e.fractional+=a,a>e.integer?e.integer=1:e.integer-=a),s=e}}return s}function w(e,t){let i,s;return i=Number(e.toFixed(t)),i<e?s=i+1/Math.pow(10,t):(s=i,i-=1/Math.pow(10,t)),i=Number(i.toFixed(t)),s=Number(s.toFixed(t)),[i,s]}function x(e,t,i,s,a){let l,o,n,r=function(e,t,i,s){let a,l,o,n={prev:null,next:null};null!=i&&(a=e-i,l=t-i,o=l-a,n.prev=Math.floor(Math.abs(100*o/a)));null!=s&&(a=s-e,l=s-t,o=l-a,n.next=Math.floor(Math.abs(100*o/a)));return n}(e,t,i,s);return l=null==r.prev||r.prev<=a,o=null==r.next||r.next<=a,n=l&&o||r.prev+r.next<=2*a,n}const N=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingColorSizeSliderChange=(0,s.c)(this,"arcgisSmartMappingColorSizeSliderChange",7),this.arcgisSmartMappingColorSizeSliderError=(0,s.c)(this,"arcgisSmartMappingColorSizeSliderError",7),this.currentColorStopValues=[],this.currentSizeStopSizes=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.histogramStatus=a.h.MISSING,this.statisticsStatus=a.h.MISSING,this.sliderZoomed=!1}async updateStatistics(){var e;this.statisticsStatus=a.h.MISSING,this.statistics=null,this.histogramStatus=a.h.MISSING,this.histogram=null,null===(e=this.colorSizeSlider)||void 0===e||e.destroy(),this.colorSizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}componentDidLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}render(){const{config:e}=a.s;return(0,s.h)(s.H,{key:"119829d5573e0a2e043a95ffa473debc3e926fcf"},(0,s.h)("link",{key:"2b4ba640b72cd98b84a4fae14102d7245ecdb458",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.hostElement)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.hostElement)}}),"loaded"===this.styleSheetStatus?this.renderColorSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSizeSliderLoading():null)}renderColorSizeSlider(){var e,t,i,l;const{histogramStatus:o,statistics:n,statisticsStatus:r,sliderZoomed:c}=this,{strings:h}=a.s,u=(0,a.b)(),p=u.authoringInfo,m=(0,a.d)(u,"color"),g=(0,a.d)(u,"size"),b="above-and-below"===p.univariateTheme;if(r!==a.h.FAILED&&r!==a.h.MISSING){if(r===a.h.IN_PROGRESS||o===a.h.IN_PROGRESS&&!this.colorSizeSlider)return this.renderColorSizeSliderLoading();{const o=this.prepareColorSizeSlider();let r=!1;if(m&&!c){const i=(0,a.J)(u,"color"),s=(0,d.g)(),l=(0,a.aJ)(s,null!==(e=null==i?void 0:i.minSliderValue)&&void 0!==e?e:n.min,null!==(t=null==i?void 0:i.maxSliderValue)&&void 0!==t?t:n.max);((null==l?void 0:l.minMaxSame)||!(0,a.O)(null==l?void 0:l.min)&&!(0,a.O)(null==l?void 0:l.max))&&(r=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}else if(g&&!c){const e=(0,a.J)(u,"size"),t=(0,a.aJ)(b?g.stops:[{value:g.minDataValue},{value:g.maxDataValue}],null!==(i=null==e?void 0:e.minSliderValue)&&void 0!==i?i:n.min,null!==(l=null==e?void 0:e.maxSliderValue)&&void 0!==l?l:n.max);(t.minMaxSame||!(0,a.O)(t.min)&&!(0,a.O)(t.max))&&(r=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return m&&(this.currentColorStopValues=m.stops.map((e=>e.value))),(null==g?void 0:g.stops)&&(this.currentSizeStopSizes=g.stops.map((e=>e.size))),(o||this.colorSizeSlider)&&this.colorSizeSlider.min!==this.colorSizeSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,h.colorSizeSlider.dataRange),(0,s.h)("div",{class:"slider-box-buttons-front"},this.renderInvertButton(),g&&(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),this.renderZoomButton(r),(0,s.h)("div",null,"\xa0"),this.renderResetButton())),(0,s.h)("div",{ref:e=>{e&&this.afterColorSizeSliderCreate(e)}})):this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max?null:this.renderColorSizeSliderLoading()}}this.colorSizeSlider&&(this.colorSizeSlider.destroy(),this.colorSizeSlider=void 0)}renderColorSizeSliderLoading(){const{strings:e}=a.s;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=a.s;return(0,s.h)("arcgis-smart-mapping-action",{text:e.colorSizeSlider.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:t}=a.s,{sliderZoomed:i}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:t.colorSizeSlider.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>{e&&(this.zoomButtonNode=e)}})}renderResetButton(){const{strings:e}=a.s;return(0,s.h)("arcgis-smart-mapping-action",{text:e.colorSizeSlider.resetSlider,icon:"undo",onClick:()=>this.handleResetSlider()})}prepareColorSizeSlider(){var e,t,i,s,o,c,h,u;const{statistics:p,histogram:m,histogramStatus:g,sliderZoomed:b}=this,{mapView:v,modules:S}=a.s,f=(0,a.b)(),y=(0,a.a)(),C="above-and-below"===f.authoringInfo.univariateTheme,k=["size-age","color-size-age","type-size-age"].indexOf(y)>-1,w=this.getFieldInfo().simpleFieldType===a.w.DATE,x=(0,a.d)(f,"color"),N=(0,a.d)(f,"size"),M=(0,a.J)(f,"size"),z=(0,a.J)(f,"color");let E,B,V;z?(E=(0,a.aI)(z.theme,x.stops,!0),B=null==z?void 0:z.minSliderValue,V=null==z?void 0:z.maxSliderValue):(B=null!==(e=null==M?void 0:M.minSliderValue)&&void 0!==e?e:p.min,V=null!==(t=null==M?void 0:M.maxSliderValue)&&void 0!==t?t:p.max),({min:B,max:V}=(0,a.aG)({min:B,max:V}));const T=this.colorSizeSlider;if(this.colorSizeSlider&&(x&&T.style||!x&&!T.style)&&(null===(i=this.colorSizeSlider)||void 0===i||i.destroy(),this.colorSizeSlider=void 0),g===a.h.IN_PROGRESS)return!1;if(this.colorSizeSlider){if("dragging"===(null===(s=this.colorSizeSlider.slider)||void 0===s?void 0:s.state))return!0;let e={histogramConfig:{bins:null==m?void 0:m.bins,average:Math.round(10*p.avg)/10,standardDeviation:p.stddev,standardDeviationCount:1},min:null!=B?B:p.min,max:null!=V?V:p.max};x?(e=Object.assign(Object.assign({},e),E),e.stops=(0,d.g)(),e.precision=(0,n.g)(e.stops),e.hasTimeData=w&&!k,w&&(0,l.a)(e,v.timeZone),b?this.zigzagClick||(e.zoomOptions=(0,a.aJ)(x.stops,null!==(o=null==z?void 0:z.minSliderValue)&&void 0!==o?o:p.min,null!==(c=null==z?void 0:z.maxSliderValue)&&void 0!==c?c:p.max)):e.zoomOptions=null,e.histogramConfig.barCreatedFunction=m&&r.b.bind(this,x,m,this.colorSliderBars),(0,r.u)(this.colorSizeSlider,this.colorSliderBars,e,m)):(e.style={trackBelowFillColor:(0,a.Q)(f.classBreakInfos[0].symbol)||new S.esriColor([0,0,0,.5]),trackAboveFillColor:(0,a.Q)(f.classBreakInfos[1].symbol)||new S.esriColor([0,0,0,.5])},e.stops=N.stops,e.precision=(0,n.g)(e.stops),b?this.zigzagClick||(e.zoomOptions=(0,a.aJ)(C?N.stops:[{value:N.minDataValue},{value:N.maxDataValue}],null!==(h=null==M?void 0:M.minSliderValue)&&void 0!==h?h:p.min,null!==(u=null==M?void 0:M.maxSliderValue)&&void 0!==u?u:p.max)):e.zoomOptions=null),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(e.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSizeSlider.slider.min=e.zoomOptions.min,e.zoomOptions.min=null):(this.colorSizeSlider.slider.max=e.zoomOptions.max,e.zoomOptions.max=null)),this.adjustedZoomOptions=null,this.zoomAdjustment=null,this.colorSizeSlider.set(e),this.zigzagClick=!1}else{this.colorSliderBars=[];let e={histogramConfig:{bins:null==m?void 0:m.bins,average:Math.round(10*p.avg)/10,standardDeviation:p.stddev,standardDeviationCount:1},min:null!=B?B:p.min,max:null!=V?V:p.max};C&&(e.primaryHandleEnabled=!0,e.persistSizeRangeEnabled=!0),w&&(e.hasTimeData=!0,(0,l.a)(e,v.timeZone)),x?(e=Object.assign(Object.assign({},e),E),e.stops=(0,d.g)(),e.precision=(0,n.g)(x.stops),e.histogramConfig.barCreatedFunction=m&&r.b.bind(this,e,m,this.colorSliderBars),this.colorSizeSlider=new S.ColorSizeSlider(e),this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(e),(0,r.u)(this.colorSizeSlider,this.colorSliderBars)):(e.style={trackBelowFillColor:(0,a.Q)(f.classBreakInfos[0].symbol)||new S.esriColor([0,0,0,.5]),trackAboveFillColor:(0,a.Q)(f.classBreakInfos[1].symbol)||new S.esriColor([0,0,0,.5])},e.stops=N.stops,e.handlesSyncedToPrimary=!1,e.precision=(0,n.g)(e.stops),this.colorSizeSlider=new S.BinaryColorSizeSlider(e),this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(e)),this.createColorSizeSliderChangeEvents()}return(0,a.O)(this.colorSizeSlider)}handleInvertSlider(){const e=(0,a.b)(),t=(0,a.d)(e,"color");if(t){let e=t.stops.map((e=>e.color));e=e.reverse(),t.stops.forEach(((t,i)=>{t.color=e[i]}))}else{const t=(0,a.Q)(e.classBreakInfos[0].symbol);(0,a.W)(e.classBreakInfos[0].symbol,(0,a.Q)(e.classBreakInfos[1].symbol)),(0,a.W)(e.classBreakInfos[1].symbol,t)}const i=(0,a.d)(e,"size");[i.minSize,i.maxSize]=[i.maxSize,i.minSize],(0,a.u)(),(0,s.f)(this.hostElement),this.arcgisSmartMappingColorSizeSliderChange.emit()}handleZoomSlider(e){var t,i,s,l;if(this.histogramStatus===a.h.IN_PROGRESS)return;const{statistics:o}=this,n=(0,a.b)(),r="above-and-below"===n.authoringInfo.univariateTheme;this.sliderZoomed=(0,a.O)(e)?e:!this.sliderZoomed;const d=(0,a.d)(n,"size");d||(this.sliderZoomed=!1);const c=d?d.normalizationField:n.normalizationField,h=this.getFieldInfo(),u=(0,a.J)(n,"size"),p=this.sliderZoomed?(0,a.aJ)(r?d.stops:[{value:d.minDataValue},{value:d.maxDataValue}],null!==(t=null==u?void 0:u.minSliderValue)&&void 0!==t?t:o.min,null!==(i=null==u?void 0:u.maxSliderValue)&&void 0!==i?i:o.max):null,m=(null==u?void 0:u.minSliderValue)===(null==u?void 0:u.maxSliderValue);this.getHistogram(h,c,o,p&&p.min||(m?o.min:null!==(s=null==u?void 0:u.minSliderValue)&&void 0!==s?s:o.min),p&&p.max||(m?o.max:null!==(l=null==u?void 0:u.maxSliderValue)&&void 0!==l?l:o.max))}handleResetSlider(){const e=(0,a.b)(),t=e.authoringInfo;this.sliderZoomed=!1;const i=(0,a.d)(e,"color"),l=(0,a.d)(e,"size"),n=(0,a.J)(e,"color"),r=(0,a.J)(e,"size"),c=this.getFieldInfo(),h=i?i.normalizationField:e.normalizationField;(0,o.r)((0,d.b)({fieldInfos:[c],normalizationField:l.normalizationField,theme:t.univariateTheme,isContinuous:!!i,noReuse:!0,discardMinMax:!0}),this.flowItemNode).then((e=>{var t;if(0===(null===(t=e.statistics)||void 0===t?void 0:t.count)){const[t,i]=this.getDefaultDataRange(c),s=t,l=i;e.statistics.min=s,e.statistics.max=l,e.statistics.avg=(l+s)/2,this.statistics=e.statistics,this.statisticsStatus=a.h.SUCCESS}else e.statistics&&(0,a.O)(e.statistics.min)&&(0,a.O)(e.statistics.max)&&e.statistics.min<=e.statistics.max?(e.statistics=(0,a.aG)(e.statistics),this.statistics=e.statistics,this.statisticsStatus=a.h.SUCCESS,this.getHistogram(c,h,e.statistics,e.statistics.min,e.statistics.max)):this.statisticsStatus=a.h.FAILED;n&&(n.minSliderValue=this.statistics.min,n.maxSliderValue=this.statistics.max),r.minSliderValue=this.statistics.min,r.maxSliderValue=this.statistics.max,(0,a.u)(),(0,s.f)(this.hostElement)}),(e=>this.arcgisSmartMappingColorSizeSliderError.emit(e)))}afterColorSizeSliderCreate(e){if(this.colorSizeSlider.container)e.append(this.colorSizeSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.colorSizeSlider.container=t}}getStatistics(){var e;const{layer:t,useFeatureReduction:i,mapView:s,modules:l}=a.s,o=t,n=(0,a.b)(),r=(0,a.d)(n,"size"),d=(0,a.J)(n,"size");let c,h;const u=this.getFieldInfo(),p=r?r.normalizationField:n.normalizationField;c=null==d?void 0:d.minSliderValue,h=null==d?void 0:d.maxSliderValue,this.statisticsStatus=a.h.IN_PROGRESS,this.statistics||l.summaryStatistics({layer:o,view:s,field:u.field,valueExpression:u.expression,normalizationField:p,forBinning:"featureReduction"in o&&"binning"===(null===(e=o.featureReduction)||void 0===e?void 0:e.type)&&i}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(u),s=(null==d?void 0:d.minSliderValue)||t,l=(null==d?void 0:d.maxSliderValue)||i;e.min=s,e.max=l,e.avg=(l+s)/2,(0,a.O)(d.minSliderValue)||(d.minSliderValue=s,d.maxSliderValue=l)}else if(!(0,a.O)(e.avg)||!(0,a.O)(e.min)||!(0,a.O)(e.max))return void(this.statisticsStatus=a.h.FAILED);e=(0,a.aG)(e),c=null!=c?c:e.min,h=null!=h?h:e.max,c===h&&(c=e.min,h=e.max),this.statistics=e,this.statisticsStatus=a.h.SUCCESS,this.getHistogram(u,p,e,c,h)}),(e=>{console.log(e),this.statisticsStatus=a.h.FAILED}))}getHistogram(e,t,i,s,l){var o;const{layer:n,useFeatureReduction:r,mapView:d,modules:c}=a.s,h=n;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=a.h.IN_PROGRESS,c.histogram({layer:h,view:d,field:e.field,valueExpression:e.expression,numBins:50,minValue:(0,a.O)(s)?s:i.min,maxValue:(0,a.O)(l)?l:i.max,normalizationField:t,forBinning:"featureReduction"in h&&"binning"===(null===(o=h.featureReduction)||void 0===o?void 0:o.type)&&r}).then((e=>{this.histogram=e,this.histogramStatus=a.h.SUCCESS}),(()=>{this.histogramStatus=a.h.FAILED})))}onMinMaxChange(e,t,i){const s=(0,a.b)(),l=s.authoringInfo,o="above-and-below"===(null==l?void 0:l.univariateTheme),n=(0,a.d)(s,"color"),r=(0,a.d)(s,"size");(null==n?void 0:n.stops)&&(e=Math.min(e,n.stops[0].value),t=Math.max(t,n.stops[n.stops.length-1].value)),o&&(e=Math.min(e,r.stops[0].value),t=Math.max(t,r.stops[r.stops.length-1].value),r.stops.forEach(((e,t)=>{e.size=this.currentSizeStopSizes[t]}))),this.handleMinMaxChange(e,t,i)}handleMinMaxChange(e,t,i){const{statistics:s}=this,l=(0,a.b)(),o=(0,a.d)(l,"color"),n=(0,a.d)(l,"size"),d=(0,a.J)(l,"color")||{},c=(0,a.J)(l,"size")||{};"min"===i?(d.minSliderValue=e,c.minSliderValue=e):(d.maxSliderValue=t,c.maxSliderValue=t);const h=(0,a.aJ)(null==o?void 0:o.stops,d.minSliderValue,d.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!h||h.minMaxSame||!(0,a.O)(h.min)&&!(0,a.O)(h.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSizeSlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const u=this.getFieldInfo(),p=n?n.normalizationField:l.normalizationField;this.getHistogram(u,p,s,e,t),(0,r.u)(this.colorSizeSlider,this.colorSliderBars,o,this.histogram),e===d.minSliderValue&&t===d.maxSliderValue&&(this.sliderZoomed=!1),l.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSizeSliderChange.emit()}createColorSizeSliderChangeEvents(){const e=(0,a.b)(),t=(0,a.a)(),i=(0,a.d)(e,"size"),l=["size-age","color-size-age","type-size-age"].indexOf(t)>-1,o=this.getFieldInfo().simpleFieldType===a.w.DATE;this.colorSizeSlider&&(this.colorSizeSlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&((null==t?void 0:t.min)&&!(null==e?void 0:e.min)||(null==t?void 0:t.max)&&!(null==e?void 0:e.max))&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.colorSizeSlider.on("min-change",(e=>{e.value>this.currentColorStopValues[0]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.currentColorStopValues[0],this.colorSizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSizeSlider.slider.max,"min")})),this.colorSizeSlider.on("max-change",(e=>{e.value<this.currentColorStopValues[this.currentColorStopValues.length-1]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.colorSizeSlider.slider.min,this.currentColorStopValues[this.currentColorStopValues.length-1],"max")):this.onMinMaxChange(this.colorSizeSlider.slider.min,e.value,"max")})),this.colorSizeSlider.on("thumb-change",(e=>{if(i){if(o&&!l&&0===e.value)return void(0,s.f)(this.hostElement);this.updateRendererStops(this.colorSizeSlider.stops)}})),this.colorSizeSlider.on("thumb-drag",(()=>{if(i){const e=this.colorSizeSlider.stops;this.updateRendererStops(e)}})),this.colorSizeSlider.on("segment-drag",(()=>{this.updateRendererStops(this.colorSizeSlider.stops)})))}updateRendererStops(e){const t=(0,a.b)(),i=(0,a.d)(t,"color"),s=(0,a.d)(t,"size"),l=(0,a.J)(t,"size"),o="above-and-below"===t.authoringInfo.univariateTheme;s.stops?s.stops.forEach(((t,i)=>{t.value=e[i].value,t.size=e[i].size,t.label=""})):(s.minDataValue=e[0].value,s.maxDataValue=e[e.length-1].value),i&&i.stops.forEach(((t,i)=>{t.value=e[i].value,t.color=e[i].color,t.label=""})),this.currentColorStopValues=e.map((e=>e.value)),this.currentSizeStopSizes=e.map((e=>e.size)),2===t.classBreakInfos.length&&(t.classBreakInfos[0].maxValue=e[2].value,t.classBreakInfos[1].minValue=e[2].value);const n=(0,a.aJ)(o?s.stops:[{value:s.minDataValue},{value:s.maxDataValue}],null==l?void 0:l.minSliderValue,null==l?void 0:l.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!n||n.minMaxSame||!(0,a.O)(n.min)&&!(0,a.O)(n.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,(0,r.u)(this.colorSizeSlider,this.colorSliderBars),(0,a.u)()}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const e=(0,a.b)(),t=(0,a.d)(e,"size"),i=(0,a.t)(t?t.field:e.field);return{field:(null==t?void 0:t.field)||e.field,expression:(null==t?void 0:t.valueExpression)||e.valueExpression,expressionTitle:(null==t?void 0:t.valueExpressionTitle)||e.valueExpressionTitle,simpleFieldType:i?i.simpleFieldType:a.w.NUMBER}}handleZigzagClick(e){var t,i;const{statistics:s}=this,l=(0,a.b)(),o=(0,a.d)(l,"size"),n=(0,a.J)(l,"size"),r=this.getFieldInfo(),d=o?o.normalizationField:l.normalizationField,c=n.minSliderValue===n.maxSliderValue;this.getHistogram(r,d,s,null!==(t=null==e?void 0:e.min)&&void 0!==t?t:c?s.min:n.minSliderValue,null!==(i=null==e?void 0:e.max)&&void 0!==i?i:c?s.max:n.maxSliderValue),e||(this.sliderZoomed=!1)}get hostElement(){return(0,s.d)(this)}};N.style=".slider-box{height:320px}.slider-box .esri-color-size-slider,.slider-box .esri-binary-color-size-slider{min-width:200px}.slider-box .esri-color-size-slider .esri-slider .esri-slider__content,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-color-size-slider__histogram-container,.slider-box .esri-binary-color-size-slider__histogram-container{width:85px}.slider-box .esri-color-size-slider .esri-slider .esri-slider__label,.slider-box .esri-color-size-slider .esri-slider .esri-slider__min,.slider-box .esri-color-size-slider .esri-slider .esri-slider__max,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__label,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__min,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-color-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-color-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-color-size-slider .esri-slider .esri-slider__max:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}.slider-container{overflow:hidden}";const M=class{constructor(e){(0,s.r)(this,e),this.styleSheetStatus="not-loaded"}render(){const{config:e}=a.s;return(0,s.h)(s.H,{key:"40c681153b5c0335d6f7a4a41ef68bdff4e7c5f8"},(0,s.h)("link",{key:"4f7b5e0415e6a4d2c2f1dd812726dd450b05c1bc",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.hostElement)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.hostElement)}}),"loaded"===this.styleSheetStatus?this.renderHeatmapSlider():"not-loaded"===this.styleSheetStatus?this.renderHeatmapSliderLoading():null)}renderHeatmapSlider(){return this.prepareHeatmapSlider()||this.heatmapSlider?(0,s.h)("div",{class:"slider-box"},(0,s.h)("div",{ref:e=>{e&&this.afterHeatmapSliderCreate(e)}})):this.renderHeatmapSliderLoading()}renderHeatmapSliderLoading(){const{strings:e}=a.s;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}prepareHeatmapSlider(){var e;const{modules:t}=a.s,i=(0,a.b)();if(this.heatmapSlider){if("dragging"===(null===(e=this.heatmapSlider.slider)||void 0===e?void 0:e.state))return!0;const s=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.esriColor(e.color.toRgba()),ratio:e.ratio}))),a={stops:s.splice(3,s.length-3)};this.heatmapSlider.set(a)}else{const e=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.esriColor(e.color.toRgba()),ratio:e.ratio}))),s={stops:e.splice(3,e.length-3)};this.heatmapSlider=new t.HeatmapSlider(s),this.createHeatmapSliderChangeEvents()}return(0,a.O)(this.heatmapSlider)}afterHeatmapSliderCreate(e){if(this.heatmapSlider.container)e.append(this.heatmapSlider.container);else{const t=document.createElement("div");e.append(t),this.heatmapSlider.container=t}}createHeatmapSliderChangeEvents(){this.heatmapSlider&&(this.heatmapSlider.on("thumb-change",(()=>{this.handleHeatmapSliderEvent()})),this.heatmapSlider.on("thumb-drag",(()=>{this.handleHeatmapSliderEvent()})))}handleHeatmapSliderEvent(){const{modules:e}=a.s,t=(0,a.b)(),i=this.heatmapSlider.values[0],s=this.heatmapSlider.values[1];i===s&&(i+.001<=1?this.heatmapSlider.viewModel.setValue(1,i+.001):this.heatmapSlider.viewModel.setValue(0,s-.001));const l=t.colorStops.filter(((e,t)=>t<3)).map((t=>new e.HeatmapColorStop({color:new e.esriColor(t.color.toRgba()),ratio:t.ratio}))),o=l[l.length-1].ratio;i<o&&this.heatmapSlider.viewModel.setValue(0,o);const n=l.concat(this.heatmapSlider.stops.slice());t.colorStops=n,(0,a.u)()}get hostElement(){return(0,s.d)(this)}};M.style=".slider-box{height:255px}.slider-box .esri-heatmap-slider__ramp{width:30px}.slider-box .esri-heatmap-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-heatmap-slider{min-width:200px}";const z=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsChartBackClick",7),this.arcgisSmartMappingPanelsChartClose=(0,s.c)(this,"arcgisSmartMappingPanelsChartClose",7),this.arcgisSmartMappingPanelsChartError=(0,s.c)(this,"arcgisSmartMappingPanelsChartError",7),this.inputNodes={},this.labelNodes={},this.popoverSettings={index:null,popoverNode:null},this.valueSymbolNodes={},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentDidLoad(){const{config:e}=a.s;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`),requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}componentWillLoad(){var e,t,i;const{layer:s,modules:l,strings:o}=a.s,n=(0,a.b)();this.originalRendererJSON=n.toJSON(),this.originalFeatureReduction="featureReduction"in s&&s.featureReduction?l.esriLang.clone(s.featureReduction):void 0,n.defaultLabel||(n.defaultLabel=o.panels.chart.noData),a.s.lastDefault={otherColor:null===(e=n.othersCategory)||void 0===e?void 0:e.color,otherLabel:(null===(t=n.othersCategory)||void 0===t?void 0:t.label)||o.panels.chart.other,threshold:null===(i=n.othersCategory)||void 0===i?void 0:i.threshold,defaultColor:n.defaultColor,defaultLabel:n.defaultLabel},this.percentLabelFlip=(0,a.am)(this.hostElement)}disconnectedCallback(){var e,t;null===(e=this.sizeSliderWatchHandle)||void 0===e||e.remove(),a.s.lastDefault=void 0,a.s.selectedAttribute=void 0,a.s.selectedValue=void 0,(0,a.au)(),null===(t=this.scaleHandle)||void 0===t||t.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"ff043539294aa2819121f9c5c37b4ba0a424a0ae",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"d769434f6a9afb887075e2d2caa24ac1a03bf3ee",class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),heading:n.panels.styleOptions,description:r,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsChartBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualization(){const{strings:e}=a.s,t="chart-size"===(0,a.a)();return(0,s.h)("calcite-block",{class:"chart-block",heading:t?e.panels.chart.chartStyleColor:e.panels.chart.chartStyle,open:!0,collapsible:!1},this.renderChartSymbol(),this.renderValues(),this.renderChartSize(),this.renderShape(),this.renderMinSlice(),this.renderBackgroundStyle())}renderChartSymbol(){const{mapView:e,modules:t}=a.s,i=(0,a.b)().attributes,l=t.pieChartSchemes.getSchemes({basemap:e.map.basemap,geometryType:(0,a.E)(),numColors:i.length}),o=(0,a.ad)(l,Math.min(i.length,10))[0].colors;let n=(null==i?void 0:i.length)?i.slice(0,10).map(((e,i)=>e.color?new t.esriColor(e.color):new t.esriColor(o[i%o.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"chart-ramp",colors:n,rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.hostElement)})}renderValues(){const{strings:e}=a.s,t=(0,a.b)();return(0,s.h)("calcite-label",{class:"top-padding"},e.panels.chart.fieldName,(0,s.h)("calcite-list",{class:"top-grey-border"},(0,s.h)("calcite-list",{"drag-enabled":!0,onCalciteListOrderChange:e=>{let t=Array.from(e.target.children);this.handleSortLegend(t)}},t.attributes.map(((e,t)=>this.renderValue(e,t)))),this.renderOtherValue(),this.renderNullValue()))}renderValue(e,t){return(0,s.h)("calcite-list-item",{key:e.field,value:e.field},this.renderSymbolNode(e,t),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{modules:i,selectedAttribute:l,strings:o}=a.s,n=(0,a.q)();n.color=new i.esriColor(e.color),n.outline=void 0;const r={"value-symbol":!0,"symbol-is-white":(0,a.ai)(n)},d={"symbol-icon":!0,selected:l===t};return(0,s.h)("div",{class:r,slot:"content-start",role:"button","aria-label":o.panels.chart.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":l===t,onClick:()=>this.handleValueSymbolClick(t),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(t)}},(0,s.h)("div",{class:d,tabIndex:0,"aria-hidden":"true",ref:e=>{var i,s,l,o;e&&(this.valueSymbolNodes[t]=e,(0,a.aK)(n)?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(s=null===(i=n.color)||void 0===i?void 0:i.toHex())&&void 0!==s?s:"#ffffff",e.style.opacity=null!==(o=null===(l=n.color)||void 0===l?void 0:l.a)&&void 0!==o?o:0))}}))}renderOtherValue(){var e,t;const{lastDefault:i,modules:l,selectedAttribute:o,strings:n}=a.s,r=(0,a.b)(),d=(null===(e=r.othersCategory)||void 0===e?void 0:e.color)||i.otherColor,c=(0,a.q)();c.color=new l.esriColor(d),c.outline=void 0;const h=(null===(t=r.othersCategory)||void 0===t?void 0:t.label)||i.otherLabel,u={"other-symbol":!0,"symbol-is-white":(0,a.ai)(c)},p={"symbol-icon":!0,selected:-1===o};return(0,s.h)("calcite-list-item",{class:"top-grey-border other-null-list-item"},(0,s.h)("div",{class:u,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-1===o,"aria-label":n.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",h),onClick:()=>this.handleValueSymbolClick(-1),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-1)}},(0,s.h)("div",{class:p,tabIndex:0,"aria-hidden":"true",ref:e=>{var t,i,s,l;e&&(this.valueSymbolNodes[-1]=e,(0,a.aK)(c)?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(i=null===(t=c.color)||void 0===t?void 0:t.toHex())&&void 0!==i?i:"#ffffff",e.style.opacity=null!==(l=null===(s=c.color)||void 0===s?void 0:s.a)&&void 0!==l?l:0))}})),this.renderTextNode({symbol:c,label:h},-1))}renderTextNode(e,t){const{strings:i}=a.s;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.chart.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{(0,a.m)(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),a.s.selectedValue=t},onKeyDown:e=>{(0,a.m)()," "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),a.s.selectedValue=t)},ref:e=>this.labelNodes[t]=e},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",tabIndex:0,value:e.label,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderNullValue(){const{lastDefault:e,modules:t,selectedAttribute:i,strings:l}=a.s,o=(0,a.b)(),n=o.defaultColor||e.defaultColor,r=(0,a.q)();r.color=new t.esriColor(n),r.outline=void 0;const d=o.defaultLabel||e.defaultLabel,c=(0,a.aK)(r),h={symbol:!0,"symbol-is-white":(0,a.ai)(r)},u={"symbol-icon":!0,selected:-2===i};return(0,s.h)("calcite-list-item",{class:"other-null-list-item"},(0,s.h)("calcite-checkbox",{disabled:c,slot:"actions-start",class:"checkbox",tabIndex:c?-1:void 0,checked:!!o.defaultColor&&!c,onClick:()=>this.handleNullValueCheckChange()}),(0,s.h)("div",{class:h,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-2===i,"aria-label":l.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",d),onClick:()=>this.handleValueSymbolClick(-2),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-2)}},(0,s.h)("div",{class:u,tabIndex:0,"aria-hidden":"true",ref:e=>{var t,i,s,a;e&&(this.valueSymbolNodes[-2]=e,c?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(i=null===(t=r.color)||void 0===t?void 0:t.toHex())&&void 0!==i?i:"#ffffff",e.style.opacity=null!==(a=null===(s=r.color)||void 0===s?void 0:s.a)&&void 0!==a?a:0))}})),this.renderTextNode({symbol:r,label:d},-2))}renderChartSize(){const{mapView:e,strings:t}=a.s,i=(0,a.b)();if((0,a.d)(i,"size"))return null;const l=(0,a.d)(i,"size","auto"),o=this.getSizeValue(),n=Math.round(o/.75);return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,t.panels.chart.chartSize),(0,s.h)("arcgis-smart-mapping-slider-input",{min:10,max:120,values:[n],precision:0,suffixText:t.panels.chart.px,onArcgisSmartMappingSliderInputChange:e=>this.handleChartSizeChange(.75*e.detail)}),(0,s.h)("calcite-label",{scale:"s",layout:"inline"},(0,s.h)("calcite-checkbox",{scale:"s",checked:!!l,onCalciteCheckboxChange:e=>{this.handleAutoSizeChange(e.target.checked?"automatic":"fixed")},ref:t=>{this.adjustSizeNode=t,this.sizeSliderWatchHandle=e.watch("scale",(0,u.d)((()=>(0,s.f)(this.hostElement)),100))}}),t.panels.chart.adjustChartSizeAutomatically))}renderShape(){var e,t;const{modules:i,strings:l}=a.s,o=(0,a.b)();if(this.shapeSlider){let e={values:[null!==(t=o.holePercentage)&&void 0!==t?t:.5]};this.shapeSlider.set(e)}else{const t={min:0,max:Math.max(.9,o.holePercentage),values:[null!==(e=o.holePercentage)&&void 0!==e?e:.5],precision:1};this.shapeSlider=new i.Slider(t),this.shapeSlider.on("thumb-drag",(e=>{(0,a.b)().holePercentage=e.value,(0,a.u)()})),this.shapeSlider.on("thumb-change",(e=>{(0,a.b)().holePercentage=e.value,(0,a.u)()}))}return(0,s.h)("div",{class:"top-padding"},(0,s.h)("calcite-label",null,l.panels.chart.shape),(0,s.h)("div",{class:"shape-slider slider-bottom-label",ref:e=>{e.style.width="100%",this.shapeSlider&&(this.shapeSlider.container=e)}}),(0,s.h)("div",{class:"slider-labels space-between","aria-hidden":"true"},(0,s.h)("calcite-label",null,l.panels.chart.pie),(0,s.h)("calcite-label",null,l.panels.chart.donut)))}renderMinSlice(){const{strings:e}=a.s,t=(0,a.b)(),{threshold:i=.04}=t.othersCategory;return(0,s.h)("div",{class:"top-padding"},(0,s.h)("div",{class:"space-between"},(0,s.h)("calcite-label",{layout:"inline"},e.panels.chart.grouping),(0,s.h)("calcite-icon",{scale:"s",icon:"information",role:"button",ref:i=>{var s;(0,a.aw)(i,`<div>${e.panels.chart.groupingInfo.replace("${other}",(null===(s=t.othersCategory)||void 0===s?void 0:s.label)||e.panels.chart.other)}</div>`,!1)}})),(0,s.h)("arcgis-smart-mapping-slider-input",{disabled:!t.othersCategory,min:0,max:50,values:[Math.round(100*i)],precision:0,prefixText:this.percentLabelFlip?"%":void 0,suffixText:this.percentLabelFlip?void 0:"%",onArcgisSmartMappingSliderInputChange:e=>{(0,a.b)().othersCategory.threshold=e.detail/100,(0,a.u)()}}))}renderBackgroundStyle(){return(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.m)(),(0,a.l)(e,t),this.arcgisSmartMappingPanelsChartClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}getSizeByScale(e,t){const i=e.stops,s=i.length-1,a=i[0].value,l=i[s].value;if(t<=a)return i[0].size;if(t>=l)return i[s].size;for(let e=0;e<=s;e++){const s=i[e],a=i[e+1];if(t>=s.value&&t<a.value){const e=a.value-s.value,i=s.size-a.size,l=(t-s.value)/e,o=s.size-i*l;return Math.round(100*o)/100}}return 1}getSizeValue(){const{mapView:e}=a.s,t=(0,a.b)(),i=(0,a.d)(t,"size","auto");if(i){const t=e.scale,s=i.stops;let a=0,l=!1;for(let e=0;e<s.length;e++){const i=s[e];if(t<=i.value){if(l=!0,e>0){let l=s[e-1];const o=(t-l.value)/(i.value-l.value);a=l.size+(i.size-l.size)*o}else a=s[0].size;break}}return l||(a=s[s.length-1].size),a}return t.size}handleAutoSizeChange(e){const t=(0,a.b)();if("fixed"===e){const e=(0,a.T)(t,"size","auto");(null==e?void 0:e.length)?t.visualVariables=e:t.visualVariables=void 0,(0,a.u)(),(0,s.f)(this.hostElement)}else(0,o.r)((0,d.d)({sizeOptimizationEnabled:!0}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement)}),(e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingPanelsChartError.emit(e)}))}handleChartSizeChange(e){const{mapView:t}=a.s,i=(0,a.b)();let s=Math.max(e,.1);const l=(0,a.d)(i,"size","auto");if(l){const e=s/this.getSizeByScale(l,t.scale);this.updateAutoSizeStops(l,e)}else i.size=s;(0,a.u)()}handleNullValueCheckChange(){const{lastDefault:e}=a.s,t=(0,a.b)();t.defaultColor?(e.defaultColor=t.defaultColor,t.defaultColor=void 0):t.defaultColor=e.defaultColor,(0,a.u)(),(0,s.f)(this.hostElement)}handleSortLegend(e){const t=(0,a.b)(),i=t.attributes.map((e=>e.clone())),l=e.map((e=>e.value));i.sort(((e,t)=>l.indexOf(e.field)-l.indexOf(t.field))),t.attributes=i,(0,a.u)(),(0,s.f)(this.hostElement)}handleValueSymbolClick(e){var t;(null===(t=this.popoverSettings)||void 0===t?void 0:t.popoverNode)?(this.valueSymbolNodes[e].classList.remove("selected"),this.popoverSettings.index===e?((0,a.m)(),this.popoverSettings.popoverNode=null,this.popoverSettings.index=null,this.valueSymbolNodes[e].focus()):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,t){var i,l;const{lastDefault:o,modules:n,strings:r}=a.s,d=(0,a.b)(),c=n.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(this.inputNodes[e].classList.add("hidden"),!t.length)if(-1===e)t=(null===(i=c.othersCategory)||void 0===i?void 0:i.label)||r.panels.chart.other;else if(-2===e)t=r.panels.chart.noData;else{let i=c.attributes.find((t=>t.field===d.attributes[e].field));t=i.label}-1===e?(d.othersCategory=d.othersCategory||{color:null==o?void 0:o.otherColor,threshold:null!==(l=null==o?void 0:o.threshold)&&void 0!==l?l:0},d.othersCategory.label=t,o.otherLabel=t):-2===e?(d.defaultLabel=t,o.defaultLabel=t):d.attributes=d.attributes.map(((i,s)=>(s===e&&(i.label=t),i))),(0,a.u)(),(0,s.f)(this.hostElement),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,this.inputNodes[e].value=t,setTimeout((()=>{a.s.selectedValue===e&&(this.labelNodes[e].focus(),a.s.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){(0,a.m)(),this.popoverSettings.popoverNode=(0,h.c)({referenceElement:this.flowItemNode,heading:a.s.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,this.valueSymbolNodes[e].classList.remove("selected"),setTimeout((()=>{this.valueSymbolNodes[e].focus()}),100)})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,this.valueSymbolNodes[e].classList.remove("selected")})),a.s.selectedAttribute=e,(0,h.b)({popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.u)(),(0,s.f)(this.hostElement)}}),this.valueSymbolNodes[e].classList.add("selected")}updateAutoSizeStops(e,t){e.stops.forEach((e=>{e.size*=t}))}get hostElement(){return(0,s.d)(this)}};z.style=":host{width:100%}.flow-item{height:100%}.chart-block{overflow-x:hidden}.checkbox{margin:6px}.hidden{display:none}.top-grey-border{border-top:1.5px solid #e0e0e0}.top-padding{margin-top:12px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol-icon:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.other-null-list-item{min-height:45px}.other-symbol{margin-left:27px}.null-value-actions{display:contents}.shape-slider{background-color:transparent;position:relative;width:100%;padding:0 4px}.slider-labels{margin-top:10px}.space-between{display:flex;justify-content:space-between}.symbol-icon{width:19px;height:19px;margin:2px}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}";const E=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeBackClick",7),this.arcgisSmartMappingPanelsChartSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeClose",7),this.arcgisSmartMappingPanelsChartSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeError",7),this.tileNodes=[],this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e);break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e);break}}},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,mapImageSublayer:l,layer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==l?void 0:l.title)&&void 0!==e?e:o.title;return(0,s.h)(s.H,{key:"1c389e926474918f8b0c610b1e9a5b2d0bdf1ce4",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"8c74dacfe163c85687385680a55c486860528c89",class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),heading:n.panels.styleOptions,description:r,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsChartSizeBackClick.emit(),onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit()},this.renderChartTile(),this.renderSizeTile(),this.renderDoneButton(),this.renderCancelButton()))}renderChartTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"chart",selected:"chart"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="chart",this.handleOptionsClick("chart")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("chart"),ref:e=>{e&&(this.tileNodes.chart=e)}})}renderSizeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{(0,a.l)(this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsChartSizeClose.emit()},appearance:"outline-fill",width:"half"},e.cancel)}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick].setFocus()))),300)}get hostElement(){return(0,s.d)(this)}};E.style=":host{width:100%}.flow-item{height:100%}";const B=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorClose",7),this.arcgisSmartMappingPanelsColorBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorBackClick",7),this.arcgisSmartMappingPanelsColorError=(0,s.c)(this,"arcgisSmartMappingPanelsColorError",7),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsColorClose.emit("cancel")},this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{layer:e,hideLayerTitle:t,isRTL:i,strings:l}=a.s;return(0,s.h)(s.H,{key:"2e8335e627b501c83dca56df878cbe654a25c9e3",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"70e6b58557f759140c1c8c3d2b33e4fe4d4db248",heading:l.panels.styleOptions,description:t?void 0:e.title,class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsColorBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderVisualization(){var e,t;const{visualizationOpen:i,hideTransparency:l,hideRotation:o}=this,{strings:n}=a.s,r=(0,a.a)(),d=["color-age","color-age-size"].indexOf(r)>-1,c=(0,a.b)(),h=(0,a.d)(c,"color"),u=h?h.field?null===(e=(0,a.t)(h.field))||void 0===e?void 0:e.label:h.valueExpressionTitle||n.expression:c.field?null===(t=(0,a.t)(c.field))||void 0===t?void 0:t.label:c.valueExpressionTitle||n.expression,p=(0,a.k)()[0].simpleFieldType===a.w.DATE;return(0,s.h)("calcite-block",{class:"color-block",heading:d?n.panels.color.colorAgeStyle:p?n.panels.color.colorStyleDate:n.panels.color.colorStyle,collapsible:!l||!o,open:i,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},d?null:(0,s.h)("calcite-label",{class:"attribute-name"},u),this.renderAge(),this.renderTheme(),this.renderDividedBy(),this.renderSymbol(),this.renderColorSlider(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend(),this.renderClassify())}renderAge(){const e=(0,a.a)();return["color-age","color-age-size"].indexOf(e)>-1?(0,s.h)("arcgis-smart-mapping-age",{rendererSubtype:"color",onArcgisSmartMappingAgeChange:()=>this.sliderNode.updateStatistics(),onArcgisSmartMappingAgeError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)}):null}renderTheme(){const e=(0,a.b)();if(!(0,a.d)(e,"color"))return null;const t=(0,a.a)();return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"color",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingThemeButtonChange:e=>{let i=m.b;["color-age","color-age-size"].indexOf(t)>-1&&(i=m.d),(0,o.r)(i({theme:e.detail,discardMinMax:!0}),this.flowItemNode).then((e=>{const t=(0,a.b)();t.visualVariables=(0,a.T)(t,"color")||[],t.visualVariables.push((0,a.d)(e.renderer,"color")),t.authoringInfo.visualVariables=(0,a.U)(t,"color")||[],t.authoringInfo.visualVariables.push((0,a.J)(e.renderer,"color")),(0,a.u)(),(0,s.f)(this.hostElement),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorError.emit(e)}))}})}renderDividedBy(){const{fields:e}=a.s,t=(0,a.b)(),i=(0,a.a)();if(["color-age","color-age-size"].indexOf(i)>-1)return null;if((0,a.I)(e).number<2)return null;const l=(0,a.d)(t,"color");if(l){const e=(0,a.t)(l.field),t={field:l.field,expression:l.valueExpression,expressionTitle:l.valueExpressionTitle,simpleFieldType:e?e.simpleFieldType:a.w.NUMBER};if(t.expression||t.simpleFieldType!==a.w.NUMBER)return null}return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:l?l.normalizationField:t.normalizationField,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.hostElement),this.sliderNode.updateStatistics(),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderSymbol(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=e.classBreakInfos,l=i[0].symbol;let o;return t?o=t.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):(null==i?void 0:i.length)&&(o=i.map((e=>(0,a.Q)(e.symbol)))),(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:l,colors:o,type:"color-ramp",rampType:t?"continuous":"discrete",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSlider(){return(0,s.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderBackgroundStyle(){const e=(0,a.a)();return(0,a.D)()&&-1!==["color-size"].indexOf(e)?(0,s.h)("arcgis-smart-mapping-background-symbol",null):null}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.m)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{strings:e}=a.s,t=(0,a.b)(),i=(0,a.d)(t,"color");if(!i)return null;const l=i.legendOptions,o=!l||!1!==l.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},e.panels.color.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:o,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderClassify(){const e=(0,a.b)(),t=(0,a.a)(),i=(0,a.k)()[0].simpleFieldType===a.w.DATE,l=["color-age","color-age-size"].indexOf(t)>-1;if("color"!==t||i||l)return null;const o=e.classBreakInfos;return(0,s.h)("arcgis-smart-mapping-classify",{ref:e=>this.classifyNode=e,onArcgisSmartMappingClassifyChange:e=>{const t=e.detail;((null==t?void 0:t.closePopovers)||(null==t?void 0:t.classesChange))&&(0,a.m)(),((null==t?void 0:t.classesChange)||(null==t?void 0:t.symbolChange))&&(this.symbolButtonNode.colors=o.map((e=>(0,a.Q)(e.symbol)))),(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),((null==t?void 0:t.toggle)||!(null==t?void 0:t.symbolChange)&&!(null==t?void 0:t.closePopovers))&&this.sliderNode.updateStatistics(),this.classifyNode&&(0,s.f)(this.classifyNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.defaultSymbolNode&&(0,s.f)(this.defaultSymbolNode)},onArcgisSmartMappingClassifyError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderTransparency(){const{hideTransparency:e}=this;if(e)return;const t=(0,a.b)(),i=(0,a.d)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}renderRotation(){const{hideRotation:e}=this;if(e)return;const t=(0,a.b)(),i=(0,a.d)(t,"opacity"),l=(0,a.d)(t,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!l,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}handleIncludeInLegendToggle(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=t.legendOptions;i&&!1===i.showLegend?i.title?i.showLegend=!0:t.legendOptions=void 0:(t.legendOptions=i||{},t.legendOptions.showLegend=!1),(0,a.u)()}get hostElement(){return(0,s.d)(this)}};B.style=":host{width:100%}.flow-item{height:100%}.color-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const V=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeClose",7),this.arcgisSmartMappingPanelsColorSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeBackClick",7),this.arcgisSmartMappingPanelsColorSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeError",7),this.tileNodes=[],this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e);break}case"color":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e);break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsColorSizeClose.emit("cancel")},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{layer:e,hideLayerTitle:t,isRTL:i,strings:l}=a.s;return(0,s.h)(s.H,{key:"417be603a226f81302b7f4c6dc698d08969914c7",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"3ee5ecdbec1c9389f6439d6d7f5357d7441996d0",heading:l.panels.styleOptions,description:t?void 0:e.title,class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsColorSizeBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderColorTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderColorTile(){const{lastClick:e}=this,t="color-age-size"===(0,a.a)()?"color-age":"color",i=(0,a.K)("color");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${t}-${i}`,type:t,selected:"color"===e,onArcgisSmartMappingTileSelect:()=>{this.lastClick=t,this.handleOptionsClick("color")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("color"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[t]=e)}})}renderSizeTile(){const{lastClick:e}=this,t="color-size-age"===(0,a.a)()?"size-age":"size",i=(0,a.K)("size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${t}-${i}`,type:t,selected:"size"===e,onArcgisSmartMappingTileSelect:()=>{this.lastClick=t,this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[t]=e)}})}renderTransparency(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}renderRotation(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick].setFocus()))),300)}get hostElement(){return(0,s.d)(this)}};V.style=":host{width:100%}.flow-item{height:100%}";const T=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateBackClick",7),this.arcgisSmartMappingPanelsColorSizeUnivariateError=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateError",7),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("cancel")},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{layer:e,hideLayerTitle:t,isRTL:i,strings:l}=a.s;return(0,s.h)(s.H,{key:"a09a770550af5cc31d57fb388017ccfc6c9779a3",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"e7c7b3a53ccb0d460db63640805dc30ac5ac1dea",heading:l.panels.styleOptions,description:t?void 0:e.title,class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderVisualization(){var e,t;const{visualizationOpen:i}=this,{strings:l}=a.s,o=(0,a.b)(),n=(0,a.d)(o,"color"),r=n?n.field?null===(e=(0,a.t)(n.field))||void 0===e?void 0:e.label:n.valueExpressionTitle||l.expression:o.field?null===(t=(0,a.t)(o.field))||void 0===t?void 0:t.label:o.valueExpressionTitle||l.expression;return(0,s.h)("calcite-block",{class:"color-size-univariate-block",heading:l.panels.colorSizeUnivariate.colorSizeStyle,collapsible:!0,open:i,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("calcite-label",{class:"attribute-name"},r),this.renderTheme(),this.renderDividedBy(),this.renderSymbolPairButton(),this.renderAboveAndBelowSymbols(),this.renderColorScheme(),this.renderSymbol(),this.renderColorSizeSlider(),this.renderSizeRange(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderTheme(){return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"colorSize",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingThemeButtonChange:e=>{const t="above-and-below"===(0,a.b)().authoringInfo.univariateTheme,i="above-and-below"===e.detail;let l=d.b;!t&&i&&(l=d.a),(0,o.r)(l({theme:e.detail,fieldInfos:(0,a.k)(),discardMinMax:!0}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.rotationNode&&(0,s.f)(this.rotationNode),(0,s.f)(this.sizeRangeSliderNode),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}})}renderDividedBy(){const{fields:e}=a.s,t=(0,a.b)(),i=(0,a.a)();if(["color-age","color-age-size"].indexOf(i)>-1)return null;const l=(0,a.k)()[0];if(l.expression||l.simpleFieldType!==a.w.NUMBER)return null;if((0,a.I)(e).number<2)return null;const o=(0,a.d)(t,"color");return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:(null==o?void 0:o.normalizationField)||t.normalizationField,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.hostElement),this.sliderNode.updateStatistics()},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderSymbolPairButton(){if((0,a.B)())return null;return"above-and-below"===(0,a.b)().authoringInfo.univariateTheme?(0,s.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"above-and-below",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>{e&&(this.symbolPairButtonNode=e)}}):null}renderAboveAndBelowSymbols(){var e;const{strings:t}=a.s,i=(0,a.b)(),l=i.authoringInfo;if(!("above-and-below"===l.univariateTheme))return null;if(!l.univariateSymbolStyle||2!==(null===(e=i.classBreakInfos)||void 0===e?void 0:e.length))return null;const o=(0,a.d)(i,"color"),n=(0,a.t)((null==o?void 0:o.field)||i.field),r=(null==n?void 0:n.simpleFieldType)===a.w.DATE,d=i.classBreakInfos[1].symbol,c=i.classBreakInfos[0].symbol;return(0,s.h)("div",{class:"symbol-above-and-below"},(0,s.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:c,type:"below",label:r?t.panels.colorSizeUnivariate.before:t.panels.colorSizeUnivariate.below,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}}),(0,s.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:d,type:"above",label:r?t.panels.colorSizeUnivariate.after:t.panels.colorSizeUnivariate.above,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}}))}renderColorScheme(){const{strings:e}=a.s,t=(0,a.b)();if(!("above-and-below"===t.authoringInfo.univariateTheme))return null;const i=(0,a.d)(t,"color");return(0,s.h)("calcite-label",null,e.panels.colorSizeUnivariate.colorScheme,(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleColorSchemeChange(e.target.selectedItem.value)}},(0,s.h)("calcite-segmented-control-item",{checked:!!i,value:"continuous",ref:e=>this.continuousNode=e},e.panels.colorSizeUnivariate.continuous),(0,s.h)("calcite-segmented-control-item",{checked:!i,value:"binary",ref:e=>this.binaryNode=e},e.panels.colorSizeUnivariate.binary)))}renderSymbol(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=e.classBreakInfos;let l;return t?l=t.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):(null==i?void 0:i.length)&&(l=i.map((e=>(0,a.Q)(e.symbol)))),(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:l,type:"color-ramp",rampType:t?"continuous":"discrete",ref:e=>this.symbolButtonNode=e,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSizeSlider(){return(0,s.h)("arcgis-smart-mapping-color-size-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSizeSliderChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode)},onArcgisSmartMappingColorSizeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderSizeRange(){return(0,s.h)("arcgis-smart-mapping-size-range-slider",{onArcgisSmartMappingSizeRangeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>this.sizeRangeSliderNode=e})}renderBackgroundStyle(){const e=(0,a.a)();return(0,a.D)()&&-1!==["color-size"].indexOf(e)?(0,s.h)("arcgis-smart-mapping-background-symbol",null):null}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.m)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{strings:e}=a.s,t=(0,a.b)(),i=(0,a.d)(t,"color"),l=null==i?void 0:i.legendOptions,o=!l||!1!==l.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},e.panels.colorSizeUnivariate.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:o,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderTransparency(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}renderRotation(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}handleColorSchemeChange(e){(0,o.r)((0,d.b)({isContinuous:"continuous"===e}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),(0,a.m)()}),(e=>{this.continuousNode.checked?(this.continuousNode.checked=!1,this.binaryNode.checked=!0):(this.binaryNode.checked=!1,this.continuousNode.checked=!0),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}handleIncludeInLegendToggle(){var e;const t=(0,a.b)(),i=(0,a.d)(t,"color"),s=(0,a.d)(t,"size"),l=s.legendOptions;l&&!1===l.showLegend?(l.title?l.showLegend=!0:s.legendOptions=void 0,(null===(e=null==i?void 0:i.legendOptions)||void 0===e?void 0:e.title)?i.legendOptions.showLegend=!0:i&&(i.legendOptions=void 0)):(s.legendOptions=l||{},s.legendOptions.showLegend=!1,i&&(i.legendOptions=l||{},i.legendOptions.showLegend=!1)),(0,a.u)()}get hostElement(){return(0,s.d)(this)}};T.style=":host{width:100%}.flow-item{height:100%}.color-size-univariate-block{overflow-x:hidden}.attribute-name{word-break:break-all}.symbol-above-and-below{display:flex;justify-content:space-between}.above-below-symbol-button{width:49%}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const O=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsCompareClose=(0,s.c)(this,"arcgisSmartMappingPanelsCompareClose",7),this.arcgisSmartMappingPanelsCompareBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsCompareBackClick",7),this.arcgisSmartMappingPanelsCompareError=(0,s.c)(this,"arcgisSmartMappingPanelsCompareError",7),this.handleDone=()=>{this.arcgisSmartMappingPanelsCompareClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsCompareClose.emit("cancel")},this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1,this.statisticsStatus=a.h.MISSING}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.getStatistics()}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{layer:e,hideLayerTitle:t,isRTL:i,strings:l}=a.s;return(0,s.h)(s.H,{key:"6fe5b0fbcfcc416da61b88e531383b4b4a15f4fa",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"1bc6fe4dd5be12a3dec0b890bdedc357840a6d40",heading:l.panels.styleOptions,description:t?void 0:e.title,class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsCompareBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderVisualization(){const{strings:e}=a.s,{visualizationOpen:t,hideRotation:i}=this,l=(0,a.A)()&&!i,o=(0,a.b)(),n=(0,a.d)(o,"color"),r=(0,a.J)(o,"color"),d=(0,a.t)(n.field),c=(0,a.t)(n.normalizationField),h=("ratio"===r.style?e.panels.compare.ratioTitle:"percent"===r.style?e.panels.compare.percentTitle:e.panels.compare.percentTotalTitle).replace(/\$\{field1\}/g,d.label).replace("${field2}",c.label);return(0,s.h)("calcite-block",{class:"compare-block",heading:e.panels.compare.compareStyle,collapsible:l,open:t,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("calcite-label",null,h),this.renderSymbol(),this.renderColorSlider(),this.renderLabels(),this.renderCenterAt(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderSymbol(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=e.classBreakInfos[0].symbol,l=t.stops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:i,colors:l,type:"color-ramp",rampType:"continuous",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSlider(){return(0,s.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=(0,a.J)(e,"color"),l=!!i&&"percent"===i.style,o=!!i&&"percent-of-total"===i.style;t.stops[0].label=`< ${(0,g.g)(t.stops[0].value,l,o)}`,t.stops[2].label=`${(0,g.g)(t.stops[2].value,l,o)}`,t.stops[4].label=`> ${(0,g.g)(t.stops[4].value,l,o)}`,this.segmentedControlNode&&(1===t.stops[2].value?(this.equalNode.checked=!0,this.averageNode.checked=!1):(this.equalNode.checked=!1,this.averageNode.checked=!0)),(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsCompareError.emit(e.detail)})}renderLabels(){const{strings:e}=a.s,t=(0,a.b)(),i=(0,a.J)(t,"color"),l=i?i.style:void 0;return(0,s.h)("calcite-label",null,e.panels.compare.labels,(0,s.h)("calcite-select",{width:"full",role:"button",label:e.panels.compare.labels,onCalciteSelectChange:e=>this.handleLabelChange(e)},(0,s.h)("calcite-option",{value:e.panels.compare.ratioLabel,label:e.panels.compare.ratioLabel,selected:"ratio"===l}),(0,s.h)("calcite-option",{value:e.panels.compare.percentTotalLabel,label:e.panels.compare.percentTotalLabel,selected:"percent-of-total"===l}),(0,s.h)("calcite-option",{value:e.panels.compare.percentLabel,label:e.panels.compare.percentLabel,selected:"percent"===l})))}renderCenterAt(){const{statistics:e,statisticsStatus:t}=this,{strings:i}=a.s;if(t!==a.h.SUCCESS)return null;const l=(0,a.b)(),o=(0,a.d)(l,"color");if(!(0,a.O)(e.min)||!(0,a.O)(e.max)||e.min>=1||e.max<=1)return null;const n=1===o.stops[2].value?"equal":"average";return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,i.panels.compare.centerAt),(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleCenterAtChange(e.target.selectedItem.value)},ref:e=>{e&&(this.segmentedControlNode=e)}},(0,s.h)("calcite-segmented-control-item",{checked:"equal"===n,value:"equal",ref:e=>{e&&(this.equalNode=e)}},i.panels.compare.centerEqualValues),(0,s.h)("calcite-segmented-control-item",{checked:"average"===n,value:"average",ref:e=>{e&&(this.averageNode=e)}},i.panels.compare.centerAverageValue)))}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.m)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{strings:e}=a.s,t=(0,a.b)(),i=(0,a.d)(t,"color").legendOptions,l=!i||!1!==i.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},e.panels.compare.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:l,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderRotation(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsCompareError.emit(e)})}handleLabelChange(e){const t=e.currentTarget.value,{strings:i}=a.s,l=t===i.panels.compare.ratioLabel?"ratio":t===i.panels.compare.percentTotalLabel?"percent-of-total":"percent",o=(0,a.b)(),n=(0,a.d)(o,"color");(0,a.J)(o,"color").style=l,"percent"===l?(n.stops[0].label=`< ${(0,g.g)(n.stops[0].value,!0,!1)}`,n.stops[2].label=(0,g.g)(n.stops[2].value,!0,!1),n.stops[4].label=`> ${(0,g.g)(n.stops[4].value,!0,!1)}`):"percent-of-total"===l?(n.stops[0].label=`< ${(0,g.g)(n.stops[0].value,!1,!0)}`,n.stops[2].label=(0,g.g)(n.stops[2].value,!1,!0),n.stops[4].label=`> ${(0,g.g)(n.stops[4].value,!1,!0)}`):(n.stops[0].label=`< ${(0,g.g)(n.stops[0].value,!1,!1)}`,n.stops[2].label=(0,g.g)(n.stops[2].value,!1,!1),n.stops[4].label=`> ${(0,g.g)(n.stops[4].value,!1,!1)}`),(0,a.u)(),(0,s.f)(this.hostElement)}getStatistics(){var e;const{layer:t,useFeatureReduction:i,mapView:s,modules:l}=a.s,o=t,n=(0,a.b)(),r=this.getFieldInfo(),d=(0,a.d)(n,"color"),c=d?d.normalizationField:n.normalizationField,h=(0,a.J)(n,"color")||{};this.statisticsStatus=a.h.IN_PROGRESS,this.statistics||l.summaryStatistics({layer:o,view:s,field:r.field,valueExpression:r.expression,normalizationField:c,forBinning:"featureReduction"in o&&"binning"===(null===(e=o.featureReduction)||void 0===e?void 0:e.type)&&i}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(r),s=h.minSliderValue||t,l=h.maxSliderValue||i;e.min=s,e.max=l,e.avg=(l+s)/2,(0,a.O)(h.minSliderValue)||(h.minSliderValue=s,h.maxSliderValue=l)}else if(!(0,a.O)(e.avg)||!(0,a.O)(e.min)||!(0,a.O)(e.max))return void(this.statisticsStatus=a.h.FAILED);e=(0,a.aG)(e),this.statistics=e,this.statisticsStatus=a.h.SUCCESS}),(e=>{console.log(e),this.statisticsStatus=a.h.FAILED}))}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=(0,a.t)(t?t.field:e.field);return{field:(null==t?void 0:t.field)||e.field,expression:(null==t?void 0:t.valueExpression)||e.valueExpression,expressionTitle:(null==t?void 0:t.valueExpressionTitle)||e.valueExpressionTitle,simpleFieldType:i?i.simpleFieldType:a.w.NUMBER}}handleCenterAtChange(e){const{statistics:t,statisticsStatus:i}=this;if(i!==a.h.SUCCESS)return;const l=(0,a.b)(),o=(0,a.d)(l,"color"),n=(0,a.J)(l,"color"),r=!!n&&"percent"===n.style,d=!!n&&"percent-of-total"===n.style;let c;if("average"===e){const e=t.avg;let i=Math.max(e-t.stddev,t.min),s=Math.min(e+t.stddev,t.max);0===t.count&&(i=t.min,s=t.max),c=C([i,s]),i=c[0],s=c[1],c=[Math.max(i,t.min),Math.max(i+(e-i)/2,t.min),e,Math.min(e+(s-e)/2,t.max),Math.min(s,t.max)],c=C(c)}else{let e=Math.max(1-t.stddev,t.min),i=Math.min(1+t.stddev,t.max);c=C([e,i]),e=c[0],i=c[1],c=[Math.max(e,t.min),Math.max(e+(1-e)/2,t.min),1,Math.min(1+(i-1)/2,t.max),Math.min(i,t.max)],c=C(c)}o.stops[0].value=c[0],o.stops[0].label=`< ${(0,g.g)(c[0],r,d)}`,o.stops[1].value=c[1],o.stops[1].label=null,o.stops[2].value=c[2],o.stops[2].label=(0,g.g)(c[2],r,d),o.stops[3].value=c[3],o.stops[3].label=null,o.stops[4].value=c[4],o.stops[4].label=`> ${(0,g.g)(c[4],r,d)}`,(0,a.u)(),(0,s.f)(this.symbolButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode)}handleIncludeInLegendToggle(){const e=(0,a.b)(),t=(0,a.d)(e,"color"),i=t.legendOptions;i&&!1===i.showLegend?i.title?i.showLegend=!0:t.legendOptions=void 0:(t.legendOptions=i||{},t.legendOptions.showLegend=!1),(0,a.u)()}get hostElement(){return(0,s.d)(this)}};O.style=":host{width:100%}.flow-item{height:100%}.compare-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const P=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsDotDensityBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsDotDensityBackClick",7),this.arcgisSmartMappingPanelsDotDensityClose=(0,s.c)(this,"arcgisSmartMappingPanelsDotDensityClose",7),this.labelNodes=[],this.inputNodes=[],this.legendSwatchNodes=[],this.popoverSettings={index:null,popoverNode:null},this.labelChanged=!1,this.handleDone=()=>{this.arcgisSmartMappingPanelsDotDensityClose.emit("save")},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{layer:e,mapView:t,modules:i}=a.s,s=(0,a.b)();this.dotValue=s.dotValue,(0,a.O)(s.referenceScale)&&(this.dotValue=Math.round(s.calculateDotValue(t.scale)),this.tickDotValue=this.dotValue),this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}));const{config:e,mapView:t,modules:i}=a.s;this.mapViewWatchHandle=i.reactiveUtils.watch((()=>t.scale),(0,u.d)((e=>{const t=(0,a.b)();if((0,a.O)(t.referenceScale)){let i=Math.round(t.calculateDotValue(e));this.handleDotValueChange(i)}}),300)),this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e,t,i;null===(e=this.dotWatchHandle)||void 0===e||e.remove(),null===(t=this.mapViewWatchHandle)||void 0===t||t.remove(),null===(i=this.scaleHandle)||void 0===i||i.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"131a7f89ebf9195e176d6f9e156b1088531a256e",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"edee34bf21e292ea5ea751aabfef6d5257581ba4",class:{"flow-item":!0,[p.C.rtl]:i},heading:n.panels.dotDensity.styleOptions,description:r,closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsDotDensityBackClick.emit()},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization()))}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.m)(),(0,a.l)(e,t),this.arcgisSmartMappingPanelsDotDensityClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{strings:e}=a.s;return(0,s.h)("calcite-block",{class:"dot-density-block",heading:e.panels.dotDensity.dotDensityStyle,open:!0},this.renderDotStyle(),this.renderLegend(),this.renderUnits(),this.renderDotValue(),this.renderDotSize(),this.renderBackgroundStyle(),this.renderOptions())}renderDotStyle(){const e=(0,a.b)().attributes.map((e=>e.color));return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"dot-density-ramp",rampType:"discrete",colors:e,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.hostElement)})}renderLegend(){const{strings:e}=a.s,t=(0,a.b)();return(0,s.h)("calcite-label",null,e.panels.dotDensity.legend,(0,s.h)("calcite-list",{class:"top-grey-border",dragEnabled:!0,onCalciteListOrderChange:e=>{let t=Array.from(e.target.children);this.handleSortLegend(t)}},t.attributes.map(((e,t)=>this.renderLegendItem(e,t)))))}renderLegendItem(e,t){const{modules:i,selectedAttribute:l,strings:o}=a.s,n=(0,a.b)();return(0,s.h)("calcite-list-item",{value:e.field,key:`item-${e.field}`},(0,s.h)("div",{class:"symbol",slot:"content-start",tabIndex:0,role:"button","aria-label":o.panels.dotDensity.editSymbolFor.replace("${fieldName}",e.label),"aria-haspopup":"true","aria-expanded":l==t,onClick:()=>{var e;(null===(e=this.popoverSettings)||void 0===e?void 0:e.popoverNode)?(this.legendSwatchNodes[t].classList.remove("selected"),this.popoverSettings.index===t?((0,a.m)(),this.popoverSettings.popoverNode=null,this.popoverSettings.index=null):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openSymbolStylerForLegendSwatch(t))},ref:e=>this.legendSwatchNodes[t]=e},(0,s.h)("img",{src:i.symbolUtils.renderDotDensityPreviewHTML(n,new i.esriColor([e.color.r,e.color.g,e.color.b]),{swatchSize:16}).src,"aria-hidden":"true"})),this.renderTextNode(e,t))}renderTextNode(e,t){const{strings:i}=a.s;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.dotDensity.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus()},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus())},ref:e=>this.labelNodes[t]=e},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",value:e.label,placeholder:e.label,onFocusout:e=>{const i=e.target;this.handleLegendItemTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleLegendItemTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderUnits(){var e;const{strings:t}=a.s,i=(0,a.b)();return(0,s.h)("calcite-label",null,t.panels.dotDensity.dotsRepresent,(0,s.h)("calcite-input",{value:(null===(e=i.legendOptions)||void 0===e?void 0:e.unit)||"",onCalciteInputInput:e=>{const t=(0,a.b)(),i=e.target;t.legendOptions=t.legendOptions||{},t.legendOptions.unit=i.value||"",this.updateDotValueEquation(),(0,a.u)()}}))}renderDotValue(){var e;const{modules:t,strings:i}=a.s,l=(0,a.b)(),o=l.authoringInfo,{tickDotValue:n}=this;if(!o)return null;const r=this.initSliderSteps(),d=[{mode:"position",visibleElements:{labels:!0},labelsVisible:!0,values:[this.getSliderStepsPos(n)],tickCreatedFunction:(e,t,i)=>{t.onclick=()=>{this.handleDotValueChange(n)},i.onclick=()=>{this.handleDotValueChange(n)}}}];if(this.dotValueSlider){let e={values:[this.getSliderStepsPos(this.dotValue)]};(r||this.dotValueSlider.tickConfigs[0].values[0]!==d[0].values[0])&&(e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],labelFormatFunction:e=>this.sliderSteps[e],tickConfigs:d}),this.dotValueSlider.set(e)}else{const e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!1,precision:0,labelInputsEnabled:!0,labelFormatFunction:e=>this.sliderSteps[e],inputFormatFunction:e=>this.sliderSteps[e],inputParseFunction:e=>{var t,i,s;this.labelChanged=!0;let a=parseInt(e);return isNaN(a)?this.dotValueSlider.values[0]:(a<=0&&(a=1),-1===this.sliderSteps.indexOf(a)&&(null===(t=this.sliderSteps)||void 0===t||t.push(a),null===(i=this.sliderSteps)||void 0===i||i.sort(((e,t)=>e-t)),null===(s=this.dotValueSlider)||void 0===s||s.set({max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(a)]})),this.handleDotValueChange(a),this.getSliderStepsPos(a))},tickConfigs:d};this.dotValueSlider=new t.Slider(e),this.dotValueSlider.on("thumb-change",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])})),this.dotValueSlider.on("thumb-drag",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])}))}const c=o.minSliderValue!==o.maxSliderValue,h=o.minSliderValue.toString().length>5||o.maxSliderValue.toString().length>5;return c?(0,s.h)("calcite-label",null,i.panels.dotDensity.dotValue,(0,s.h)("div",{class:"dot-value-content"},(0,s.h)("div",{class:"slider dot-value-slider "+(h?"slider-bottom-label":""),ref:e=>{setTimeout((()=>{this.dotValueSlider&&(this.dotValueSlider.container=e)}),1)}}),(0,s.h)("calcite-label",{alignment:"center",ref:e=>this.dotValueEquationNode=e},i.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",(null===(e=l.legendOptions)||void 0===e?void 0:e.unit)||"")))):null}renderDotSize(){const{layer:e,mapImageSublayer:t,strings:i}=a.s;if(t&&e.version<11.1)return;const l=(0,a.b)(),o=Math.round(l.dotSize/.75*10)/10;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,i.panels.dotDensity.dotSize),(0,s.h)("arcgis-smart-mapping-slider-input",{min:.5,max:4,values:[o],precision:1,suffixText:i.panels.dotDensity.px,onArcgisSmartMappingSliderInputChange:e=>{const t=(0,a.b)(),i=Math.round(.75*e.detail*10)/10;i!==t.dotSize&&(t.dotSize=i,(0,a.u)())}}))}renderBackgroundStyle(){return(0,s.h)("arcgis-smart-mapping-background-symbol",{onArcgisSmartMappingBackgroundSymbolChange:()=>(0,s.f)(this.hostElement)})}renderOptions(){const{mapImageSublayer:e,mapView:t,strings:i}=a.s,l=(0,a.b)();return(0,s.h)(s.F,null,(0,s.h)("calcite-label",{layout:"inline-space-between",class:"top-margin"},i.panels.dotDensity.varyDotByScale,(0,s.h)("calcite-switch",{scale:"s",checked:l.referenceScale===t.scale,onCalciteSwitchChange:e=>{const i=e.target;(0,a.b)().referenceScale=i.checked?t.scale:void 0,(0,a.u)()}})),!e&&(0,s.h)("calcite-label",{layout:"inline-space-between"},i.panels.dotDensity.blendOverlappingColors,(0,s.h)("calcite-switch",{scale:"s",checked:l.dotBlendingEnabled,onCalciteSwitchChange:e=>{const t=e.target;(0,a.b)().dotBlendingEnabled=t.checked,(0,a.u)()}})))}getSliderStepsPos(e){let t=0;return this.sliderSteps.forEach(((i,s)=>{(e>=i||e-this.sliderSteps[t]>i-e)&&(t=s)})),t}handleLegendItemTextChange(e,t){const i=(0,a.b)();if(!t.length){t=this.originalRendererJSON.attributes.find((t=>t.field===i.attributes[e].field)).label}i.attributes[e].label=t,this.inputNodes[e].classList.add("hidden"),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,setTimeout((()=>this.labelNodes[e].focus()),300),(0,a.u)()}handleDotValueChange(e){const{mapView:t}=a.s;this.dotValue=e,this.labelChanged=!1;let i=(0,a.b)();i.dotValue=Math.round(this.dotValue),i.referenceScale=(0,a.O)(i.referenceScale)?t.scale:void 0,this.updateDotValueEquation(),(0,a.u)(),(0,s.f)(this.hostElement)}handleSortLegend(e){const t=(0,a.b)(),i=t.attributes.map((e=>e.clone())),l=e.map((e=>e.value));i.sort(((e,t)=>l.indexOf(e.field)-l.indexOf(t.field))),t.attributes=i,(0,a.u)(),(0,s.f)(this.hostElement)}initSliderSteps(){const e=(0,a.b)().authoringInfo,t=e.minSliderValue,i=Math.max(e.maxSliderValue,this.dotValue);if(this.sliderSteps&&this.sliderSteps.indexOf(this.dotValue)>-1)return!1;let s=(i-t)/Math.pow(2,19);s=Math.max(s,1);const l=[t];for(let e=0;e<79;e++){let a=Math.round(t+Math.pow(2,e/4)*s);if(a<t+(e+1)&&(a=t+(e+1)),this.dotValue<a&&this.dotValue>l[l.length-1]&&l.push(this.dotValue),a>=i){l.push(i);break}l.push(a)}return this.sliderSteps=l,!0}openSymbolStylerForLegendSwatch(e){(0,a.m)();const t=this.legendSwatchNodes[e];document.createElement("div").className="symbol-styler-div",this.popoverSettings.popoverNode=(0,h.c)({referenceElement:this.flowItemNode,heading:a.s.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),setTimeout((()=>null==t?void 0:t.focus()),300),t.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),t.classList.remove("selected"),this.popoverSettings.popoverNode=null})),(0,h.a)({selectedAttribute:e,popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.u)(),(0,s.f)(this.hostElement)}}),t.classList.add("selected")}updateDotValueEquation(){var e;const{strings:t}=a.s,i=(0,a.b)();this.dotValueEquationNode.innerHTML=t.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",this.htmlEncode((null===(e=i.legendOptions)||void 0===e?void 0:e.unit)||""))}htmlEncode(e){const t=document.createElement("textarea");return t.innerText=e,t.innerHTML.split("<br>").join("\n")}get hostElement(){return(0,s.d)(this)}};P.style=":host{width:100%}.flow-item{height:100%}.dot-density-block{overflow-x:hidden}.hidden{display:none}img{width:16px;height:16px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{width:16px;height:16px;margin:2px}.top-margin{margin-block-start:var(--calcite-label-margin-bottom, 0.75rem)}.top-grey-border{border-top:1px solid #e0e0e0}.text-wrap{overflow-wrap:anywhere}.dot-value-content{display:flex;flex-direction:column}.dot-value-slider{width:100%;height:70px;position:relative;margin:0 auto 10px auto}.dot-value-slider.esri-slider--horizontal .esri-slider__tick-label{cursor:pointer}.dot-value-slider.slider-bottom-label .esri-slider__max,.dot-value-slider.slider-bottom-label .esri-slider__min{width:-moz-fit-content;width:fit-content;position:absolute;bottom:11px}.dot-value-slider.slider-bottom-label .esri-slider__max{right:0;text-align:right}.dot-value-slider.slider-bottom-label .esri-slider__min{left:0;text-align:left}.dot-value-slider.esri-slider--horizontal .esri-slider__label{text-decoration:underline}.dot-value-slider.esri-slider--horizontal .esri-slider__label:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}";const I=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsHeatmapClose=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapClose",7),this.arcgisSmartMappingPanelsHeatmapBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapBackClick",7),this.arcgisSmartMappingPanelsHeatmapError=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapError",7),this.handleDone=()=>{(0,a.m)(),this.arcgisSmartMappingPanelsHeatmapClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsHeatmapClose.emit("cancel")},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;(0,a.au)(),null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"06739b72103558c34db7f2e0d6fad28be5042451",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"9c08672ede9c5e8e81a4a2d0602824f8e915e38e",class:{"flow-item":!0,[p.C.rtl]:i},heading:n.panels.heatmap.styleOptions,description:r,closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsHeatmapBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderVisualization(){var e;const{strings:t}=a.s,i=(0,a.b)(),l=i.field?null===(e=(0,a.t)(i.field))||void 0===e?void 0:e.label:void 0;return(0,s.h)("calcite-block",{class:"heatmap-block",heading:t.panels.heatmap.heatmapStyle,open:!0},l?(0,s.h)("calcite-label",{class:"attribute-name"},l):null,this.renderSymbol(),this.renderHeatmapSlider(),this.renderSoftEdges(),this.renderInfluenceValue(),this.renderLock(),this.renderRegenerate())}renderSymbol(){const e=(0,a.b)().colorStops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"heatmap-ramp",rampType:"continuous",colors:e,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode)}})}renderHeatmapSlider(){return(0,s.h)("arcgis-smart-mapping-heatmap-slider",{ref:e=>{e&&(this.sliderNode=e)}})}renderSoftEdges(){var e;const{strings:t,modules:i}=a.s,l=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,s.h)("div",null,(0,s.h)("calcite-label",null," ",t.panels.heatmap.softenEdges," "),(0,s.h)("calcite-slider",{min:0,max:1,minLabel:t.panels.heatmap.less,maxLabel:t.panels.heatmap.more,step:.01,value:(null===(e=l.authoringInfo)||void 0===e?void 0:e.fadeRatio)||0,onCalciteSliderInput:e=>{var t;const i=e.target.value;if((null===(t=(0,a.b)().authoringInfo)||void 0===t?void 0:t.fadeRatio)===i)return;const l=(0,b.u)(i);(0,a.u)(l),this.sliderNode&&(0,s.f)(this.sliderNode)}}),(0,s.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,s.h)("calcite-label",null,t.panels.heatmap.less),(0,s.h)("calcite-label",null,t.panels.heatmap.more)))}renderInfluenceValue(){const{strings:e,modules:t}=a.s,i=t.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-label",null,e.panels.heatmap.areaOfInfluence),(0,s.h)("calcite-slider",{min:1,max:60,minLabel:e.panels.heatmap.smaller,maxLabel:e.panels.heatmap.larger,value:i.radius||0,onCalciteSliderInput:e=>{const t=e.target;(0,a.b)().radius=t.value||10,(0,a.u)()}}),(0,s.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,s.h)("calcite-label",null,e.panels.heatmap.smaller),(0,s.h)("calcite-label",null,e.panels.heatmap.larger)))}renderLock(){const{mapImageSublayer:e,strings:t}=a.s;if(e)return;const i=(0,a.b)(),{referenceScale:l}=i;return(0,s.h)("div",{class:"top-margin-medium"},(0,s.h)("calcite-label",{layout:"inline-space-between"},t.panels.heatmap.lock,(0,s.h)("calcite-switch",{scale:"s",checked:!!l,onCalciteSwitchChange:()=>{const{mapView:e}=a.s,t=(0,a.b)();t.referenceScale=t.referenceScale?0:e.scale,(0,a.u)()},ref:e=>this.calciteSwitchNode=e,onMouseOver:()=>(0,a.aw)(this.calciteSwitchNode,t.panels.heatmap.lockHelp),onMouseOut:()=>(0,a.au)(),onFocus:()=>(0,a.aw)(this.calciteSwitchNode,t.panels.heatmap.lockHelp),onFocusout:()=>(0,a.au)()})))}renderRegenerate(){const{mapImageSublayer:e,strings:t}=a.s;if(!e)return(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",onClick:()=>{(0,o.r)((0,b.b)(),this.flowItemNode).then((()=>{(0,a.u)()}),(e=>this.arcgisSmartMappingPanelsHeatmapError.emit(e)))},label:t.panels.heatmap.regenerate},t.panels.heatmap.regenerate))}get hostElement(){return(0,s.d)(this)}};I.style=":host{width:100%}.flow-item{height:100%}.heatmap-block{overflow-x:hidden}.attribute-name{word-break:break-all}.slider-labels{display:flex;justify-content:space-between}.top-bottom-margin-small{margin:10px 0}.top-margin-medium{margin-top:18px}";const F=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceBackClick",7),this.arcgisSmartMappingPanelsPredominanceClose=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceClose",7),this.arcgisSmartMappingPanelsPredominanceError=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceError",7),this.valueSymbolNodes=[],this.labelNodes=[],this.inputNodes=[],this.maxCountOtherValues=200,this.popoverSettings={index:null,popoverNode:null},this.handleDone=()=>{(0,a.m)(),this.arcgisSmartMappingPanelsPredominanceClose.emit("save")},this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{modules:e,strings:t}=a.s,i=a.s.layer,s=(0,a.b)();return a.s.lastDefault={defaultSymbol:s.defaultSymbol||(0,a.q)(),defaultLabel:s.defaultLabel||t.panels.predominance.other},this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in i&&i.featureReduction?e.esriLang.clone(i.featureReduction):void 0,this.originalOrderBy=i.orderBy,this.visualizationOpen=!0,new Promise(((e,t)=>{(0,v.g)({fieldInfos:s.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:a.w.NUMBER})))}).then((t=>{this.predominantCategoryInfos=t.predominantCategoryInfos,e(t.predominantCategoryInfos)})).catch((e=>{this.arcgisSmartMappingPanelsPredominanceError.emit({message:e,type:"error"}),t(e)}))}))}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;a.s.lastDefault=void 0,a.s.selectedValue=void 0,null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"c312ee6fdbbc1625d01e38c2bae0a4f8a1c8d08f",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"f0f16ef1d2a405c2b5ef8bf1932d613444cbeb5d",class:{"flow-item":!0,[p.C.rtl]:i},heading:n.panels.predominance.styleOptions,description:r,closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsPredominanceBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderTransparency(),this.renderRotation(),this.renderDone(),this.renderCancel()))}renderVisualization(){const{strings:e}=a.s,t=!this.hideTransparency||!this.hideRotation;return(0,s.h)("calcite-block",{class:"predominance-block",heading:e.panels.predominance.predominanceStyle,collapsible:t,open:this.visualizationOpen,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderPredominanceSymbol(),this.renderDrawingOrder(),this.renderValues(),this.renderMsg(),this.renderBackgroundStyle())}renderPredominanceSymbol(){const{mapView:e,modules:t}=a.s,i=(0,a.b)().uniqueValueGroups[0].classes,l=t.predominanceSchemes.getSchemes({basemap:e.map.basemap,geometryType:(0,a.E)(),numColors:i.length}),o=(0,a.ad)(l,Math.min(i.length,10))[0].colors;let n=(null==i?void 0:i.length)?i.slice(0,10).map(((e,i)=>(0,a.Q)(e.symbol)||new t.esriColor(o[i%o.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"predominance-ramp",colors:n,rampType:"discrete",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderDrawingOrder(){const{layer:e,mapImageSublayer:t,strings:i}=a.s;if(t||"catalog-footprint"===e.type)return null;const l=(0,a.b)();return(0,s.h)("calcite-label",{layout:"inline-space-between"},i.panels.predominance.drawingOrder,(0,s.h)("calcite-switch",{scale:"s",checked:l.orderByClassesEnabled,onCalciteSwitchChange:e=>{const t=e.target;(0,a.m)();const i=a.s.layer;(0,a.b)().orderByClassesEnabled=t.checked,t.checked?i.orderBy=null:i.orderBy=this.originalOrderBy,(0,a.u)()}}))}renderValues(){const{strings:e}=a.s,t=(0,a.b)();return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,e.panels.predominance.fieldName),(0,s.h)("calcite-list",{class:"top-grey-border","drag-enabled":!0,onCalciteListOrderChange:e=>{let t=Array.from(e.target.children);this.handleSortValues(t)}},t.uniqueValueGroups[0].classes.map(((e,t)=>this.renderValue(e,t)))),(0,s.h)("calcite-list",null,this.renderDefaultValue()))}renderValue(e,t){return(0,s.h)("calcite-list-item",{value:e.values[0].value,key:`values-${e.values[0].value}`,"sort-values":e.values[0].value},this.renderSymbolNode(e,t),this.renderTextNode(e,t),this.renderCountNode(e))}renderSymbolNode(e,t){const{selectedValue:i,strings:l}=a.s,o={symbol:!0,"symbol-is-white":(0,a.ai)(e.symbol)};return(0,s.h)("div",{class:o,slot:"content-start",onClick:()=>this.handleValueSymbolClick(t),role:"button",tabIndex:0,"aria-label":l.panels.predominance.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":i===t,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t))},ref:e=>{t>-1?this.valueSymbolNodes[t]=e:this.defaultSymbolNode=e,this.createValueSymbol(t,e)}})}renderTextNode(e,t){const{strings:i}=a.s;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.predominance.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{a.s.selectedValue=t,e.target.classList.add("hidden");let i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){e.preventDefault(),e.stopPropagation(),a.s.selectedValue=t,e.target.classList.add("hidden");let i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()}},ref:e=>{t>-1?this.labelNodes[t]=e:this.defaultLabelNode=e}},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",value:e.label,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>{t>-1?this.inputNodes[t]=e:this.defaultInputNode=e}}))}renderCountNode(e){const{strings:t}=a.s,i=this.getPredominantCategoryValue(e.values[0].value);return i&&(0,a.O)(i.count)?(0,s.h)("div",{slot:"content-end",class:"value-count","aria-label":t.panels.predominance.accessibility.countFor.replace("${value}",e.label)},`${i.count}`):null}renderDefaultValue(){const{lastDefault:e,strings:t}=a.s,i=(0,a.b)(),l=i.defaultSymbol||e.defaultSymbol,o=i.defaultLabel||e.defaultLabel,n=this.getPredominantCategoryValue(void 0);return(0,s.h)("calcite-list-item",{class:"top-grey-border"},(0,s.h)("calcite-checkbox",{class:"checkbox",scale:"s",slot:"actions-start",checked:!!i.defaultSymbol,onClick:()=>{i.defaultSymbol?i.defaultSymbol=void 0:i.defaultSymbol=e.defaultSymbol,(0,a.u)(),(0,s.f)(this.hostElement)}}),this.renderSymbolNode(o,-1),this.renderTextNode({symbol:l,label:o},-1),(0,s.h)("div",{slot:"content-end","aria-label":t.panels.predominance.accessibility.countFor.replace("${value}",o)},""+(n&&(0,a.O)(n.count)?n.count:0)))}renderMsg(){const{lastDefault:e,strings:t}=a.s,i=(0,a.b)();return i.uniqueValueGroups[0].classes&&i.uniqueValueGroups[0].classes.length>this.maxCountOtherValues?(0,s.h)("div",null,t.panels.predominance.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):i.uniqueValueGroups[0].classes.length?null:(0,s.h)("div",null,t.panels.predominance.noFeatures.replace("${other}",e.defaultLabel))}renderBackgroundStyle(){const{mapImageSublayer:e}=a.s;return"predominance-size"!==(0,a.a)()||e?null:(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return null;const e=(0,a.d)((0,a.b)(),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!e,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)})}renderRotation(){if(this.hideRotation)return null;const e=(0,a.d)((0,a.b)(),"opacity"),t=(0,a.d)((0,a.b)(),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!e&&!!t,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e),ref:e=>this.rotationNode=e})}renderDone(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancel(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{originalRendererJSON:e,originalFeatureReduction:t,originalOrderBy:i}=this;a.s.layer.orderBy=i,(0,a.m)(),(0,a.l)(e,t),this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}async createValueSymbol(e,t){var i;const{lastDefault:s,modules:l}=a.s,o=(0,a.b)();let n;for(n=-1===e?o.defaultSymbol||s.defaultSymbol:o.uniqueValueGroups[0].classes[e].symbol.clone();null===(i=null==t?void 0:t.childNodes)||void 0===i?void 0:i.length;)t.removeChild(t.childNodes[0]);if(n){const e=await l.symbolUtils.renderPreviewHTML(n,{size:(0,a.aj)(n),symbolConfig:"cim"===n.type&&"CIMPolygonSymbol"===n.data.symbol.type?{isSquareFill:!0}:void 0});t.appendChild(e)}}getPredominantCategoryValue(e){if(!this.predominantCategoryInfos)return;const t=this.predominantCategoryInfos.filter((t=>t.value==e));return(null==t?void 0:t.length)?t[0]:void 0}handleSortValues(e){const{modules:t}=a.s;(0,a.m)();const i=e.map((e=>e.value)),l=(0,a.b)(),o=l.uniqueValueGroups[0].classes.filter((e=>i.indexOf(`${e.values[0].value}`)>-1)).map((e=>t.esriLang.clone(e)));o.sort(((e,t)=>i.indexOf(e.values[0].value)-i.indexOf(t.values[0].value))),l.uniqueValueGroups[0].classes=o,(0,a.u)(),(0,s.f)(this.hostElement)}handleValueSymbolClick(e){var t;if(null===(t=this.popoverSettings)||void 0===t?void 0:t.popoverNode){(-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e]).classList.remove("selected"),this.popoverSettings.index===e?((0,a.m)(),this.popoverSettings.popoverNode=null,this.popoverSettings.index=null):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}else this.popoverSettings.index=e,this.openSymbolStylerForValue(e)}handleValueTextChange(e,t){const{modules:i,strings:s}=a.s,l=(0,a.b)(),o=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(!t.length)if(-1===e)t=o.defaultLabel||s.panels.predominance.other;else{t=o.uniqueValueGroups[0].classes.find((t=>t.values[0].value===l.uniqueValueGroups[0].classes[e].values[0].value)).label}-1===e?l.defaultLabel=t:l.uniqueValueGroups[0].classes[e].label=t,(0,a.u)();let n=-1===e?this.defaultInputNode:this.inputNodes[e];n.classList.add("hidden");let r=-1===e?this.defaultLabelNode:this.labelNodes[e];r.classList.remove("hidden"),r.innerHTML=t,n.value=t,setTimeout((()=>{e===a.s.selectedValue&&(r.focus(),a.s.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){(0,a.m)();const t=-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e];this.popoverSettings.popoverNode=(0,h.c)({referenceElement:this.flowItemNode,heading:a.s.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,setTimeout((()=>t.focus()),300),t.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,t.classList.remove("selected")})),a.s.selectedValue=e,(0,h.d)({popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.u)(),(0,s.f)(this.hostElement),this.rotationNode&&(0,s.f)(this.rotationNode)}}),t.classList.add("selected")}get hostElement(){return(0,s.d)(this)}};F.style=":host{width:100%}.flow-item{height:100%}.predominance-block{overflow-x:hidden}.checkbox{margin:0 6.5px}.hidden{display:none}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{min-width:26px;display:flex}.symbol div{margin:auto}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}.top-grey-border{border-top:1px solid #e0e0e0}.list-item-top-grey-border{border-top:1.5px solid #e0e0e0}";const D=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeBackClick",7),this.arcgisSmartMappingPanelsPredominanceSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeClose",7),this.arcgisSmartMappingPanelsPredominanceSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeError",7),this.tileNodes=[],this.handleDone=()=>{this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),t.appendChild(e);break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),t.appendChild(e);break}}},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{layer:t,hideLayerTitle:i,isRTL:l,mapImageSublayer:o,strings:n}=a.s,r=i?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:t.title;return(0,s.h)(s.H,{key:"ad03cf11e4a7581cd3b680748ed241807ebd5625",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"6cc32f54118ec82ae7b0e06f5943d67d0d525854",class:{"flow-item":!0,[p.C.rtl]:l},heading:n.panels.styleOptions,description:r,closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsPredominanceSizeBackClick.emit()},this.renderPredominanceTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderPredominanceTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"predominance",selected:!1,onArcgisSmartMappingTileSelect:()=>{this.lastClick="predominance",this.handleOptionsClick("predominance")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("predominance"),ref:e=>{e&&(this.tileNodes.predominance=e)}})}renderSizeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const e=(0,a.d)((0,a.b)(),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!e,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e)})}renderRotation(){const e=(0,a.d)((0,a.b)(),"opacity"),t=(0,a.d)((0,a.b)(),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!e&&!!t,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e)})}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{(0,a.l)(this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick].setFocus()))),300)}get hostElement(){return(0,s.d)(this)}};D.style=":host{width:100%}.flow-item{height:100%}";const R=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipClose=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipClose",7),this.arcgisSmartMappingPanelsRelationshipBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipBackClick",7),this.arcgisSmartMappingPanelsRelationshipError=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipError",7),this.colorSliderNodes=[],this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{layer:t,hideLayerTitle:i,isRTL:l,mapImageSublayer:o,strings:n}=a.s,r=i?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:t.title;return(0,s.h)(s.H,{key:"6f1fdada359b4fcbbdd6ff6a08b275edb382c744",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"a29683ef8ad978c791afe98f28b35a0a7d315165",heading:n.panels.styleOptions,description:r,class:{"flow-item":!0,[p.C.rtl]:l},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:()=>this.handleDone(),onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRelationshipBackClick.emit(),ref:e=>{e&&(this.flowItemNode=e)}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderLegend(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.handleDone(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>this.handleCancel(),appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i}=this,{strings:l}=a.s;return(0,s.h)("calcite-block",{class:"relationship-block",heading:l.panels.relationship.relationshipStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderSymbol(),this.renderGridSize(),this.renderMethod(),this.renderField1(),this.renderField2(),this.renderBackgroundStyle(),this.renderDefaultSymbol())}renderSymbol(){const{mapView:e,modules:t}=a.s,i=(0,a.b)().uniqueValueInfos;if(!i.length)return null;const l=t.relationshipSchemes.getSchemes({basemap:e.map.basemap,geometryType:(0,a.E)()}),o=(0,a.ad)(l,Math.min(i.length,10))[0].colors;let n=((null==i?void 0:i.length)?i.filter(((e,t)=>t<10)).map(((e,i)=>(0,a.Q)(e.symbol)||new t.esriColor(o[i%o.length]))):[]).reverse();return(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:n,type:"relationship-ramp",rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1]),(0,s.f)(this.legendNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderGridSize(){const{strings:e}=a.s,t=(0,a.b)().authoringInfo.numClasses;return(0,s.h)("calcite-label",null,e.panels.relationship.gridSize,(0,s.h)("calcite-select",{label:e.panels.relationship.gridSize,onCalciteSelectChange:e=>{const t=e.target;this.handleGridSizeChange(parseFloat(t.value))}},(0,s.h)("calcite-option",{value:"2",selected:2===t},e.panels.relationship.gridsize2),(0,s.h)("calcite-option",{value:"3",selected:3===t},e.panels.relationship.gridsize3),(0,s.h)("calcite-option",{value:"4",selected:4===t},e.panels.relationship.gridsize4)))}renderMethod(){const e=(0,a.a)();return(0,s.h)("arcgis-smart-mapping-method-button",{onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingMethodButtonChange:t=>{const i=t.target,l=(0,a.b)();"manual"===t.detail?(l.authoringInfo.classificationMethod="manual",(0,a.u)(),(0,s.f)(this.hostElement)):(0,o.r)((0,S.a)({classificationMethod:t.detail}),this.flowItemNode).then((t=>{if(["relationship-size"].indexOf(e)>-1){const e=(0,a.d)(l,"size");t.renderer.visualVariables=t.renderer.visualVariables||[],t.renderer.visualVariables.push(e);const i=(0,a.J)(l,"size");t.renderer.authoringInfo=t.renderer.authoringInfo||{},t.renderer.authoringInfo.visualVariables=t.renderer.authoringInfo.visualVariables||[],t.renderer.authoringInfo.visualVariables.push(i)}(0,a.u)(t.renderer),(0,s.f)(this.hostElement),(0,s.f)(i)}),(e=>{(0,s.f)(i),this.arcgisSmartMappingPanelsRelationshipError.emit(e)}))},ref:e=>this.methodButtonNode=e})}renderField1(){const e=(0,a.b)().authoringInfo.field1,t=(0,a.t)(e.field),i=t.layerField.alias||t.layerField.name;return(0,s.h)("calcite-block-section",{text:i},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(0),this.renderColorSlider(0)))}renderField2(){const e=(0,a.b)().authoringInfo.field2,t=(0,a.t)(e.field),i=t.layerField.alias||t.layerField.name;return(0,s.h)("calcite-block-section",{text:i},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(1),this.renderColorSlider(1)))}renderDividedBy(e){const t=(0,a.b)().authoringInfo,i=(0===e?t.field1:t.field2).normalizationField;return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"relationship",fieldPos:e,normalizationField:i,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.hostElement),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}})}renderColorSlider(e){return(0,s.h)("arcgis-smart-mapping-relationship-color-slider",{fieldPos:e,ref:t=>this.colorSliderNodes[e]=t,onArcgisSmartMappingRelationshipColorSliderChange:()=>this.methodButtonNode&&(0,s.f)(this.methodButtonNode)})}renderBackgroundStyle(){const{mapImageSublayer:e}=a.s;return e||!(0,a.D)()||"relationship-size"!==(0,a.a)()?null:(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",null)}renderLegend(){return(0,s.h)("arcgis-smart-mapping-relationship-legend",{onArcgisSmartMappingRelationshipLegendFocusChange:()=>(0,s.f)(this.hostElement),ref:e=>this.legendNode=e})}renderTransparency(){const{hideTransparency:e}=this;if(e)return;const t=(0,a.b)(),i=(0,a.d)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}renderRotation(){if(this.hideRotation)return;const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(e,t),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){(0,a.m)(),(0,o.r)((0,S.a)({numClasses:e}),this.flowItemNode).then((e=>{if("relationship-size"===(0,a.a)()){const t=(0,a.b)(),i=(0,a.d)(t,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(i);const s=(0,a.J)(t,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(s)}(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1])}))}get hostElement(){return(0,s.d)(this)}};R.style=":host{width:100%}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}";const L=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeClose",7),this.arcgisSmartMappingPanelsRelationshipSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeBackClick",7),this.arcgisSmartMappingPanelsRelationshipSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeError",7),this.tileNodes=[],this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e);break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e);break}}},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{layer:t,mapImageSublayer:i,hideLayerTitle:l,isRTL:o,strings:n}=a.s,r=l?void 0:null!==(e=null==i?void 0:i.title)&&void 0!==e?e:t.title;return(0,s.h)(s.H,{key:"166c932ff0daf76212dbdaed8bb87fca562c0d87",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"8700473e634bb7b8a94d9c382f5c7977b438a691",heading:n.panels.styleOptions,description:r,class:{"flow-item":!0,[p.C.rtl]:o},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRelationshipSizeBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderRelationshipTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{(0,a.l)(this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}renderRelationshipTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"relationship",selected:"relationship"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="relationship",this.handleOptionsClick("relationship")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("relationship"),ref:e=>{e&&(this.tileNodes.relationship=e)}})}renderSizeTile(){const e=(0,a.K)("size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}`,type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}renderRotation(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick].setFocus()))),300)}get hostElement(){return(0,s.d)(this)}};L.style=":host{width:100%}.flow-item{height:100%}";const A=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsSimpleClose=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleClose",7),this.arcgisSmartMappingPanelsSimpleBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleBackClick",7),this.arcgisSmartMappingPanelsSimpleError=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleError",7),this.handleDone=()=>{this.arcgisSmartMappingPanelsSimpleClose.emit("save")},this.handleCancel=()=>{const{originalRenderer:e,originalFeatureReduction:t}=this,{layer:i}=a.s;"geo-rss"===i.type?(i.pointSymbol=e[0],i.lineSymbol=e[1],i.polygonSymbol=e[2]):(0,a.l)(e,t),this.arcgisSmartMappingPanelsSimpleClose.emit("cancel")},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=a.s;if("geo-rss"===e.type){const t=e;this.originalRenderer=[t.pointSymbol.clone(),t.lineSymbol.clone(),t.polygonSymbol.clone()]}else{const i=(0,a.b)();this.originalRenderer=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,await(0,a.j)()}}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{layer:e,useFeatureReduction:t,hideLayerTitle:i,isRTL:l,strings:o}=a.s,n=t?o.panels.gallery.binStyles:o.panels.gallery.styles;return(0,s.h)(s.H,{key:"1b6b6e154727751657e038d23c77fc0caeebf569",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"09f74018c9fd33cf5ad33c46f95b2166f3618a8b",heading:n,description:i?void 0:e.title,class:{"flow-item":!0,[p.C.rtl]:l},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsSimpleBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderVisualization(){const{visualizationOpen:e}=this,{layer:t,strings:i}=a.s;return(0,s.h)("calcite-block",{class:"simple-block",heading:i.panels.simple.simpleStyle,collapsible:"geo-rss"!==t.type&&(0,a.aL)(),open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},"geo-rss"===t.type?this.renderGeoRssSymbols():this.renderSymbol())}renderSymbol(){const e=(0,a.b)().symbol;return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:e,type:"simple",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderGeoRssSymbols(){return(0,s.h)("div",null,this.renderGeoRssSymbol("point"),this.renderGeoRssSymbol("line"),this.renderGeoRssSymbol("polygon"))}renderGeoRssSymbol(e){const{layer:t,strings:i}=a.s,l=t;let o="point"===e?l.pointSymbol:"line"===e?l.lineSymbol:l.polygonSymbol;const n="point"===e?i.panels.simple.pointSymbolStyle:"line"===e?i.panels.simple.lineSymbolStyle:i.panels.simple.polygonSymbolStyle;return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:o,type:"point"===e?"geo-rss-point":"line"===e?"geo-rss-line":"geo-rss-polygon",label:n,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.hostElement)})}renderTransparency(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}renderRotation(){const e=(0,a.b)(),t=(0,a.d)(e,"opacity"),i=(0,a.d)(e,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}get hostElement(){return(0,s.d)(this)}};A.style=":host{width:100%}.flow-item{height:100%}.simple-block{overflow-x:hidden}";const _=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsTypeBackClick",7),this.arcgisSmartMappingPanelsTypeClose=(0,s.c)(this,"arcgisSmartMappingPanelsTypeClose",7),this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsTypeClusterRequiresUpdate",7),this.arcgisSmartMappingPanelsTypeError=(0,s.c)(this,"arcgisSmartMappingPanelsTypeError",7),this.groupMenuNodes=[],this.groupInputNodes=[],this.groupTextNodes=[],this.valueInputNodes=[],this.valueTextNodes=[],this.symbolNodes=[],this.checkedClasses=[],this.classSortable=[],this.groupSortable=void 0,this.otherSortable=void 0,this.maxCountOtherValues=200,this.symbolStylerOpen=!1,this.dragRenderToggle=!0,this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){var e;const{layer:t,modules:i,strings:s}=a.s,l=t,o=(0,a.b)(),n=(0,a.a)();a.s.lastDefault={defaultSymbol:o.defaultSymbol||(0,a.q)(),defaultLabel:o.defaultLabel||s.panels.type.other},this.originalRendererJSON=o.toJSON(),this.originalFeatureReduction="featureReduction"in l&&l.featureReduction?i.esriLang.clone(l.featureReduction):void 0,this.originalOrderBy=l.orderBy;try{const t=await(0,f.c)({fieldInfos:[{field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle}],typeScheme:(0,a.a2)()});if((0,a.D)()&&"type-size"===n){let s=(null===(e=o.uniqueValueInfos)||void 0===e?void 0:e.length)?o.uniqueValueInfos[0].symbol:(0,a.q)();const l=(0,a.b)(),n=(0,a.J)(l,"reference-size");"simple-marker"===s.type||n||(s=new i.SimpleMarkerSymbol),t.uniqueValueInfos.map((e=>{const t=i.esriLang.clone(s);(0,a.W)(t,(0,a.Q)(e.symbol)),e.symbol=t}))}return a.s.allUniqueValues=t.uniqueValueInfos,Promise.resolve(t)}catch(e){return this.arcgisSmartMappingPanelsTypeError.emit({message:e,type:"error"}),Promise.reject(e)}}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;this.closePopovers(),null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"b4f9b2c7c4b974843ab967feec4b3470190dff49",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"c9ffc076e5caca023e0e0c4909bc08183900dd54",class:{"flow-item":!0,[p.C.rtl]:i},heading:n.panels.type.styleOptions,closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,description:r,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsTypeBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualizationContent(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualizationContent(){const{strings:e}=a.s,t=!this.hideTransparency||!this.hideRotation,i=(0,a.b)(),l=(0,a.t)(i.field),o=(null==l?void 0:l.simpleFieldType)===a.w.DATE||"date-only"===(0,a.z)(null==l?void 0:l.layerField);return(0,s.h)("calcite-block",{class:"type-block",heading:o?e.panels.type.typeStyleDate:e.panels.type.typeStyle,collapsible:t,open:!0},this.renderTypesSymbol(),this.renderDrawingOrder(),this.renderGroups(),this.renderBackgroundStyle())}renderTypesSymbol(){var e;const{mapView:t,modules:i}=a.s,l=(0,a.b)().uniqueValueGroups;if(!(null==l?void 0:l.length)||!(null===(e=l[0].classes)||void 0===e?void 0:e.length))return null;const o=[];l.forEach((e=>e.classes.forEach((e=>o.push(e)))));const n=i.typeSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,a.E)()}),r=(0,a.ad)(n,Math.min(o.length,10))[0].colors;let d=(null==o?void 0:o.length)?o.slice(0,10).map(((e,t)=>(0,a.Q)(e.symbol)||new i.esriColor(r[t%r.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{rampType:"discrete",colors:d,type:"type-ramp",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderDrawingOrder(){const{layer:e,mapImageSublayer:t,strings:i}=a.s;if(t||"catalog-footprint"===e.type)return null;const l=(0,a.b)();return(0,s.h)("calcite-label",{class:"toggle-div",layout:"inline-space-between"},i.panels.type.drawingOrder,(0,s.h)("calcite-switch",{class:"toggle-button",scale:"s",checked:l.orderByClassesEnabled,onCalciteSwitchChange:e=>{const t=e.target;this.handleDrawingOrderToggle(t.checked)}}))}renderGroups(){var e,t;const{strings:i}=a.s,l=(0,a.b)(),o=!(null===(e=l.uniqueValueGroups)||void 0===e?void 0:e.length),n=l.field?null===(t=(0,a.t)(l.field))||void 0===t?void 0:t.label:l.valueExpressionTitle||i.expression,r=o?[this.renderNoGroup()]:l.uniqueValueGroups.map(((e,t)=>this.renderGroup(e,t))),d=this.renderOtherValues();return(0,s.h)("div",{class:"top-padding"},(0,s.h)("calcite-label",null,n),(0,s.h)("div",{key:l.uniqueValueGroups.length,ref:e=>{var t;if(e){(0,a.b)().uniqueValueGroups.length&&(null===(t=this.groupSortable)||void 0===t||t.destroy(),this.groupSortable=y.S.create(e,{group:{name:"shared",pull:!0,put:!1},dataIdAttr:"group-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortGroups(),handle:".group-handle"}))}}},r),(0,s.h)("div",{class:"other",key:`${null==d?void 0:d.length}${this.dragRenderToggle}`},(0,s.h)("div",{class:r.length?"":"values-items-only"},this.renderDefaultValue()),(0,s.h)("div",{ref:e=>{var t;e&&(null===(t=this.otherSortable)||void 0===t||t.destroy(),this.otherSortable=y.S.create(e,{group:{name:"shared",pull:!1,put:!0},filter:".nodrag",sort:!1}))}},d,this.renderMsg())))}renderNoGroup(){const{strings:e}=a.s;return(0,s.h)("div",{class:"group"},(0,s.h)("div",{class:"group-header"},(0,s.h)("div",{class:"value-part1"},(0,s.h)("div",{class:"group-handle-disabled","aria-hidden":"true"},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"})),(0,s.h)("div",{class:"group-text no-group-heading",role:"button",tabIndex:0,"aria-label":e.panels.type.accessibility.editLabelFor.replace("${value}",e.panels.type.groupNameHint)},e.panels.type.groupNameHint)),(0,s.h)("div",{class:"value-part2"},this.renderGroupMenuNode(-2))),(0,s.h)("div",null,"\xa0"))}renderGroup(e,t){const i=e.classes.map(((e,i)=>this.renderValue(e,t,i)));return(0,s.h)("div",{key:e.toJSON(),class:"group","group-sort-values":`${t}`},(0,s.h)("div",{class:"group-header"},(0,s.h)("div",{class:"value-part1"},this.renderGroupHandleNode(t),this.renderGroupTextNode(e,t)),(0,s.h)("div",{class:"value-part2"},this.renderGroupCountNode(e),this.renderGroupMenuNode(t,e))),(0,s.h)("div",{ref:e=>{var i,s;e&&(null===(s=null===(i=this.classSortable)||void 0===i?void 0:i[t])||void 0===s||s.destroy(),this.classSortable[t]=y.S.create(e,{group:{name:"nested",pull:!0,put:["nested"]},dataIdAttr:"class-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortClasses(t),handle:".class-handle"}))}},i))}renderGroupHandleNode(e){const{strings:t}=a.s,i=this.selectedValueText===`${e}`;return(0,s.h)("div",{class:i?"group-handle-disabled":"group-handle","aria-hidden":"true",onMouseOver:s=>{const a=s.target;!i&&this.onMouseOver(`values-${e}-handle-tooltip`,a,t.panels.type.tooltips.dragGroup)},onMouseOut:()=>this.onMouseOut(`values-${e}-handle-tooltip`)},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderGroupTextNode(e,t){const{strings:i}=a.s;let l=!1;return(0,s.h)(s.F,null,(0,s.h)("calcite-input",{class:"hidden",value:e.heading||"",onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&!l){e.preventDefault(),e.stopPropagation(),l=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},onFocusout:e=>{if(!l){l=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},ref:e=>{e&&(this.groupInputNodes[t]=e)}}),(0,s.h)("div",{class:"group-text group-text-active "+(e.heading?"group-heading":"no-group-heading"),role:"button",tabIndex:0,"aria-label":i.panels.type.accessibility.editLabelFor.replace("${value}",e.heading||i.panels.type.groupNameHint),onClick:()=>{this.onMouseOut(`group-${t}-text-tooltip`),this.handleGroupTextClick(t)},onMouseOver:e=>{const s=e.target;this.onMouseOver(`group-${t}-text-tooltip`,s,i.panels.type.tooltips.renameGroup)},onMouseOut:()=>this.onMouseOut(`group-${t}-text-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleGroupTextClick(t))},ref:e=>{e&&(this.groupTextNodes[t]=e)}},e.heading||i.panels.type.groupNameHint))}renderValue(e,t,i){return(0,s.h)("div",{key:`values-${e.label}`,class:"value","class-sort-values":`${t}/${i}`},(0,s.h)("div",{class:"value-part1"},this.renderHandleNode(t,i),this.renderCheckNode(t,i),this.renderSymbolNode(e,t,i),this.renderTextNode(e,t,i)),(0,s.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderHandleNode(e,t){const{strings:i}=a.s,l=this.selectedValueText===`${e}/${t}`;return(0,s.h)("div",{class:l?"class-handle-disabled":"class-handle","aria-hidden":"true",onMouseOver:s=>{const a=s.target;this.onMouseOver(`values-${e}-${t}-handle-tooltip`,a,i.panels.type.tooltips.dragType)},onMouseOut:()=>this.onMouseOut(`values-${e}-${t}-handle-tooltip`)},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderCheckNode(e,t,i){const{strings:l}=a.s,o=this.checkedClasses.find((i=>i.groupIdx===e&&i.classIdx===t));return(0,s.h)("calcite-action",{scale:"s",icon:o?"check-square":"square",text:l.panels.type.checkValue,appearance:"transparent",onClick:i=>{const s=i.currentTarget;this.handleCheck(e,t,s)},onKeyDown:t=>{var s;-1===e&&i&&!t.shiftKey&&"Tab"===t.key&&(null===(s=this.actionsPopoverNode)||void 0===s||s.focusActionPad())},ref:t=>{-1===e&&i&&(this.lastOtherValueCheckNode=t)}})}renderSymbolNode(e,t,i){const{strings:l}=a.s,o={"value-symbol":!0,"symbol-is-white":(0,a.ai)(e.symbol)},n={symbol:!0,[(0,a.E)()]:!0,"symbol-selector--selected":this.selectedValue===`${t}/${i}`};return(0,s.h)("div",{class:o,onClick:()=>this.handleValueSymbolClick(t,i),role:"button","aria-label":l.panels.type.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":this.selectedValue===`${t}/${i}`,onMouseOver:e=>{const s=e.target;this.onMouseOver(`values-${t}-${i}-icon-tooltip`,s,l.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut(`values-${t}-${i}-icon-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t,i))}},(0,s.h)("div",{class:n,tabIndex:0,ref:e=>{e&&(this.symbolNodes[t]||(this.symbolNodes[t]=[]),this.symbolNodes[t][i]=e,this.afterCreateValueSymbol(t,i,e))},"aria-hidden":"true"}))}renderTextNode(e,t,i){var l;const{strings:o}=a.s;let n=!1;return(0,s.h)(s.F,null,(0,s.h)("calcite-input",{class:"hidden",value:e.label,onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),!n)){n=!0;const s=e.target;this.handleValueTextChange(t,i,s.value)}},onFocusout:e=>{if(!n){n=!0;const s=e.target;this.handleValueTextChange(t,i,s.value)}},ref:e=>{e&&(this.valueInputNodes[t]||(this.valueInputNodes[t]=[]),this.valueInputNodes[t][i]=e)}}),(0,s.h)("div",{class:"value-text",role:"button",tabIndex:0,"aria-label":o.panels.type.accessibility.editLabelFor.replace("${value}",e.label),onClick:()=>{this.onMouseOut(`value-${t}-${i}-text-tooltip`),this.handleValueTextClick(t,i)},onMouseOver:e=>{const s=e.target;this.onMouseOver(`value-${t}-${i}-text-tooltip`,s,o.panels.type.tooltips.renameType)},onMouseOut:()=>this.onMouseOut(`value-${t}-${i}-text-tooltip`),onKeyDown:e=>{if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleValueTextClick(t,i);else if(!e.shiftKey&&"Tab"===e.key&&-1===t){const e=(0,a.b)(),t=(0,f.g)();let i=0;e.uniqueValueGroups.forEach((e=>i+=e.classes.length));!!(null==t?void 0:t.length)&&!(1===t.length&&!t[0].value)&&i<200||this.actionsPopoverNode.focusActionPad()}},ref:e=>{e&&(-1===t&&-1===i?this.otherTextNode=e:(this.valueTextNodes[t]||(this.valueTextNodes[t]=[]),this.valueTextNodes[t][i]=e))}},(null===(l=e.label)||void 0===l?void 0:l.trim().length)?e.label:"\xa0\xa0\xa0\xa0\xa0\xa0"))}renderCountNode(e){const{allUniqueValues:t,strings:i}=a.s;if(!(null==t?void 0:t.length))return;let l;if(e.values.length>1)l=e.values.reduce(((e,t)=>{var i;return e+(null===(i=this.getUniqueValue(t.value))||void 0===i?void 0:i.count)||0}),0);else{const i=e.values[0].value,s=this.getUniqueValue(i);if(s&&!(0,a.O)(s.count))return null;if(!s&&(null==t?void 0:t.length)){const e=this.getUniqueValue(t[0].value);if(!(0,a.O)(null==e?void 0:e.count))return null}l=s?s.count:0}return(0,s.h)("div",{class:"value-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.label)},`${l}`)}renderGroupCountNode(e){const{allUniqueValues:t,strings:i}=a.s;if(!(null==t?void 0:t.length))return;let l=0;return e.classes.forEach((e=>{e.values.forEach((e=>{var i;const s=this.getUniqueValue(e.value);if(!s||(0,a.O)(s.count)){if(!s&&(null==t?void 0:t.length)){const e=this.getUniqueValue(t[0].value);if(!(0,a.O)(null==e?void 0:e.count))return}l+=null!==(i=null==s?void 0:s.count)&&void 0!==i?i:0}}))})),(0,s.h)("div",{class:"group-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.heading)},`${t?l:""}`)}renderGroupMenuNode(e,t){const{strings:i}=a.s,l=(0,a.b)(),o=l.uniqueValueGroups;let n,r=!1,d=!1;if(-1===e){n=(0,f.b)();let e=0;l.uniqueValueGroups.forEach((t=>{var i,s;return e+=null!==(s=null===(i=t.classes)||void 0===i?void 0:i.length)&&void 0!==s?s:0})),e+n.length>200&&(n=n.slice(0,200-e)),r=!!n.find(((e,t)=>!this.checkedClasses.find((e=>-1===e.groupIdx&&e.classIdx===t))))}else r=!!(null==t?void 0:t.classes.find(((t,i)=>!this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i))))),d=!!(null==t?void 0:t.classes.find((e=>e.values.length>1)));return(0,s.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:t=>{t&&(this.groupMenuNodes[e]=t)}},(0,s.h)("calcite-action",{slot:"trigger",scale:"s",text:i.panels.type.tooltips.options},(0,s.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,s.h)("calcite-dropdown-item",{"icon-start":"pin-plus",label:i.panels.type.addValue,onClick:()=>this.handleAddValue(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleAddValue(e)}},i.panels.type.addValue),o.length>0&&(0,s.h)("calcite-dropdown-item",{"icon-start":"palette",label:i.panels.type.changeColors,onClick:()=>this.openSymbolStylerForGroup(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.openSymbolStylerForGroup(e)}},i.panels.type.changeColors)),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},r&&(0,s.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:i.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSelectAllValues(e)}},i.panels.type.selectAllValues),d&&(0,s.h)("calcite-dropdown-item",{"icon-start":"group-x",label:i.panels.type.separateValues,onClick:()=>this.handleSeparateValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSeparateValues(e)}},i.panels.type.separateValues),e>0&&(0,s.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:i.panels.type.moveUp,onClick:()=>this.handleGroupMoveUp(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveUp(e)}},i.panels.type.moveUp),o.length>0&&e<o.length-1&&(0,s.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-down",label:i.panels.type.moveDown,onClick:()=>this.handleGroupMoveDown(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveDown(e)}},i.panels.type.moveDown)))}renderDefaultValue(){const{lastDefault:e,strings:t}=a.s,i=(0,a.b)(),l=i.defaultSymbol||e.defaultSymbol,o=i.defaultLabel||e.defaultLabel,n=(0,f.g)(),r=n?this.getOtherCount(n):-1;let d=0;i.uniqueValueGroups.forEach((e=>d+=e.classes.length));const c=!!(null==n?void 0:n.length)&&d<200,h=c&&1===n.length&&!n[0].value,u={"value-symbol":!0,"symbol-is-white":(0,a.ai)(l)},p={symbol:!0,[(0,a.E)()]:!0,"symbol-selector--selected":"-1"===this.selectedValue};return(0,s.h)("div",{class:"value "+(c?"default-value":"")},(0,s.h)("div",{class:"value-part1"},(0,s.h)("calcite-checkbox",{scale:"s",checked:!!i.defaultSymbol,onMouseOver:e=>{const i=e.target;this.onMouseOver("default-value-checkbox-tooltip",i,t.panels.type.tooltips.otherTooltip)},onMouseOut:()=>this.onMouseOut("default-value-checkbox-tooltip"),onClick:()=>this.handleDefaultCheckChange()}),(0,s.h)("div",{class:u,onClick:()=>this.handleValueSymbolClick(-1,0),role:"button","aria-haspopup":"true","aria-expanded":"-1/0"===this.selectedValue,"aria-label":t.panels.type.accessibility.editSymbolFor.replace("${fieldName}",o),onMouseOver:e=>{const i=e.target;this.onMouseOver("default-value-symbol-tooltip",i,t.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut("default-value-symbol-tooltip"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(-1,0))}},(0,s.h)("div",{class:p,tabIndex:0,ref:e=>{e&&(this.symbolNodes[-1]||(this.symbolNodes[-1]=[]),this.symbolNodes[-1][0]=e,this.afterCreateValueSymbol(-1,0,e))},"aria-hidden":"true"})),this.renderTextNode({symbol:l,label:o},-1,-1)),(0,s.h)("div",{class:"value-part2"},r>-1?(0,s.h)("div",{class:`group-count ${(!c||h)&&"group-count-no-menu"}`,"aria-label":t.panels.type.accessibility.countFor.replace("${value}",o)},`${r}`):null,c&&!h&&this.renderDefaultMenuNode()))}renderDefaultMenuNode(){const{strings:e}=a.s,t=(0,f.b)();return(0,s.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:e=>{e&&(this.groupMenuNodes[-1]=e)}},(0,s.h)("calcite-action",{slot:"trigger",scale:"s",text:e.panels.type.tooltips.options},(0,s.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,s.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:e.panels.type.moveUp,onClick:()=>this.handleMoveUpAll(t),onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.handleMoveUpAll(t)}},e.panels.type.moveUp)))}renderOtherValues(){const{allUniqueValues:e}=a.s,t=(0,a.b)();if(!e||!e.length)return null;let i=(0,f.b)(),s=0;t.uniqueValueGroups.forEach((e=>{var t,i;return s+=null!==(i=null===(t=e.classes)||void 0===t?void 0:t.length)&&void 0!==i?i:0})),s+i.length>200&&(i=i.slice(0,200-s));return i.map(((e,t)=>this.renderOtherValue(e,t,t===i.length-1)))}renderOtherValue(e,t,i){const{strings:l}=a.s;return(0,s.h)("div",{class:"value nodrag",key:e.toJSON()},(0,s.h)("div",{class:"value-part1"},(0,s.h)("div",{class:"value-handle-placeholder"},"\xa0"),(0,a.O)(e.values[0].value)?this.renderCheckNode(-1,t,i):(0,s.h)("div",{class:"check-placeholder"},"\xa0"),(0,s.h)("div",{class:"value-text other-value-text","aria-label":e.label},null===e.values[0].value?l.panels.type.noData:e.label)),(0,s.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderMsg(){const{allUniqueValues:e,lastDefault:t,strings:i}=a.s,l=(0,a.b)();return e&&e.length>this.maxCountOtherValues?(0,s.h)("div",{class:"type-panel-msg"},i.panels.type.errors.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):l.uniqueValueInfos.length||(null==e?void 0:e.length)?null:(0,s.h)("div",{class:"type-panel-msg"},i.panels.type.errors.noFeatures.replace("${other}",t.defaultLabel))}renderBackgroundStyle(){const{mapImageSublayer:e}=a.s;return"type-size"!==(0,a.a)()||e?null:(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return null;const e=(0,a.d)((0,a.b)(),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!e,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),onKeyDown:e=>{"type"===(0,a.a)()&&e.shiftKey&&"Tab"===e.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>{e&&(this.transparencyNode=e)}})}renderRotation(){if(this.hideRotation)return null;const e=(0,a.d)((0,a.b)(),"opacity"),t=(0,a.d)((0,a.b)(),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!e&&!!t,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),ref:e=>this.rotationNode=e})}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsTypeClose.emit("save"),appearance:"solid",width:"half",onKeyDown:e=>{"type-size"===(0,a.a)()&&e.shiftKey&&"Tab"===e.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>this.doneButtonNode=e},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{layer:e}=a.s,t=e,{originalRendererJSON:i,originalFeatureReduction:s,originalOrderBy:l}=this;this.closePopovers(),"catalog-footprint"!==t.type&&(t.orderBy=l),(0,a.l)(i,s),this.arcgisSmartMappingPanelsTypeClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}addActionsPopover(){this.closePopovers(),this.actionsPopoverNode=document.createElement("arcgis-smart-mapping-type-actions-popover"),this.actionsPopoverNode.referenceNode=this.flowItemNode,this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.groupMenuNodes=this.groupMenuNodes,this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverChange",(e=>{var t;(null===(t=e.detail)||void 0===t?void 0:t.checkedClasses)&&(this.checkedClasses=e.detail.checkedClasses,e.detail.checkedClasses.length||this.removeActionsPopover()),(0,s.f)(this.hostElement),this.checkCluster()})),this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverFocusExit",(e=>{var t,i;if("bottom"===e.detail){"type"===(0,a.a)()?null===(t=this.transparencyNode)||void 0===t||t.setFocus():null===(i=this.doneButtonNode)||void 0===i||i.setFocus()}else"top"===e.detail&&(this.lastOtherValueCheckNode?this.lastOtherValueCheckNode.setFocus():this.otherTextNode.focus())})),document.body.appendChild(this.actionsPopoverNode)}afterCreateValueSymbol(e,t,i){var s;const{lastDefault:l,modules:o}=a.s,n=(0,a.b)(),r=(0,a.J)(n,"reference-size"),d=(0,a.O)(r);let c;for(c=-1===e?n.defaultSymbol||l.defaultSymbol:n.uniqueValueGroups[e].classes[t].symbol.clone();null===(s=null==i?void 0:i.childNodes)||void 0===s?void 0:s.length;)i.removeChild(i.childNodes[0]);c&&o.symbolUtils.renderPreviewHTML(c,{size:(0,a.aj)(c,d),symbolConfig:"cim"===c.type&&"CIMPolygonSymbol"===c.data.symbol.type?{isSquareFill:!0}:void 0}).then((e=>{d&&(e.style.display="block"),i.appendChild(e)}))}checkCluster(){const{layer:e}=a.s;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate.emit()}closePopovers(){this.removeActionsPopover(),(0,a.m)()}getOtherCount(e){let t=0;return e.map((e=>t+=e.count)),e.length?t:-1}getUniqueValue(e){const{allUniqueValues:t}=a.s;if(!t)return null;const i=t.filter((t=>"<Null>"===e&&null===t.value||t.value==e));return i.length?i[0]:null}handleAddValue(e){const t=document.createElement("arcgis-smart-mapping-type-add-value");t.groupIdx=e,t.flowItemNode=this.flowItemNode,t.referenceNode=this.groupMenuNodes[e],t.addEventListener("arcgisSmartMappingTypeAddValuePopoverClose",(()=>{setTimeout((()=>this.groupMenuNodes[e].setFocus()),300),null==t||t.parentElement.removeChild(t)})),t.addEventListener("arcgisSmartMappingTypeAddValuePopoverNewValue",(()=>{this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>this.groupMenuNodes[e].setFocus()),300),null==t||t.parentElement.removeChild(t)})),document.body.appendChild(t)}handleCheck(e,t,i){const a=this.checkedClasses.findIndex((i=>i.groupIdx===e&&i.classIdx===t));a>-1?(this.checkedClasses.splice(a,1),i.icon="square",this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode),this.checkedClasses.length||this.removeActionsPopover()):(this.checkedClasses=[...this.checkedClasses,{groupIdx:e,classIdx:t}],i.icon="check-square",this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode)):this.addActionsPopover())}handleDefaultCheckChange(){const e=(0,a.b)();if(e.defaultSymbol)e.defaultSymbol=void 0,e.defaultLabel=void 0;else{const{lastDefault:t}=a.s;e.defaultSymbol=t.defaultSymbol,e.defaultLabel=t.defaultLabel}this.updateRendererAndUI()}handleDrawingOrderToggle(e){const{layer:t}=a.s,i=t,s=(0,a.b)();(0,a.m)(),s.orderByClassesEnabled=e,i.orderBy=e?null:this.originalOrderBy,this.updateRendererAndUI()}handleGroupMoveUp(e){this.closePopovers();const t=(0,a.b)();if(e>0){const i=t,s=i.uniqueValueGroups,a=s.splice(e,1)[0];s.splice(e-1,0,a),i.uniqueValueGroups=s,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{var t;return null===(t=this.groupMenuNodes[e-1])||void 0===t?void 0:t.setFocus()}),300)}}handleGroupMoveDown(e){this.closePopovers();const t=(0,a.b)(),i=t.uniqueValueGroups;if(e<i.length-1){const i=t,s=i.uniqueValueGroups,a=s.splice(e,1)[0];s.splice(e+1,0,a),i.uniqueValueGroups=s,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{var t;return null===(t=this.groupMenuNodes[e+1])||void 0===t?void 0:t.setFocus()}),300)}}handleGroupTextChange(e,t){const i=(0,a.b)(),s=i.uniqueValueGroups;this.groupInputNodes[e].classList.add("hidden"),s[e].heading=t,i.uniqueValueGroups=s,this.selectedValueText=void 0,this.updateRendererAndUI(),this.groupTextNodes[e].classList.remove("hidden"),setTimeout((()=>this.groupTextNodes[e].focus()),300)}handleGroupTextClick(e){this.selectedValueText=`${e}`,this.groupTextNodes[e].classList.add("hidden"),this.groupInputNodes[e].classList.remove("hidden"),this.groupInputNodes[e].setFocus()}handleMoveUpAll(e){e=e.filter((e=>null!==e.values[0].value));const{modules:t}=a.s;this.selectedValue=void 0,this.selectedValueText=void 0,this.closePopovers();const i=(0,a.b)(),s=i.uniqueValueGroups;let l=0;if(s.forEach((e=>{var t,i;return l+=null!==(i=null===(t=e.classes)||void 0===t?void 0:t.length)&&void 0!==i?i:0})),l+e.length>200&&(e.length=200-l),1!==s.length||s[0].heading){const i=new t.UniqueValueGroup({heading:(0,f.d)(s),classes:e});s.push(i)}else s[0].classes=s[0].classes.concat(e);i.uniqueValueGroups=s,this.updateRendererAndUI(),this.checkCluster()}handleSelectAllValues(e){(0,a.m)();(0,a.b)().uniqueValueGroups[e].classes.forEach(((t,i)=>{this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i))||this.checkedClasses.push({groupIdx:e,classIdx:i})})),(0,s.f)(this.hostElement),this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode)):this.addActionsPopover()}handleSeparateValues(e){this.closePopovers(),this.separateGroupValues(e),this.updateRendererAndUI(),this.checkCluster()}handleSortClasses(e){var t;const i=(null===(t=this.classSortable)||void 0===t?void 0:t[e].toArray())||[],{modules:s}=a.s,l=(0,a.b)();this.closePopovers();const o=(0,f.b)().length;let n=0;l.uniqueValueGroups.forEach((e=>{var t,i;return n+=null!==(i=null===(t=e.classes)||void 0===t?void 0:t.length)&&void 0!==i?i:0}));const r=l.clone().uniqueValueGroups,d=[];r.forEach(((t,a)=>{if(a===e){const e=new s.UniqueValueGroup({heading:t.heading,classes:[]});i.forEach((t=>{const[i,s]=t.split("/").map((e=>parseInt(e)));e.classes.push(r[i].classes[s])})),d.push(e)}else d.push(r[a])})),l.uniqueValueGroups=d.filter((e=>!!e.classes.length));const c=(0,f.b)().length;this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],o===c&&(this.dragRenderToggle=!this.dragRenderToggle),setTimeout((()=>this.updateRendererAndUI()),300),this.checkCluster();let h=0;l.uniqueValueGroups.forEach((e=>{var t,i;return h+=null!==(i=null===(t=e.classes)||void 0===t?void 0:t.length)&&void 0!==i?i:0})),n!==h&&this.checkCluster()}handleSortGroups(){const e=this.groupSortable?this.groupSortable.toArray():[],t=(0,a.b)();this.closePopovers();const i=t.uniqueValueGroups,s=[];e.forEach((e=>{s.push(i[parseInt(e)])})),t.uniqueValueGroups=s,this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],this.updateRendererAndUI()}handleValueSymbolClick(e,t){if(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),this.symbolStylerOpen)this.selectedValue=void 0,this.selectedValueText=void 0,(0,a.m)(),this.symbolStylerOpen=!1;else{const i=`${e}/${t}`;this.selectedValue=this.selectedValue!==i?i:void 0,this.selectedValueText=void 0,(0,a.O)(this.selectedValue)?this.openSymbolStylerForValue(e,t):(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),(0,a.m)(),this.symbolStylerOpen=!1)}}handleValueTextChange(e,t,i){var s;const{allUniqueValues:l,lastDefault:o,modules:n,strings:r}=a.s,d=(0,a.b)(),c=d.uniqueValueGroups;if(this.valueInputNodes[e][t].classList.add("hidden"),(null===(s=c[e])||void 0===s?void 0:s.classes[t].label)!==i){if(!(null==i?void 0:i.length))if(-1===e)i=this.originalRendererJSON.defaultLabel||r.panels.type.other;else{let s=l.find((i=>i.value===d.uniqueValueGroups[e].classes[t].values[0].value));i=(null==s?void 0:s.label)||d.uniqueValueGroups[e].classes[t].label}if(-1!==e||d.defaultSymbol||(o.defaultLabel=i),-1===e)d.defaultSymbol&&(d.defaultLabel=i||o.defaultLabel);else{const s=d.uniqueValueGroups,o=(0,a.t)(d.field);if(i)s[e].classes[t].label=i;else{const i=s[e].classes[t].values.map((e=>{var t;const i=e.value,s=null===(t=null==l?void 0:l.find((e=>e.value===i)))||void 0===t?void 0:t.label;return s||((null==o?void 0:o.simpleFieldType)===a.w.DATE||"date-only"===(0,a.z)(null==o?void 0:o.layerField)?(0,f.e)(i,o):(null==o?void 0:o.simpleFieldType)===a.w.NUMBER?n.intl.formatNumber(i):i)}));s[e].classes[t].label=i.join(", ")}d.uniqueValueGroups=s}}this.selectedValueText=void 0,this.updateRendererAndUI(),setTimeout((()=>{const i=-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t];i.classList.remove("hidden"),i.focus()}))}handleValueTextClick(e,t){var i,s;this.selectedValueText=`${e}/${t}`;(-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t]).classList.add("hidden"),null===(i=this.valueInputNodes[e][t])||void 0===i||i.classList.remove("hidden"),null===(s=this.valueInputNodes[e][t])||void 0===s||s.setFocus()}onMouseOver(e,t,i){(0,a.au)(),(0,a.aM)(t,i,e)}onMouseOut(e){(0,a.aN)(e)}openSymbolStylerForGroup(e){const{strings:t}=a.s;(0,a.m)();const i=(0,h.c)({referenceElement:this.flowItemNode,heading:t.panels.type.symbolStyle});i.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(i),this.selectedValue=void 0,this.selectedValueText=void 0,setTimeout((()=>{var t;return null===(t=this.groupMenuNodes[e])||void 0===t?void 0:t.setFocus()}),300)})),i.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(i),setTimeout((()=>{var t;return null===(t=this.groupMenuNodes[e])||void 0===t?void 0:t.setFocus()}),300)})),(0,h.e)({groupIdx:e,popoverNode:i,onChange:()=>{this.updateRendererAndUI()}})}openSymbolStylerForValue(e,t){const{strings:i}=a.s;(0,a.m)();const l=(0,h.c)({referenceElement:this.flowItemNode,heading:i.panels.type.symbolStyle});l.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{let i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(l),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),l.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{let i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(l),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),(0,h.f)({selectedValue:this.selectedValue,popoverNode:l,onChange:()=>{this.updateRendererAndUI(),this.rotationNode&&(0,s.f)(this.rotationNode)}}),this.symbolStylerOpen=!0,this.symbolNodes[e][t].classList.add("symbol-selector--selected")}removeActionsPopover(){var e,t;null===(t=null===(e=this.actionsPopoverNode)||void 0===e?void 0:e.parentElement)||void 0===t||t.removeChild(this.actionsPopoverNode),this.actionsPopoverNode=null}separateGroupValues(e){const t=(0,a.b)().uniqueValueGroups;(0,f.f)(t[e]),this.checkedClasses=[]}updateRendererAndUI(){(0,a.u)(),(0,s.f)(this.hostElement)}get hostElement(){return(0,s.d)(this)}};_.style=":host{width:100%}.flow-item{height:100%}.hidden{display:none}.type-block{overflow:hidden}.check-placeholder{width:32px;height:24px}.type-panel-msg{font-size:80%;margin:5px}.toggle-button{margin-top:2px}.toggle-div{padding-top:6px}.top-padding{padding-top:10px}.symbol-selector{background-color:rgb(255, 255, 255);display:flex;padding:9px 9px;justify-content:space-between;align-items:center;border-radius:3px;cursor:pointer;transition:box-shadow 250ms ease-in-out;box-shadow:0 0 0 1px #e0e0e0}.symbol-selector :last-child{margin-bottom:0}.symbol-selector :last-child svg{fill:#c0c0c0}.symbol-selector :hover{box-shadow:0 0 0 1px #c0c0c0}.symbol-selector :hover svg{fill:#404040}.symbol-selector--selected,.symbol-selector--selected:hover{outline:1px solid var(--calcite-color-brand)}.symbol-selector--selected svg,.symbol-selector--selected:hover svg{fill:#404040}.symbol-is-white{background-color:#f3f3f3}.symbol-icon{min-width:26px;display:flex}.symbol-icon div{margin:auto}.symbol-icon.transparent{height:15px;width:100%}.symbol-icon.transparent svg{height:15px;width:95%;stroke:#e0e0e0;stroke-width:1px}.group-header{display:flex;padding:6px 0;justify-content:space-between;align-items:center;border-bottom:1px solid #e0e0e0}.group-heading{font-weight:bold}.no-group-heading{color:rgba(50, 50, 50, 0.4);font-style:italic}.group{border:1px solid #e0e0e0;margin:5px 0}.group-text{padding:3px 9px 0 9px;word-break:break-all}.group-text-active{cursor:pointer}.group-count{padding-top:7px}.group-count-no-menu{padding-right:3px}.values-items-only{padding:6px 6px}.value{display:flex;padding:6px 0;justify-content:space-between;align-items:center}.value-part1{display:flex;width:-webkit-fill-available;width:-moz-available;align-items:center;margin:0 5px}.value-part2{display:flex}.group-handle,.class-handle{color:rgba(50, 50, 50, 0.4);cursor:grab;width:16px;display:flex}.group-handle-disabled,.class-handle-disabled{color:#e0e0e0;width:16px;display:flex}.value-symbol{margin:0 5px;padding:4px;cursor:pointer}.value-text{padding:0 9px;word-break:break-all;cursor:pointer}.value-count{padding:3px 3px 0 3px}.menu-placeholder{width:32px}.value-handle-placeholder{min-width:16px}.other{border:1px solid #e0e0e0}.default-value{border-bottom:1px solid #e0e0e0}.other-value-text{cursor:default}.symbol-styler-panel{width:328px;min-height:300px}.symbol-styler-div{width:100%}.avatar{background-color:#f0efef}.value-text:focus,.group-text:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}";const H=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeBackClick",7),this.arcgisSmartMappingPanelsTypeSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeClose",7),this.arcgisSmartMappingPanelsTypeSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeError",7),this.tileNodes=[],this.handleDone=()=>{(0,a.m)(),this.arcgisSmartMappingPanelsTypeSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e);break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>{t.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e);break}}},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{layer:e,modules:t}=a.s,i=(0,a.b)();this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,c.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{hideLayerTitle:t,isRTL:i,layer:l,mapImageSublayer:o,strings:n}=a.s,r=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:l.title;return(0,s.h)(s.H,{key:"2d86993fe73cfaeaecfb6e84631cfc7c15ca2129",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"ff4d87afb243b4f939da17880736fd8b6d81998b",class:{"flow-item":!0,[p.C.rtl]:i},closable:(0,a.F)(this.hostElement),heading:n.panels.styleOptions,description:r,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsTypeSizeBackClick.emit(),onCalciteFlowItemClose:this.handleDone},this.renderTypeTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderTypeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"type",selected:"type"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="type",this.handleOptionsClick("type")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("type"),ref:e=>{e&&(this.tileNodes.type=e)}})}renderSizeTile(){const e="type-size-age"===(0,a.a)()?"size-age":"size",t=(0,a.K)("size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${t}`,type:e,selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const e=(0,a.d)((0,a.b)(),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!e,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderRotation(){const e=(0,a.d)((0,a.b)(),"opacity"),t=(0,a.d)((0,a.b)(),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!e&&!!t,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{(0,a.l)(this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsTypeSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick].setFocus()))),300)}get hostElement(){return(0,s.d)(this)}};H.style=":host{width:100%}.flow-item{height:100%}"},59101:(e,t,i)=>{i.d(t,{w:()=>a});i(77040),i(70506);var s=i(82646);function a(e,t){const{layer:i,mapView:a,useFeatureReduction:o}=s.s;if(!o||!("featureReduction"in i)||"binning"!==i.featureReduction.type)return;const n=s.s.modules.reactiveUtils.watch((()=>a.scale),(()=>{const o=i.featureReduction;a.scale<=o.maxScale&&!e.disabled?((0,s.m)(),function(e,t){const i=document.createElement("arcgis-smart-mapping-scale-alert-popover");i.refElement=e,i.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{l(),t()})),document.body.append(i)}(e,t),(0,s.n)(e,!0)):a.scale>o.maxScale&&e.disabled&&(l(),(0,s.n)(e,!1),e.setFocus())}));return n}function l(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e),e=null}))}},75148:(e,t,i)=>{i.d(t,{a:()=>o,c:()=>l,g:()=>n});var s=i(1991),a=i(82646);i(70506);function l(e){var t;const{layer:i,useFeatureReduction:l,mapImageSublayer:o,mapView:n,modules:r}=a.s,d=i;e=e||{};const c=(0,a.p)((0,a.b)());return r.ColorCreator.createContinuousRenderer({layer:d,view:n,field:e.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,a.R)("above-and-below"),normalizationField:e.fieldInfos[1].field,outlineOptimizationEnabled:!o&&((0,s.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:(0,a.D)()),sizeOptimizationEnabled:!o&&(!(0,s.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(t=d.featureReduction)||void 0===t?void 0:t.type)&&l}).then((e=>(((0,a.J)(e.renderer,"color")||{}).style="ratio",(0,a.o)(c,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function o(e){var t,i,l,o;const{layer:r,useFeatureReduction:d,mapImageSublayer:c,mapView:h,modules:u}=a.s,p=r;e=e||{};const m=(0,a.b)(),g=(0,a.d)(m,"color");if(g&&e.fieldInfo&&e.fieldInfo.field==g.field&&e.normalizationField===g.normalizationField&&(delete e.fieldInfos,(0,a.V)(e)))return Promise.resolve({renderer:m.clone()});const b=(0,a.J)(m,"color"),v=(0,a.p)(m);let S=e.fieldInfos?e.fieldInfos[0]:g?{field:g.field,expression:g.valueExpression,expressionTitle:g.valueExpressionTitle,simpleFieldType:a.w.NUMBER}:{field:m.field,expression:m.valueExpression,expressionTitle:m.valueExpressionTitle,simpleFieldType:a.w.NUMBER};const f=e.normalizationField?e.normalizationField:g?g.normalizationField:m.normalizationField,y=m.classBreakInfos&&m.classBreakInfos.length?m.classBreakInfos[0].symbol:null,C=m.defaultSymbol,k=m.defaultLabel;let w=!1;(null===e.normalizationField||e.normalizationField||e.fieldInfo)&&(w=!0);const x=e.discardMinMax?void 0:(0,s.i)(e.min)?e.min:w?void 0:b?b.minSliderValue:m.classBreakInfos[0].minValue,N=e.discardMinMax?void 0:(0,s.i)(e.max)?e.max:w?void 0:b?b.maxSliderValue:m.classBreakInfos[m.classBreakInfos.length-1].maxValue;return u.ColorCreator.createContinuousRenderer({layer:p,view:h,field:S?S.field:m.field,theme:"above-and-below",colorScheme:(0,a.R)("above-and-below"),normalizationField:f,minValue:x,maxValue:N,outlineOptimizationEnabled:!c&&((0,s.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!v.sizeOutlineVisVar),sizeOptimizationEnabled:!c&&((0,s.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!v.sizeAutoVisVar),legendOptions:(null===(t=e.legendOptions)||void 0===t?void 0:t.toJSON())||(null===(i=null==g?void 0:g.legendOptions)||void 0===i?void 0:i.toJSON())||(null===(l=m.legendOptions)||void 0===l?void 0:l.toJSON()),defaultSymbolEnabled:(0,s.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!m.defaultSymbol,forBinning:"binning"===(null===(o=p.featureReduction)||void 0===o?void 0:o.type)&&d}).then((t=>{if(e.discardMinMax){const e=(0,a.d)(m,"color"),i=(0,a.d)(t.renderer,"color");e.stops.forEach(((e,t)=>e.value=i.stops[t].value));const s=!!b&&"percent"===b.style,l=!!b&&"percent-of-total"===b.style;e.stops[0].label=`< ${n(e.stops[0].value,s,l)}`,e.stops[2].label=`${n(e.stops[2].value,s,l)}`,e.stops[4].label=`> ${n(e.stops[4].value,s,l)}`}return((0,a.J)(t.renderer,"color")||{}).style="ratio",(0,a.o)(v,t.renderer),y&&t.renderer.classBreakInfos&&t.renderer.classBreakInfos.length&&(t.renderer.classBreakInfos[0].symbol=y),C&&(t.renderer.defaultSymbol=C,t.renderer.defaultLabel=k),Promise.resolve(t)}),(e=>Promise.reject(e)))}function n(e,t,i){return i?Math.round(e/(1+e)*1e4)/100+"%":t?Math.round(1e4*e)/100+"%":`${e}`}},89936:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>o,d:()=>n,u:()=>l});i(77040),i(70506);var s=i(82646);function a(e,t){e.labelFormatFunction=e=>r(e,t,"short-date"),e.inputFormatFunction=e=>r(e,t,"short-date"),e.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const s=new Date;i=e+(new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime())}else{i=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(i).toISOString()),i}(Date.parse(e),t)}function l(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(a).getTime()-6e4*s).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function o(e,t,i){let s;if(t&&"system"!==t)if("unknown"===t)s=new Date(e).toISOString();else{const i=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});s=new Date(new Date(a).getTime()-6e4*i).toISOString()}else{const t=(new Date).getTimezoneOffset();s=new Date(e-6e4*t).toISOString()}return s=i?s.substring(11,19):s.substring(11,16),s}function n(e,t){let i,s=new Date(e);if(s=new Date(s.getTime()-6e4*s.getTimezoneOffset()),t&&"system"!==t)if("unknown"===t)i=s.getTime();else{const e=new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime();i=s.getTime()+e}else{const e=(new Date).getTimezoneOffset();i=s.getTime()+6e4*e}return i}function r(e,t,i){const{modules:a}=s.s;let l;return l="unknown"===t?a.intl.formatDate(e,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(i||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):a.intl.formatDate(e,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(i||"short-date-short-time")),{timeZone:t})),l}},11246:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>u,c:()=>a,d:()=>s,e:()=>l,f:()=>c,g:()=>p,i:()=>o,m:()=>n,t:()=>r,u:()=>h});const s=(e,t)=>{let i,s="idle";const a=(...a)=>new Promise((l=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),l(e(...a))):l(null);break;case"invoked":clearTimeout(i),s="idle",l(e(...a));break;case"cancelled":clearTimeout(i),s="idle",l(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",l(e(...a)))),t)}}));return a.flush=function(...e){return s="flushed",a(...e)},a.invoke=function(...e){return s="invoked",a(...e)},a.cancel=function(...e){return s="cancelled",a(...e)},a.getStatus=function(){return s},a},a=(e,t)=>{let i;return(...s)=>new Promise((a=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,a(e(...s))}),t))}))};function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(e){return null!=e}async function n(e,t){return await Promise.all([e,r(t)]),e}function r(e){return new Promise((t=>setTimeout(t,e)))}const d=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function h(e,t){const i=[],s={};return e.forEach((e=>{const a=t(e);null==s[a]&&(s[a]=e,i.push(e))})),i}function u(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const p=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s)))},32118:(e,t,i)=>{i.d(t,{a:()=>l,b:()=>n,c:()=>a,u:()=>o});i(77040),i(70506);var s=i(82646);function a(e){var t;const{layer:i,mapView:a,modules:l}=s.s,o=i,n=(0,s.b)();return e=e||{},"heatmap"===(0,s.a)()&&(e.radius=e.radius||n.radius,e.heatmapScheme=e.heatmapScheme||(0,s.Z)()),(null===(t=e.fieldInfos)||void 0===t?void 0:t.length)&&(0,s.P)([e.fieldInfos[0].field]),l.HeatmapCreator.createRenderer({layer:o,view:a,field:e.fieldInfos&&e.fieldInfos.length?e.fieldInfos[0].field:null,radius:e.radius||10,heatmapScheme:e.heatmapScheme||void 0})}function l(e){var t;const{layer:i,mapView:a,modules:l}=s.s,o=i;e=e||{};const n=(0,s.b)(),r=n.authoringInfo;return l.HeatmapCreator.createRenderer({layer:o,view:a,field:e.fieldInfos&&e.fieldInfos.length?e.fieldInfos[0].field:n.field,fadeRatio:null!==(t=e.fadeRatio)&&void 0!==t?t:null==r?void 0:r.fadeRatio,radius:e.radius||n.radius||10,heatmapScheme:e.heatmapScheme||(0,s.Z)()})}function o(e){const{modules:t}=s.s,i=(0,s.b)();return t.HeatmapCreator.updateRenderer({renderer:i,fadeRatio:e})}function n(e){const{layer:t,mapView:i,modules:a}=s.s,l=t,o=(0,s.b)();return e=e||{},a.heatmapStatistics({layer:l,view:i,field:o.field,radius:e.radius||o.radius||10}).then((e=>(o.minDensity=e.min,o.maxDensity=e.max,Promise.resolve(e))),(e=>Promise.reject(e)))}},95875:(e,t,i)=>{let s,a;function l(e){e.loading=!1}function o(e,t){return function(e){e.loading=!0,a=!1,s&&clearTimeout(s),s=setTimeout((()=>{l(e),a=!0}),6e4)}(t),e.then((e=>(l(t),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(t),Promise.reject(e))))}i.d(t,{r:()=>o})},13521:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>o,g:()=>h,u:()=>l});var s=i(1991),a=i(82646);i(70506);function l(e){const{modules:t}=a.s,i=(0,a.b)(),l=t.esriLang.clone(i.classBreakInfos);i.classBreakInfos=[],l.forEach(((t,o)=>{t=function(e,t,i,l){if((0,s.i)(t))if(0===t);else if(t<1){const s=Math.round(1/t);e.minValue="first"===l?Math.floor(e.minValue/t)/s:Math.round(e.minValue/t)/s,e.maxValue="last"===l?Math.ceil(e.maxValue/t)/s:Math.round(e.maxValue/t)/s,e.label=`${i>0?"> ":""}${e.minValue.toLocaleString(a.s.fullLocale,{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(a.s.fullLocale,{maximumSignificantDigits:15})}`}else e.minValue="first"===l?Math.floor(e.minValue/t)*t:Math.round(e.minValue/t)*t,e.maxValue="last"===l?Math.ceil(e.maxValue/t)*t:Math.round(e.maxValue/t)*t,e.label=(i>0?"> ":"")+e.minValue.toLocaleString()+" - "+e.maxValue.toLocaleString();return e}(t,e,o,0===o?"first":o===l.length-1?"last":void 0),i.addClassBreakInfo({minValue:t.minValue,maxValue:t.maxValue,symbol:t.symbol,label:t.label})}))}function o(e){const t=(0,a.b)().classBreakInfos;let i=e,s=1/0;t.forEach((e=>{i||(i=Math.max(r(e.minValue),r(e.maxValue))),s=Math.min(s,e.maxValue-e.minValue)}));const l=[];return s>1e7?(l.push(1e7),l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01)):s>1e6?(l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01)):s>1e5?(l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01)):s>1e4?(l.push(1e4),l.push(1e3),l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01)):s>1e3?(l.push(1e3),l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01),i>3&&l.push(.001)):s>100?(l.push(100),l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01),i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5)):s>10?(l.push(10),i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01),i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6)):s>1?(i>0&&l.push(1),i>1&&l.push(.1),i>2&&l.push(.01),i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6)):s>.1?(i>1&&l.push(.1),i>2&&l.push(.01),i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6)):s>.01?(i>2&&l.push(.01),i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6)):s>.001?(i>3&&l.push(.001),i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6),i>7&&l.push(1e-7)):s>1e-4?(i>4&&l.push(1e-4),i>5&&l.push(1e-5),i>6&&l.push(1e-6),i>7&&l.push(1e-7),i>8&&l.push(1e-8)):s>1e-5&&(i>5&&l.push(1e-5),i>6&&l.push(1e-6),i>7&&l.push(1e-7),i>8&&l.push(1e-8),i>9&&l.push(1e-9)),l}function n(){const e=(0,a.b)();let t=1e10;return e.classBreakInfos.forEach((e=>{t=Math.min(t,d(e.minValue)),t=Math.min(t,d(e.maxValue))})),t}function r(e){let t=1;for(;Math.round(e*t)/t!==e;)t*=10;return Math.log(t)/Math.LN10}function d(e){let t=1e-8;for(;c(Math.round(e/t)*t)===e;)t*=10;return t/10}function c(e){return parseFloat(e.toPrecision(12))}function h(e){var t,i,a,l,o,n,d,h;let u=0;e.forEach((e=>{(0,s.i)(e.value)?u=Math.max(r(c(e.value)),u):((0,s.i)(e.minValue)&&(u=Math.max(r(c(e.minValue)),u)),(0,s.i)(e.maxValue)&&(u=Math.max(r(c(e.maxValue)),u)),(0,s.i)(e.min)&&(u=Math.max(r(c(e.min)),u)),(0,s.i)(e.max)&&(u=Math.max(r(c(e.max)),u)))})),u=Math.min(u,3);const p=e[0],m=e[e.length-1],g=Math.min(null!==(i=null!==(t=p.minValue)&&void 0!==t?t:p.min)&&void 0!==i?i:p.value,null!==(l=null!==(a=m.minValue)&&void 0!==a?a:m.min)&&void 0!==l?l:m.value),b=Math.max(null!==(n=null!==(o=p.maxValue)&&void 0!==o?o:p.max)&&void 0!==n?n:p.value,null!==(h=null!==(d=m.maxValue)&&void 0!==d?d:m.max)&&void 0!==h?h:m.value)-g;return b/e.length<2e-7?u=8:b/e.length<2e-6?u=7:b/e.length<2e-5?u=6:b/e.length<2e-4?u=5:b/e.length<.002?u=4:b/e.length<.02?u=3:b/e.length<.2?u=Math.max(u,2):b/e.length<2&&(u=Math.max(u,1)),Math.round(u)}},43025:(e,t,i)=>{i.d(t,{b:()=>a,u:()=>l});i(77040),i(70506);var s=i(82646);function a(e,t,i,s,a){const l=(null==e?void 0:e.length)?n(e,t.bins[s]):o(e.stops,t.bins[s]);l&&a.setAttribute("fill",l.toHex()),l&&a.setAttribute("opacity",`${Math.max(l.a,.2)}`),i.push(a)}function l(e,t,i,s){null==t||t.forEach(((t,a)=>{const l=(s||e.histogramConfig).bins[a],r=e.breaks?n(i||e.breaks,l):o((i||e).stops,l);r&&t.setAttribute("fill",r.toHex()),r&&t.setAttribute("opacity",`${Math.max(r.a,.2)}`)}))}function o(e,t){const{modules:i}=s.s;if(!t)return;const a=(t.maxValue-t.minValue)/2+t.minValue;let l=e[0],o=e[e.length-1];const n=l.value,r=o.value;if(a<n)return l.color;if(a>r)return o.color;const d=e.filter((e=>e.value===a));if(d.length>0)return d[0].color;l=null,o=null,e.forEach(((t,i)=>{!l&&!o&&t.value>=a&&(l=e[i-1],o=t)}));const c=(a-l.value)/(o.value-l.value);return i.esriColor.blendColors(l.color,o.color,c)}function n(e,t){if(!t)return;const i=(t.maxValue-t.minValue)/2+t.minValue;let s=e[0],a=e[e.length-1];if(i<s.min||i>a.max)return;const l=e.filter((e=>e.min===i));return l.length>0?l[0].color:(s=e[e.length-1],a=null,e.forEach(((t,l)=>{!a&&t.min>=i&&(s=e[l-1],a=t)})),s.color)}}}]);