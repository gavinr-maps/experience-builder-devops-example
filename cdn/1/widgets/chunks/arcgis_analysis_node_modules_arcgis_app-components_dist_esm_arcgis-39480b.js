/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-39480b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-39480b"],{1302:(e,i,s)=>{s.r(i),s.d(i,{arcgis_smart_mapping_color_slider:()=>c});var t=s(7263),o=(s(77040),s(70506),s(82646)),l=s(89936),a=s(95875),n=s(13521),r=s(43025),d=s(96432),u=s(75148),h=s(96533);s(99004),s(58233),s(28926),s(78613),s(62159),s(11935),s(1991),s(64391);const c=class{constructor(e){(0,t.r)(this,e),this.arcgisSmartMappingColorSliderChange=(0,t.c)(this,"arcgisSmartMappingColorSliderChange",7),this.arcgisSmartMappingColorSliderError=(0,t.c)(this,"arcgisSmartMappingColorSliderError",7),this.currentStopValues=[],this.currentBreakValues=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.histogramStatus=o.h.MISSING,this.statisticsStatus=o.h.MISSING,this.sliderZoomed=!1,this.cap=void 0}async updateStatistics(){var e;this.statisticsStatus=o.h.MISSING,this.statistics=null,this.histogramStatus=o.h.MISSING,this.histogram=null,null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}componentDidLoad(){this.flowItemNode=(0,o.f)(this.hostElement,"calcite-flow-item")}render(){const{config:e}=o.s;return(0,t.h)(t.H,{key:"f6d6a49b610b03f0491837072fda1986184cb4bf"},(0,t.h)("link",{key:"f696117b31ef2ce519076c89adede606ac4472c0",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,t.f)(this.hostElement)},onError:()=>{this.styleSheetStatus="failed",(0,t.f)(this.hostElement)}}),"loaded"===this.styleSheetStatus?this.renderColorSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSliderLoading():null)}renderColorSlider(){const{statisticsStatus:e,histogramStatus:i,sliderZoomed:s}=this,{strings:l}=o.s,a=(0,o.b)(),n=(0,o.d)(a,"color");if(!(e===o.h.FAILED||e===o.h.MISSING||n&&1===n.stops.length||!n&&1===a.classBreakInfos.length)){if(e===o.h.IN_PROGRESS||i===o.h.IN_PROGRESS&&!this.colorSlider)return this.renderColorSliderLoading();{const e=this.prepareColorSlider();let i=!1;if(n&&!s){const e=(0,o.J)(a,"color"),s=(0,o.aJ)(n.stops,null==e?void 0:e.minSliderValue,null==e?void 0:e.maxSliderValue);((null==s?void 0:s.minMaxSame)||!(0,o.O)(null==s?void 0:s.min)&&!(0,o.O)(null==s?void 0:s.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return n?this.currentStopValues=n.stops.map((e=>e.value)):this.currentBreakValues=a.classBreakInfos.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.colorSlider)&&this.colorSlider.min!==this.colorSlider.max?(0,t.h)("div",{class:"slider-box"},(0,t.h)("calcite-label",null,l.panels.color.dataRange),(0,t.h)("div",{class:"slider-box-buttons-front"},this.renderInvertButton(),n&&(0,t.h)(t.F,null,(0,t.h)("div",null,"\xa0"),this.renderZoomButton(i),(0,t.h)("div",null,"\xa0"),this.renderResetButton())),(0,t.h)("div",{ref:e=>{e&&this.afterColorSliderCreate(e)}})):this.colorSlider&&this.colorSlider.min===this.colorSlider.max?null:this.renderColorSliderLoading()}}this.colorSlider&&(this.colorSlider.destroy(),this.colorSlider=void 0)}renderColorSliderLoading(){const{strings:e}=o.s;return(0,t.h)("div",{class:"slider-box"},(0,t.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=o.s;return(0,t.h)("arcgis-smart-mapping-action",{text:e.panels.color.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:i}=o.s,{sliderZoomed:s}=this;return(0,t.h)("arcgis-smart-mapping-action",{text:i.panels.color.zoomSlider,icon:s?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>this.zoomButtonNode=e})}renderResetButton(){const{strings:e}=o.s;return(0,t.h)("arcgis-smart-mapping-action",{text:e.panels.color.resetSlider,icon:"undo",onClick:()=>this.handleResetSlider()})}prepareColorSlider(){var e,i;const{statistics:s,histogram:t,histogramStatus:a,sliderZoomed:u}=this,{mapView:h,modules:c}=o.s,m=(0,o.b)(),p=(0,o.a)(),S=["color-age","color-age-size"].indexOf(p)>-1,f=this.getFieldInfo().simpleFieldType===o.w.DATE,g=(0,o.d)(m,"color"),x=(0,o.J)(m,"color");let v,b,z;if(x?(v=(0,o.aI)(x.theme,g.stops),b=x.minSliderValue,z=x.maxSliderValue):(b=m.classBreakInfos[0].minValue,z=m.classBreakInfos[m.classBreakInfos.length-1].maxValue),({min:b,max:z}=(0,o.aG)({min:b,max:z})),a===o.h.IN_PROGRESS)return!1;if(!this.colorSlider||g&&this.colorSlider.breaks||!g&&this.colorSlider.stops){null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSliderBars=[];let i={histogramConfig:{bins:null==t?void 0:t.bins,average:Math.round(10*s.avg)/10,standardDeviation:s.stddev,standardDeviationCount:1},min:null!=b?b:s.min,max:null!=z?z:s.max};g?(i=Object.assign(Object.assign({},i),v),f&&!S&&(i.hasTimeData=!0,(0,l.a)(i,h.timeZone)),i.stops=g.stops,i.precision=(0,n.g)(g.stops),i.histogramConfig.barCreatedFunction=t&&r.b.bind(this,g,t,this.colorSliderBars),this.colorSlider=new c.ColorSlider(i),this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(i)):(i.histogramConfig.min=m.classBreakInfos[0].minValue,i.histogramConfig.max=m.classBreakInfos[m.classBreakInfos.length-1].maxValue,this.sliderZoomed=!1,i.breaks=(0,d.g)(),i.precision=(0,n.g)(i.breaks),i.histogramConfig.barCreatedFunction=t&&r.b.bind(this,i.breaks,t,this.colorSliderBars),this.colorSlider=new c.ClassedColorSlider(i),this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(i),(0,r.u)(this.colorSlider,this.colorSliderBars,i.breaks,t)),this.createColorSliderChangeEvents()}else{const e=this.colorSlider;if("dragging"===(null===(i=e.slider)||void 0===i?void 0:i.state))return!0;let a={histogramConfig:{bins:null==t?void 0:t.bins,average:Math.round(10*s.avg)/10,standardDeviation:s.stddev,standardDeviationCount:1},min:null!=b?b:s.min,max:null!=z?z:s.max};g?(a=Object.assign(Object.assign({},a),v),a.stops=g.stops,a.precision=(0,n.g)(g.stops),a.hasTimeData=f&&!S,f&&!S&&(0,l.a)(a,h.timeZone),u?this.zigzagClick||(a.zoomOptions=(0,o.aJ)(g.stops,null==x?void 0:x.minSliderValue,null==x?void 0:x.maxSliderValue)):a.zoomOptions=null,a.histogramConfig.barCreatedFunction=t&&r.b.bind(this,g,t,this.colorSliderBars),(0,r.u)(e,this.colorSliderBars,g,t)):(a.breaks=(0,d.g)(),a.precision=(0,n.g)(a.breaks),a.histogramConfig.barCreatedFunction=t&&r.b.bind(this,a.breaks,t,this.colorSliderBars),(0,r.u)(e,this.colorSliderBars,a.breaks,t)),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(a.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSlider.slider.min=a.zoomOptions.min,a.zoomOptions.min=null):(this.colorSlider.slider.max=a.zoomOptions.max,a.zoomOptions.max=null)),this.adjustedZoomOptions=null,this.zoomAdjustment=null,this.colorSlider.set(a),this.zigzagClick=!1}return(0,o.O)(this.colorSlider)}handleInvertSlider(){const{modules:e}=o.s,i=(0,o.b)(),s=(0,o.d)(i,"color");if((0,r.u)(this.colorSlider,this.colorSliderBars,s||(0,d.g)(),this.histogram),s){let e=s.stops.map((e=>e.color));e=e.reverse(),s.stops.forEach(((i,s)=>{i.color=e[s]}))}else{let s=i.classBreakInfos.map((i=>(0,o.Q)(i.symbol)||new e.esriColor({r:64,g:64,b:64,a:1})));s=s.reverse(),i.classBreakInfos.map(((e,i)=>{(0,o.Q)(e.symbol)&&(0,o.W)(e.symbol,s[i])}))}(0,o.u)(),(0,t.f)(this.hostElement),this.arcgisSmartMappingColorSliderChange.emit()}handleZoomSlider(e){var i,s,t,l;if(this.cap=this.colorSlider.slider.max,this.histogramStatus===o.h.IN_PROGRESS)return;const{statistics:a}=this,n=(0,o.b)();this.sliderZoomed=(0,o.O)(e)?e:!this.sliderZoomed;const r=(0,o.d)(n,"color");r||(this.sliderZoomed=!1);const d=(0,o.J)(n,"color"),u=this.sliderZoomed?(0,o.aJ)(r.stops,null!==(i=null==d?void 0:d.minSliderValue)&&void 0!==i?i:a.min,null!==(s=null==d?void 0:d.maxSliderValue)&&void 0!==s?s:a.max):null,h=(null==d?void 0:d.minSliderValue)===(null==d?void 0:d.maxSliderValue);this.getHistogram({field:r.field,expression:r.valueExpression,expressionTitle:r.valueExpressionTitle,simpleFieldType:o.w.NUMBER},r.normalizationField,a,u&&u.min||(h?a.min:null!==(t=d.minSliderValue)&&void 0!==t?t:a.min),u&&u.max||(h?a.max:null!==(l=d.maxSliderValue)&&void 0!==l?l:a.max))}handleResetSlider(){const e=(0,o.b)(),i=(0,o.a)();this.sliderZoomed=!1;let s=(0,o.d)(e,"color");const l=(0,o.J)(e,"color"),n=this.getFieldInfo(),r=s?s.normalizationField:e.normalizationField;let c;"color"===i?c=d.b:"color-age"===i?(n.field=l.field,c=d.d):"color-age-size"===i?(n.field=l.field,c=h.j):"color-size-age"===i?c=h.i:"color-size"===i?c=h.g:"compare"===i&&(c=u.a),(0,a.r)(c({fieldInfos:(0,o.k)(),normalizationField:r,noReuse:!0,discardMinMax:!0},"color"),this.flowItemNode).then((e=>{var i;if(0===(null===(i=e.statistics)||void 0===i?void 0:i.count)){const[i,s]=this.getDefaultDataRange(n),t=i,l=s;e.statistics.min=t,e.statistics.max=l,e.statistics.avg=(l+t)/2,this.statistics=e.statistics,this.statisticsStatus=o.h.SUCCESS}else e.statistics&&(0,o.O)(e.statistics.min)&&(0,o.O)(e.statistics.max)&&e.statistics.min<=e.statistics.max?(e.statistics=(0,o.aG)(e.statistics),this.statistics=e.statistics,this.statisticsStatus=o.h.SUCCESS,this.getHistogram(n,r,e.statistics,e.statistics.min,e.statistics.max)):this.statisticsStatus=o.h.FAILED;l.minSliderValue=this.statistics.min,l.maxSliderValue=this.statistics.max,(0,o.u)(),(0,t.f)(this.hostElement)}),(e=>this.arcgisSmartMappingColorSliderError.emit(e)))}afterColorSliderCreate(e){if(this.colorSlider.container)e.append(this.colorSlider.container);else{const i=document.createElement("div");i.classList.add("slider-container"),e.append(i),this.colorSlider.container=i}}getStatistics(){var e;const{layer:i,useFeatureReduction:s,mapView:t,modules:l}=o.s,a=i,n=(0,o.b)();let r,d;const u=this.getFieldInfo(),h=(0,o.d)(n,"color"),c=h?h.normalizationField:n.normalizationField,m=(0,o.J)(n,"color")||{};r=m.minSliderValue,d=m.maxSliderValue;const p=n.authoringInfo;if("equal-interval"===(null==p?void 0:p.classificationMethod)){const e=n.classBreakInfos;r=e[0].minValue,d=e[e.length-1].maxValue}this.statisticsStatus=o.h.IN_PROGRESS,this.statistics||l.summaryStatistics({layer:a,view:t,field:u.field,valueExpression:u.expression,normalizationField:c,forBinning:"featureReduction"in a&&"binning"===(null===(e=a.featureReduction)||void 0===e?void 0:e.type)&&s}).then((e=>{if(0===e.count){const[i,s]=this.getDefaultDataRange(u),t=m.minSliderValue||i,l=m.maxSliderValue||s;e.min=t,e.max=l,e.avg=(l+t)/2,(0,o.O)(m.minSliderValue)||(m.minSliderValue=t,m.maxSliderValue=l)}else if(!(0,o.O)(e.avg)||!(0,o.O)(e.min)||!(0,o.O)(e.max))return void(this.statisticsStatus=o.h.FAILED);e=(0,o.aG)(e),r=null!=r?r:e.min,d=null!=d?d:e.max,r===d&&(r=e.min,d=e.max),this.statistics=e,this.statisticsStatus=o.h.SUCCESS,this.getHistogram(u,c,e,r,d)}),(e=>{console.log(e),this.statisticsStatus=o.h.FAILED}))}getHistogram(e,i,s,t,l){var a;const{layer:n,useFeatureReduction:r,mapView:d,modules:u}=o.s,h=n;(s=s||this.statistics)&&0!==s.count&&(this.histogramStatus=o.h.IN_PROGRESS,u.histogram({layer:h,view:d,field:e.field,valueExpression:e.expression,numBins:50,minValue:(0,o.O)(t)?t:s.min,maxValue:(0,o.O)(l)?l:s.max,normalizationField:i,forBinning:"featureReduction"in h&&"binning"===(null===(a=h.featureReduction)||void 0===a?void 0:a.type)&&r}).then((e=>{this.histogram=e,this.histogramStatus=o.h.SUCCESS}),(e=>{console.log(e),this.histogramStatus=o.h.FAILED})))}onMinMaxChange(e,i,s){const{statistics:t}=this,l=(0,o.b)(),a=(0,o.d)(l,"color"),n=(0,o.J)(l,"color")||{};if(!a){let s=l.classBreakInfos[0],t=l.classBreakInfos[l.classBreakInfos.length-1];s.minValue=e,s.label=(0,o.aH)(s,this.colorSlider.precision),t.maxValue=i,t.label=`> ${(0,o.aH)(t,this.colorSlider.precision)}`}"min"===s?n.minSliderValue=e:n.maxSliderValue=i;const u=(0,o.aJ)(null==a?void 0:a.stops,n.minSliderValue,n.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!u||u.minMaxSame||!(0,o.O)(u.min)&&!(0,o.O)(u.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSlider.zoomOptions,"min"===s?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=i,this.zoomAdjustment="max"));const h=this.getFieldInfo(),c=a?a.normalizationField:l.normalizationField;this.getHistogram(h,c,t,e,i),(0,r.u)(this.colorSlider,this.colorSliderBars,a||(0,d.g)(),this.histogram),e===n.minSliderValue&&i===n.maxSliderValue&&(this.sliderZoomed=!1),l.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSliderChange.emit()}createColorSliderChangeEvents(){const e=(0,o.b)(),i=(0,o.d)(e,"color");this.colorSlider&&(this.colorSlider.watch("zoomOptions",((e,i)=>{this.sliderZoomed&&((null==i?void 0:i.min)&&!(null==e?void 0:e.min)||(null==i?void 0:i.max)&&!(null==e?void 0:e.max))&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.colorSlider.on("min-change",(e=>{i?e.value>this.currentStopValues[0]?(this.colorSlider.stops.forEach(((e,i)=>{e.value=this.currentStopValues[i]})),this.onMinMaxChange(this.currentStopValues[0],this.colorSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSlider.slider.max,"min"):e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.colorSlider.slider.max,"min"):this.onMinMaxChange(e.value,this.colorSlider.slider.max,"min")})),this.colorSlider.on("max-change",(e=>{i?e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.colorSlider.stops.forEach(((e,i)=>{e.value=this.currentStopValues[i]})),this.onMinMaxChange(this.colorSlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.colorSlider.slider.min,e.value,"max"):e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.colorSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min,"max"):this.onMinMaxChange(this.colorSlider.slider.min,e.value,"max")})),this.colorSlider.on("thumb-change",(e=>{if(i){const i=this.getFieldInfo();if((0,o.aO)(i)&&0===e.value)return void(0,t.f)(this.hostElement);const s=this.colorSlider.stops;this.updateRendererStops(s)}else this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("thumb-drag",(()=>{if(i){const e=this.colorSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("segment-drag",(()=>{if(i){const e=this.colorSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.colorSlider.breaks)})))}updateRendererStops(e){const i=(0,o.b)(),s=(0,o.d)(i,"color"),t=(0,o.J)(i,"color");s.stops=e,this.currentStopValues=s.stops.map((e=>e.value));const l=(0,o.aJ)(null==s?void 0:s.stops,null==t?void 0:t.minSliderValue,null==t?void 0:t.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!l||l.minMaxSame||!(0,o.O)(l.min)&&!(0,o.O)(l.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,(0,r.u)(this.colorSlider,this.colorSliderBars,s,this.histogram),(0,o.u)()}updateRendererBreaks(e){const i=(0,o.b)();i.authoringInfo.classificationMethod="manual",i.classBreakInfos.forEach(((i,s)=>{if(i.minValue!==e[s].min||i.maxValue!==e[s].max){i.minValue=e[s].min,i.maxValue=e[s].max;const t=s>0?"> ":"";i.label=`${t} ${(0,o.aH)(i,this.colorSlider.precision)}`,this.currentBreakValues[s].min=e[s].min,this.currentBreakValues[s].max=e[s].max}})),(0,r.u)(this.colorSlider,this.colorSliderBars,(0,d.g)(),this.histogram),(0,o.u)(),this.arcgisSmartMappingColorSliderChange.emit()}getDefaultDataRange(e){if(e.simpleFieldType===o.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const e=(0,o.b)(),i=(0,o.d)(e,"color"),s=(0,o.t)(i?i.field:e.field);return{field:(null==i?void 0:i.field)||e.field,expression:(null==i?void 0:i.valueExpression)||e.valueExpression,expressionTitle:(null==i?void 0:i.valueExpressionTitle)||e.valueExpressionTitle,simpleFieldType:s?s.simpleFieldType:o.w.NUMBER}}handleZigzagClick(e){var i,s;const{statistics:t}=this,l=(0,o.b)(),a=(0,o.d)(l,"color"),n=(0,o.J)(l,"color"),r=this.getFieldInfo(),d=a?a.normalizationField:l.normalizationField,u=n.minSliderValue===n.maxSliderValue;this.getHistogram(r,d,t,null!==(i=null==e?void 0:e.min)&&void 0!==i?i:u?t.min:n.minSliderValue,null!==(s=null==e?void 0:e.max)&&void 0!==s?s:u?t.max:n.maxSliderValue),e||(this.sliderZoomed=!1)}get hostElement(){return(0,t.d)(this)}};c.style=".slider-box{height:320px}.slider-box .esri-color-slider,.slider-box .esri-classed-color-slider{min-width:200px}.slider-box .esri-color-slider .esri-slider .esri-slider__content,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-color-slider__histogram-container,.slider-box .esri-classed-color-slider__histogram-container{width:85px}.slider-box .esri-color-slider .esri-slider .esri-slider__label,.slider-box .esri-color-slider .esri-slider .esri-slider__min,.slider-box .esri-color-slider .esri-slider .esri-slider__max,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__label,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__min,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-color-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-color-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-color-slider .esri-slider .esri-slider__max:hover,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-classed-color-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}.slider-container{overflow:hidden}"},75148:(e,i,s)=>{s.d(i,{a:()=>a,c:()=>l,g:()=>n});var t=s(1991),o=s(82646);s(70506);function l(e){var i;const{layer:s,useFeatureReduction:l,mapImageSublayer:a,mapView:n,modules:r}=o.s,d=s;e=e||{};const u=(0,o.p)((0,o.b)());return r.ColorCreator.createContinuousRenderer({layer:d,view:n,field:e.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,o.R)("above-and-below"),normalizationField:e.fieldInfos[1].field,outlineOptimizationEnabled:!a&&((0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:(0,o.D)()),sizeOptimizationEnabled:!a&&(!(0,t.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(i=d.featureReduction)||void 0===i?void 0:i.type)&&l}).then((e=>(((0,o.J)(e.renderer,"color")||{}).style="ratio",(0,o.o)(u,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function a(e){var i,s,l,a;const{layer:r,useFeatureReduction:d,mapImageSublayer:u,mapView:h,modules:c}=o.s,m=r;e=e||{};const p=(0,o.b)(),S=(0,o.d)(p,"color");if(S&&e.fieldInfo&&e.fieldInfo.field==S.field&&e.normalizationField===S.normalizationField&&(delete e.fieldInfos,(0,o.V)(e)))return Promise.resolve({renderer:p.clone()});const f=(0,o.J)(p,"color"),g=(0,o.p)(p);let x=e.fieldInfos?e.fieldInfos[0]:S?{field:S.field,expression:S.valueExpression,expressionTitle:S.valueExpressionTitle,simpleFieldType:o.w.NUMBER}:{field:p.field,expression:p.valueExpression,expressionTitle:p.valueExpressionTitle,simpleFieldType:o.w.NUMBER};const v=e.normalizationField?e.normalizationField:S?S.normalizationField:p.normalizationField,b=p.classBreakInfos&&p.classBreakInfos.length?p.classBreakInfos[0].symbol:null,z=p.defaultSymbol,V=p.defaultLabel;let I=!1;(null===e.normalizationField||e.normalizationField||e.fieldInfo)&&(I=!0);const M=e.discardMinMax?void 0:(0,t.i)(e.min)?e.min:I?void 0:f?f.minSliderValue:p.classBreakInfos[0].minValue,k=e.discardMinMax?void 0:(0,t.i)(e.max)?e.max:I?void 0:f?f.maxSliderValue:p.classBreakInfos[p.classBreakInfos.length-1].maxValue;return c.ColorCreator.createContinuousRenderer({layer:m,view:h,field:x?x.field:p.field,theme:"above-and-below",colorScheme:(0,o.R)("above-and-below"),normalizationField:v,minValue:M,maxValue:k,outlineOptimizationEnabled:!u&&((0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!g.sizeOutlineVisVar),sizeOptimizationEnabled:!u&&((0,t.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!g.sizeAutoVisVar),legendOptions:(null===(i=e.legendOptions)||void 0===i?void 0:i.toJSON())||(null===(s=null==S?void 0:S.legendOptions)||void 0===s?void 0:s.toJSON())||(null===(l=p.legendOptions)||void 0===l?void 0:l.toJSON()),defaultSymbolEnabled:(0,t.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!p.defaultSymbol,forBinning:"binning"===(null===(a=m.featureReduction)||void 0===a?void 0:a.type)&&d}).then((i=>{if(e.discardMinMax){const e=(0,o.d)(p,"color"),s=(0,o.d)(i.renderer,"color");e.stops.forEach(((e,i)=>e.value=s.stops[i].value));const t=!!f&&"percent"===f.style,l=!!f&&"percent-of-total"===f.style;e.stops[0].label=`< ${n(e.stops[0].value,t,l)}`,e.stops[2].label=`${n(e.stops[2].value,t,l)}`,e.stops[4].label=`> ${n(e.stops[4].value,t,l)}`}return((0,o.J)(i.renderer,"color")||{}).style="ratio",(0,o.o)(g,i.renderer),b&&i.renderer.classBreakInfos&&i.renderer.classBreakInfos.length&&(i.renderer.classBreakInfos[0].symbol=b),z&&(i.renderer.defaultSymbol=z,i.renderer.defaultLabel=V),Promise.resolve(i)}),(e=>Promise.reject(e)))}function n(e,i,s){return s?Math.round(e/(1+e)*1e4)/100+"%":i?Math.round(1e4*e)/100+"%":`${e}`}},89936:(e,i,s)=>{s.d(i,{a:()=>o,b:()=>a,d:()=>n,u:()=>l});s(77040),s(70506);var t=s(82646);function o(e,i){e.labelFormatFunction=e=>r(e,i,"short-date"),e.inputFormatFunction=e=>r(e,i,"short-date"),e.inputParseFunction=e=>function(e,i){if(!e)return e;let s;if(i&&"system"!==i)if("unknown"===i)s=e;else{const t=new Date;s=e+(new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime())}else{s=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(s).toISOString()),s}(Date.parse(e),i)}function l(e,i){let s;if(i&&"system"!==i)if("unknown"===i)s=new Date(e).toISOString();else{const t=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:i});s=new Date(new Date(o).getTime()-6e4*t).toISOString()}else{const i=(new Date).getTimezoneOffset();s=new Date(e-6e4*i).toISOString()}return s}function a(e,i,s){let t;if(i&&"system"!==i)if("unknown"===i)t=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:i});t=new Date(new Date(o).getTime()-6e4*s).toISOString()}else{const i=(new Date).getTimezoneOffset();t=new Date(e-6e4*i).toISOString()}return t=s?t.substring(11,19):t.substring(11,16),t}function n(e,i){let s,t=new Date(e);if(t=new Date(t.getTime()-6e4*t.getTimezoneOffset()),i&&"system"!==i)if("unknown"===i)s=t.getTime();else{const e=new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime();s=t.getTime()+e}else{const e=(new Date).getTimezoneOffset();s=t.getTime()+6e4*e}return s}function r(e,i,s){const{modules:o}=t.s;let l;return l="unknown"===i?o.intl.formatDate(e,Object.assign(Object.assign({},o.intl.convertDateFormatToIntlOptions(s||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):o.intl.formatDate(e,Object.assign(Object.assign({},o.intl.convertDateFormatToIntlOptions(s||"short-date-short-time")),{timeZone:i})),l}},95875:(e,i,s)=>{let t,o;function l(e){e.loading=!1}function a(e,i){return function(e){e.loading=!0,o=!1,t&&clearTimeout(t),t=setTimeout((()=>{l(e),o=!0}),6e4)}(i),e.then((e=>(l(i),o?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(i),Promise.reject(e))))}s.d(i,{r:()=>a})},13521:(e,i,s)=>{s.d(i,{a:()=>n,b:()=>a,g:()=>h,u:()=>l});var t=s(1991),o=s(82646);s(70506);function l(e){const{modules:i}=o.s,s=(0,o.b)(),l=i.esriLang.clone(s.classBreakInfos);s.classBreakInfos=[],l.forEach(((i,a)=>{i=function(e,i,s,l){if((0,t.i)(i))if(0===i);else if(i<1){const t=Math.round(1/i);e.minValue="first"===l?Math.floor(e.minValue/i)/t:Math.round(e.minValue/i)/t,e.maxValue="last"===l?Math.ceil(e.maxValue/i)/t:Math.round(e.maxValue/i)/t,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString(o.s.fullLocale,{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(o.s.fullLocale,{maximumSignificantDigits:15})}`}else e.minValue="first"===l?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===l?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=(s>0?"> ":"")+e.minValue.toLocaleString()+" - "+e.maxValue.toLocaleString();return e}(i,e,a,0===a?"first":a===l.length-1?"last":void 0),s.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function a(e){const i=(0,o.b)().classBreakInfos;let s=e,t=1/0;i.forEach((e=>{s||(s=Math.max(r(e.minValue),r(e.maxValue))),t=Math.min(t,e.maxValue-e.minValue)}));const l=[];return t>1e7?(l.push(1e7),l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01)):t>1e6?(l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01)):t>1e5?(l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01)):t>1e4?(l.push(1e4),l.push(1e3),l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01)):t>1e3?(l.push(1e3),l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01),s>3&&l.push(.001)):t>100?(l.push(100),l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01),s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5)):t>10?(l.push(10),s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01),s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6)):t>1?(s>0&&l.push(1),s>1&&l.push(.1),s>2&&l.push(.01),s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6)):t>.1?(s>1&&l.push(.1),s>2&&l.push(.01),s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6)):t>.01?(s>2&&l.push(.01),s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6)):t>.001?(s>3&&l.push(.001),s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6),s>7&&l.push(1e-7)):t>1e-4?(s>4&&l.push(1e-4),s>5&&l.push(1e-5),s>6&&l.push(1e-6),s>7&&l.push(1e-7),s>8&&l.push(1e-8)):t>1e-5&&(s>5&&l.push(1e-5),s>6&&l.push(1e-6),s>7&&l.push(1e-7),s>8&&l.push(1e-8),s>9&&l.push(1e-9)),l}function n(){const e=(0,o.b)();let i=1e10;return e.classBreakInfos.forEach((e=>{i=Math.min(i,d(e.minValue)),i=Math.min(i,d(e.maxValue))})),i}function r(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function d(e){let i=1e-8;for(;u(Math.round(e/i)*i)===e;)i*=10;return i/10}function u(e){return parseFloat(e.toPrecision(12))}function h(e){var i,s,o,l,a,n,d,h;let c=0;e.forEach((e=>{(0,t.i)(e.value)?c=Math.max(r(u(e.value)),c):((0,t.i)(e.minValue)&&(c=Math.max(r(u(e.minValue)),c)),(0,t.i)(e.maxValue)&&(c=Math.max(r(u(e.maxValue)),c)),(0,t.i)(e.min)&&(c=Math.max(r(u(e.min)),c)),(0,t.i)(e.max)&&(c=Math.max(r(u(e.max)),c)))})),c=Math.min(c,3);const m=e[0],p=e[e.length-1],S=Math.min(null!==(s=null!==(i=m.minValue)&&void 0!==i?i:m.min)&&void 0!==s?s:m.value,null!==(l=null!==(o=p.minValue)&&void 0!==o?o:p.min)&&void 0!==l?l:p.value),f=Math.max(null!==(n=null!==(a=m.maxValue)&&void 0!==a?a:m.max)&&void 0!==n?n:m.value,null!==(h=null!==(d=p.maxValue)&&void 0!==d?d:p.max)&&void 0!==h?h:p.value)-S;return f/e.length<2e-7?c=8:f/e.length<2e-6?c=7:f/e.length<2e-5?c=6:f/e.length<2e-4?c=5:f/e.length<.002?c=4:f/e.length<.02?c=3:f/e.length<.2?c=Math.max(c,2):f/e.length<2&&(c=Math.max(c,1)),Math.round(c)}},64391:(e,i,s)=>{s.d(i,{a:()=>l,b:()=>a,g:()=>n,s:()=>r});var t=s(1991),o=s(82646);s(70506);function l(){const{mapView:e}=o.s,i=(0,o.b)(),s=i.authoringInfo,l="class-breaks"===i.type?i.classBreakInfos:i.uniqueValueInfos,a=(0,o.d)(i,"size"),n=(0,o.J)(i,"reference-size"),d=!!a&&!(0,t.i)(a.minSize),u=!!a&&"number"==typeof a.minSize,h="above-and-below"===(null==s?void 0:s.univariateTheme);let c=2,m=20;if(n)n.referenceSizeScale&&r(),[c,m]=[n.sizeStops[0].size,n.sizeStops[1].size];else if(a)if(h){const e=a.stops;[c,m]=[e[2].size,Math.max(e[0].size,e[4].size)]}else if(d){const e=a.stops;[c,m]=[e[0].size,e[e.length-1].size]}else if(u)[c,m]=[a.minSize,a.maxSize];else{const i=e.scale,s=a.minSize.stops,t=a.maxSize.stops;[c,m]=[s[s.length-1].size,t[t.length-1].size];for(let e=0;e<s.length;e++){const o=s[e],l=t[e];if(i<=o.value){if(e>0){let a=s[e-1],n=t[e-1];const r=(i-a.value)/(o.value-a.value);[c,m]=[a.size+(o.size-a.size)*r,n.size+(l.size-n.size)*r]}else[c,m]=[s[0].size,t[0].size];break}}}else if(l){const e=l[0].symbol,i=l[l.length-1].symbol;[c,m]=[(0,o.X)(e),(0,o.X)(i)],c>m&&([c,m]=[m,c])}return[c,m]}function a(e){const{mapView:i,modules:s}=o.s,a=(0,o.b)(),n=(0,o.d)(a,"size");let r=e[0],d=(0,t.i)(e[1])?e[1]:r;if(n){const o=a.authoringInfo,u="above-and-below"===(null==o?void 0:o.univariateTheme),h=!!n&&!(0,t.i)(n.minSize),c=!!n&&"number"==typeof n.minSize;let[m,p]=l();const S=m>p;if(!S&&r>=p?r=p-.75:S&&r>=m&&(r=m-.75),!S&&m>=d?d=m+.75:S&&p>=d&&(d=p+.75),u){const i=n.stops,s=S?e[1]:e[0],t=S?e[0]:e[1],o=Math.max(...i.map((e=>e.value))),l=i[2].value,a=Math.min(...i.map((e=>e.value))),r=Math.abs(o-l),d=Math.abs(a-l),u=r>d?r:d,h=t-s;i.forEach((e=>{const{value:i}=e;e.size=Math.abs(i-l)/u*h+s}))}else if(h){const e=n.stops;n.stops=null,n.minSize=r,n.maxSize=d,n.minDataValue=e[0].value,n.maxDataValue=e[e.length-1].value}else if(c)S?(n.maxSize=r,n.minSize=d):(n.minSize=r,n.maxSize=d);else{const e=i.scale;let t=s.esriLang.clone(n.minSize.stops),o=s.esriLang.clone(n.maxSize.stops);S&&([t,o]=[o,t]);let l=r/t[t.length-1].size,a=d/o[o.length-1].size;for(let i=0;i<t.length;i++){const s=t[i],n=o[i];if(e<=s.value){if(i>0){let u=t[i-1],h=o[i-1];const c=(e-u.value)/(s.value-u.value),[m,p]=[u.size+(s.size-u.size)*c,h.size+(n.size-h.size)*c];l=r/m,a=d/p}else l=r/t[0].size,a=d/o[0].size;break}}t.forEach((e=>e.size=Math.round(l*e.size*10)/10)),o.forEach((e=>e.size=Math.round(a*e.size*10)/10)),S&&([t,o]=[o,t]),n.minSize.stops=t,n.maxSize.stops=o}}else{const e=a.classBreakInfos[0].symbol,i=a.classBreakInfos[a.classBreakInfos.length-1].symbol;let s=(0,o.X)(e),t=(0,o.X)(i),l=!1;s>t&&([s,t]=[t,s],l=!0),s!==t&&r>t&&(r=t-.75),s=r,s!==t&&s>d&&(d=s+.75),t=d;const n=1===a.classBreakInfos.length?1:Math.max(t-s,10)/(a.classBreakInfos.length-1);a.classBreakInfos.forEach(((e,i)=>{const a=e.symbol;l?(0,o.Y)(a,t-n*i):(0,o.Y)(a,s+n*i)}))}}function n(e,i){const s=e.stops,t=s.length-1,o=s[0].value,l=s[t].value;if(i<=o)return s[0].size;if(i>=l)return s[t].size;for(let e=0;e<=t;e++){const t=s[e],o=s[e+1];if(i>=t.value&&i<o.value){const e=o.value-t.value,s=t.size-o.size,l=(i-t.value)/e,a=t.size-s*l;return Math.round(100*a)/100}}return 1}function r(){const{mapView:e}=o.s,i=(0,o.b)(),s=(0,o.J)(i,"reference-size"),t=s.referenceSizeScale/e.scale;s.sizeStops.forEach((e=>e.size*=t)),s.referenceSizeScale=e.scale}},43025:(e,i,s)=>{s.d(i,{b:()=>o,u:()=>l});s(77040),s(70506);var t=s(82646);function o(e,i,s,t,o){const l=(null==e?void 0:e.length)?n(e,i.bins[t]):a(e.stops,i.bins[t]);l&&o.setAttribute("fill",l.toHex()),l&&o.setAttribute("opacity",`${Math.max(l.a,.2)}`),s.push(o)}function l(e,i,s,t){null==i||i.forEach(((i,o)=>{const l=(t||e.histogramConfig).bins[o],r=e.breaks?n(s||e.breaks,l):a((s||e).stops,l);r&&i.setAttribute("fill",r.toHex()),r&&i.setAttribute("opacity",`${Math.max(r.a,.2)}`)}))}function a(e,i){const{modules:s}=t.s;if(!i)return;const o=(i.maxValue-i.minValue)/2+i.minValue;let l=e[0],a=e[e.length-1];const n=l.value,r=a.value;if(o<n)return l.color;if(o>r)return a.color;const d=e.filter((e=>e.value===o));if(d.length>0)return d[0].color;l=null,a=null,e.forEach(((i,s)=>{!l&&!a&&i.value>=o&&(l=e[s-1],a=i)}));const u=(o-l.value)/(a.value-l.value);return s.esriColor.blendColors(l.color,a.color,u)}function n(e,i){if(!i)return;const s=(i.maxValue-i.minValue)/2+i.minValue;let t=e[0],o=e[e.length-1];if(s<t.min||s>o.max)return;const l=e.filter((e=>e.min===s));return l.length>0?l[0].color:(t=e[e.length-1],o=null,e.forEach(((i,l)=>{!o&&i.min>=s&&(t=e[l-1],o=i)})),t.color)}}}]);