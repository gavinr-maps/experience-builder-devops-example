/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b2b1f4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b2b1f4"],{49640:(e,i,t)=>{t.r(i),t.d(i,{arcgis_smart_mapping_age:()=>y,arcgis_smart_mapping_classify:()=>z,arcgis_smart_mapping_divided_by:()=>x,arcgis_smart_mapping_info_popover:()=>I,arcgis_smart_mapping_panels_size:()=>C,arcgis_smart_mapping_size_range_slider:()=>N,arcgis_smart_mapping_size_slider:()=>k,arcgis_smart_mapping_symbol_pair_button:()=>M,arcgis_smart_mapping_symbol_pair_popover:()=>V,arcgis_smart_mapping_tile:()=>P});var s=t(7263),a=(t(77040),t(70506),t(82646)),l=t(89936),n=t(95875),o=t(96432),r=t(96533),d=t(86749),c=t(11246),h=t(13521),u=t(12234),m=t(93143),p=t(90367),g=t(59101),f=t(58233),S=t(64391),b=t(99680),v=t(39062);t(99004),t(62159),t(78613),t(11935),t(1991),t(28926),t(64164),t(75002);const y=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingAgeChange=(0,s.c)(this,"arcgisSmartMappingAgeChange",7),this.arcgisSmartMappingAgeError=(0,s.c)(this,"arcgisSmartMappingAgeError",7),this.rendererSubtype=void 0}componentWillLoad(){const{fields:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),s=e.filter((e=>e.simpleFieldType===a.w.DATE&&e.layerField.name===t.field));this.restDateFields=e.filter((e=>e.simpleFieldType===a.w.DATE&&e!==s[0])),this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}render(){return(0,s.h)(s.H,{key:"9a4d71b271ac184825c90c77eb46af4dc624c564"},this.renderFrom(),this.renderTo(),this.renderUnits())}renderFrom(){const{strings:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{field:l,startTime:n}=t;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,e.age.from),(0,s.h)("div",{class:"from-field"},l===n?this.rendererStaticField():this.rendererAgeField()))}renderTo(){const{strings:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{field:l,endTime:n}=t;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"to-flip-wrapper"},(0,s.h)("div",{class:"to-label"},e.age.to),(0,s.h)("arcgis-smart-mapping-action",{hasOutline:!1,text:e.age.flip,icon:"arrowUpDown",onClick:()=>this.handleFlip()}))),(0,s.h)("div",{class:"to-field"},l===n?this.rendererStaticField():this.rendererAgeField()))}rendererStaticField(){const e=(0,a.b)(),i="color"===this.rendererSubtype?(0,a.J)(e,"color"):(0,a.J)(e,"size"),t=(0,a.t)(i.field);return(0,s.h)("div",{class:"field-select-fixed"},null==t?void 0:t.label)}rendererAgeField(){var e,i;const{strings:t}=a.s,l=(0,a.b)(),n="color"===this.rendererSubtype?(0,a.J)(l,"color"):(0,a.J)(l,"size"),{field:o,startTime:r,endTime:d}=n,c=r===o?d:r,h="string"==typeof c,u=(null===(e=this.restDateFields[0])||void 0===e?void 0:e.layerField.alias)||(null===(i=this.restDateFields[0])||void 0===i?void 0:i.layerField.name);let m;return h&&(m={field:c,simpleFieldType:a.w.DATE}),(0,s.h)("div",null,this.restDateFields.length?(0,s.h)("calcite-radio-button-group",{class:"variable-field-radio",name:"variableType",onCalciteRadioButtonGroupChange:e=>this.handleTypeChange(e.target.selectedItem.value)},(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{key:h?`age-variable-radio-field-${Math.random()}`:void 0,checked:h,value:"field"}),t.age.field),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{key:h?void 0:`age-variable-radio-date-${Math.random()}`,checked:!h,value:"date"}),t.age.customDate)):null,h?this.restDateFields.length>1?(0,s.h)("arcgis-smart-mapping-attribute-input",{fieldList:this.restDateFields,selectedField:m,mode:"simple",hideLabel:!0,popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const i=e.detail.field;this.createRendererUpdateCall(o===r?{endTime:i}:{startTime:i})}},ref:e=>{e&&(this.rendererAgeFieldNode=e)}}):(0,s.h)("div",{class:"field-select-fixed"},u):this.rendererAgeFieldDate())}renderUnits(){const{strings:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{units:l}=t;return(0,s.h)("calcite-label",{class:"units-label"},e.age.units,(0,s.h)("calcite-select",{class:"units-select",width:"full",label:e.age.units,onCalciteSelectChange:e=>this.handleUnitChange(e),value:l,ref:e=>this.unitsNode=e},(0,s.h)("calcite-option",{value:"seconds",label:e.age.seconds,selected:"seconds"===l}),(0,s.h)("calcite-option",{value:"minutes",label:e.age.minutes,selected:"minutes"===l}),(0,s.h)("calcite-option",{value:"hours",label:e.age.hours,selected:"hours"===l}),(0,s.h)("calcite-option",{value:"days",label:e.age.days,selected:"days"===l}),(0,s.h)("calcite-option",{value:"months",label:e.age.months,selected:"months"===l}),(0,s.h)("calcite-option",{value:"years",label:e.age.years,selected:"years"===l})))}rendererAgeFieldDate(){const{mapView:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{units:n,field:o,startTime:r,endTime:d}=t,h=r===o?d:r,u="string"==typeof h,m=u?void 0:(0,l.u)(h,e.timeZone),p=["seconds","minutes","hours"].indexOf(n)>-1,g=!u&&p?(0,l.b)(h,e.timeZone,"seconds"===n):void 0;return(0,s.h)(s.F,null,(0,s.h)("calcite-input-date-picker",{scale:"s",value:m,class:"variable-date-date",ref:e=>{e&&(this.datePickerNode=e)},onCalciteInputDatePickerChange:()=>this.handleDateChange()}),p?(0,s.h)("calcite-input-time-picker",{key:`${n}-${h}`,step:"seconds"===n?1:60,scale:"s",value:g,class:"variable-date-time",ref:e=>{e&&(this.timePickerNode=e)},onCalciteInputTimePickerChange:(0,c.d)((()=>{this.timePickerNode.open=!1,this.handleTimeChange()}),750)}):null)}createRendererUpdateCall(e){const i=(0,a.a)();let t;t="color-age"===i?o.d:"size-age"===i?r.h:"color-age-size"===i?r.j:"color-size-age"===i?r.i:d.d,(0,n.r)(t(e,this.rendererSubtype),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.arcgisSmartMappingAgeChange.emit()}),(e=>{this.rendererAgeFieldNode&&(0,s.f)(this.rendererAgeFieldNode);const{mapView:i}=a.s,t=(0,a.b)(),n="color"===this.rendererSubtype?(0,a.J)(t,"color"):(0,a.J)(t,"size"),{units:o,field:r,startTime:d,endTime:c}=n,h=d===r?c:d,u="string"==typeof h,m=["seconds","minutes","hours"].indexOf(o)>-1,p=u?void 0:(0,l.u)(h,i.timeZone),g=!u&&m?(0,l.b)(h,i.timeZone,"seconds"===o):void 0;this.datePickerNode&&(this.datePickerNode.value=p),this.timePickerNode&&(this.timePickerNode.value=g),this.unitsNode.value=o,(0,s.f)(this.hostElement),this.arcgisSmartMappingAgeError.emit(e)}))}handleUnitChange(e){const i={units:e.target.selectedOption.value};this.createRendererUpdateCall(i)}handleTypeChange(e){const i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{field:s,startTime:l}=t,n="field"===e?this.restDateFields[0].layerField.name:(new Date).getTime();this.createRendererUpdateCall(s===l?{endTime:n}:{startTime:n})}handleDateChange(){var e;const{mapView:i}=a.s,t=(0,a.b)(),s="color"===this.rendererSubtype?(0,a.J)(t,"color"):(0,a.J)(t,"size"),n=this.datePickerNode.value;if(!n)return;const o=(null===(e=this.timePickerNode)||void 0===e?void 0:e.value)||"00:00:00",r=(0,l.d)(`${n}T${o}`,i.timeZone),{field:d,startTime:c}=s,h={};d===c?h.endTime=r:h.startTime=r,this.createRendererUpdateCall(h)}handleTimeChange(){const{mapView:e}=a.s,i=(0,a.b)(),t="color"===this.rendererSubtype?(0,a.J)(i,"color"):(0,a.J)(i,"size"),{field:s,startTime:n}=t;let o=this.timePickerNode.value;const r=this.datePickerNode.value,d=(0,l.d)(`${r}T${o}`,e.timeZone),c={};s===n?c.endTime=d:c.startTime=d,this.createRendererUpdateCall(c)}handleFlip(){const e=(0,a.b)(),i="color"===this.rendererSubtype?(0,a.J)(e,"color"):(0,a.J)(e,"size"),{startTime:t,endTime:s}=i,l={startTime:s,endTime:t};this.createRendererUpdateCall(l),this.createRendererUpdateCall(l)}get hostElement(){return(0,s.d)(this)}};y.style=".field-select-fixed{background-color:#f6f6f6;padding:6px 6px;justify-content:space-between;align-items:center;color:#333333;margin:0;transition:box-shadow 250ms ease-in-out;box-shadow:0 0 0 1px #e0e0e0;height:auto;line-height:1.25;overflow-wrap:anywhere}.variable-date-date{width:100%}.variable-date-time{width:100%;margin-top:5px}.variable-field-radio{display:flex;justify-content:space-between}.to-flip-wrapper{display:flex;justify-content:space-between}.to-label{display:flex;align-items:center;margin-top:10px}.units-label{margin-top:6px}.to-field{margin-top:-10px}.from-field{margin-top:-8px;margin-bottom:6px}.units-select{margin-bottom:10px}";const z=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingClassifyChange=(0,s.c)(this,"arcgisSmartMappingClassifyChange",7),this.arcgisSmartMappingClassifyError=(0,s.c)(this,"arcgisSmartMappingClassifyError",7),this.inputNodes=[],this.labelNodes=[],this.symbolNodes=[],this.popoversOpen=!1,this.disconnected=!1}componentWillLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}disconnectedCallback(){this.disconnected=!0,clearTimeout(this.classesChangeHandle)}render(){const{strings:e,mapImageSublayer:i,supportsArcade:t}=a.s,l=(0,a.b)(),n=(0,a.d)(l,"color"),o=(0,a.d)(l,"size"),r=n||o;return(0,s.h)("calcite-block-section",{key:"ec68395614bad9453110cb9ddd4623ed53d245ae",class:"classify-block-section",text:e.classify.classifyData,open:!r,toggleDisplay:i&&!t?"button":"switch",ref:e=>{this.classifyBlockSectionNode=e,i&&!t||e.addEventListener("calciteBlockSectionToggle",(e=>{e.stopImmediatePropagation(),this.handleClassifyToggle(e)}))}},(0,s.h)("div",{key:"980ecdc7075d7221b837121dd5d50e7285a78e99",class:"block-section-padding"},!r&&this.renderMethod(),!r&&this.renderClasses(),!r&&this.renderStdDev(),!r&&this.renderRoundClasses(),!r&&this.renderValues()))}renderMethod(){const e=(0,a.b)(),i=(0,a.a)();return(0,s.h)("arcgis-smart-mapping-method-button",{key:e.authoringInfo.classificationMethod,showStdDev:!0,onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingMethodButtonChange:e=>{const t=e.target;this.precisionValue=null;const l=(0,a.b)();if("manual"===e.detail){const e=l.authoringInfo;"standard-deviation"===e.classificationMethod&&l.classBreakInfos.forEach(((e,i)=>{const t=i>0?"> ":"";e.label=`${t} ${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`})),e.classificationMethod="manual",(0,a.u)(),(0,s.f)(this.hostElement),setTimeout((()=>this.methodButtonNode.setFocus()),300)}else{const l="color"===i?o.e:r.k;(0,n.r)(l({classificationMethod:e.detail}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.arcgisSmartMappingClassifyChange.emit(),setTimeout((()=>this.methodButtonNode.setFocus()),300)}),(e=>{(0,s.f)(t),this.arcgisSmartMappingClassifyError.emit(e)}))}},ref:e=>{e&&(this.methodButtonNode=e)}})}renderClasses(){const{strings:e}=a.s,i=(0,a.b)(),t=i.classBreakInfos.length;return"standard-deviation"===i.authoringInfo.classificationMethod?null:(0,s.h)("calcite-label",null,e.classify.classifyClasses,(0,s.h)("calcite-input-number",{value:`${t}`,min:1,max:10,step:1,scale:"s",onCalciteInputNumberInput:(0,c.d)((()=>{if(this.disconnected)return;clearTimeout(this.classesChangeHandle);const e=parseInt(this.classesNode.value);e!==t&&(!e||e<this.classesNode.min||e>this.classesNode.max?this.classesChangeHandle=setTimeout((()=>this.handleClassesChange()),3e3):this.handleClassesChange())}),300),ref:e=>{e&&(this.classesNode=e)}}))}renderStdDev(){const{strings:e}=a.s,i=(0,a.b)().authoringInfo,t=i.standardDeviationInterval||1;return"standard-deviation"!==i.classificationMethod?null:(0,s.h)("calcite-label",null,e.classify.classifyStdDevIntervals,(0,s.h)("calcite-select",{width:"full",role:"button",label:e.classify.classifyStdDevIntervals,onCalciteSelectChange:e=>this.handleStdDevChange(e),value:`${t}`,ref:e=>this.stdDevSelectNode=e},(0,s.h)("calcite-option",{value:"0.5",label:"0.5",selected:.5===t}),(0,s.h)("calcite-option",{value:"1",label:"1",selected:1===t})))}renderRoundClasses(){var e,i,t;const{strings:l,locale:n}=a.s;if("standard-deviation"===(0,a.b)().authoringInfo.classificationMethod)return null;const o=(0,h.a)(),r=(0,s.h)("calcite-option",{value:"select",label:l.classify.selectAnOption});this.precisionValue||(this.precisionValue=null!==(i=null===(e=o.toString().split(".")[1])||void 0===e?void 0:e.length)&&void 0!==i?i:null===(t=o.toFixed(20).toString().split(".")[1])||void 0===t?void 0:t.length);const d=(0,h.b)(this.precisionValue).map((e=>(0,s.h)("calcite-option",{value:`${e}`,label:`${e.toLocaleString(n,{maximumSignificantDigits:15})}`,disabled:o>=e,selected:o===e})));return(0,s.h)("calcite-label",null,l.classify.classifyRoundClasses,(0,s.h)("calcite-select",{width:"full",label:l.classify.classifyRoundClasses,onCalciteSelectChange:e=>this.handleRoundClassesChange(e)},[r,...d]))}renderValues(){const e=(0,a.b)();return this.labelNodes=[],this.inputNodes=[],(0,s.h)("calcite-list",null,e.classBreakInfos.map(((e,i)=>this.renderValue(e,i))).reverse())}renderValue(e,i){return(0,s.h)("calcite-list-item",null,(0,s.h)("div",{class:"symbol-container",slot:"actions-start"},this.renderSymbolNode(e,i)),this.renderTextNode(e,i))}renderSymbolNode(e,i){const{strings:t}=a.s;let l=(0,a.b)().classBreakInfos[i].symbol.clone();const n={"symbol-is-white":(0,a.ai)(l),symbol:!0};return(0,s.h)("div",{class:n,tabindex:"0","aria-label":t.classify.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true",ref:e=>{e&&this.symbolNodes.unshift(e)},onClick:()=>{this.popoverNode?(this.symbolNodes[this.selectedPopoverIdx].classList.remove("selected"),this.selectedPopoverIdx===i?((0,a.m)(),this.popoverNode=null,this.selectedPopoverIdx=null):(this.selectedPopoverIdx=i,this.handleValueSymbolClick(i))):(this.selectedPopoverIdx=i,this.handleValueSymbolClick(i))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(i))}},(0,s.h)("div",{ref:e=>{e&&this.afterCreateValueSymbol(e,i)}}))}renderTextNode(e,i){const{strings:t}=a.s;return(0,s.h)(s.F,null,(0,s.h)("div",{class:"label",slot:"content",tabindex:"0",ref:e=>{e&&this.labelNodes.unshift(e)},"aria-label":t.classify.accessibility.editLabelFor.replace("${value}",e.label),onClick:e=>this.handleLabelEdit(i,e),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleLabelEdit(i,e)}},e.label),(0,s.h)("calcite-input",{slot:"content",class:"hidden",scale:"s",ref:e=>{e&&this.inputNodes.unshift(e)},value:e.label,onCalciteInputChange:e=>{this.inputNodes[i].classList.add("hidden"),this.labelNodes[i].classList.remove("hidden"),this.handleValueTextChange(i,e)},onFocusout:e=>{this.inputNodes[i].classList.add("hidden"),this.labelNodes[i].classList.remove("hidden"),this.handleValueTextChange(i,e)},onKeyDown:t=>{if(t.stopPropagation(),"Escape"===t.key||"Enter"===t.key){this.inputNodes[i].classList.add("hidden");const s=t.currentTarget;s.value=e.label||"",s.disabled=!0,this.handleValueTextChange(i,t),this.labelNodes[i].classList.remove("hidden"),s.disabled=!1,setTimeout((()=>this.labelNodes[i].focus()),300)}}}))}afterCreateValueSymbol(e,i){var t;const{modules:s}=a.s;let l=(0,a.b)().classBreakInfos[i].symbol.clone();for(;null===(t=null==e?void 0:e.childNodes)||void 0===t?void 0:t.length;)e.removeChild(e.childNodes[0]);const{symbolUtils:n}=s;l&&n.renderPreviewHTML(l,{size:(0,a.aj)(l),symbolConfig:"cim"===l.type&&"CIMPolygonSymbol"===l.data.symbol.type?{isSquareFill:!0}:void 0}).then((i=>null==e?void 0:e.appendChild(i)))}handleClassifyToggle(e){const i=(0,a.a)(),t=e.currentTarget.open?"color"===i?o.e:r.k:"color"===i?o.b:r.f;(0,n.r)(t({}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.arcgisSmartMappingClassifyChange.emit({closePopovers:!0,toggle:!0})}),(e=>{this.classifyBlockSectionNode.open=!this.classifyBlockSectionNode.open,this.arcgisSmartMappingClassifyError.emit(e)}))}handleClassesChange(){const e=(0,a.a)(),i=Math.min(Math.max(parseInt(this.classesNode.value),1),10)||5;`${i}`!==this.classesNode.value&&(this.classesNode.value=`${i}`);const t="color"===e?o.e:r.k;(0,n.r)(t({numClasses:i}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),this.arcgisSmartMappingClassifyChange.emit({classesChange:!0}),this.classesNode.value=`${e.renderer.classBreakInfos.length}`}),(e=>{const i=(0,a.b)();this.classesNode.value=`${i.classBreakInfos.length}`,this.arcgisSmartMappingClassifyError.emit(e)}))}handleStdDevChange(e){const i=e.currentTarget,t="color"===(0,a.a)()?o.e:r.k;(0,n.r)(t({standardDeviationInterval:parseFloat(i.value)}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),this.arcgisSmartMappingClassifyChange.emit()}),(e=>{const i=(0,a.b)().authoringInfo.standardDeviationInterval||1;this.stdDevSelectNode.value=`${i}`,(0,s.f)(this.hostElement),this.arcgisSmartMappingClassifyError.emit(e)}))}handleRoundClassesChange(e){const i=(0,a.b)().authoringInfo,t=e.currentTarget;"select"!==t.value&&((0,h.u)(parseFloat(t.value)),i.classificationMethod="manual",(0,a.u)(),this.arcgisSmartMappingClassifyChange.emit({closePopovers:!0}))}handleLabelEdit(e,i){let t=this.inputNodes[e];t.classList.remove("hidden"),t.setFocus(),i.target.classList.add("hidden")}handleValueSymbolClick(e){(0,a.m)();const{strings:i}=a.s,t=(0,u.c)({referenceElement:this.flowItemNode,heading:i.styler.symbolStyle});t.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,u.r)(t),setTimeout((()=>{this.symbolNodes[e].focus(),this.popoverNode=null,this.symbolNodes[e].classList.remove("selected")}),300)})),t.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,u.r)(t),setTimeout((()=>{this.popoverNode=null,this.symbolNodes[e].classList.remove("selected")}),300)})),a.s.classedSymbolSelectedIdx=e,(0,u.g)({popoverNode:t,onChange:()=>{(0,a.u)(),(0,s.f)(this.hostElement),this.arcgisSmartMappingClassifyChange.emit({symbolChange:!0})}}),this.popoverNode=t,this.symbolNodes[e].classList.add("selected")}handleValueTextChange(e,i){const t=i.currentTarget,l=(0,a.b)();if(l.classBreakInfos[e].label=t.value,this.labelNodes[e].textContent=t.value,this.inputNodes[e].value=t.value,""===t.value){const i=l.classBreakInfos[e],t=e>0?"> ":"";i.label=`${t} ${i.minValue.toLocaleString()} - ${i.maxValue.toLocaleString()}`,this.labelNodes[e].textContent=i.label,this.inputNodes[e].value=i.label}(0,a.u)(),(0,s.f)(this.hostElement)}get hostElement(){return(0,s.d)(this)}};z.style=".classify-block-section{border-top:1px solid #e0e0e0;overflow-wrap:anywhere}.block-section-padding{padding-top:6px}.symbol-is-white{background-color:#f0f0f0}.hidden{display:none}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.label,.symbol-container{padding-top:5px;padding-bottom:5px}.selected{outline:1px solid var(--calcite-color-brand)}.method-button-content{padding-top:8px}";const x=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingDividedByChange=(0,s.c)(this,"arcgisSmartMappingDividedByChange",7),this.arcgisSmartMappingDividedByError=(0,s.c)(this,"arcgisSmartMappingDividedByError",7),this.rendererSubtype=void 0,this.normalizationField=void 0,this.fieldPos=void 0}componentWillLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}render(){const{fields:e,strings:i}=a.s,t=(0,a.b)(),l=(0,a.a)(),n=t.authoringInfo,o=(0,a.d)(t,this.rendererSubtype),r=(0,a.J)(t,"reference-size"),d="relationship"===l||"relationship"===this.rendererSubtype,c=d?0===this.fieldPos?n.field1.field:n.field2.field:o?o.field:t.field,h=d?0===this.fieldPos?n.field1.normalizationField:n.field2.normalizationField:o?o.normalizationField:r?r.normalizationField:t.normalizationField;return(0,s.h)("arcgis-smart-mapping-attribute-input",{key:"8cd8b468470f5479cc5640772b4b7b1632ad6775",fieldList:e.filter((e=>e.layerField.name!==c&&e.simpleFieldType===a.w.NUMBER)),popoverReferenceElement:this.flowItemNode,label:i.transparency.dividedBy,mode:"remove",selectedField:h?{field:h,simpleFieldType:a.w.NUMBER}:null,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const i=e.detail;this.normalize(i.field)}else this.normalize(null)}})}normalize(e){const i=(0,a.b)(),t=(0,a.a)(),l=i.authoringInfo,d="univariate-color-size"===(null==l?void 0:l.type),c="class-breaks-color"===(null==l?void 0:l.type),h="class-breaks-size"===(null==l?void 0:l.type),u="relationship"===t||"relationship"===this.rendererSubtype,g=(0,a.J)(i,"reference-size");let f;c?f=o.e:h?f=r.k:d?f=p.b:"color"===this.rendererSubtype?(f=o.b,["color-age","color-age-size"].indexOf(t)>-1&&(f=o.d)):"size"===this.rendererSubtype?(f=r.f,["size-age","color-size-age","type-size-age"].indexOf(t)>-1&&(f=r.h)):u&&(f=m.a);const S={};u?0===this.fieldPos?S.normalizationField1=e:S.normalizationField2=e:S.normalizationField=e,(0,n.r)(f(S,this.rendererSubtype),this.flowItemNode).then((e=>{if(d||c||h||u){if("relationship-size"===t){e.renderer.backgroundFillSymbol=i.backgroundFillSymbol;const t=(0,a.d)(i,"size"),s=(0,a.J)(i,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(t),e.renderer.authoringInfo=e.renderer.authoringInfo||{},e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(s)}(0,a.u)(e.renderer)}else if("color"===this.rendererSubtype)["color-size","color-age-size","color-size-age"].indexOf(t)>-1?(this.switchOutVisualVariable(e),(0,a.u)()):(0,a.u)(e.renderer);else if("size"===this.rendererSubtype)if(["color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].indexOf(t)>-1)g?(0,r.l)().then((e=>(0,a.u)(e)),(e=>this.arcgisSmartMappingDividedByError.emit(e))):(this.switchOutVisualVariable(e),(0,a.u)());else if(g){const t=(0,a.J)(e.renderer,"reference-size");i.authoringInfo.visualVariables=(0,a.U)(i,"reference-size")||[],i.authoringInfo.visualVariables.push(t),(0,r.l)().then((e=>(0,a.u)(e)),(e=>this.arcgisSmartMappingDividedByError.emit(e)))}else(0,a.u)(e.renderer);else(0,a.u)();(0,s.f)(this.hostElement),this.arcgisSmartMappingDividedByChange.emit()}),(e=>this.arcgisSmartMappingDividedByError.emit(e)))}switchOutVisualVariable(e){const i=(0,a.b)();i.visualVariables=(0,a.T)(i,this.rendererSubtype)||[];const t=(0,a.d)(e.renderer,this.rendererSubtype);i.visualVariables.push(t),i.authoringInfo.visualVariables=(0,a.U)(i,this.rendererSubtype)||[];const s=(0,a.J)(e.renderer,this.rendererSubtype);s&&i.authoringInfo.visualVariables.push(s),(0,a.S)(i)}get hostElement(){return(0,s.d)(this)}},I=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingInfoPopoverClose=(0,s.c)(this,"arcgisSmartMappingInfoPopoverClose",7),this.arcgisSmartMappingInfoPopoverDisconnected=(0,s.c)(this,"arcgisSmartMappingInfoPopoverDisconnected",7),this.documentTabHandler=void 0,this.documentClickHandler=void 0,this.panelScrollHandler=void 0,this.onOpen=()=>{requestAnimationFrame((()=>{var e;return null===(e=this.panelNode)||void 0===e?void 0:e.setFocus()}))},this.props=void 0,this.referenceElement=void 0,this.open=!1}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async setFocus(){var e;null===(e=this.panelNode)||void 0===e||e.setFocus()}async setOpen(e){var i;this.popoverNode&&(this.popoverNode.open=e,e&&(null===(i=this.panelNode)||void 0===i||i.setFocus(),this.popoverNode.reposition()))}disconnectedCallback(){this.arcgisSmartMappingInfoPopoverDisconnected.emit()}render(){const{props:e,referenceElement:i,open:t}=this,{title:l,moreInfo:n,helpId:o}=e,{config:r,strings:d}=a.s,{helpBase:c,helpMap:h}=r,u=d.tile.info.title.replace("${title}",l);return(0,s.h)(s.H,{key:"9ffb6b6784e7028f183c11e260d3ef98a675f398",class:"js-app-flyout arcgis-smart-mapping-popover"},(0,s.h)("calcite-popover",{key:"ea1228d632c87e655e4f5e371e0bb0fc4218f2fc",open:t,placement:"auto",offsetSkidding:5,label:"",referenceElement:i,class:"info-popover",onCalcitePopoverOpen:this.onOpen,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"93ca333dbdf8a1fdc782ee4e8e8d7adde80cb57d",heading:u,closable:!0,ref:e=>this.panelNode=e,onCalcitePanelClose:()=>{this.arcgisSmartMappingInfoPopoverClose.emit(),setTimeout((()=>i.parentElement.focus()),300)}},(0,s.h)("div",{key:"08b0895c826368a6e726051d64259e9f80388c0a",class:"info"},(0,s.h)("div",{key:"04bff14baf267830a2df2c397d7fd2236473c48d"},n),o&&h?(0,s.h)("div",{class:"info-help"},(0,s.h)("calcite-button",{appearance:"solid",label:d.tile.info.learnMore,class:"info-help-button",slot:"footer",onClick:()=>window.open(`${c}${h[o]}`,"_blank")},d.tile.info.learnMore)):null))))}get hostElement(){return(0,s.d)(this)}};I.style=".info{padding:10px;background-color:white}.info-popover{max-width:320px}.info-help{padding-top:10px;justify-content:flex-end;display:flex}.info-help-button{display:flex;flex-flow:row-reverse}";const C=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsSizeClose",7),this.arcgisSmartMappingPanelsSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsSizeBackClick",7),this.arcgisSmartMappingPanelsSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsSizeError",7),this.arcgisSmartMappingAuthRefSizeVisVarChange=(0,s.c)(this,"arcgisSmartMappingAuthRefSizeVisVarChange",7),this.rangeSliderWatchHandles=[],this.handleDone=()=>{this.arcgisSmartMappingPanelsSizeClose.emit("save")},this.handleCancel=()=>{const{originalRenderer:e,originalFeatureReduction:i}=this;(0,a.l)(e,i),this.arcgisSmartMappingPanelsSizeClose.emit("cancel")},this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:i}=a.s,t=(0,a.b)();this.originalRenderer=t.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,g.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")));const e=(0,a.b)();(0,a.J)(e,"reference-size")&&(this.referenceSizeScaleHandle=this.getReferenceSizeScaleHandle())}disconnectedCallback(){var e,i;null===(e=this.scaleHandle)||void 0===e||e.remove(),null===(i=this.referenceSizeScaleHandle)||void 0===i||i.remove()}render(){const{layer:e,hideLayerTitle:i,isRTL:t,strings:l}=a.s;return(0,s.h)(s.H,{key:"bf08a7e3374b0199b19e7ebdde11b337e87616c7",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"e024a9727234f3614c61242a6645e5b34f844da6",heading:l.panels.styleOptions,description:i?void 0:e.title,class:{"flow-item":!0,[f.C.rtl]:t},closable:(0,a.F)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsSizeBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:i}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.done,onClick:this.handleDone,appearance:"solid",width:"half"},i.done):null}renderCancelButton(){const{layer:e,strings:i}=a.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},i.cancel):null}renderVisualization(){var e,i;const{visualizationOpen:t,hideTransparency:l,hideRotation:n}=this,{strings:o}=a.s,r=(0,a.a)(),d=(0,a.b)(),c=["size-age","color-size-age","type-size-age"].indexOf(r)>-1,h=["chart-size","predominance-size"].indexOf(r)>-1,u=(0,a.d)(d,"size"),m=(0,a.J)(d,"reference-size"),p=u?u.field?null===(e=(0,a.t)(u.field))||void 0===e?void 0:e.label:u.valueExpressionTitle||o.expression:m?m.field:d.field?null===(i=(0,a.t)(d.field))||void 0===i?void 0:i.label:d.valueExpressionTitle||o.expression,g=(0,a.t)((null==u?void 0:u.field)||d.field),f=(null==g?void 0:g.simpleFieldType)===a.w.DATE,S="chart-size"===r;return(0,s.h)("calcite-block",{class:"size-block",key:"size-visualization",heading:c?o.panels.size.sizeAgeStyle:f?o.panels.size.sizeStyleDate:S?o.panels.size.sizeStyleChart:o.panels.size.sizeStyle,collapsible:!l||!n,open:t,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("div",null,c||h?null:(0,s.h)("calcite-label",{class:"attribute-name"},p),this.renderAge(),this.renderTheme(),this.renderDividedBy(),this.renderReferenceSizeButton(),this.renderSymbol(),this.renderSizeSlider(),this.renderSizeRange(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend(),this.renderClassify()))}renderAge(){const e=(0,a.a)();return["size-age","color-size-age"].indexOf(e)>-1?(0,s.h)("arcgis-smart-mapping-age",{rendererSubtype:"size",onArcgisSmartMappingAgeChange:()=>this.sliderNode.updateStatistics(),onArcgisSmartMappingAgeError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)}):null}renderTheme(){const e=(0,a.b)(),i=(0,a.d)(e,"size"),t=(0,a.J)(e,"reference-size");if(!i&&!t)return null;const l=(0,a.a)();return["chart-size","predominance-size"].indexOf(l)>-1?null:(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"size",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingThemeButtonChange:e=>{const{layer:o,mapView:d}=a.s,c=(0,a.O)(t),h="reference-size"===e.detail,u=!c&&h||c&&!h;let m=r.f;["size-age","color-size-age"].indexOf(l)>-1?m=r.h:u&&(m=r.f);const p={theme:e.detail,discardMinMax:!0};h&&(p.referenceSizeOptions={symbolStyle:"circle"}),u&&(p.layer=o,p.mapView=d,p.fieldInfos=[{field:i?i.field:t.field}],p.noReuse=!0),(0,n.r)(m(p),this.flowItemNode).then((async e=>{var i,t,n;if(u)if(["type-size","relationship-size"].includes(l)){const{modules:i}=a.s,t=(0,a.b)();t.visualVariables=e.renderer.visualVariables,t.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables,t.uniqueValueInfos.forEach((t=>{const s=(0,a.Q)(null==t?void 0:t.symbol)||new i.esriColor("gray"),l=e.renderer.classBreakInfos[0].symbol.clone();"cim"===l.type?i.cimSymbolUtils.applyCIMSymbolColor(l,s,{layersToColor:"fill-and-outline"}):(0,a.W)(l,s),t.symbol=l})),t.defaultSymbol=void 0,t.defaultLabel=void 0,t.backgroundFillSymbol=void 0,(0,a.u)(t)}else if("color-size"===l){const{modules:s,useFeatureReduction:l}=a.s,r=(0,a.b)(),c=(0,a.d)(r,"color"),h=(0,a.J)(r,"color"),{renderer:u}=await s.ColorCreator.createContinuousRenderer({layer:o,view:d,field:c.field,valueExpression:c.valueExpression,valueExpressionTitle:c.valueExpressionTitle,normalizationField:c.normalizationField,theme:null==h?void 0:h.theme,colorScheme:(0,a.R)(),forBinning:"binning"===(null===(i=o.featureReduction)||void 0===i?void 0:i.type)&&l});if(e.renderer.visualVariables.push(c),null===(n=null===(t=u.authoringInfo)||void 0===t?void 0:t.visualVariables)||void 0===n?void 0:n.length){const i=(0,a.J)(u,"color");e.renderer.authoringInfo.visualVariables.push(i)}e.renderer.field=c.field,e.renderer.valueExpression=c.valueExpression,e.renderer.valueExpressionTitle=c.valueExpressionTitle,e.renderer.normalizationField=c.normalizationField,(0,a.u)(e.renderer)}else(0,a.u)(e.renderer);else{const i=(0,a.b)();i.visualVariables=(0,a.T)(i,"size")||[],i.visualVariables.push((0,a.d)(e.renderer,"size")),i.authoringInfo.visualVariables=(0,a.U)(i,"size")||[],i.authoringInfo.visualVariables.push((0,a.J)(e.renderer,"size")),(0,a.u)()}(0,s.f)(this.hostElement),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.backgroundSymbolNode&&(0,s.f)(this.backgroundSymbolNode),!c&&h&&this.defaultSymbolNode.done()}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsSizeError.emit(e)}))}})}renderDividedBy(){const{fields:e}=a.s,i=(0,a.b)(),t=(0,a.a)();if(["size-age","color-size-age"].indexOf(t)>-1)return null;if((0,a.I)(e).number<2)return null;const l=(0,a.d)(i,"size");if(l){const e=(0,a.t)(l.field),i={field:l.field,expression:l.valueExpression,expressionTitle:l.valueExpressionTitle,simpleFieldType:e?e.simpleFieldType:a.w.NUMBER};if(i.expression||i.simpleFieldType!==a.w.NUMBER)return null}return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"size",normalizationField:l?l.normalizationField:i.normalizationField,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.hostElement),(0,s.f)(this.sliderNode),this.sliderNode.updateStatistics(),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderReferenceSizeButton(){const e=(0,a.b)();return(0,a.J)(e,"reference-size")?(0,s.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"reference-size",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,a.m)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,s.f)(this.hostElement),(0,s.f)(this.symbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail),ref:e=>{e&&(this.symbolPairButtonNode=e)}}):null}renderSymbol(){const e=(0,a.b)(),i=(0,a.a)(),t=(0,a.J)(e,"reference-size");if("pie-chart"===e.type||["type-size","color-size","relationship-size"].includes(i)&&t)return null;const l=this.getSymbol();return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:l,type:"size",isReferenceSize:(0,a.O)(t),ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderSizeSlider(){return(0,s.h)("arcgis-smart-mapping-size-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingSizeSliderChange:()=>{(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingSizeSliderError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderSizeRange(){return(0,s.h)("arcgis-smart-mapping-size-range-slider",{onArcgisSmartMappingSizeRangeSliderError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail),ref:e=>{e&&(this.sizeRangeNode=e)}})}renderBackgroundStyle(){const{mapImageSublayer:e}=a.s,i=(0,a.a)();return e&&["predominance-size","type-size","relationship-size"].indexOf(i)>-1?null:(0,s.h)("arcgis-smart-mapping-background-symbol",{ref:e=>{e&&(this.backgroundSymbolNode=e)}})}renderDefaultSymbol(){const e=(0,a.a)();return["chart","chart-size"].indexOf(e)>-1?null:(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.m)(),onArcgisSmartMappingDefaultSymbolChange:()=>{this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode)}})}renderShowInLegend(){const{strings:e}=a.s,i=(0,a.b)(),t=(0,a.d)(i,"size");if(!t)return null;const l=t.legendOptions,n=!l||!1!==l.showLegend;return(0,s.h)("calcite-label",{layout:"inline-space-between",class:"legend-toggle-padding"},e.panels.size.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:n,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderClassify(){const e=(0,a.b)(),i=(0,a.a)(),t=this.getFieldInfo().simpleFieldType===a.w.DATE,l=["size-age","color-size-age","type-size-age"].indexOf(i)>-1,n=(0,a.J)(e,"reference-size");return"size"!==i||t||l||n?null:(0,s.h)("arcgis-smart-mapping-classify",{ref:e=>this.classifyNode=e,onArcgisSmartMappingClassifyChange:e=>{const i=e.detail;((null==i?void 0:i.closePopovers)||(null==i?void 0:i.classesChange))&&(0,a.m)(),(0,s.f)(this.hostElement),this.sliderNode&&(0,s.f)(this.sliderNode),((null==i?void 0:i.toggle)||(null==i?void 0:i.classesChange)||!(null==i?void 0:i.symbolChange)&&!(null==i?void 0:i.closePopovers))&&(this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.sliderNode.updateStatistics()),this.classifyNode&&(0,s.f)(this.classifyNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.defaultSymbolNode&&(0,s.f)(this.defaultSymbolNode)},onArcgisSmartMappingClassifyError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderTransparency(){const{hideTransparency:e}=this;if(e)return;const i=(0,a.b)(),t=(0,a.d)(i,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsSizeError.emit(e)})}renderRotation(){const{hideRotation:e}=this;if(e)return;const i=(0,a.b)(),t=(0,a.d)(i,"opacity"),l=(0,a.d)(i,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!l,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsSizeError.emit(e)})}getSymbol(){const{modules:e}=a.s,i=((0,a.b)().type,(0,a.b)()),t="class-breaks"===(0,a.b)().type?i.classBreakInfos:i.uniqueValueInfos,s=(0,a.a)();let l;return["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","relationship-size"].indexOf(s)>-1?(l=t.length?t[0].symbol.clone():(0,a.q)(s),(0,a.W)(l,new e.esriColor({r:149,g:149,b:149,a:1}))):l=t.length?t[t.length-1].symbol.clone():(0,a.q)(s),l}handleIncludeInLegendToggle(){const e=(0,a.b)(),i=(0,a.d)(e,"size"),t=i.legendOptions;t&&!1===t.showLegend?t.title?t.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=t||{},i.legendOptions.showLegend=!1),(0,a.u)()}getFieldInfo(){const e=(0,a.a)(),i=(0,a.k)();return["color-size","color-age-size","color-size-age","type-size","type-size-age"].indexOf(e)>-1&&i.length>1?i[1]:"relationship-size"===e?i[2]:i[0]}getReferenceSizeScaleHandle(){const{mapView:e}=a.s;let i=e.scale;return e.watch("scale",(0,c.d)((e=>{const t=(0,a.b)(),s=(0,a.J)(t,"reference-size"),l=i/e;i=e,(null==s?void 0:s.referenceSizeScale)&&(s.referenceSizeScale=e,s.sizeStops.forEach((e=>e.size*=l)),this.arcgisSmartMappingAuthRefSizeVisVarChange.emit(l))}),300))}get hostElement(){return(0,s.d)(this)}};C.style=":host{width:100%}.flow-item{height:100%}.size-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const N=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSizeRangeSliderError=(0,s.c)(this,"arcgisSmartMappingSizeRangeSliderError",7)}arcgisSmartMappingAuthRefSizeVisVarChangeHandler({detail:e}){const i=this.rangeSliderNode.values,t=Math.min(...i)*e,s=Math.max(...i)*e;this.rangeSliderNode.values=[t,s],this.minRangeNode.value=`${Math.round(this.rangeSliderNode.values[0])}`,this.maxRangeNode.value=`${Math.round(this.rangeSliderNode.values[1])}`}componentDidLoad(){const{config:e}=a.s;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`),this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}disconnectedCallback(){var e;clearTimeout(this.minWatchHandle),clearTimeout(this.maxWatchHandle),null===(e=this.scaleWatchHandle)||void 0===e||e.remove()}render(){const{mapImageSublayer:e,modules:i,strings:t}=a.s,l=(0,a.b)(),n=l.authoringInfo,o=(0,a.d)(l,"size"),r=(0,a.J)(l,"reference-size"),d="above-and-below"===(null==n?void 0:n.univariateTheme),c=!!o&&!(0,a.O)(o.minSize),h=!!o&&"number"==typeof o.minSize,u=!c&&!h;let[m,p]=(0,S.a)();if([m,p]=[Math.round(m/.75),Math.round(p/.75)],m>p&&([m,p]=[p,m]),this.rangeSliderNode){if(m!==this.rangeSliderNode.values[0]||p!==this.rangeSliderNode.values[1]||!(0,a.O)(this.rangeSliderNode.values[1])){const e={min:Math.max(0,Math.min(1,m-10)),max:Math.min(p+10,r?1/0:100),values:m===p?[m]:[m,p]};this.minRangeNode.value=`${m}`,this.maxRangeNode.value=`${p}`,this.rangeSliderNode.set(e)}}else{const e={min:Math.max(1,Math.min(1,m-10)),max:Math.min(p+10,r?1/0:100),values:m===p?[m]:[m,p],visibleElements:{labels:!0},precision:0,labelInputsEnabled:!0,labelFormatFunction:e=>e.toFixed(0)};this.rangeSliderNode=new i.Slider(e)}return(0,s.h)(s.H,null,(0,s.h)("div",{class:"size-range-block"},(0,s.h)("calcite-label",null,t.sizeRangeSlider.sizeRange),(0,s.h)("div",{class:"range-slider range-slider-bottom-label",ref:e=>{e&&this.afterSizeRangeCreate(e)}}),(0,s.h)("div",{dir:"ltr",class:"size-range"},(0,s.h)("div",{class:"size-range-item"},(0,s.h)("calcite-input-number",{value:`${m}`,min:1,max:r?void 0:100,step:1,scale:"s",suffixText:t.sizeRangeSlider.px,ref:e=>{e&&(this.minRangeNode=e)},onCalciteInputNumberInput:()=>{var e;clearTimeout(this.minWatchHandle);const i=null===(e=this.rangeSliderNode)||void 0===e?void 0:e.values,t=parseInt(this.minRangeNode.value);if(this.minRangeNode.value&&t>=this.minRangeNode.min&&(!i[1]||t<i[1])){const e=Math.min(t,100);this.minRangeNode.value=`${e}`,i[1]||(this.maxRangeNode.value=`${e}`);const s=i[1]?[.75*e,.75*i[1]]:[.75*e];this.rangeSliderNode.values=i[1]?[parseInt(this.minRangeNode.value),i[1]]:[parseInt(this.minRangeNode.value)],this.handleSizeRangeValuesChange(s)}else this.minWatchHandle=setTimeout((()=>{var e;const t=null===(e=this.rangeSliderNode)||void 0===e?void 0:e.values;this.minRangeNode.value=`${t[0]}`,i[1]||(this.maxRangeNode.value=`${t[0]}`);const s=t[1]?[.75*t[0],.75*t[1]]:[.75*t[0]];this.handleSizeRangeValuesChange(s)}),3e3)},label:t.sizeRangeSlider.min})),(0,s.h)("div",{class:"size-range-item"},(0,s.h)("calcite-input-number",{value:`${p}`,min:1,max:r?void 0:100,step:1,scale:"s",suffixText:t.sizeRangeSlider.px,ref:e=>{e&&(this.maxRangeNode=e)},onCalciteInputNumberInput:()=>{var e;clearTimeout(this.maxWatchHandle);const i=null===(e=this.rangeSliderNode)||void 0===e?void 0:e.values,t=parseInt(this.maxRangeNode.value);if(this.maxRangeNode.value&&(!i[1]||t>i[0])&&(t<101||r)){const e=r?t:Math.min(t,100);this.maxRangeNode.value=`${e}`,i[1]||(this.minRangeNode.value=`${e}`);const s=i[1]?[.75*i[0],.75*e]:[.75*e];this.rangeSliderNode.values=i[1]?[i[0],parseInt(this.maxRangeNode.value)]:[parseInt(this.maxRangeNode.value)],this.handleSizeRangeValuesChange(s)}else this.maxWatchHandle=setTimeout((()=>{var e,i;const t=null===(e=this.rangeSliderNode)||void 0===e?void 0:e.values;this.maxRangeNode.value=`${null!==(i=t[1])&&void 0!==i?i:t[0]}`,t[1]||(this.minRangeNode.value=`${t[0]}`);const s=t[1]?[.75*t[0],.75*t[1]]:[.75*t[0]];this.handleSizeRangeValuesChange(s)}),3e3)},label:t.sizeRangeSlider.min}))),o&&!d&&!e&&(0,s.h)("calcite-label",{scale:"s",layout:"inline",class:"size-range-bottom-border"},(0,s.h)("calcite-checkbox",{scale:"s",checked:u,onCalciteCheckboxChange:e=>this.handleSizeRangeChange(e.target.checked?"automatic":"fixed"),ref:e=>this.adjustSizeNode=e}),t.sizeRangeSlider.adjustSizeAutomatically),r&&this.renderRegenerate()))}renderRegenerate(){const{strings:e}=a.s;return(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",onClick:()=>this.handleSizeRangeChange("automatic"),label:e.sizeRangeSlider.regenerate},e.sizeRangeSlider.regenerate))}async handleSizeRangeValuesChange(e){const i=(0,a.b)(),t=(0,a.d)(i,"size"),s=i.classBreakInfos,l=(0,a.J)(i,"reference-size");if(l){l.sizeStops[0].size=e[0],l.sizeStops[1].size=e[1];const i=await(0,r.l)();return void(0,a.u)(i)}const n=t?t.minSize/.75:s[0].symbol.size/.75,o=t?t.maxSize/.75:s[s.length-1].symbol.size/.75,d=e[0]/.75,c=e[1]?e[1]/.75:e[0]/.75;n===d&&o===c||((0,S.b)(e),e.length>1&&(this.maxRangeNode.min=d+this.maxRangeNode.step,this.minRangeNode.max=c-this.minRangeNode.step),(0,a.u)())}afterSizeRangeCreate(e){if(this.rangeSliderNode.container)e.append(this.rangeSliderNode.container);else{const i=document.createElement("div");e.append(i),this.rangeSliderNode.container=i,this.createRangeSliderChangeEvents()}}createRangeSliderChangeEvents(){const{mapView:e}=a.s;this.rangeSliderNode&&(this.rangeSliderNode.on("thumb-change",(e=>{var i,t;const s=null===(i=this.rangeSliderNode)||void 0===i?void 0:i.values;0===e.index?s[1]&&s[0]>=s[1]&&(s[0]=e.oldValue):1===e.index&&s[1]<=s[0]&&(s[1]=e.oldValue),this.minRangeNode.value=`${Math.round(s[0])}`,this.maxRangeNode.value=`${null!==(t=Math.round(s[1]))&&void 0!==t?t:Math.round(s[0])}`;const a=s[1]?[.75*s[0],.75*s[1]]:[.75*s[0]];this.handleSizeRangeValuesChange(a)})),this.rangeSliderNode.on("thumb-drag",(e=>{var i,t;const s=(0,a.b)();if((0,a.J)(s,"reference-size")&&["start","drag"].includes(e.state))return;const l=null===(i=this.rangeSliderNode)||void 0===i?void 0:i.values;if(0===e.index){if(l[1]&&l[0]>=l[1])return void(l[0]=l[0]-1)}else if(1===e.index&&l[1]<=l[0])return void(l[1]=l[1]+1);this.minRangeNode.value=`${Math.round(l[0])}`,this.maxRangeNode.value=`${null!==(t=Math.round(l[1]))&&void 0!==t?t:Math.round(l[0])}`;const n=l[1]?[.75*l[0],.75*l[1]]:[.75*l[0]];this.handleSizeRangeValuesChange(n)})),this.rangeSliderNode.on("segment-drag",(()=>{var e,i;const t=null===(e=this.rangeSliderNode)||void 0===e?void 0:e.values;this.minRangeNode.value=`${Math.round(t[0])}`,this.maxRangeNode.value=`${null!==(i=Math.round(t[1]))&&void 0!==i?i:Math.round(t[0])}`;const s=t[1]?[.75*t[0],.75*t[1]]:[.75*t[0]];this.handleSizeRangeValuesChange(s)})),this.scaleWatchHandle=e.watch("scale",(()=>{var e,i,t;const s=(0,a.b)();if((0,a.d)(s,"size")){let[s,a]=(0,S.a)();[s,a]=[Math.round(s/.75),Math.round(a/.75)],s>a&&([s,a]=[a,s]),null===(e=this.rangeSliderNode)||void 0===e||e.set({values:s===a?[s]:[s,a],min:Math.max(1,Math.min(1,s-10)),max:Math.min(a+10,100)}),this.minRangeNode.value=`${Math.round(this.rangeSliderNode.values[0])}`,this.maxRangeNode.value=null!==(t=null===(i=Math.round(this.rangeSliderNode.values[1]))||void 0===i?void 0:i.toString())&&void 0!==t?t:Math.round(this.rangeSliderNode.values[0]).toString()}})))}async handleSizeRangeChange(e){const i=(0,a.b)(),t=(0,a.d)(i,"size"),l=(0,a.J)(i,"reference-size");if("fixed"===e){if(!t.minSize.stops)return;[t.minSize,t.maxSize]=(0,S.a)(),(0,a.u)(),(0,s.f)(this.hostElement)}else{const e=(0,a.a)();let i=r.f;"predominance-size"===e?i=b.a:"chart-size"===e?i=p.d:["size-age","color-size-age","type-size-age"].indexOf(e)>-1&&(i=r.h),(0,n.r)(i({sizeOptimizationEnabled:!0}),this.flowItemNode).then((async e=>{if(l){const i=(0,a.J)(e.renderer,"reference-size");l.sizeStops.forEach(((e,t)=>e.size=i.sizeStops[t].size));const t=await(0,r.l)({sizeOptimizationEnabled:!0,sizeStops:l.sizeStops});(0,a.u)(t)}else(0,a.u)(e.renderer);(0,s.f)(this.hostElement)}),(e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingSizeRangeSliderError.emit(e)}))}}get hostElement(){return(0,s.d)(this)}};N.style=".size-range-block{border-bottom:1px solid #e0e0e0}.range-slider{height:40px;background-color:transparent;position:relative;width:95%;margin:15px auto 0 auto}.size-range{display:flex;justify-content:space-between;margin-bottom:15px}.size-range-item{width:48%;display:flex;flex-flow:column;justify-content:space-between}.esri-slider__label{text-decoration:underline}.esri-slider__label:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.top-bottom-margin-small{margin:10px 0}";const k=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSizeSliderChange=(0,s.c)(this,"arcgisSmartMappingSizeSliderChange",7),this.arcgisSmartMappingSizeSliderError=(0,s.c)(this,"arcgisSmartMappingSizeSliderError",7),this.currentStopValues=[],this.currentBreakValues=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.histogramStatus=a.h.MISSING,this.statisticsStatus=a.h.MISSING,this.sliderZoomed=!1}arcgisSmartMappingAuthRefSizeVisVarChangeHandler(){const e=(0,a.b)(),i=(0,a.J)(e,"reference-size");i.referenceSizeScale&&(this.currentStopValues=[i.sizeStops[0].value,i.sizeStops[1].value],this.sizeSlider.stops.forEach(((e,t)=>e.size=i.sizeStops[t].size)))}async updateStatistics(){var e;this.statisticsStatus=a.h.MISSING,this.statistics=null,this.histogramStatus=a.h.MISSING,this.histogram=null,null===(e=this.sizeSlider)||void 0===e||e.destroy(),this.sizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}componentDidLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){const{config:e}=a.s;return(0,s.h)(s.H,{key:"74e111352df6d5119933e906ff4c6dfbccc5929f"},(0,s.h)("link",{key:"ee34a67f3ceb77f5e58ea12fb063850e5caf59d0",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.hostElement)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.hostElement)}}),"loaded"===this.styleSheetStatus?this.renderSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderSizeSliderLoading():null)}renderSizeSlider(){const{statisticsStatus:e,histogramStatus:i,sliderZoomed:t}=this,{strings:l}=a.s,n=(0,a.b)(),o=(0,a.d)(n,"size"),r=(0,a.J)(n,"reference-size");if(!(e===a.h.FAILED||e===a.h.MISSING||o&&o.stops&&1===o.stops.length||!o&&!r&&1===n.classBreakInfos.length)){if(e===a.h.IN_PROGRESS||i===a.h.IN_PROGRESS&&!this.sizeSlider)return this.renderSizeSliderLoading();{const e=this.prepareSizeSlider();let i=!1;if((o||r)&&!t){const e=(0,a.J)(n,"reference-size"),t=(0,a.J)(n,"size"),s=(0,a.aJ)(this.getZoomStops(),t?null==t?void 0:t.minSliderValue:e.minSliderValue,t?null==t?void 0:t.maxSliderValue:e.maxSliderValue);((null==s?void 0:s.minMaxSame)||!(0,a.O)(null==s?void 0:s.min)&&!(0,a.O)(null==s?void 0:s.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return o?this.currentStopValues=[o.minDataValue,o.maxDataValue]:r?this.currentStopValues=[r.sizeStops[0].value,r.sizeStops[1].value]:this.currentBreakValues=n.classBreakInfos.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.sizeSlider)&&this.sizeSlider.min!==this.sizeSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,l.panels.size.dataRange),(0,s.h)("div",{class:"slider-box-buttons-front"},!r&&this.renderInvertButton(),(o||r)&&(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),this.renderZoomButton(i),(0,s.h)("div",null,"\xa0"),this.renderResetButton())),(0,s.h)("div",{ref:e=>{e&&this.afterSizeSliderCreate(e)}})):this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max?null:this.renderSizeSliderLoading()}}this.sizeSlider&&(this.sizeSlider.destroy(),this.sizeSlider=void 0)}renderSizeSliderLoading(){const{strings:e}=a.s;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=a.s;return(0,s.h)("arcgis-smart-mapping-action",{text:e.panels.size.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:i}=a.s,{sliderZoomed:t}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:i.panels.size.zoomSlider,icon:t?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>this.zoomButtonNode=e})}renderResetButton(){const{strings:e}=a.s;return(0,s.h)("arcgis-smart-mapping-action",{text:e.panels.size.resetSlider,icon:"undo",onClick:()=>this.handleResetSlider()})}prepareSizeSlider(){var e,i;const{statistics:t,histogram:s,histogramStatus:n,sliderZoomed:o}=this,{mapView:d,modules:c}=a.s,u=(0,a.b)(),m=(0,a.a)(),p=["size-age","color-size-age","type-size-age"].indexOf(m)>-1,g="class-breaks"===u.type?u.classBreakInfos:u.uniqueValueInfos,f=this.getFieldInfo().simpleFieldType===a.w.DATE,S=(0,a.d)(u,"size"),b=(0,a.J)(u,"size"),v=(0,a.J)(u,"size"),y=-1===["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","chart-size","relationship-size"].indexOf(m)?(0,a.Q)(g[g.length-1].symbol):null;let z,x;if(v?(z=null==v?void 0:v.minSliderValue,x=null==v?void 0:v.maxSliderValue):b?(z=null==b?void 0:b.minSliderValue,x=null==b?void 0:b.maxSliderValue):(z=g[0].minValue,x=g[g.length-1].maxValue),({min:z,max:x}=(0,a.aG)({min:z,max:x})),n===a.h.IN_PROGRESS)return!1;if(!this.sizeSlider||S&&this.sizeSlider.breaks||!S&&!b&&this.sizeSlider.stops){null===(e=this.sizeSlider)||void 0===e||e.destroy();const i={histogramConfig:{bins:null==s?void 0:s.bins,average:Math.round(10*t.avg)/10,standardDeviation:t.stddev,standardDeviationCount:1},min:null!=z?z:t.min,max:null!=x?x:t.max,style:y?{trackFillColor:y||null}:null};if(S||b)f&&!p&&(i.hasTimeData=!0,(0,l.a)(i,d.timeZone)),i.stops=(0,r.m)(),i.precision=(0,h.g)(i.stops),this.sizeSlider=new c.SizeSlider(i),this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(i);else{const e=(0,a.b)();i.histogramConfig.min=e.classBreakInfos[0].minValue,i.histogramConfig.max=e.classBreakInfos[e.classBreakInfos.length-1].maxValue,this.sliderZoomed=!1,i.breaks=(0,r.n)(),i.precision=(0,h.g)(i.breaks),this.sizeSlider=new c.ClassedSizeSlider(i),this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(i)}this.createSizeSliderChangeEvents()}else{if("dragging"===(null===(i=this.sizeSlider.slider)||void 0===i?void 0:i.state))return!0;const e={histogramConfig:{bins:null==s?void 0:s.bins,average:Math.round(10*t.avg)/10,standardDeviation:t.stddev,standardDeviationCount:1},min:null!=z?z:t.min,max:null!=x?x:t.max,style:y?{trackFillColor:y||null}:null};S||b?(e.stops=(0,r.m)(),e.precision=(0,h.g)(e.stops),e.hasTimeData=f&&!p,f&&!p&&(0,l.a)(e,d.timeZone),o?this.zigzagClick||(e.zoomOptions=(0,a.aJ)(this.getZoomStops(),v?null==v?void 0:v.minSliderValue:b.minSliderValue,v?null==v?void 0:v.maxSliderValue:b.maxSliderValue)):e.zoomOptions=null):(e.breaks=(0,r.n)(),e.precision=(0,h.g)(e.breaks)),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(e.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.sizeSlider.slider.min=e.zoomOptions.min,e.zoomOptions.min=null):(this.sizeSlider.slider.max=e.zoomOptions.max,e.zoomOptions.max=null)),this.adjustedZoomOptions=null,this.zoomAdjustment=null,this.sizeSlider.set(e),this.zigzagClick=!1}return(0,a.O)(this.sizeSlider)}handleInvertSlider(){const e=(0,a.b)(),i=(0,a.d)(e,"size");if(i)[i.minSize,i.maxSize]=[i.maxSize,i.minSize];else{const i=e.classBreakInfos.map((e=>(0,a.X)(e.symbol)));i.reverse(),e.classBreakInfos.forEach(((e,t)=>{const s=e.symbol;(0,a.Y)(s,i[t])}))}(0,a.u)(),this.arcgisSmartMappingSizeSliderChange.emit()}handleZoomSlider(e){var i,t,s,l;if(this.histogramStatus===a.h.IN_PROGRESS)return;const{statistics:n}=this,o=(0,a.b)();this.sliderZoomed=(0,a.O)(e)?e:!this.sliderZoomed;const r=(0,a.d)(o,"size"),d=(0,a.J)(o,"reference-size");r||d||(this.sliderZoomed=!1);const c=this.getFieldInfo(),h=this.getNormalizationField(),u=(0,a.J)(o,"size"),m=this.sliderZoomed?(0,a.aJ)(this.getZoomStops(),u?u.minSliderValue:d?d.minSliderValue:n.min,u?u.maxSliderValue:d?d.maxSliderValue:n.max):null,p=u?u.minSliderValue===u.maxSliderValue:d.minSliderValue===d.maxSliderValue;this.getHistogram(c,h,n,m&&m.min||(p?n.min:null!==(t=null!==(i=null==u?void 0:u.minSliderValue)&&void 0!==i?i:null==d?void 0:d.minSliderValue)&&void 0!==t?t:n.min),m&&m.max||(p?n.max:null!==(l=null!==(s=null==u?void 0:u.maxSliderValue)&&void 0!==s?s:null==d?void 0:d.maxSliderValue)&&void 0!==l?l:n.max))}handleResetSlider(){const{modules:e}=a.s,i=(0,a.b)(),t=(0,a.a)();this.sliderZoomed=!1;const l=(0,a.d)(i,"size"),o=(0,a.J)(i,"reference-size"),c=(0,a.J)(i,"size"),h=this.getFieldInfo(),u=this.getNormalizationField();let m;"size"===t||o&&("type-size"===t||"color-size"===t)?m=r.f:"size-age"===t?(h.field=c.field,m=r.h):"color-size-age"===t?(h.field=c.field,m=r.i):"color-age-size"===t?m=r.j:"color-size"===t?m=r.g:"type-size"!==t||o?"type-size-age"===t?(h.field=c.field,m=d.d):["predominance-size","relationship-size","chart-size"].indexOf(t)>-1&&(m=r.c):m=d.b,(0,n.r)(m({fieldInfos:["predominance-size","relationship-size","chart-size"].indexOf(t)>-1?o?[{field:o.field}]:[{field:l.field,expression:l.valueExpression,expressionTitle:l.valueExpressionTitle}]:!o||"type-size"!==t&&"color-size"!==t?(0,a.k)():[{field:o.field}],normalizationField:u,sizeOptimizationEnabled:"object"==typeof(null==l?void 0:l.minSize),noReuse:!0,discardMinMax:!0,referenceSizeOptions:o?{symbolStyle:o.referenceSizeSymbolStyle}:void 0},"size"),this.flowItemNode).then((async i=>{var t;if(0===(null===(t=i.statistics)||void 0===t?void 0:t.count)){const[e,t]=this.getDefaultDataRange(h),s=e,l=t;i.statistics.min=s,i.statistics.max=l,i.statistics.avg=(l+s)/2,this.statistics=i.statistics,this.statisticsStatus=a.h.SUCCESS}else i.statistics&&(0,a.O)(i.statistics.min)&&(0,a.O)(i.statistics.max)&&i.statistics.min<=i.statistics.max?(i.statistics=(0,a.aG)(i.statistics),this.statistics=i.statistics,this.statisticsStatus=a.h.SUCCESS,this.getHistogram(h,u,i.statistics,i.statistics.min,i.statistics.max)):this.statisticsStatus=a.h.FAILED;if(o){const t=(0,a.J)(i.renderer,"reference-size");o.sizeStops=e.esriLang.clone(t.sizeStops),o.minSliderValue=this.statistics.min,o.maxSliderValue=this.statistics.max,(0,r.l)().then((e=>(0,a.u)(e)),(e=>this.arcgisSmartMappingSizeSliderError.emit(e)))}else{const e=(0,a.d)(i.renderer,"size");l.minDataValue=e.minDataValue,l.maxDataValue=e.maxDataValue,c.minSliderValue=this.statistics.min,c.maxSliderValue=this.statistics.max,(0,a.u)()}(0,s.f)(this.hostElement),this.arcgisSmartMappingSizeSliderChange.emit()}),(e=>this.arcgisSmartMappingSizeSliderError.emit(e)))}afterSizeSliderCreate(e){if(this.sizeSlider.container)e.append(this.sizeSlider.container);else{const i=document.createElement("div");i.classList.add("slider-container"),e.append(i),this.sizeSlider.container=i}}getStatistics(){var e,i,t;const{layer:s,useFeatureReduction:l,mapView:n,modules:o}=a.s,r=s,d=(0,a.b)();let c,h;const u=(0,a.J)(d,"reference-size")||{},m=this.getFieldInfo(),p=this.getNormalizationField(),g=(0,a.J)(d,"size")||{};c=null!==(e=g.minSliderValue)&&void 0!==e?e:u.minSliderValue,h=null!==(i=g.maxSliderValue)&&void 0!==i?i:u.maxSliderValue;const f=d.authoringInfo;if("equal-interval"===(null==f?void 0:f.classificationMethod)){const e=d.classBreakInfos;c=e[0].minValue,h=e[e.length-1].maxValue}this.statisticsStatus=a.h.IN_PROGRESS,this.statistics||o.summaryStatistics({layer:r,view:n,field:m.field,valueExpression:m.expression,normalizationField:p,forBinning:"featureReduction"in r&&"binning"===(null===(t=r.featureReduction)||void 0===t?void 0:t.type)&&l}).then((e=>{if(0===e.count){const[i,t]=this.getDefaultDataRange(m),s=g.minSliderValue||i,l=g.maxSliderValue||t;e.min=s,e.max=l,e.avg=(l+s)/2,(0,a.O)(g.minSliderValue)||(g.minSliderValue=s,g.maxSliderValue=l)}else if(!(0,a.O)(e.avg)||!(0,a.O)(e.min)||!(0,a.O)(e.max))return void(this.statisticsStatus=a.h.FAILED);e=(0,a.aG)(e),c=null!=c?c:e.min,h=null!=h?h:e.max,c===h&&(c=e.min,h=e.max),this.statistics=e,this.statisticsStatus=a.h.SUCCESS,this.getHistogram(m,p,e,c,h)}),(e=>{console.log(e),this.statisticsStatus=a.h.FAILED}))}getHistogram(e,i,t,s,l){var n;const{layer:o,useFeatureReduction:r,mapView:d,modules:c}=a.s,h=o;if(!(t=t||this.statistics)||0===t.count)return;this.histogramStatus=a.h.IN_PROGRESS;const u=(0,a.b)(),m=(0,a.J)(u,"reference-size");m&&m.sizeStops[0].value<s&&(s=m.sizeStops[0].value),m&&m.sizeStops[1].value>l&&(l=m.sizeStops[1].value),c.histogram({layer:h,view:d,field:e.field,valueExpression:e.expression,numBins:50,minValue:(0,a.O)(s)?s:t.min,maxValue:(0,a.O)(l)?l:t.max,normalizationField:i,forBinning:"featureReduction"in h&&"binning"===(null===(n=h.featureReduction)||void 0===n?void 0:n.type)&&r}).then((e=>{this.histogram=e,this.histogramStatus=a.h.SUCCESS}),(()=>{this.histogramStatus=a.h.FAILED}))}onMinMaxChange(e,i,t){const{statistics:s}=this,l=(0,a.b)(),n=(0,a.d)(l,"size"),o=(0,a.J)(l,"reference-size"),r=(0,a.J)(l,"size")||{};if(!n&&!o){let t=l.classBreakInfos[0],s=l.classBreakInfos[l.classBreakInfos.length-1];t.minValue=e,t.label=(0,a.aH)(t,this.sizeSlider.precision),s.maxValue=i,s.label=(0,a.aH)(s,this.sizeSlider.precision)}r&&("min"===t?r.minSliderValue=e:r.maxSliderValue=i),o&&("min"===t?o.minSliderValue=e:o.maxSliderValue=i);const d=n||o?(0,a.aJ)(this.getZoomStops(),r?r.minSliderValue:o.minSliderValue,r?r.maxSliderValue:o.maxSliderValue):null;this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!d||d.minMaxSame||!(0,a.O)(d.min)&&!(0,a.O)(d.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.sizeSlider.zoomOptions,"min"===t?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=i,this.zoomAdjustment="max"));const c=this.getFieldInfo(),h=this.getNormalizationField();this.getHistogram(c,h,s,e,i);(e===(null==r?void 0:r.minSliderValue)&&i===(null==r?void 0:r.maxSliderValue)||e===(null==o?void 0:o.minSliderValue)&&i===(null==o?void 0:o.maxSliderValue))&&(this.sliderZoomed=!1),l.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingSizeSliderChange.emit()}createSizeSliderChangeEvents(){const e=(0,a.b)(),i=(0,a.a)(),t=(0,a.d)(e,"size"),l=(0,a.J)(e,"reference-size"),n=["size-age","color-size-age","type-size-age"].indexOf(i)>-1,o=this.getFieldInfo().simpleFieldType===a.w.DATE;this.sizeSlider&&(this.sizeSlider.watch("zoomOptions",((e,i)=>{this.sliderZoomed&&((null==i?void 0:i.min)&&!(null==e?void 0:e.min)||(null==i?void 0:i.max)&&!(null==e?void 0:e.max))&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.sizeSlider.on("min-change",(e=>{t||l?e.value>this.currentStopValues[0]?(this.sizeSlider.stops.forEach(((e,i)=>{e.value=this.currentStopValues[i]})),this.onMinMaxChange(this.currentStopValues[0],this.sizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min"):e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.sizeSlider.slider.max,"min"):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min")})),this.sizeSlider.on("max-change",(e=>{t||l?e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.sizeSlider.stops.forEach(((e,i)=>{e.value=this.currentStopValues[i]})),this.onMinMaxChange(this.sizeSlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max"):e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.sizeSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min,"max"):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max")})),this.sizeSlider.on("thumb-change",(e=>{if(t||l){const i=this.sizeSlider.stops;if(o&&!n&&0===e.value)return void(0,s.f)(this.hostElement);this.updateRendererStops(i)}else this.updateRendererBreaks(this.sizeSlider.breaks)})),this.sizeSlider.on("thumb-drag",(e=>{const i=(0,a.b)(),s=(0,a.J)(i,"reference-size");if(!s||!["start","drag"].includes(e.state))if(t||s){const e=this.sizeSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.sizeSlider.breaks)})),this.sizeSlider.on("segment-drag",(()=>{if((0,a.d)(e,"size")||l){const e=this.sizeSlider.stops;this.updateRendererStops(e)}})))}updateRendererStops(e){const i=(0,a.b)(),t=(0,a.d)(i,"size"),s=(0,a.J)(i,"size"),l=(0,a.J)(i,"reference-size");(null==t?void 0:t.stops)||(null==l?void 0:l.sizeStops)?(5===e.length&&(e[0].label=`< ${e[0].value}`,e[1].label=`${e[1].value}`,e[2].label=`${e[2].value}`,e[3].label=`${e[3].value}`,e[4].label=`> ${e[4].value}`),t?t.stops=e:l.sizeStops.forEach(((i,t)=>i.value=e[t].value))):t&&(t.minDataValue=e[0].value,t.maxDataValue=e[1].value),this.currentStopValues=e.map((e=>e.value));const n=(0,a.aJ)(this.getZoomStops(),s?s.minSliderValue:l.minSliderValue,s?s.maxSliderValue:l.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!n||n.minMaxSame||!(0,a.O)(n.min)&&!(0,a.O)(n.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,l?(0,r.l)().then((e=>(0,a.u)(e)),(e=>this.arcgisSmartMappingSizeSliderError.emit(e))):(0,a.u)()}updateRendererBreaks(e){const i=(0,a.b)();i.authoringInfo.classificationMethod="manual",i.classBreakInfos.forEach(((i,t)=>{if(i.minValue!==e[t].min||i.maxValue!==e[t].max){i.minValue=e[t].min,i.maxValue=e[t].max;const s=t>0?"> ":"";i.label=`${s} ${(0,a.aH)(i,this.sizeSlider.precision)}`,this.currentBreakValues[t].min=e[t].min,this.currentBreakValues[t].max=e[t].max}})),(0,a.u)(),this.arcgisSmartMappingSizeSliderChange.emit()}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){var e,i;const t=(0,a.b)(),s=(0,a.a)(),l=(0,a.d)(t,"size"),n=(0,a.k)(),o=["color-size","color-age-size","color-size-age","type-size","type-size-age"].indexOf(s)>-1&&n.length>1?n[1]:"relationship-size"===s?n[2]:n[0];return o.expression=null!==(e=null==l?void 0:l.valueExpression)&&void 0!==e?e:null,o.expressionTitle=null!==(i=null==l?void 0:l.valueExpressionTitle)&&void 0!==i?i:null,o}handleZigzagClick(e){var i,t,s,l,n,o;const{statistics:r}=this,d=(0,a.b)(),c=(0,a.J)(d,"reference-size")||{},h=(0,a.J)(d,"size")||{},u=this.getFieldInfo(),m=this.getNormalizationField(),p=h?h.minSliderValue===h.maxSliderValue:c.minSliderValue===c.maxSliderValue;this.getHistogram(u,m,r,null!==(i=null==e?void 0:e.min)&&void 0!==i?i:p?r.min:null!==(s=null!==(t=null==h?void 0:h.minSliderValue)&&void 0!==t?t:null==c?void 0:c.minSliderValue)&&void 0!==s?s:r.min,null!==(l=null==e?void 0:e.max)&&void 0!==l?l:p?r.max:null!==(o=null!==(n=null==h?void 0:h.maxSliderValue)&&void 0!==n?n:null==c?void 0:c.maxSliderValue)&&void 0!==o?o:r.max),e||(this.sliderZoomed=!1)}getNormalizationField(){const e=(0,a.b)(),i=(0,a.d)(e,"size"),t=(0,a.J)(e,"reference-size");return i?i.normalizationField:t?t.normalizationField:e.normalizationField}getZoomStops(){const e=(0,a.b)(),i=(0,a.d)(e,"size"),t=(0,a.J)(e,"reference-size");return i?[{value:i.minDataValue},{value:i.maxDataValue}]:[{value:t.sizeStops[0].value},{value:t.sizeStops[1].value}]}get hostElement(){return(0,s.d)(this)}};k.style=".slider-box{height:320px}.slider-box .esri-size-slider,.slider-box .esri-classed-size-slider{min-width:200px}.slider-box .esri-size-slider .esri-slider .esri-slider__content,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-size-slider__histogram-container,.slider-box .esri-classed-size-slider__histogram-container{width:85px}.slider-box .esri-size-slider .esri-slider .esri-slider__label,.slider-box .esri-size-slider .esri-slider .esri-slider__min,.slider-box .esri-size-slider .esri-slider .esri-slider__max,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__label,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__min,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-size-slider .esri-slider .esri-slider__max:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}.slider-container{overflow:hidden}";const M=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolPairButtonChange=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonChange",7),this.arcgisSmartMappingSymbolPairButtonBeforeOpen=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonBeforeOpen",7),this.arcgisSmartMappingSymbolPairButtonError=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonError",7),this.symbolPairPopoverOpen=!1,this.symbolType=void 0}arcgisSmartMappingClosePopoversHandler(){var e;this.symbolPairPopoverOpen=!1,this.symbolPairPopoverNode&&(null===(e=this.symbolPairPopoverNode.parentNode)||void 0===e||e.removeChild(this.symbolPairPopoverNode),this.symbolPairPopoverNode=null)}componentWillLoad(){const{strings:e}=a.s;this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item"),this.allSymbolPairs="above-and-below"===this.symbolType?[["single",e.symbolPairButton.singleSymbol],["circle",e.symbolPairButton.circles],["square",e.symbolPairButton.squares],["caret",e.symbolPairButton.chevrons],["circle-caret",e.symbolPairButton.circlesChevrons],["arrow",e.symbolPairButton.arrows],["circle-arrow",e.symbolPairButton.circleArrows],["plus-minus",e.symbolPairButton.plusMinus],["circle-plus-minus",e.symbolPairButton.circlePlusMinus],["happy-sad",e.symbolPairButton.faces],["triangle",e.symbolPairButton.triangles],["thumb",e.symbolPairButton.thumbs]]:[["circle",e.symbolPairButton.circles],["square",e.symbolPairButton.squares],["diamond",e.symbolPairButton.diamonds],["hexagon-pointy",e.symbolPairButton.hexagonsPointy],["hexagon-flat",e.symbolPairButton.hexagonsFlat]]}render(){const{strings:e}=a.s,i=(0,a.b)(),t=i.authoringInfo,l=(0,a.J)(i,"reference-size"),n="above-and-below"===this.symbolType?t.univariateSymbolStyle:l.referenceSizeSymbolStyle;let o=e.symbolPairButton.singleSymbol;return this.allSymbolPairs.forEach((e=>{n===e[0]&&(o=e[1])})),"custom"===n&&(o=e.symbolPairButton.custom),(0,s.h)("calcite-label",{key:"bdfcedf83921c583d27b4331e157e031ed88b81e"},"above-and-below"===this.symbolType?e.symbolPairButton.symbolPair:e.symbolPairButton.referenceSizeShape,(0,s.h)("calcite-button",{key:"12e5730a9682fa2763418ff398cab82872dcaef6",ref:e=>this.symbolPairButtonNode=e,alignment:"icon-end-space-between",iconEnd:"chevron-down",appearance:"outline-fill",width:"full",role:"button",kind:"neutral","aria-haspopup":"true",label:e.symbolPairButton.symbolPair,onClick:()=>this.symbolPairPopoverOpen?(0,a.m)():this.handleSymbolPairClick()},o))}handleSymbolPairClick(){this.arcgisSmartMappingSymbolPairButtonBeforeOpen.emit();const e=document.createElement("arcgis-smart-mapping-symbol-pair-popover");this.symbolPairPopoverNode=e,e.popoverProps={refElement:this.flowItemNode,placement:"leading",offsetDistance:0,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!1},e.symbolPairs=this.allSymbolPairs,e.addEventListener("arcgisSmartMappingSymbolPairPopoverClose",(()=>this.closePopover())),e.addEventListener("arcgisSmartMappingSymbolPairPopoverChange",(e=>{this.closePopover();const{layer:i,mapView:t}=a.s,l=e.detail,o=(0,a.b)(),d=(0,a.J)(o,"reference-size"),c="above-and-below"===this.symbolType?{symbolStyle:l}:{layer:i,view:t,fieldInfos:[{field:d.field}],theme:"reference-size",referenceSizeOptions:{symbolStyle:l},normalizationField:d.normalizationField},h="above-and-below"===this.symbolType?p.b:r.f;(0,n.r)(h(c),this.flowItemNode).then((async e=>{if(d){const e=await(0,r.l)({referenceSizeOptions:{symbolStyle:l}});e&&(0,a.u)(e)}else(0,a.u)(e.renderer);(0,s.f)(this.hostElement),this.arcgisSmartMappingSymbolPairButtonChange.emit()}),(e=>this.arcgisSmartMappingSymbolPairButtonError.emit(e)))})),e.addEventListener("arcgisSmartMappingSymbolPairPopoverDisconnected",(()=>this.closePopover())),document.body.appendChild(e),this.symbolPairPopoverOpen=!0}closePopover(){var e;this.symbolPairPopoverOpen=!1,this.symbolPairPopoverNode&&(null===(e=this.symbolPairPopoverNode.parentNode)||void 0===e||e.removeChild(this.symbolPairPopoverNode),this.symbolPairPopoverNode=null,setTimeout((()=>this.symbolPairButtonNode.setFocus()),300))}get hostElement(){return(0,s.d)(this)}};M.style=".symbol-pair-name{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);outline-color:var(--calcite-color-foreground-3);outline-width:1px;outline-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.symbol-pair-name:hover{outline-width:2px}.symbol-pair-name:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}";const V=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolPairPopoverClose=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverClose",7),this.arcgisSmartMappingSymbolPairPopoverChange=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverChange",7),this.arcgisSmartMappingSymbolPairPopoverDisconnected=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverDisconnected",7),this.resizeObserver=new ResizeObserver((e=>{const i=e.pop();this.popoverWidth=1.05*i.contentRect.width,this.offsetDistance=-Math.round(1.025*this.popoverProps.refElement.getBoundingClientRect().width)})),this.popoverProps=void 0,this.symbolPairs=void 0,this.popoverWidth=void 0}async setFocus(){this.calcitePopoverNode.setFocus()}componentDidLoad(){requestAnimationFrame((()=>this.calcitePopoverNode.setFocus())),this.resizeObserver.observe(this.popoverProps.refElement)}disconnectedCallback(){this.arcgisSmartMappingSymbolPairPopoverDisconnected.emit(),this.resizeObserver.unobserve(this.popoverProps.refElement)}render(){const{strings:e}=a.s,i=(0,a.b)(),t=(0,a.J)(i,"reference-size"),l=this.popoverProps,n=l.refElement.getBoundingClientRect().height-105-50;return(0,s.h)(s.H,{key:"72317ece50fd20de7ee2e5bef4032b42f15bb423",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"75665e669453fafafdac3028b85c9a3a49612ee3",class:"js-app-flyout symbol-pair-popover",ref:e=>this.calcitePopoverNode=e,dir:a.s.isRTL?"rtl":"ltr",placement:"leading-start",open:!0,heading:t?e.symbolPairButton.referenceSizeShape:e.symbolPairButton.symbolPair,closable:!0,pointerDisabled:!0,referenceElement:l.refElement,offsetDistance:this.offsetDistance,offsetSkidding:105,overlayPositioning:l.overlayPositioning,triggerDisabled:l.triggerDisabled,label:t?e.symbolPairButton.referenceSizeShape:e.symbolPairButton.symbolPair,onCalcitePopoverClose:()=>this.arcgisSmartMappingSymbolPairPopoverClose.emit(),style:{width:`${this.popoverWidth}px`}},(0,s.h)("div",{key:"eb5f5da345aa3f56a2d95d08fd1c1ac7d3f4891c",class:"content",style:{maxHeight:.9*n+"px"}},(0,s.h)("calcite-list",{key:"cd26d872067c56d88b5cd59e79065f55e716dccd",selectionMode:"single-persist"},this.renderItems()))))}renderItems(){const e=(0,a.b)(),i=e.authoringInfo,t=(0,a.J)(e,"reference-size"),s=t?t.referenceSizeSymbolStyle:i.univariateSymbolStyle||"single",l=[];return this.symbolPairs.forEach((e=>l.push(this.renderItem(e[0],e[1],s===e[0])))),l}renderItem(e,i,t){const l=(0,a.b)(),n=l.authoringInfo,o=(0,a.J)(l,"reference-size"),r=e.charAt(0).toUpperCase()+e.slice(1)+".svg",d=o?`ReferenceSize_${r}`:r;return(0,s.h)("calcite-list-item",{label:i,selected:t,onClick:()=>{(o?o.referenceSizeSymbolStyle:n.univariateSymbolStyle||"single")!==e&&this.arcgisSmartMappingSymbolPairPopoverChange.emit(e)},onKeyDown:i=>{" "!==i.key&&"Enter"!==i.key||(i.preventDefault(),i.stopPropagation(),this.arcgisSmartMappingSymbolPairPopoverChange.emit(e))}},"single"!==e?(0,s.h)("calcite-action",{scale:"s",slot:"actions-end",text:"symbol-pair-symbols"},(0,s.h)("div",{style:{width:"32px",height:"32px",backgroundImage:`url(${(0,s.a)("./assets/arcgis-smart-mapping-symbol-pair-images/")}${d})`}})):null)}get hostElement(){return(0,s.d)(this)}};V.style=".symbol-pair-popover{z-index:100;}.content{overflow-y:auto}";const P=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingTileSelect=(0,s.c)(this,"arcgisSmartMappingTileSelect",7),this.arcgisSmartMappingTileOptions=(0,s.c)(this,"arcgisSmartMappingTileOptions",7),this.arcgisSmartMappingTileThemeChange=(0,s.c)(this,"arcgisSmartMappingTileThemeChange",7),this.arcgisSmartMappingTileError=(0,s.c)(this,"arcgisSmartMappingTileError",7),this.documentClickHandler=void 0,this.panelScrollHandler=void 0,this.keyupEventHandler=e=>{const{selected:i}=this;" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.removeInfoPopover(),i?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit(),e.preventDefault())},this.keydownEventHandler=e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())},this.clickEventHandler=e=>{var i,t;const{selected:s}=this;"CALCITE-CHECKBOX"!==(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.nodeName)&&"ARCGIS-SMART-MAPPING-THEME-BUTTON"!==(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.nodeName)&&(e.stopPropagation(),this.removeInfoPopover(),s?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit(),e.preventDefault())},this.checkboxChangeHandler=e=>{const{selected:i}=this;e.preventDefault();const t=e.target;t.checked?(this.removeInfoPopover(),i?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit()):t.checked=!0},this.tileType=void 0,this.type=void 0,this.selected=void 0,this.fields=void 0}async setFocus(){requestAnimationFrame((()=>{var e;return null===(e=this.tileNode)||void 0===e?void 0:e.focus()}))}componentWillLoad(){this.tileInfo=function(e,i){var t,s;const{selectedFields:l,strings:n}=a.s;let o=(0,a.i)()?"raster":(0,a.E)();"multipoint"===o&&(o="point");let r=l.length;(0,a.O)(r)||(r=1);const d=(0,a.i)()?(0,a.g)():(0,a.a)();let c=!1,h=!1;switch(l.length&&(c=l[0].simpleFieldType===a.w.DATE||"date-only"===(null===(s=null===(t=(0,a.t)(l[0].field))||void 0===t?void 0:t.layerField)||void 0===s?void 0:s.type),h=c,l.length>1&&(h=l[1].simpleFieldType===a.w.DATE)),e){case"simple":return{title:n.tile.simpleStyle,moreInfo:n.tile.tooltips.location,helpId:"120003675",imageFile:`${o}/Simple.png`};case"color":return{title:c?n.tile.colorStyleDate:n.tile.colorStyle,subText:-1===["gallery","assist"].indexOf(i)?l[0].expressionTitle||l[0].featureReductionExpressionTitle||(0,a.t)(l[0].field).label:"",moreInfo:c?n.tile.tooltips.colorDate:n.tile.tooltips.color,helpId:c?"120003262":"120003251",imageFile:c?`${o}/Color_Time.png`:`${o}/Color.png`};case"size":return{title:"chart-size"===d&&-1===["gallery","assist"].indexOf(i)?n.tile.sizeStyleChart:1===r&&c||2===r&&h?n.tile.sizeStyleDate:n.tile.sizeStyle,subText:-1===["gallery","assist"].indexOf(i)?"chart-size"===d||"predominance-size"===d?n.sumOfCategories:l[1].expressionTitle||l[1].featureReductionExpressionTitle||(0,a.t)(l[1].field).label:"",moreInfo:"predominance-size"===d?n.tile.tooltips.sizeForPredominance:1===r&&c||2===r&&h?n.tile.tooltips.sizeDate:n.tile.tooltips.size,helpId:1===r&&c||2===r&&h?"120003263":"120003252",imageFile:"chart-size"===d&&-1===["gallery","assist"].indexOf(i)?`${o}/ChartSizeSize.jpg`:1===r&&c||2===r&&h?`${o}/Size_Time.png`:`${o}/Size.png`};case"type":return{title:c?n.tile.typeStyleDate:n.tile.typeStyle,subText:-1===["gallery","assist"].indexOf(i)&&["type-size","type-size-age"].indexOf(d)>-1?l[0].expressionTitle||l[0].featureReductionExpressionTitle||(0,a.t)(l[0].field).label:"",moreInfo:c?n.tile.tooltips.typeDate:n.tile.tooltips.type,helpId:c?"120003266":"120003260",imageFile:`${o}/Type.png`};case"color-age":return{title:n.tile.colorAgeStyle,subText:-1===["gallery","assist"].indexOf(i)?l[0].expressionTitle||l[0].featureReductionExpressionTitle||(0,a.t)(l[0].field).label:"",moreInfo:n.tile.tooltips.colorAge,helpId:"120003264",imageFile:`${o}/Color_Age.png`};case"size-age":return{title:n.tile.sizeAgeStyle,subText:-1===["gallery","assist"].indexOf(i)?l[1].expressionTitle||l[1].featureReductionExpressionTitle||(0,a.t)(l[1].field).label:"",moreInfo:n.tile.tooltips.sizeAge,helpId:"120003265",imageFile:`${o}/Size_Age.png`};case"color-size":return{title:n.tile.colorSizeStyle,moreInfo:c?h?n.tile.tooltips.colorDate_SizeDate:n.tile.tooltips.colorDate_Size:h?n.tile.tooltips.color_SizeDate:n.tile.tooltips.color_Size,helpId:"120003254",imageFile:c||h?`${o}/ColorSize_Time.png`:`${o}/ColorSize.png`};case"color-age-size":return{title:n.tile.colorAgeSizeStyle,moreInfo:n.tile.tooltips.colorAge_Size,helpId:"120003267",imageFile:`${o}/ColorSize_Age.png`};case"color-size-age":return{title:n.tile.colorSizeAgeStyle,moreInfo:n.tile.tooltips.color_SizeAge,helpId:"120003267",imageFile:`${o}/ColorSize_Age.png`};case"type-size":return{title:n.tile.typeSizeStyle,moreInfo:c?n.tile.tooltips.typeDate_Size:h?n.tile.tooltips.type_SizeDate:n.tile.tooltips.type_Size,helpId:"120003261",imageFile:h?`${o}/TypeSize_Time.png`:`${o}/TypeSize.png`};case"type-size-age":return{title:n.tile.typeSizeAgeStyle,moreInfo:n.tile.tooltips.type_SizeAge,helpId:"120003268",imageFile:`${o}/TypeSize_Age.png`};case"dot-density":return{title:n.tile.dotDensityStyle,moreInfo:n.tile.tooltips.dotDensity,helpId:"120003253",imageFile:`${o}/DotDensity.png`};case"heatmap":return{title:n.tile.heatmapStyle,moreInfo:n.tile.tooltips.heatMap,helpId:"120003250",imageFile:`${o}/HeatMap.png`};case"relationship":return{title:n.tile.relationshipStyle,subText:-1===["gallery","assist"].indexOf(i)&&"relationship-size"===d?[(0,a.t)(l[0].field).label,(0,a.t)(l[1].field).label]:"",moreInfo:n.tile.tooltips.relationship,helpId:"120003258",imageFile:`${o}/Relationship.png`};case"relationship-size":return{title:n.tile.relationshipSizeStyle,moreInfo:n.tile.tooltips.relationshipSize,helpId:"120003259",imageFile:`${o}/RelationshipSize.png`};case"predominance":return{title:n.tile.predominanceStyle,moreInfo:n.tile.tooltips.predominance,helpId:"120003256",imageFile:`${o}/Predominance.png`};case"predominance-size":return{title:n.tile.predominanceSizeStyle,moreInfo:n.tile.tooltips.predominanceSize,helpId:"120003257",imageFile:`${o}/PredominanceSize.png`};case"chart":return{title:"chart-size"===d&&-1===["gallery","assist"].indexOf(i)?n.tile.chartStyleColor:n.tile.chartStyle,moreInfo:n.tile.tooltips.chart,helpId:"120003729",imageFile:`${o}/Chart.jpg`};case"chart-size":return{title:n.tile.chartSizeStyle,moreInfo:n.tile.tooltips.chartSize,helpId:"120003730",imageFile:`${o}/ChartSize.jpg`};case"compare":return{title:n.tile.compareStyle,moreInfo:n.tile.tooltips.compare,helpId:"120003255",imageFile:`${o}/Ratio.png`};case"raster-stretch":return{title:n.tile.symbologyStretchStyle,moreInfo:n.tile.tooltips.stretch,helpId:"120003269",imageFile:`${o}/stretch.png`};case"raster-rgb":return{title:n.tile.symbologyRGBStyle,moreInfo:n.tile.tooltips.rgb,helpId:"120003270",imageFile:`${o}/rgb.png`};case"raster-unique-value":return{title:n.tile.symbologyUniqueValuesStyle,moreInfo:n.tile.tooltips.uniqueValues,helpId:"120003271",imageFile:`${o}/uniqueValues.png`};case"raster-shaded-relief":return{title:n.tile.symbologyShadedReliefStyle,moreInfo:n.tile.tooltips.shadedRelief,helpId:"120003273",imageFile:`${o}/shadedRelief.png`};case"raster-vector-field":return{title:n.tile.symbologyVectorFieldStyle,moreInfo:n.tile.tooltips.vectorField,helpId:"120003275",imageFile:`${o}/vectorField.png`};case"raster-colormap":return{title:n.tile.symbologyColormapStyle,moreInfo:n.tile.tooltips.colormap,helpId:"120003274",imageFile:`${o}/colormap.png`};case"raster-class-breaks":return{title:n.tile.symbologyClassBreaksStyle,moreInfo:n.tile.tooltips.classify,helpId:"120003272",imageFile:`${o}/classBreaks.png`};case"raster-flow":return{title:n.tile.rasterFlowStyle,moreInfo:n.tile.tooltips.flow,helpId:"120003676",imageFile:`${o}/flow.png`}}}(this.type,this.tileType)}componentDidLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}disconnectedCallback(){this.removeInfoPopover()}render(){const{selected:e,tileInfo:i,tileType:t}=this,{title:l,imageFile:n}=i,{strings:o}=a.s,r="rtl"===(0,f.g)(this.hostElement),d={tile:!0,"tile-selected":e},c={"tile-image":"assist"!==t,"tile-image-selected":"gallery"===t&&e,rtl:r},h={"tile-check":!0,rtl:r};return(0,s.h)(s.H,{key:"7f607f6ef7ca7e7de2693838f62b59f96a644ee7","aria-label":`${l} ${e?"assist"===t?o.tile.customize:o.tile.styleOptions:o.tile.selectStyle}`,"aria-selected":e,role:"button",tabindex:"0"},(0,s.h)("div",{key:"72c6e0ce5eb139a41c2db0dbcc76592500e95a5c",class:d,tabindex:"0",ref:e=>{this.tileNode=e,this.addTileListeners(e)}},(0,s.h)("div",{key:"396aa2fe7afd573e702aff3a6cf8d388cfe66ab5",class:c,style:{backgroundImage:`url(${(0,s.a)("./assets/arcgis-smart-mapping-thumbnails/")}${n})`},"aria-hidden":"true"}),("gallery"===t||"assist"===t)&&(0,s.h)("div",{key:"5ee6b6f53f2fba2ccc00f3f94f0f62a03747d077",class:h,"aria-label":"","aria-hidden":"true"},(0,s.h)("calcite-checkbox",{key:"3941ff600466fa246dc595f7c1880db82c3730c0",name:"style-tile-check-name",checked:e,tabindex:"-1",ref:e=>this.addCheckboxListener(e)})),this.renderTileLink()))}renderTheme(){const{layer:e}=a.s,{tileType:i,type:t}=this;if("imagery"===e.type||"imagery-tile"===e.type)return null;if("assist"===i)return null;const l=(0,a.a)();if("chart-size"===l)return null;if(-1===["color","size","color-age","size-age","color-size"].indexOf(t))return null;if(-1===["color","size","color-age","size-age","color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].indexOf(l))return null;if("gallery"===i&&["type-size","relationship-size","color-age-size","color-size-age","type-size-age"].indexOf(l)>-1)return null;const n=(0,a.b)(),o=n.authoringInfo,r="univariate-color-size"===(null==o?void 0:o.type),d=(0,a.J)(n,"reference-size");if("gallery"===i&&"color-size"===l&&!r)return null;const c=(0,a.d)(n,"color");if("gallery"===i&&"color"===l&&!c)return null;const h=(0,a.d)(n,"size");if("gallery"===i&&"size"===l&&!h&&!d)return null;const u="color-age"===t?"color":"size-age"===t?"size":"color-size"===t?"colorSize":t;return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:u,buttonVersion:"minimal",onArcgisSmartMappingThemeButtonChange:e=>this.changeTheme(e)})}changeTheme(e){const{layer:i,mapView:t}=a.s,{type:l}=this,d=(0,a.b)(),c=(0,a.a)(),h=(0,a.d)(d,"size"),u=(0,a.J)((0,a.b)(),"reference-size"),m=d.authoringInfo,g="univariate-color-size"===(null==m?void 0:m.type);if(("color"===l||"color-age"===l)&&["color","color-age","color-size","color-age-size","color-size-age"].indexOf(c)>-1){let i=o.b;["color-age","color-age-size"].indexOf(c)>-1&&(i=o.d),(0,n.r)(i({theme:e.detail}),this.flowItemNode).then((e=>{if(["color-size","color-age-size","color-size-age"].indexOf(c)>-1){const i=(0,a.b)();i.visualVariables=(0,a.T)(i,"color")||[],i.visualVariables.push((0,a.d)(e.renderer,"color")),i.authoringInfo.visualVariables=(0,a.U)(i,"color")||[],i.authoringInfo.visualVariables.push((0,a.J)(e.renderer,"color")),(0,a.u)()}else(0,a.u)(e.renderer);(0,s.f)(this.hostElement),(0,s.f)(this.themeButtonNode)}),(e=>this.arcgisSmartMappingTileError.emit(e)))}else if(("size"===l||"size-age"===l)&&["size","size-age","color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].indexOf(c)>-1){const l=u,o="reference-size"===e.detail,d=!l&&o||l&&!o;let m=r.f;["size-age","color-size-age","type-size-age"].indexOf(c)>-1?m=r.h:d&&(m=r.f);const p={theme:e.detail};o&&(p.referenceSizeOptions={symbolStyle:"circle"}),d&&(p.layer=i,p.mapView=t,p.fieldInfos=[{field:h?h.field:u.field}],p.noReuse=!0),(0,n.r)(m(p),this.flowItemNode).then((async l=>{var n,o,r;if(d)if(["type-size","relationship-size"].includes(c)){const{modules:e}=a.s,i=(0,a.b)();i.visualVariables=l.renderer.visualVariables,i.authoringInfo.visualVariables=l.renderer.authoringInfo.visualVariables,i.uniqueValueInfos.forEach((i=>{const t=(0,a.Q)(null==i?void 0:i.symbol)||new e.esriColor("gray"),s=l.renderer.classBreakInfos[0].symbol.clone();"cim"===s.type?e.cimSymbolUtils.applyCIMSymbolColor(s,t,{layersToColor:"fill-and-outline"}):(0,a.W)(s,t),i.symbol=s})),i.defaultSymbol=void 0,i.defaultLabel=void 0,i.backgroundFillSymbol=void 0,(0,a.u)(i)}else if("color-size"===c){const{modules:e,useFeatureReduction:s}=a.s,d=(0,a.b)(),c=(0,a.d)(d,"color"),h=(0,a.J)(d,"color"),{renderer:u}=await e.ColorCreator.createContinuousRenderer({layer:i,view:t,field:c.field,valueExpression:c.valueExpression,valueExpressionTitle:c.valueExpressionTitle,normalizationField:c.normalizationField,theme:null==h?void 0:h.theme,colorScheme:(0,a.R)(),forBinning:"binning"===(null===(n=i.featureReduction)||void 0===n?void 0:n.type)&&s});if(l.renderer.visualVariables.push(c),null===(r=null===(o=u.authoringInfo)||void 0===o?void 0:o.visualVariables)||void 0===r?void 0:r.length){const e=(0,a.J)(u,"color");l.renderer.authoringInfo.visualVariables.push(e)}l.renderer.field=c.field,l.renderer.valueExpression=c.valueExpression,l.renderer.valueExpressionTitle=c.valueExpressionTitle,l.renderer.normalizationField=c.normalizationField,(0,a.u)(l.renderer)}else(0,a.u)(l.renderer);else if(-1===["size","size-age"].indexOf(c)){const e=(0,a.b)();e.visualVariables=(0,a.T)(e,"size")||[],e.visualVariables.push((0,a.d)(l.renderer,"size")),e.authoringInfo.visualVariables=(0,a.U)(e,"size")||[],e.authoringInfo.visualVariables.push((0,a.J)(l.renderer,"size")),(0,a.u)()}else(0,a.u)(l.renderer);(0,s.f)(this.hostElement),(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingTileThemeChange.emit(e.detail)}),(e=>this.arcgisSmartMappingTileError.emit(e)))}else"color-size"===l&&g&&(0,n.r)((0,p.b)({theme:e.detail}),this.flowItemNode).then((e=>{(0,a.u)(e.renderer),(0,s.f)(this.hostElement),(0,s.f)(this.themeButtonNode)}),(e=>this.arcgisSmartMappingTileError.emit(e)))}renderTileLink(){const{selected:e,tileInfo:i,tileType:t,fields:l}=this,{title:n,subText:o}=i,{strings:r}=a.s,d={"style-link-text":!0,rtl:"rtl"===(0,f.g)(this.hostElement)};return(0,s.h)("div",{class:"style-link","aria-label":n},(0,s.h)("div",{class:"style-link-title "+("gallery"===t?"info":"")},(0,s.h)("div",{class:d,"aria-hidden":"true"},n),"gallery"===t&&(0,s.h)("calcite-action",{class:"style-link-info",scale:"s",icon:"information",compact:!0,onClick:e=>this.handleInfoClick(e),text:r.tile.moreInfo,ref:e=>{this.infoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e)})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}))}}),"gallery"!==t&&o&&(0,s.h)("div",{class:"style-link-sub-text"},"string"==typeof o?o:o.map((e=>(0,s.h)("div",null,e)))),"assist"===t&&!!(null==l?void 0:l.length)&&(0,s.h)("div",{class:"style-link-sub-text"},`${r.tile.fields} ${l.toString().replace(",",", ")}`)),"assist"!==t&&(e||"gallery"!==t)&&this.renderTheme(),(e||-1===["gallery","assist"].indexOf(t))&&this.renderStyleOptions())}renderStyleOptions(){const{tileType:e}=this,{strings:i}=a.s;return(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",scale:"s",kind:"assist"===e?"neutral":"brand",label:"assist"===e?i.tile.customize:i.tile.styleOptions},"assist"===e?i.tile.customize:i.tile.styleOptions)}handleInfoClick(e){e.stopPropagation();const{tileInfo:i,flowItemNode:t}=this,{title:s,moreInfo:l,helpId:n}=i,{config:o,strings:r}=a.s;this.removeInfoPopover(),this.infoPopoverNode=document.createElement("arcgis-smart-mapping-info-popover"),this.infoPopoverNode.props={title:s,moreInfo:l,helpId:n,config:o,flowItemNode:t,strings:r},this.infoPopoverNode.referenceElement=this.infoIconNode,this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>this.infoIconNode.setFocus()),200)})),this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),this.infoPopoverNode.setOpen(!0),setTimeout((()=>this.infoPopoverNode.setFocus()),100),setTimeout((()=>{this.documentClickHandler=e=>{(0,v.i)(e.target)||(this.removeInfoPopover(),setTimeout((()=>this.infoIconNode.setFocus()),200))},document.addEventListener("click",this.documentClickHandler),this.panelScrollHandler=()=>{this.removeInfoPopover()},null==t||t.addEventListener("calciteFlowItemScroll",this.panelScrollHandler)}),100)}removeInfoPopover(){const{flowItemNode:e}=this;document.body.querySelectorAll(".arcgis-smart-mapping-popover").forEach((e=>document.body.removeChild(e))),this.infoPopoverNode=null,this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),this.documentClickHandler=void 0),this.panelScrollHandler&&(null==e||e.removeEventListener("calciteFlowItemScroll",this.panelScrollHandler),this.panelScrollHandler=void 0)}addTileListeners(e){e.addEventListener("keyup",this.keyupEventHandler),e.addEventListener("keydown",this.keydownEventHandler),e.addEventListener("click",this.clickEventHandler)}addCheckboxListener(e){e.addEventListener("calciteCheckboxChange",this.checkboxChangeHandler)}get hostElement(){return(0,s.d)(this)}};P.style=".tile{background-color:white;position:relative;margin:6px;cursor:pointer;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0;transition:box-shadow 125ms ease-in-out}.tile:hover{z-index:5;box-shadow:0 1px 0 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.tile:focus{outline:2px solid var(--calcite-color-brand)}.tile-selected{box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px var(--calcite-color-brand)}.tile-selected:focus{box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 2px var(--calcite-color-brand)}.tile-selected:hover{z-index:5;box-shadow:0 1px 0 2px rgba(0, 0, 0, 0.05), 0 0 0 1px var(--calcite-color-brand)}.tile-check{position:absolute;top:10px;right:10px}.tile-check.rtl{right:auto;left:10px}.style-link{padding:9px 9px}.style-link-icon{margin-top:-1px}.style-link-text{margin-right:10px}.style-link-text.rtl{margin-right:0;margin-left:10px}.style-link-title{font-weight:bold;padding-bottom:5px}.style-link-title.info{display:flex}.style-link-sub-text{font-size:80%;padding:0 0 6px 0;font-weight:normal}.style-link-options{color:#0079c1;display:flex;flex-direction:row nowrap}.style-link-options svg{fill:#0079c1}.tile-image{height:100px;width:100%;background-size:cover;display:flex;align-items:center;justify-content:center}.tile-image-selected{height:68px}.tile-image.rtl{transform:scaleX(-1)}.style-sub-text{font-size:80%;padding:0 0 6px 0}.style-link-info{height:18px}"},59101:(e,i,t)=>{t.d(i,{w:()=>a});t(77040),t(70506);var s=t(82646);function a(e,i){const{layer:t,mapView:a,useFeatureReduction:n}=s.s;if(!n||!("featureReduction"in t)||"binning"!==t.featureReduction.type)return;const o=s.s.modules.reactiveUtils.watch((()=>a.scale),(()=>{const n=t.featureReduction;a.scale<=n.maxScale&&!e.disabled?((0,s.m)(),function(e,i){const t=document.createElement("arcgis-smart-mapping-scale-alert-popover");t.refElement=e,t.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{l(),i()})),document.body.append(t)}(e,i),(0,s.n)(e,!0)):a.scale>n.maxScale&&e.disabled&&(l(),(0,s.n)(e,!1),e.setFocus())}));return o}function l(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{var i;null===(i=e.parentElement)||void 0===i||i.removeChild(e),e=null}))}},89936:(e,i,t)=>{t.d(i,{a:()=>a,b:()=>n,d:()=>o,u:()=>l});t(77040),t(70506);var s=t(82646);function a(e,i){e.labelFormatFunction=e=>r(e,i,"short-date"),e.inputFormatFunction=e=>r(e,i,"short-date"),e.inputParseFunction=e=>function(e,i){if(!e)return e;let t;if(i&&"system"!==i)if("unknown"===i)t=e;else{const s=new Date;t=e+(new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:i})).getTime())}else{t=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(t).toISOString()),t}(Date.parse(e),i)}function l(e,i){let t;if(i&&"system"!==i)if("unknown"===i)t=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:i});t=new Date(new Date(a).getTime()-6e4*s).toISOString()}else{const i=(new Date).getTimezoneOffset();t=new Date(e-6e4*i).toISOString()}return t}function n(e,i,t){let s;if(i&&"system"!==i)if("unknown"===i)s=new Date(e).toISOString();else{const t=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:i});s=new Date(new Date(a).getTime()-6e4*t).toISOString()}else{const i=(new Date).getTimezoneOffset();s=new Date(e-6e4*i).toISOString()}return s=t?s.substring(11,19):s.substring(11,16),s}function o(e,i){let t,s=new Date(e);if(s=new Date(s.getTime()-6e4*s.getTimezoneOffset()),i&&"system"!==i)if("unknown"===i)t=s.getTime();else{const e=new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:i})).getTime();t=s.getTime()+e}else{const e=(new Date).getTimezoneOffset();t=s.getTime()+6e4*e}return t}function r(e,i,t){const{modules:a}=s.s;let l;return l="unknown"===i?a.intl.formatDate(e,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(t||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):a.intl.formatDate(e,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(t||"short-date-short-time")),{timeZone:i})),l}},11246:(e,i,t)=>{t.d(i,{a:()=>d,b:()=>u,c:()=>a,d:()=>s,e:()=>l,f:()=>c,g:()=>m,i:()=>n,m:()=>o,t:()=>r,u:()=>h});const s=(e,i)=>{let t,s="idle";const a=(...a)=>new Promise((l=>{switch(s){case"flushed":s="idle",t?(clearTimeout(t),l(e(...a))):l(null);break;case"invoked":clearTimeout(t),s="idle",l(e(...a));break;case"cancelled":clearTimeout(t),s="idle",l(null);break;default:t&&clearTimeout(t),s="pending",t=setTimeout((()=>(s="idle",l(e(...a)))),i)}}));return a.flush=function(...e){return s="flushed",a(...e)},a.invoke=function(...e){return s="invoked",a(...e)},a.cancel=function(...e){return s="cancelled",a(...e)},a.getStatus=function(){return s},a},a=(e,i)=>{let t;return(...s)=>new Promise((a=>{t||(t=setTimeout((()=>{clearTimeout(t),t=void 0,a(e(...s))}),i))}))};function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){return null!=e}async function o(e,i){return await Promise.all([e,r(i)]),e}function r(e){return new Promise((i=>setTimeout(i,e)))}const d=(e,i)=>Object.fromEntries((e||[]).map((e=>{const{key:t,data:s}=i(e);return[t,s]}))),c=(e,i)=>e.length===i.length&&e.reduce(((e,t)=>e&&i.indexOf(t)>-1),!0);function h(e,i){const t=[],s={};return e.forEach((e=>{const a=i(e);null==s[a]&&(s[a]=e,t.push(e))})),t}function u(e){const i={boolean:{},number:{},string:{}},t=[];return e.filter((e=>{let s=typeof e;return s in i?!i[s].hasOwnProperty(e)&&(i[s][e]=!0):!(t.indexOf(e)>=0)&&t.push(e)}))}const m=(e,i)=>[...Array(Math.ceil(e.length/i))].map(((t,s)=>e.slice(i*s,i+i*s)))},95875:(e,i,t)=>{let s,a;function l(e){e.loading=!1}function n(e,i){return function(e){e.loading=!0,a=!1,s&&clearTimeout(s),s=setTimeout((()=>{l(e),a=!0}),6e4)}(i),e.then((e=>(l(i),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(i),Promise.reject(e))))}t.d(i,{r:()=>n})},39062:(e,i,t)=>{function s(e){if("ARCGIS-SMART-MAPPING-INFO-POPOVER"===(null==e?void 0:e.tagName))return!0;{let i=null==e?void 0:e.parentElement;for(;i;){if("ARCGIS-SMART-MAPPING-INFO-POPOVER"===i.tagName)return!0;i=i.parentElement}}return!1}t.d(i,{i:()=>s})},13521:(e,i,t)=>{t.d(i,{a:()=>o,b:()=>n,g:()=>h,u:()=>l});var s=t(1991),a=t(82646);t(70506);function l(e){const{modules:i}=a.s,t=(0,a.b)(),l=i.esriLang.clone(t.classBreakInfos);t.classBreakInfos=[],l.forEach(((i,n)=>{i=function(e,i,t,l){if((0,s.i)(i))if(0===i);else if(i<1){const s=Math.round(1/i);e.minValue="first"===l?Math.floor(e.minValue/i)/s:Math.round(e.minValue/i)/s,e.maxValue="last"===l?Math.ceil(e.maxValue/i)/s:Math.round(e.maxValue/i)/s,e.label=`${t>0?"> ":""}${e.minValue.toLocaleString(a.s.fullLocale,{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(a.s.fullLocale,{maximumSignificantDigits:15})}`}else e.minValue="first"===l?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===l?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=(t>0?"> ":"")+e.minValue.toLocaleString()+" - "+e.maxValue.toLocaleString();return e}(i,e,n,0===n?"first":n===l.length-1?"last":void 0),t.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function n(e){const i=(0,a.b)().classBreakInfos;let t=e,s=1/0;i.forEach((e=>{t||(t=Math.max(r(e.minValue),r(e.maxValue))),s=Math.min(s,e.maxValue-e.minValue)}));const l=[];return s>1e7?(l.push(1e7),l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):s>1e6?(l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):s>1e5?(l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):s>1e4?(l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):s>1e3?(l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001)):s>100?(l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5)):s>10?(l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):s>1?(t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):s>.1?(t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):s>.01?(t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):s>.001?(t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7)):s>1e-4?(t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7),t>8&&l.push(1e-8)):s>1e-5&&(t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7),t>8&&l.push(1e-8),t>9&&l.push(1e-9)),l}function o(){const e=(0,a.b)();let i=1e10;return e.classBreakInfos.forEach((e=>{i=Math.min(i,d(e.minValue)),i=Math.min(i,d(e.maxValue))})),i}function r(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function d(e){let i=1e-8;for(;c(Math.round(e/i)*i)===e;)i*=10;return i/10}function c(e){return parseFloat(e.toPrecision(12))}function h(e){var i,t,a,l,n,o,d,h;let u=0;e.forEach((e=>{(0,s.i)(e.value)?u=Math.max(r(c(e.value)),u):((0,s.i)(e.minValue)&&(u=Math.max(r(c(e.minValue)),u)),(0,s.i)(e.maxValue)&&(u=Math.max(r(c(e.maxValue)),u)),(0,s.i)(e.min)&&(u=Math.max(r(c(e.min)),u)),(0,s.i)(e.max)&&(u=Math.max(r(c(e.max)),u)))})),u=Math.min(u,3);const m=e[0],p=e[e.length-1],g=Math.min(null!==(t=null!==(i=m.minValue)&&void 0!==i?i:m.min)&&void 0!==t?t:m.value,null!==(l=null!==(a=p.minValue)&&void 0!==a?a:p.min)&&void 0!==l?l:p.value),f=Math.max(null!==(o=null!==(n=m.maxValue)&&void 0!==n?n:m.max)&&void 0!==o?o:m.value,null!==(h=null!==(d=p.maxValue)&&void 0!==d?d:p.max)&&void 0!==h?h:p.value)-g;return f/e.length<2e-7?u=8:f/e.length<2e-6?u=7:f/e.length<2e-5?u=6:f/e.length<2e-4?u=5:f/e.length<.002?u=4:f/e.length<.02?u=3:f/e.length<.2?u=Math.max(u,2):f/e.length<2&&(u=Math.max(u,1)),Math.round(u)}},86749:(e,i,t)=>{t.d(i,{a:()=>o,b:()=>r,c:()=>n,d:()=>d});t(77040),t(70506);var s=t(82646),a=t(96533),l=t(64164);function n(e){const i=(0,s.a)(),t=(e=e||{}).fieldInfos.length>1?e.fieldInfos[1]:e.fieldInfos[0];if((0,a.s)({fieldInfos:[t]})&&["color-size","type-size"].indexOf(i)>-1){if((0,s.d)((0,s.b)(),"size")&&(0,s.b)().authoringInfo)return c((0,s.b)(),e).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}return(0,a.c)(Object.assign(Object.assign({},e),{fieldInfos:[e.fieldInfos[1]]})).then((i=>c(i.renderer,e).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))),(e=>Promise.reject(e)))}function o(e){const i=(0,s.a)(),t=(e=e||{}).fieldInfos.length>1?e.fieldInfos[1]:e.fieldInfos[0];if((0,a.s)({fieldInfos:[t]})&&["color-size-age","type-size-age"].indexOf(i)>-1){if((0,s.d)((0,s.b)(),"size")&&(0,s.b)().authoringInfo)return c((0,s.b)(),e).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}return(0,a.a)(Object.assign(Object.assign({},e),{fieldInfos:[e.fieldInfos[1]]})).then((i=>c(i.renderer,e).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))),(e=>Promise.reject(e)))}function r(e,i){return e=e||{},(0,a.f)(Object.assign(Object.assign({},e),{fieldInfos:e.fieldInfos?[e.fieldInfos[1]]:null})).then((t=>(0,l.a)(Object.assign(Object.assign({},e),{fieldInfos:e.fieldInfos?[e.fieldInfos[0]]:null})).then((e=>(h(e.renderer,t.renderer),e.backgroundFillSymbol=(0,s.b)().backgroundFillSymbol,"size"===i&&(e.statistics=t.statistics),Promise.resolve(e))),(e=>Promise.reject(e)))),(e=>Promise.reject(e)))}function d(e,i){const{modules:t}=s.s;return e=e||{},(0,a.h)(Object.assign(Object.assign({},e),{fieldInfos:e.fieldInfos?[e.fieldInfos[1]]:null})).then((a=>{if(delete e.units,delete e.startTime,delete e.endTime,(0,s.V)(e)){const e=(0,s.b)().clone();e.visualVariables=(0,s.T)(e,"size")||[];const i=(0,s.d)(a.renderer,"size");e.visualVariables.push(i),e.authoringInfo=e.authoringInfo||new t.AuthoringInfo({}),e.authoringInfo.visualVariables=(0,s.U)(e,"size")||[];const l=(0,s.J)(a.renderer,"size");return e.authoringInfo.visualVariables.push(l),Promise.resolve({renderer:e})}return(0,l.a)(Object.assign(Object.assign({},e),{fieldInfos:e.fieldInfos?[e.fieldInfos[0]]:null})).then((e=>(h(e.renderer,a.renderer),e.backgroundFillSymbol=(0,s.b)().backgroundFillSymbol,"size"===i&&(e.statistics=a.statistics),Promise.resolve(e))),(e=>Promise.reject(e)))}),(e=>Promise.reject(e)))}function c(e,i){const t=(0,s.a)();if((0,l.s)(i)&&["type","type-size","type-size-age"].indexOf(t)>-1){const i=(0,s.b)().clone();return h(i,e),Promise.resolve({renderer:i})}return(0,l.c)(Object.assign(Object.assign({},i),{fieldInfos:[i.fieldInfos[0]]})).then((i=>(h(i.renderer,e),Promise.resolve(i))),(e=>Promise.reject(e)))}function h(e,i){const{modules:t}=s.s;e.visualVariables=(0,s.T)(e,"size")||[],e.visualVariables=(0,s.T)(e,"size","auto")||[];const a=(0,s.d)(i,"size");e.visualVariables.push(a),e.authoringInfo=e.authoringInfo||new t.AuthoringInfo({}),e.authoringInfo.visualVariables=(0,s.U)(e,"size")||[];const l=(0,s.J)(i,"size");if(e.authoringInfo.visualVariables.push(l),(0,s.D)()){const t=i.classBreakInfos&&i.classBreakInfos.length?i.classBreakInfos[0].symbol:i.uniqueValueInfos&&i.uniqueValueInfos.length?i.uniqueValueInfos[0].symbol:(0,s.q)("type-size"),a=e.uniqueValueInfos.slice();a.map((e=>{const i=(0,s.Q)(e.symbol);e.symbol=t.clone(),(0,s.W)(e.symbol,i)})),e.uniqueValueInfos=a,e.backgroundFillSymbol=i.backgroundFillSymbol;const l=(0,s.d)(i,"size","outline");l&&e.visualVariables.push(l)}}}}]);