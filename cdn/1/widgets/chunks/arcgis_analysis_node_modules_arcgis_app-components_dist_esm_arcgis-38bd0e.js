/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-38bd0e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-38bd0e"],{99004:(e,t,i)=>{i.d(t,{c:()=>a,g:()=>r});var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},86308:(e,t,i)=>{i.r(t),i.d(t,{arcgis_field_calculate_editor:()=>s,arcgis_field_calculate_table:()=>n});var a=i(7263),r=i(11246),l=i(756);i(70506),i(78613),i(11935),i(99004);const s=class{constructor(e){(0,a.r)(this,e),this.arcgisFieldCalculateEditorScriptChange=(0,a.c)(this,"arcgisFieldCalculateEditorScriptChange",7),this.arcgisFieldCalculateEditorFilterChange=(0,a.c)(this,"arcgisFieldCalculateEditorFilterChange",7),this.arcgisFieldCalculateEditorOpenScrim=(0,a.c)(this,"arcgisFieldCalculateEditorOpenScrim",7),this.arcgisFieldCalculateEditorLanguageSelected=(0,a.c)(this,"arcgisFieldCalculateEditorLanguageSelected",7),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.hideSideBar=t.contentRect.width<=600})),this.debouncedScriptChange=(0,r.d)((e=>{this.arcgisFieldCalculateEditorScriptChange.emit(e)}),500),this.editorOpen=!1,this.script="",this.filterPanelWhere=void 0,this.filterPanelOpen=!1,this.selectedLanguage="Arcade",this.hideSideBar=void 0}async watchPropHandler(e,t){this.editorNode&&e!==t&&(this.editorNode.testData=await(0,l.b)(e))}async closeEditor(){this.editorOpen=!1}async openEditor(){this.editorOpen=!0}async openFilterPanel(){this.filterPanelOpen=!0}async closeFilterPanel(){this.filterPanelOpen=!1}async isTestResultValid(){try{let e=await this.editorNode.getTestResult();if("error"===e.type)return!1;return(0,l.v)(e.value).isFieldValid}catch(e){return!1}}render(){return(0,a.h)(a.H,{key:"16d83e270ee1b8ef3c80ac8cc78db0a758256871"},this.renderLanguageSelect(),this.renderFilterPanel(),this.renderEditor())}renderFilterPanel(){var e,t;if(!this.filterPanelOpen)return;const{isTable:i,layer:r,mapView:s,strings:n}=l.f;return(0,a.h)("arcgis-filter",{layer:r,mode:"layer-view",viewFilter:(null===(t=null===(e=r.featureEffect)||void 0===e?void 0:e.filter)||void 0===t?void 0:t.where)||null,view:i?null:s,dismissible:!1,hideButtons:!0,hideLayerTitle:!0,panelMaxHeight:"80vh",panelHeading:n.defineFilter,tipMsg:n.emptyFilterText,leadingText:n.filterPanelDescription,clearText:n.clearAll,withinModal:!0,onArcgisFilterWhereChange:e=>{this.arcgisFieldCalculateEditorFilterChange.emit(e.detail)}})}renderEditor(){const{strings:e}=l.f;return"Arcade"===this.selectedLanguage&&this.editorOpen?(0,a.h)("calcite-panel",{heading:e.arcadeExpression},(0,a.h)("arcgis-arcade-editor",{class:"arcade-editor",script:this.script,hideSideBar:this.hideSideBar,onArcgisScriptChange:e=>{e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),this.debouncedScriptChange(e.detail)},ref:async e=>{e&&(this.editorNode=e,e.profile=(0,l.d)(),e.testData=await(0,l.b)(this.filterPanelWhere),this.resizeObserver.observe(e))}})):null}renderLanguageSelect(){if(this.editorOpen||this.filterPanelOpen)return;const{arcadeSupported:e,layer:t,originalField:i,strings:r}=l.f,s=t.portalItem;let n=s.portal.urlKey?`//${s.portal.urlKey}.${s.portal.customBaseUrl}/home/item.html?id=${s.id}&sublayer=${t.layerId}`:`//${s.portal.portalHostname}/home/item.html?id=${s.id}&sublayer=${t.layerId}`;return n+=`&calculateFieldName=${i.name}#data`,(0,a.h)("calcite-panel",{heading:r.editorPanelHeading},(0,a.h)("calcite-label",{class:"language-select-text"},r.languageSelect),(0,a.h)("calcite-tile-select-group",{layout:"vertical",class:"language-select"},(0,a.h)("calcite-tile-select",{width:"full",checked:e,onClick:()=>this.arcgisFieldCalculateEditorLanguageSelected.emit(),onCalciteTileSelectChange:()=>this.selectedLanguage="Arcade"},(0,a.h)("div",{class:"language-select-description"},(0,a.h)("calcite-label",{class:"language-select-description-header"},r.arcade),(0,a.h)("calcite-label",null,r.idealFor,(0,a.h)("ul",{class:"language-select-description-text"},(0,a.h)("li",null,r.arcadeDescription1),(0,a.h)("li",null,r.arcadeDescription2))),(0,a.h)("calcite-notice",{kind:"danger",open:!e},(0,a.h)("div",{slot:"title"},r.languageNotSupported),(0,a.h)("div",{slot:"message"},t.portalItem.portal.isPortal?r.arcadeNotSupportedEN:r.arcadeNotSupported))))),(0,a.h)("div",{class:"sql-editor-temp"},(0,a.h)("calcite-label",{scale:"l"},r.sql),(0,a.h)("calcite-label",null,r.SQLdescription),(0,a.h)("calcite-button",{appearance:"outline-fill","icon-end":"launch-2",kind:"neutral",target:"_blank",href:n,onClick:()=>this.arcgisFieldCalculateEditorOpenScrim.emit()},r.calculateField)))}get hostElement(){return(0,a.d)(this)}static get watchers(){return{filterPanelWhere:["watchPropHandler"]}}};s.style=".sc-arcgis-field-calculate-editor-h{height:100%}.arcade-editor.sc-arcgis-field-calculate-editor{width:100%;height:100%}arcgis-arcade-editor.sc-arcgis-field-calculate-editor{z-index:var(--calcite-z-index-header)}.calculate-button.sc-arcgis-field-calculate-editor{display:inline-flex}.calculate-card.sc-arcgis-field-calculate-editor{cursor:pointer}.hidden.sc-arcgis-field-calculate-editor{display:none}.language-select-description.sc-arcgis-field-calculate-editor{display:flex;flex-direction:column;width:100%}.language-select-description-header.sc-arcgis-field-calculate-editor{font-weight:500}.language-select-description-text.sc-arcgis-field-calculate-editor{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm)}.language-select-text.sc-arcgis-field-calculate-editor{margin:20px 10px 0}.language-select.sc-arcgis-field-calculate-editor{margin:10px}.panel-border.sc-arcgis-field-calculate-editor{border:1px solid #e0e0e0}.sql-editor-temp.sc-arcgis-field-calculate-editor{margin:20px 10px 0}.editor-wrapper.sc-arcgis-field-calculate-editor{display:flex;flex-direction:column;align-items:center;margin:4rem 2rem;height:70vh;min-height:400px}";const n=class{constructor(e){(0,a.r)(this,e),this.arcgisFieldCalculateTableRecordCountUpdate=(0,a.c)(this,"arcgisFieldCalculateTableRecordCountUpdate",7)}async enableGeometry(){this.table&&(this.table.returnGeometryEnabled=!0,this.table.returnMEnabled=!0,this.table.returnZEnabled=!0,this.table.refresh())}async getMode(){return this.mode}async getLayer(){return this.layer}async calculateValues(){var e;const{layer:t,mapView:i,modules:a}=l.f;this.table.viewModel.store.itemCache.map((e=>e.feature)).forEach((e=>{this.calculateCellValues(e)})),this.table.refreshCellContent(),(null===(e=null==i?void 0:i.popup)||void 0===e?void 0:e.visible)&&(t.popupTemplate=new a.PopupTemplate({title:t.displayField?`{${t.displayField}}`:`{${t.objectIdField}}`,content:l.p}))}async noRowsVisible(){return 0===this.numVisibleRows}async refresh(e){var t;e?this.table.refreshCellContent():await(null===(t=this.table)||void 0===t?void 0:t.refresh())}async setMode(e){if(this.mode!==e)switch(this.mode=e,e){case"features":const e=this.getTestFeaturesTemplates();this.table.tableTemplate={columnTemplates:e};break;case"preview":const t=this.getPreviewValuesTemplates();this.table.tableTemplate={columnTemplates:t}}}async updateTableFilter(e,t){const i=this.getCombinedWhere(e,t),a=await this.queryForObjectIds(i);this.layer.definitionExpression=e,this.table.objectIds.removeAll(),a.length?(this.numVisibleRows=a.length,this.table.objectIds.addMany(a)):(this.numVisibleRows=0,this.table.objectIds.add(-1))}async componentWillLoad(){const{layer:e}=l.f;this.layer=e.clone(),await this.layer.load()}async componentDidLoad(){const{config:e}=l.f;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css"/>`);const t=await this.queryForObjectIds();this.table.objectIds.removeAll(),this.table.objectIds.addMany(t),this.numVisibleRows=t.length}render(){const{modules:e}=l.f;let t=[];switch(this.mode){case"features":t=this.getTestFeaturesTemplates();break;case"preview":t=this.getPreviewValuesTemplates()}return this.table=new e.FeatureTable({layer:this.layer,tableTemplate:{columnTemplates:t},visibleElements:{columnMenus:!1,header:!1,menu:!1,selectionColumn:!1},container:null}),(0,a.h)(a.H,{key:"224418b8ac4d4a0f5ee1ddd2e14d382c6b618ee0"},(0,a.h)("div",{key:t.toString(),ref:e=>{e&&(this.table.container=e)}}))}getTestFeaturesTemplates(){const{originalField:e}=l.f;let t=[];return this.layer.fields.forEach((i=>{i.name!==e.name&&t.push({type:"field",fieldName:i.name,label:i.alias})})),t.push(this.getOriginalFieldColumnTemplate()),t}getCombinedWhere(e,t){return e&&t?`(${e}) AND (${t})`:e||t}getPreviewValuesTemplates(){const{layer:e,originalField:t,strings:i}=l.f;let a=[];return a.push({type:"field",fieldName:e.objectIdField,label:e.fields.find((t=>t.name===e.objectIdField)).alias}),a.push(this.getOriginalFieldColumnTemplate()),a.push({type:"column",label:i.calculated,fieldName:`${t.name}Calculated`,sortable:!1,invalid:!1,textWrap:!0,formatFunction:({feature:e})=>{const{arcadeExecutor:t,calculatedValues:a,errors:r,invalidScript:s}=l.f;if(t){const n=e.attributes[this.layer.objectIdField];if(s)return"";if((0,l.a)(a[n]))return r[n]?a[n]:this.getCellDisplayValue(a[n]);if(r[n])return"";if(null==t?void 0:t.isAsync){const t=document.createElement("calcite-button");return t.appearance="transparent",t.innerHTML=i.testCalculation,t.iconEnd="play",t.onclick=async()=>{t.loading=!0,await(0,l.e)(e),this.table.refreshCellContent()},t}{const t=(0,l.h)(e);return r[n]?t:this.getCellDisplayValue(t)}}return""}}),a.push(this.getErrorsTemplate()),a}getErrorsTemplate(){const{originalField:e,strings:t}=l.f;return{type:"column",label:t.errors,fieldName:`${e.name}Errors`,sortable:!1,textWrap:!0,formatFunction:({feature:e})=>{const{calculatedValues:i,invalidScript:a,errors:s}=l.f,n=e.attributes[this.layer.objectIdField],c=(0,r.i)(s[n]);if(!(0,l.a)(i[n])&&!c&&!a)return null;const o=document.createElement("div"),d=document.createElement("calcite-icon");d.scale="s",d.icon=c||a?"exclamation-mark-triangle-f":"check-circle",d.classList.add(c||a?"warning-icon":"success-icon");const u=document.createElement("div");return u.innerHTML=c?s[n]:a?t.popupError:t.noErrors,o.append(d),o.append(u),o.classList.add("cell-with-icon"),o}}}getOriginalFieldColumnTemplate(){const{originalField:e,strings:t}=l.f;return{type:"column",label:"features"===this.mode?e.alias:t.original,fieldName:e.name,frozenToEnd:"features"===this.mode,sortable:!1,textWrap:!0,invalid:"features"===this.mode,formatFunction:({feature:t})=>{const{testFeatures:i}=l.f,a=t.attributes[this.layer.objectIdField];i[a]||(i[a]=t),"features"===this.mode&&this.calculateCellValues(t);const r=t.attributes[e.name];if((0,l.a)(r))return this.getCellDisplayValue(r)}}}async queryForObjectIds(e){const{numRecords:t}=l.f,i=this.layer.createQuery();i.returnGeometry=!1,i.num=t,i.where=e;const a=await this.layer.queryObjectIds(i);return this.arcgisFieldCalculateTableRecordCountUpdate.emit(a.length),a}calculateCellValues(e){const{arcadeExecutor:t,calculatedValues:i}=l.f;if(t){const a=e.attributes[this.layer.objectIdField];if(!(0,l.a)(i[a])){if(null==t?void 0:t.isAsync)return;(0,l.h)(e)}}}getCellDisplayValue(e){e=(0,l.i)(e);if([/^\s*(https?:\/\/([^\s]+))\s*$/i,/^\s*(tel:([^\s]+))\s*$/i,/^\s*(mailto:([^\s]+))\s*$/i,/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,/^\s*(iform:\/\/([^\s]+))\s*$/i,/^\s*(flow:\/\/([^\s]+))\s*$/i,/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,/^\s*(mspbi:\/\/([^\s]+))\s*$/i].find((t=>t.test(e)))){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t}if(/<\/?[a-z][\s\S]*>/i.test(e)){const t=document.createElement("span");return t.textContent=e,t}return e}get hostElement(){return(0,a.d)(this)}};n.style=":host{height:100%}.cell-with-icon{display:flex;align-items:center;-moz-column-gap:10px;column-gap:10px}.warning-icon{--calcite-ui-icon-color:var(--calcite-color-status-warning)}.success-icon{--calcite-ui-icon-color:var(--calcite-color-status-success)}"},70506:(e,t,i)=>{i.d(t,{e:()=>l});var a,r=i(99004),l={exports:{}};a=l.exports,r.c,function(e){var t={Promise:"undefined"!=typeof window?window.Promise:void 0},i="4.24",a="next";function r(e){if(e.toLowerCase()===a)return a;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function l(e){return void 0===e&&(e=i),"https://js.arcgis.com/".concat(e,"/")}function s(e){void 0===e&&(e=i);var t=l(e),s=r(e);if(s!==a&&3===s.major){var n=s.minor<=10?"js/":"";return"".concat(t).concat(n,"esri/css/esri.css")}return"".concat(t,"esri/themes/light/main.css")}function n(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function c(e,t){if(t){var i=document.querySelector(t);i.parentNode.insertBefore(e,i)}else document.head.appendChild(e)}function o(e){return document.querySelector('link[href*="'.concat(e,'"]'))}function d(e){return!e||r(e)?s(e):e}function u(e,t){var i=d(e),a=o(i);return a||c(a=n(i),t),a}var h={};function p(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-esri-loader","loading"),t}function g(e,t,i){var a;i&&(a=f(e,i));var r=function(){t(e),e.removeEventListener("load",r,!1),a&&e.removeEventListener("error",a,!1)};e.addEventListener("load",r,!1)}function f(e,t){var i=function(a){t(a.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",i,!1)};return e.addEventListener("error",i,!1),i}function m(e){void 0===e&&(e={}),h=e}function b(){return document.querySelector("script[data-esri-loader]")}function y(){var e=window.require;return e&&e.on}function v(e){void 0===e&&(e={});var i={};[h,e].forEach((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}));var a=i.version,r=i.url||l(a);return new t.Promise((function(e,t){var l=b();if(l){var s=l.getAttribute("src");s!==r?t(new Error("The ArcGIS API for JavaScript is already loaded (".concat(s,")."))):y()?e(l):g(l,e,t)}else if(y())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var n=i.css;n&&u(!0===n?a:n,i.insertCssBefore),g(l=p(r),(function(){l.setAttribute("data-esri-loader","loaded"),e(l)}),t),document.body.appendChild(l)}}))}function w(e){return new t.Promise((function(t,i){var a=window.require.on("error",i);window.require(e,(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];a.remove(),t(e)}))}))}function C(e,t){if(void 0===t&&(t={}),y())return w(e);var i=b(),a=i&&i.getAttribute("src");return!t.url&&a&&(t.url=a),v(t).then((function(){return w(e)}))}e.utils=t,e.loadModules=C,e.getScript=b,e.isLoaded=y,e.loadScript=v,e.setDefaultOptions=m,e.loadCss=u,Object.defineProperty(e,"__esModule",{value:!0})}(a)}}]);