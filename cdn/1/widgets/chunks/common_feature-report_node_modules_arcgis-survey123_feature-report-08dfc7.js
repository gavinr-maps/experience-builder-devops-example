"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_common_feature-report_node_modules_arcgis-survey123_feature-report-08dfc7"],{45402:(e,t,i)=>{i.r(t),i.d(t,{features_preview:()=>h,report_generator:()=>c,report_settings:()=>d,task_list:()=>u,template_chooser:()=>m});var s=i(98612),r=i(12542),o=i(26954),a=i(28593),l=i(45511);const n=e=>{const{folderId:t,start:i=1,num:s=10,authentication:r}=e,o=t?`/${t}`:"";return function(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}(e).then((t=>`${(0,a.d)(e)}/content/users/${t}${o}`)).then((e=>(0,a.r)(e,{httpMethod:"GET",authentication:r,params:{start:i,num:s}})))},h=class{constructor(e){(0,s.r)(this,e),this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.stateService=l.S.getService(),this.queryParameters=void 0,this.inputFeatureTemplate=void 0,this.featureCount=0,this.featureStr="",this.translator=void 0,this.reportLang=void 0,this.commonLang=void 0}componentWillLoad(){return this.stateService.subscribe("update-features-preview",(e=>{void 0!==e&&(this.inputFeatureTemplate=e),this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.init()})),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();this.translator=e,this.initTranslateData(e),this.stateService.subscribe("locale-data-changed",(e=>{this.initTranslateData(e)}))})).catch((e=>{this.reportService.showError(e)}))}initTranslateData(e){this.translator=e,this.commonLang=null==e?void 0:e.common,this.reportLang=null==e?void 0:e.customPrint}init(){let e=[];return this.getDisplayFields().then((t=>{e=t;let i=[];i=e;const s=JSON.parse(this.queryParameters);let a=10;s.resultRecordCount<10&&(a=s.resultRecordCount),s.orderByFields&&(s.orderByFields=s.orderByFields.replace("||",""));const l=Object.assign({url:r.P.featureLayerUrl,authentication:r.P.token,outFields:i,resultRecordCount:a},s),n="where"in l?l.where:null,h="objectIds"in l?l.objectIds:null,c={};return null!==n&&(c.where=n),null!=h&&(c.objectIds=h),h||n||(c.where="1<>1",delete c.objectIds),l.params=c,delete l.where,delete l.objectIds,(0,o.q)(l)})).then((t=>{if(0===this.featureCount)return this.featureStr=this.commonLang.noResults,!0;const i=t.fields||[],s={};i.forEach((e=>{s[e.name]=e}));const r=this.featureCount>10?10:this.featureCount,o=t.features.splice(0,r);return this.featureStr=o.map((t=>{let i=this.inputFeatureTemplate;return e.forEach((e=>{const r=this.utilService.formatFieldVal(s[e],t.attributes[e]);i=i.replace(`{${e}}`,r)})),i})).join("<br>"),this.featureCount>10&&(this.featureStr+=`<br>...(${this.utilService.formatNumber(this.featureCount-10)} ${this.commonLang.more||"more"})`),!0})).catch((e=>{this.reportService.showError(e)}))}getDisplayFields(){let e=[];return this.reportService.getLayerJson().then((t=>{if(this.inputFeatureTemplate){const i=t.fields||[];return(this.inputFeatureTemplate.match(/\{.*?\}/g)||[]).forEach((t=>{const s=t.substring(1,t.length-1),r=i.find((e=>e.name===s));e.indexOf(s)<0&&r&&e.push(s)})),e.length||(e=[t.objectIdField||"objectid"]),e}if(t.displayField)this.inputFeatureTemplate="{"+t.displayField+"}",e=[t.displayField];else{const i=t.fields||[],s=Object.keys(t.editFieldsInfo||{}).map((e=>t.editFieldsInfo[e])).concat([t.objectIdField||"",t.globalIdField||""]),r=i.find((e=>!s.includes(e.name)&&"esriFieldTypeString"===e.type)),o=i.find((e=>!s.includes(e.name)&&this.utilService.isNumberField(e))),a=i.find((e=>!s.includes(e.name)&&!this.utilService.isNumberField(e)&&"esriFieldTypeString"!==e.type)),l=r||o||a||i[0];l&&(this.inputFeatureTemplate="{"+l.name+"}",e=[l.name])}return e}))}render(){var e,t;return(0,s.h)(s.H,{key:"165fd7b654e94f02757108f0fdb21c4be6e907f7"},(0,s.h)("div",{key:"5040af8788ea7bd19be178e6847fb533a137bdf8"},(0,s.h)("div",{key:"84e8973c0b7be9740812f0c3ea381c80494cdb30",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.inputFeatures," (",this.featureCount,")"),(0,s.h)("div",{key:"abb2de6307e3fc7c56168f7da88a18fd2e620d9f",innerHTML:this.featureStr})),(0,s.h)("slot",{key:"a492cf71b89ad255004b98bd2eaf99a165b480e7"}))}};h.style=":host{display:block;min-height:200;padding:0 0.75rem;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2)}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}";const c=class{constructor(e){(0,s.r)(this,e),this.reportCreated=(0,s.c)(this,"reportCreated",7),this.batchPrintLimitCount=2e3,this.checkingList=[],this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.state=l.S.getService(),this.featureCount=void 0,this.supportShowCredits=!0,this.printTemplates=[],this.langObj=void 0,this.creditsInfo=void 0,this.creditStatus=void 0,this.testModeJobObj=void 0,this.isTestModePrinting=void 0,this.visibleConf=void 0,this.templateItemId=void 0,this.isPrinting=void 0,this.translator=void 0}componentWillLoad(){return this.checkPrivilige(),this.printTemplates=this.reportService.getHelperObj("printTemplates")||[],this.state.subscribe("print-templates-updated",(e=>{this.printTemplates=e||[]})),this.state.subscribe("portal-info-update",(()=>{this.checkPrivilige()})),this.state.subscribe("feature-count-updated",(()=>{this.checkPrivilige()})),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();this.translator=e,this.state.subscribe("locale-data-changed",(e=>{this.translator=e}))}))}checkPrivilige(){this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.isPortal=this.utilService.isPortal;const e=this.utilService.supportFeatureReport(),t=this.utilService.isUserCanPrintFeatureReport();this.canShowEstimateCredits=!!e&&t,this.supportShowCredits=!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits}estimateCredits(){if(!(this.featureCount>this.batchPrintLimitCount)&&!(this.featureCount<1)&&this.printTemplates&&this.printTemplates.length&&(!this.creditsInfo||"estimating"!==this.creditStatus)){const e=this.reportService.getParamCache().templateItemId||r.P.templateItemId,t={queryParameters:r.P.queryParameters,featureLayerUrl:r.P.featureLayerUrl,templateItemId:e,surveyItemId:r.P.surveyItemId};this.creditStatus="estimating",this.creditsInfo=this.creditsInfo||{},this.reportService.estimateReportCosts(t).then((t=>{if(!t.resultInfo)throw t.error;this.creditsInfo=t.resultInfo,this.creditStatus="finished",this.creditsInfo.lastCalculatedCount=this.featureCount,this.creditsInfo.lastSelectedTemplateId=e})).catch((e=>{this.reportService.showError(e),this.creditStatus="changed"}))}}buttonClickable(){return!!this.templateItemId||!(!this.printTemplates||!this.printTemplates.length)}executeCustomPrint(e){var t;const i=this.reportService.getParamCache();if(e&&this.isTestModePrinting)return;if(this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.featureCount<1)return void this.reportService.showError({},{errorStr:null===(t=this.translator)||void 0===t?void 0:t.common.noResults});if(e?this.isTestModePrinting=!0:this.isPrinting=!0,e){const e={queryParameters:r.P.queryParameters,templateItemId:i.templateItemId||r.P.templateItemId,surveyItemId:r.P.surveyItemId,featureLayerUrl:r.P.featureLayerUrl,outputReportName:i.outputPackageName||r.P.outputPackageName||i.outputReportName||r.P.outputReportName||""};if(e.outputReportName){const t=this.utilService.extractPlaceholders(e.outputReportName);t&&t.length||(e.outputPackageName=e.outputReportName)}const t=i.mergeFiles||r.P.mergeFiles;return t&&"none"!==t&&(e.mergeFiles=t),this.reportService.createSampleReport(e).then((e=>{var t,i;e&&e.success?(this.testModeJobObj=e,this.watchTestModeJob()):(this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1}))}let s=i.outputPackageName||r.P.outputPackageName||i.outputReportName||r.P.outputReportName||"";return s.length>250&&(s=s.substr(0,250)),Promise.resolve().then((()=>{let e=null;e=i.uploadInfo||r.P.uploadInfo||{type:"arcgis",parameters:{},conflictBehavior:"rename"};const t=r.P.packageFiles+""=="true"||r.P.packageFiles+""!="false"&&"auto",o={queryParameters:r.P.queryParameters,templateItemId:i.templateItemId||r.P.templateItemId,outputReportName:s||"",featureLayerUrl:r.P.featureLayerUrl,uploadInfo:JSON.stringify(e),packageFiles:t};if(r.P.surveyItemId&&(o.surveyItemId=i.surveyItemId||r.P.surveyItemId),(i.outputFormat||r.P.outputFormat)&&(o.outputFormat=i.outputFormat||r.P.outputFormat),r.P.webmapItemId&&(o.webmapItemId=r.P.webmapItemId),(Number(r.P.mapScale)||0===Number(r.P.mapScale))&&(o.mapScale=Number(r.P.mapScale)),r.P.locale){let e=r.P.locale;"en-US"===e&&(e="en-us"),o.locale="||"+e}r.P.utcOffset&&(o.utcOffset=r.P.utcOffset);const a=i.outputPackageName||r.P.outputPackageName;a&&(o.outputPackageName=a);const l=i.mergeFiles||r.P.mergeFiles;l&&"none"!==l&&(o.mergeFiles=l);let n=null;this.reportService.executeReport(o).then((e=>{var t,i;if(e&&e.success)return n=e.jobId,this.reportService.checkJobStatus(n);this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error.message}),this.isPrinting=!1})).then((()=>{this.queryJobTimmer&&clearTimeout(this.queryJobTimmer),this.queryJobTimmer=setTimeout((()=>{this.reportService.queryJobs(!0).then((e=>{this.checkingList.push(n),this.reportCreated.emit({jobId:n,checkingList:this.checkingList,jobs:(null==e?void 0:e.jobs)||[]}),this.isPrinting=!1}))}),100)})).catch((e=>{var t,i;const s=this.reportService.getErrorStr(e);this.reportService.showError(e,{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:s}),this.isPrinting=!1}))}))}watchTestModeJob(){if(!this.testModeJobObj)return;const e=this.testModeJobObj.jobId,t=()=>this.reportService.checkJobStatus(e).then((e=>{var i,s;if(this.testModeJobObj=e,"esriJobSucceeded"===e.jobStatus||"esriJobPartialSucceeded"===e.jobStatus)return this.reportService.downloadFile(e),this.isTestModePrinting=!1,"esriJobPartialSucceeded"===e.jobStatus&&this.reportService.showError({},{alertType:"warning",errorStr:null===(s=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===s?void 0:s.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),!0;if("esriJobFailed"===this.testModeJobObj.jobStatus)throw this.isTestModePrinting=!1,e;if(e.error)throw e.error;setTimeout((()=>{t()}),1500)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),this.isTestModePrinting=!1}));t()}render(){var e,t,i,r,o,a,l,n,h,c,d,u,m,p,v;return(0,s.h)(s.H,{key:"96d5de8b07382eac3df810b3ceccc199bcac5559"},(0,s.h)("p",{key:"56c4f7d1d4989b5cb0255a7255d5473b561262f8"},this.supportShowCredits),this.supportShowCredits&&this.visibleConf.indexOf("showCredits")>=0?(0,s.h)("div",{class:"credits-info"},(0,s.h)("div",{class:"show-credits has-spinner"},this.creditsInfo&&"estimating"===this.creditStatus?(0,s.h)(s.F,null,(0,s.h)("span",{class:""+(this.featureCount<1||!this.printTemplates.length?"disabled":""),onClick:()=>this.estimateCredits()},`${null===(e=this.translator)||void 0===e?void 0:e.common.calculating}`),(0,s.h)("calcite-loader",{label:null===(t=this.translator)||void 0===t?void 0:t.common.calculating,inline:"true"})):(0,s.h)("calcite-link",{disabled:`${this.featureCount<1||!this.printTemplates.length}`,onClick:()=>this.estimateCredits()},`${null===(r=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===r?void 0:r.creditsEstimate}`)),this.creditsInfo&&"finished"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,s.h)("div",{class:"credits-result-info"},(0,s.h)("span",null,null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.creditsRecordsCount.replace("${$recordsCount}",`${this.featureCount}`).replace("${$requiredCredits}",`${this.creditsInfo.cost}`))):"",this.creditsInfo&&"changed"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,s.h)("div",{class:"credits-result-info"},(0,s.h)("span",null,null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.credtisResultInvalid)):""):"",(0,s.h)("div",{key:"217d0e0be374cfff075fac1044f0730d98eb7b6b",class:"execute-btn "+(!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits?"":"portal-btn")},(0,s.h)("a",{key:"20893bc2682d40c1af82658dc46ddf247d21b717",class:"no-hover"},(0,s.h)("calcite-button",{key:"286c782f435b9fb063c68c3a90d2f7da0aac38d4",id:"submit-btn",disabled:this.isPrinting||!this.buttonClickable(),onClick:()=>this.executeCustomPrint()},null===(c=null===(h=this.translator)||void 0===h?void 0:h.customPrint)||void 0===c?void 0:c.generate,this.isPrinting?(0,s.h)("calcite-loader",{label:null===(u=null===(d=this.translator)||void 0===d?void 0:d.common)||void 0===u?void 0:u.loading,inline:"true"}):null),(this.printTemplates||[]).length>0||this.templateItemId||(null===(m=this.visibleConf)||void 0===m?void 0:m.indexOf("selectTemplate"))>=0?null:(0,s.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,s.h)("div",{slot:"message"},null===(v=null===(p=this.translator)||void 0===p?void 0:p.customPrint)||void 0===v?void 0:v.chooseTemplateNoOneYet1)))),(0,s.h)("slot",{key:"36ce8b2c1494897225152cdb57b1767cbf1c6f07"}))}};c.style=":host{padding:0 0.75rem;display:block}:host .clickable-text{cursor:pointer;font-weight:normal}:host calcite-notice{margin-top:6px}:host .credits-info{margin:10px 0 10px 0;padding:10px 0;background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-2);display:flex;justify-content:space-between}:host .credits-info>div{margin:0px 10px}:host .credits-info .show-credits{display:inline-flex;align-items:center}:host .credits-info .show-credits survey123-ui-spinner{line-height:0}:host .credits-info .show-credits ::ng-deep span{line-height:0}:host .credits-info .show-credits .icon-spin.icon-refresh{top:1px}:host .credits-info .show-credits .spinner{-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none}:host .credits-info .show-credits span:not(.clickable-text){cursor:default}:host .credits-info .show-credits span.clickable-text.disabled{cursor:not-allowed}:host .credits-info .credits-result-info{flex-grow:1;display:flex;justify-content:flex-end}:host .credits-info .credits-result-info span{word-break:break-word}:host .pieview-info{margin-top:10px;margin-bottom:20px}:host .pieview-info .has-spinner>span{cursor:default}:host .pieview-info .has-spinner>span.report-status{padding:0 2px}:host .pieview-info .preview-text{cursor:default;display:flex;align-items:center}:host .pieview-info .preview-text>span{cursor:pointer}:host .pieview-info .preview-text.disabled{text-decoration:underline solid #979797;color:#979797;cursor:not-allowed}:host .pieview-info .preview-text.disabled>span{cursor:not-allowed}:host .execute-btn{overflow:auto;margin:-5px 0 30px 0}:host .execute-btn>span{line-height:41px}:host .execute-btn a{float:inline-start}:host .execute-btn a button{width:auto}:host .execute-btn.portal-btn{margin:20px 0}:host calcite-loader{display:inline-block;margin:0 0 0 10px}";const d=class{constructor(e){(0,s.r)(this,e),this.fileOptionChange=(0,s.c)(this,"fileOptionChange",7),this.fileNameChange=(0,s.c)(this,"fileNameChange",7),this.selectedFolderChange=(0,s.c)(this,"selectedFolderChange",7),this.selectedFileFormatChange=(0,s.c)(this,"selectedFileFormatChange",7),this.reportService=o.R.getService(),this.state=l.S.getService(),this.mergeFiles=void 0,this.outputFormat="word",this.fileName=void 0,this.visibleElems=[],this.translator=void 0,this.langReport=void 0}onFileNameChange(){this.fileNameChangeHandler({target:{value:this.fileName}})}componentWillLoad(){return Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();return this.translator=e,this.langReport=null==e?void 0:e.customPrint,this.state.subscribe("locale-data-changed",(e=>{this.translator=e,this.langReport=null==e?void 0:e.customPrint})),this.getUserFolders()})).catch((e=>{this.reportService.showError(e)}))}fileOptChangeHandler(e){const t=this.reportService.getParamCache();"split"!==e.detail?t.mergeFiles=e.detail:delete t.mergeFiles,this.fileOptionChange.emit(e.detail)}fileNameChangeHandler(e){this.fileName=e.target.value;const t=this.fileName;if(t){const e=this.extractPlaceholders(t);e&&e.length||this.reportService.setParamCache({outputPackageName:t})}this.reportService.setParamCache({outputReportName:t}),this.fileNameChange.emit(this.fileName)}selectedFolderChangeHandler(){const e=this.reportService.getParamCache("uploadInfo")||{type:"arcgis",parameters:{},conflictBehavior:"rename"};e.parameters.folderId="all"===this.selectedFolder.id?"":this.selectedFolder.id,this.reportService.setParamCache({uploadInfo:e}),this.selectedFolderChange.emit(this.selectedFolder)}outputFormatChangeHandler(e){this.outputFormat=e.target.value,this.reportService.setParamCache({outputFormat:this.outputFormat}),this.selectedFileFormatChange.emit(this.outputFormat)}getUserFolders(){var e,t;const i=a.U.getService(),s=null===(e=i.getUser())||void 0===e?void 0:e.username,r=null===(t=this.langReport)||void 0===t?void 0:t.saveToAGOFolderRoot.replace("${$username}",s),o=Object.assign({owner:s},i.getBaseRequestOptions());return n(o).then((e=>{this.folders=[];const t=[];return t.push({username:s,id:"all",value:"all",title:r,label:r,created:null}),e&&e.folders&&e.folders.length?(e.folders.forEach((e=>{e.label=e.title,e.value=e.id})),this.folders=t.concat(e.folders)):this.folders=t,this.selectedFolder=this.folders[0],this.folders}))}extractPlaceholders(e){const t=(e=e||"").match(/\$[^{$]*?{[^}]*?.*?}/g),i=[];return t&&t.forEach((e=>{-1===i.indexOf(e)&&i.push(e)})),i}render(){var e,t,i,r,o,a,l,n,h,c,d,u,m,p,v,g,b,f;return(0,s.h)(s.H,{key:"18633a817eb3e5baf0ce86dde0e4d4d54b61c914"},(0,s.h)("div",{key:"e147b311bc12338b9fdedf5587aa480b8b8364d4",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.resultSettingsLabel1),this.visibleElems.indexOf("fileOptions")<0?null:(0,s.h)("file-option-chooser",{fileOption:this.mergeFiles,onFileOptionChange:e=>{this.fileOptChangeHandler(e)}}),this.visibleElems.indexOf("reportName")<0?null:(0,s.h)("calcite-label",null,null===(r=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===r?void 0:r.saveToAGOItemName,(0,s.h)("calcite-input-text",{placeholder:null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.saveToAGOItemName,value:this.fileName,onCalciteInputTextChange:e=>this.fileNameChangeHandler(e)})),this.visibleElems.indexOf("saveToAGSAccount")<0?null:(0,s.h)("calcite-label",null,null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.saveToAGOFolder,(0,s.h)("calcite-combobox",{placeholder:null===(c=null===(h=this.translator)||void 0===h?void 0:h.customPrint)||void 0===c?void 0:c.saveToAGOFolder,"selection-mode":"single-persist",clearDisabled:"true",maxItems:"7",value:this.selectedFolder,onCalciteComboboxChange:()=>{this.selectedFolderChangeHandler()}},(this.folders||[]).map((e=>{var t;return(0,s.h)("calcite-combobox-item",{value:e.value,"text-label":e.label,selected:e.value===(null===(t=this.selectedFolder)||void 0===t?void 0:t.id)})})))),this.visibleElems.indexOf("outputFormat")<0?null:(0,s.h)("calcite-label",null,null===(u=null===(d=this.translator)||void 0===d?void 0:d.customPrint)||void 0===u?void 0:u.outputFormat,(0,s.h)("calcite-combobox",{placeholder:null===(p=null===(m=this.translator)||void 0===m?void 0:m.customPrint)||void 0===p?void 0:p.outputFormat,"selection-mode":"single-persist",clearDisabled:"true",value:this.outputFormat,onCalciteComboboxChange:e=>this.outputFormatChangeHandler(e)},(0,s.h)("calcite-combobox-item",{value:"docx",selected:"docx"===this.outputFormat,"text-label":null===(g=null===(v=this.translator)||void 0===v?void 0:v.customPrint)||void 0===g?void 0:g.outputFormatDocx}),(0,s.h)("calcite-combobox-item",{value:"pdf",selected:"pdf"===this.outputFormat,"text-label":null===(f=null===(b=this.translator)||void 0===b?void 0:b.customPrint)||void 0===f?void 0:f.outputFormatPdf}))),(0,s.h)("slot",{key:"fa61eb0234127f5bd7e4751b9d586b91dbc2a09f"}))}static get watchers(){return{fileName:["onFileNameChange"]}}};d.style=":host{display:block;padding:0 0.75rem}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}";const u=class{constructor(e){(0,s.r)(this,e),this.goBackClicked=(0,s.c)(this,"goBackClicked",7),this.recentTasksCount=10,this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.utilService=a.U.getService(),this.langReport=void 0,this.langCommon=void 0,this.langTasks=void 0,this.state="loading",this.jobs=void 0}componentWillLoad(){this.state="loading",Promise.resolve(!0).then((()=>{var e;const t=r.T.getService().getTranslateSync();return this.langReport=null==t?void 0:t.customPrint,this.langCommon=null==t?void 0:t.common,this.langTasks=null==t?void 0:t.customPrint.recentTasks,this.stateService.subscribe("locale-data-changed",(e=>{this.langReport=null==e?void 0:e.customPrint,this.langCommon=null==e?void 0:e.common,this.langTasks=null==e?void 0:e.customPrint.recentTasks})),(null===(e=this.jobs)||void 0===e?void 0:e.length)?{jobs:this.jobs}:this.reportService.queryJobs(!0)})).then((e=>{var t;return this.jobList=e,this.jobs=(null===(t=this.jobList)||void 0===t?void 0:t.jobs)||[],this.state="ready",this.jobList}))}jobSplitDate(e,t){if(!this.jobs||t<0||t>=this.jobs.length||!e)return null;const i=this.utilService.formatDateTime(e.submitted,"date");if(0===t)return i;if(this.jobs[t-1]){return this.utilService.formatDateTime(this.jobs[t-1].submitted,"date")===i?null:i}return null}goBack(){this.goBackClicked.emit()}removeJob(e){const t=e.detail;if(this.jobs){const e=this.jobs.findIndex((e=>e.jobId===t.jobId));this.jobs.splice(e,1),this.jobs=[].concat(this.jobs)}}render(){var e,t;return(0,s.h)(s.H,{key:"3dfbdff5c280bde8420b6590569063f0657b9bed"},(0,s.h)("div",{key:"d3f876d84f83a41a0b639306b6c84a23d3bd6870",class:"banner"},(0,s.h)("calcite-action",{key:"303e34180a0caaa0e7adea41ee5769ea45ca47e4",onClick:()=>this.goBack(),text:null===(e=this.langTasks)||void 0===e?void 0:e.label,icon:"chevrons-left","text-enabled":!0})),"ready"===this.state&&this.langReport&&this.langCommon&&this.langTasks&&this.jobList?(0,s.h)("div",{class:"list"},this.jobs.length<1?(0,s.h)("div",{class:"no-tasks"},this.langTasks.noTaskDesc):"",this.jobs.length?(0,s.h)(s.F,null,(0,s.h)("div",{class:"no-tasks"},this.langTasks.limitationDesc.replace("${$maxJobCount}",`${this.recentTasksCount}`)),(0,s.h)("ul",null,this.jobs.map(((e,t)=>(0,s.h)("li",{key:"li_"+e.jobId},this.jobSplitDate(e,t)?(0,s.h)("p",{class:"job-date"},this.jobSplitDate(e,t)):"",(0,s.h)("task-info",{key:e.jobId,job:e,onJobRemoved:e=>this.removeJob(e)})))))):""):(0,s.h)("div",{class:"loading"},(0,s.h)("calcite-loader",{label:null===(t=this.langCommon)||void 0===t?void 0:t.loading})),(0,s.h)("slot",{key:"6017984594e73083187bf667e3a90f28c4ca4d18"}))}};u.style=":host{display:block}:host *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:host *{font-size:14px}:host .banner{cursor:pointer;font-weight:700;line-height:60px}:host .banner a{cursor:pointer;float:inline-start;transform:rotateZ(180deg);top:16px}:host .banner span{float:inline-start;padding-left:10px}:host .no-tasks{margin-bottom:20px}:host .list{height:calc(100% - 60px);padding:0 0.75rem;overflow:auto;width:100%}:host .list ul{padding-left:0}:host .list ul li{list-style:none;margin-bottom:15px;border-radius:2px}:host .list p.job-date{color:#979797;line-height:40px;margin-bottom:0}:host-context([dir=rtl]) .banner a{transform:none !important}:host-context([dir=rtl]) .banner span{padding-right:10px;padding-left:unset !important}:host-context([dir=rtl]) list ul{padding-right:0;padding-left:unset !important}";const m=class{constructor(e){(0,s.r)(this,e),this.selectedTemplateChange=(0,s.c)(this,"selectedTemplateChange",7),this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.langObj=void 0,this.selectedTemplateId=void 0,this.templateIds=void 0,this.templates=[],this.translator=void 0}selectedTemplateIdChanged(){this.reportService.setParamCache({templateItemId:this.selectedTemplateId})}templateIdsChanged(){this.init()}componentWillLoad(){return this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),Promise.resolve(!0).then((()=>{const e=r.T.getService().getTranslateSync();return this.translator=e,this.stateService.subscribe("locale-data-changed",(e=>{this.translator=e})),this.init()}))}init(){const e=r.P,t=o.R.getService();return Promise.resolve(!0).then((()=>void 0===this.templateIds?t.getReportTemplates(e.surveyItemId):t.getReportTemplates(e.surveyItemId,{templateIds:this.templateIds}))).then((e=>(this.templates=e,this.stateService.notifyDataChanged("print-templates-updated",{value:e}),this.reportService.setHelperObj({printTemplates:e}),!this.selectedTemplateId&&e.length&&(this.selectedTemplateId=e[0].id,this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),this.selectedTemplateChange.emit(this.selectedTemplateId)),!0))).catch((e=>{this.reportService.showError(e)}))}selectedTemplateChangeHandler(e){this.reportService.setParamCache({templateItemId:e.target.value}),this.selectedTemplateChange.emit(e.target.value)}render(){var e,t,i;return(0,s.h)(s.H,{key:"bdeac6e7cb4ff57e4216adbb7a15b953302694a4"},(0,s.h)("div",{key:"e7cf692912c5a61f1f2920cc89a9222fb3d4179e",class:"heading"},null===(e=this.translator)||void 0===e?void 0:e.customPrint.chooseTemplateLabel1),(0,s.h)("calcite-combobox",{key:"08e41515a05979497b3a320803bd406f80ece809",placeholder:null===(t=this.translator)||void 0===t?void 0:t.customPrint.chooseTemplateLabel1,"selection-mode":"single-persist",clearDisabled:"true",value:this.selectedTemplateId,onCalciteComboboxChange:e=>{this.selectedTemplateChangeHandler(e)}},(this.templates||[]).map((e=>(0,s.h)("calcite-combobox-item",{value:e.id,"text-label":e.title,selected:e.id===this.selectedTemplateId})))),(this.templates||[]).length>0?null:(0,s.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,s.h)("div",{slot:"message"},null===(i=this.translator)||void 0===i?void 0:i.customPrint.chooseTemplateNoOneYet1)),(0,s.h)("slot",{key:"2044d22ed34f21f8c3a2a9b612d172540cc8cca0"}))}get element(){return(0,s.a)(this)}static get watchers(){return{selectedTemplateId:["selectedTemplateIdChanged"],templateIds:["templateIdsChanged"]}}};m.style=":host{display:block;padding:0 0.75rem}:host calcite-notice{margin-top:6px}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}"}}]);