"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-469ae9"],{6640:(e,s,t)=>{t.d(s,{e:()=>a,f:()=>he,p:()=>ge});var n=t(59920),r=t(18758);const i="20210506",o="b02ca94fa7b6dac5fa148245a7cdc7caae582829";class a{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,s){return new Promise(((t,n)=>this._tasks.push(new _(t,n,e,s))))}unshift(e,s){return new Promise(((t,n)=>this._tasks.unshift(new _(t,n,e,s))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{(0,r.ah)(e.signal);const s=e.callback();s&&"object"==typeof s&&"then"in s&&"function"==typeof s.then?s.then(e.resolve,e.reject):e.resolve(s)}catch(s){e.reject(s)}return!0}cancelAll(){const e=(0,r.b9)();for(const s of this._tasks)s.reject(e);this._tasks.length=0}}class _{constructor(e,s,t,n){this.resolve=e,this.reject=s,this.callback=t,this.signal=n}}let c=class extends r.a1{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r.Z)([(0,r._)()],c.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r.Z)([(0,r._)()],c.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),c=(0,r.Z)([(0,r.a0)("esri.views.support.DebugFlags")],c);const d=new c,l=r.S.getLogger("esri.views.support.Scheduler");var h;!function(e){e.REMOTE_CLIENT="worker messages",e.SLIDE="slide",e.STAGE="stage",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.LABELER="labeler",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.FEATURE_QUERY_ENGINE="feature query",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.OVERLAY_MANAGER="overlay manager",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e[e.TEST_PRIO=1]="TEST_PRIO"}(h||(h={}));const u={[h.REMOTE_CLIENT]:0,[h.SLIDE]:0,[h.STREAM_DATA_LOADER]:0,[h.ELEVATION_QUERY]:0,[h.STAGE]:1,[h.TERRAIN_SURFACE]:1,[h.SURFACE_GEOMETRY_UPDATES]:1,[h.GRAPHICS_CORE]:2,[h.I3S_CONTROLLER]:2,[h.POINT_CLOUD_LAYER]:2,[h.FEATURE_TILE_FETCHER]:2,[h.LABELER]:8,[h.GRAPHICS_DECONFLICTOR]:4,[h.FILTER_VISIBILITY]:4,[h.FEATURE_QUERY_ENGINE]:8,[h.SCALE_VISIBILITY]:4,[h.FRUSTUM_VISIBILITY]:4,[h.POINT_OF_INTEREST_FREQUENT]:6,[h.POINT_OF_INTEREST_INFREQUENT]:30,[h.FEATURE_TILE_TREE]:16,[h.FEATURE_TILE_TREE_ACTIVE]:0,[h.ELEVATION_ALIGNMENT]:12,[h.TEXT_TEXTURE_ATLAS]:12,[h.TEXTURE_UNLOAD]:12,[h.OVERLAY_MANAGER]:12,[h.LINE_OF_SIGHT_TOOL]:16,[h.LINE_OF_SIGHT_TOOL_INTERACTIVE]:0,[h.SNAPPING]:0};function g(e){return e in u?u[e]:"number"==typeof e?e:1}const m=1e3/30;var p,f;!function(e){let s=class extends r.a1{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new r.bh("total"),tasks:new Array},this._budget=null,this._state=1,this._tasks=new r.b5,this._runQueue=new r.b5,this._load=0,this._idleStateCallbacks=new r.b5,this._idleUpdatesStartFired=!1,this._maxReschedule=w,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,r.b7)(d,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new n(e.nowFunc),k.length=0;for(const e in h)v.set(h[e],this.performanceInfo.tasks.length),this.performanceInfo.tasks.push(new r.bh(h[e])),k.push(0);let s;const t=this;this._test={get state(){return(0,r.t)(s)?t._state:s},set state(e){s=e},FRAME_SAFETY_BUDGET:6.5,INTERACTING_BUDGET:m,IDLE_BUDGET:100,get budget(){return t._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,s,n){const r=g(e),i=new t(this,e,s,n,r);return this._tasks.push(i),i}registerIdleStateCallbacks(e,s){const t={idleBegin:e,idleEnd:s};this._idleStateCallbacks.push(t),2===this.state&&this._idleUpdatesStartFired&&t.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(t),set idleBegin(e){n._idleUpdatesStartFired&&(t.idleEnd(),2===n._state&&e()),t.idleBegin=e},set idleEnd(e){t.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return(0,r.t)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let s=6.5,t=e.frameDuration,n=1;switch(this.state){case 2:s=0,t=Math.max(100,e.frameDuration),n=30;break;case 1:t=Math.max(m,e.frameDuration)}return t-=e.elapsedFrameTime+s,2!==this.state&&t<1&&!this._forceTask?(this._forceTask=!0,!1):(t=Math.max(t,n),this._budget.reset(t,this.state),this._maxReschedule=w,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((s=>{s.name===e&&s.setPriority(e)}))}_getState(e){if(this._runQueue.some((s=>s.name===e)))return f.SCHEDULED;let s=f.IDLE;return this._tasks.forAll((t=>{t.name===e&&t.needsUpdate&&(t.schedulePriority<=1?s=f.READY:s!==f.READY&&(s=f.WAITING))})),s}_getRuntime(e){let s=0;return this._tasks.forAll((t=>{t.name===e&&(s+=t.runtime)})),s}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((s=>{s.needsUpdate&&e.set(s.name,(e.get(s.name)||0)+1)})),0===e.size)return null;let s="";return e.forEach(((e,t)=>{s+=e>1?` ${e}x ${t}`:` ${t}`})),s}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,s)=>s.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.priority,!1))),this._tasks.forAll((e=>{0===e.priority&&e.needsUpdate&&!this._runQueue.some((s=>s===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,s=0;if(this._tasks.forAll((t=>{if(t.needsUpdate&&0!==t.schedulePriority&&0!==t.priority)if(1===(e=!0,s=Math.max(s,t.priority),t.schedulePriority))t.schedulePriority=0,this._runQueue.push(t);else--t.schedulePriority})),!e)return this.updating=!1,!1;this._maxReschedule===w&&(this._maxReschedule=s),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();for(let e=0;e<k.length;++e)k[e]=0;do{for(;this._runQueue.length>0;){const s=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.update(this._budget)}catch(e){l.error(`Exception in task "${t.name}"`,e)}t.schedulePriority=t.priority;const n=this._budget.now()-s;if(t.runtime+=n,k[v.get(t.task)]+=n,this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",t.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(k,this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(k,this._budget.now()-e)}_recordFrameTaskTimes(e,s){for(let s=0;s<e.length;++s)this.performanceInfo.tasks[s].record(e[s]);this.performanceInfo.total.record(s)}get test(){return this._test}};(0,r.Z)([(0,r._)()],s.prototype,"updating",void 0),(0,r.Z)([(0,r._)()],s.prototype,"nowFunc",void 0),s=(0,r.Z)([(0,r.a0)("esri.views.support.Scheduler")],s),e.Scheduler=s;let t=class extends r.a1{constructor(e,s,t,n,r){super({}),this._scheduler=e,this.name=s,this.update=t,this._needsUpdateCB=n,this._priority=r,this.runtime=0,this._queue=new a,this.updating=!1,this.schedulePriority=this._priority}normalizeCtorArgs(){return{}}remove(){this.processQueue(E),this._scheduler.removeTask(this),this.schedule=b.schedule,this.reschedule=b.reschedule}get priority(){return this._priority}setPriority(e){this.name=e;const s=g(e);0!==this._priority&&0===this.schedulePriority||(this.schedulePriority=s),this._priority=s}get task(){return this.name}set task(e){this.setPriority(e)}get needsUpdate(){return this.updating||this._needsUpdateCB()}schedule(e,s){return this.updating=!0,this._queue.push(e,s)}reschedule(e,s){return this.updating=!0,this._queue.unshift(e,s)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};(0,r.Z)([(0,r._)()],t.prototype,"updating",void 0),t=(0,r.Z)([(0,r.a0)("esri.views.support.SchedulerTask")],t);class n{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,s){this._begin=this.now(),this._budget=e,this._state=s,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=n}(p||(p={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(f||(f={}));const E=(()=>{const e=new p.Budget((()=>performance.now()));return e.enabled=!1,e})();const b=new class{remove(){}processQueue(){}schedule(e){return(0,r.bi)(e())}reschedule(e){return(0,r.bi)(e())}},w=Number.MAX_SAFE_INTEGER,v=new Map,k=new Array,y={geometryEngineWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-dc4bb0"),t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm__com-617d66")]).then(t.bind(t,73793)),CSVSourceWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d6ec1"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d03a4"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-d0cd73")]).then(t.bind(t,67919)),EdgeProcessingWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-e8fb5c"),t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Edge-f645cb")]).then(t.bind(t,97147)),ElevationSamplerWorker:()=>t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Elev-81c8bb").then(t.bind(t,22201)),GeoJSONSourceWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d6ec1"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d03a4"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1936b0"),t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_GeoJ-07392d")]).then(t.bind(t,53867)),LercWorker:()=>t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Lerc-60f6e6").then(t.bind(t,37991)),MemorySourceWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d6ec1"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d03a4"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1936b0"),t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Memo-d6e09f")]).then(t.bind(t,91104)),PBFDecoderWorker:()=>t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-a9b3a0").then(t.bind(t,34563)),Pipeline:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-6785ed"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d6ec1"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-b8bf5c"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d03a4"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-98109c"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-5ae605")]).then(t.bind(t,48805)).then((function(e){return e.b})),PointCloudWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-8d4c7b")]).then(t.bind(t,66521)),RasterWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-43d6a0"),t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Rast-15d9f6")]).then(t.bind(t,76359)),SceneLayerWorker:()=>t.e("extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_esm_Scen-55e28b").then(t.bind(t,70968)),WorkerTileHandler:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7ab3b7"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-217f44"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1f0a64")]).then(t.bind(t,16495)),FeatureServiceSnappingSourceWorker:()=>Promise.all([t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-6785ed"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-7c3768"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-c0455a"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d6ec1"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-b8bf5c"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-1d03a4"),t.e("vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_geoenrichment-components_dist_-57fa1e")]).then(t.bind(t,74015))};var I;!function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"}(I||(I={}));let T=0;function S(){return T++}function P(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function R(e,s,t,n){if(s.type===I.OPEN_PORT)return void e.postMessage(s,[s.port]);if(s.type!==I.INVOKE&&s.type!==I.RESPONSE)return void e.postMessage(s);let r;!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(t)?(r=A(n),s.data=t):(r=A(t.transferList),s.data=t.result),r?e.postMessage(s,r):e.postMessage(s)}function O(e){if(!e)return null;const s=e.data;return s?"string"==typeof s?JSON.parse(s):s:null}function A(e){if(!e||!e.length)return null;if((0,n.t)("esri-workers-arraybuffer-transfer"))return e;const s=e.filter((e=>!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)));return s.length?s:null}const{CLOSE:N,ABORT:L,INVOKE:C,RESPONSE:M,OPEN_PORT:x,ON:U}=I;class D{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===I.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class F{constructor(e,s){this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new D((e=>this._onInvokeMessage(e))),this._messageQueue=new Array,this._client=s.client,this._onMessage=this._onMessage.bind(this),this._channel=s.channel,(0,r.H)(s.scheduler)&&(this._frameTask=s.scheduler.registerTask(h.REMOTE_CLIENT,(e=>this._update(e)),(()=>this._messageQueue.length>0))),this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const s=new MessageChannel;let t;t="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const n=new F(s.port1,{channel:s,client:t});return"object"==typeof t&&"remoteClient"in t&&(t.remoteClient=n),F.clients.set(n,t),s.port2}static loadWorker(e){const s=y[e];return s?s():Promise.resolve(null)}close(){this._post({type:N}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,s,t){const n=t&&t.signal,i=t&&t.transferList;if(!this._port)return Promise.reject(new r.s("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:s}));const o=S();return new Promise(((t,a)=>{const _=(0,r.bj)(n,(()=>{var e;const s=this._outJobs.get(o);s&&(this._outJobs.delete(o),null==(e=s.abortHandle)||e.remove(),this._post({type:L,jobId:o}),a((0,r.b9)()))})),c={resolve:t,reject:a,abortHandle:_,debugInfo:e};this._outJobs.set(o,c),this._post({type:C,jobId:o,methodName:e,abortable:null!=n},s,i)}))}on(e,s){const t=new MessageChannel;function n(e){s(e.data)}return this._port.postMessage({type:I.ON,eventType:e,port:t.port2},[t.port2]),t.port1.addEventListener("message",n),t.port1.start(),{remove(){t.port1.postMessage({type:I.CLOSE}),t.port1.close(),t.port1.removeEventListener("message",n)}}}openPort(){const e=new MessageChannel;return this._post({type:x,port:e.port2}),e.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{var s;null==(s=e.abortHandle)||s.remove(),e.reject((0,r.b9)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=null,this._frameTask=(0,r.bk)(this._frameTask)}_onMessage(e){(0,r.H)(this._frameTask)?this._messageQueue.push(e):this._processMessage(e)}_processMessage(e){const s=O(e);if(s)switch(s.type){case M:this._onResponseMessage(s);break;case C:this._invokeQueue.push(s);break;case L:this._onAbortMessage(s);break;case N:this._onCloseMessage();break;case x:this._onOpenPortMessage(s);break;case U:this._onOnMessage(s)}}_onAbortMessage(e){const s=this._inJobs,t=e.jobId,n=s.get(t);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),s.delete(t))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&F.clients.get(this)===e&&e.destroy(),F.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:s,jobId:t,data:n,abortable:i}=e,o=i?(0,r.az)():null,a=this._inJobs;let _,c=this._client,d=c[s];try{if(!d&&s&&-1!==s.indexOf(".")){const e=s.split(".");for(let s=0;s<e.length-1;s++)c=c[e[s]],d=c[e[s+1]]}if("function"!=typeof d)throw new TypeError(`${s} is not a function`);_=d.call(c,n,{client:this,signal:o?o.signal:null})}catch(e){return void this._post({type:M,jobId:t,error:P(e)})}(0,r.Q)(_)?(a.set(t,{controller:o,promise:_}),_.then((e=>{a.has(t)&&(a.delete(t),this._post({type:M,jobId:t},e))}),(e=>{a.has(t)&&(a.delete(t),(0,r.aD)(e)||this._post({type:M,jobId:t,error:P(e||{message:`Error encountered at method ${s}`})}))}))):this._post({type:M,jobId:t},_)}_onOpenPortMessage(e){new F(e.port,{client:this._client})}_onOnMessage(e){const{port:s}=e,t=this._client.on(e.eventType,(e=>{s.postMessage(e)})),n=(0,r.bl)(e.port,"message",(e=>{O(e).type===I.CLOSE&&(n.remove(),t.remove(),s.close())}))}_onResponseMessage(e){var s;const{jobId:t,error:n,data:i}=e,o=this._outJobs;if(!o.has(t))return;const a=o.get(t);o.delete(t),null==(s=a.abortHandle)||s.remove(),n?a.reject(r.s.fromJSON(JSON.parse(n))):a.resolve(i)}_update(e){for(;!e.done&&this._messageQueue.length>0;)this._processMessage(this._messageQueue.shift()),e.madeProgress()}_post(e,s,t){return R(this._port,e,s,t)}}F.kernelInfo={revision:o,version:r.N,buildDate:i},F.clients=new Map;const H=r.S.getLogger("esri.core.workers.Connection");class j{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,s){return new Promise(((t,n)=>{let i=!0;const o=e=>{(0,r.ah)(s.signal),i&&(i=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let i=0;i<e.length;++i){const a=e[i];(0,r.Q)(a)?this._clientPromises[i]=a.then((e=>(this._clients[i]=new F(e,s),o(t),this._clients[i])),(()=>(o(n),null))):(this._clients[i]=new F(a,s),this._clientPromises[i]=Promise.resolve(this._clients[i]),o(t))}}))}broadcast(e,s,t){const n=new Array(this._clientPromises.length);for(let r=0;r<this._clientPromises.length;++r){const i=this._clientPromises[r];n[r]=i.then((n=>n.invoke(e,s,t)))}return n}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let s=0;s<this._clients.length;++s){const t=this._clients[s];if(t){if(!t.isBusy())return Promise.resolve(t)}else e=e||[],e.push(this._clientPromises[s])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,s,t){let n=null;return Array.isArray(t)?(H.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:t}):n=t,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((t=>t.invoke(e,s,n)))}on(e,s){return Promise.all(this._clientPromises).then((()=>(0,r.bm)(this._clients.map((t=>t.on(e,s))))))}openPorts(){return new Promise((e=>{const s=new Array(this._clientPromises.length);let t=s.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then((r=>{s[n]=r.openPort(),0==--t&&e(s)}))}))}get test(){return{numClients:this._clients.length}}}const J={};function W(e){var s;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=J.baseUrl),null==(s=J.packages)||s.forEach((e=>{!function(e,s){for(const t of e)if(t.name===s.name)return;e.push(s)}(t.packages,e)})),t}class G{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((s=>{this[s]=(...t)=>e[s](...t)}))}}const B=n.e.MutationObserver||n.e.WebKitMutationObserver,Q=function(){let e;if(n.e.process&&n.e.process.nextTick)e=e=>{n.e.process.nextTick(e)};else if(n.e.Promise)e=e=>{n.e.Promise.resolve().then(e)};else if(B){const s=[],t=document.createElement("div");new B((()=>{for(;s.length>0;)s.shift()()})).observe(t,{attributes:!0}),e=e=>{s.push(e),t.setAttribute("queueStatus","1")}}return e}(),V=(()=>{const e=n.e.MessageEvent;try{new e("message",{data:null})}catch{return(e,s={})=>{const{data:t,bubbles:n=!1,cancelable:r=!1}=s,i=document.createEvent("Event");return i.initEvent(e,n,r),i.data=t,i}}return(s,t)=>new e(s,t)})();class Y{constructor(){this._dispatcher=new G,this._workerPostMessage({type:I.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){Q((()=>{this._workerMessageHandler(V("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,s,t){this._dispatcher.addEventListener(e,s,t)}removeEventListener(e,s,t){this._dispatcher.removeEventListener(e,s,t)}_workerPostMessage(e){Q((()=>{this.dispatchEvent(V("message",{data:e}))}))}async _workerMessageHandler(e){const s=O(e);if(s&&s.type===I.OPEN){const{modulePath:e,jobId:t}=s;let n=await F.loadWorker(e);n||(n=await import(e));const r=F.connect(n);this._workerPostMessage({type:I.OPENED,jobId:t,data:r})}}}const q=r.S.getLogger("esri.core.workers");n.t.add("esri-workers-arraybuffer-transfer",!(0,n.t)("safari")||(0,n.t)("safari")>=12);const{HANDSHAKE:$}=I;let K,Z;const X="Failed to create Worker. Fallback to execute module in main thread";async function z(e){return new Promise((s=>{function t(r){const i=O(r);i&&i.type===$&&(e.removeEventListener("message",t),e.removeEventListener("error",n),s(e))}function n(s){s.preventDefault(),e.removeEventListener("message",t),e.removeEventListener("error",n),q.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new Y).addEventListener("message",t),e.addEventListener("error",n)}e.addEventListener("message",t),e.addEventListener("error",n)}))}function ee(){let e;if(null!=r.aw.default){const s={...r.aw};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(r.aw));e.assetsPath=(0,r.a9)(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,n.b)(),e.has={"csp-restrictions":(0,n.t)("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,n.t)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":(0,n.t)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":(0,n.t)("featurelayer-pbf"),"featurelayer-snapshot-point-threshold":(0,n.t)("featurelayer-snapshot-point-threshold"),"esri-atomics":(0,n.t)("esri-atomics"),"esri-shared-array-buffer":(0,n.t)("esri-shared-array-buffer"),"esri-tiles-debug":(0,n.t)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,n.t)("esri-workers-arraybuffer-transfer"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,r.a9)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,r.a9)(e.workers.workerPath):e.workers.workerPath=(0,r.a9)((0,r.a7)("esri/core/workers/RemoteClient.js"));const s=r.aw.workers.loaderConfig,t=W({baseUrl:null==s?void 0:s.baseUrl,locale:(0,n.b)(),has:{"csp-restrictions":(0,n.t)("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1,...null==s?void 0:s.has},map:{...null==s?void 0:s.map},paths:{...null==s?void 0:s.paths},packages:(null==s?void 0:s.packages)||[]}),a={version:r.N,buildDate:i,revision:o};return JSON.stringify({esriConfig:e,loaderConfig:t,kernelInfo:a})}let se=0;const te=r.S.getLogger("esri.core.workers"),{ABORT:ne,INVOKE:re,OPEN:ie,OPENED:oe,RESPONSE:ae}=I;class _e{constructor(e,s){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=s,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),te.error(e)}))}static async create(e){const s=await async function(){if(!(0,n.t)("esri-workers"))return z(new Y);if(!K&&!Z)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.replace('"{CONFIGURATION}"',`'${ee()}'`);K=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){Z=e||{}}let e;if(K)try{e=new Worker(K,{name:"esri-worker-"+se++})}catch(s){q.warn(X,Z),e=new Y}else q.warn(X,Z),e=new Y;return z(e)}();return new _e(s,e)}terminate(){this.worker.terminate()}async open(e,s={}){const{signal:t}=s,n=S();return new Promise(((s,i)=>{const o={resolve:s,reject:i,abortHandle:(0,r.bj)(t,(()=>{this._outJobs.delete(n),this._post({type:ne,jobId:n})}))};this._outJobs.set(n,o),this._post({type:ie,jobId:n,modulePath:e})}))}_onMessage(e){const s=O(e);if(s)switch(s.type){case oe:this._onOpenedMessage(s);break;case ae:this._onResponseMessage(s);break;case ne:this._onAbortMessage(s);break;case re:this._onInvokeMessage(s)}}_onAbortMessage(e){const s=this._inJobs,t=e.jobId,n=s.get(t);n&&(n.controller&&n.controller.abort(),s.delete(t))}_onInvokeMessage(e){const{methodName:s,jobId:t,data:n,abortable:i}=e,o=i?(0,r.az)():null,a=this._inJobs,_=r.bn[s];let c;try{if("function"!=typeof _)throw new TypeError(`${s} is not a function`);c=_.call(null,n,{signal:o?o.signal:null})}catch(e){return void this._post({type:ae,jobId:t,error:P(e)})}(0,r.Q)(c)?(a.set(t,{controller:o,promise:c}),c.then((e=>{a.has(t)&&(a.delete(t),this._post({type:ae,jobId:t},e))}),(e=>{a.has(t)&&(a.delete(t),e||(e={message:"Error encountered at method"+s}),(0,r.aD)(e)||this._post({type:ae,jobId:t,error:P(e||{message:`Error encountered at method ${s}`})}))}))):this._post({type:ae,jobId:t},c)}_onOpenedMessage(e){var s;const{jobId:t,data:n}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),null==(s=r.abortHandle)||s.remove(),r.resolve(n))}_onResponseMessage(e){var s;const{jobId:t,error:n,data:i}=e,o=this._outJobs.get(t);o&&(this._outJobs.delete(t),null==(s=o.abortHandle)||s.remove(),n?o.reject(r.s.fromJSON(JSON.parse(n))):o.resolve(i))}_post(e,s,t){return R(this.worker,e,s,t)}}let ce=(0,n.t)("esri-workers-debug")?1:(0,n.t)("host-browser")?navigator.hardwareConcurrency-1:0;ce||(ce=(0,n.t)("safari")&&(0,n.t)("mac")||(0,n.t)("trident")?7:2);let de=0;const le=[];function he(e,s){return ue(e,{client:s})}async function ue(e,s){const t=new j;return await t.open(e,s),t}async function ge(e,s={}){if("string"!=typeof e)throw new r.s("workers:undefined-module","modulePath is missing");let t=s.strategy||"distributed";if((0,n.t)("host-webworker")&&!(0,n.t)("esri-workers")&&(t="local"),"local"===t){let t=await F.loadWorker(e);t||(t=await import(e)),(0,r.ah)(s.signal);const n=s.client||t;return ue([F.connect(t)],{...s,client:n})}if(await async function(){if(me)return me;(0,r.az)();const e=[];for(let s=0;s<ce;s++){const t=_e.create(s).then((e=>(le[s]=e,e)));e.push(t)}return me=Promise.all(e),me}(),(0,r.ah)(s.signal),"dedicated"===t){const t=de++%ce;return ue([await le[t].open(e,s)],s)}if(s.maxNumWorkers&&s.maxNumWorkers>0){const t=Math.min(s.maxNumWorkers,ce);if(t<ce){const n=new Array(t);for(let r=0;r<t;++r){const t=de++%ce;n[r]=le[t].open(e,s)}return ue(n,s)}}return ue(le.map((t=>t.open(e,s))),s)}let me=null}}]);