/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_analyz-78c09c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_analyz-78c09c"],{74186:(e,o,a)=>{a.d(o,{a:()=>v,g:()=>u,s:()=>y});var l=a(81232),r=(a(77040),a(70506),a(71700)),i=a(76173),t=a(28944),n=a(71695),s=a(94788),d=a(46581);function c(e,o,a,l){var r,i,t,n;const s=null!==(r=o.latitudeFieldName)&&void 0!==r?r:a.latitudeFieldName,d=null!==(i=o.longitudeFieldName)&&void 0!==i?i:a.longitudeFieldName,c=null!==(t=o.coordinateFieldName)&&void 0!==t?t:a.coordinateFieldName,u=null!==(n=o.coordinateFieldType)&&void 0!==n?n:a.coordinateFieldType;return l[e.name]?l[e.name]:e.name===c?null==u?void 0:u.toLowerCase():e.name===s?"latitude":e.name===d?"longitude":e.locationType||"unknown"}const u=(e,o)=>{if(!o)return e;const{layers:a,tables:l}=o;return"Map Service"===e&&!(null==a?void 0:a.length)&&(null==l?void 0:l.length)?"Feature Service":e};async function v({analyzeArgs:e,configArgs:o,itemArgs:a,initialize:u}){var v,m,g,f;const{config:b,lang:S,portal:w,user:F}=o,{itemType:h}=a;if(u&&(0,n.m)(F)){const e=(0,t.b)(null!==(m=null===(v=w.helperServices)||void 0===v?void 0:v.geocode)&&void 0!==m?m:[],F,w.isPortal);if(e&&(r.a.allowGeocode=e.allowGeocode,r.a.isAgoWorldGeocodeServer=e.isAgoWorldGeocodeServer,r.a.isServiceProxyAgoWorldGeocodeServer=e.isServiceProxyAgoWorldGeocodeServer,r.a.isWorldGeocodeServer=e.isWorldGeocodeServer,r.a.geocodeServers=e.geocodeServers,r.a.geocodeServiceUrl=e.geocodeServiceUrl),r.a.geocodeServers){r.a.sourceCountry=(0,t.d)(F.region,w.ipCntryCode);try{r.a.countryCodes=await async function(e,o,a){const l=(0,t.f)(e,a);let r;if(null==l?void 0:l.itemId){const e=`${o}/content/items/${l.itemId}`,a=await(0,d.r)(e),i=a.proxyFilter&&JSON.parse(a.proxyFilter).sourceCountry;i&&(r=i.split(",").map((e=>e.toLowerCase())),r.push("world"))}return Object.keys(t.c).map((e=>({label:t.c[e],value:e}))).filter((({value:e})=>!r||r.includes(e.toLowerCase()))).sort(((e,o)=>e.label<o.label?-1:e.label>o.label?1:0))}(r.a.geocodeServiceUrl,b.restBaseUrl,r.a.geocodeServers),r.a.standardizedFieldNames=await p(r.a.geocodeServiceUrl,S)}catch(e){return console.error("Geocoder unavailable",e),{error:{code:"unavailableGeocoder"}}}}}const{locationType:C,isWorldGeocodeServer:T,geocodeServiceUrl:x,geocodeServers:z,isServiceProxyAgoWorldGeocodeServer:G,sourceCountry:P,analyzeResults:U,analyzedLocationTypes:N}=r.a,L=`${b.restBaseUrl}content/features/analyze`,{isPortal:k}=w;let O,j=!1;"item"===(null==e?void 0:e.type)&&"append"===e.workflow?(O=i.a[h],j=!0):O="Microsoft Excel"===h?"excel":h.toLowerCase();const _="file"===(null==e?void 0:e.type)&&e.analyze3DData;let A={filetype:O};switch(null==e?void 0:e.type){case"url":A.sourceUrl=e.sourceUrl;break;case"item":A.itemid=e.itemid;break;case"file":A=new FormData,A.append("file",e.file),A.append("filetype",_&&"File Geodatabase"===a.itemType?"fileGeodatabase":O);break;case"text":A.text=e.text}if(!_){const e={enableGlobalGeocoding:!0,sourceLocale:S,locationType:C,returnEstimatedRowCount:!0,returnSize:!0,fieldTypesVersion:"V2"};if(k&&x||!k){if((k||!k&&(null==z?void 0:z.length))&&(e.geocodeServiceUrl=encodeURI(x)),U||k){const o="address"===C?"addressTypes":"locationTypes";-1===N.indexOf(o)&&N.push(o),e.locationType=C||"coordinates"}(!w.isPortal&&T||w.isPortal&&G)&&(e.sourceCountryHint=U?"":P.toLowerCase(),e.sourceCountry=U?P.toLowerCase():"");const o=JSON.stringify(e);A instanceof FormData?A.append("analyzeParameters",o):A.analyzeParameters=o}}try{const e=await(A instanceof FormData?(0,d.a)(L,A,{},"post"):(0,d.r)(L,A,{},"post"));if(_){if(!function(e){var o;const a=null==e?void 0:e.publishParameters,l=null===(o=null==a?void 0:a.layers)||void 0===o?void 0:o[0],r=null==l?void 0:l.infoFor3D,i="esriGeometryMultiPatch"===(null==l?void 0:l.geometryType);return r&&i}(e))return{error:{code:"invalid3DObjectFeatureClass"}}}else!async function({response:e,analyzeSelectedLayer:o,initialize:a,geocodeServiceUrl:i,lang:n,portal:u,itemType:v}){var p,m,g,f,b,S;const w=r.a,F=u.isPortal,h="Microsoft Excel"===v,C=h?null!==(m=null===(p=e.publishParameters.layers)||void 0===p?void 0:p[w.selectedSheet])&&void 0!==m?m:null===(g=e.publishParameters.layers)||void 0===g?void 0:g[0]:e.publishParameters;let T;if(!F&&w.isWorldGeocodeServer||F&&w.isServiceProxyAgoWorldGeocodeServer){const e=(0,l.a)(C.sourceCountry);T=w.sourceCountry||C.sourceCountry||"world",T="wo"===T?"world":T,r.a.isWorldGeocodeServer=e,r.a.sourceCountry=T}w.allowGeocode||"address"!==C.locationType||(r.a.locationType="none");!function(e){var o,a,l,i,t,n;const{selectedSheet:s}=r.a,{publishParameters:d}=e,u=null!==(i=null!==(a=null===(o=d.layers)||void 0===o?void 0:o[s])&&void 0!==a?a:null===(l=d.layers)||void 0===l?void 0:l[0])&&void 0!==i?i:d.layerInfo;if(!u)return e;const v=null!==(n=null!==(t=u.addressFields)&&void 0!==t?t:d.addressFields)&&void 0!==n?n:{},y=Object.keys(v).reduce(((e,o)=>Object.assign(Object.assign({},e),{[v[o]]:o})),{});u.fields=u.fields.map((e=>Object.assign(Object.assign({},e),{locationType:c(e,u,d,y)}))),r.a.selectedFields&&(r.a.selectedFields=Object.keys(r.a.selectedFields).reduce(((e,o)=>{const a=r.a.selectedFields[o];return e[o]=Object.assign(Object.assign({},a),{locationType:c(a,u,d,y)}),e}),{}))}(e);const x=function(e){return function(e,o){var a,l,r,i;const{selectedFields:t,type:n,selectedSheet:s}=o;if(!t)return e;const d=e.publishParameters;let c=null==d?void 0:d.layerInfo;switch(n){case"Microsoft Excel":c=null!==(l=null===(a=null==d?void 0:d.layers)||void 0===a?void 0:a[s])&&void 0!==l?l:null===(r=null==d?void 0:d.layers)||void 0===r?void 0:r[0];break;case"GeoJson":c=null===(i=null==d?void 0:d.layers)||void 0===i?void 0:i[0]}return c.fields=c.fields.reduce(((e,o)=>{const a=t[o.name];return a&&(o.alias=a.alias,e.push(o)),e}),[]),e}(e,r.a)}(e);r.a.analyzeResults=x,(null===(f=null==x?void 0:x.publishParameters)||void 0===f?void 0:f.layers)&&(r.a.excelLayers=null===(b=null==x?void 0:x.publishParameters)||void 0===b?void 0:b.layers);const z=(0,t.a)(e,o);a?r.a.backupLayerFields=JSON.parse(JSON.stringify(z.fields)):C.standardizedFieldNames?r.a.standardizedFieldNames=C.standardizedFieldNames:y({lang:n,geocodeServiceUrl:i,locationType:r.a.locationType});"address"===r.a.locationType||"address"===z.locationType||"address"===(null===(S=null==e?void 0:e.publishParameters)||void 0===S?void 0:S.locationType)?r.a.geocodeCost=await(G=z.estimatedRecordCount,(0,d.r)(`${(0,s.g)()}portals/self/cost`,{geocodeCount:G})):r.a.geocodeCost=null;var G}({response:e,initialize:u,analyzeSelectedLayer:j,geocodeServiceUrl:x,lang:S,portal:w,itemType:h});return{}}catch(e){console.error(e);const o=(null==e?void 0:e.message)||e||"";switch(!0){case o.includes("specify data to be analyzed"):return{error:{code:"emptyFile"}};case o.includes("duplicate field names are not allowed"):return{error:{code:"duplicateFieldNames"}};case o.toLowerCase().includes("timeout"):return{error:{code:"timeout"}};case o.toLowerCase().includes("unable to analyze"):if(null===(f=null===(g=null==e?void 0:e.details)||void 0===g?void 0:g.messages[0])||void 0===f?void 0:f.toLowerCase().includes("file exceeds the max size allowed of 10mb."))return{error:{code:"exceedsFileSize"}}}return{error:{code:"unhandledError"}}}}async function y({lang:e,geocodeServiceUrl:o,locationType:a}){"address"===a&&(r.a.standardizedFieldNames=await p(o,e))}async function p(e,o){return(await(0,d.r)(e,{},{addTokenManually:!1})).addressFields.reduce(((e,a)=>{var l;return"unknown"!==a.name&&(e[a.name]=(null===(l=null==a?void 0:a.localizedNames)||void 0===l?void 0:l[`${o}`])||a.alias||a.name),e}),{})}},81232:(e,o,a)=>{var l;function r(e){return null!=e}function i(e,o){for(;e;){if(e.nodeName===o.toUpperCase())return!0;e=e.parentElement}return!1}a.d(o,{a:()=>r,i:()=>i,s:()=>l}),function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(l||(l={}))},77040:(e,o,a)=>{var l,r,i,t,n,s;a.d(o,{L:()=>s,a:()=>n,f:()=>r,i:()=>l,l:()=>i,s:()=>t}),function(e){e.sourceUrl="sourceUrl",e.title="title",e.caption="caption",e.linkUrl="linkUrl",e.altText="altText"}(l||(l={})),function(e){e.expression="expression/",e.relationship="relationships/",e.raster="Raster."}(r||(r={})),function(e){e.feature="feature",e.cluster="cluster",e.mapNotes="mapNotes"}(i||(i={})),function(e){e.feature="feature",e.mapImage="map-image",e.scene="scene",e.ogcFeature="ogc-feature",e.imagery="imagery",e.wfs="wfs",e.wms="wms",e.csv="csv",e.geojson="geojson",e.stream="stream",e.imageryTile="imagery-tile",e.tile="tile",e.subtype="subtype",e.orientedImagery="oriented-imagery",e.catalog="catalog",e.catalogFootprint="catalog-footprint"}(t||(t={})),function(e){e.integer="integer",e.smallInteger="small-integer",e.bigInteger="big-integer",e.single="single",e.double="double",e.long="long",e.string="string",e.date="date",e.dateOnly="date-only",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e.oid="oid",e.guid="guid",e.globalId="global-id",e.number="number"}(n||(n={})),function(e){e.default="default",e.display="display",e.type="type",e.field="field"}(s||(s={}))}}]);