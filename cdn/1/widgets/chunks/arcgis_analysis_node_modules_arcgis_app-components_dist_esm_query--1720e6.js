/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--1720e6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--1720e6"],{62827:(t,e,n)=>{n.d(e,{a:()=>v,b:()=>p,c:()=>g,d:()=>f,e:()=>u,f:()=>w,g:()=>d,h:()=>h,i:()=>b,q:()=>y,u:()=>O});var r=n(65215),s=n(94788),i=n(31670),o=n(46581),a=n(93816);const l='owner:"esri" AND title:"AppSwitcher Config" AND type: "Application Configuration"';async function u(t){const e=(0,s.g)(t);if(!e)return;const n=`${e}portals/self/settings`;return(0,o.f)((()=>$(n)),"portalSettings",e)}async function c(t){const e=(0,s.g)();if(!e||!t)return;return $(`${e}content/items/${t}/data`)}async function d(){var t;const{portal:e,user:n}=i.c;if(!(null==e?void 0:e.id)||!n)return;const r=await async function(){const t=(0,s.g)();if(!t)return;return $(`${t}search`,{num:1,start:0,sortField:"title",sortOrder:"asc",q:l})}(),o=null===(t=null==r?void 0:r.results)||void 0===t?void 0:t[0];if(!o)return;const a=o.id;return await c(a)}async function p(){const{user:t}=i.c;return $(`${(0,s.g)()}community/users/${t.username}/properties`)}async function g(){const{portal:t}=i.c;return $(`${(0,s.g)()}portals/${t.id}/approvedApps`,{returnAllApps:!1})}async function v(){const{user:t}=i.c,e=`${(0,s.g)()}community/users/${t.username}/provisionedListings`;return(0,a.f)(e,{returnAppClientIds:!0,returnAllProvisions:!0},"provisionedListings")}async function f(){const t=`${(0,s.g)()}portals/self/subscriptionInfo`;try{const e=await $(t);return(null==e?void 0:e.orgCapabilities)||[]}catch(t){return[]}}async function y(t,e){if(!e||!(null==t?void 0:t.length))return;return $(`${(0,s.g)()}search`,{num:100,q:`id:(${t.map((t=>`"${t.itemId}"`)).join(" OR ")})`})}const m='owner:"esri" AND title:"BlockedApps Config" AND type: "Application Configuration"';async function h(){var t,e;const n=`${(0,s.g)()}search`;try{const r=await $(n,{num:10,start:0,sortField:"title",sortOrder:"asc",q:m});if(!r)return[];const s=(null===(e=null===(t=r.results)||void 0===t?void 0:t[0])||void 0===e?void 0:e.id)||"",i=await c(s);return(null==i?void 0:i.blockedApps)||[]}catch(t){return[]}}async function b(){const t=`${(0,s.g)()}portals/self/servers`,e=await $(t);return(null==e?void 0:e.servers)||[]}async function w(){const t=`${(0,s.g)()}portals/self/signinSettings`;return await $(t)}async function $(t,e){e||(e={}),e.f="json";const n=(0,r.g)();n&&(e.token=n);const s=new URL(t);Object.keys(e).forEach((t=>s.searchParams.append(t,e[t])));const i=await fetch(s);return await i.json()}async function O(t){const{user:e}=i.c,n=function(t){let e=(0,s.g)();return"/"!==e.slice(-1)&&(e+="/"),`${e}${t}`}(`community/users/${e.username}/setProperties`),o=new FormData;return o.append("properties",JSON.stringify(t)),async function(t,e){e.append("f","json");const n=(0,r.g)();n&&e.append("token",n),fetch(t,{method:"POST",body:e})}(n,o)}},98604:(t,e,n)=>{n.d(e,{M:()=>m,a:()=>O,b:()=>_,c:()=>R,d:()=>S,e:()=>C,f:()=>E,g:()=>w,h:()=>k,i:()=>A,j:()=>f,k:()=>T,q:()=>$});var r=n(49038),s=n(66488),i=n(7652),o=n(96295),a=n(46581),l=n(11246),u=n(94788),c=n(93816),d=n(62827),p=n(22783),g=n(17300),v=n(50852);async function f(t){const e=(0,u.c)(t),{collaborations:n}=await(0,a.r)(`${e}portals/self/collaborationsSummary`,{includeParticipantInfo:!0});return n}async function y(t,e,n,r,s){return async function(t,e,n,r,s){const i=(0,u.c)(n);return await(0,a.r)(`${i}portals/self/collaboratedItems`,Object.assign(Object.assign({collaborationId:t},e?{participantId:e}:{}),{start:r,num:s}))}(t,e,n,r,s)}const m=175,h=["nonspatial","point","polygon","multipoint","polyline"];let b;function w(t,e,n){var r;const s={};null===(r=t.results)||void 0===r||r.forEach((t=>{t.tags.forEach((t=>{t&&(s[t]=(s[t]||0)+1)}))}));const i=Object.entries(s).sort(((t,e)=>e[1]-t[1])).map((([t])=>t));return(0,l.b)([...e||[],...i||[],...n||[]])}async function $({portal:t,query:e,user:n,contentUser:r,userContentGroups:l,store:c,config:d,allowedSubscriptionContentTypes:g,groupId:v,showHiddenItems:f}){var w,$,O,S,I,C,E,_,T;let R=(0,u.g)(t),F={};const{num:L,start:M,sortOrder:x,sortField:D,filters:B,baseQuery:G,baseFilter:N,searchTerm:z,bucket:H,allowedGeometries:U}=e;if((null==b?void 0:b.signal)&&b.abort(),c.state.recycleBin)return b=new AbortController,"my"===H?P({query:e,portal:t,user:r||n}):q({query:e,portal:t});if("group"===H&&l&&0===l.length)return{highlights:[],nextStart:-1,num:60,results:[],start:1,total:0};const W=v||"group"===H&&(null===(w=null==B?void 0:B.group)||void 0===w?void 0:w.id)&&"all"!==(null===($=null==B?void 0:B.group)||void 0===$?void 0:$.group)&&(null===(O=null==B?void 0:B.group)||void 0===O?void 0:O.group)||"living atlas"===H&&(null!==(S=null==c?void 0:c.state.livingAtlasGroupId)&&void 0!==S?S:await async function(t,e){var n,r;const i=await(0,s.q)({q:t.livingAtlasGroupQuery,num:1,sortField:"title",sortOrder:"asc"},t),o=(null===(r=null===(n=i.results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";e&&(e.state.livingAtlasGroupId=o);return o}(t,c))||"living atlas analysis"===H&&(null!==(I=null==c?void 0:c.state.livingAtlasAnalysisGroupId)&&void 0!==I?I:await async function(t,e){var n,r;const i=await(0,s.q)({q:j(t),num:1,sortField:"title",sortOrder:"asc"},t),o=(null===(r=null===(n=i.results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";e&&(e.state.livingAtlasAnalysisGroupId=o);return o}(t,c));if("subscription content"===H)return k(t,n,g);await A(t,H)&&(R="https://www.arcgis.com/sharing/rest/",F.addTokenManually=!1);const J=W?`content/groups/${W}/`:"",Q=`${R}${J}search`,V=function(t,e){if(!(null==t?void 0:t.length)||t.length===(null==h?void 0:h.length)||(null==e?void 0:e.isPortal))return"";return`((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${t.map((t=>`"${t}"`)).join(" OR ")})))`}(U,t),K=Object.keys(B||{}),X=H?await async function({bucket:t,contentUser:e,user:n,portal:r,filters:s}){switch(t){case"my":return`owner: ${(e||n).username}`;case"org":return`orgid:${r.id} ${r.isPortal?"-owner:esri_apps -owner:esri_webstyles -owner:esri_nav":""}`;case"favorites":return`group: ${await(0,i.d)()}`;case"group":if(!(null==s?void 0:s.group)||"all"===(null==s?void 0:s.group.group)){const t=await(0,i.b)(n);return(null==t?void 0:t.length)>m?"":`group:(${null==t?void 0:t.map((({id:t})=>t)).join(" OR ")})`}default:return""}}({bucket:H,user:n,contentUser:r,portal:t,store:c,filters:B}):"",Y=z&&(null===(C=(0,p.c)(z))||void 0===C?void 0:C.length)?`(${(0,p.c)(z)}) `:"",Z=!(!(null==d?void 0:d.semanticSearchEnabled)||!(null===(E=null==t?void 0:t.portalProperties)||void 0===E?void 0:E.semanticSearchEnabled))||n&&!n.orgId,tt=Object.assign(Object.assign(Object.assign({},N?{filter:`${N}`}:{}),Z?{enriched:!0}:{}),{q:`${G||""} ${V} ${X} ${Y} ${f?"":o.H}`,displaySublayers:!0,displayHighlights:!0,displayServiceProperties:!0}),et=Boolean(B.collaborations);let nt;et&&(nt=await async function(t,e,n,r){var s,i,o;const a=e.collaboration.id,l=null===(o=null===(i=null===(s=e.additionalParams)||void 0===s?void 0:s.origin)||void 0===i?void 0:i.split("__"))||void 0===o?void 0:o[1],u=await y(a,l,t,n,r),c=(null==u?void 0:u.collaboratedItems.map((t=>Object.keys(t)[0])))||[];return e.value=c.length?`id:(${c.join(" OR ")})`:"",u}(t,B.collaborations,M,L));const rt=[],st=K.reduce(((t,e)=>{const{param:n,value:r,additionalParams:s}=B[e];if(H&&"group"===e&&"group"!==H||"group"===e&&J||"folder"===e&&"my"!==H||"contentType"===e||"region"===e&&!["living atlas","living atlas analysis"].includes(H))return t;"categories"===e&&r&&rt.push(B[e].category),"region"===e&&r&&rt.push(B[e].categoryValue);const i="categories"===n?{}:{[n]:`${t[n]||""} ${r}`};return Object.assign(Object.assign(Object.assign({},t),i),null!=s?s:{})}),tt),it=Object.assign(Object.assign({num:L,start:et?1:M},"relevance"===D?{}:{sortField:D,sortOrder:x}),st||{}),ot=rt.length?rt.map((t=>`categories=${JSON.stringify([t])}`)).join("&"):"",at=rt.length?"?":"";try{const t=await(0,a.r)(`${Q}${at}${ot}`,it,F);let e=Object.assign(Object.assign({},t),{queryParams:it});return B.collaborations&&nt&&(null===(_=e.results)||void 0===_?void 0:_.length)&&(e=function(t,e){const{start:n,num:r,nextStart:s,total:i}=e;if(null!=n&&null!=r&&null!=i&&null!=s){const e=Object.assign(Object.assign({},t),{start:n,num:r,total:i});return e.queryParams.start=n,e.queryParams.num=r,e}return t}(e,nt)),e}catch(t){if(498===(null===(T=null==t?void 0:t.details)||void 0===T?void 0:T.httpStatus)&&"Invalid token."===(null==t?void 0:t.message)){const t=await(0,a.r)(`${Q}${at}${ot}`,it,Object.assign(Object.assign({},F),{addTokenManually:!1}));return Object.assign(Object.assign({},t),{queryParams:it})}}}function O(t,e){if(!e.deepLayerSearchEnabled)return{};const n={};return(t.highlights||[]).forEach((e=>{var r;const s=null===(r=t.results)||void 0===r?void 0:r.find((t=>t.id===e.id));if(!(null==s?void 0:s.sublayers))return;const i=Object.keys(e).filter((t=>"id"!==t&&t.includes("sublayers."))).reduce(((t,n)=>{const r=function(t){const e=t.replace("sublayers.","");return{fieldaliases:"fieldAliases",title:"title"}[e]||e}(n);return t[r]=e[n].map((t=>t.replaceAll("<em>","").replaceAll("</em>",""))),t}),{}),o=s.sublayers.filter((t=>Object.keys(t).some((e=>{var n;return null===(n=i[e])||void 0===n?void 0:n.some((n=>t[e].includes(n)))})))).map((t=>t.id));n[e.id]=Object.assign(Object.assign({},e),{sublayers:o})})),n}function j(t){return`title:"Living Atlas Analysis Layers" AND owner:${!0===t.isPortal?"esri_livingatlas":"esri"}`}async function A(t,e){var n;if((null==t?void 0:t.isPortal)&&"all"===e){const e=await(0,d.e)(t);if(null===(n=null==e?void 0:e.portalConfigProperties)||void 0===n?void 0:n.searchArcGISOnlineEnabled)return!0}return!1}async function S(t,e){return t&&e?(0,a.f)((async()=>{const n=`${(0,u.g)(e)}community/users/${t.username}/provisionedListings`;return(0,c.f)(n,{},"provisionedListings")}),"provisionedListings",`${e.id}-${t.username}`):[]}async function k(t,e,n){return e?(0,a.f)((async()=>{const s=await S(e,t);if(!(null==s?void 0:s.length))return{total:0,results:[],start:-1,num:100,nextStart:0};const i=null==s?void 0:s.map((t=>t.itemId)),o=await Promise.all(i.map((e=>async function(t,e){try{return(0,g.c)(t,e)}catch(t){return null}}(e,t)))),a=await Promise.all(null==i?void 0:i.map((e=>async function(t,e){var n;try{return null!==(n=(await(0,r.g)(t,e,{relationshipType:"Listed2ImplicitlyListed",direction:"forward"})).relatedItems)&&void 0!==n?n:[]}catch(t){return[]}}(e,t)))),l=a.reduce(((t,e)=>t.concat(e)),o).filter((t=>function(t,e){return null!=e||(e=["Map Service","Image Service","Feature Service","Stream Service","Vector Tile Service","WMS","WFS","WMTS","KML","Feature Collection","Feed"]),e.includes(null==t?void 0:t.type)}(t,n)));return{total:l.length,results:l,start:l.length?1:0,num:100,nextStart:0}}),"subscriptionContent",`${t.id}-${e.username}`):{total:0,results:[],start:0,num:100,nextStart:0}}async function I(t,e){return new Promise((async(n,r)=>{var s;null===(s=null==b?void 0:b.signal)||void 0===s||s.addEventListener("abort",(()=>{r(new DOMException("Aborted","AbortError"))}));const{start:i,num:l,sortField:u,sortOrder:c,searchTerm:d}=t,p=await(0,a.r)(e,{foldersContent:!0,inRecycleBin:!0,ignoreTypes:o.R,start:i,num:l,sortField:u,sortOrder:c}),g=d?p.items.filter((t=>t.title.toLowerCase().includes(d.toLowerCase()))):p.items,v=!!d&&g.length!==p.items.length;return n(Object.assign(Object.assign({},p),{results:g,num:l,queryParams:t,partial:v}))}))}const C=async({portal:t,user:e,forOrg:n})=>{var r;const s={start:0,num:100,sortField:"size",sortOrder:"desc"},i=n?await q({portal:t,query:s}):await P({query:s,portal:t,user:e});return null===(r=null==i?void 0:i.results)||void 0===r?void 0:r.reduce(((t,e)=>t+e.size),0)};async function P({query:t,portal:e,user:n}){return I(t,`${(0,u.g)(e)}content/users/${n.username}/`)}async function q({query:t,portal:e}){return I(t,`${(0,u.g)(e)}content/portals/${e.id}/`)}async function E(t,e,n){if(!(null==e?void 0:e.length)||!(null==n?void 0:n.length))return{result:{}};try{const r=[];(0,l.g)(e,100).forEach((e=>{r.push((0,a.r)(`${(0,u.g)(t)}content/itemsgroups`,{items:n.map((t=>t.id)).join(","),groups:e.map((t=>t.id)).join(",")}))}));const s=(await Promise.all(r)).reduce(((t,e)=>(Object.values(e).forEach((e=>{const{groupId:n,items:r}=e;r.forEach((({itemId:e})=>{t[e]=[...t[e]||[],n]}))}),{}),t)),{});return{result:s}}catch(t){return{result:{}}}}async function _(t,e){try{const n=`${(0,u.g)(t)}search`;return{result:(await(0,a.r)(n,{q:`id:(${e.join(" OR ")})`})).results}}catch(t){return{result:[]}}}async function T(t,e,n,r){var s;const i=await A(e,r.state.bucket),o=i?`https://www.arcgis.com/sharing/rest/content/items/${t.id}`:(0,v.g)(t.id,e),l=i||!n?{disableIdentityLookup:!0,addTokenManually:!1}:{};try{return{result:await(0,a.r)(o,{},l)}}catch(t){if("SB_0005"===(null===(s=null==t?void 0:t.details)||void 0===s?void 0:s.messageCode))return{error:{code:"disabledSubscription"}}}return{error:{code:"unhandledError"}}}function R({bucket:t,oldBucket:e,filters:n,switchingBucket:r,keepSpecialFilters:s}){var i,o;const a=Object.assign({},n);if("my"===t||s&&"recycle"!==(null===(i=a.folder)||void 0===i?void 0:i.folder)||delete a.folder,"org"!==t&&("recycle"===(null===(o=a.contentType)||void 0===o?void 0:o.contentType)?a.contentType.contentType="all":s||delete a.contentType),"group"===t||s||delete a.group,r){const n=["group","living atlas","living atlas analysis","subscription content"];(n.includes(t)||n.includes(e))&&delete a.categories,"living atlas"===t?(delete a.modified,delete a.created,delete a.sharing,delete a.collaborations):delete a.region}return a}},96295:(t,e,n)=>{n.d(e,{H:()=>r,R:()=>s});const r='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")',s="Indoors Map Configuration,Code Attachment"},93816:(t,e,n)=>{n.d(e,{f:()=>s});var r=n(46581);async function s(t,e,n="results",s=!1){let i,o,a,l,u=1,c=[];e.start=u,e.num||(e.num=100);try{const d=await(0,r.r)(t,e);if(!(null==d?void 0:d[n]))return c;for(c=[...c,...d[n]],u=d.nextStart,i=d.total-c.length,o=Math.ceil(i/e.num),a=[],l=0;l<o;l++)if(e.start=u+l*e.num,s){const s=await(0,r.r)(t,e);(null==s?void 0:s[n])&&(c=[...c,...s[n]])}else a.push((0,r.r)(t,e));if(!s){(await Promise.all(a)).forEach((t=>{c=[...c,...t[n]]}))}return c}catch(t){return c}}},5157:(t,e,n)=>{n.d(e,{D:()=>s,b:()=>r,s:()=>i});const r={xxs:320,xs:480,sm:640,md:768,lg:1024,xl:1280},s=960;function i(t){var e,n;return null!==(e=(n=t.state).resizeObserver)&&void 0!==e||(n.resizeObserver=new ResizeObserver(o)),t.state.resizeObserver}function o(t){t.forEach((t=>{if(t.contentRect.width>0){const e=new CustomEvent("arcgisBrowserResize",{detail:{width:t.contentRect.width,height:t.contentRect.height}});t.target.dispatchEvent(e)}}))}},69773:(t,e,n)=>{n.d(e,{a:()=>i,b:()=>a,g:()=>u,i:()=>s,o:()=>o});var r=n(78613);const s=t=>"item-browser"===t.state.type,i=(t,e,n)=>{e.onChange("filters",(e=>{e[t]&&e[t].value||n()}))},o=(t,e)=>{t.onChange("preview",(t=>{e()}))},a=(t,e)=>{t.onChange("groupId",(t=>{e()}))},l=new Map;function u(t,e){const n=l.get(t);if(n)return n;const s=(0,r.c)(t,e);return s?(l.set(t,s.store),s.store):null}},22783:(t,e,n)=>{n.d(e,{c:()=>s});var r=n(78613);function s(t=""){return(0,r.s)(t).replace(/[<>\/\\[\]\?]/g,"\\$&").trim()}},80619:(t,e,n)=>{n.d(e,{I:()=>r,a:()=>s});const r=["folder","group","contentType"],s=99999}}]);