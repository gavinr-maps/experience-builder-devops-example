/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-1378ee.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-1378ee"],{36746:(e,s,t)=>{t.r(s),t.d(s,{arcgis_smart_mapping_type_actions_popover:()=>a,arcgis_smart_mapping_type_add_value:()=>n});var l=t(7263),o=(t(77040),t(70506),t(82646)),i=t(64164);t(99004),t(58233),t(28926),t(78613),t(62159),t(11935),t(1991);const a=class{constructor(e){(0,l.r)(this,e),this.arcgisSmartMappingTypeActionsPopoverChange=(0,l.c)(this,"arcgisSmartMappingTypeActionsPopoverChange",7),this.arcgisSmartMappingTypeActionsPopoverFocusExit=(0,l.c)(this,"arcgisSmartMappingTypeActionsPopoverFocusExit",7),this.checkedClasses=void 0,this.groupMenuNodes=void 0,this.referenceNode=void 0,this.showMoveToGroup=!1}componentWillLoad(){this.topActionHandler=e=>{e.shiftKey&&"Tab"===e.key&&this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("top")}}componentDidRender(){var e,s;const t=((null===(e=this.moveUpNode)||void 0===e?void 0:e.disabled)?void 0:this.moveUpNode)||((null===(s=this.moveDownNode)||void 0===s?void 0:s.disabled)?void 0:this.moveDownNode)||this.mergeNode||this.separateNode||this.moveToGroupNode;null==t||t.removeEventListener("keydown",this.topActionHandler),t.addEventListener("keydown",this.topActionHandler)}async focusActionPad(){var e;null===(e=this.actionPadNode)||void 0===e||e.setFocus()}async focusLastAction(){if(this.actionPadNode){let e=Array.from(this.actionPadNode.querySelectorAll("calcite-action")).filter((e=>!1===e.disabled));e[e.length-1].setFocus()}}render(){var e,s;const{strings:t}=o.s;if(!(null===(e=this.checkedClasses)||void 0===e?void 0:e.length))return null;const i=null===(s=this.referenceNode)||void 0===s?void 0:s.getBoundingClientRect();return(0,l.h)(l.H,null,(0,l.h)("calcite-popover",{class:"js-app-flyout popover",placement:"leading-start",offsetDistance:10,offsetSkidding:(i.height-120)/4+70,pointerDisabled:!0,label:t.panels.type.typeActions,triggerDisabled:!0,referenceElement:this.referenceNode,open:!0,ref:e=>this.popoverNode=e},this.showMoveToGroup?this.renderMoveToGroup():this.renderActions()))}renderActions(){return(0,l.h)("calcite-action-pad",{layout:"vertical",position:"start",expanded:!0,expandDisabled:!0,ref:e=>{e&&(this.actionPadNode=e)}},this.renderGroup1(),this.renderGroup2(),this.renderGroup3())}renderMoveToGroup(){if(!this.showMoveToGroup)return null;const{strings:e}=o.s,s=(0,o.b)(),t=s.uniqueValueGroups,i=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx,a=t.map(((e,s)=>this.renderMoveToGroupListItem(e,s)));return(0,l.h)("calcite-panel",{heading:e.panels.type.moveToGroup,closable:!0,onCalcitePanelClose:()=>{this.showMoveToGroup=!1,(0,l.f)(this.hostElement),setTimeout((()=>this.moveToGroupNode.setFocus()),300)},ref:e=>null==e?void 0:e.setFocus()},(0,l.h)("calcite-list",{filterEnabled:t.length>=10,filterPlaceholder:e.panels.type.searchGroups,label:e.panels.type.selectGroup,selectionMode:"single"},a,!s.uniqueValueGroups.length&&(0,l.h)("calcite-list-item",{label:e.panels.type.untitledGroup,onCalciteListItemSelect:()=>this.moveToNewGroup(!0)}),(0,l.h)("calcite-list-item",{label:s.defaultLabel||e.panels.type.other,value:-1,disabled:-1===i,onCalciteListItemSelect:()=>{this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(t[e.groupIdx].classes.splice(e.classIdx,1),t[e.groupIdx].classes.length||t.splice(e.groupIdx,1))})),this.checkedClasses=[],s.uniqueValueGroups=t,(0,o.u)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[-1])||void 0===e?void 0:e.setFocus()}),300)}})),(0,l.h)("calcite-button",{appearance:"outline",label:e.cancel,innerHTML:e.cancel,width:"full",slot:"footer",onClick:()=>{this.showMoveToGroup=!1,(0,l.f)(this.hostElement),setTimeout((()=>this.moveToGroupNode.setFocus()),300)}}))}renderMoveToGroupListItem(e,s){const{strings:t}=o.s,a=(0,o.b)(),n=a.uniqueValueGroups,r=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx;return(0,l.h)("calcite-list-item",{label:e.heading||t.panels.type.untitledGroup,value:s,disabled:r===s,onCalciteListItemSelect:e=>{const s=e.target.value;let t=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>n[e.groupIdx].classes[e.classIdx]));const l=(0,i.b)();t=t.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>l[e.classIdx])));const r=n[s];r.classes=r.classes.concat(t),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(n[e.groupIdx].classes.splice(e.classIdx,1),n[e.groupIdx].classes.length||n.splice(e.groupIdx,1))})),this.checkedClasses=[],a.uniqueValueGroups=n,(0,o.u)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[s])||void 0===e?void 0:e.setFocus()}),300)}})}renderGroup1(){var e;const{strings:s}=o.s,t=(0,o.b)().uniqueValueGroups;if(this.checkedClasses.find((e=>-1==e.groupIdx)))return;const i=this.checkedClasses.map((e=>e.classIdx)),a=i.length,n=null===(e=t[this.checkedClasses[0].groupIdx])||void 0===e?void 0:e.classes.length;i.sort(((e,s)=>e-s));const r=i[0]>0||!!i.find(((e,s)=>s>0&&e-1>i[s-1])),d=i[a-1]<n-1||!!i.find(((e,s)=>s<a-1&&e+1<i[s+1]));return(0,l.h)("calcite-action-group",null,(0,l.h)("calcite-action",{text:s.panels.type.moveUp,textEnabled:!0,disabled:!r,icon:"arrow-bold-up",onClick:()=>this.moveUp(),ref:e=>this.moveUpNode=e}),(0,l.h)("calcite-action",{text:s.panels.type.moveDown,textEnabled:!0,disabled:!d,icon:"arrow-bold-down",onClick:()=>this.moveDown(),ref:e=>this.moveDownNode=e}))}renderGroup2(){const{strings:e}=o.s,s=(0,o.b)().uniqueValueGroups,t=!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx)),i=!!this.checkedClasses.find((e=>-1!==e.groupIdx))&&this.checkedClasses.length>1,a=!!this.checkedClasses.find((e=>-1!==e.groupIdx&&s[e.groupIdx].classes[e.classIdx].values.length>1)),n=!t&&-1!==this.checkedClasses[0].groupIdx&&this.checkedClasses.length===s[this.checkedClasses[0].groupIdx].classes.length;return(0,l.h)("calcite-action-group",null,i&&(0,l.h)("calcite-action",{text:e.panels.type.mergeValues,textEnabled:!0,onClick:()=>this.mergeValues(),ref:e=>this.mergeNode=e}),a&&(0,l.h)("calcite-action",{text:e.panels.type.separateValues,textEnabled:!0,onClick:()=>this.separateSelectedValues(),ref:e=>this.separateNode=e}),(0,l.h)("calcite-action",{text:e.panels.type.moveToGroup,textEnabled:!0,onClick:()=>this.moveToGroup(),ref:e=>{e&&(this.moveToGroupNode=e)}}),(0,l.h)("calcite-action",{text:e.panels.type.newGroup,textEnabled:!0,disabled:n,onClick:()=>this.moveToNewGroup(),ref:e=>this.moveToNewGroupNode=e}))}renderGroup3(){const{strings:e}=o.s;return(0,l.h)("calcite-action-group",null,(0,l.h)("calcite-action",{text:e.panels.type.clearSelection,textEnabled:!0,onClick:()=>this.clearSelection(),onKeyDown:e=>{e.shiftKey||"Tab"!==e.key||this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("bottom")}}))}clearSelection(){let e=-1;this.checkedClasses.forEach((s=>e=-1===s.groupIdx?e:-1===e?s.groupIdx:Math.min(e,s.groupIdx))),this.checkedClasses=[],this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e])||void 0===s?void 0:s.setFocus()}),300)}mergeValues(){const e=(0,o.b)(),s=e.uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:-1===e.groupIdx||-1===s.groupIdx?s.groupIdx-e.groupIdx:e.groupIdx-s.groupIdx));const t=s[this.checkedClasses[0].groupIdx].classes[this.checkedClasses[0].classIdx],l=(0,i.b)();this.checkedClasses.forEach(((e,o)=>{if(o>0){const o=-1===e.groupIdx?l[e.classIdx]:s[e.groupIdx].classes[e.classIdx];t.values=t.values.concat(o.values),t.label+=`, ${o.label}`}}));const a=[];s.forEach(((e,s)=>{const l=[];e.classes.forEach(((e,o)=>{this.checkedClasses[0].groupIdx===s&&this.checkedClasses[0].classIdx===o?l.push(t):this.checkedClasses.find((e=>e.groupIdx===s&&e.classIdx===o))||l.push(e)})),l.length&&(e.classes=l,a.push(e))})),e.uniqueValueGroups=a,this.checkedClasses=[],(0,o.u)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}moveDown(){const{modules:e}=o.s,s=(0,o.b)(),t=s.uniqueValueGroups,l=t[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx));const i=e.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx<l.classes.length-1&&(0===s||s>0&&i[s-1].classIdx!==e.classIdx+1)){const t=l.classes.splice(e.classIdx,1)[0];l.classes.splice(e.classIdx+1,0,t),i[s].classIdx=e.classIdx+1}})),this.checkedClasses=i,s.uniqueValueGroups=t,(0,o.u)(),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.moveDownNode.disabled?this.moveUpNode.setFocus():this.moveDownNode.setFocus()}),300)}moveToGroup(){this.showMoveToGroup=!0}moveToNewGroup(e=!1){const{modules:s}=o.s,t=(0,o.b)(),l=t.uniqueValueGroups;let a=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>l[e.groupIdx].classes[e.classIdx]));const n=(0,i.b)();a=a.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>n[e.classIdx])));const r=new s.UniqueValueGroup({heading:e?null:(0,i.d)(l),classes:a});l.push(r),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(l[e.groupIdx].classes.splice(e.classIdx,1),l[e.groupIdx].classes.length||l.splice(e.groupIdx,1))})),this.checkedClasses=[],t.uniqueValueGroups=l,(0,o.u)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[l.length-1])||void 0===e?void 0:e.setFocus()}),300)}moveUp(){const{modules:e}=o.s,s=(0,o.b)(),t=s.uniqueValueGroups,l=t[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const i=e.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx>0&&(0===s||s>0&&i[s-1].classIdx!==e.classIdx-1)){const t=l.classes.splice(e.classIdx,1)[0];l.classes.splice(e.classIdx-1,0,t),i[s].classIdx=e.classIdx-1}})),this.checkedClasses=i,s.uniqueValueGroups=t,(0,o.u)(),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.moveUpNode.disabled?this.moveDownNode.setFocus():this.moveUpNode.setFocus()}),300)}separateSelectedValues(){const e=(0,o.b)().uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const s=[];let t=-2,l=[];this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(t!==e.groupIdx?(-2!==t&&s.push({groupIdx:t,classIdxs:l}),t=e.groupIdx,l=[e.classIdx]):l.push(e.classIdx))})),-2!==t&&s.push({groupIdx:t,classIdxs:l}),s.forEach((s=>(0,i.f)(e[s.groupIdx],s.classIdxs))),this.checkedClasses=[],(0,o.u)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}get hostElement(){return(0,l.d)(this)}};a.style=".popover{z-index:100}";const n=class{constructor(e){(0,l.r)(this,e),this.arcgisSmartMappingTypeAddValuePopoverClose=(0,l.c)(this,"arcgisSmartMappingTypeAddValuePopoverClose",7),this.arcgisSmartMappingTypeAddValuePopoverNewValue=(0,l.c)(this,"arcgisSmartMappingTypeAddValuePopoverNewValue",7),this.userTouchedLabel=!1,this.flowItemNode=void 0,this.referenceNode=void 0,this.groupIdx=void 0}componentWillLoad(){var e,s;const{allUniqueValues:t}=o.s,l=(0,o.b)();this.allValues=null==t?void 0:t.map((e=>""+e.value)),l.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{var s;const t=null===(s=e.values)||void 0===s?void 0:s[0].value;-1===this.allValues.indexOf(""+t)&&this.allValues.push(""+t)}))})),this.field=(0,o.t)(l.field),this.isDate=(null===(e=this.field)||void 0===e?void 0:e.simpleFieldType)===o.w.DATE,this.isNumber=(null===(s=this.field)||void 0===s?void 0:s.simpleFieldType)===o.w.NUMBER,this.isInt=this.field&&["small-integer","integer","long"].indexOf((0,o.z)(this.field.layerField))>-1}componentDidLoad(){var e;null===(e=this.panelNode)||void 0===e||e.setFocus()}disconnectedCallback(){clearTimeout(this.addNumberHandle)}render(){const{strings:e}=o.s;return(0,l.h)(l.H,{key:"7e29e2b5bccf8c7c374df6babc0a5883df0eec36"},(0,l.h)("calcite-popover",{key:"3b661590a9d7a41af7d688c80ec3be340fa45a5a",referenceElement:this.referenceNode,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,label:e.panels.type.addValue,open:!0,ref:e=>this.popoverNode=e},this.renderContent()))}renderContent(){var e;const{strings:s}=o.s,t=null===(e=this.flowItemNode)||void 0===e?void 0:e.getBoundingClientRect().width;return(0,l.h)("calcite-panel",{heading:s.panels.type.addValue,closable:!0,onCalcitePanelClose:()=>this.arcgisSmartMappingTypeAddValuePopoverClose.emit(),ref:e=>this.panelNode=e},(0,l.h)("div",{ref:e=>{e&&(e.style.padding="15px",e.style.width=`${t?t+20:280}px`)}},this.renderValueInput(),this.renderLabelInput()),this.renderDoneButton())}renderValueInput(){const{strings:e}=o.s,{isDate:s,isInt:t,isNumber:i}=this;return(0,l.h)("calcite-label",{scale:"s"},e.panels.type.value,s?(0,l.h)("calcite-input-date-picker",{scale:"s",overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>{const s=e.target;this.handleAddDate(s.value)},ref:e=>{e&&(this.valueInputNode=e)}}):i?(0,l.h)("calcite-input-number",{step:t?1:"any",scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputNumberInput:()=>{clearTimeout(this.addNumberHandle);const e=this.valueInputNode.value;isNaN(Number(e))?(this.doneButtonNode.disabled=!0,this.valueInputMessageNode.hidden=!0,this.addNumberHandle=setTimeout((()=>{this.valueInputNode.value=void 0,this.userTouchedLabel||(this.labelInputNode.value=void 0)}),3e3)):this.handleAddNumber(e)},ref:e=>{e&&(this.valueInputNode=e)}}):(0,l.h)("calcite-input",{scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputInput:()=>this.handleAddString(this.valueInputNode.value),ref:e=>{e&&(this.valueInputNode=e)}}),(0,l.h)("calcite-input-message",{hidden:!0,icon:"exclamation-mark-triangle",status:"invalid",ref:e=>this.valueInputMessageNode=e},e.panels.type.valueNotUnique))}renderLabelInput(){const{strings:e}=o.s;return(0,l.h)("calcite-label",{scale:"s"},e.panels.type.label,(0,l.h)("calcite-input",{type:"text",value:"",scale:"s",placeholder:e.panels.type.displayedValue,label:e.panels.type.label,onCalciteInputInput:()=>this.userTouchedLabel=!0,ref:e=>this.labelInputNode=e}))}renderDoneButton(){const{modules:e,strings:s}=o.s,{field:t,isDate:a,isInt:n,isNumber:r}=this;return(0,l.h)("calcite-button",{appearance:"solid",label:s.done,width:"full",slot:"footer",disabled:!0,onClick:()=>{this.popoverNode.open=!1;const s=this.valueInputNode.value;let l,o;a?l=this.labelInputNode.value||(0,i.e)(s,t):r?(o=n?parseInt(s):parseFloat(s),l=this.labelInputNode.value||e.intl.formatNumber(o)):(l=this.labelInputNode.value||s,o=s),this.addValue(l,o)},ref:e=>this.doneButtonNode=e},s.done)}addValue(e,s){var t;const{modules:l}=o.s,i=(0,o.b)(),a=l.esriLang.clone((null===(t=i.uniqueValueInfos.find((e=>{var s;return["simple-marker","simple-line","simple-fill","cim"].indexOf(null===(s=e.symbol)||void 0===s?void 0:s.type)>-1})))||void 0===t?void 0:t.symbol)||(0,o.q)((0,o.a)())),n=(0,o.a2)();if(n){const e=n.colors[i.uniqueValueInfos.length%n.colors.length];e&&(0,o.W)(a,e)}else{const e=(0,o.a3)().colors,s=new l.esriColor(e[i.uniqueValueInfos.length%10]);s&&(0,o.W)(a,s)}let r=i.uniqueValueGroups;-2===this.groupIdx&&(r=[new l.UniqueValueGroup({heading:void 0,classes:[]})],this.groupIdx=0),r[this.groupIdx].classes.push(new l.UniqueValueClass({values:[new l.UniqueValue({value:s})],label:e,symbol:a})),i.uniqueValueGroups=r,this.arcgisSmartMappingTypeAddValuePopoverNewValue.emit()}handleAddDate(e){const{allUniqueValues:s}=o.s,t=(0,o.b)(),l=null==s?void 0:s.map((e=>""+e.value));t.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{var s;const t=null===(s=e.values)||void 0===s?void 0:s[0].value;-1===l.indexOf(""+t)&&l.push(""+t)}))}));const a=(0,o.t)(t.field);this.userTouchedLabel||(this.labelInputNode.value=(0,i.e)(e,a)),this.valueInputMessageNode.hidden=-1===l.indexOf(e),this.doneButtonNode.disabled=!e.length||l.indexOf(e)>-1}handleAddNumber(e){const{modules:s}=o.s;if(e.length&&this.isInt){let s=""+Math.round(parseFloat(e));s.indexOf(".")>-1&&(s=s.substring(0,s.indexOf("."))),s!==e&&(e=s)}if(!this.userTouchedLabel){const t=this.isInt?parseInt(e):parseFloat(e);this.labelInputNode.value=s.intl.formatNumber(t)}this.valueInputMessageNode.hidden=-1===this.allValues.indexOf(e),this.doneButtonNode.disabled=!e.length||this.allValues.indexOf(e)>-1}handleAddString(e){this.userTouchedLabel||(this.labelInputNode.value=e),this.valueInputMessageNode.hidden=-1===this.allValues.indexOf(e),this.doneButtonNode.disabled=!e.length||this.allValues.indexOf(e)>-1}get hostElement(){return(0,l.d)(this)}}},64164:(e,s,t)=>{t.d(s,{a:()=>a,b:()=>d,c:()=>i,d:()=>c,e:()=>r,f:()=>h,g:()=>u,s:()=>p});var l=t(1991),o=t(82646);t(70506);function i(e){var s;const{layer:t,useFeatureReduction:i,mapImageSublayer:a,mapView:n,modules:r}=o.s,d=t;e=e||{};const u=(0,o.p)((0,o.b)()),c=e.fieldInfos[0];return r.TypeCreator.createRenderer({layer:d,view:n,field:c.field,valueExpression:c.expression,valueExpressionTitle:c.expressionTitle,numTypes:e.numTypes||10,sortBy:e.sortBy||"count",typeScheme:e.typeScheme||(0,o.a2)(),returnAllCodedValues:!0,outlineOptimizationEnabled:!a&&(!(0,l.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!a&&(!(0,l.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!0,forBinning:"binning"===(null===(s=d.featureReduction)||void 0===s?void 0:s.type)&&i}).then((s=>{if(s.excludedUniqueValueInfos.length||(s.renderer.defaultLabel=null,s.renderer.defaultSymbol=null),p(e)){const e=(0,o.b)().clone(),t=(0,o.d)(e,"size","auto"),l=(0,o.d)(e,"size","outline");if(s.renderer.visualVariables=[],t&&(s.renderer.visualVariables=s.renderer.visualVariables||[],s.renderer.visualVariables.push(t)),l&&(s.renderer.visualVariables=s.renderer.visualVariables||[],s.renderer.visualVariables.push(l)),s.renderer.uniqueValueInfos=e.uniqueValueInfos,s.renderer.field2=e.field2,s.renderer.field3=e.field3,(0,o.D)()&&"type-size"===(0,o.a)()){const e=(0,o.q)(),t=s.renderer.uniqueValueInfos.slice();t.map((s=>{const t=(0,o.Q)(s.symbol);s.symbol=e.clone(),(0,o.W)(s.symbol,t)})),s.renderer.uniqueValueInfos=t}}return(0,o.o)(u,s.renderer),Promise.resolve(s)}),(e=>Promise.reject(e)))}function a(e){var s;const{layer:t,useFeatureReduction:i,mapImageSublayer:a,mapView:n,modules:r}=o.s,d=t;let u=(e=e||[]).fieldInfos?e.fieldInfos[0]:null;const c=(0,o.b)(),p=(0,o.p)(c),h=c.uniqueValueInfos&&c.uniqueValueInfos.length?c.uniqueValueInfos[0].symbol:null,g=c.defaultSymbol,m=c.defaultLabel,v=u&&(u.field!=c.field||u.expression!=c.valueExpression);return e=e||{},r.TypeCreator.createRenderer({layer:d,view:n,field:u?u.field:c.field,valueExpression:u?u.expression:c.valueExpression,valueExpressionTitle:u?u.expressionTitle:c.valueExpressionTitle,numTypes:e.numTypes||(v?10:c.uniqueValueInfos.length),sortBy:e.sortBy||"count",typeScheme:(0,o.a2)(),outlineOptimizationEnabled:!a&&((0,l.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!p.sizeOutlineVisVar),sizeOptimizationEnabled:!a&&((0,l.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!p.sizeAutoVisVar),legendOptions:e.legendOptions||c.legendOptions,defaultSymbolEnabled:(0,l.i)(e.defaultSymbolEnabled)||!!c.defaultSymbol,forBinning:"binning"===(null===(s=d.featureReduction)||void 0===s?void 0:s.type)&&i}).then((e=>{if((0,o.o)(p,e.renderer),h&&e.renderer.uniqueValueInfos&&e.renderer.uniqueValueInfos.length){const s=e.renderer.uniqueValueInfos.slice();s.map((e=>{const s=h.clone();(0,o.W)(s,(0,o.Q)(e.symbol)),e.symbol=s})),e.renderer.uniqueValueInfos=s}return g&&(e.renderer.defaultSymbol=g,e.renderer.defaultLabel=m),Promise.resolve(e)}),(e=>Promise.reject(e)))}const n={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function r(e,s){const{allUniqueValues:t,locale:l,mapView:i,modules:a}=o.s;if(a.intl.setLocale(l),(null==s?void 0:s.simpleFieldType)===o.w.DATE){const s=t&&a.rendererSupportUtils.calculateDateFormatInterval(t.map((e=>e.value)));let l=new Date(e);if("unknown"===i.timeZone)return a.intl.formatDate(l,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(s?n[s]:"long-month-day-year")),{timeZone:"utc",timeZoneName:"shortOffset"}));{const e=new Date(l.getTime()+6e4*l.getTimezoneOffset());return a.intl.formatDate(e,Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions(s?n[s]:"long-month-day-year")),{timeZone:i.timeZone}))}}return a.intl.formatDateOnly(e,a.intl.convertDateFormatToIntlOptions("long-month-day-year"))}function d(){const{allUniqueValues:e,modules:s}=o.s,t=(0,o.b)();if(!(null==e?void 0:e.length)||!(0,l.i)(e[0].count))return[];let i=[];t.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push(`${e.value}`))))),i=i.concat(s)}));return e.filter((e=>-1===i.indexOf(null===e.value?"<Null>":`${e.value}`))).map((e=>new s.UniqueValueClass({label:e.label,symbol:e.symbol,values:[{value:e.value}]})))}function u(){const{allUniqueValues:e}=o.s,s=(0,o.b)();if(!(null==e?void 0:e.length)||!(0,l.i)(e[0].count))return[];let t=[];s.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push("<Null>"===e.value?"null":`${e.value}`))))),t=t.concat(s)}));return e.filter((e=>-1===t.indexOf(`${e.value}`)))}function c(e){const{strings:s}=o.s;let t=1,l=s.panels.type.defaultGroupName.replace("${number}",t.toString());for(;e.find((e=>e.heading===l));)l=s.panels.type.defaultGroupName.replace("${number}",(++t).toString());return l}function p(e){if(["type","type-size"].indexOf((0,o.a)())>-1){const s=(0,o.b)(),t={field:s.field,expression:s.valueExpression,expressionTitle:s.valueExpressionTitle};if((0,o.x)(e.fieldInfos[0],t))return!0}return!1}function h(e,s){const{modules:t}=o.s,l=(0,o.b)(),i=(0,o.t)(l.field),a=i&&["small-integer","integer","big-integer","long"].indexOf((0,o.z)(i.layerField))>-1,n=(null==i?void 0:i.simpleFieldType)===o.w.DATE,d="date-only"===(0,o.z)(i.layerField),u=[],c=(0,o.a2)();let p=0;e.classes.forEach(((l,h)=>{var g;if(1===l.values.length||s&&-1===s.indexOf(h))u.push(l),p++;else if(!s||s.indexOf(h)>-1){const s=["simple-marker","simple-line","simple-fill","cim"].indexOf(null===(g=l.symbol)||void 0===g?void 0:g.type)>-1?l.symbol:(0,o.q)((0,o.a)());l.values.forEach(((l,h)=>{const g=t.esriLang.clone(s);if(h>0)if(c){const s=c.colors[(e.classes.length+p)%c.colors.length];s&&(0,o.W)(g,s)}else{const s=(0,o.a3)().colors,l=new t.esriColor(s[(e.classes.length+p)%10]);l&&(0,o.W)(g,l)}const m=n||d?r(l.value,i):(null==i?void 0:i.simpleFieldType)===o.w.NUMBER?t.intl.formatNumber(a?parseInt(l.value):parseFloat(l.value)):l.value;u.push(new t.UniqueValueClass({values:[new t.UniqueValue({value:l.value})],label:m,symbol:g})),p++}))}})),e.classes=u}}}]);