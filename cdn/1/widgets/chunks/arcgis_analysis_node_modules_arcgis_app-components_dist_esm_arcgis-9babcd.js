/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9babcd.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9babcd"],{57703:(e,t,i)=>{i.r(t),i.d(t,{arcgis_symbol_picker:()=>ve});var s=i(7263),o=i(82748),r=i(94278),l=i(79241),n=i(81457),a=i(62159),c=i(58233);i(28926),i(70506),i(99004),i(78613);function m(e){return{authMode:"public"===e.access?"anonymous":"auto"}}const d=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],u=[{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"}],y=[{type:"esriSFS",color:[0,0,0,64],outline:{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"},style:"esriSFSSolid"}];function h(e){return[{title:e.symbolSources.circle,name:"Circle",primitive:"circle"},{title:e.symbolSources.square,name:"Square",primitive:"square"},{title:e.symbolSources.cross,name:"Cross",primitive:"cross"},{title:e.symbolSources.x,name:"X",primitive:"x"},{title:e.symbolSources.kite,name:"Kite",primitive:"kite"},{title:e.symbolSources.triangle,name:"Triangle",primitive:"triangle"}].map((e=>{var t;return{dimensionality:"flat",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:e.primitive},material:{color:null===(t=null===r.e||void 0===r.e?void 0:r.e.gfxUtils)||void 0===t?void 0:t.defaultThematicColor},outline:{color:[0,0,0]}}]}}))}function p(e){return[{title:e.symbolSources.sphere,name:"Sphere",primitive:"sphere"},{title:e.symbolSources.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cylinder,name:"Cylinder",primitive:"cylinder"},{title:e.symbolSources.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{title:e.symbolSources.cube,name:"Cube",primitive:"cube"},{title:e.symbolSources.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cone,name:"Cone",primitive:"cone"},{title:e.symbolSources.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:e.symbolSources.diamond,name:"Diamond",primitive:"diamond"},{title:e.symbolSources.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}].map((e=>({dimensionality:"volumetric",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[Object.assign({type:"Object",resource:{primitive:e.primitive}},e.mixins)]})))}const b=24,g=42;async function S(e,t,i,s){try{await r.e.symbolUtils.renderPreviewHTML(t,Object.assign({node:e},i))}catch(t){e.appendChild(v(s))}return e}function v(e){const t=document.createElement("span");return t.setAttribute("alt",""),t.innerHTML=e,t}function f(e="2d"){return{async getSymbol(t){const{data:i,parentData:s,portalItem:l}=t,n=await async function(e,t,i,s){const o=function(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/.test(t)&&"Esri Style"!==t)return t;return}(i);let l=null;o||(l=`${i.itemUrl}/data`);const n={data:e,baseUrl:i.itemUrl,styleName:o,styleUrl:l},{portal:a}=i;return r.e.webStyleSymbolUtils.fetchSymbolFromStyle(n,t,{portal:a},s,r.e.styleUtils.symbolUrlFromStyleItem,m(i))}(s,i.name,l,s.cimVersion&&"2d"===e?"cimRef":"webRef");return"point-3d"===n.type&&n.symbolLayers.forEach((e=>{if(e.get("material.color"))if("icon"===e.type){const t=null!=e.material?e.material:{};t.color=r.e.gfxUtils.defaultThematicColor.clone(),e.material=t}else if("object"===e.type){const t=null!=e.material?e.material:{};t.color=t.color||(0,o.c)([255,255,255]),e.material=t}})),n},getThumbnail:async e=>async function(e){var t,i;const s=e.data;let o=null===(t=s.thumbnail)||void 0===t?void 0:t.href;const l=null===(i=s.thumbnail)||void 0===i?void 0:i.imageData,n=s.title||e.strings.symbolSources.noTitle,a=document.createElement("div"),c=!!s.cimRef,m=function(e){var t,i;const s=null===(t=e.formats)||void 0===t?void 0:t.includes("web3d"),o=null===(i=e.formatInfos)||void 0===i?void 0:i.some((e=>"gltf"===e.type||"gltf_basisu"===e.type));return s||o}(s),d={size:m&&"volumetric"===s.dimensionality?g:b,disableUpsampling:!1};if(c&&!m){const t=await e.getSymbol();if(!(0,r.f)(t))return(0,r.h)(t)&&delete d.size,S(a,t,d,n)}return r.e.devEnvironmentUtils.isDevEnvironment()&&(o=r.e.devEnvironmentUtils.adjustStaticAGOUrl(o)),o||l?S(a,new r.e.WebStyleSymbol({name:s.name,styleUrl:`${e.portalItem.itemUrl}/data`,thumbnail:{url:l?`data:image/jpeg;base64, ${l}`:r.e.urlUtils.makeAbsolute(o,e.portalItem.itemUrl)}}),d,n):(a.appendChild(v(n)),a)}(e)}}const I={getSymbol:async e=>r.e.jsonUtils.fromJSON(e.data),async getThumbnail(e){const t=await e.getSymbol(),i={size:"line"===(0,r.g)(t)?{width:b}:b};return r.e.symbolUtils.renderPreviewHTML(t,i)}},_={getSymbol:async e=>r.e.jsonUtils.fromJSON(e.data),async getThumbnail(e){const t=await e.getSymbol();return r.e.symbolUtils.renderPreviewHTML(t,{size:g-4})}},w=Function.prototype;class C{constructor({data:e,parentData:t,portalItem:i,strategy:s,strings:o}){this.data=e,this.parentData=t,this.portalItem=i,this.strategy=s,this.strings=o}async getSymbol(){if(!this._symbol){const e=this._symbolRequest||(this._symbolRequest=this.strategy.getSymbol(this));this._symbol=await e}return this._symbol.clone()}async getThumbnail(e){if(this._thumbnail)return e.appendChild(this._thumbnail),w;const t=this._thumbnailRequest||(this._thumbnailRequest=this.strategy.getThumbnail(this));return this._thumbnail=await t,()=>e.appendChild(this._thumbnail)}}class k{constructor({portalItem:e,strings:t,symbolType:i}){this.symbolType="2d",this.portalItem=e,this.strings=t,i&&(this.symbolType=i)}get data(){return this._data}get id(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.id}get keywords(){var e;return(null===(e=this.portalItem)||void 0===e?void 0:e.typeKeywords)||[]}get name(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.name}get title(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.title}async fetchData(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._data||(this._data=await this.portalItem.fetchData("json",Object.assign(Object.assign({},e),m(this.portalItem)))),this._data}}class E extends k{constructor(){super(...arguments),this.type="symbol-set"}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.map((e=>new C({data:e,parentData:t,portalItem:this.portalItem,strategy:I,strings:this.strings})))}return this._items}}class T extends k{constructor(){super(...arguments),this.type="web-style"}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.items.map((e=>new C({data:e,parentData:t,portalItem:this.portalItem,strategy:f(this.symbolType),strings:this.strings})))}return this._items}}class O{constructor({strings:e}){this.keywords=[],this.name="Basic",this.type="symbol-set",this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.map((e=>new C({data:e,strategy:I,strings:this.strings})))),this._items}}const U="basic-symbol-set:point",A="basic-symbol-set:line",x="basic-symbol-set:polygon";class D extends O{constructor(){super(...arguments),this.data=d,this.id=U,this.keywords=["Point"]}}class M extends O{constructor(){super(...arguments),this.data=u,this.id=A,this.keywords=["Line"]}}class N extends O{constructor(){super(...arguments),this.data=y,this.id=x,this.keywords=["Polygon"]}}class F{constructor({strings:e}){this.keywords=["3d"],this.id="basic-web-style:flat",this.name="Basic",this.type="web-style",this.data={items:h(e)},this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new C({data:e,strategy:I,strings:this.strings})))),this._items}}class P{constructor({strings:e}){this.id="basic-web-style:volumetric",this.keywords=["3d","volumetric"],this.name="Basic",this.type="web-style",this.data={items:p(e)},this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new C({data:e,parentData:this.data,strategy:_,strings:this.strings})))),this._items}}const L="marker-item",R="calcite-mode-dark",j=({item:e,index:t,observer:i})=>{const o=e.data.title?(0,s.h)("calcite-tooltip",{"reference-element":e.data.name},e.data.title):null;return(0,s.h)("span",{class:`${L} ${R}`,ref:s=>{if(!s)return;s.item||(s.item=e,s.index=t,i.observe(s))},id:e.data.name,slot:"thumbnail"},o)};function G(e,t){return function(e){return B({portal:e,queries:{group:e.symbolSetsGroupQuery,item:'type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")'}}).then(H)}(e).then((e=>e.map((e=>new E({portalItem:e,strings:t})))))}function V(e,t,i){return async function(e,t){const i="2d"===t?e.stylesGroupQuery2d:e.stylesGroupQuery3d;if(!i)return[];return B({portal:e,queries:{group:i,item:'type:"Style"'}}).then(H)}(e,t).then((e=>e.map((e=>new T({portalItem:e,symbolType:t,strings:i})))))}function q(e,t,i,s){return(null==s?void 0:s.length)?async function(e,t){let i="",s="";return t.forEach((e=>{i+=`${s}id:${e}`,s=" OR "})),B({portal:e,queries:{item:i}})}(e,s).then((e=>e.map((e=>new T({portalItem:e,symbolType:t,strings:i}))))):new Promise((e=>{e([])}))}function J(e,t){return"flat"===e?new F({strings:t}):new P({strings:t})}function $(e,t){const i={strings:e};return"line"===t?new M(i):"polygon"===t?new N(i):new D(i)}async function B(e){const t=e.portal,i=e.queries.group,s=e.queries.item;if(i){const{results:e}=await t.queryGroups({query:i,disableExtraQuery:!0});if(0===e.length)return[];const[o]=e;return(await o.queryItems({query:s,disableExtraQuery:!0,num:100,sortField:o.sortField})).results}return(await t.queryItems({query:s,disableExtraQuery:!0,num:100})).results}function H(e){const t=[];return e.forEach((e=>{var i;i="default",e.typeKeywords.indexOf(i)>-1?t.unshift(e):t.push(e)})),t}const z={point:"pointSymbol",line:"lineSymbol",polygon:"polygonSymbol"},Q=e=>!!e.portal;async function W(e,t){return Promise.all(e.map(t)).then((t=>e.filter(((e,i)=>t[i]))))}async function Y(e,t,i,s,o,l){const n=oe(i),a="2d"===o?function(e,t){function i(i){if(t.includes("all"))return!0;const{data:s}=i,{dimensionality:o,type:r}=s;if("volumetric"===o)return!1;if("point"===e){if(t.includes("picture")&&"esriPMS"===r)return!0;if(t.includes("simple")&&"esriSMS"===r)return!0}if("line"===e&&t.includes("simple")&&"esriSLS"===r)return!0;if("polygon"===e&&t.includes("simple")&&"esriSFS"===r)return!0;const{formats:l}=s;return!(!se(t)||!se(l))}return async function(s,o){const l="point"===e?r.j:"line"===e?r.h:r.f;if(!i(s))return!1;const n=t.includes("cim:picture"),a=t.includes("cim:vector"),c=n&&a||!n&&!a,m=X(o)&&!ee(o)&&!te(o),d=ee(o)&&!X(o)&&!te(o),u=te(o)&&!X(o)&&!ee(o),y="line"===e?z.line:"polygon"===e?z.polygon:z.point;if((m||d||u)&&c||"web-style"!==o.type||s.data.itemType===y)return!0;const h=await s.getSymbol();return!(0,r.i)(h)||l(h)}}(s,n):(c=n,async function(e){if(c.includes("all")||c.includes("3d"))return!0;const{data:{dimensionality:t}}=e;return c.includes("3d:flat")&&"flat"===t||c.includes("3d:volumetric")&&"volumetric"===t});var c;return W(t,(async t=>l?l(t,e,a):a(t,e)))}const K={point:"Point",line:"Line",polygon:"Polygon"};function X({keywords:e}){return e.includes(K.point)||e.includes("pointSymbol")}function Z({keywords:e}){return e.includes("marker")}function ee({keywords:e}){return e.includes(K.line)||e.includes("lineSymbol")}function te({keywords:e}){return e.includes(K.polygon)||e.includes("polygonSymbol")}async function ie(e,t,i,s,o){const r=oe(t),l="2d"===s?function(e,t){return async i=>{const s=i.keywords.includes("3d"),o=i.keywords.includes("Dictionary"),r="point"===e?X(i)||Z(i):"line"===e?ee(i):te(i),l=X(i)||Z(i)||ee(i)||te(i);if(s||o||!r&&l)return!1;if(t.includes("all"))return!0;function n(){return"point"===e?U:"line"===e?A:x}const a=n();return!(!t.includes("picture")||i.id==a||"symbol-set"!==i.type)||(!(!t.includes("simple")||i.id!==a)||!(!se(t)||"web-style"!==i.type))}}(i,r):function(e){const t={EsriThematicShapesStyle:!0};return async i=>{if(i.keywords.every((e=>!t[e]))&&"web-style"===i.type&&(e.includes("all")||e.includes("3d")))return!0;if(function(e){return"portalItem"in e}(i)){const t=await i.fetchData(),[s]=t.items,{dimensionality:o}=s;return e.includes("3d:flat")&&"flat"===o||e.includes("3d:volumetric")&&"volumetric"===o}return e.includes("3d:flat")&&"basic-web-style:flat"==i.id||e.includes("3d:volumetric")&&"basic-web-style:volumetric"==i.id}}(r);return W(e,(async e=>o?o(e,l):l(e)))}function se(e){return Array.isArray(e)&&e.some((e=>e.includes("cim")))}function oe(e="all"){const t=Array.isArray(e)?e:[e],i=t.find((e=>"cim"===e&&t.find((e=>e.includes("cim:")))));return i?t.filter((e=>!e.includes("cim:"))):t}async function re(e,t,i,s,o,r){const l={};t&&await t(e,l),await e.load();const n=await("2d"===o?async function(e,t,i){const s=e.symbolSetsGroupQuery;e.symbolSetsGroupQuery='owner:esri AND title:"Map Viewer Beta Symbols"';const[o,r,l]=await Promise.all([G(e,t),V(e,"2d",t),q(e,"2d",t,i)]),n=e=>e.keywords.every((e=>"Basic"!==e)),a=[$(t,"point"),$(t,"line"),$(t,"polygon"),...o.filter(n),...r.filter(n),...l.filter(n)];return e.symbolSetsGroupQuery=s,a}(e,s,r):async function(e,t){const[i]=await Promise.all([V(e,"3d",t)]),s=e=>e.keywords.every((e=>"Basic"!==e)),o=[J("flat",t),J("volumetric",t),...i.filter(s)];return o}(e,s));return i&&await i(e,l),n}const le="arcgis-symbol-styler-storage-styles",ne="arcgis-symbol-picker__container",ae="incompatible-symbols-notice",ce="empty-category-content",me="marker-source-select",de="marker-selection",ue="scroller",ye="item-palette",he="file-upload",pe="categories",be="categories-center-action",ge="symbol-div",Se="empty-filter",ve=class{constructor(e){(0,s.r)(this,e),this.arcgisActiveSymbolChange=(0,s.c)(this,"arcgisActiveSymbolChange",7),this.arcgisActiveSymbolItemChange=(0,s.c)(this,"arcgisActiveSymbolItemChange",7),this.arcgisActiveSourceIdChange=(0,s.c)(this,"arcgisActiveSourceIdChange",7),this.arcgisSymbolSourcesChange=(0,s.c)(this,"arcgisSymbolSourcesChange",7),this.arcgisActiveSourceItemsChange=(0,s.c)(this,"arcgisActiveSourceItemsChange",7),this.allCustomFileInfos=[],this.customSymbolsStorageId="arcgis-symbol-picker-custom-symbols",this.actionEls=[],this._onSymbolSourceChange=e=>{const t=e.currentTarget,{selectedItems:i}=t,s=i.find((e=>e.getAttribute("data-value")!==this._activeSourceId));this._activeSourceId=(null==s?void 0:s.getAttribute("data-value"))||this._activeSourceId,t.querySelectorAll("calcite-dropdown-item").forEach((e=>{e!==s&&(e.selected=!1)})),e.stopPropagation(),this.displayEmptyFilterMsg=!1},this.symbol=void 0,this.portal=void 0,this.symbolFilter=void 0,this.activeSourceId=void 0,this.activeSymbolItem=void 0,this.hideHeader=!1,this.symbolType="2d",this.customSymbolItemFilter=void 0,this.customSymbolSourceFilter=void 0,this.itemsPerRow=4,this.symbolSources=void 0,this.activeSymbolItems=void 0,this.messages=void 0,this._activeSourceId=void 0,this._symbolSources=void 0,this._activeSymbolItems=void 0,this.customSymbolError=void 0,this.isGridView=!0,this.displayEmptyFilterMsg=!1,this._activeSymbolFetch=void 0}handleActiveSourceItemIdChanges(){this._activeSourceId&&("custom-symbol-set"===this._activeSourceId?this._setupCustomSymbols():this._fetchAndSetUpSymbolItems(this._symbolSources.find((({id:e})=>e===this._activeSourceId))))}get editGeometry(){return(0,r.g)(this.symbol)}handleFileUploadChange({detail:e}){const t=e,i=t.cim&&JSON.stringify(t.cim.toJSON());if(t.dataURL&&t.dataURL.length>2e5)return void(this.customSymbolError="too-large");if(t.cim&&i.length>2e5)return void(this.customSymbolError="too-large");this.customSymbolError=void 0;const s=this.allCustomFileInfos.find((e=>t.dataURL&&e.dataURL&&e.dataURL===t.dataURL&&e.fileName===t.fileName||t.cim&&e.cim&&e.fileName===t.fileName&&i===JSON.stringify(e.cim.toJSON())));try{let e;if(s)e=this._activeSymbolItems.find((e=>e.data.name===s.fileName));else{const i=[...this.allCustomFileInfos,t];(0,n.s)(this.customSymbolsStorageId,i.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:JSON.stringify(e.cim.toJSON())}))),!0),this.allCustomFileInfos=i,this._setupCustomSymbols(),e=this._activeSymbolItems[this._activeSymbolItems.length-1]}this.activeSymbolItem=e,this.arcgisActiveSymbolItemChange.emit(this.activeSymbolItem),this.activeSymbolItem.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),setTimeout((()=>requestAnimationFrame((()=>{var e;null===(e=this.itemPaletteNode)||void 0===e||e.setFocus(),this.updateListSelection()}))),1)}catch(e){this.customSymbolError="storage-full"}}handleInvalidFile(){this.customSymbolError="invalid-file"}handleFileUploadError(){this.customSymbolError="error"}async getStyleItemIds(){var e;return null===(e=this._symbolSources)||void 0===e?void 0:e.filter((e=>"web-style"===e.type)).map((e=>e.id))}_renderSymbolSourceOptions(e,t){var i;const{messages:o,savedStyleIds:r}=this,l=e.filter((e=>"symbol-set"===e.type&&!(null==r?void 0:r.includes(e.id)))),n=e.filter((e=>"web-style"===e.type&&!(null==r?void 0:r.includes(e.id)))),a=e.filter((e=>r.includes(e.id)));a.sort(((e,t)=>e.title.localeCompare(t.title)));const c=!this.symbolFilter||!!(Array.isArray(this.symbolFilter)?this.symbolFilter:[this.symbolFilter]).find((e=>"custom"===e||"picture"===e))||r.length,m="3d"!==this.symbolType&&("point"===this.editGeometry&&c||(null===(i=this.savedStyleIds)||void 0===i?void 0:i.length))&&(0,s.h)("calcite-dropdown-group",{groupTitle:o.addedStyles,selectionMode:"multiple",key:"custom"},this._renderSourceDropdownItem(a,t),"point"===this.editGeometry&&c&&(0,s.h)("calcite-dropdown-item",{key:"custom","data-value":"custom-symbol-set",selected:"custom-symbol-set"===t},o.customSymbols)),d=l.length>0&&(0,s.h)("calcite-dropdown-group",{groupTitle:o.classicSymbols,selectionMode:"multiple",key:"classic"},this._renderSourceDropdownItem(l,t)),u=n.length>0&&(0,s.h)("calcite-dropdown-group",{groupTitle:o.newSymbols,selectionMode:"multiple",key:"webstyles"},this._renderSourceDropdownItem(n,t));return m?d?u?[d,u,m]:[d,m]:[u,m]:d&&u?[d,u]:(0,s.h)("calcite-dropdown-group",{key:"one-group"},this._renderSourceDropdownItem([...l,...n],t))}_renderSourceDropdownItem(e,t){return e.map((e=>(0,s.h)("calcite-dropdown-item",{key:e.id,"data-value":e.id,selected:e.id===t},e.title)))}_setupCustomSymbols(){const e=this.allCustomFileInfos.map((e=>{let t=24,i=24;if(e.width>e.height?i=Math.round(t/e.width*e.height):e.width<e.height&&(t=Math.round(i/e.height*e.width)),e.dataURL){const s=e.fileName.split(".")[1].toLowerCase();return new C({data:{angle:0,contentType:"png"===s?"image/png":"gif"===s?"image/gif":"image/jpeg",height:i,imageData:e.dataURL.split(",")[1],name:e.fileName,type:"esriPMS",url:void 0,width:t,xoffset:0,yoffset:0},parentData:null,portalItem:null,strategy:I,strings:this.messages})}return new C({data:{symbol:e.cim,name:e.fileName},parentData:{cimVersion:"2.6.0"},portalItem:null,strategy:{getSymbol:async e=>e.data.symbol,getThumbnail:async e=>S(document.createElement("div"),e.data.symbol,{size:24,disableUpsampling:!1},e.data.title)},strings:this.messages})}));this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=e,this.arcgisActiveSourceIdChange.emit("custom-symbol-set"),this.arcgisActiveSourceItemsChange.emit(e.map((e=>new C(Object.assign({},e)))))}async _fetchAndSetUpSymbolItems(e){this._activeSymbolFetch&&this._activeSymbolFetch.controller.abort();const t=new AbortController,i=t.signal;this._activeSymbolFetch={controller:t,id:e.id};const s=!this._activeSymbolItems&&this.activeSymbolItems||await e.getItems(t);if(null==i?void 0:i.aborted)return;const o=await Y(e,s,this.symbolFilter,this.editGeometry,this.symbolType,this.customSymbolItemFilter);(null==i?void 0:i.aborted)||(this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=o,this.arcgisActiveSourceIdChange.emit(this._activeSourceId),this.arcgisActiveSourceItemsChange.emit(o.map((e=>new C(Object.assign({},e))))))}onIncompatibleVectorSymbolsDismiss(e){(0,l.s)(l.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED,value:"true"}),e.stopPropagation()}tearDownSymbolIntersectionObserver(){var e;null===(e=this._symbolIntersectionObserver)||void 0===e||e.disconnect(),this._symbolIntersectionObserver=null}setUpSymbolIntersectionObserver(){this.tearDownSymbolIntersectionObserver();let e=0;const t={};this._symbolIntersectionObserver=new IntersectionObserver(((i,s)=>{function o(){e++,t[e]&&(t[e](),delete t[e],o())}i.forEach((i=>{if(!i.isIntersecting)return;const r=i.target;r.item.getThumbnail(r).then((i=>{r.index===e?(i(),o()):t[r.index]=i})),r.item.getSymbol(),s.unobserve(r)}))}))}async _fetchSources(){this._sourcesFetchController&&this._sourcesFetchController.abort(),this._sourcesFetchController=new AbortController;const e=this._sourcesFetchController.signal,t=this.portal,i=Q(t)?t.portal:t,s=Q(t)?t.before:null,o=Q(t)?t.after:null,l=i?this.symbolSources||await re(i,s,o,this.messages,this.symbolType,this.savedStyleIds):[];if(null==e?void 0:e.aborted)return;this._symbolSources=await ie(l,this.symbolFilter,(0,r.g)(this.symbol),this.symbolType,this.customSymbolSourceFilter);const n=this._symbolSources.filter((e=>this.savedStyleIds.includes(e.id)));if(n.length!==this.savedStyleIds.length){const e=n.map((e=>e.id)),t=this.savedStyleIds.filter((t=>!e.includes(t)));this.savedStyleIds=e,this.removeStyleIds(t)}if(this.arcgisSymbolSourcesChange.emit(this._symbolSources),!this._activeSourceId){let e=this.activeSourceId;if(e){this._symbolSources.find((e=>e.id===this.activeSourceId))||(e=void 0)}this._activeSourceId=e||this._symbolSources[0].id}}_getCustomSymbolsFromStorage(){if("3d"===this.symbolType||"point"!==this.editGeometry)return;const e=(0,n.g)(this.customSymbolsStorageId,!0);e&&(this.allCustomFileInfos=e.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:r.e.CIMSymbol.fromJSON(JSON.parse(e.cim))}))))}_renderSourceSelection(){const{messages:e}=this,t=this._symbolSources;if(!t)return;const i=this._symbolSources.find((e=>e.id===this._activeSourceId)),o="custom-symbol-set"===this._activeSourceId?e.customSymbols:null==i?void 0:i.title,r=1===t.length,l=(0,s.h)("calcite-dropdown",{class:{[me]:!0},hidden:r,maxItems:7,onCalciteDropdownSelect:this._onSymbolSourceChange,overlayPositioning:"absolute"},(0,s.h)("calcite-button",{alignment:"space-between",appearance:"outline-fill",kind:"neutral",iconEnd:"chevron-down",scale:"m",slot:"trigger",width:"full"},o),this._renderSymbolSourceOptions(t,this._activeSourceId));return(0,s.h)("div",{class:"section",key:"header"},(0,s.h)("calcite-label",{class:"section"},this.hideHeader?null:this.messages.category,(0,s.h)("div",{class:pe},l,(0,s.h)("calcite-action",{id:"symbol-picker-grid",active:this.isGridView,appearance:"transparent",icon:"grid",scale:"s",class:be,text:this.messages.gridView,onClick:()=>{this.isGridView=!0,(0,s.f)(this.el)}}),(0,s.h)("calcite-tooltip",{"reference-element":"symbol-picker-grid"},this.messages.gridView),(0,s.h)("calcite-action",{id:"symbol-picker-list",active:!this.isGridView,appearance:"transparent",icon:"list",iconFlipRtl:!0,scale:"s",text:this.messages.listView,onClick:()=>{this.isGridView=!1,(0,s.f)(this.el)}}),(0,s.h)("calcite-tooltip",{"reference-element":"symbol-picker-list"},this.messages.listView))))}_renderItemSelection(){const{portal:e,messages:t}=this,i=this._activeSymbolFetch,o=Q(e)?e.portal:e,r=(0,s.h)("div",{class:"remove-button"},(0,s.h)("calcite-button",{appearance:"transparent",kind:"danger",width:"full",onClick:()=>this.removeStyle()},t.removeStyle));return(0,s.h)("div",{class:{[ue]:!0,[de]:this.isGridView},key:"gallery"},i?(0,s.h)("calcite-loader",{label:""}):0===this._activeSymbolItems.length&&"custom-symbol-set"===this._activeSourceId?(0,s.h)("arcgis-symbol-picker-file-upload",{portal:o,strings:t}):this._activeSymbolItems.length>0?(0,s.h)("div",{class:ye,key:this._activeSymbolItems.length},this.isGridView?this._renderGridView():this._renderListView(),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("arcgis-symbol-picker-file-upload",{class:he,portal:o,strings:t}),this.displayEmptyFilterMsg&&(0,s.h)("div",{class:Se},this.messages.noFilterSymbolsAvailable),this.savedStyleIds.includes(this._activeSourceId)&&r):(0,s.h)("div",null,(0,s.h)("div",{class:ce},this.messages.noSymbolsAvailable),this.savedStyleIds.includes(this._activeSourceId)&&r))}_renderGridView(){return(0,s.h)("arcgis-item-palette",{key:this._activeSourceId,items:this._activeSymbolItems.map(((e,t)=>({item:e,index:t,observer:this._symbolIntersectionObserver}))),ItemRenderer:j,itemsPerRow:this.itemsPerRow,selected:({item:e})=>{var t;return(null==e?void 0:e.data)===(null===(t=this.activeSymbolItem)||void 0===t?void 0:t.data)},onArcgisItemSelect:e=>{const{detail:{item:t}}=e;this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(t),this.activeSymbolItem=t,t.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),e.stopPropagation()},ref:e=>this.itemPaletteNode=e})}_renderListView(){const{messages:e}=this,t="rtl"===(0,c.g)(this.el);return(0,s.h)("calcite-list",{key:this._activeSourceId,filterEnabled:this._activeSymbolItems.length>10,filterPlaceholder:e.filterPlaceholder,onCalciteListFilter:e=>{const t=e.target;this.displayEmptyFilterMsg=t.filterText&&0===t.filteredItems.length}},this._activeSymbolItems.map(((e,i)=>{var o,r;return(0,s.h)("calcite-list-item",{key:i,label:e.data.title||e.data.name,value:i,selected:(null===(o=this.activeSymbolItem)||void 0===o?void 0:o.data.name)===e.data.name,metadata:null===(r=e.data.tags)||void 0===r?void 0:r.toString(),onCalciteListItemSelect:e=>{const t=e.target,i=this._activeSymbolItems[t.value];this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(i),this.activeSymbolItem=i,i.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),e.stopPropagation()}},(0,s.h)("div",{slot:"actions-start",class:ge,key:e.data.name,ref:t=>{t&&(e.getThumbnail(t).then((e=>e())),e.getSymbol())}}),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.messages.removeSymbol,ref:e=>{e&&(this.actionEls[i]=e)},onClick:()=>{this.removeCustomSymbol(i),(0,s.f)(this.el)},onMouseOver:()=>this.addTooltip({referenceElement:this.actionEls[i],placement:t?"right-start":"left-start",innerHTML:this.messages.removeSymbol}),onMouseOut:()=>this.removeTooltip()},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))})))}updateListSelection(){this.el.querySelectorAll("CALCITE-LIST-ITEM").forEach((e=>{e.selected=e.value===this.activeSymbolItem.data.name,e.selected&&e.setFocus()}))}removeCustomSymbol(e){this.allCustomFileInfos.splice(e,1),(0,n.s)(this.customSymbolsStorageId,this.allCustomFileInfos.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:JSON.stringify(e.cim.toJSON())}))),!0),this._setupCustomSymbols(),this.activeSymbolItem=void 0}addTooltip(e){this.removeTooltip(),this.tooltipEl=document.createElement("calcite-tooltip"),this.tooltipEl.placement=e.placement||"auto",this.tooltipEl.referenceElement=e.referenceElement,this.tooltipEl.overlayPositioning="fixed",this.tooltipEl.innerHTML=e.innerHTML,this.tooltipEl.open=!0,this.el.parentElement.appendChild(this.tooltipEl)}removeTooltip(){var e;(null===(e=this.tooltipEl)||void 0===e?void 0:e.parentNode)&&(this.tooltipEl.parentNode.removeChild(this.tooltipEl),this.tooltipEl=void 0)}removeStyle(){var e;this.savedStyleIds=this.savedStyleIds.filter((e=>e!==this._activeSourceId)),this.removeStyleIds([this._activeSourceId]),this._activeSourceId=(null===(e=this.savedStyleIds)||void 0===e?void 0:e[0])||this._symbolSources[0].id}removeStyleIds(e){let t=(0,n.g)(le,!0)||{},i=t.point||[];i=i.filter((t=>!e.includes(t))),t.point=i.length?i:void 0;let s=t.line||[];s=s.filter((t=>!e.includes(t))),t.line=s.length?s:void 0;let o=t.polygon||[];o=o.filter((t=>!e.includes(t))),t.polygon=o.length?o:void 0,JSON.stringify(t)===JSON.stringify({})?(0,n.r)(le):(0,n.s)(le,t,!0),this._fetchSources()}async componentWillLoad(){const[,[e]]=await Promise.all([r.e.load(),(0,a.g)(this.el)]);this.messages=e;const t=(0,r.g)(this.symbol),i=(0,n.g)(le,!0)||{};this.savedStyleIds=(null==i?void 0:i[t])||[]}componentDidLoad(){this._symbolSources||this._fetchSources(),this._getCustomSymbolsFromStorage()}connectedCallback(){var e,t;this.setUpSymbolIntersectionObserver(),null===(e=this._activeSymbolFetch)||void 0===e||e.controller.abort(),null===(t=this._sourcesFetchController)||void 0===t||t.abort()}disconnectedCallback(){this.tearDownSymbolIntersectionObserver()}render(){const e=this._symbolSources,t=this._activeSymbolFetch;if(!e||t)return(0,s.h)("div",{class:ne},(0,s.h)("calcite-loader",{label:""}));const i="basic-symbol-set"===this._activeSourceId||"custom-symbol-set"===this._activeSourceId,o=this._symbolSources.find((e=>e.id===this._activeSourceId)),r=!i&&"symbol-set"!==(null==o?void 0:o.type),n=null==o?void 0:o.keywords.includes("Adobe");return(0,s.h)("div",{class:ne},this._renderSourceSelection(),this._renderItemSelection(),n?(0,s.h)("calcite-notice",{open:!0,kind:"danger",key:"copyright",scale:"s"},(0,s.h)("div",{slot:"message",innerHTML:this.messages.adobeCopyright.replace("${year}","2024")})):null,r&&"3d"!==this.symbolType&&!(0,l.g)(l.l.ARCGIS_COMPONENT_NOTIFICATIONS,l.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED)?(0,s.h)("calcite-notice",{open:!0,class:ae,closable:!0,icon:!0,key:"incompatible-symbols",onCalciteNoticeClose:this.onIncompatibleVectorSymbolsDismiss,scale:"s"},(0,s.h)("div",{slot:"message"},this.messages.incompatibleSymbolWarning)):null,this.customSymbolError?(0,s.h)("calcite-notice",{open:!0,class:ae,closable:!0,icon:"exclamation-mark-circle",kind:"danger",key:"large-symbol",onCalciteNoticeClose:()=>this.customSymbolError=void 0,scale:"s"},(0,s.h)("div",{slot:"message"},"too-large"===this.customSymbolError?this.messages.customSymbolErrors.tooLarge:"invalid-file"===this.customSymbolError?this.messages.customSymbolErrors.invalidFile:"storage-full"===this.customSymbolError?this.messages.customSymbolErrors.outOfSpace:"error"===this.customSymbolError?this.messages.customSymbolErrors.error:void 0)):null)}get el(){return(0,s.d)(this)}static get watchers(){return{_activeSourceId:["handleActiveSourceItemIdChanges"]}}};ve.style=".scroller.sc-arcgis-symbol-picker{max-height:var(--scroller-max-height, min(100vh - 380px, 320px));overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}.sc-arcgis-symbol-picker-h,.arcgis-symbol-picker__container.sc-arcgis-symbol-picker{display:flex;flex:1 1 auto;flex-flow:column nowrap;align-items:stretch}.categories.sc-arcgis-symbol-picker{display:flex;align-content:normal}.categories-center-action.sc-arcgis-symbol-picker{padding:0 5px}.marker-selection.sc-arcgis-symbol-picker{padding:8px}.symbol-div.sc-arcgis-symbol-picker{padding:0 8px}.marker-source-select.sc-arcgis-symbol-picker{width:calc(100% - 74px);display:block}.marker-source-select[hidden].sc-arcgis-symbol-picker+.marker-selection.sc-arcgis-symbol-picker{border-top:1px solid lightgray;background-color:var(--arcgis-app-background)}.marker-selection--dark.sc-arcgis-symbol-picker{background-color:var(--arcgis-app-foreground);color:var(--arcgis-app-background)}.empty-category-content.sc-arcgis-symbol-picker{display:flex;align-items:center;justify-content:center;padding:var(--arcgis-app-spacing-half) var(--arcgis-app-spacing-quarter)}.empty-filter.sc-arcgis-symbol-picker{display:flex;align-items:center;justify-content:center;padding:8px}.incompatible-symbols-notice.sc-arcgis-symbol-picker{margin:8px 0}.marker-item.sc-arcgis-symbol-picker{height:40px;width:38.5px;display:flex;justify-content:center;align-items:center;background-color:var(--arcgis-app-background)}.marker-item.sc-arcgis-symbol-picker [slot=thumbnail].sc-arcgis-symbol-picker>div.sc-arcgis-symbol-picker{margin:8px 10px;display:flex;justify-content:center;align-items:center}.item-palette.sc-arcgis-symbol-picker{width:100%;display:flex;flex-direction:column}.file-upload.sc-arcgis-symbol-picker{margin-top:20px;width:auto}.remove-button.sc-arcgis-symbol-picker{padding:10px 0}"},82748:(e,t,i)=>{i.d(t,{c:()=>r,i:()=>l});var s=i(94278);const o=[0,0,0,0];function r(e,t=!1){const i=null!=e?e:o;return t?s.e.Color.fromJSON(i):new s.e.Color(i)}function l({r:e,g:t,b:i,a:s}){return 0===e&&0===t&&0===i&&0===s}},11246:(e,t,i)=>{i.d(t,{a:()=>c,b:()=>u,c:()=>o,d:()=>s,e:()=>r,f:()=>m,g:()=>y,i:()=>l,m:()=>n,t:()=>a,u:()=>d});const s=(e,t)=>{let i,s="idle";const o=(...o)=>new Promise((r=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),r(e(...o))):r(null);break;case"invoked":clearTimeout(i),s="idle",r(e(...o));break;case"cancelled":clearTimeout(i),s="idle",r(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",r(e(...o)))),t)}}));return o.flush=function(...e){return s="flushed",o(...e)},o.invoke=function(...e){return s="invoked",o(...e)},o.cancel=function(...e){return s="cancelled",o(...e)},o.getStatus=function(){return s},o},o=(e,t)=>{let i;return(...s)=>new Promise((o=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,o(e(...s))}),t))}))};function r(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l(e){return null!=e}async function n(e,t){return await Promise.all([e,a(t)]),e}function a(e){return new Promise((t=>setTimeout(t,e)))}const c=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),m=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function d(e,t){const i=[],s={};return e.forEach((e=>{const o=t(e);null==s[o]&&(s[o]=e,i.push(e))})),i}function u(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const y=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s)))},79241:(e,t,i)=>{var s,o;i.d(t,{a:()=>o,g:()=>n,l:()=>s,s:()=>l}),function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(s||(s={})),function(e){e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed"}(o||(o={}));const r=e=>JSON.parse((e=>localStorage.getItem(e))(e))||{},l=(e,t)=>{const i=r(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},n=(e,t)=>{const i=r(e);return(null==i?void 0:i.hasOwnProperty(t))?i[t]:null}},81457:(e,t,i)=>{i.d(t,{a:()=>m,b:()=>c,c:()=>d,d:()=>r,e:()=>o,g:()=>n,r:()=>a,s:()=>l});var s=i(11246);function o(e,t,i,s){!function(e,t,i){i=i||{};let s=null==i?void 0:i.expires;if("number"==typeof s){const e=new Date,t=24*s*60*60*1e3;e.setTime(Date.now()+t),s=i.expires=e}"string"!=typeof s&&(null==s?void 0:s.toUTCString)&&(i.expires=s.toUTCString());let o,r=`${e}=${encodeURIComponent(t)}`;for(o in i){r+=`; ${o}`;const e=i[o];!0!==e&&(r+=`=${e}`)}document.cookie=r}(e,s?JSON.stringify(t):t,i)}function r(e,t){const i=function(e){const t=document.cookie,i=new RegExp(`(?:^|; )${(0,s.e)(e)}=([^;]*)`),o=t.match(i);return o?decodeURIComponent(o[1]):void 0}(e);return i&&t?JSON.parse(i):i}function l(e,t,i){window.localStorage.setItem(e,i?JSON.stringify(t):t)}function n(e,t){const i=window.localStorage.getItem(e);return i&&t?JSON.parse(i):i}function a(e){window.localStorage.removeItem(e)}function c(e,t,i){window.sessionStorage.setItem(e,i?JSON.stringify(t):t)}function m(e,t){const i=window.sessionStorage.getItem(e);return i&&t?JSON.parse(i):i}function d(e){window.sessionStorage.removeItem(e)}},94278:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>m,c:()=>c,d:()=>a,e:()=>r,f:()=>y,g:()=>o,h:()=>u,i:()=>l,j:()=>d});var s=i(28926);function o(e){return"cim"===e.type?"CIMLineSymbol"===e.data.symbol.type?"line":"CIMPolygonSymbol"===e.data.symbol.type?"polygon":"point":"simple-marker"===e.type||"picture-marker"===e.type?"point":"simple-line"===e.type?"line":"polygon"}const r={loaded:!1,async load(){if(this.loaded)return;const[e,t,i,o,r,l,n,a,c,m,d,u,y,h,p,b,g]=await(0,s.l)(["esri/core/screenUtils","esri/Color","esri/portal/Portal","esri/symbols/CIMSymbol","esri/symbols/WebStyleSymbol","esri/core/devEnvironmentUtils","esri/core/promiseUtils","esri/core/urlUtils","esri/portal/PortalItem","esri/symbols/support/previewSymbol2D","esri/symbols/support/gfxUtils","esri/symbols/support/jsonUtils","esri/symbols/support/styleUtils","esri/symbols/support/svgUtils","esri/symbols/support/symbolUtils","esri/symbols/support/cimSymbolUtils","esri/symbols/support/webStyleSymbolUtils"]);this.Color=t,this.Portal=i,this.CIMSymbol=o,this.WebStyleSymbol=r,this.devEnvironmentUtils=l,this.previewSymbol2D=m,this.promiseUtils=n,this.urlUtils=a,this.PortalItem=c,this.gfxUtils=d,this.jsonUtils=u,this.screenUtils=e,this.styleUtils=y,this.svgUtils=h,this.symbolUtils=p,this.cimSymbolUtils=b,this.webStyleSymbolUtils=g,this.loaded=!0}};function l(e){return"cim"===(null==e?void 0:e.type)}function n(e){return"simple-marker"===(null==e?void 0:e.type)}function a(e){return"picture-marker"===(null==e?void 0:e.type)}function c(e){return"simple-line"===(null==e?void 0:e.type)}function m(e){return"simple-fill"===(null==e?void 0:e.type)}function d(e){return"CIMPointSymbol"===e.data.symbol.type}function u(e){return"CIMLineSymbol"===e.data.symbol.type}function y(e){return"CIMPolygonSymbol"===e.data.symbol.type}}}]);