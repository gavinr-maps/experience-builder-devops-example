/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-48195e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-48195e"],{36409:(e,t,i)=>{i.r(t),i.d(t,{arcgis_image_item_filters_popover:()=>o});var l=i(7263),s=i(62159),n=i(58233),r=i(28926),a=i(11246),d=i(55343);i(78613),i(70506),i(99004);const o=class{constructor(e){(0,l.r)(this,e),this.arcgisImageItemFiltersPopoverClosed=(0,l.c)(this,"arcgisImageItemFiltersPopoverClosed",7),this.arcgisImageItemFilterApplied=(0,l.c)(this,"arcgisImageItemFilterApplied",7),this.handleImageItemQueryApplied=()=>{const{view:e,activeQueryField:t,isOverviewsIncluded:i,isRangeValueModeSelected:l,selectedAOI:s,selectedQueryFieldValues:n}=this;let r=[];r=(0,d.s)(t.type)||"date"===t.type?l?n:[n[1]]:n;const a=(0,d.g)(e),o={selectedAOI:s,queryField:t,queryValues:r,isIncludeOverviews:i,displayExtent:s===d.A.DisplayExtent?a:null,isRangeModeEnabled:this.isRangeValueModeSelected,dropdownVals:this.fieldValuesForInput,sliderMinMaxVals:this.fieldMinMaxValuesForInput};this.arcgisImageItemFilterApplied.emit(o)},this.getLayerAttributeValues=async e=>{var t,i,l,s,n,r;const{layer:a,view:o,selectedAOI:c,fetchAbortController:u}=this;u&&u.abort();try{this.fetchAbortController=new AbortController,this.isQueryingFieldValues=!0,this.fieldValuesForInput=[],this.selectedQueryFieldValues=[];const u=(0,d.g)(o);if((0,d.m)(e)||!(0,d.s)(e.type)&&"date"!==e.type){const t=(await(0,d.u)(a,e,c===d.A.DisplayExtent?u:null,null===(s=this.fetchAbortController)||void 0===s?void 0:s.signal)).sort(((e,t)=>(0,d.n)(e,t,this.locale)));this.fieldValuesForInput=t,t.length>0&&(this.selectedQueryFieldValues=(null===(r=null===(n=this.currentFilterDetail)||void 0===n?void 0:n.queryValues)||void 0===r?void 0:r.length)>0&&t.includes(this.currentFilterDetail.queryValues[0])?[this.currentFilterDetail.queryValues[0]]:[t[0]])}else{const[s,n]=await(0,d.t)(a,e.name,c===d.A.DisplayExtent||c===d.A.Visible?u:null,null===(t=this.fetchAbortController)||void 0===t?void 0:t.signal);if(this.fieldMinMaxValuesForInput=[s,n],this.selectedQueryFieldValues=[s,n],2===(null===(l=null===(i=this.currentFilterDetail)||void 0===i?void 0:i.queryValues)||void 0===l?void 0:l.length)){const[e,t]=this.currentFilterDetail.queryValues;e>=s&&t<=n&&(this.selectedQueryFieldValues=[e,t])}}this.isQueryingFieldValues=!1}catch(e){this.isQueryingFieldValues=!!(0,d.o)(e)}},this.layer=void 0,this.open=void 0,this.view=void 0,this.currentFilterDetail=void 0,this.referenceElement=void 0,this.activeQueryField=void 0,this.selectedAOI=d.A.DisplayExtent,this.isOverviewsIncluded=!1,this.isQueryingImageItems=!1,this.isQueryingFieldValues=!1,this.selectedQueryFieldValues=[],this.fieldValuesForInput=[],this.fieldMinMaxValuesForInput=[],this.isRangeValueModeSelected=!0,this.isShowingIncludeOverviewTooltip=!1,this.isShowingRangeModeTooltip=!1}async componentWillLoad(){var e,t;[this.strings,this.locale]=await(0,s.g)(this.hostElement,"arcgis-image-collection-explorer"),this.currentMapExtent=this.view.extent;const i=(0,d.h)(null===(e=this.layer)||void 0===e?void 0:e.fields),l=(0,d.i)(i);this.activeQueryField=this.activeQueryField||l,this.activeQueryField&&!(null===(t=this.currentFilterDetail)||void 0===t?void 0:t.queryValues)&&this.getLayerAttributeValues(this.activeQueryField);const[n]=await(0,r.l)(["esri/core/reactiveUtils"]);this.watchExtentChangeHandler=n.watch((()=>[this.view.stationary,this.view.extent]),(([e])=>{(0,a.d)((()=>{!e||this.selectedAOI!==d.A.DisplayExtent&&this.selectedAOI!==d.A.Visible||(0,d.q)(this.currentMapExtent,this.view)||(this.getLayerAttributeValues(this.activeQueryField),this.currentMapExtent=this.view.extent)}),300)()}))}updateModal(e){if(e&&this.currentFilterDetail){const{selectedAOI:e,queryField:t,queryValues:i,isIncludeOverviews:l,isRangeModeEnabled:s,sliderMinMaxVals:n,dropdownVals:r}=this.currentFilterDetail;this.selectedAOI=e,this.activeQueryField=this.layer.fields.find((e=>e.name===(null==t?void 0:t.name)))||this.activeQueryField,this.isOverviewsIncluded=l,this.isRangeValueModeSelected="boolean"!=typeof s||s,Array.isArray(n)&&(this.fieldMinMaxValuesForInput=n),Array.isArray(r)&&(this.fieldValuesForInput=r),(null==i?void 0:i.length)>0&&(2===i.length&&(this.selectedQueryFieldValues=i),i.length<2&&((null==n?void 0:n.length)>0?this.selectedQueryFieldValues=[n[0],i[0]]:(null==r?void 0:r.length)>0?this.selectedQueryFieldValues=[r[0],i[0]]:this.selectedQueryFieldValues=[null,i[0]]))}}disconnectedCallback(){var e;null===(e=this.watchExtentChangeHandler)||void 0===e||e.remove()}render(){const{strings:e,open:t}=this;return(0,l.h)(l.H,{key:"fa83b71b9d15fa18631975317688b51570d11d77",class:"js-app-flyout"},(0,l.h)("calcite-popover",{key:"2e6ac38aed7638fda0774398054e3410424e8c0b",dir:(0,n.g)(this.hostElement),open:t,label:e.filters,referenceElement:this.referenceElement,closable:!0,heading:e.filters,placement:"leading-start",pointerDisabled:!0,triggerDisabled:!0,offsetDistance:10,onCalcitePopoverClose:()=>this.arcgisImageItemFiltersPopoverClosed.emit()},(0,l.h)("calcite-panel",{key:"265d207b5a3d5d813cd4b198be8c0f8dbaf13d89"},this.renderFilterInput())))}renderFilterInput(){return(0,l.h)("div",{class:"filter-wrapper"},this.renderAOISelectDropdown(),this.renderAttributeSelectDropdown(),this.renderAttributeInputField(),this.renderIncludeOverviewSwitchButton(),this.renderApplyButton())}renderAOISelectDropdown(){const{strings:e,selectedAOI:t}=this,i=[{name:d.A.DisplayExtent,label:e.displayExtent,description:e.displayExtentDesc},{name:d.A.Visible,label:e.visible,description:e.visibleDesc},{name:d.A.All,label:e.all,description:e.allDesc}],s=i.find((e=>e.name===t)),n=i.map((e=>(0,l.h)("calcite-dropdown-item",{"data-value":e.name,selected:e.name===s.name},(0,l.h)("strong",null,e.label),(0,l.h)("div",null,e.description))));return(0,l.h)("calcite-label",null,e.areaOfInterest,(0,l.h)("calcite-dropdown",{widthScale:"m",placement:"bottom",onCalciteDropdownSelect:e=>{var t,i;const l=e.currentTarget,s=null===(i=null===(t=null==l?void 0:l.selectedItems)||void 0===t?void 0:t[0])||void 0===i?void 0:i.getAttribute("data-value");this.selectedAOI=s,this.activeQueryField&&this.getLayerAttributeValues(this.activeQueryField)}},(0,l.h)("calcite-button",{class:"aoi-select-button",slot:"trigger",alignment:"space-between","icon-end":"chevron-down",appearance:"transparent",kind:"neutral",width:"full"},s.label),(0,l.h)("calcite-dropdown-group",null,n)))}renderAttributeSelectDropdown(){const{strings:e,activeQueryField:t,layer:i}=this,s=(0,d.h)(null==i?void 0:i.fields),n=s.map((e=>(0,l.h)("calcite-option",{value:e.name,label:e.alias,selected:e.name===t.name})));return(0,l.h)("calcite-label",null,e.attribute,(0,l.h)("calcite-select",{label:e.attribute,onCalciteSelectChange:e=>{const i=e.currentTarget.selectedOption.value;if(i!==t.name){const e=s.find((e=>e.name===i));this.selectedQueryFieldValues=[],this.activeQueryField=e,this.getLayerAttributeValues(this.activeQueryField)}}},n))}renderAttributeInputField(){const{strings:e,activeQueryField:t,isQueryingFieldValues:i}=this,s=t.type;return i?(0,l.h)("calcite-loader",{label:e.loading,scale:"s",inline:!0}):(0,d.m)(t)||!(0,d.s)(s)&&"date"!==s?this.renderAttributeDropdownInput():this.renderAttributeSliderInput()}renderSliderSelectedVals(){const{selectedQueryFieldValues:e,activeQueryField:t,isRangeValueModeSelected:i}=this;if(2!==(null==e?void 0:e.length))return null;let s,n;return[s,n]=e,"date"===t.type&&(s=(0,d.k)(s),n=(0,d.k)(n)),(0,l.h)("div",{class:"slider-value-container"},i&&(0,l.h)("calcite-input",{"read-only":!0,value:null==s?void 0:s.toString()}),(0,l.h)("calcite-input",{"read-only":!0,value:null==n?void 0:n.toString()}))}renderAttributeSliderInput(){var e;const{strings:t,fieldMinMaxValuesForInput:i,isRangeValueModeSelected:s,selectedQueryFieldValues:n,activeQueryField:r,isQueryingFieldValues:a}=this,o=i.filter((e=>"number"==typeof e)),c=2===o.length&&o[0]!==o[1];if(2===o.length&&o[0]===o[1]){const[i]=o;return(0,l.h)("calcite-select",{label:t.select,onCalciteSelectChange:e=>{const t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}},(0,l.h)("calcite-option",{value:i,label:"date"===r.type?(0,d.k)(i):i.toString(),selected:(null===(e=this.selectedQueryFieldValues)||void 0===e?void 0:e.length)>0&&i.toString()===this.selectedQueryFieldValues[0].toString()}))}if(c){const e=o[0],t=o[1];return(0,l.h)("div",null,this.renderRangeModeSwitchButton(),this.renderSliderSelectedVals(),s?(0,l.h)("calcite-slider",{key:"range-value-slider",minValue:n[0],maxValue:n[1],min:e,max:t,snap:!0,precise:!0,onCalciteSliderInput:e=>{const t=e.target;this.selectedQueryFieldValues=[t.value[0],t.value[1]]}}):(0,l.h)("calcite-slider",{key:"single-value-slider",value:n[1],min:e,max:t,snap:!0,precise:!0,onCalciteSliderInput:e=>{const t=e.target;this.selectedQueryFieldValues=[n[0],t.value]}}))}return!a&&this.renderEmptyAttributeValueErrorMessage()}renderAttributeDropdownInput(){const{strings:e,activeQueryField:t,fieldValuesForInput:i,isQueryingFieldValues:s}=this;if(i.length>0){const n=(0,d.m)(t),r=i.map((e=>{var i;if(!e)return;const s=n?t.domain.getName(e):e.toString();return(0,l.h)("calcite-option",{value:e,label:s,selected:(null===(i=this.selectedQueryFieldValues)||void 0===i?void 0:i.length)>0&&e.toString()===this.selectedQueryFieldValues[0].toString()})}));return(0,l.h)("calcite-select",{label:e.select,disabled:s,width:"full",onCalciteSelectChange:e=>{let t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}},r)}return!s&&this.renderEmptyAttributeValueErrorMessage()}renderEmptyAttributeValueErrorMessage(){const{strings:e}=this;return(0,l.h)("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},e.noFieldAttributesErrorMessage)}renderRangeModeSwitchButton(){const{strings:e,isRangeValueModeSelected:t,isShowingRangeModeTooltip:i}=this;return(0,l.h)("calcite-label",{layout:"inline"},e.rangeMode,(0,l.h)("calcite-action",{icon:"information",scale:"s",text:e.rangeMode,ref:e=>this.rangeModeHelpIconActionEl=e,onMouseOver:()=>{this.isShowingRangeModeTooltip=!0},onMouseOut:()=>{this.isShowingRangeModeTooltip=!1},onClick:e=>{e.stopPropagation()}}),(0,l.h)("calcite-tooltip",{open:i,referenceElement:this.rangeModeHelpIconActionEl},e.rangeModelHelpMessage),(0,l.h)("calcite-switch",{style:{marginInlineStart:"auto"},checked:t,onCalciteSwitchChange:e=>{const t=e.target.checked;this.isRangeValueModeSelected=t}}))}renderIncludeOverviewSwitchButton(){const{strings:e,isOverviewsIncluded:t,isShowingIncludeOverviewTooltip:i}=this;return(0,l.h)("calcite-label",{layout:"inline"},e.includeOverviews,(0,l.h)("calcite-action",{icon:"information",scale:"s",text:e.includeOverviewsHelpMessage,ref:e=>this.isIncludeOverviewsHelpIconActionEl=e,onMouseOver:()=>{this.isShowingIncludeOverviewTooltip=!0},onMouseOut:()=>{this.isShowingIncludeOverviewTooltip=!1},onClick:e=>{e.stopPropagation()}}),(0,l.h)("calcite-tooltip",{open:i,referenceElement:this.isIncludeOverviewsHelpIconActionEl},e.includeOverviewsHelpMessage),(0,l.h)("div",{style:{marginInlineStart:"auto"}},(0,l.h)("calcite-switch",{checked:t,scale:"m",onCalciteSwitchChange:e=>{const t=e.target.checked;this.isOverviewsIncluded=t}})))}renderApplyButton(){const{strings:e,isQueryingFieldValues:t,isQueryingImageItems:i}=this;return(0,l.h)("calcite-button",{label:e.apply,onClick:this.handleImageItemQueryApplied,appearance:"solid",width:"full",disabled:t||i},e.apply)}get hostElement(){return(0,l.d)(this)}static get watchers(){return{open:["updateModal"]}}};o.style=".aoi-select-button{border:1px solid var(--calcite-color-border-input)}.dropdown-container{display:flex;justify-content:space-between;gap:1rem}.slider-value-container{display:flex;gap:1rem}.filter-wrapper{padding:1rem;min-width:320px;background-color:var(--calcite-color-foreground-1)}"}}]);