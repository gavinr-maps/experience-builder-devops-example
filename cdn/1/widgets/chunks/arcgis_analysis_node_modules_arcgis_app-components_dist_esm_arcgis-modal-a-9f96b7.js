/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-modal-a-9f96b7.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-modal-a-9f96b7"],{75608:(e,t,i)=>{i.r(t),i.d(t,{arcgis_modal_arcade:()=>n});var s=i(7263),a=i(28926),r=i(62159);i(70506),i(99004),i(78613),i(58233);const n=class{constructor(e){(0,s.r)(this,e),this.arcgisModalArcadeClose=(0,s.c)(this,"arcgisModalArcadeClose",7),this.hideDocumentationActions=!1,this.arcadeScript=void 0,this.arcadeProfile=void 0,this.testData=void 0,this.suggestions=void 0,this.returnPredictOutputType=!0,this.arcadeTitle=void 0,this.arcadeTitleEditable=!1,this.arcadeTitleEditingEnabled=!1,this.addExistingExpressions=!1,this.layer=void 0,this.scriptInvalid=!0,this.hasChanges=!1}async componentWillLoad(){var e;if([this.strings,this.currentLanguage]=await(0,r.g)(this.hostElement),await this.loadAllModules(),this.addExistingExpressions&&this.layer){const t=this.getExistingExpressions();t&&((null===(e=this.suggestions)||void 0===e?void 0:e.length)?this.suggestions.push(t):this.suggestions=[t])}this.arcadeScript.length&&(this.scriptInvalid=!1)}async loadAllModules(){[this.arcade,this.arcadeUtils]=await(0,a.l)(["esri/arcade","esri/layers/support/arcadeUtils"])}async getOutputType(){try{const e=await this.arcadeEditor.getTestResult();switch(null==e?void 0:e.type){case"boolean":case"date":case"time":case"dateOnly":case"dictionary":case"number":return e.type;case"text":return"string";default:return null}}catch(e){return null}}getExistingExpressions(){if("subtype-sublayer"===this.layer.type)return{label:this.strings.existing,suggestions:[]};const e=this.arcadeUtils.getExpressionsFromLayer(this.layer).map((e=>{var t;return{label:(null==e?void 0:e.title)||(null==e?void 0:e.name)||this.strings.newExpression,description:this.getStringFromProfileName(null===(t=e.profileInfo)||void 0===t?void 0:t.name),code:e.expression}}));return{label:this.strings.existing,suggestions:(null==e?void 0:e.length)?e:[]}}getStringFromProfileName(e){switch(e){case"form-constraint":return this.strings.constraint;case"feature-z":return this.strings.featureZ;case"form-calculation":return this.strings.formCalculation;case"labeling":return this.strings.labeling;case"popup":return this.strings.popup;case"popup-element":return this.strings.popupElement;case"feature-reduction-popup":return this.strings.featureReductionPopup;case"feature-reduction-popup-element":return this.strings.featureReductionPopupElement;case"visualization":return this.strings.visualization;case"field-calculation":return this.strings.fieldCalculation;case"aggregate-field":return"Aggregate Field";default:return this.strings.unknown}}render(){return(0,s.h)(s.H,{key:"63d70e1d7496b015fdfd140c1e8ffc3f8915b8e7"},(0,s.h)("calcite-modal",{key:"f3466d61668741822c30888e2759505767476887",class:"arcade-modal",open:!0,scale:"l",escapeDisabled:!0,outsideCloseDisabled:!0,role:"dialog",onCalciteModalClose:()=>this.arcgisModalArcadeClose.emit()},(0,s.h)("h3",{key:"fe535e5d460452e11ff829872c62d2e24c73c7a0",slot:"header",class:"header"},this.arcadeTitle&&this.arcadeTitleEditable?(0,s.h)("calcite-inline-editable",{scale:"l",editingEnabled:this.arcadeTitleEditingEnabled,messageOverrides:{cancelEditing:this.strings.cancel,enableEditing:this.strings.edit,confirmChanges:this.strings.done}},(0,s.h)("calcite-input",{ref:e=>this.arcadeTitleInput=e,alignment:"start",placeholder:this.strings.titlePlaceHolder,scale:"l",type:"text",value:this.arcadeTitle||this.strings.newExpression,onCalciteInputInput:()=>this.hasChanges=!0})):this.arcadeTitle||this.strings.newExpression),(0,s.h)("arcgis-arcade-editor",{key:"55ab1f838ae1fbbb022552b1ebd6070e9a581e41",slot:"content",class:"arcade-editor",ref:e=>this.arcadeEditor=e,hideDocumentationActions:this.hideDocumentationActions,script:this.arcadeScript,profile:this.arcadeProfile,testData:this.testData,suggestions:this.suggestions,onArcgisDiagnosticsChange:async e=>{var t;const i=e.detail;if(null==i?void 0:i.length){for(let e=0;e<i.length;e++)if(1===(null===(t=i[e])||void 0===t?void 0:t.severity))return this.scriptInvalid=!0,void(this.hasChanges=!0);this.scriptInvalid=!1}else this.scriptInvalid=!1;if(!this.hasChanges){const e=await this.arcadeEditor.getScript();this.hasChanges=this.arcadeScript!==e}}}),(0,s.h)("calcite-button",{key:"0ac636dc28dcaf8a37ac5e3d1ffada6d71a83e1a",slot:"secondary",width:"full",appearance:"outline-fill",alignment:"center",scale:"m",onClick:()=>this.arcgisModalArcadeClose.emit()},this.strings.cancel),(0,s.h)("calcite-button",{key:"b3603bb891917d645ecb4b7364f7bb8a2e92b4fe",slot:"primary",width:"full",alignment:"center",appearance:"solid",scale:"m",disabled:this.scriptInvalid||!this.hasChanges,onClick:async()=>{var e;this.arcgisModalArcadeClose.emit(Object.assign(Object.assign({script:await this.arcadeEditor.getScript()},this.arcadeTitle&&{title:(null===(e=this.arcadeTitleInput.value)||void 0===e?void 0:e.trim())||this.strings.newExpression}),this.returnPredictOutputType&&{predictOutputType:await this.getOutputType()}))}},this.strings.done)))}get hostElement(){return(0,s.d)(this)}};n.style=".arcade-modal.sc-arcgis-modal-arcade{top:7.5%;left:7.5%;right:7.5%;--calcite-modal-width:85%;--calcite-modal-height:85%}.arcade-editor.sc-arcgis-modal-arcade{width:100%;height:100%}.header.sc-arcgis-modal-arcade{width:50%}arcgis-arcade-editor.sc-arcgis-modal-arcade{z-index:var(--calcite-z-index-header)}"}}]);