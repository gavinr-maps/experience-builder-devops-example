/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-ffbdb6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-ffbdb6"],{59604:(e,t,i)=>{i.r(t),i.d(t,{arcgis_attributes:()=>f,arcgis_attributes_formatting:()=>y});var s=i(7263),a=i(62159),l=i(77040),o=i(70017),r=i(1991),d=i(58233),n=i(11246),h=i(96536),p=i(28939),c=i(28926);i(78613),i(2174),i(94788),i(31670),i(11935),i(70506),i(99004);const m="total-selected-div",u="field-icons",f=class{constructor(e){(0,s.r)(this,e),this.attributesUpdated=(0,s.c)(this,"attributesUpdated",7),this.arcgisAttributesDismissedChange=(0,s.c)(this,"arcgisAttributesDismissedChange",7),this.internalAttributesUpdated=(0,s.c)(this,"internalAttributesUpdated",7),this.closeAttributePopovers=(0,s.c)(this,"closeAttributePopovers",7),this.arcgisAttributesFieldAdded=(0,s.c)(this,"arcgisAttributesFieldAdded",7),this.arcgisAttributesFieldDeleted=(0,s.c)(this,"arcgisAttributesFieldDeleted",7),this.listItems=[],this.listItemsNodes=[],this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.filterLength=5,this.isPopupOpenForCurrentLayer=!1,this.fieldCanBeAdded=!1,this.debouncedAttributeUpdates=(0,n.d)((()=>{this.layerDisplayType===l.l.feature?this.layer.popupTemplate=this.popupTemplate.clone():this.layerDisplayType===l.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()),this.attributesUpdated.emit()}),1e3),this.calciteListItem=e=>(0,s.h)("calcite-list-item",{id:e.fieldName,label:(0,r.c)(e,this.arcadeExpMap),description:`{${e.fieldName}}`,value:e.fieldName,metadata:{label:(0,r.c)(e,this.arcadeExpMap),fieldName:e.fieldName},onClick:()=>this.selectionClick(e.fieldName),onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),this.selectionClick(e.fieldName))},ref:e=>this.listItemsNodes.push(e)},(0,s.h)("div",{slot:"actions-end",class:u},(0,s.h)(h.F,{fieldType:(0,r.b)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)}))),this.mapView=void 0,this.portal=void 0,this.layer=void 0,this.displayPopup=!0,this.config=void 0,this.layerDisplayType=l.l.feature,this.dismissible=!1,this.hideLayerTitle=!1,this.calciteFlowProps=!1,this.addFieldEnabled=!1,this.deleteFieldEnabled=!1,this.reRender=void 0,this.totalSelectedFields=void 0}async componentWillLoad(){var e;const t=await(0,a.g)(this.hostElement);if(this.strings=t[0],this.currentLanguage=t[1],this.serviceType=(0,r.d)(this.layer),this.layerDisplayType===l.l.feature){const t="type"in this.layer?this.layer.type:"sublayer",i=this.mapView.popup.visible?null===(e=this.mapView.popup.selectedFeature)||void 0===e?void 0:e.sourceLayer:void 0;this.isPopupOpenForCurrentLayer="subtype-sublayer"===t?(null==i?void 0:i.subtypeCode)===this.layer.subtypeCode&&(null==i?void 0:i.parent.id)===this.layer.parent.id:"sublayer"===t?(null==i?void 0:i.id)===this.layer.id&&(null==i?void 0:i.layer.id)===this.layer.layer.id:"id"in this.layer&&(null==i?void 0:i.id)===this.layer.id,this.serviceType!==l.s.mapImage||this.layer.popupTemplate||(this.layer.popupEnabled=!1),this.popupTemplate=this.layer.popupTemplate?this.layer.popupTemplate.clone():this.layer.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await(0,o.g)(this.layer,this.popupTemplate)]}else this.popupTemplate=this.layer.featureReduction.popupTemplate.clone();this.fieldCanBeAdded=this.addFieldEnabled&&await(0,h.c)(this.layer)}componentDidLoad(){this.calciteListNode=this.hostElement.shadowRoot.getElementById("list_Id"),this.showPreviewPopup(!0),this.setupResizeObserver()}async componentWillRender(){this.layerFieldsMap=await(0,r.e)(this.layer),this.arcadeExpMap=(0,r.f)(this.popupTemplate),this.listItems=[],this.listItemsNodes=[],this.popupTemplate.fieldInfos.forEach((e=>this.createListItem(e)))}componentDidUpdate(){this.internalAttributesUpdated.emit()}disconnectedCallback(){var e;null===(e=this.parentShellObserver)||void 0===e||e.disconnect()}async done(){this.closeAttributePopovers.emit(!0),this.showPreviewPopup(!1)}async setFocus(){var e,t;this.flowItemNode?null===(e=this.flowItemNode)||void 0===e||e.setFocus():null===(t=this.calciteListNode)||void 0===t||t.setFocus()}arcgisAttributesFormattingUpdatedHandler(e){e.stopPropagation(),this.popupTemplate=e.detail.clone(),this.reRender=!this.reRender}arcgisAttributesFormattingDismissedHandler(e){e.stopPropagation(),this.closeAttributePopovers.emit(!0)}async closeAttributePopoversHandler(e){if(this.attributeFormatter&&(document.body.removeChild(this.attributeFormatter),this.attributeFormatter=null,e.detail)){const e=this.calciteListNode.selectedItems,t=e.find((e=>e.id===this.lastSelectedFieldName));for(const t of e.values())t.selected=!1;this.totalSelectedFields=0,this.lastSelectedFieldName=void 0,setTimeout((()=>t?t.setFocus():this.listItemsNodes[0].setFocus()),300)}}internalAttributesUpdatedHandler(e){e.stopPropagation(),this.debouncedAttributeUpdates()}calciteChipCloseHandler(e){e.stopPropagation(),this.closeAttributePopovers.emit(!0)}async selectionClick(e){this.closeAttributePopovers.emit();const t=[...this.calciteListNode.selectedItems.map((e=>e.value))];this.totalSelectedFields=t.length,this.lastSelectedFieldName=e,!this.attributeFormatter&&t.length&&(this.attributeFormatter=document.createElement("arcgis-attributes-formatting"),this.attributeFormatter.config=this.config,this.attributeFormatter.popoverProps={refElement:this.hostElement,offsetSkidding:45},this.attributeFormatter.layerDisplayType=this.layerDisplayType,this.attributeFormatter.selectedFields=t,this.attributeFormatter.layer=this.layer,this.attributeFormatter.mapView=this.mapView,this.attributeFormatter.popupTemplate=this.popupTemplate.clone(),this.attributeFormatter.deleteFieldEnabled=this.deleteFieldEnabled,this.attributeFormatter.addEventListener("arcgisAttributesFormattingFieldDeleted",(async e=>{var t,i;null===(i=null===(t=this.attributeFormatter)||void 0===t?void 0:t.parentElement)||void 0===i||i.removeChild(this.attributeFormatter),this.attributeFormatter=null,this.popupTemplate=this.layer.popupTemplate.clone(),this.listItemsNodes.forEach((e=>{e&&(e.selected=!1)})),this.totalSelectedFields=0,this.arcgisAttributesFieldDeleted.emit(e.detail)})),document.body.appendChild(this.attributeFormatter))}removeAddFieldNodes(){var e,t;this.addFieldFab.disabled=!1,null===(t=null===(e=this.addFieldNode)||void 0===e?void 0:e.parentElement)||void 0===t||t.childNodes.forEach((e=>{var t,i;"ARCGIS-FIELD-ADD"===e.nodeName&&(null===(i=null===(t=this.addFieldNode)||void 0===t?void 0:t.parentElement)||void 0===i||i.removeChild(e))}))}openAddFieldModal(){this.addFieldNode=document.createElement("arcgis-field-add"),this.addFieldNode.layer=this.layer,this.addFieldNode.addEventListener("arcgisFieldAddFieldAdded",(async e=>{const{layer:t}=this;this.layer.popupTemplate.fieldInfos=[...t.popupTemplate.fieldInfos],this.popupTemplate=this.layer.popupTemplate.clone();const i=this.layer.popupTemplate.fieldInfos.find((t=>t.fieldName===e.detail));this.popupTemplate.fieldInfos=[...await(0,o.g)(this.layer,this.popupTemplate),i],this.arcgisAttributesFieldAdded.emit(e.detail),this.removeAddFieldNodes()})),this.addFieldNode.addEventListener("arcgisWorkflowCancel",(async()=>{this.removeAddFieldNodes()})),document.body.appendChild(this.addFieldNode)}showPreviewPopup(e){var t;this.displayPopup&&this.layerDisplayType===l.l.feature&&!this.isPopupOpenForCurrentLayer&&(e&&this.layer.popupEnabled&&this.layer.popupTemplate?(this.previewPopupController=new AbortController,(0,o.p)(this.mapView,this.layer,this.previewPopupController)):(null===(t=this.previewPopupController)||void 0===t||t.abort(),this.mapView.closePopup()))}setupResizeObserver(){var e;const t=null===(e=this.hostElement)||void 0===e?void 0:e.parentElement;(0,n.i)(t.collapsed)&&(this.parentShellObserver=new ResizeObserver((()=>{t.collapsed?this.done():this.showPreviewPopup(!0)})),this.parentShellObserver.observe(t))}createListItem(e){var t;-1===(null===(t=e.fieldName)||void 0===t?void 0:t.indexOf(l.f.relationship))&&this.listItems.push(this.calciteListItem(e))}displayList(){return(0,s.h)("calcite-list",{id:"list_Id",filterEnabled:this.listItems.length>=this.filterLength,filterPlaceholder:this.strings.filterAttributes,selectionMode:"multiple"},this.totalSelectedFields>0?(0,s.h)("div",{class:m},(0,s.h)("calcite-chip",{value:"totalSelectedValue",closable:!0},`${this.totalSelectedFields} ${this.strings.selected}`)):null,this.listItems)}render(){return(0,s.h)(s.H,{key:"0ba8aafd7a5cbefaef1f1d1db66e6ac54fc2480a",style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,d.g)(this.hostElement)},this.displayList()):(0,s.h)("calcite-flow",{id:"attributes_flow_Id",dir:(0,d.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{heading:this.strings.attributesHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.done(),this.arcgisAttributesDismissedChange.emit()}},this.displayList(),this.fieldCanBeAdded&&this.renderAddFieldFab())))}renderAddFieldFab(){return(0,s.h)("calcite-fab",{ref:e=>this.addFieldFab=e,scale:"s",class:"floating-add-field-button",slot:"fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:this.strings.addField,onClick:()=>{this.addFieldFab.disabled=!0,this.openAddFieldModal()}})}get hostElement(){return(0,s.d)(this)}};f.style=".total-selected-div{padding:5px}.field-icons{padding:0 var(--arcgis-app-cap-spacing);display:flex;align-items:center}.floating-add-field-button{padding-bottom:0.5rem}";const y=class{constructor(e){(0,s.r)(this,e),this.arcgisAttributesFormattingDismissed=(0,s.c)(this,"arcgisAttributesFormattingDismissed",7),this.arcgisAttributesFormattingUpdated=(0,s.c)(this,"arcgisAttributesFormattingUpdated",7),this.arcgisAttributesFormattingFieldDeleted=(0,s.c)(this,"arcgisAttributesFormattingFieldDeleted",7),this.displayDate=new Date("December 31, 1969 18:00:00"),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.selectedFieldInfoMap=new Map,this.hasCommonDataTypes=!0,this.fieldIsDeletable=!1,this.thousandSeperator=()=>(0,s.h)("section",{class:"single-line-label-switch-section"},(0,s.h)("calcite-label",{class:"single-line-label-switch-label"},this.strings.show1000Seperator),(0,s.h)("calcite-switch",{id:"thousandSeperatorSwitch_Id",scale:"s",class:"single-line-label-switch-switch",checked:!!this.firstSelected.format.digitSeparator})),this.significantDigits=()=>(0,s.h)("section",null,(0,s.h)("calcite-label",null,this.strings.significantDigits,(0,s.h)("calcite-select",{label:this.strings.significantDigits,onCalciteSelectChange:e=>{const t=e.target;this.firstSelected.format.places=Number(t.selectedOption.value)||0,this.saveFieldInfo()}},[0,1,2,3,4,5,6,7,8].map((e=>(0,s.h)("calcite-option",{value:e.toString(),selected:this.firstSelected.format.places===e},`${e} ${this.strings.decimalPlaces}`)))))),this.dateFormat=e=>(0,s.h)("section",null,(0,s.h)("calcite-label",null,this.strings.dateFormat,(0,s.h)("calcite-select",{id:"dateFormatSelect_Id",label:this.strings.dateFormat,onCalciteSelectChange:()=>this.changeDateFormat()},p.d.map((t=>(0,s.h)("calcite-option",{value:t,selected:e===t},this.intl.formatDate(this.displayDate,this.intl.convertDateFormatToIntlOptions(t)))))))),this.showTime=e=>(0,s.h)("section",{class:"single-line-label-switch-section",id:"showTime_Id"},(0,s.h)("calcite-label",{class:"single-line-label-switch-label"},this.strings.showTime),(0,s.h)("calcite-switch",{id:"showTimeSwitch_Id",scale:"s",class:"single-line-label-switch-switch",checked:!!e})),this.timeFormat=e=>(0,s.h)("section",{id:"timeFormat_Id"},(0,s.h)("calcite-label",null,this.strings.timeFormat,(0,s.h)("calcite-select",{id:"timeFormatSelect_Id",label:this.strings.timeFormat,onCalciteSelectChange:()=>this.changeDateFormat()},p.t.map((t=>(0,s.h)("calcite-option",{value:t,selected:e===t},this.getTimeFormatString(t))))))),this.layer=void 0,this.config=void 0,this.mapView=void 0,this.deleteFieldEnabled=!1,this.layerDisplayType=l.l.feature,this.selectedFields=void 0,this.popoverProps=void 0,this.popupTemplate=void 0,this.isOpen=!1}async componentWillLoad(){const e=await(0,a.g)(this.hostElement);this.strings=e[0],this.currentLanguage=e[1];const[t,i]=await(0,c.l)(["esri/intl","esri/core/reactiveUtils"]);this.intl=t,this.reactiveUtils=i,this.layerFieldsMap=await(0,r.e)(this.layer),this.arcadeExpMap=(0,r.f)(this.popupTemplate),this.selectedFields.forEach((e=>{this.popupTemplate.fieldInfos.find(((t,i)=>{t.fieldName===e&&this.selectedFieldInfoMap.set(e,{index:i,fieldType:(0,r.b)(e,this.layerFieldsMap,this.arcadeExpMap),fieldInfo:t})}))})),this.firstSelected=this.selectedFieldInfoMap.get(this.selectedFields[0]).fieldInfo,this.firstSelectedFieldType=this.selectedFieldInfoMap.get(this.selectedFields[0]).fieldType,this.hasCommonDataTypes=this.commonDataTypesCheck(this.firstSelectedFieldType),!this.firstSelected.format&&this.hasCommonDataTypes&&await this.setupDefaultFormat(this.firstSelected,this.firstSelectedFieldType);const{layer:s,mapView:l,selectedFields:o}=this;if(("feature"===s.type||"oriented-imagery"===s.type)&&s.portalItem&&1===(null==o?void 0:o.length)){const e=s.fields.find((e=>e.name===o[0]));this.fieldIsDeletable=this.mapView&&this.deleteFieldEnabled&&await(0,h.a)(l,s,e)}}componentDidLoad(){this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition(),this.aliasInput&&this.aliasInput.focus(),this.setupDateTimeDisplay(),setTimeout((()=>requestAnimationFrame((()=>{this.panelElement.setFocus()}))),300)}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async setFocus(){setTimeout((()=>this.panelElement.setFocus()),100)}calciteSwitchChangeHandler(e){e.stopPropagation(),this.firstSelected.format&&("date"===this.firstSelectedFieldType||"timestamp-offset"===this.firstSelectedFieldType?this.changeDateFormat():(this.firstSelected.format.digitSeparator=!!this.hostElement.shadowRoot.getElementById("thousandSeperatorSwitch_Id").checked,this.saveFieldInfo()))}commonDataTypesCheck(e){for(let t=1;t<this.selectedFields.length;t++){const i=this.selectedFieldInfoMap.get(this.selectedFields[t]).fieldType;if(e===l.a.integer||e===l.a.smallInteger||e===l.a.bigInteger){if(-1===[l.a.integer,l.a.smallInteger,l.a.bigInteger].indexOf(i))return!1}else if(e===l.a.single||e===l.a.double||e===l.a.long||e===l.a.number){if(-1===[l.a.single,l.a.double,l.a.long,l.a.number].indexOf(i))return!1}else if(e===l.a.date||e===l.a.timestampOffset){if(-1===[l.a.date,l.a.timestampOffset].indexOf(i))return!1}else if(e===l.a.dateOnly){if(-1===[l.a.dateOnly].indexOf(i))return!1}else if(e===l.a.timeOnly&&-1===[l.a.timeOnly].indexOf(i))return!1}return!0}async setupDefaultFormat(e,t){const[i]=await(0,c.l)(["esri/popup/support/FieldInfoFormat"]);t===l.a.integer||t===l.a.smallInteger||t===l.a.bigInteger?(e.format=new i({digitSeparator:!1}),this.saveFieldInfo()):t===l.a.single||t===l.a.double||t===l.a.long||t===l.a.number?(e.format=new i({digitSeparator:!1,places:2}),this.saveFieldInfo()):t!==l.a.date&&t!==l.a.dateOnly&&t!==l.a.timeOnly&&t!==l.a.timestampOffset||!this.dateFormattingAvailable()||(t===l.a.dateOnly?e.format=new i({dateFormat:"short-date"}):e.format=new i({dateFormat:"short-date-short-time"}),this.saveFieldInfo())}setupDateTimeDisplay(){var e;if(("date"===this.firstSelectedFieldType||"time-only"===this.firstSelectedFieldType||"timestamp-offset"===this.firstSelectedFieldType)&&(null===(e=this.firstSelected.format)||void 0===e?void 0:e.dateFormat)&&this.hasCommonDataTypes){const e=this.hostElement.shadowRoot.getElementById("showTime_Id"),t=this.hostElement.shadowRoot.getElementById("showTimeSwitch_Id"),i=this.hostElement.shadowRoot.getElementById("timeFormat_Id"),s=p.a.get(this.firstSelected.format.dateFormat);"date"===this.firstSelectedFieldType||"timestamp-offset"===this.firstSelectedFieldType?""===s.timeFormat?(e.style.display="flex",t.checked=!1,i.style.display="none"):null===s.timeFormat?(e.style.display="none",t.checked=!1,i.style.display="none"):(e.style.display="flex",t.checked=!0,i.style.display="block"):"time-only"===this.firstSelectedFieldType&&(i.style.display="block")}}getTimeFormatString(e){return e===p.t[0]?this.strings.shortTime:e===p.t[1]?this.strings.longTime:e===p.t[2]?this.strings.shortTime24:e===p.t[3]?this.strings.longTime24:this.strings.shortTime24}changeAlias(){(0,r.i)(this.aliasInput.value)||(this.aliasInput.value=this.firstSelected.fieldName),this.arcadeExpMap.has(this.firstSelected.fieldName)?this.arcadeExpMap.get(this.firstSelected.fieldName).title=this.aliasInput.value:this.firstSelected.label=this.aliasInput.value,this.saveFieldInfo()}changeDateFormat(){const e=this.hostElement.shadowRoot.getElementById("dateFormatSelect_Id"),t=this.hostElement.shadowRoot.getElementById("timeFormatSelect_Id"),i=this.hostElement.shadowRoot.getElementById("showTimeSwitch_Id");if("date"===this.firstSelectedFieldType||"timestamp-offset"===this.firstSelectedFieldType){const s=p.a.get(e.selectedOption.value);""===s.timeFormat?this.firstSelected.format.dateFormat=i.checked?`${e.selectedOption.value}-${t.selectedOption.value}`:`${e.selectedOption.value}`:null===s.timeFormat&&(this.firstSelected.format.dateFormat=`${e.selectedOption.value}`)}else"date-only"===this.firstSelectedFieldType?this.firstSelected.format.dateFormat=`${e.selectedOption.value}`:"time-only"===this.firstSelectedFieldType&&(this.firstSelected.format.dateFormat=`short-date-${t.selectedOption.value}`);this.saveFieldInfo(),this.setupDateTimeDisplay(),this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition()}saveFieldInfo(){var e;this.hasCommonDataTypes&&(this.selectedFieldInfoMap.forEach((e=>{e.fieldInfo.fieldName===this.firstSelected.fieldName?e.fieldInfo=this.firstSelected.clone():e.fieldInfo.format=this.firstSelected.format.clone()})),1===this.selectedFields.length&&this.arcadeExpMap.has(this.firstSelected.fieldName)&&(null===(e=this.popupTemplate)||void 0===e?void 0:e.expressionInfos)&&this.popupTemplate.expressionInfos.find(((e,t)=>{if(`${l.f.expression}${e.name}`===this.firstSelected.fieldName)return this.popupTemplate.expressionInfos[t]=this.arcadeExpMap.get(this.firstSelected.fieldName).clone()})),this.selectedFieldInfoMap.forEach((e=>{this.popupTemplate.fieldInfos[e.index]=e.fieldInfo.clone()})),Array.isArray(this.popupTemplate.content)&&this.popupTemplate.content.forEach((e=>{"fields"===e.type&&e.fieldInfos&&e.fieldInfos.forEach(((t,i)=>{if(this.selectedFieldInfoMap.has(t.fieldName)){const s=this.selectedFieldInfoMap.get(t.fieldName).fieldInfo.clone();s.visible=!0,e.fieldInfos[i]=s}}))})),this.arcgisAttributesFormattingUpdated.emit(this.popupTemplate.clone()))}formattingOptions(){if(this.firstSelected.format){if(this.firstSelectedFieldType===l.a.integer||this.firstSelectedFieldType===l.a.smallInteger||this.firstSelectedFieldType===l.a.bigInteger)return this.thousandSeperator();if(this.firstSelectedFieldType===l.a.single||this.firstSelectedFieldType===l.a.double||this.firstSelectedFieldType===l.a.long||this.firstSelectedFieldType===l.a.number)return(0,s.h)("div",null,this.significantDigits(),this.thousandSeperator());if(this.firstSelectedFieldType!==l.a.date&&this.firstSelectedFieldType!==l.a.dateOnly&&this.firstSelectedFieldType!==l.a.timeOnly&&this.firstSelectedFieldType!==l.a.timestampOffset||!this.dateFormattingAvailable())return null;{const e=p.a.has(this.firstSelected.format.dateFormat)?p.a.get(this.firstSelected.format.dateFormat):this.firstSelectedFieldType===l.a.dateOnly?p.a.get("short-date"):p.a.get("short-date-short-time");return(0,s.h)("div",null,this.firstSelectedFieldType!==l.a.timeOnly&&this.dateFormat(e.dateFormat),this.firstSelectedFieldType!==l.a.timeOnly&&this.firstSelectedFieldType!==l.a.dateOnly&&this.showTime(e.timeFormat),this.firstSelectedFieldType!==l.a.dateOnly&&this.timeFormat(e.timeFormat))}}return null}dateFormattingAvailable(){return!((0,r.d)(this.layer)===l.s.scene)||null!=this.layer.associatedLayer}render(){return(0,s.h)(s.H,{key:"bebd526cbfae65b0c2ef4e9efdb1aaef3262b082",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"c839d94c0cc4a393efea428a6a2f7faf2647544b",dir:(0,d.g)(this.hostElement),id:"managePopover_Id",placement:this.popoverProps.placement||"leading-start",open:!0,pointerDisabled:!0,referenceElement:this.popoverProps.refElement,offsetDistance:this.popoverProps.offsetDistance||0,offsetSkidding:this.popoverProps.offsetSkidding||0,label:this.strings.formattingOptions,style:{zIndex:"100"},ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"b99ee5ece9c5f1816575cfeb72cff6502def6c8e",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.popoverProps.popoverWidth||this.popoverProps.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.arcgisAttributesFormattingDismissed.emit()},(0,s.h)("div",{key:"ce1051160e6b4047af41c3b36f228ff6949330a0",slot:"header-content"},this.strings.manageField),this.renderDeleteButton(),this.renderDoneButton(),(0,s.h)("div",{key:"fef6c9088157db0ab9dbe2e51765abc98b823d63",class:"formatting-div"},1===this.selectedFields.length?this.renderAliasDiv():(0,s.h)("h3",null,`${this.strings.multipleSelection} (${this.selectedFields.length})`),this.hasCommonDataTypes?this.formattingOptions():(0,s.h)("h3",null,this.strings.selectCommon)))))}renderDeleteButton(){const{layer:e,mapView:t,config:i,selectedFields:a,strings:l,fieldIsDeletable:o}=this;return o?(0,s.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"half",kind:"danger",onClick:s=>{const l=s.target;l.disabled=!0;const o=document.createElement("arcgis-field-delete");o.layer=e,o.mapView=t,o.config=i,o.fieldName=a[0],o.addEventListener("arcgisFieldDeleteModalClose",(()=>l.disabled=!1)),o.addEventListener("arcgisFieldDeleteFieldDeleted",(()=>this.arcgisAttributesFormattingFieldDeleted.emit(a[0]))),document.body.append(o)}},l.deleteField):null}renderDoneButton(){const{strings:e,fieldIsDeletable:t}=this;return(0,s.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:t?"half":"full",onClick:()=>this.arcgisAttributesFormattingDismissed.emit("done")},e.done)}renderAliasDiv(){const{strings:e,arcadeExpMap:t,firstSelected:i}=this;return(0,s.h)("calcite-label",null,e.displayName,(0,s.h)("calcite-input",{type:"text",ref:e=>{this.aliasInput=e},value:t.has(i.fieldName)?t.get(i.fieldName).title:i.label,onCalciteInputInput:()=>this.changeAlias()}))}get hostElement(){return(0,s.d)(this)}};y.style=".formatting-div{padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing);max-height:60vh}.single-line-label-switch-section{display:flex;margin:0;padding:var(--arcgis-app-cap-spacing-half) 0}.single-line-label-switch-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.single-line-label-switch-switch{flex:0 0 0%;justify-self:flex-end;margin:0}.single-line-label-switch-switch input{display:none}"},28939:(e,t,i)=>{i.d(t,{a:()=>l,d:()=>s,t:()=>a});const s=["short-date","long-month-day-year","day-short-month-year","long-date","long-month-year","short-month-year","year"],a=["short-time","long-time","short-time-24","long-time-24"],l=new Map;l.set("short-date",{dateFormat:s[0],timeFormat:""}),l.set("short-date-short-time",{dateFormat:s[0],timeFormat:a[0]}),l.set("short-date-long-time",{dateFormat:s[0],timeFormat:a[1]}),l.set("short-date-short-time-24",{dateFormat:s[0],timeFormat:a[2]}),l.set("short-date-long-time-24",{dateFormat:s[0],timeFormat:a[3]}),l.set("long-month-day-year",{dateFormat:s[1],timeFormat:""}),l.set("long-month-day-year-short-time",{dateFormat:s[1],timeFormat:a[0]}),l.set("long-month-day-year-long-time",{dateFormat:s[1],timeFormat:a[1]}),l.set("long-month-day-year-short-time-24",{dateFormat:s[1],timeFormat:a[2]}),l.set("long-month-day-year-long-time-24",{dateFormat:s[1],timeFormat:a[3]}),l.set("day-short-month-year",{dateFormat:s[2],timeFormat:""}),l.set("day-short-month-year-short-time",{dateFormat:s[2],timeFormat:a[0]}),l.set("day-short-month-year-long-time",{dateFormat:s[2],timeFormat:a[1]}),l.set("day-short-month-year-short-time-24",{dateFormat:s[2],timeFormat:a[2]}),l.set("day-short-month-year-long-time-24",{dateFormat:s[2],timeFormat:a[3]}),l.set("long-date",{dateFormat:s[3],timeFormat:""}),l.set("long-date-short-time",{dateFormat:s[3],timeFormat:a[0]}),l.set("long-date-long-time",{dateFormat:s[3],timeFormat:a[1]}),l.set("long-date-short-time-24",{dateFormat:s[3],timeFormat:a[2]}),l.set("long-date-long-time-24",{dateFormat:s[3],timeFormat:a[3]}),l.set("long-month-year",{dateFormat:s[4],timeFormat:null}),l.set("short-month-year",{dateFormat:s[5],timeFormat:null}),l.set("year",{dateFormat:s[6],timeFormat:null}),l.set("default",{dateFormat:s[0],timeFormat:a[2]})},70017:(e,t,i)=>{i.d(t,{g:()=>o,p:()=>r});var s=i(28926),a=i(77040),l=i(1991);const o=(e,t)=>async function(e,t){return new Promise(((i,o)=>{(0,s.l)(["esri/popup/FieldInfo"]).then((async([s])=>{var o,r,d;const n=[],h=new Map(null===(o=null==t?void 0:t.fieldInfos)||void 0===o?void 0:o.map((e=>[e.fieldName,e]))),p=await(0,l.e)(e);(null==p?void 0:p.size)&&(h.forEach((e=>{p.has(e.fieldName)&&(n.push(e),p.delete(e.fieldName))})),p.forEach((e=>{if(-1===["geometry"].indexOf(e.type)){const t=new s;t.fieldName=e.name,t.label=e.alias,t.visible=!1,n.push(t)}})),p.clear()),(null==t?void 0:t.expressionInfos)&&(null===(r=t.expressionInfos)||void 0===r||r.forEach((e=>{const t=`${a.f.expression}${e.name}`;if(h.has(t))n.push(h.get(t));else{const e=new s;e.fieldName=t,e.visible=!1,n.push(e)}}))),null===(d=null==t?void 0:t.fieldInfos)||void 0===d||d.forEach((e=>{-1!==e.fieldName.indexOf(a.f.relationship)&&n.push(e)})),i(n)}),(e=>{o(e)}))}))}(e,t),r=async(e,t,i)=>{var s,o;e.closePopup();let r=null;const n=(0,l.d)(t);if(n!==a.s.scene||(null==t?void 0:t.associatedLayer))return r=await d(e,t,i,n),r?("dockEnabled"in e.popup&&(e.popup.dockEnabled=!0),e.openPopup({features:[r],location:(null===(o=null===(s=r.geometry)||void 0===s?void 0:s.extent)||void 0===o?void 0:o.center)||r.geometry}),r):void 0},d=async(e,t,i,o)=>{var r,d,p,c,m,u,f,y,g,F,v;try{let b,w=null;if(o===a.s.ogcFeature){w=await e.whenLayerView(t);const[i]=await(0,s.l)(["esri/core/reactiveUtils"]);await i.whenOnce((()=>!w.updating))}else if(o===a.s.stream){w=await e.whenLayerView(t);const[i]=await(0,s.l)(["esri/core/reactiveUtils"]);await i.whenOnce((()=>!w.updating))}else w=t;if(o===a.s.imageryTile){const i=e.allLayerViews.find((e=>e.layer.id===t.id)),s=await i.fetchPopupFeatures(t.fullExtent.center);return null==s?void 0:s[0]}if(o===a.s.mapImage&&t.layer.version>=10.5&&!(null===(d=null===(r=t.layer.capabilities)||void 0===r?void 0:r.operations)||void 0===d?void 0:d.supportsQuery)&&(null===(c=null===(p=t.layer.capabilities)||void 0===p?void 0:p.operations)||void 0===c?void 0:c.supportsIdentify)){const i=await(0,l.h)(t,e);return i&&(i.sourceLayer=t),i}const I="isTable"in t&&t.isTable,T=w.createQuery();I||(T.geometry=e.center,T.distance=e.resolution),T.outFields=["*"];const S=await w.queryFeatures(T,{signal:i.signal});if(0===(null===(m=null==S?void 0:S.features)||void 0===m?void 0:m.length)){const s=w.createQuery();s.geometry=e.extent,s.outFields=["*"];const l=await w.queryFeatures(s,{signal:i.signal});if((null===(u=null==l?void 0:l.features)||void 0===u?void 0:u.length)>0)b=await h(l,e,t);else{const s=w.createQuery();s.where=w.definitionExpression||"1=1",s.outFields=["*"],((null===(y=null===(f=t.sourceJSON)||void 0===f?void 0:f.advancedQueryCapabilities)||void 0===y?void 0:y.supportsPagination)||o===a.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=e.spatialReference,b=null===(F=null===(g=await w.queryFeatures(s,{signal:i.signal}))||void 0===g?void 0:g.features)||void 0===F?void 0:F[0]}}else b=null===(v=null==S?void 0:S.features)||void 0===v?void 0:v[0];return b&&o===a.s.imagery&&(b=await n(t,b)),b}catch(e){console.log(e)}},n=async(e,t)=>{var i;const s=e.createQuery();s.outFields=["*"].concat(e.rasterFields.map((e=>e.name)).filter((e=>e.startsWith("Raster.")))),s.geometry=t.geometry,s.outSpatialReference=t.geometry.spatialReference;const a=await e.queryVisibleRasters(s,{returnTopmostRaster:!0,returnDomainValues:!0});return null!==(i=null==a?void 0:a[0])&&void 0!==i?i:t},h=async(e,t,i)=>{const a=await(0,l.j)(i);if("point"===a){let i=null;for(let s=0;s<e.features.length;s++){const a=e.features[s].geometry.distance(t.center);(0===s||(null==i?void 0:i[1])>a)&&(i=[e.features[s],a])}return i[0]}if("polyline"===a){let i=null;const[a]=await(0,s.l)(["esri/geometry/geometryEngine"]);for(let s=0;s<e.features.length;s++){const l=a.nearestVertex(e.features[s].geometry,t.center).distance;(0===s||(null==i?void 0:i[1])>l)&&(i=[e.features[s],l])}return i[0]}if("polygon"===a||"imagery"===(0,l.d)(i)){let i=null;for(let s=0;s<e.features.length;s++){const a=e.features[s].geometry.centroid.distance(t.center);(0===s||(null==i?void 0:i[1])>a)&&(i=[e.features[s],a])}return i[0]}return e.features[0]}}}]);