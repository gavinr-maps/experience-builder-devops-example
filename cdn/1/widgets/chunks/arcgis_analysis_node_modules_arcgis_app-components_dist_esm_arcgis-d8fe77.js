/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d8fe77.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d8fe77"],{56237:(e,t,r)=>{r.r(t),r.d(t,{arcgis_filter:()=>Yi,arcgis_filter_condition:()=>vs,arcgis_filter_expression:()=>Es,arcgis_filter_unique_list:()=>Cs});var n=r(7263),i=r(62159),s=r(28926),a=r(58233),o=r(1991),l=r(11246);r(77040),r(70506),r(78613),r(99004);const u="hook",c="empty-msg",d="msg-icon",h="tip-msg",p="header-info",f="match-expression-msg",m="match-expression-dropdown",v="match-type",g="notice";var y,O,I,b,T,N;function E(e){return null!=e}function w(e){if(!e||!e.filter)return!0;return!["geometry","objectIds","timeExtent","where"].some((t=>e.filter.hasOwnProperty(t)&&!!e.filter[t]))}function k(e){return e&&e.length?e.map(((e,t)=>e.uid===`expression-${t}`?Object.assign(Object.assign({},e),{conditions:e.conditions.map(((e,r)=>{const n=`condition-${t}-${r}`;return e.uid===n?e:Object.assign(Object.assign({},e),{uid:n})}))}):Object.assign(Object.assign({},e),{uid:`expression-${t}`,expressionIndex:t,conditions:e.conditions.map(((e,r)=>{const n=`condition-${t}-${r}`;return e.uid===n?e:Object.assign(Object.assign({},e),{uid:n})}))}))):e}!function(e){e.AND="and",e.OR="or"}(y||(y={})),function(e){e.NUMBER="number",e.STRING="string",e.DATE="date",e.DATE_ONLY="date-only",e.TIME_ONLY="time-only",e.OID="oid",e.GUID="guid",e.DOMAIN="domain"}(O||(O={})),function(e){e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed"}(I||(I={})),function(e){e.MINUTE="minute",e.HOUR="hour",e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year"}(b||(b={})),function(e){e[e.MINUTE=6e4]="MINUTE",e[e.HOUR=36e5]="HOUR",e[e.DAY=864e5]="DAY",e[e.WEEK=6048e5]="WEEK",e[e.MONTH=2592e6]="MONTH",e[e.YEAR=31104e6]="YEAR"}(T||(T={})),function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(N||(N={}));var S={};function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,s=void 0,"symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?s:String(s)),n)}var i,s}function x(e,t,r){return t&&F(e.prototype,t),r&&F(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C.apply(this,arguments)}function D(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,L(e,t)}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}function V(e,t,r){return V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&L(i,r.prototype),i},V.apply(null,arguments)}function A(e){var t="function"==typeof Map?new Map:void 0;return A=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return V(e,arguments,M(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),L(n,e)},A(e)}function $(e,t){if(null==e)return{};var r,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(S,"__esModule",{value:!0});var U=function(e){function t(){return e.apply(this,arguments)||this}return D(t,e),t}(A(Error)),B=function(e){function t(t){return e.call(this,"Invalid DateTime: "+t.toMessage())||this}return D(t,e),t}(U),P=function(e){function t(t){return e.call(this,"Invalid Interval: "+t.toMessage())||this}return D(t,e),t}(U),j=function(e){function t(t){return e.call(this,"Invalid Duration: "+t.toMessage())||this}return D(t,e),t}(U),W=function(e){function t(){return e.apply(this,arguments)||this}return D(t,e),t}(U),Z=function(e){function t(t){return e.call(this,"Invalid unit "+t)||this}return D(t,e),t}(U),_=function(e){function t(){return e.apply(this,arguments)||this}return D(t,e),t}(U),H=function(e){function t(){return e.call(this,"Zone is an abstract class")||this}return D(t,e),t}(U),Y="numeric",z="short",G="long",J={year:Y,month:Y,day:Y},K={year:Y,month:z,day:Y},Q={year:Y,month:z,day:Y,weekday:z},X={year:Y,month:G,day:Y},ee={year:Y,month:G,day:Y,weekday:G},te={hour:Y,minute:Y},re={hour:Y,minute:Y,second:Y},ne={hour:Y,minute:Y,second:Y,timeZoneName:z},ie={hour:Y,minute:Y,second:Y,timeZoneName:G},se={hour:Y,minute:Y,hourCycle:"h23"},ae={hour:Y,minute:Y,second:Y,hourCycle:"h23"},oe={hour:Y,minute:Y,second:Y,hourCycle:"h23",timeZoneName:z},le={hour:Y,minute:Y,second:Y,hourCycle:"h23",timeZoneName:G},ue={year:Y,month:Y,day:Y,hour:Y,minute:Y},ce={year:Y,month:Y,day:Y,hour:Y,minute:Y,second:Y},de={year:Y,month:z,day:Y,hour:Y,minute:Y},he={year:Y,month:z,day:Y,hour:Y,minute:Y,second:Y},pe={year:Y,month:z,day:Y,weekday:z,hour:Y,minute:Y},fe={year:Y,month:G,day:Y,hour:Y,minute:Y,timeZoneName:z},me={year:Y,month:G,day:Y,hour:Y,minute:Y,second:Y,timeZoneName:z},ve={year:Y,month:G,day:Y,weekday:G,hour:Y,minute:Y,timeZoneName:G},ge={year:Y,month:G,day:Y,weekday:G,hour:Y,minute:Y,second:Y,timeZoneName:G},ye=function(){function e(){}var t=e.prototype;return t.offsetName=function(e,t){throw new H},t.formatOffset=function(e,t){throw new H},t.offset=function(e){throw new H},t.equals=function(e){throw new H},x(e,[{key:"type",get:function(){throw new H}},{key:"name",get:function(){throw new H}},{key:"ianaName",get:function(){return this.name}},{key:"isUniversal",get:function(){throw new H}},{key:"isValid",get:function(){throw new H}}]),e}(),Oe=null,Ie=function(e){function t(){return e.apply(this,arguments)||this}D(t,e);var r=t.prototype;return r.offsetName=function(e,t){return At(e,t.format,t.locale)},r.formatOffset=function(e,t){return Ut(this.offset(e),t)},r.offset=function(e){return-new Date(e).getTimezoneOffset()},r.equals=function(e){return"system"===e.type},x(t,[{key:"type",get:function(){return"system"}},{key:"name",get:function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!0}}],[{key:"instance",get:function(){return null===Oe&&(Oe=new t),Oe}}]),t}(ye),be={};var Te={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};var Ne={},Ee=function(e){function t(r){var n;return(n=e.call(this)||this).zoneName=r,n.valid=t.isValidZone(r),n}D(t,e),t.create=function(e){return Ne[e]||(Ne[e]=new t(e)),Ne[e]},t.resetCache=function(){Ne={},be={}},t.isValidSpecifier=function(e){return this.isValidZone(e)},t.isValidZone=function(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}};var r=t.prototype;return r.offsetName=function(e,t){return At(e,t.format,t.locale,this.name)},r.formatOffset=function(e,t){return Ut(this.offset(e),t)},r.offset=function(e){var t=new Date(e);if(isNaN(t))return NaN;var r,n=(r=this.name,be[r]||(be[r]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),be[r]),i=n.formatToParts?function(e,t){for(var r=e.formatToParts(t),n=[],i=0;i<r.length;i++){var s=r[i],a=s.type,o=s.value,l=Te[a];"era"===a?n[l]=o:ft(l)||(n[l]=parseInt(o,10))}return n}(n,t):function(e,t){var r=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),i=n[1],s=n[2];return[n[3],i,s,n[4],n[5],n[6],n[7]]}(n,t),s=i[0],a=i[1],o=i[2],l=i[3],u=i[4],c=i[5],d=i[6];"BC"===l&&(s=1-Math.abs(s));var h=+t,p=h%1e3;return(Dt({year:s,month:a,day:o,hour:24===u?0:u,minute:c,second:d,millisecond:0})-(h-=p>=0?p:1e3+p))/6e4},r.equals=function(e){return"iana"===e.type&&e.name===this.name},x(t,[{key:"type",get:function(){return"iana"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return this.valid}}]),t}(ye),we=["base"],ke=["padTo","floor"],Se={};var Fe={};function xe(e,t){void 0===t&&(t={});var r=JSON.stringify([e,t]),n=Fe[r];return n||(n=new Intl.DateTimeFormat(e,t),Fe[r]=n),n}var Ce={};var De={};var Me=null;var Le={};function Ve(e,t,r,n){var i=e.listingMode();return"error"===i?null:"en"===i?r(t):n(t)}var Ae=function(){function e(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;var n=$(r,ke);if(!t||Object.keys(n).length>0){var i=C({useGrouping:!1},r);r.padTo>0&&(i.minimumIntegerDigits=r.padTo),this.inf=function(e,t){void 0===t&&(t={});var r=JSON.stringify([e,t]),n=Ce[r];return n||(n=new Intl.NumberFormat(e,t),Ce[r]=n),n}(e,i)}}return e.prototype.format=function(e){if(this.inf){var t=this.floor?Math.floor(e):e;return this.inf.format(t)}return Nt(this.floor?Math.floor(e):St(e,3),this.padTo)},e}(),$e=function(){function e(e,t,r){this.opts=r,this.originalZone=void 0;var n=void 0;if(this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){var i=e.offset/60*-1,s=i>=0?"Etc/GMT+"+i:"Etc/GMT"+i;0!==e.offset&&Ee.create(s).valid?(n=s,this.dt=e):(n="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);var a=C({},this.opts);a.timeZone=a.timeZone||n,this.dtf=xe(t,a)}var t=e.prototype;return t.format=function(){return this.originalZone?this.formatToParts().map((function(e){return e.value})).join(""):this.dtf.format(this.dt.toJSDate())},t.formatToParts=function(){var e=this,t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map((function(t){return"timeZoneName"===t.type?C({},t,{value:e.originalZone.offsetName(e.dt.ts,{locale:e.dt.locale,format:e.opts.timeZoneName})}):t})):t},t.resolvedOptions=function(){return this.dtf.resolvedOptions()},e}(),qe=function(){function e(e,t,r){this.opts=C({style:"long"},r),!t&&gt()&&(this.rtf=function(e,t){void 0===t&&(t={});var r=$(t,we),n=JSON.stringify([e,r]),i=De[n];return i||(i=new Intl.RelativeTimeFormat(e,t),De[n]=i),i}(e,r))}var t=e.prototype;return t.format=function(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,r,n){void 0===r&&(r="always");void 0===n&&(n=!1);var i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===r&&s){var a="days"===e;switch(t){case 1:return a?"tomorrow":"next "+i[e][0];case-1:return a?"yesterday":"last "+i[e][0];case 0:return a?"today":"this "+i[e][0]}}var o=Object.is(t,-0)||t<0,l=Math.abs(t),u=1===l,c=i[e],d=n?u?c[1]:c[2]||c[1]:u?i[e][0]:e;return o?l+" "+d+" ago":"in "+l+" "+d}(t,e,this.opts.numeric,"long"!==this.opts.style)},t.formatToParts=function(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]},e}(),Re={firstDay:1,minimalDays:4,weekend:[6,7]},Ue=function(){function e(e,t,r,n,i){var s=function(e){var t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));var r,n,i=e.indexOf("-u-");if(-1===i)return[e];try{r=xe(e).resolvedOptions(),n=e}catch(t){var s=e.substring(0,i);r=xe(s).resolvedOptions(),n=s}var a=r;return[n,a.numberingSystem,a.calendar]}(e),a=s[0],o=s[1],l=s[2];this.locale=a,this.numberingSystem=t||o||null,this.outputCalendar=r||l||null,this.weekSettings=n,this.intl=function(e,t,r){return r||t?(e.includes("-u-")||(e+="-u"),r&&(e+="-ca-"+r),t&&(e+="-nu-"+t),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}e.fromOpts=function(t){return e.create(t.locale,t.numberingSystem,t.outputCalendar,t.weekSettings,t.defaultToEN)},e.create=function(t,r,n,i,s){void 0===s&&(s=!1);var a=t||Qe.defaultLocale;return new e(a||(s?"en-US":Me||(Me=(new Intl.DateTimeFormat).resolvedOptions().locale)),r||Qe.defaultNumberingSystem,n||Qe.defaultOutputCalendar,bt(i)||Qe.defaultWeekSettings,a)},e.resetCache=function(){Me=null,Fe={},Ce={},De={}},e.fromObject=function(t){var r=void 0===t?{}:t,n=r.locale,i=r.numberingSystem,s=r.outputCalendar,a=r.weekSettings;return e.create(n,i,s,a)};var t=e.prototype;return t.listingMode=function(){var e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"},t.clone=function(t){return t&&0!==Object.getOwnPropertyNames(t).length?e.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,bt(t.weekSettings)||this.weekSettings,t.defaultToEN||!1):this},t.redefaultToEN=function(e){return void 0===e&&(e={}),this.clone(C({},e,{defaultToEN:!0}))},t.redefaultToSystem=function(e){return void 0===e&&(e={}),this.clone(C({},e,{defaultToEN:!1}))},t.months=function(e,t){var r=this;return void 0===t&&(t=!1),Ve(this,e,Zt,(function(){var n=t?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";return r.monthsCache[i][e]||(r.monthsCache[i][e]=function(e){for(var t=[],r=1;r<=12;r++){var n=Kn.utc(2009,r,1);t.push(e(n))}return t}((function(e){return r.extract(e,n,"month")}))),r.monthsCache[i][e]}))},t.weekdays=function(e,t){var r=this;return void 0===t&&(t=!1),Ve(this,e,zt,(function(){var n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},i=t?"format":"standalone";return r.weekdaysCache[i][e]||(r.weekdaysCache[i][e]=function(e){for(var t=[],r=1;r<=7;r++){var n=Kn.utc(2016,11,13+r);t.push(e(n))}return t}((function(e){return r.extract(e,n,"weekday")}))),r.weekdaysCache[i][e]}))},t.meridiems=function(){var e=this;return Ve(this,void 0,(function(){return Gt}),(function(){if(!e.meridiemCache){var t={hour:"numeric",hourCycle:"h12"};e.meridiemCache=[Kn.utc(2016,11,13,9),Kn.utc(2016,11,13,19)].map((function(r){return e.extract(r,t,"dayperiod")}))}return e.meridiemCache}))},t.eras=function(e){var t=this;return Ve(this,e,Xt,(function(){var r={era:e};return t.eraCache[e]||(t.eraCache[e]=[Kn.utc(-40,1,1),Kn.utc(2017,1,1)].map((function(e){return t.extract(e,r,"era")}))),t.eraCache[e]}))},t.extract=function(e,t,r){var n=this.dtFormatter(e,t).formatToParts().find((function(e){return e.type.toLowerCase()===r}));return n?n.value:null},t.numberFormatter=function(e){return void 0===e&&(e={}),new Ae(this.intl,e.forceSimple||this.fastNumbers,e)},t.dtFormatter=function(e,t){return void 0===t&&(t={}),new $e(e,this.intl,t)},t.relFormatter=function(e){return void 0===e&&(e={}),new qe(this.intl,this.isEnglish(),e)},t.listFormatter=function(e){return void 0===e&&(e={}),function(e,t){void 0===t&&(t={});var r=JSON.stringify([e,t]),n=Se[r];return n||(n=new Intl.ListFormat(e,t),Se[r]=n),n}(this.intl,e)},t.isEnglish=function(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")},t.getWeekSettings=function(){return this.weekSettings?this.weekSettings:yt()?function(e){var t=Le[e];if(!t){var r=new Intl.Locale(e);t="getWeekInfo"in r?r.getWeekInfo():r.weekInfo,Le[e]=t}return t}(this.locale):Re},t.getStartOfWeek=function(){return this.getWeekSettings().firstDay},t.getMinDaysInFirstWeek=function(){return this.getWeekSettings().minimalDays},t.getWeekendDays=function(){return this.getWeekSettings().weekend},t.equals=function(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar},x(e,[{key:"fastNumbers",get:function(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}}]),e}(),Be=null,Pe=function(e){function t(t){var r;return(r=e.call(this)||this).fixed=t,r}D(t,e),t.instance=function(e){return 0===e?t.utcInstance:new t(e)},t.parseSpecifier=function(e){if(e){var r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new t($t(r[1],r[2]))}return null};var r=t.prototype;return r.offsetName=function(){return this.name},r.formatOffset=function(e,t){return Ut(this.fixed,t)},r.offset=function(){return this.fixed},r.equals=function(e){return"fixed"===e.type&&e.fixed===this.fixed},x(t,[{key:"type",get:function(){return"fixed"}},{key:"name",get:function(){return 0===this.fixed?"UTC":"UTC"+Ut(this.fixed,"narrow")}},{key:"ianaName",get:function(){return 0===this.fixed?"Etc/UTC":"Etc/GMT"+Ut(-this.fixed,"narrow")}},{key:"isUniversal",get:function(){return!0}},{key:"isValid",get:function(){return!0}}],[{key:"utcInstance",get:function(){return null===Be&&(Be=new t(0)),Be}}]),t}(ye),je=function(e){function t(t){var r;return(r=e.call(this)||this).zoneName=t,r}D(t,e);var r=t.prototype;return r.offsetName=function(){return null},r.formatOffset=function(){return""},r.offset=function(){return NaN},r.equals=function(){return!1},x(t,[{key:"type",get:function(){return"invalid"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!1}}]),t}(ye);function We(e,t){if(ft(e)||null===e)return t;if(e instanceof ye)return e;if("string"==typeof e){var r=e.toLowerCase();return"default"===r?t:"local"===r||"system"===r?Ie.instance:"utc"===r||"gmt"===r?Pe.utcInstance:Pe.parseSpecifier(r)||Ee.create(e)}return mt(e)?Pe.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new je(e)}var Ze,_e=function(){return Date.now()},He="system",Ye=null,ze=null,Ge=null,Je=60,Ke=null,Qe=function(){function e(){}return e.resetCaches=function(){Ue.resetCache(),Ee.resetCache()},x(e,null,[{key:"now",get:function(){return _e},set:function(e){_e=e}},{key:"defaultZone",get:function(){return We(He,Ie.instance)},set:function(e){He=e}},{key:"defaultLocale",get:function(){return Ye},set:function(e){Ye=e}},{key:"defaultNumberingSystem",get:function(){return ze},set:function(e){ze=e}},{key:"defaultOutputCalendar",get:function(){return Ge},set:function(e){Ge=e}},{key:"defaultWeekSettings",get:function(){return Ke},set:function(e){Ke=bt(e)}},{key:"twoDigitCutoffYear",get:function(){return Je},set:function(e){Je=e%100}},{key:"throwOnInvalid",get:function(){return Ze},set:function(e){Ze=e}}]),e}(),Xe=function(){function e(e,t){this.reason=e,this.explanation=t}return e.prototype.toMessage=function(){return this.explanation?this.reason+": "+this.explanation:this.reason},e}(),et=[0,31,59,90,120,151,181,212,243,273,304,334],tt=[0,31,60,91,121,152,182,213,244,274,305,335];function rt(e,t){return new Xe("unit out of range","you specified "+t+" (of type "+typeof t+") as a "+e+", which is invalid")}function nt(e,t,r){var n=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&n.setUTCFullYear(n.getUTCFullYear()-1900);var i=n.getUTCDay();return 0===i?7:i}function it(e,t,r){return r+(Ft(e)?tt:et)[t-1]}function st(e,t){var r=Ft(e)?tt:et,n=r.findIndex((function(e){return e<t}));return{month:n+1,day:t-r[n]}}function at(e,t){return(e-t+7)%7+1}function ot(e,t,r){void 0===t&&(t=4),void 0===r&&(r=1);var n,i=e.year,s=e.month,a=e.day,o=it(i,s,a),l=at(nt(i,s,a),r),u=Math.floor((o-l+14-t)/7);return u<1?u=Lt(n=i-1,t,r):u>Lt(i,t,r)?(n=i+1,u=1):n=i,C({weekYear:n,weekNumber:u,weekday:l},Bt(e))}function lt(e,t,r){void 0===t&&(t=4),void 0===r&&(r=1);var n,i=e.weekYear,s=e.weekNumber,a=e.weekday,o=at(nt(i,1,t),r),l=xt(i),u=7*s+a-o-7+t;u<1?u+=xt(n=i-1):u>l?(n=i+1,u-=xt(i)):n=i;var c=st(n,u);return C({year:n,month:c.month,day:c.day},Bt(e))}function ut(e){var t=e.year;return C({year:t,ordinal:it(t,e.month,e.day)},Bt(e))}function ct(e){var t=e.year,r=st(t,e.ordinal);return C({year:t,month:r.month,day:r.day},Bt(e))}function dt(e,t){if(!ft(e.localWeekday)||!ft(e.localWeekNumber)||!ft(e.localWeekYear)){if(!ft(e.weekday)||!ft(e.weekNumber)||!ft(e.weekYear))throw new W("Cannot mix locale-based week fields with ISO-based week fields");return ft(e.localWeekday)||(e.weekday=e.localWeekday),ft(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),ft(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function ht(e){var t=vt(e.year),r=Tt(e.month,1,12),n=Tt(e.day,1,Ct(e.year,e.month));return t?r?!n&&rt("day",e.day):rt("month",e.month):rt("year",e.year)}function pt(e){var t=e.hour,r=e.minute,n=e.second,i=e.millisecond,s=Tt(t,0,23)||24===t&&0===r&&0===n&&0===i,a=Tt(r,0,59),o=Tt(n,0,59),l=Tt(i,0,999);return s?a?o?!l&&rt("millisecond",i):rt("second",n):rt("minute",r):rt("hour",t)}function ft(e){return void 0===e}function mt(e){return"number"==typeof e}function vt(e){return"number"==typeof e&&e%1==0}function gt(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function yt(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function Ot(e,t,r){if(0!==e.length)return e.reduce((function(e,n){var i=[t(n),n];return e&&r(e[0],i[0])===e[0]?e:i}),null)[1]}function It(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function bt(e){if(null==e)return null;if("object"!=typeof e)throw new _("Week settings must be an object");if(!Tt(e.firstDay,1,7)||!Tt(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((function(e){return!Tt(e,1,7)})))throw new _("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function Tt(e,t,r){return vt(e)&&e>=t&&e<=r}function Nt(e,t){return void 0===t&&(t=2),e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0")}function Et(e){return ft(e)||null===e||""===e?void 0:parseInt(e,10)}function wt(e){return ft(e)||null===e||""===e?void 0:parseFloat(e)}function kt(e){if(!ft(e)&&null!==e&&""!==e){var t=1e3*parseFloat("0."+e);return Math.floor(t)}}function St(e,t,r){void 0===r&&(r=!1);var n=Math.pow(10,t);return(r?Math.trunc:Math.round)(e*n)/n}function Ft(e){return e%4==0&&(e%100!=0||e%400==0)}function xt(e){return Ft(e)?366:365}function Ct(e,t){var r=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===r?Ft(e+(t-r)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Dt(e){var t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t)).setUTCFullYear(e.year,e.month-1,e.day),+t}function Mt(e,t,r){return-at(nt(e,1,t),r)+t-1}function Lt(e,t,r){void 0===t&&(t=4),void 0===r&&(r=1);var n=Mt(e,t,r),i=Mt(e+1,t,r);return(xt(e)-n+i)/7}function Vt(e){return e>99?e:e>Qe.twoDigitCutoffYear?1900+e:2e3+e}function At(e,t,r,n){void 0===n&&(n=null);var i=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};n&&(s.timeZone=n);var a=C({timeZoneName:t},s),o=new Intl.DateTimeFormat(r,a).formatToParts(i).find((function(e){return"timezonename"===e.type.toLowerCase()}));return o?o.value:null}function $t(e,t){var r=parseInt(e,10);Number.isNaN(r)&&(r=0);var n=parseInt(t,10)||0;return 60*r+(r<0||Object.is(r,-0)?-n:n)}function qt(e){var t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new _("Invalid unit value "+e);return t}function Rt(e,t){var r={};for(var n in e)if(It(e,n)){var i=e[n];if(null==i)continue;r[t(n)]=qt(i)}return r}function Ut(e,t){var r=Math.trunc(Math.abs(e/60)),n=Math.trunc(Math.abs(e%60)),i=e>=0?"+":"-";switch(t){case"short":return""+i+Nt(r,2)+":"+Nt(n,2);case"narrow":return""+i+r+(n>0?":"+n:"");case"techie":return""+i+Nt(r,2)+Nt(n,2);default:throw new RangeError("Value format "+t+" is out of range for property format")}}function Bt(e){return function(e,t){return t.reduce((function(t,r){return t[r]=e[r],t}),{})}(e,["hour","minute","second","millisecond"])}var Pt=["January","February","March","April","May","June","July","August","September","October","November","December"],jt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Wt=["J","F","M","A","M","J","J","A","S","O","N","D"];function Zt(e){switch(e){case"narrow":return[].concat(Wt);case"short":return[].concat(jt);case"long":return[].concat(Pt);case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var _t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ht=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Yt=["M","T","W","T","F","S","S"];function zt(e){switch(e){case"narrow":return[].concat(Yt);case"short":return[].concat(Ht);case"long":return[].concat(_t);case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Gt=["AM","PM"],Jt=["Before Christ","Anno Domini"],Kt=["BC","AD"],Qt=["B","A"];function Xt(e){switch(e){case"narrow":return[].concat(Qt);case"short":return[].concat(Kt);case"long":return[].concat(Jt);default:return null}}function er(e,t){for(var r,n="",i=R(e);!(r=i()).done;){var s=r.value;s.literal?n+=s.val:n+=t(s.val)}return n}var tr={D:J,DD:K,DDD:X,DDDD:ee,t:te,tt:re,ttt:ne,tttt:ie,T:se,TT:ae,TTT:oe,TTTT:le,f:ue,ff:de,fff:fe,ffff:ve,F:ce,FF:he,FFF:me,FFFF:ge},rr=function(){function e(e,t){this.opts=t,this.loc=e,this.systemLoc=null}e.create=function(t,r){return void 0===r&&(r={}),new e(t,r)},e.parseFormat=function(e){for(var t=null,r="",n=!1,i=[],s=0;s<e.length;s++){var a=e.charAt(s);"'"===a?(r.length>0&&i.push({literal:n||/^\s+$/.test(r),val:r}),t=null,r="",n=!n):n||a===t?r+=a:(r.length>0&&i.push({literal:/^\s+$/.test(r),val:r}),r=a,t=a)}return r.length>0&&i.push({literal:n||/^\s+$/.test(r),val:r}),i},e.macroTokenToFormatOpts=function(e){return tr[e]};var t=e.prototype;return t.formatWithSystemDefault=function(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,C({},this.opts,t)).format()},t.dtFormatter=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,C({},this.opts,t))},t.formatDateTime=function(e,t){return this.dtFormatter(e,t).format()},t.formatDateTimeParts=function(e,t){return this.dtFormatter(e,t).formatToParts()},t.formatInterval=function(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())},t.resolvedOptions=function(e,t){return this.dtFormatter(e,t).resolvedOptions()},t.num=function(e,t){if(void 0===t&&(t=0),this.opts.forceSimple)return Nt(e,t);var r=C({},this.opts);return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)},t.formatDateTimeFromString=function(t,r){var n=this,i="en"===this.loc.listingMode(),s=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,a=function(e,r){return n.loc.extract(t,e,r)},o=function(e){return t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):""},l=function(){return i?function(e){return Gt[e.hour<12?0:1]}(t):a({hour:"numeric",hourCycle:"h12"},"dayperiod")},u=function(e,r){return i?function(e,t){return Zt(t)[e.month-1]}(t,e):a(r?{month:e}:{month:e,day:"numeric"},"month")},c=function(e,r){return i?function(e,t){return zt(t)[e.weekday-1]}(t,e):a(r?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday")},d=function(e){return i?function(e,t){return Xt(t)[e.year<0?0:1]}(t,e):a({era:e},"era")};return er(e.parseFormat(r),(function(r){switch(r){case"S":return n.num(t.millisecond);case"u":case"SSS":return n.num(t.millisecond,3);case"s":return n.num(t.second);case"ss":return n.num(t.second,2);case"uu":return n.num(Math.floor(t.millisecond/10),2);case"uuu":return n.num(Math.floor(t.millisecond/100));case"m":return n.num(t.minute);case"mm":return n.num(t.minute,2);case"h":return n.num(t.hour%12==0?12:t.hour%12);case"hh":return n.num(t.hour%12==0?12:t.hour%12,2);case"H":return n.num(t.hour);case"HH":return n.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:n.opts.allowZ});case"ZZ":return o({format:"short",allowZ:n.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:n.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:n.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:n.loc.locale});case"z":return t.zoneName;case"a":return l();case"d":return s?a({day:"numeric"},"day"):n.num(t.day);case"dd":return s?a({day:"2-digit"},"day"):n.num(t.day,2);case"c":case"E":return n.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?a({month:"numeric",day:"numeric"},"month"):n.num(t.month);case"LL":return s?a({month:"2-digit",day:"numeric"},"month"):n.num(t.month,2);case"LLL":return u("short",!0);case"LLLL":return u("long",!0);case"LLLLL":return u("narrow",!0);case"M":return s?a({month:"numeric"},"month"):n.num(t.month);case"MM":return s?a({month:"2-digit"},"month"):n.num(t.month,2);case"MMM":return u("short",!1);case"MMMM":return u("long",!1);case"MMMMM":return u("narrow",!1);case"y":return s?a({year:"numeric"},"year"):n.num(t.year);case"yy":return s?a({year:"2-digit"},"year"):n.num(t.year.toString().slice(-2),2);case"yyyy":return s?a({year:"numeric"},"year"):n.num(t.year,4);case"yyyyyy":return s?a({year:"numeric"},"year"):n.num(t.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return n.num(t.weekYear.toString().slice(-2),2);case"kkkk":return n.num(t.weekYear,4);case"W":return n.num(t.weekNumber);case"WW":return n.num(t.weekNumber,2);case"n":return n.num(t.localWeekNumber);case"nn":return n.num(t.localWeekNumber,2);case"ii":return n.num(t.localWeekYear.toString().slice(-2),2);case"iiii":return n.num(t.localWeekYear,4);case"o":return n.num(t.ordinal);case"ooo":return n.num(t.ordinal,3);case"q":return n.num(t.quarter);case"qq":return n.num(t.quarter,2);case"X":return n.num(Math.floor(t.ts/1e3));case"x":return n.num(t.ts);default:return function(r){var i=e.macroTokenToFormatOpts(r);return i?n.formatWithSystemDefault(t,i):r}(r)}}))},t.formatDurationFromString=function(t,r){var n,i=this,s=function(e){switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},a=e.parseFormat(r),o=a.reduce((function(e,t){var r=t.literal,n=t.val;return r?e:e.concat(n)}),[]),l=t.shiftTo.apply(t,o.map(s).filter((function(e){return e})));return er(a,(n=l,function(e){var t=s(e);return t?i.num(n.get(t),e.length):e}))},e}(),nr=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function ir(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.reduce((function(e,t){return e+t.source}),"");return RegExp("^"+n+"$")}function sr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduce((function(t,r){var n=t[0],i=t[1],s=t[2],a=r(e,s),o=a[0],l=a[1],u=a[2];return[C({},n,o),l||i,u]}),[{},null,1]).slice(0,2)}}function ar(e){if(null==e)return[null,null];for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=0,s=r;i<s.length;i++){var a=s[i],o=a[0],l=a[1],u=o.exec(e);if(u)return l(u)}return[null,null]}function or(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r){var n,i={};for(n=0;n<t.length;n++)i[t[n]]=Et(e[r+n]);return[i,null,r+n]}}var lr=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,ur=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,cr=RegExp(""+ur.source+("(?:"+lr.source+"?(?:\\[("+nr.source+")\\])?)?")),dr=RegExp("(?:T"+cr.source+")?"),hr=or("weekYear","weekNumber","weekDay"),pr=or("year","ordinal"),fr=RegExp(ur.source+" ?(?:"+lr.source+"|("+nr.source+"))?"),mr=RegExp("(?: "+fr.source+")?");function vr(e,t,r){var n=e[t];return ft(n)?r:Et(n)}function gr(e,t){return[{hours:vr(e,t,0),minutes:vr(e,t+1,0),seconds:vr(e,t+2,0),milliseconds:kt(e[t+3])},null,t+4]}function yr(e,t){var r=!e[t]&&!e[t+1],n=$t(e[t+1],e[t+2]);return[{},r?null:Pe.instance(n),t+3]}function Or(e,t){return[{},e[t]?Ee.create(e[t]):null,t+1]}var Ir=RegExp("^T?"+ur.source+"$"),br=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Tr(e){var t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c="-"===t[0],d=l&&"-"===l[0],h=function(e,t){return void 0===t&&(t=!1),void 0!==e&&(t||e&&c)?-e:e};return[{years:h(wt(r)),months:h(wt(n)),weeks:h(wt(i)),days:h(wt(s)),hours:h(wt(a)),minutes:h(wt(o)),seconds:h(wt(l),"-0"===l),milliseconds:h(kt(u),d)}]}var Nr={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Er(e,t,r,n,i,s,a){var o={year:2===t.length?Vt(Et(t)):Et(t),month:jt.indexOf(r)+1,day:Et(n),hour:Et(i),minute:Et(s)};return a&&(o.second=Et(a)),e&&(o.weekday=e.length>3?_t.indexOf(e)+1:Ht.indexOf(e)+1),o}var wr=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function kr(e){var t,r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=Er(r,s,i,n,a,o,l);return t=u?Nr[u]:c?0:$t(d,h),[p,new Pe(t)]}var Sr=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Fr=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,xr=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Cr(e){var t=e[1],r=e[2],n=e[3];return[Er(t,e[4],n,r,e[5],e[6],e[7]),Pe.utcInstance]}function Dr(e){var t=e[1],r=e[2],n=e[3],i=e[4],s=e[5],a=e[6];return[Er(t,e[7],r,n,i,s,a),Pe.utcInstance]}var Mr=ir(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,dr),Lr=ir(/(\d{4})-?W(\d\d)(?:-?(\d))?/,dr),Vr=ir(/(\d{4})-?(\d{3})/,dr),Ar=ir(cr),$r=sr((function(e,t){return[{year:vr(e,t),month:vr(e,t+1,1),day:vr(e,t+2,1)},null,t+3]}),gr,yr,Or),qr=sr(hr,gr,yr,Or),Rr=sr(pr,gr,yr,Or),Ur=sr(gr,yr,Or);var Br=sr(gr);var Pr=ir(/(\d{4})-(\d\d)-(\d\d)/,mr),jr=ir(fr),Wr=sr(gr,yr,Or);var Zr="Invalid Duration",_r={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Hr=C({years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},_r),Yr=365.2425,zr=30.436875,Gr=C({years:{quarters:4,months:12,weeks:52.1775,days:Yr,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:zr,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3}},_r),Jr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Kr=Jr.slice(0).reverse();function Qr(e,t,r){void 0===r&&(r=!1);var n={values:r?t.values:C({},e.values,t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new tn(n)}function Xr(e,t){for(var r,n,i=null!=(r=t.milliseconds)?r:0,s=R(Kr.slice(1));!(n=s()).done;){var a=n.value;t[a]&&(i+=t[a]*e[a].milliseconds)}return i}function en(e,t){var r=Xr(e,t)<0?-1:1;Jr.reduceRight((function(n,i){if(ft(t[i]))return n;if(n){var s=t[n]*r,a=e[i][n],o=Math.floor(s/a);t[i]+=o*r,t[n]-=o*a*r}return i}),null),Jr.reduce((function(r,n){if(ft(t[n]))return r;if(r){var i=t[r]%1;t[r]-=i,t[n]+=i*e[r][n]}return n}),null)}var tn=function(e){function t(e){var t="longterm"===e.conversionAccuracy||!1,r=t?Gr:Hr;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Ue.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}t.fromMillis=function(e,r){return t.fromObject({milliseconds:e},r)},t.fromObject=function(e,r){if(void 0===r&&(r={}),null==e||"object"!=typeof e)throw new _("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new t({values:Rt(e,t.normalizeUnit),loc:Ue.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})},t.fromDurationLike=function(e){if(mt(e))return t.fromMillis(e);if(t.isDuration(e))return e;if("object"==typeof e)return t.fromObject(e);throw new _("Unknown duration argument "+e+" of type "+typeof e)},t.fromISO=function(e,r){var n=function(e){return ar(e,[br,Tr])}(e),i=n[0];return i?t.fromObject(i,r):t.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")},t.fromISOTime=function(e,r){var n=function(e){return ar(e,[Ir,Br])}(e),i=n[0];return i?t.fromObject(i,r):t.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")},t.invalid=function(e,r){if(void 0===r&&(r=null),!e)throw new _("need to specify a reason the Duration is invalid");var n=e instanceof Xe?e:new Xe(e,r);if(Qe.throwOnInvalid)throw new j(n);return new t({invalid:n})},t.normalizeUnit=function(e){var t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new Z(e);return t},t.isDuration=function(e){return e&&e.isLuxonDuration||!1};var r=t.prototype;return r.toFormat=function(e,t){void 0===t&&(t={});var r=C({},t,{floor:!1!==t.round&&!1!==t.floor});return this.isValid?rr.create(this.loc,r).formatDurationFromString(this,e):Zr},r.toHuman=function(e){var t=this;if(void 0===e&&(e={}),!this.isValid)return Zr;var r=Jr.map((function(r){var n=t.values[r];return ft(n)?null:t.loc.numberFormatter(C({style:"unit",unitDisplay:"long"},e,{unit:r.slice(0,-1)})).format(n)})).filter((function(e){return e}));return this.loc.listFormatter(C({type:"conjunction",style:e.listStyle||"narrow"},e)).format(r)},r.toObject=function(){return this.isValid?C({},this.values):{}},r.toISO=function(){if(!this.isValid)return null;var e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=St(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e},r.toISOTime=function(e){if(void 0===e&&(e={}),!this.isValid)return null;var t=this.toMillis();return t<0||t>=864e5?null:(e=C({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e,{includeOffset:!1}),Kn.fromMillis(t,{zone:"UTC"}).toISOTime(e))},r.toJSON=function(){return this.toISO()},r.toString=function(){return this.toISO()},r[e]=function(){return this.isValid?"Duration { values: "+JSON.stringify(this.values)+" }":"Duration { Invalid, reason: "+this.invalidReason+" }"},r.toMillis=function(){return this.isValid?Xr(this.matrix,this.values):NaN},r.valueOf=function(){return this.toMillis()},r.plus=function(e){if(!this.isValid)return this;for(var r=t.fromDurationLike(e),n={},i=0,s=Jr;i<s.length;i++){var a=s[i];(It(r.values,a)||It(this.values,a))&&(n[a]=r.get(a)+this.get(a))}return Qr(this,{values:n},!0)},r.minus=function(e){if(!this.isValid)return this;var r=t.fromDurationLike(e);return this.plus(r.negate())},r.mapUnits=function(e){if(!this.isValid)return this;for(var t={},r=0,n=Object.keys(this.values);r<n.length;r++){var i=n[r];t[i]=qt(e(this.values[i],i))}return Qr(this,{values:t},!0)},r.get=function(e){return this[t.normalizeUnit(e)]},r.set=function(e){return this.isValid?Qr(this,{values:C({},this.values,Rt(e,t.normalizeUnit))}):this},r.reconfigure=function(e){var t=void 0===e?{}:e,r=t.locale,n=t.numberingSystem,i=t.conversionAccuracy,s=t.matrix;return Qr(this,{loc:this.loc.clone({locale:r,numberingSystem:n}),matrix:s,conversionAccuracy:i})},r.as=function(e){return this.isValid?this.shiftTo(e).get(e):NaN},r.normalize=function(){if(!this.isValid)return this;var e=this.toObject();return en(this.matrix,e),Qr(this,{values:e},!0)},r.rescale=function(){return this.isValid?Qr(this,{values:function(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var i=n[r],s=i[0],a=i[1];0!==a&&(t[s]=a)}return t}(this.normalize().shiftToAll().toObject())},!0):this},r.shiftTo=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!this.isValid)return this;if(0===r.length)return this;r=r.map((function(e){return t.normalizeUnit(e)}));for(var i,s={},a={},o=this.toObject(),l=0,u=Jr;l<u.length;l++){var c=u[l];if(r.indexOf(c)>=0){i=c;var d=0;for(var h in a)d+=this.matrix[h][c]*a[h],a[h]=0;mt(o[c])&&(d+=o[c]);var p=Math.trunc(d);s[c]=p,a[c]=(1e3*d-1e3*p)/1e3}else mt(o[c])&&(a[c]=o[c])}for(var f in a)0!==a[f]&&(s[i]+=f===i?a[f]:a[f]/this.matrix[i][f]);return en(this.matrix,s),Qr(this,{values:s},!0)},r.shiftToAll=function(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this},r.negate=function(){if(!this.isValid)return this;for(var e={},t=0,r=Object.keys(this.values);t<r.length;t++){var n=r[t];e[n]=0===this.values[n]?0:-this.values[n]}return Qr(this,{values:e},!0)},r.equals=function(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(var t=0,r=Jr;t<r.length;t++){var n=r[t];if(i=this.values[n],s=e.values[n],!(void 0===i||0===i?void 0===s||0===s:i===s))return!1}var i,s;return!0},x(t,[{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"years",get:function(){return this.isValid?this.values.years||0:NaN}},{key:"quarters",get:function(){return this.isValid?this.values.quarters||0:NaN}},{key:"months",get:function(){return this.isValid?this.values.months||0:NaN}},{key:"weeks",get:function(){return this.isValid?this.values.weeks||0:NaN}},{key:"days",get:function(){return this.isValid?this.values.days||0:NaN}},{key:"hours",get:function(){return this.isValid?this.values.hours||0:NaN}},{key:"minutes",get:function(){return this.isValid?this.values.minutes||0:NaN}},{key:"seconds",get:function(){return this.isValid?this.values.seconds||0:NaN}},{key:"milliseconds",get:function(){return this.isValid?this.values.milliseconds||0:NaN}},{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),t}(Symbol.for("nodejs.util.inspect.custom")),rn="Invalid Interval";function nn(e,t){return e&&e.isValid?t&&t.isValid?t<e?sn.invalid("end before start","The end of an interval must be after its start, but you had start="+e.toISO()+" and end="+t.toISO()):null:sn.invalid("missing or invalid end"):sn.invalid("missing or invalid start")}var sn=function(e){function t(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}t.invalid=function(e,r){if(void 0===r&&(r=null),!e)throw new _("need to specify a reason the Interval is invalid");var n=e instanceof Xe?e:new Xe(e,r);if(Qe.throwOnInvalid)throw new P(n);return new t({invalid:n})},t.fromDateTimes=function(e,r){var n=Qn(e),i=Qn(r),s=nn(n,i);return null==s?new t({start:n,end:i}):s},t.after=function(e,r){var n=tn.fromDurationLike(r),i=Qn(e);return t.fromDateTimes(i,i.plus(n))},t.before=function(e,r){var n=tn.fromDurationLike(r),i=Qn(e);return t.fromDateTimes(i.minus(n),i)},t.fromISO=function(e,r){var n=(e||"").split("/",2),i=n[0],s=n[1];if(i&&s){var a,o,l,u;try{o=(a=Kn.fromISO(i,r)).isValid}catch(s){o=!1}try{u=(l=Kn.fromISO(s,r)).isValid}catch(s){u=!1}if(o&&u)return t.fromDateTimes(a,l);if(o){var c=tn.fromISO(s,r);if(c.isValid)return t.after(a,c)}else if(u){var d=tn.fromISO(i,r);if(d.isValid)return t.before(l,d)}}return t.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")},t.isInterval=function(e){return e&&e.isLuxonInterval||!1};var r=t.prototype;return r.length=function(e){return void 0===e&&(e="milliseconds"),this.isValid?this.toDuration.apply(this,[e]).get(e):NaN},r.count=function(e,t){if(void 0===e&&(e="milliseconds"),!this.isValid)return NaN;var r,n=this.start.startOf(e,t);return r=(r=null!=t&&t.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end).startOf(e,t),Math.floor(r.diff(n,e).get(e))+(r.valueOf()!==this.end.valueOf())},r.hasSame=function(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))},r.isEmpty=function(){return this.s.valueOf()===this.e.valueOf()},r.isAfter=function(e){return!!this.isValid&&this.s>e},r.isBefore=function(e){return!!this.isValid&&this.e<=e},r.contains=function(e){return!!this.isValid&&(this.s<=e&&this.e>e)},r.set=function(e){var r=void 0===e?{}:e,n=r.start,i=r.end;return this.isValid?t.fromDateTimes(n||this.s,i||this.e):this},r.splitAt=function(){var e=this;if(!this.isValid)return[];for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var s=n.map(Qn).filter((function(t){return e.contains(t)})).sort((function(e,t){return e.toMillis()-t.toMillis()})),a=[],o=this.s,l=0;o<this.e;){var u=s[l]||this.e,c=+u>+this.e?this.e:u;a.push(t.fromDateTimes(o,c)),o=c,l+=1}return a},r.splitBy=function(e){var r=tn.fromDurationLike(e);if(!this.isValid||!r.isValid||0===r.as("milliseconds"))return[];for(var n,i=this.s,s=1,a=[];i<this.e;){var o=this.start.plus(r.mapUnits((function(e){return e*s})));n=+o>+this.e?this.e:o,a.push(t.fromDateTimes(i,n)),i=n,s+=1}return a},r.divideEqually=function(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]},r.overlaps=function(e){return this.e>e.s&&this.s<e.e},r.abutsStart=function(e){return!!this.isValid&&+this.e==+e.s},r.abutsEnd=function(e){return!!this.isValid&&+e.e==+this.s},r.engulfs=function(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)},r.equals=function(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))},r.intersection=function(e){if(!this.isValid)return this;var r=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return r>=n?null:t.fromDateTimes(r,n)},r.union=function(e){if(!this.isValid)return this;var r=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return t.fromDateTimes(r,n)},t.merge=function(e){var t=e.sort((function(e,t){return e.s-t.s})).reduce((function(e,t){var r=e[0],n=e[1];return n?n.overlaps(t)||n.abutsStart(t)?[r,n.union(t)]:[r.concat([n]),t]:[r,t]}),[[],null]),r=t[0],n=t[1];return n&&r.push(n),r},t.xor=function(e){for(var r,n,i=null,s=0,a=[],o=e.map((function(e){return[{time:e.s,type:"s"},{time:e.e,type:"e"}]})),l=R((r=Array.prototype).concat.apply(r,o).sort((function(e,t){return e.time-t.time})));!(n=l()).done;){var u=n.value;1===(s+="s"===u.type?1:-1)?i=u.time:(i&&+i!=+u.time&&a.push(t.fromDateTimes(i,u.time)),i=null)}return t.merge(a)},r.difference=function(){for(var e=this,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return t.xor([this].concat(n)).map((function(t){return e.intersection(t)})).filter((function(e){return e&&!e.isEmpty()}))},r.toString=function(){return this.isValid?"["+this.s.toISO()+" \u2013 "+this.e.toISO()+")":rn},r[e]=function(){return this.isValid?"Interval { start: "+this.s.toISO()+", end: "+this.e.toISO()+" }":"Interval { Invalid, reason: "+this.invalidReason+" }"},r.toLocaleString=function(e,t){return void 0===e&&(e=J),void 0===t&&(t={}),this.isValid?rr.create(this.s.loc.clone(t),e).formatInterval(this):rn},r.toISO=function(e){return this.isValid?this.s.toISO(e)+"/"+this.e.toISO(e):rn},r.toISODate=function(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():rn},r.toISOTime=function(e){return this.isValid?this.s.toISOTime(e)+"/"+this.e.toISOTime(e):rn},r.toFormat=function(e,t){var r=(void 0===t?{}:t).separator,n=void 0===r?" \u2013 ":r;return this.isValid?""+this.s.toFormat(e)+n+this.e.toFormat(e):rn},r.toDuration=function(e,t){return this.isValid?this.e.diff(this.s,e,t):tn.invalid(this.invalidReason)},r.mapEndpoints=function(e){return t.fromDateTimes(e(this.s),e(this.e))},x(t,[{key:"start",get:function(){return this.isValid?this.s:null}},{key:"end",get:function(){return this.isValid?this.e:null}},{key:"isValid",get:function(){return null===this.invalidReason}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),t}(Symbol.for("nodejs.util.inspect.custom")),an=function(){function e(){}return e.hasDST=function(e){void 0===e&&(e=Qe.defaultZone);var t=Kn.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset},e.isValidIANAZone=function(e){return Ee.isValidZone(e)},e.normalizeZone=function(e){return We(e,Qe.defaultZone)},e.getStartOfWeek=function(e){var t=void 0===e?{}:e,r=t.locale,n=void 0===r?null:r,i=t.locObj;return((void 0===i?null:i)||Ue.create(n)).getStartOfWeek()},e.getMinimumDaysInFirstWeek=function(e){var t=void 0===e?{}:e,r=t.locale,n=void 0===r?null:r,i=t.locObj;return((void 0===i?null:i)||Ue.create(n)).getMinDaysInFirstWeek()},e.getWeekendWeekdays=function(e){var t=void 0===e?{}:e,r=t.locale,n=void 0===r?null:r,i=t.locObj;return((void 0===i?null:i)||Ue.create(n)).getWeekendDays().slice()},e.months=function(e,t){void 0===e&&(e="long");var r=void 0===t?{}:t,n=r.locale,i=void 0===n?null:n,s=r.numberingSystem,a=void 0===s?null:s,o=r.locObj,l=void 0===o?null:o,u=r.outputCalendar,c=void 0===u?"gregory":u;return(l||Ue.create(i,a,c)).months(e)},e.monthsFormat=function(e,t){void 0===e&&(e="long");var r=void 0===t?{}:t,n=r.locale,i=void 0===n?null:n,s=r.numberingSystem,a=void 0===s?null:s,o=r.locObj,l=void 0===o?null:o,u=r.outputCalendar,c=void 0===u?"gregory":u;return(l||Ue.create(i,a,c)).months(e,!0)},e.weekdays=function(e,t){void 0===e&&(e="long");var r=void 0===t?{}:t,n=r.locale,i=void 0===n?null:n,s=r.numberingSystem,a=void 0===s?null:s,o=r.locObj;return((void 0===o?null:o)||Ue.create(i,a,null)).weekdays(e)},e.weekdaysFormat=function(e,t){void 0===e&&(e="long");var r=void 0===t?{}:t,n=r.locale,i=void 0===n?null:n,s=r.numberingSystem,a=void 0===s?null:s,o=r.locObj;return((void 0===o?null:o)||Ue.create(i,a,null)).weekdays(e,!0)},e.meridiems=function(e){var t=(void 0===e?{}:e).locale,r=void 0===t?null:t;return Ue.create(r).meridiems()},e.eras=function(e,t){void 0===e&&(e="short");var r=(void 0===t?{}:t).locale,n=void 0===r?null:r;return Ue.create(n,null,"gregory").eras(e)},e.features=function(){return{relative:gt(),localeWeek:yt()}},e}();function on(e,t){var r=function(e){return e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()},n=r(t)-r(e);return Math.floor(tn.fromMillis(n).as("days"))}function ln(e,t,r,n){var i=function(e,t,r){for(var n,i,s={},a=e,o=0,l=[["years",function(e,t){return t.year-e.year}],["quarters",function(e,t){return t.quarter-e.quarter+4*(t.year-e.year)}],["months",function(e,t){return t.month-e.month+12*(t.year-e.year)}],["weeks",function(e,t){var r=on(e,t);return(r-r%7)/7}],["days",on]];o<l.length;o++){var u=l[o],c=u[0],d=u[1];r.indexOf(c)>=0&&(n=c,s[c]=d(e,t),(i=a.plus(s))>t?(s[c]--,(e=a.plus(s))>t&&(i=e,s[c]--,e=a.plus(s))):e=i)}return[e,s,i,n]}(e,t,r),s=i[0],a=i[1],o=i[2],l=i[3],u=t-s,c=r.filter((function(e){return["hours","minutes","seconds","milliseconds"].indexOf(e)>=0}));if(0===c.length){var d;if(o<t)o=s.plus(((d={})[l]=1,d));o!==s&&(a[l]=(a[l]||0)+u/(o-s))}var h,p=tn.fromObject(a,n);return c.length>0?(h=tn.fromMillis(u,n)).shiftTo.apply(h,c).plus(p):p}var un={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},cn={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},dn=un.hanidec.replace(/[\[|\]]/g,"").split("");function hn(e,t){var r=e.numberingSystem;return void 0===t&&(t=""),new RegExp(""+un[r||"latn"]+t)}var pn="missing Intl.DateTimeFormat.formatToParts support";function fn(e,t){return void 0===t&&(t=function(e){return e}),{regex:e,deser:function(e){var r=e[0];return t(function(e){var t=parseInt(e,10);if(isNaN(t)){t="";for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(-1!==e[r].search(un.hanidec))t+=dn.indexOf(e[r]);else for(var i in cn){var s=cn[i],a=s[0],o=s[1];n>=a&&n<=o&&(t+=n-a)}}return parseInt(t,10)}return t}(r))}}}var mn="[ "+String.fromCharCode(160)+"]",vn=new RegExp(mn,"g");function gn(e){return e.replace(/\./g,"\\.?").replace(vn,mn)}function yn(e){return e.replace(/\./g,"").replace(vn," ").toLowerCase()}function On(e,t){return null===e?null:{regex:RegExp(e.map(gn).join("|")),deser:function(r){var n=r[0];return e.findIndex((function(e){return yn(n)===yn(e)}))+t}}}function In(e,t){return{regex:e,deser:function(e){return $t(e[1],e[2])},groups:t}}function bn(e){return{regex:e,deser:function(e){return e[0]}}}var Tn={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};var Nn=null;function En(e,t){var r;return(r=Array.prototype).concat.apply(r,e.map((function(e){return function(e,t){if(e.literal)return e;var r=kn(rr.macroTokenToFormatOpts(e.val),t);return null==r||r.includes(void 0)?e:r}(e,t)})))}function wn(e,t,r){var n=En(rr.parseFormat(r),e),i=n.map((function(t){return r=t,i=hn(n=e),s=hn(n,"{2}"),a=hn(n,"{3}"),o=hn(n,"{4}"),l=hn(n,"{6}"),u=hn(n,"{1,2}"),c=hn(n,"{1,3}"),d=hn(n,"{1,6}"),h=hn(n,"{1,9}"),p=hn(n,"{2,4}"),f=hn(n,"{4,6}"),m=function(e){return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:function(e){return e[0]},literal:!0};var t},v=function(e){if(r.literal)return m(e);switch(e.val){case"G":return On(n.eras("short"),0);case"GG":return On(n.eras("long"),0);case"y":return fn(d);case"yy":case"kk":return fn(p,Vt);case"yyyy":case"kkkk":return fn(o);case"yyyyy":return fn(f);case"yyyyyy":return fn(l);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return fn(u);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return fn(s);case"MMM":return On(n.months("short",!0),1);case"MMMM":return On(n.months("long",!0),1);case"LLL":return On(n.months("short",!1),1);case"LLLL":return On(n.months("long",!1),1);case"o":case"S":return fn(c);case"ooo":case"SSS":return fn(a);case"u":return bn(h);case"uu":return bn(u);case"uuu":case"E":case"c":return fn(i);case"a":return On(n.meridiems(),0);case"EEE":return On(n.weekdays("short",!1),1);case"EEEE":return On(n.weekdays("long",!1),1);case"ccc":return On(n.weekdays("short",!0),1);case"cccc":return On(n.weekdays("long",!0),1);case"Z":case"ZZ":return In(new RegExp("([+-]"+u.source+")(?::("+s.source+"))?"),2);case"ZZZ":return In(new RegExp("([+-]"+u.source+")("+s.source+")?"),2);case"z":return bn(/[a-z_+-/]{1,256}?/i);case" ":return bn(/[^\S\n\r]/);default:return m(e)}}(r)||{invalidReason:pn},v.token=r,v;var r,n,i,s,a,o,l,u,c,d,h,p,f,m,v})),s=i.find((function(e){return e.invalidReason}));if(s)return{input:t,tokens:n,invalidReason:s.invalidReason};var a=function(e){return["^"+e.map((function(e){return e.regex})).reduce((function(e,t){return e+"("+t.source+")"}),"")+"$",e]}(i),o=a[0],l=a[1],u=RegExp(o,"i"),c=function(e,t,r){var n=e.match(t);if(n){var i={},s=1;for(var a in r)if(It(r,a)){var o=r[a],l=o.groups?o.groups+1:1;!o.literal&&o.token&&(i[o.token.val[0]]=o.deser(n.slice(s,s+l))),s+=l}return[n,i]}return[n,{}]}(t,u,l),d=c[0],h=c[1],p=h?function(e){var t,r=null;return ft(e.z)||(r=Ee.create(e.z)),ft(e.Z)||(r||(r=new Pe(e.Z)),t=e.Z),ft(e.q)||(e.M=3*(e.q-1)+1),ft(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),ft(e.u)||(e.S=kt(e.u)),[Object.keys(e).reduce((function(t,r){var n=function(e){switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}}(r);return n&&(t[n]=e[r]),t}),{}),r,t]}(h):[null,null,void 0],f=p[0],m=p[1],v=p[2];if(It(h,"a")&&It(h,"H"))throw new W("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:n,regex:u,rawMatches:d,matches:h,result:f,zone:m,specificOffset:v}}function kn(e,t){if(!e)return null;var r=rr.create(t,e).dtFormatter((Nn||(Nn=Kn.fromMillis(1555555555555)),Nn)),n=r.formatToParts(),i=r.resolvedOptions();return n.map((function(t){return function(e,t,r){var n=e.type,i=e.value;if("literal"===n){var s=/^\s+$/.test(i);return{literal:!s,val:s?" ":i}}var a=t[n],o=n;"hour"===n&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":r.hour12?"hour12":"hour24");var l=Tn[o];if("object"==typeof l&&(l=l[a]),l)return{literal:!1,val:l}}(t,e,i)}))}var Sn="Invalid DateTime",Fn=864e13;function xn(e){return new Xe("unsupported zone",'the zone "'+e.name+'" is not supported')}function Cn(e){return null===e.weekData&&(e.weekData=ot(e.c)),e.weekData}function Dn(e){return null===e.localWeekData&&(e.localWeekData=ot(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function Mn(e,t){var r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Kn(C({},r,t,{old:r}))}function Ln(e,t,r){var n=e-60*t*1e3,i=r.offset(n);if(t===i)return[n,t];n-=60*(i-t)*1e3;var s=r.offset(n);return i===s?[n,i]:[e-60*Math.min(i,s)*1e3,Math.max(i,s)]}function Vn(e,t){var r=new Date(e+=60*t*1e3);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function An(e,t,r){return Ln(Dt(e),t,r)}function $n(e,t){var r=e.o,n=e.c.year+Math.trunc(t.years),i=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s=C({},e.c,{year:n,month:i,day:Math.min(e.c.day,Ct(n,i))+Math.trunc(t.days)+7*Math.trunc(t.weeks)}),a=tn.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),o=Ln(Dt(s),r,e.zone),l=o[0],u=o[1];return 0!==a&&(l+=a,u=e.zone.offset(l)),{ts:l,o:u}}function qn(e,t,r,n,i,s){var a=r.setZone,o=r.zone;if(e&&0!==Object.keys(e).length||t){var l=t||o,u=Kn.fromObject(e,C({},r,{zone:l,specificOffset:s}));return a?u:u.setZone(o)}return Kn.invalid(new Xe("unparsable",'the input "'+i+"\" can't be parsed as "+n))}function Rn(e,t,r){return void 0===r&&(r=!0),e.isValid?rr.create(Ue.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Un(e,t){var r=e.c.year>9999||e.c.year<0,n="";return r&&e.c.year>=0&&(n+="+"),n+=Nt(e.c.year,r?6:4),t?(n+="-",n+=Nt(e.c.month),n+="-",n+=Nt(e.c.day)):(n+=Nt(e.c.month),n+=Nt(e.c.day)),n}function Bn(e,t,r,n,i,s){var a=Nt(e.c.hour);return t?(a+=":",a+=Nt(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(a+=":")):a+=Nt(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(a+=Nt(e.c.second),0===e.c.millisecond&&n||(a+=".",a+=Nt(e.c.millisecond,3))),i&&(e.isOffsetFixed&&0===e.offset&&!s?a+="Z":e.o<0?(a+="-",a+=Nt(Math.trunc(-e.o/60)),a+=":",a+=Nt(Math.trunc(-e.o%60))):(a+="+",a+=Nt(Math.trunc(e.o/60)),a+=":",a+=Nt(Math.trunc(e.o%60)))),s&&(a+="["+e.zone.ianaName+"]"),a}var Pn={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},jn={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Wn={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Zn=["year","month","day","hour","minute","second","millisecond"],_n=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Hn=["year","ordinal","hour","minute","second","millisecond"];function Yn(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){var t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Z(e);return t}(e)}}function zn(e,t){var r,n,i=We(t.zone,Qe.defaultZone),s=Ue.fromObject(t),a=Qe.now();if(ft(e.year))r=a;else{for(var o=0,l=Zn;o<l.length;o++){var u=l[o];ft(e[u])&&(e[u]=Pn[u])}var c=ht(e)||pt(e);if(c)return Kn.invalid(c);var d=An(e,i.offset(a),i);r=d[0],n=d[1]}return new Kn({ts:r,zone:i,loc:s,o:n})}function Gn(e,t,r){var n=!!ft(r.round)||r.round,i=function(e,i){return e=St(e,n||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(e,i)},s=function(n){return r.calendary?t.hasSame(e,n)?0:t.startOf(n).diff(e.startOf(n),n).get(n):t.diff(e,n).get(n)};if(r.unit)return i(s(r.unit),r.unit);for(var a,o=R(r.units);!(a=o()).done;){var l=a.value,u=s(l);if(Math.abs(u)>=1)return i(u,l)}return i(e>t?-0:0,r.units[r.units.length-1])}function Jn(e){var t,r={};return e.length>0&&"object"==typeof e[e.length-1]?(r=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[r,t]}var Kn=function(e){function t(e){var t=e.zone||Qe.defaultZone,r=e.invalid||(Number.isNaN(e.ts)?new Xe("invalid input"):null)||(t.isValid?null:xn(t));this.ts=ft(e.ts)?Qe.now():e.ts;var n=null,i=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t)){var s=[e.old.c,e.old.o];n=s[0],i=s[1]}else{var a=t.offset(this.ts);n=Vn(this.ts,a),n=(r=Number.isNaN(n.year)?new Xe("invalid input"):null)?null:n,i=r?null:a}this._zone=t,this.loc=e.loc||Ue.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=n,this.o=i,this.isLuxonDateTime=!0}t.now=function(){return new t({})},t.local=function(){var e=Jn(arguments),t=e[0],r=e[1];return zn({year:r[0],month:r[1],day:r[2],hour:r[3],minute:r[4],second:r[5],millisecond:r[6]},t)},t.utc=function(){var e=Jn(arguments),t=e[0],r=e[1],n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],l=r[5],u=r[6];return t.zone=Pe.utcInstance,zn({year:n,month:i,day:s,hour:a,minute:o,second:l,millisecond:u},t)},t.fromJSDate=function(e,r){void 0===r&&(r={});var n,i=(n=e,"[object Date]"===Object.prototype.toString.call(n)?e.valueOf():NaN);if(Number.isNaN(i))return t.invalid("invalid input");var s=We(r.zone,Qe.defaultZone);return s.isValid?new t({ts:i,zone:s,loc:Ue.fromObject(r)}):t.invalid(xn(s))},t.fromMillis=function(e,r){if(void 0===r&&(r={}),mt(e))return e<-Fn||e>Fn?t.invalid("Timestamp out of range"):new t({ts:e,zone:We(r.zone,Qe.defaultZone),loc:Ue.fromObject(r)});throw new _("fromMillis requires a numerical input, but received a "+typeof e+" with value "+e)},t.fromSeconds=function(e,r){if(void 0===r&&(r={}),mt(e))return new t({ts:1e3*e,zone:We(r.zone,Qe.defaultZone),loc:Ue.fromObject(r)});throw new _("fromSeconds requires a numerical input")},t.fromObject=function(e,r){void 0===r&&(r={}),e=e||{};var n=We(r.zone,Qe.defaultZone);if(!n.isValid)return t.invalid(xn(n));var i=Ue.fromObject(r),s=Rt(e,Yn),a=dt(s,i),o=a.minDaysInFirstWeek,l=a.startOfWeek,u=Qe.now(),c=ft(r.specificOffset)?n.offset(u):r.specificOffset,d=!ft(s.ordinal),h=!ft(s.year),p=!ft(s.month)||!ft(s.day),f=h||p,m=s.weekYear||s.weekNumber;if((f||d)&&m)throw new W("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&d)throw new W("Can't mix ordinal dates with month/day");var v,g,y=m||s.weekday&&!f,O=Vn(u,c);y?(v=_n,g=jn,O=ot(O,o,l)):d?(v=Hn,g=Wn,O=ut(O)):(v=Zn,g=Pn);for(var I,b=!1,T=R(v);!(I=T()).done;){var N=I.value;ft(s[N])?s[N]=b?g[N]:O[N]:b=!0}var E=y?function(e,t,r){void 0===t&&(t=4),void 0===r&&(r=1);var n=vt(e.weekYear),i=Tt(e.weekNumber,1,Lt(e.weekYear,t,r)),s=Tt(e.weekday,1,7);return n?i?!s&&rt("weekday",e.weekday):rt("week",e.weekNumber):rt("weekYear",e.weekYear)}(s,o,l):d?function(e){var t=vt(e.year),r=Tt(e.ordinal,1,xt(e.year));return t?!r&&rt("ordinal",e.ordinal):rt("year",e.year)}(s):ht(s),w=E||pt(s);if(w)return t.invalid(w);var k=An(y?lt(s,o,l):d?ct(s):s,c,n),S=new t({ts:k[0],zone:n,o:k[1],loc:i});return s.weekday&&f&&e.weekday!==S.weekday?t.invalid("mismatched weekday","you can't specify both a weekday of "+s.weekday+" and a date of "+S.toISO()):S},t.fromISO=function(e,t){void 0===t&&(t={});var r=function(e){return ar(e,[Mr,$r],[Lr,qr],[Vr,Rr],[Ar,Ur])}(e);return qn(r[0],r[1],t,"ISO 8601",e)},t.fromRFC2822=function(e,t){void 0===t&&(t={});var r=function(e){return ar(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[wr,kr])}(e);return qn(r[0],r[1],t,"RFC 2822",e)},t.fromHTTP=function(e,t){void 0===t&&(t={});var r=function(e){return ar(e,[Sr,Cr],[Fr,Cr],[xr,Dr])}(e);return qn(r[0],r[1],t,"HTTP",t)},t.fromFormat=function(e,r,n){if(void 0===n&&(n={}),ft(e)||ft(r))throw new _("fromFormat requires an input string and a format");var i=n,s=i.locale,a=void 0===s?null:s,o=i.numberingSystem,l=void 0===o?null:o,u=function(e,t,r){var n=wn(e,t,r);return[n.result,n.zone,n.specificOffset,n.invalidReason]}(Ue.fromOpts({locale:a,numberingSystem:l,defaultToEN:!0}),e,r),c=u[0],d=u[1],h=u[2],p=u[3];return p?t.invalid(p):qn(c,d,n,"format "+r,e,h)},t.fromString=function(e,r,n){return void 0===n&&(n={}),t.fromFormat(e,r,n)},t.fromSQL=function(e,t){void 0===t&&(t={});var r=function(e){return ar(e,[Pr,$r],[jr,Wr])}(e);return qn(r[0],r[1],t,"SQL",e)},t.invalid=function(e,r){if(void 0===r&&(r=null),!e)throw new _("need to specify a reason the DateTime is invalid");var n=e instanceof Xe?e:new Xe(e,r);if(Qe.throwOnInvalid)throw new B(n);return new t({invalid:n})},t.isDateTime=function(e){return e&&e.isLuxonDateTime||!1},t.parseFormatForOpts=function(e,t){void 0===t&&(t={});var r=kn(e,Ue.fromObject(t));return r?r.map((function(e){return e?e.val:null})).join(""):null},t.expandFormat=function(e,t){return void 0===t&&(t={}),En(rr.parseFormat(e),Ue.fromObject(t)).map((function(e){return e.val})).join("")};var r=t.prototype;return r.get=function(e){return this[e]},r.getPossibleOffsets=function(){if(!this.isValid||this.isOffsetFixed)return[this];var e=864e5,t=6e4,r=Dt(this.c),n=this.zone.offset(r-e),i=this.zone.offset(r+e),s=this.zone.offset(r-n*t),a=this.zone.offset(r-i*t);if(s===a)return[this];var o=r-s*t,l=r-a*t,u=Vn(o,s),c=Vn(l,a);return u.hour===c.hour&&u.minute===c.minute&&u.second===c.second&&u.millisecond===c.millisecond?[Mn(this,{ts:o}),Mn(this,{ts:l})]:[this]},r.resolvedLocaleOptions=function(e){void 0===e&&(e={});var t=rr.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t.locale,numberingSystem:t.numberingSystem,outputCalendar:t.calendar}},r.toUTC=function(e,t){return void 0===e&&(e=0),void 0===t&&(t={}),this.setZone(Pe.instance(e),t)},r.toLocal=function(){return this.setZone(Qe.defaultZone)},r.setZone=function(e,r){var n=void 0===r?{}:r,i=n.keepLocalTime,s=void 0!==i&&i,a=n.keepCalendarTime,o=void 0!==a&&a;if((e=We(e,Qe.defaultZone)).equals(this.zone))return this;if(e.isValid){var l=this.ts;if(s||o){var u=e.offset(this.ts);l=An(this.toObject(),u,e)[0]}return Mn(this,{ts:l,zone:e})}return t.invalid(xn(e))},r.reconfigure=function(e){var t=void 0===e?{}:e,r=t.locale,n=t.numberingSystem,i=t.outputCalendar;return Mn(this,{loc:this.loc.clone({locale:r,numberingSystem:n,outputCalendar:i})})},r.setLocale=function(e){return this.reconfigure({locale:e})},r.set=function(e){if(!this.isValid)return this;var t,r=Rt(e,Yn),n=dt(r,this.loc),i=n.minDaysInFirstWeek,s=n.startOfWeek,a=!ft(r.weekYear)||!ft(r.weekNumber)||!ft(r.weekday),o=!ft(r.ordinal),l=!ft(r.year),u=!ft(r.month)||!ft(r.day),c=l||u,d=r.weekYear||r.weekNumber;if((c||o)&&d)throw new W("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&o)throw new W("Can't mix ordinal dates with month/day");a?t=lt(C({},ot(this.c,i,s),r),i,s):ft(r.ordinal)?(t=C({},this.toObject(),r),ft(r.day)&&(t.day=Math.min(Ct(t.year,t.month),t.day))):t=ct(C({},ut(this.c),r));var h=An(t,this.o,this.zone);return Mn(this,{ts:h[0],o:h[1]})},r.plus=function(e){return this.isValid?Mn(this,$n(this,tn.fromDurationLike(e))):this},r.minus=function(e){return this.isValid?Mn(this,$n(this,tn.fromDurationLike(e).negate())):this},r.startOf=function(e,t){var r=(void 0===t?{}:t).useLocaleWeeks,n=void 0!==r&&r;if(!this.isValid)return this;var i={},s=tn.normalizeUnit(e);switch(s){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0}if("weeks"===s)if(n){var a=this.loc.getStartOfWeek();this.weekday<a&&(i.weekNumber=this.weekNumber-1),i.weekday=a}else i.weekday=1;if("quarters"===s){var o=Math.ceil(this.month/3);i.month=3*(o-1)+1}return this.set(i)},r.endOf=function(e,t){var r;return this.isValid?this.plus((r={},r[e]=1,r)).startOf(e,t).minus(1):this},r.toFormat=function(e,t){return void 0===t&&(t={}),this.isValid?rr.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Sn},r.toLocaleString=function(e,t){return void 0===e&&(e=J),void 0===t&&(t={}),this.isValid?rr.create(this.loc.clone(t),e).formatDateTime(this):Sn},r.toLocaleParts=function(e){return void 0===e&&(e={}),this.isValid?rr.create(this.loc.clone(e),e).formatDateTimeParts(this):[]},r.toISO=function(e){var t=void 0===e?{}:e,r=t.format,n=void 0===r?"extended":r,i=t.suppressSeconds,s=void 0!==i&&i,a=t.suppressMilliseconds,o=void 0!==a&&a,l=t.includeOffset,u=void 0===l||l,c=t.extendedZone,d=void 0!==c&&c;if(!this.isValid)return null;var h="extended"===n,p=Un(this,h);return p+="T",p+=Bn(this,h,s,o,u,d)},r.toISODate=function(e){var t=(void 0===e?{}:e).format,r=void 0===t?"extended":t;return this.isValid?Un(this,"extended"===r):null},r.toISOWeekDate=function(){return Rn(this,"kkkk-'W'WW-c")},r.toISOTime=function(e){var t=void 0===e?{}:e,r=t.suppressMilliseconds,n=void 0!==r&&r,i=t.suppressSeconds,s=void 0!==i&&i,a=t.includeOffset,o=void 0===a||a,l=t.includePrefix,u=void 0!==l&&l,c=t.extendedZone,d=void 0!==c&&c,h=t.format,p=void 0===h?"extended":h;return this.isValid?(u?"T":"")+Bn(this,"extended"===p,s,n,o,d):null},r.toRFC2822=function(){return Rn(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)},r.toHTTP=function(){return Rn(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")},r.toSQLDate=function(){return this.isValid?Un(this,!0):null},r.toSQLTime=function(e){var t=void 0===e?{}:e,r=t.includeOffset,n=void 0===r||r,i=t.includeZone,s=void 0!==i&&i,a=t.includeOffsetSpace,o="HH:mm:ss.SSS";return(s||n)&&((void 0===a||a)&&(o+=" "),s?o+="z":n&&(o+="ZZ")),Rn(this,o,!0)},r.toSQL=function(e){return void 0===e&&(e={}),this.isValid?this.toSQLDate()+" "+this.toSQLTime(e):null},r.toString=function(){return this.isValid?this.toISO():Sn},r[e]=function(){return this.isValid?"DateTime { ts: "+this.toISO()+", zone: "+this.zone.name+", locale: "+this.locale+" }":"DateTime { Invalid, reason: "+this.invalidReason+" }"},r.valueOf=function(){return this.toMillis()},r.toMillis=function(){return this.isValid?this.ts:NaN},r.toSeconds=function(){return this.isValid?this.ts/1e3:NaN},r.toUnixInteger=function(){return this.isValid?Math.floor(this.ts/1e3):NaN},r.toJSON=function(){return this.toISO()},r.toBSON=function(){return this.toJSDate()},r.toObject=function(e){if(void 0===e&&(e={}),!this.isValid)return{};var t=C({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t},r.toJSDate=function(){return new Date(this.isValid?this.ts:NaN)},r.diff=function(e,t,r){if(void 0===t&&(t="milliseconds"),void 0===r&&(r={}),!this.isValid||!e.isValid)return tn.invalid("created by diffing an invalid DateTime");var n,i=C({locale:this.locale,numberingSystem:this.numberingSystem},r),s=(n=t,Array.isArray(n)?n:[n]).map(tn.normalizeUnit),a=e.valueOf()>this.valueOf(),o=ln(a?this:e,a?e:this,s,i);return a?o.negate():o},r.diffNow=function(e,r){return void 0===e&&(e="milliseconds"),void 0===r&&(r={}),this.diff(t.now(),e,r)},r.until=function(e){return this.isValid?sn.fromDateTimes(this,e):this},r.hasSame=function(e,t,r){if(!this.isValid)return!1;var n=e.valueOf(),i=this.setZone(e.zone,{keepLocalTime:!0});return i.startOf(t,r)<=n&&n<=i.endOf(t,r)},r.equals=function(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)},r.toRelative=function(e){if(void 0===e&&(e={}),!this.isValid)return null;var r=e.base||t.fromObject({},{zone:this.zone}),n=e.padding?this<r?-e.padding:e.padding:0,i=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(i=e.unit,s=void 0),Gn(r,this.plus(n),C({},e,{numeric:"always",units:i,unit:s}))},r.toRelativeCalendar=function(e){return void 0===e&&(e={}),this.isValid?Gn(e.base||t.fromObject({},{zone:this.zone}),this,C({},e,{numeric:"auto",units:["years","months","days"],calendary:!0})):null},t.min=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!r.every(t.isDateTime))throw new _("min requires all arguments be DateTimes");return Ot(r,(function(e){return e.valueOf()}),Math.min)},t.max=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!r.every(t.isDateTime))throw new _("max requires all arguments be DateTimes");return Ot(r,(function(e){return e.valueOf()}),Math.max)},t.fromFormatExplain=function(e,t,r){void 0===r&&(r={});var n=r,i=n.locale,s=void 0===i?null:i,a=n.numberingSystem,o=void 0===a?null:a;return wn(Ue.fromOpts({locale:s,numberingSystem:o,defaultToEN:!0}),e,t)},t.fromStringExplain=function(e,r,n){return void 0===n&&(n={}),t.fromFormatExplain(e,r,n)},x(t,[{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}},{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"outputCalendar",get:function(){return this.isValid?this.loc.outputCalendar:null}},{key:"zone",get:function(){return this._zone}},{key:"zoneName",get:function(){return this.isValid?this.zone.name:null}},{key:"year",get:function(){return this.isValid?this.c.year:NaN}},{key:"quarter",get:function(){return this.isValid?Math.ceil(this.c.month/3):NaN}},{key:"month",get:function(){return this.isValid?this.c.month:NaN}},{key:"day",get:function(){return this.isValid?this.c.day:NaN}},{key:"hour",get:function(){return this.isValid?this.c.hour:NaN}},{key:"minute",get:function(){return this.isValid?this.c.minute:NaN}},{key:"second",get:function(){return this.isValid?this.c.second:NaN}},{key:"millisecond",get:function(){return this.isValid?this.c.millisecond:NaN}},{key:"weekYear",get:function(){return this.isValid?Cn(this).weekYear:NaN}},{key:"weekNumber",get:function(){return this.isValid?Cn(this).weekNumber:NaN}},{key:"weekday",get:function(){return this.isValid?Cn(this).weekday:NaN}},{key:"isWeekend",get:function(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}},{key:"localWeekday",get:function(){return this.isValid?Dn(this).weekday:NaN}},{key:"localWeekNumber",get:function(){return this.isValid?Dn(this).weekNumber:NaN}},{key:"localWeekYear",get:function(){return this.isValid?Dn(this).weekYear:NaN}},{key:"ordinal",get:function(){return this.isValid?ut(this.c).ordinal:NaN}},{key:"monthShort",get:function(){return this.isValid?an.months("short",{locObj:this.loc})[this.month-1]:null}},{key:"monthLong",get:function(){return this.isValid?an.months("long",{locObj:this.loc})[this.month-1]:null}},{key:"weekdayShort",get:function(){return this.isValid?an.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}},{key:"weekdayLong",get:function(){return this.isValid?an.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}},{key:"offset",get:function(){return this.isValid?+this.o:NaN}},{key:"offsetNameShort",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}},{key:"offsetNameLong",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}},{key:"isOffsetFixed",get:function(){return this.isValid?this.zone.isUniversal:null}},{key:"isInDST",get:function(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}},{key:"isInLeapYear",get:function(){return Ft(this.year)}},{key:"daysInMonth",get:function(){return Ct(this.year,this.month)}},{key:"daysInYear",get:function(){return this.isValid?xt(this.year):NaN}},{key:"weeksInWeekYear",get:function(){return this.isValid?Lt(this.weekYear):NaN}},{key:"weeksInLocalWeekYear",get:function(){return this.isValid?Lt(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}}],[{key:"DATE_SHORT",get:function(){return J}},{key:"DATE_MED",get:function(){return K}},{key:"DATE_MED_WITH_WEEKDAY",get:function(){return Q}},{key:"DATE_FULL",get:function(){return X}},{key:"DATE_HUGE",get:function(){return ee}},{key:"TIME_SIMPLE",get:function(){return te}},{key:"TIME_WITH_SECONDS",get:function(){return re}},{key:"TIME_WITH_SHORT_OFFSET",get:function(){return ne}},{key:"TIME_WITH_LONG_OFFSET",get:function(){return ie}},{key:"TIME_24_SIMPLE",get:function(){return se}},{key:"TIME_24_WITH_SECONDS",get:function(){return ae}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function(){return oe}},{key:"TIME_24_WITH_LONG_OFFSET",get:function(){return le}},{key:"DATETIME_SHORT",get:function(){return ue}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function(){return ce}},{key:"DATETIME_MED",get:function(){return de}},{key:"DATETIME_MED_WITH_SECONDS",get:function(){return he}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function(){return pe}},{key:"DATETIME_FULL",get:function(){return fe}},{key:"DATETIME_FULL_WITH_SECONDS",get:function(){return me}},{key:"DATETIME_HUGE",get:function(){return ve}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function(){return ge}}]),t}(Symbol.for("nodejs.util.inspect.custom"));function Qn(e){if(Kn.isDateTime(e))return e;if(e&&e.valueOf&&mt(e.valueOf()))return Kn.fromJSDate(e);if(e&&"object"==typeof e)return Kn.fromObject(e);throw new _("Unknown datetime argument: "+e+", of type "+typeof e)}var Xn=S.DateTime=Kn;function ei(e,t){switch(e){case"system":return Intl.DateTimeFormat().resolvedOptions().timeZone;case"unknown":return t||"UTC";default:return e}}function ti(e,t,r){var n,i;return Xn.fromMillis(e).setZone(null!==(n=ei(null!=t?t:"system",r))&&void 0!==n?n:"UTC").toFormat("yyyy-MM-dd TT",{numberingSystem:"latn",zone:null!==(i=ei(null!=t?t:"system",r))&&void 0!==i?i:"UTC"})}function ri(e,t,r,n){var i;return Xn.fromFormat(e,"yyyy-MM-dd TT",{zone:null!==(i=ei(null!=r?r:"system",n))&&void 0!==i?i:"UTC"}).setZone(t).toMillis()}function ni(e){return e?e.substring(11,19):void 0}function ii(e,t){let r=new Date(e).toISOString();return t.formatTimeOnly(r.substring(11,19),t.convertDateFormatToIntlOptions("short-date-long-time-24"))}function si(e){return new Date(`1970-01-01T${e}Z`).getTime()}function ai(e){const t="number"==typeof e?new Date(e):e;return`${t.getFullYear()}-${t.getMonth()<9?"0":""}${t.getMonth()+1}-${t.getDate()<10?"0":""}${t.getDate()}`}function oi(e){return new Date(`${e} 00:00:00`).getTime()}function li(e,t,r,n){let i;return i="unknown"===t?r.formatDate(e,Object.assign(Object.assign({},r.convertDateFormatToIntlOptions(n||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):r.formatDate(e,Object.assign(Object.assign({},r.convertDateFormatToIntlOptions(n||"short-date-short-time")),{timeZone:t})),i}function ui(e,t){return e?t.formatDateOnly(e,t.convertDateFormatToIntlOptions("short-date")):""}function ci(e,t){let r;return r="string"==typeof e?t.formatTimeOnly(e,t.convertDateFormatToIntlOptions("short-date-long-time")):t.formatDate(e,Object.assign(Object.assign({},t.convertDateFormatToIntlOptions("long-time")),{timeZone:"utc"})),r}function di(e,t){const r=t.fieldDomains;if(r){let t="";for(let n=0;n<r.length;n++){const i=r[n];i.code==e&&(t+=(t.length?" | ":"")+i.name)}return t}return e}function hi(e){var t;return!!(null===(t=e.fieldDomains)||void 0===t?void 0:t.length)}async function pi(e){const{layer:t,mapImageSublayer:r,featureReduction:n}=e;if(!t)return;if(n)return async function(e){var t;const{layer:r,view:n}=e;if("imagery"===r.type||"subtype-group"===r.type||"catalog"===r.type)return;if(!(null===(t=e.fields)||void 0===t?void 0:t.length)){e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=1;let t=5e3,i=10,a=0;try{a=await(0,o.g)(r,n),t=a?Math.min(Math.max(10,Math.ceil(a/4)),5e3):5e3,i=a&&a>=1e3?100:10}catch(e){}const[l]=await(0,s.l)(["esri/layers/support/Field"]),u=r.featureReduction;e.fields=[],u.fields.forEach((n=>{const s="count"===n.statisticType,a=n.onStatisticField&&r.fields.find((e=>e.name===n.onStatisticField));if(!n.onStatisticField&&s||a){const r={layerField:new l({name:n.name,alias:n.alias||n.name,type:(null==a?void 0:a.type)||"integer"}),statisticsStatus:s?I.SUCCESS:I.MISSING,statistics:s?{min:1,max:t,avg:i}:void 0,histogramStatus:s?I.FAILED:I.MISSING,uniqueValuesStatus:I.MISSING,partialUniqueValues:!1,label:n.alias||n.name};Ii(e,r),e.fields.push(r)}}))}}(e);let i=t.fields;if(!(r&&r.layer.portalItem&&r.layer.url.indexOf("https://demographics")>-1&&r.layer.url.indexOf(".arcgis.com")>-1))return fi(e,i);{const t=r.layer.portalItem;try{const r=await t.fetchData();if(null==r?void 0:r.thematicGroup){const e=r.thematicGroup.fieldNames;e&&(i=i.filter((t=>e.indexOf(t.name)>-1)))}return fi(e,i)}catch(t){return fi(e,i)}}}function fi(e,t){var r;const{layer:n}=e;if(!e.fields||!e.fields.length){e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=0;const i=!("capabilities"in n)||(null===(r=n.capabilities.query)||void 0===r?void 0:r.supportsSqlExpression);e.supportsStandardizedQuery&&i||(t=t.filter((e=>-1===["date","date-only","time-only"].indexOf(e.type))));let a=[];if("subtype-group"!==e.layer.type&&"catalog"!==e.layer.type){const{popupTemplate:t}=e.layer;a=t?t.fieldInfos:[]}t.forEach((t=>{const r=a?a.filter((e=>e.fieldName===t.name)):null,n=(null==r?void 0:r.length)?r[0].label:null,i={layerField:t,statisticsStatus:I.MISSING,histogramStatus:I.MISSING,uniqueValuesStatus:I.MISSING,partialUniqueValues:!1,label:n||t.alias||t.name};Ii(e,i),i.simpleFieldType&&e.fields.push(i)})),async function(e){const{layer:t,fields:r}=e;if("feature"!==t.type)return;const n=t.typeIdField,i=t.types;r.forEach((async t=>{const r=t.layerField.name,a=t.layerField.domain,o=mi(r,e);if(o){if(n&&i){if(n===r?(o.fieldDomains=i.map((e=>({code:e.id,name:e.name}))),Ii(e,o)):(o.fieldDomains=[],i.forEach((e=>{var t,n;if(e.domains&&e.domains[r]&&"inherited"!==e.domains[r].type)(null===(n=null===(t=e.domains)||void 0===t?void 0:t[r])||void 0===n?void 0:n.codedValues)&&e.domains[r].codedValues.forEach((async e=>{let t=!1;if(o.fieldDomains.forEach((r=>{r.code===e.code&&(t=!0,-1===`, ${r.name},`.indexOf(`, ${e.name},`)&&(r.name+=`, ${e.name}`))})),!t){const[t]=await(0,s.l)(["esri/core/lang"]);o.fieldDomains.push(t.clone(e))}}));else{const e=a;(null==e?void 0:e.codedValues)&&e.codedValues.forEach((async e=>{let t=!1;if(o.fieldDomains.forEach((r=>{r.code===e.code&&(t=!0,-1===`, ${r.name},`.indexOf(`, ${e.name},`)&&(r.name+=`, ${e.name}`))})),!t){const[t]=await(0,s.l)(["esri/core/lang"]);o.fieldDomains.push(t.clone(e))}}))}}))),!hi(o)&&(null==a?void 0:a.codedValues)){const[e]=await(0,s.l)(["esri/core/lang"]);o.fieldDomains=e.clone(a.codedValues)}}else(null==a?void 0:a.codedValues)&&(o.fieldDomains=a.codedValues);Ii(e,o)}}))}(e)}}function mi(e,t){const{fields:r}=t;for(let t=0;t<r.length;t++){const n=r[t];if(n.layerField.name===e)return n}}function vi(e){const{fields:t,defaultFieldName:r}=e;if(r){const e=t.find((e=>e.layerField.name===r));if(e)return e}let n;for(let e=0;e<t.length;e++){const r=t[e];if(r.simpleFieldType&&-1===[O.OID,O.GUID,O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(r.simpleFieldType)){if(r.simpleFieldType!==O.NUMBER||n)return r;n=r}}return n||t[0]}function gi(e,t,r){var n;const{strings:i}=e,s={},a=t.statistics;if(!a)return t.simpleFieldType===O.STRING&&t.uniqueValuesStatus===I.SUCCESS&&(null===(n=t.uniqueValueInfos)||void 0===n?void 0:n.length)&&[i.operators.stringOperatorIs,i.operators.stringOperatorIsNot].indexOf(r)>-1&&(s.value=t.uniqueValueInfos[0].value),s;if(Vi(e,r)){const e=(new Date).getTime(),t=Math.abs(e-a.avg);t>2*T.YEAR?(s.value=Math.round(t/T.YEAR),s.unit=b.YEAR):t>2*T.MONTH?(s.value=Math.round(t/T.MONTH),s.unit=b.MONTH):t>2*T.WEEK?(s.value=Math.round(t/T.WEEK),s.unit=b.WEEK):t>2*T.DAY?(s.value=Math.round(t/T.DAY),s.unit=b.DAY):t>2*T.HOUR?(s.value=Math.round(t/T.HOUR),s.unit=b.HOUR):(s.value=Math.round(t/T.MINUTE),s.unit=b.MINUTE)}else Ci(e,r)?(s.value=Oi(a.avg,e,t),s.value2=Oi(a.max,e,t)):s.value=Oi(a.avg,e,t);return s}function yi(e,t,r){const n=function(e,t){var r;const{layer:n}=e;let i=2;const s="subtype-group"!==n.type&&"catalog"!==n.type&&n.popupTemplate;if(s){const e=null===(r=s.fieldInfos)||void 0===r?void 0:r.filter((e=>e.fieldName===t.layerField.name));if(null==e?void 0:e.length){const t=e[0];t.format&&E(t.format.places)&&(i=t.format.places)}}return i}(t,r),i=Math.pow(10,n);return E(e)&&Math.round(e*i)/i}function Oi(e,t,r){return E(e)&&(Ti(r)?Math.round(e):yi(e,t,r))}function Ii(e,t){switch(t.layerField.type){case"string":t.simpleFieldType=O.STRING,e.stringFieldsCount++;break;case"date":hi(t)?(t.simpleFieldType=O.STRING,e.stringFieldsCount++):(t.simpleFieldType=O.DATE,e.dateFieldsCount++);break;case"date-only":hi(t)?(t.simpleFieldType=O.STRING,e.stringFieldsCount++):t.simpleFieldType=O.DATE_ONLY;break;case"time-only":hi(t)?(t.simpleFieldType=O.STRING,e.stringFieldsCount++):t.simpleFieldType=O.TIME_ONLY;break;case"oid":t.simpleFieldType=O.OID;break;case"guid":t.simpleFieldType=O.GUID;break;case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":hi(t)?(t.simpleFieldType=O.STRING,e.stringFieldsCount++):(t.simpleFieldType=O.NUMBER,e.numberFieldsCount++)}}function bi(e){return["small-integer","big-integer","integer","single","double","long"].indexOf(e.layerField.type)>-1}function Ti(e){return["small-integer","big-integer","integer","long"].indexOf(e.layerField.type)>-1}function Ni(e){return"date"===e.layerField.type}function Ei(e){return"date-only"===e.layerField.type}function wi(e){return"time-only"===e.layerField.type}function ki(e){const{layer:t,expressions:r,strings:n}=e;if("feature"!==t.type)return;const{portalItem:i,sourceJSON:s}=t;if(!i)return;const{typeKeywords:a,itemControl:o,portal:l}=i,u=l.isPortal,c=(null==a?void 0:a.indexOf("Hosted Service"))>-1,d=!u&&(null==a?void 0:a.indexOf("Location Tracking Service"))>-1;if(c&&!d&&l.user&&o&&["admin","update"].indexOf(o)>-1){const t=n.operators,i=[t.stringOperatorEndsWith,t.stringOperatorContains,t.stringOperatorDoesNotContain],a=[],o=t=>{const r=t.fieldName;if(!r)return;const n=mi(r,e);!(((null==n?void 0:n.simpleFieldType)===O.STRING||(null==n?void 0:n.simpleFieldType)===O.GUID)&&(n.layerField.length>4e3||i.indexOf(t.operator)>-1))&&-1===a.indexOf(r)&&a.push(r)};null==r||r.forEach((e=>e.conditions.forEach((e=>o(e)))));const l={indexes:[]};s.indexes=s.indexes||[],a.forEach((e=>{s.indexes.some((t=>t.fields===e))||l.indexes.push({name:`${e}_Index`,fields:e,isUnique:!1,isAscending:!0,description:`${e}_Index`})})),l.indexes.length&&Si(l,e)}}async function Si(e,t){var r,n;const{layer:i,parentServiceUrl:a}=t;if("feature"!==i.type)return;const{portalItem:o,sourceJSON:l}=i,{typeKeywords:u,portal:c}=o,d=u.includes("View Service"),[h,p]=await(0,s.l)(["esri/identity/IdentityManager","esri/request"]);if(d&&!a){var f=`${c.restUrl}/content/items/${o.id}/relatedItems?relationshipType=Service2Service&direction=reverse`;const n=await h.getCredential(c.restUrl,{prompt:!1}),i=await p(f,{query:{f:"json",token:n.token}});return void((null===(r=null==i?void 0:i.data)||void 0===r?void 0:r.total)&&i.data.relatedItems.filter((e=>e.typeKeywords.includes("Hosted Service"))).forEach((r=>{t.parentServiceUrl=r.url,Si(e,t)})))}const m=`${(a||i.url).replace("/rest/services","/rest/admin/services")}/${i.layerId}/addToDefinition`,v=await h.getCredential(i.url,{prompt:!1}),g={f:"json",addToDefinition:JSON.stringify(e),async:!c.isPortal,token:v.token},y=await p(m,{query:g,method:"post"});if(c.isPortal)l.indexes=l.indexes||[],l.indexes=l.indexes.concat(e.indexes);else try{await Fi(null===(n=null==y?void 0:y.data)||void 0===n?void 0:n.statusURL,{f:"json",token:v.token},p),l.indexes=l.indexes||[],l.indexes=l.indexes.concat(e.indexes)}catch(e){}}S.Duration=tn,S.FixedOffsetZone=Pe,S.IANAZone=Ee,S.Info=an,S.Interval=sn,S.InvalidZone=je,S.Settings=Qe,S.SystemZone=Ie,S.VERSION="3.4.4",S.Zone=ye;const Fi=async(e,t,r)=>{var n;if(!e)throw new Error("pollForStatus: no status URL");const i=["processing","partial","Pending","InProgress"],s=["completed","Completed"];try{const a=await r(e,{query:t}),o=null===(n=null==a?void 0:a.data)||void 0===n?void 0:n.status;if(i.includes(o))return await(0,l.t)(500),Fi(e,t,r);if(s.includes(o))return a;throw a}catch(e){throw console.error(e),e}};function xi(e,t){const{strings:r,defaultOperator:n}=e;if("cluster_count"===t.layerField.name)return r.operators.numberOperatorIsGreaterThan;switch(t.layerField.type){case"string":return r.operators.stringOperatorIs;case"date":case"date-only":case"time-only":if(hi(t))return r.operators.stringOperatorIs;if(!n)return r.operators.dateOperatorIsBefore;switch(n){case">":return r.operators.dateOperatorIsAfter;case">=":return r.operators.dateOperatorIsAfterOrEqual;case"<":return r.operators.dateOperatorIsBefore;case"<=":return r.operators.dateOperatorIsBeforeOrEqual;default:return r.operators.dateOperatorIsOn}case"oid":case"guid":return r.operators.numberOperatorIs;case"small-integer":case"big-integer":case"integer":case"single":if(hi(t))return r.operators.stringOperatorIs;if(!n)return r.operators.numberOperatorIs;switch(n){case">":return r.operators.numberOperatorIsGreaterThan;case">=":return r.operators.numberOperatorIsAtLeast;case"<":return r.operators.numberOperatorIsLessThan;case"<=":return r.operators.numberOperatorIsAtMost;default:return r.operators.numberOperatorIs}case"double":case"long":if(hi(t))return r.operators.stringOperatorIs;if(!n)return r.operators.numberOperatorIsAtLeast;switch(n){case">":return r.operators.numberOperatorIsGreaterThan;case">=":return r.operators.numberOperatorIsAtLeast;case"<":return r.operators.numberOperatorIsLessThan;case"<=":return r.operators.numberOperatorIsAtMost;default:return r.operators.numberOperatorIs}default:return r.operators.stringOperatorIs}}function Ci(e,t){const{strings:r}=e;return!!(t&&[r.operators.numberOperatorIsBetween,r.operators.numberOperatorIsNotBetween,r.operators.dateOperatorIsBetween,r.operators.dateOperatorIsNotBetween].indexOf(t)>-1)}function Di(e,t){const{strings:r}=e;return!!(t&&[r.operators.stringOperatorIsBlank,r.operators.stringOperatorIsNotBlank,r.operators.numberOperatorIsBlank,r.operators.numberOperatorIsNotBlank,r.operators.dateOperatorIsBlank,r.operators.dateOperatorIsNotBlank].indexOf(t)>-1)}function Mi(e,t){const{strings:r}=e;return!!(t&&[r.operators.stringOperatorIsEmpty,r.operators.stringOperatorIsNotEmpty].indexOf(t)>-1)}function Li(e,t){const{strings:r}=e;return!!(t&&[r.operators.stringOperatorIncludes,r.operators.stringOperatorExcludes,r.operators.numberOperatorIncludes,r.operators.numberOperatorExcludes].indexOf(t)>-1)}function Vi(e,t){const{strings:r}=e;return!!(t&&[r.operators.dateOperatorInTheLast,r.operators.dateOperatorNotInTheLast].indexOf(t)>-1)}function Ai(e){let t="";if(!e.expressions||!e.expressions.length)return null;let r="",n=0;for(let i=0;i<e.expressions.length;i++){const s=$i(e.expressions[i],e);s.length&&(0===n?t=s:1===n?(r=` ${e.logicalOperatorForExpressions===y.OR?"OR":"AND"} `,t=`(${t})${r}(${s})`):t+=`${r}(${s})`,n++)}return t.length?t:null}function $i(e,t){let r="";if(1===e.conditions.length)r=qi(e.conditions[0],t);else{let n="";for(let i=0;i<e.conditions.length;i++){const s=qi(e.conditions[i],t);s.length&&(r+=n+s,n=` ${e.logicalOperatorForConditions===y.OR?"OR":"AND"} `)}}return r}function qi(e,t){const{layer:r,strings:n}=t,i=e.fieldName,s=e.operator;let a=e.value,o=e.value2,l=e.values||[];const u=e.unit,c=mi(i,t);if(!c)return"";if(Ci(t,s)&&!E(o))return"";if(Li(t,s)&&!l.length)return"";if(Vi(t,s)&&!E(a))return"";if(!(E(a)||l.length||Di(t,s)||Mi(t,s)))return"";let d="";if(c.simpleFieldType===O.STRING||c.simpleFieldType===O.GUID){const s="string"===c.layerField.type,o=bi(c),u=Ni(c),h=Ei(c),p=wi(c),f=s&&E(a)&&t.isHosted&&function(e){if("number"==typeof e)return!1;for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(a)?"N":"",m=null==a?void 0:a.toString().replace(/\'/g,"''"),v=e=>{let n;if(s)n=null==e?void 0:e.toString().replace(/\'/g,"''"),n=`${f}'${n}'`;else if(o)n=e.toString();else if(u){n=`${t.supportsStandardizedQuery?"timestamp ":""}'${Ri(e,r.fieldsIndex.getTimeZone(i)||"UTC")}'`}else if(h){const r=t.supportsStandardizedQuery?"DATE ":"";let i;i="number"==typeof e?ai(e):e,n=`${r}'${i}'`}else if(p){n=`${t.supportsStandardizedQuery?"TIME ":""}'${"number"==typeof e?ii(e,t.modules.intl):e}'`}return n};switch(e.operator){case n.operators.stringOperatorIs:d=`${i} = ${v(a)}`;break;case n.operators.stringOperatorIsNot:d=`${i} <> ${v(a)}`;break;case n.operators.stringOperatorStartsWith:d=`${i} LIKE ${f}'${m}%'`;break;case n.operators.stringOperatorEndsWith:d=`${i} LIKE ${f}'%${m}'`;break;case n.operators.stringOperatorContains:d=`${i} LIKE ${f}'%${m}%'`;break;case n.operators.stringOperatorDoesNotContain:d=`${i} NOT LIKE ${f}'%${m}%'`;break;case n.operators.stringOperatorIncludes:d=`${i} IN (${l.map((e=>v(e)))})`;break;case n.operators.stringOperatorExcludes:d=`${i} NOT IN (${l.map((e=>v(e)))})`;break;case n.operators.stringOperatorIsBlank:d=`${i} IS NULL`;break;case n.operators.stringOperatorIsNotBlank:d=`${i} IS NOT NULL`;break;case n.operators.stringOperatorIsEmpty:d=`${i} = ''`;break;case n.operators.stringOperatorIsNotEmpty:d=`${i} <> ''`}}else if(c.simpleFieldType===O.NUMBER||c.simpleFieldType===O.OID)switch(s){case n.operators.numberOperatorIs:d=`${i} = ${a}`;break;case n.operators.numberOperatorIsNot:d=`${i} <> ${a}`;break;case n.operators.numberOperatorIsAtLeast:d=`${i} >= ${a}`;break;case n.operators.numberOperatorIsLessThan:d=`${i} < ${a}`;break;case n.operators.numberOperatorIsAtMost:d=`${i} <= ${a}`;break;case n.operators.numberOperatorIsGreaterThan:d=`${i} > ${a}`;break;case n.operators.numberOperatorIsBetween:d=`${i} BETWEEN ${a} AND ${o}`;break;case n.operators.numberOperatorIsNotBetween:d=`${i} NOT BETWEEN ${a} AND ${o}`;break;case n.operators.numberOperatorIncludes:d=`${i} IN (${l.toString()})`;break;case n.operators.numberOperatorExcludes:d=`${i} NOT IN (${l.toString()})`;break;case n.operators.numberOperatorIsBlank:d=`${i} IS NULL`;break;case n.operators.numberOperatorIsNotBlank:d=`${i} IS NOT NULL`}else if(c.simpleFieldType===O.DATE_ONLY){const e=t.supportsStandardizedQuery?"DATE ":"";let r,h;switch(r="number"==typeof a?ai(a):a,E(o)&&"number"==typeof o?h=ai(o):E(o)&&(h=o),s){case n.operators.dateOperatorIsOn:d=`${i} = ${e}'${r}'`;break;case n.operators.dateOperatorIsNotOn:d=`${i} <> ${e}'${r}'`;break;case n.operators.dateOperatorIsBefore:d=`${i} < ${e}'${r}'`;break;case n.operators.dateOperatorIsAfter:d=`${i} > ${e}'${r}'`;break;case n.operators.dateOperatorInTheLast:d=`${i} BETWEEN ${Ui(t,c,a,u)}`;break;case n.operators.dateOperatorNotInTheLast:d=`${i} NOT BETWEEN ${Ui(t,c,a,u)}`;break;case n.operators.dateOperatorIsBetween:d=`${i} BETWEEN ${e}'${r}' AND ${e}'${h}'`;break;case n.operators.dateOperatorIsNotBetween:d=`${i} NOT BETWEEN ${e}'${r}' AND ${e}'${h}'`;break;case n.operators.dateOperatorIncludes:case n.operators.dateOperatorExcludes:let o="",p="";l.forEach((t=>{const r="number"==typeof t?ai(t):t;o+=`${p}${e}'${r}'`,p=","})),d=s===n.operators.numberOperatorIncludes?`${i} IN (${o})`:`${i} NOT IN (${o})`;break;case n.operators.dateOperatorIsBlank:d=`${i} IS NULL`;break;case n.operators.dateOperatorIsNotBlank:d=`${i} IS NOT NULL`}}else if(c.simpleFieldType===O.TIME_ONLY){const e=t.supportsStandardizedQuery?"TIME ":"";switch("number"==typeof a&&(a=ii(a,t.modules.intl)),E(o)&&"number"==typeof o&&(o=ii(o,t.modules.intl)),s){case n.operators.dateOperatorIsOn:d=`${i} = ${e}'${a}'`;break;case n.operators.dateOperatorIsNotOn:d=`${i} <> ${e}'${a}'`;break;case n.operators.dateOperatorIsBefore:d=`${i} < ${e}'${a}'`;break;case n.operators.dateOperatorIsAfter:d=`${i} > ${e}'${a}'`;break;case n.operators.dateOperatorIsBeforeOrEqual:d=`${i} <= ${e}'${a}'`;break;case n.operators.dateOperatorIsAfterOrEqual:d=`${i} >= ${e}'${a}'`;break;case n.operators.dateOperatorIsBetween:d=`${i} BETWEEN ${e}'${a}' AND ${e}'${o}'`;break;case n.operators.dateOperatorIsNotBetween:d=`${i} NOT BETWEEN ${e}'${a}' AND ${e}'${o}'`;break;case n.operators.dateOperatorIncludes:case n.operators.dateOperatorExcludes:let r="",u="";l.forEach((n=>{r+=`${u}${e}'${"number"==typeof n?ii(n,t.modules.intl):n}'`,u=","})),d=s===n.operators.numberOperatorIncludes?`${i} IN (${r})`:`${i} NOT IN (${r})`;break;case n.operators.dateOperatorIsBlank:d=`${i} IS NULL`;break;case n.operators.dateOperatorIsNotBlank:d=`${i} IS NOT NULL`}}else{const e=t.supportsStandardizedQuery?"timestamp ":"",h=r.fieldsIndex.getTimeZone(i)||"UTC";let p=Ri(a,h),f=Ri(o,h);switch(s){case n.operators.dateOperatorIsOn:d=`${i} = ${e}'${p}'`;break;case n.operators.dateOperatorIsNotOn:d=`${i} <> ${e}'${p}'`;break;case n.operators.dateOperatorIsBefore:d=`${i} < ${e}'${p}'`;break;case n.operators.dateOperatorIsAfter:d=`${i} > ${e}'${p}'`;break;case n.operators.dateOperatorIsBeforeOrEqual:d=`${i} <= ${e}'${p}'`;break;case n.operators.dateOperatorIsAfterOrEqual:d=`${i} >= ${e}'${p}'`;break;case n.operators.dateOperatorInTheLast:d=`${i} BETWEEN ${Ui(t,c,a,u)}`;break;case n.operators.dateOperatorNotInTheLast:d=`${i} NOT BETWEEN ${Ui(t,c,a,u)}`;break;case n.operators.dateOperatorIsBetween:d=`${i} BETWEEN ${e}'${p}' AND ${e}'${f}'`;break;case n.operators.dateOperatorIsNotBetween:d=`${i} NOT BETWEEN ${e}'${p}' AND ${e}'${f}'`;break;case n.operators.dateOperatorIncludes:case n.operators.dateOperatorExcludes:let r="",o="";l.forEach((t=>{r+=`${o}${e}'${Ri(t,h)}'`,o=","})),d=s===n.operators.dateOperatorIncludes?`${i} IN (${r})`:`${i} NOT IN (${r})`;break;case n.operators.dateOperatorIsBlank:d=`${i} IS NULL`;break;case n.operators.dateOperatorIsNotBlank:d=`${i} IS NOT NULL`}}return d}function Ri(e,t){const r=new Date(e),n=new Date(r.toLocaleString("en-US",{timeZone:t})),i=e=>String(e).padStart(2,"0"),s=i(n.getMonth()+1),a=i(n.getDate());return`${n.getFullYear()}-${s}-${a} ${i(n.getHours())}:${i(n.getMinutes())}:${i(n.getSeconds())}`}function Ui(e,t,r,n){const i=Ei(t)?"CURRENT_DATE":"CURRENT_TIMESTAMP";if(e.isHosted){let e=0;return e="year"===n?365*r:"month"===n?30*r:"week"===n?7*r:"day"===n?r:"hour"===n?r/24:r/1440,`${i} - ${e} AND ${i}`}{let e=0;return"year"===n?(e=365*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"month"===n?(e=30*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"week"===n?(e=7*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"day"===n?(e=r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"hour"===n?`${i} - INTERVAL '${r}' HOUR AND ${i}`:`${i} - INTERVAL '${r}' MINUTE AND ${i}`}}async function Bi(e,t){const{layer:r}=t;if(e&&e.length){const[n]=await(0,s.l)(["esri/core/sql"]);return n.parseWhereClause(e,r.fieldsIndex).then((e=>{if(!e.isStandardized)return!1;t.expressions=[{conditions:[]}];const r=function(e,t){if(!t.expressions)return!1;return ji(e)?Pi(e,t.expressions[0].conditions,t):(t.logicalOperatorForExpressions=Wi(e),Pi(e,t.expressions[0],t))}(e.parseTree,t);return t.expressions=k(t.expressions),r}),(e=>(console.error("SQLParser - error:",e),!1)))}return!0}function Pi(e,t,r){var n,i;const{layer:s}=r;if(ji(e)){if("column-reference"===e.left.type){const i=mi(e.left.column,r),a=i?function(e,t,r,n){var i,s,a,o;const{strings:l}=e;if(!r)return"";if(r.simpleFieldType===O.STRING)switch(t){case"=":return""===n.value?l.operators.stringOperatorIsEmpty:l.operators.stringOperatorIs;case"<>":return""===n.value?l.operators.stringOperatorIsNotEmpty:l.operators.stringOperatorIsNot;case"LIKE":return n.value.startsWith("%")&&n.value.endsWith("%")?(n.value=n.value.substring(1,n.value.length-1),l.operators.stringOperatorContains):n.value.endsWith("%")?(n.value=n.value.substring(0,n.value.length-1),l.operators.stringOperatorStartsWith):n.value.startsWith("%")?(n.value=n.value.substring(1),l.operators.stringOperatorEndsWith):l.operators.stringOperatorIs;case"NOT LIKE":return n.value.startsWith("%")&&n.value.endsWith("%")?n.value=n.value.substring(1,n.value.length-1):n.value.endsWith("%")?n.value=n.value.substring(0,n.value.length-1):n.value.startsWith("%")&&(n.value=n.value.substring(1)),l.operators.stringOperatorDoesNotContain;case"IS":return"null"===n.type?l.operators.stringOperatorIsBlank:l.operators.stringOperatorIs;case"ISNOT":case"IS NOT":return"null"===n.type?l.operators.stringOperatorIsNotBlank:l.operators.stringOperatorIs;case"IN":return l.operators.stringOperatorIncludes;case"NOT IN":case"NOTIN":return l.operators.stringOperatorExcludes}else if("number"===r.simpleFieldType||"oid"===r.simpleFieldType)switch(t){case"=":return l.operators.numberOperatorIs;case"<>":return l.operators.numberOperatorIsNot;case">=":return l.operators.numberOperatorIsAtLeast;case"<":return l.operators.numberOperatorIsLessThan;case"<=":return l.operators.numberOperatorIsAtMost;case">":return l.operators.numberOperatorIsGreaterThan;case"BETWEEN":return l.operators.numberOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return l.operators.numberOperatorIsNotBetween;case"IS":return"null"===n.type?l.operators.numberOperatorIsBlank:l.operators.numberOperatorIs;case"ISNOT":case"IS NOT":return"null"===n.type?l.operators.numberOperatorIsNotBlank:l.operators.numberOperatorIs;case"IN":return l.operators.numberOperatorIncludes;case"NOT IN":case"NOTIN":return l.operators.numberOperatorExcludes}else switch(t){case"=":return l.operators.dateOperatorIsOn;case"<>":return l.operators.dateOperatorIsNotOn;case"<":return l.operators.dateOperatorIsBefore;case">":return l.operators.dateOperatorIsAfter;case"<=":return l.operators.dateOperatorIsBeforeOrEqual;case">=":return l.operators.dateOperatorIsAfterOrEqual;case"BETWEEN":return"current-time"===(null===(s=null===(i=n.value[0])||void 0===i?void 0:i.left)||void 0===s?void 0:s.type)?l.operators.dateOperatorInTheLast:l.operators.dateOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return"current-time"===(null===(o=null===(a=n.value[0])||void 0===a?void 0:a.left)||void 0===o?void 0:o.type)?l.operators.dateOperatorNotInTheLast:l.operators.dateOperatorIsNotBetween;case"IS":if("null"===n.type)return l.operators.dateOperatorIsBlank;case"ISNOT":case"IS NOT":if("null"===n.type)return l.operators.dateOperatorIsNotBlank;case"IN":return l.operators.dateOperatorIncludes;case"NOT IN":case"NOTIN":return l.operators.dateOperatorExcludes}return""}(r,e.operator,i,e.right):void 0;if(!i||!a)return!1;{let o;if("null"===e.right.type)o={fieldName:i.layerField.name,operator:a};else{if("column-reference"===e.right.type)return!1;if("expression-list"===e.right.type&&Li(r,a)){if("imagery"===s.type)return!1;if(Ni(i)){const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:a,values:e.right.value.map((e=>Zi(e.value,t)))}}else o=Ei(i)?{fieldName:i.layerField.name,operator:a,values:e.right.value.map((e=>Hi(e.value)))}:wi(i)?{fieldName:i.layerField.name,operator:a,values:e.right.value.map((e=>_i(e.value)))}:{fieldName:i.layerField.name,operator:a,values:e.right.value.map((e=>e.value))}}else if("expression-list"===e.right.type&&Vi(r,a)){const t=function(e){const t=e.right.value[0].right;let r=t.value;if("interval"!==t.type){if(isNaN(r))return null;if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"};{const e=Math.round(24*r*60);return e%60==0?{value:Math.round(24*r),unit:"hour"}:{value:e,unit:"minute"}}}if(r="string"===t.value.type?parseFloat(t.value.value):t.value.value,"day"===t.qualifier.period){if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"}}else{if("hour"===t.qualifier.period)return{value:r,unit:"hour"};if("minute"===t.qualifier.period)return{value:r,unit:"minute"}}}(e);if(!t)return!1;o={fieldName:i.layerField.name,operator:a,value:t.value,unit:t.unit}}else if("expression-list"===e.right.type&&Ci(r,a))if(Ni(i)){const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:a,value:Zi(e.right.value[0].value,t),value2:Zi(e.right.value[1].value,t)}}else o=Ei(i)?{fieldName:i.layerField.name,operator:a,value:Hi(e.right.value[0].value),value2:Hi(e.right.value[1].value)}:wi(i)?{fieldName:i.layerField.name,operator:a,value:_i(e.right.value[0].value),value2:_i(e.right.value[1].value)}:{fieldName:i.layerField.name,operator:a,value:e.right.value[0].value,value2:e.right.value[1].value};else if("timestamp"===e.right.type)if(i.simpleFieldType===O.DATE_ONLY)o={fieldName:i.layerField.name,operator:a,value:null===(n=e.right.value)||void 0===n?void 0:n.substring(0,10)};else{const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:a,value:Zi(e.right.value,t)}}else if("date"===e.right.type)if("date-only"===i.layerField.type)o={fieldName:i.layerField.name,operator:a,value:Hi(e.right.value)};else{const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:a,value:Zi(e.right.value,t)}}else o="time"===e.right.type?{fieldName:i.layerField.name,operator:a,value:_i(e.right.value)}:{fieldName:i.layerField.name,operator:a,value:e.right.value}}t.push(o)}return!0}return!1}{let n;if(r.expressions=r.expressions||[],ji(e.left)&&ji(e.right))t.logicalOperatorForConditions=Wi(e),n=Pi(e.left,t.conditions,r),n=n&&Pi(e.right,t.conditions,r);else if(ji(e.left))if(e.operator===e.right.operator&&ji(e.right.left)&&ji(e.right.right))t.logicalOperatorForConditions=Wi(e),n=Pi(e.left,t.conditions,r),n=n&&Pi(e.right,t,r);else{n=Pi(e.left,t.conditions,r);const i={conditions:[]};r.expressions.push(i),n=n&&Pi(e.right,i,r)}else if(ji(e.right))if(e.operator===e.left.operator&&ji(e.left.right)&&(ji(e.left.left)||e.left.operator===(null===(i=e.left.left)||void 0===i?void 0:i.operator)))t.logicalOperatorForConditions=Wi(e),n=Pi(e.left,t,r),n=n&&Pi(e.right,t.conditions,r);else{n=Pi(e.left,t,r);const i={conditions:[]};r.expressions.push(i),n=n&&Pi(e.right,i.conditions,r)}else if(e.operator===e.right.operator&&e.operator===e.left.operator)t.logicalOperatorForConditions=Wi(e),n=Pi(e.left,t,r),n=n&&Pi(e.right,t,r);else{n=Pi(e.left,t,r);const i={conditions:[]};r.expressions.push(i),n=n&&Pi(e.right,i,r)}return n}}function ji(e){return"binary-expression"!==e.type||"OR"!==e.operator&&"AND"!==e.operator}function Wi(e){return"OR"===e.operator.toUpperCase()?y.OR:y.AND}function Zi(e,t){return Xn.fromFormat(e,"yyyy-MM-dd TT",{numberingSystem:"latn",zone:t}).toMillis()}function _i(e){return si(e)}function Hi(e){return new Date(`${e} 00:00:00`).getTime()}const Yi=class{constructor(e){(0,n.r)(this,e),this.arcgisFilterWhereChange=(0,n.c)(this,"arcgisFilterWhereChange",7),this.arcgisFilterSave=(0,n.c)(this,"arcgisFilterSave",7),this.arcgisFilterCancel=(0,n.c)(this,"arcgisFilterCancel",7),this.arcgisFilterDismissedChange=(0,n.c)(this,"arcgisFilterDismissedChange",7),this.arcgisFilterDone=(0,n.c)(this,"arcgisFilterDone",7),this.arcgisFilterPanelBackClick=(0,n.c)(this,"arcgisFilterPanelBackClick",7),this.closeFilterPopovers=(0,n.c)(this,"closeFilterPopovers",7),this.arcgisFilterExpressionChanged=(0,n.c)(this,"arcgisFilterExpressionChanged",7),this.layerViewWaitHandler=null,this.layerHasFeatureEffect=!1,this.properClose=!1,this.applyFilter=()=>{const{props:e,mode:t}=this,{layerView:r,layer:n,labelClassIdx:i,labelClass:s,originalLayer:a}=e;if(this.closeFilterPopovers.emit(),E(i)||E(s))this.arcgisFilterSave.emit();else if("layer-view"===t){const t=Ai(e);this.arcgisFilterSave.emit(t)}else if("effects"===t);else if(n){const t=Ai(e);(a||n).definitionExpression=t,this.isAllowedFeatureEffect()?n.featureEffect=null:r&&"filter"in r&&(r.filter=null),ki(e),this.properClose=!0,this.arcgisFilterSave.emit(),this.componentStateInvalid=!0}},this.cancelFilter=()=>{this.revertFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterCancel.emit()},this.closeFilter=()=>{this.applyFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterDismissedChange.emit()},this.onAddExpression=()=>{const{props:e}=this,{expressions:t}=e,r=vi(e);if(!r)return;const n=xi(e,r),i=gi(e,r,n),s={conditions:[Object.assign(Object.assign({fieldName:r.layerField.name,operator:n},i),{hasFocus:!0})]};e.expressions=k(t?[...t.map((e=>Object.assign(Object.assign({},e),{conditions:e.conditions.map((e=>Object.assign(Object.assign({},e),{hasFocus:!1})))}))),s]:[s]),E(i.value)&&this.arcgisFilterExpressionChanged.emit({type:"replace",expression:s}),this.reRender=!this.reRender},this.onMatchSelect=e=>{const{props:t}=this,r=e.target;t.logicalOperatorForExpressions=r.selectedOption.value,this.reRender=!this.reRender,this.applyFilterToLayer()},this.onRemoveFilter=()=>{const{props:e}=this;e.invalidFilter=!1,e.expressions=void 0,this.reRender=!this.reRender,this.applyFilterToLayer()},this.focusByClass=()=>{const e=this.hostElement.querySelector("arcgis-filter .autofocus");e&&(e.nodeName.startsWith("CALCITE-")?e.setFocus():e.focus())},this.view=void 0,this.layer=void 0,this.labelClassIdx=void 0,this.labelClass=void 0,this.mode=void 0,this.viewFilter=void 0,this.featureReduction=void 0,this.hideLayerTitle=!1,this.panelHeading=void 0,this.tipHeading=void 0,this.tipMsg=void 0,this.invalidHeading=void 0,this.invalidMsg=void 0,this.newButtonLabel=void 0,this.clearText=void 0,this.leadingText=void 0,this.defaultFieldName=void 0,this.defaultOperator=void 0,this.defaultExpression=!1,this.hideButtons=!1,this.panelMaxHeight=void 0,this.dismissible=!1,this.withinModal=!1,this.props=void 0,this.reRender=!1,this.componentStateInvalid=!1}arcgisFilterExpressionChangeHandler(e){var t;const{props:r}=this,{expressions:n}=r,{detail:i}=e;if("copy"===i.type){const t=e.detail.expression;let s;r.expressions=r.expressions.map((e=>e.uid===t.uid?t:e)),r.expressions=n.map((e=>Object.assign(Object.assign({},e),{conditions:e.conditions.map((e=>Object.assign(Object.assign({},e),{hasFocus:!1})))}))),r.expressions.forEach((e=>{e.uid===i.uid&&(s=this.esriLang.clone(Object.assign({},e)),s.conditions[0].hasFocus=!0)})),r.expressions=k([...r.expressions,s]),this.reRender=!this.reRender}else if("delete"===i.type){let e=0;n.forEach(((t,r)=>{t.uid===i.uid?e=r:t.conditions.forEach((e=>e.hasFocus=!1))})),r.expressions=n.filter((e=>e.uid!==i.uid)),(null===(t=r.expressions)||void 0===t?void 0:t.length)?(r.expressions[Math.max(0,e-1)].conditions[0].hasFocus=!0,r.expressions=k([...r.expressions]),setTimeout((()=>this.focusByClass()),500)):setTimeout((()=>this.fabNode.setFocus()),500),this.reRender=!this.reRender}else{const t=e.detail.expression;r.expressions=r.expressions.map((e=>e.uid===t.uid?Object.assign({},t):e))}this.applyFilterToLayer()}disableFilterPanelHandler(e){this.panelNode.disabled=e.detail}async setFocus(){this.panelNode.setFocus()}async done(){this.componentStateInvalid||(this.applyFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterDone.emit())}async closePopovers(){this.closeFilterPopovers.emit()}async openPanel(){this.panelNode.closed=!1}async componentWillLoad(){const[e,t,r]=await(0,i.g)(this.hostElement);this.props={expressions:void 0,logicalOperatorForExpressions:"and",fields:[],operators:void 0,invalidFilter:!1,stringFieldsCount:0,dateFieldsCount:0,numberFieldsCount:0,isHosted:!1,supportsStandardizedQuery:!1,supportedSqlParserVersion:!1,layer:{},view:this.view,labelClassIdx:this.labelClassIdx,labelClass:this.labelClass,featureReduction:this.featureReduction,strings:e,locale:t,localeIntl:r,inputDefinitionExpression:null,backgroundTheme:"light",lastWhere:void 0,defaultFieldName:this.defaultFieldName,defaultOperator:this.defaultOperator,withinModal:this.withinModal,modules:{}};const[n,a,o,l,u,c,d,h,p]=await(0,s.l)(["esri/core/reactiveUtils","esri/views/support/colorUtils","esri/layers/ImageryLayer","esri/layers/FeatureLayer","esri/layers/support/FeatureEffect","esri/core/lang","esri/intl","esri/request","esri/arcade"]);this.reactiveUtils=n,this.colorUtils=a,this.ImageryLayer=o,this.FeatureLayer=l,this.FeatureEffect=u,this.esriLang=c,this.esriRequest=h,this.props.modules.intl=d,this.props.modules.arcade=p;const{view:f,layer:m}=this;let{props:v}=this;const g=m;if("esri.layers.support.Sublayer"===g.declaredClass){const e=g;f&&await this.reactiveUtils.whenOnce((()=>!f.updating));const t=await e.createFeatureLayer();await t.load(),this.props=Object.assign(Object.assign({},v),{layer:t,mapImageSublayer:e})}else if("imagery"===g.type||"subtype-group"===g.type||"catalog"===g.type)this.props=Object.assign(Object.assign({},v),{layer:g});else if(!f||"feature"===g.type&&g.isTable){let e;e=new this.FeatureLayer({url:g.url,layerId:g.layerId,popupTemplate:g.popupTemplate}),await e.load(),this.props=Object.assign(Object.assign({},v),{layer:e,originalLayer:g})}else this.props=Object.assign(Object.assign({},v),{layer:g});const{labelClassIdx:y,labelClass:O,featureReduction:I}=this.props,b=I?m.featureReduction.labelingInfo:m.labelingInfo;(!E(y)||b&&b[y])&&(!E(O)||b&&b.length)?(await this.processLayer(),this.updateMessageBundle()):console.log("can't find labelClass")}componentDidLoad(){var e;const{props:t,defaultExpression:r}=this;!(null===(e=t.expressions)||void 0===e?void 0:e.length)&&r&&this.onAddExpression(),requestAnimationFrame((()=>{var e;return null===(e=this.panelNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.properClose?this.closeFilterPopovers.emit():(this.applyFilter(),"layer-view"===this.mode&&ki(this.props))}render(){var e,t,r;const{props:i,hideLayerTitle:s,mode:o,panelHeading:l,componentStateInvalid:u,dismissible:c,hostElement:d,panelMaxHeight:h}=this,p="rtl"===(0,a.g)(d),{layer:f,mapImageSublayer:m,invalidFilter:v,strings:g}=i,y=m?m.title:f.title;return u?(0,n.h)(n.H,null,(0,n.h)("div",null)):f?v?this.renderInvalidFilter():"CALCITE-FLOW"===(null===(e=d.parentElement)||void 0===e?void 0:e.tagName)||"CALCITE-FLOW"===(null===(r=null===(t=d.parentElement)||void 0===t?void 0:t.parentElement)||void 0===r?void 0:r.tagName)?(0,n.h)(n.H,null,(0,n.h)("calcite-flow-item",{id:"filter-panel",loading:!1,heading:l||g.title,description:s?void 0:y,class:{[a.C.rtl]:p},style:h&&{maxHeight:h},closable:c,ref:e=>this.panelNode=e,onCalciteFlowItemBack:()=>{if("layer-view"===o){const e=Ai(i);this.arcgisFilterPanelBackClick.emit(e)}else this.arcgisFilterPanelBackClick.emit()},onCalciteFlowItemClose:()=>this.closeFilter()},this.renderContent())):(0,n.h)(n.H,null,(0,n.h)("calcite-panel",{id:"filter-panel",loading:!1,heading:l||g.title,description:s?void 0:y,class:{[a.C.rtl]:p},style:h&&{maxHeight:h},closable:c,ref:e=>this.panelNode=e,onCalcitePanelClose:()=>this.closeFilter()},this.renderContent())):this.renderLoading()}renderContent(){const{props:e,mode:t,hideButtons:r}=this,{labelClassIdx:i,labelClass:s}=e,a=E(i)||E(s);return(0,n.h)(n.F,null,a||"layer-view"===t||r?null:this.renderSaveButton(),a||"layer-view"===t||r?null:this.renderCancelButton(),this.renderPopoverHook(),this.renderHeaderInfo(),this.renderMatchExpressionMsg(),this.renderExpressions(),this.renderAddExpression(),this.renderTip())}renderSaveButton(){const{props:e}=this,{strings:t}=e;return(0,n.h)("calcite-button",{slot:"footer",onClick:this.applyFilter,appearance:"solid",width:"half",label:t.save},t.save)}renderCancelButton(){const{props:e}=this,{strings:t}=e;return(0,n.h)("calcite-button",{slot:"footer",onClick:this.cancelFilter,appearance:"outline-fill",width:"half",label:t.cancel},t.cancel)}renderPopoverHook(){return(0,n.h)("div",{id:"arcgis-filter-hook",class:u})}renderHeaderInfo(){const{props:e,leadingText:t,clearText:r}=this,{strings:i,expressions:s}=e;return s&&s.length?(0,n.h)("div",{class:p},(0,n.h)("calcite-label",{class:"heading",layout:"inline-space-between"},t||i.showFeaturesWhere,(0,n.h)("calcite-button",{class:"clear",appearance:"transparent",onClick:this.onRemoveFilter},r||i.clearAll))):null}renderLoading(){const{props:e,hideLayerTitle:t,panelHeading:r}=this,{layer:i,mapImageSublayer:s,strings:o}=e,l=s?s.title:i.title,u="rtl"===(0,a.g)(this.hostElement);return(0,n.h)(n.H,null,(0,n.h)("calcite-panel",{id:"filter-panel",heading:r||o.title,description:t?void 0:l,loading:!0,class:{panel:!0,[a.C.rtl]:u}}))}renderInvalidFilter(){const{props:e,hideLayerTitle:t,dismissible:r,panelHeading:i,hostElement:s}=this,{layer:o,mapImageSublayer:l,strings:u}=e,c=l?l.title:o.title,d="rtl"===(0,a.g)(this.hostElement);return"CALCITE-FLOW"===s.parentElement.tagName||"CALCITE-FLOW"===s.parentElement.parentElement.tagName?(0,n.h)(n.H,null,(0,n.h)("calcite-flow-item",{id:"filter-panel",heading:i||u.title,description:t?void 0:c,loading:!1,closable:r,class:{panel:!0,[a.C.rtl]:d},ref:this.focusByClass,onCalciteFlowItemBack:()=>this.arcgisFilterPanelBackClick.emit(),onCalciteFlowItemClose:()=>this.closeFilter()},this.renderInvalidContent())):(0,n.h)(n.H,null,(0,n.h)("calcite-panel",{id:"filter-panel",heading:i||u.title,description:t?void 0:c,loading:!1,closable:r,class:{panel:!0,[a.C.rtl]:d},ref:this.focusByClass,onCalcitePanelClose:()=>this.closeFilter()},this.renderInvalidContent()))}renderInvalidContent(){const{props:e,mode:t,hideButtons:r}=this,{labelClassIdx:i,labelClass:s}=e,a=E(i)||E(s);return(0,n.h)(n.F,null,a||"layer-view"===t||r?null:this.renderSaveButton(),a||"layer-view"===t||r?null:this.renderCancelButton(),this.renderInvalidFilterMsg())}renderInvalidFilterMsg(){const{invalidHeading:e,invalidMsg:t,props:r}=this,{strings:i}=r;return(0,n.h)("div",{class:g},(0,n.h)("calcite-notice",{scale:"s",width:"full",kind:"danger",icon:"exclamation-mark-triangle",open:!0},(0,n.h)("div",{slot:"title"},e||i.errors.problemDisplayingFilter),(0,n.h)("div",{slot:"message"},t||i.errors.problemDisplayingFilterMsg),(0,n.h)("calcite-link",{slot:"link",onClick:this.onRemoveFilter},i.createNewFilter)))}renderMatchExpressionMsg(){const{props:e}=this,{expressions:t,logicalOperatorForExpressions:r,strings:i}=e;if(!t||!t.length)return null;const s=r===y.AND;return t.length>1?(0,n.h)("div",{class:f},(0,n.h)("calcite-label",{class:"no-space",scale:"m"},(0,n.h)("calcite-select",{width:"full",scale:"m",label:i.accessibility.matchType,class:m,onCalciteSelectChange:this.onMatchSelect},(0,n.h)("calcite-option",{value:y.AND,label:i.matchAll,selected:s}),(0,n.h)("calcite-option",{value:y.OR,label:i.matchAtLeastOne,selected:!s})))):null}renderExpressions(){const{props:e}=this,{expressions:t}=e;return t&&t.length?(0,n.h)("div",null,t.map(((e,t)=>this.renderExpression(e,t)))):null}renderExpression(e,t){const{props:r}=this;return(0,n.h)("div",null,this.renderLogicalOperatorExpression(t),(0,n.h)("arcgis-filter-expression",Object.assign({props:r,ref:this.focusByClass},e)))}renderLogicalOperatorExpression(e){const{props:t}=this,{logicalOperatorForExpressions:r,strings:i}=t;return 0===e?null:(0,n.h)("div",{class:v},(0,n.h)("span",null,r===y.OR?i.or:i.and))}renderAddExpression(){const{props:e,hideButtons:t}=this,{expressions:r,strings:i}=e;return(0,n.h)("calcite-fab",{class:{autofocus:!r||!r.length,"fab-padding":t},slot:"fab",appearance:"outline-fill",kind:"neutral",icon:"plus",textEnabled:!0,text:i.addNew,onClick:this.onAddExpression,ref:e=>this.fabNode=e})}renderTip(){const{props:e,mode:t,tipMsg:r}=this,{mapImageSublayer:i,expressions:s,labelClassIdx:a,labelClass:o,strings:l}=e;if(null==s?void 0:s.length)return null;const u=E(a)||E(o);return(0,n.h)("div",{class:c},!r&&(0,n.h)("calcite-icon",{class:d,icon:"layer-filter"}),(0,n.h)("div",{class:h},r||(u?l.tips.emptyMsgLabels:i||"layer-view"===t?l.tips.emptyMsgMS:l.tips.emptyMsg)))}async processLayer(){var e;const{props:t,mode:r,viewFilter:n,hideButtons:i}=this,{layer:s,mapImageSublayer:a,originalLayer:o,view:l,labelClassIdx:u,labelClass:c,featureReduction:d}=t,h="feature"===s.type&&(d?s.featureReduction.labelingInfo:s.labelingInfo);if(!l||a||"imagery"===s.type||"subtype-group"===s.type||"catalog"===s.type||"feature"===s.type&&s.isTable||(t.layerView=await l.whenLayerView(s)),function(e){var t,r;const{layer:n,mapImageSublayer:i}=e,s=n.url;if(e.supportsStandardizedQuery="version"in n&&n.version>=10.2&&!!(null===(r=null===(t=n.capabilities)||void 0===t?void 0:t.query)||void 0===r?void 0:r.supportsStandardizedQueriesOnly),e.supportedSqlParserVersion="feature"===n.type&&e.supportsStandardizedQuery&&n.sourceJSON.sqlParserVersion&&"ES_10.6.1"!==n.sourceJSON.sqlParserVersion,!s||i)return void(e.isHosted=!1);const a=-1!==s.indexOf(".arcgis.com/"),o=-1!==s.indexOf("//services")||-1!==s.indexOf("//tiles")||-1!==s.indexOf("//features")||-1!==s.indexOf("//locationservices")||-1!==s.indexOf("//us-iot")||-1!==s.indexOf("//eu-iot");e.isHosted=a&&o||!a&&!1}(t),await pi(t),function(e){const{layer:t,featureReduction:r,strings:n}=e,i="esri.layers.StreamLayer"===t.declaredClass,s="esri.layers.ImageryLayer"===t.declaredClass;e.operators||(e.operators={},e.operators[O.STRING]=[],e.operators[O.STRING].push({name:n.operators.stringOperatorIs}),e.operators[O.STRING].push({name:n.operators.stringOperatorIsNot}),i||s||(e.operators[O.STRING].push({name:n.operators.stringOperatorIncludes}),e.operators[O.STRING].push({name:n.operators.stringOperatorExcludes})),e.operators[O.STRING].push({name:n.operators.stringOperatorStartsWith}),e.operators[O.STRING].push({name:n.operators.stringOperatorEndsWith}),e.operators[O.STRING].push({name:n.operators.stringOperatorContains}),e.operators[O.STRING].push({name:n.operators.stringOperatorDoesNotContain}),e.operators[O.STRING].push({name:n.operators.stringOperatorIsBlank}),e.operators[O.STRING].push({name:n.operators.stringOperatorIsNotBlank}),e.operators[O.STRING].push({name:n.operators.stringOperatorIsEmpty}),e.operators[O.STRING].push({name:n.operators.stringOperatorIsNotEmpty}),e.operators[O.DATE]=[],e.operators[O.DATE].push({name:n.operators.dateOperatorIsOn}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsNotOn}),i||(e.operators[O.DATE].push({name:n.operators.numberOperatorIncludes}),e.operators[O.DATE].push({name:n.operators.numberOperatorExcludes})),e.operators[O.DATE].push({name:n.operators.dateOperatorIsBefore}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsAfter}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsBeforeOrEqual}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsAfterOrEqual}),(e.isHosted||e.supportedSqlParserVersion||"feature"===t.type&&t.version>=10.91&&e.supportsStandardizedQuery)&&(e.operators[O.DATE].push({name:n.operators.dateOperatorInTheLast}),e.operators[O.DATE].push({name:n.operators.dateOperatorNotInTheLast})),e.operators[O.DATE].push({name:n.operators.dateOperatorIsBetween}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsNotBetween}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsBlank}),e.operators[O.DATE].push({name:n.operators.dateOperatorIsNotBlank}),e.operators[O.DATE_ONLY]=[],e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsOn}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsNotOn}),i||(e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIncludes}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorExcludes})),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsBefore}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsAfter}),(e.isHosted||e.supportedSqlParserVersion)&&(e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorInTheLast}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorNotInTheLast})),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsBetween}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsNotBetween}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsBlank}),e.operators[O.DATE_ONLY].push({name:n.operators.dateOperatorIsNotBlank}),e.operators[O.TIME_ONLY]=[],e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsOn}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsNotOn}),i||(e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIncludes}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorExcludes})),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsBefore}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsAfter}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsBeforeOrEqual}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsAfterOrEqual}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsBetween}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsNotBetween}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsBlank}),e.operators[O.TIME_ONLY].push({name:n.operators.dateOperatorIsNotBlank}),e.operators[O.NUMBER]=[],e.operators[O.NUMBER].push({name:n.operators.numberOperatorIs}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsNot}),r||i||s||(e.operators[O.NUMBER].push({name:n.operators.numberOperatorIncludes}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorExcludes})),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsAtLeast}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsLessThan}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsAtMost}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsGreaterThan}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsBetween}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsNotBetween}),r||(e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsBlank}),e.operators[O.NUMBER].push({name:n.operators.numberOperatorIsNotBlank})),e.operators[O.DOMAIN]=[],e.operators[O.DOMAIN].push({name:n.operators.stringOperatorIs}),e.operators[O.DOMAIN].push({name:n.operators.stringOperatorIsNot}),i||s||s||(e.operators[O.DOMAIN].push({name:n.operators.stringOperatorIncludes}),e.operators[O.DOMAIN].push({name:n.operators.stringOperatorExcludes})),e.operators[O.DOMAIN].push({name:n.operators.stringOperatorIsBlank}),e.operators[O.DOMAIN].push({name:n.operators.stringOperatorIsNotBlank}))}(t),t.backgroundTheme=l&&await this.colorUtils.getBackgroundColorTheme(l),this.layerHasFeatureEffect=s.featureEffect,E(u)&&h[u].where){t.inputDefinitionExpression=h[u].where;const e=await Bi(t.inputDefinitionExpression,t);t.invalidFilter=!e,this.reRender=!this.reRender}else if(E(c)&&c.where){t.inputDefinitionExpression=c.where,t.lastWhere=t.inputDefinitionExpression;const e=await Bi(t.inputDefinitionExpression,this.props);t.invalidFilter=!e,this.reRender=!this.reRender}else if("layer-view"===r){if(n){const e=await Bi(n,t);t.invalidFilter=!e,e&&this.applyFilterToLayer(!0),this.reRender=!this.reRender}}else if("effects"===r){if(t.invalidFilter=!1,s.featureEffect){t.inputDefinitionExpression=null===(e=s.featureEffect.filter)||void 0===e?void 0:e.where,t.lastWhere=t.inputDefinitionExpression;const r=await Bi(t.inputDefinitionExpression,t);t.invalidFilter=!r,this.reRender=!this.reRender}}else if(E(u)||E(c)||!E(s.definitionExpression)&&!E(null==o?void 0:o.definitionExpression))if(i){t.inputDefinitionExpression=s.definitionExpression,t.lastWhere=t.inputDefinitionExpression;const e=await Bi(t.inputDefinitionExpression,this.props);t.invalidFilter=!e,this.reRender=!this.reRender}else t.invalidFilter=!1;else{t.inputDefinitionExpression=(o||s).definitionExpression;const e=await Bi(t.inputDefinitionExpression,t);t.invalidFilter=!e,e&&this.applyFilterToLayer(!0),this.reRender=!this.reRender,!l||"imagery"===s.type||"subtype-group"===s.type||"catalog"===s.type||"feature"===s.type&&s.isTable||"effects"===r&&this.layerHasFeatureEffect||(s.definitionExpression=null)}}revertFilter(){var e,t,r,n;const{props:i,mode:s,viewFilter:a}=this,{layer:o,layerView:l,featureReduction:u,labelClassIdx:c,labelClass:d,inputDefinitionExpression:h,mapImageSublayer:p,originalLayer:f,backgroundTheme:m}=i,v=this.getLabelClassIndex();if("imagery"!==o.type&&"subtype-group"!==o.type&&"catalog"!==o.type&&E(c)){(u?o.featureReduction.labelingInfo:o.labelingInfo)[c].where=h,u?(o.featureReduction=this.esriLang.clone(o.featureReduction),i.labelClass=o.featureReduction.labelingInfo[v]):o.labelingInfo=o.labelingInfo,p&&(p.labelingInfo=o.labelingInfo)}else if("imagery"!==o.type&&"subtype-group"!==o.type&&"catalog"!==o.type&&E(d))d.where=h,u?(o.featureReduction=this.esriLang.clone(o.featureReduction),i.labelClass=o.featureReduction.labelingInfo[v]):o.labelingInfo=o.labelingInfo,p&&(p.labelingInfo=o.labelingInfo);else if("layer-view"===s){if("feature"===o.type)if(a)if(w(o.featureEffect)){const e="light"===m?100:65;o.featureEffect=new this.FeatureEffect({filter:{where:a},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else o.featureEffect.filter.where=a,o.featureEffect=o.featureEffect.clone();else(null===(t=null===(e=o.featureEffect)||void 0===e?void 0:e.filter)||void 0===t?void 0:t.where)?(o.featureEffect.filter.where=null,w(o.featureEffect)?o.featureEffect=null:o.featureEffect=o.featureEffect.clone()):o.featureEffect=null}else if("effects"===s);else if(o){if(p?p.definitionExpression=h:(f||o).definitionExpression=h,this.isAllowedFeatureEffect()){const e=o;(null===(n=null===(r=e.featureEffect)||void 0===r?void 0:r.filter)||void 0===n?void 0:n.where)&&(e.featureEffect.filter.where=null,w(e.featureEffect)?e.featureEffect=null:e.featureEffect=e.featureEffect.clone())}else l&&"filter"in l&&(l.filter=null);this.componentStateInvalid=!0}}applyFilterToLayer(e){var t,r;const{props:n,layerViewWaitHandler:i,hideButtons:s}=this,{backgroundTheme:a,labelClass:o,layer:l,labelClassIdx:u,view:c,layerView:d,mapImageSublayer:h,originalLayer:p,featureReduction:f,lastWhere:m}=n,v=Ai(n)||void 0;if(e||v===m||this.arcgisFilterWhereChange.emit(v),n.lastWhere=v,"feature"===l.type&&E(u)){const e=this.getLabelClassIndex();return(f?l.featureReduction.labelingInfo:l.labelingInfo)[u].where=v,f?(l.featureReduction=this.esriLang.clone(l.featureReduction),n.labelClass=l.featureReduction.labelingInfo[e]):l.labelingInfo=l.labelingInfo,void(h&&(h.labelingInfo=l.labelingInfo))}if(!E(o))if("imagery"!==l.type&&"subtype-group"!==l.type&&"catalog"!==l.type){if(!s)if(h)h.definitionExpression=v;else if(!c||"feature"===l.type&&l.isTable)p.definitionExpression=Ai(n);else if(i&&(clearTimeout(i),this.layerViewWaitHandler=void 0),d)if(null==v?void 0:v.length)if(this.isAllowedFeatureEffect())if(w(l.featureEffect)){const e="light"===a?100:65;l.featureEffect=new this.FeatureEffect({filter:{where:v},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else l.featureEffect.filter=l.featureEffect.filter||{},l.featureEffect.filter.where=v,l.featureEffect=l.featureEffect.clone();else"filter"in d&&(d.filter={where:v});else this.isAllowedFeatureEffect()?(null===(r=null===(t=l.featureEffect)||void 0===t?void 0:t.filter)||void 0===r?void 0:r.where)&&(l.featureEffect.filter.where=null,w(l.featureEffect)?l.featureEffect=null:l.featureEffect=l.featureEffect.clone()):"filter"in d&&(d.filter=null);else this.layerViewWaitHandler=setTimeout((()=>{this.applyFilterToLayer()}),500)}else l.definitionExpression=v}isAllowedFeatureEffect(){const{props:e,layerHasFeatureEffect:t,mode:r}=this,{layer:n}=e;return["feature","geojson","ogc-feature","wfs","csv","stream"].indexOf(n.type)>-1&&!n.featureReduction&&"effects"!==r&&(!t||"layer-view"===r)}getLabelClassIndex(){const{props:e}=this,{layer:t,labelClass:r,featureReduction:n}=e;let i=-1;const s="feature"===t.type&&(n?t.featureReduction.labelingInfo:t.labelingInfo);return r&&s.forEach(((e,t)=>{JSON.stringify(e.toJSON())===JSON.stringify(r.toJSON())&&(i=t)})),i}async updateMessageBundle(){var e,t;const{esriRequest:r,props:i}=this,{dateFieldsCount:s,locale:a}=i;if(s){const s="./assets/input-time-zone/t9n/messages",o=(0,n.a)(s),l=`${o}_${a}.json`;try{const t=await r(l,{responseType:"text"});i.inputTimeZoneMessages=JSON.parse(null!==(e=null==t?void 0:t.data)&&void 0!==e?e:{})}catch(e){const n=await r(`${o}_en.json`,{responseType:"text"});i.inputTimeZoneMessages=JSON.parse(null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{})}}}get hostElement(){return(0,n.d)(this)}};Yi.style=".sc-arcgis-filter-h{display:flex;flex:1 1 auto;overflow:hidden}.fab-padding.sc-arcgis-filter{padding-bottom:1rem}.hook.sc-arcgis-filter{width:100%;height:1px}.notice.sc-arcgis-filter{margin:8px}.empty-msg.sc-arcgis-filter{margin:40px 10px 0 10px}.msg-icon.sc-arcgis-filter,.tip-msg.sc-arcgis-filter{display:flex;justify-content:center;align-items:center;width:100%;margin-bottom:30px}.tip-msg.sc-arcgis-filter{display:flex;justify-content:center;align-items:center;text-align:center}.header-info.sc-arcgis-filter{padding:8px 0 8px 15px}.match-expression-dropdown.sc-arcgis-filter{width:100%}.match-expression-msg.sc-arcgis-filter{padding:12px}.match-type.sc-arcgis-filter{display:flex;align-items:flex-start;margin:10px 22px 8px 22px}.arcgis--rtl.sc-arcgis-filter .match-type.sc-arcgis-filter{align-items:flex-end}.arcgis--rtl.sc-arcgis-filter .header-info.sc-arcgis-filter{padding-left:0;padding-right:15px}.heading.sc-arcgis-filter{--calcite-label-margin-bottom:0;font-weight:bold}.clear.sc-arcgis-filter{margin:0 4px}";const zi="field-selection",Gi="delete-action",Ji="filter-condition",Ki="operator-dropdown",Qi="input-plus-unique",Xi="input",es="label",ts="blank-button",rs="select-unique-button",ns="between-values-input",is="select-values",ss="pick-list",as="unique-values-content-list-msg",os="in-the-last",ls="in-the-last-count",us="in-the-last-unit",cs="date-picker",ds="histogram-content",hs="histogram-content-slim",ps="small-loader",fs="time-zone",ms="time-zone-icon",vs=class{constructor(e){(0,n.r)(this,e),this.arcgisFilterConditionChanged=(0,n.c)(this,"arcgisFilterConditionChanged",7),this.arcgisFilterConditionDeleted=(0,n.c)(this,"arcgisFilterConditionDeleted",7),this.disableFilterPanel=(0,n.c)(this,"disableFilterPanel",7),this.arcgisFilterUniqueValuesReturned=(0,n.c)(this,"arcgisFilterUniqueValuesReturned",7),this.histogramSlider=void 0,this.isEditorField=!1,this.afterCreateSliderDiv=e=>{const{fieldName:t,props:r,histogramSlider:n}=this;e&&setTimeout((()=>{if(!n)return;const i=document.createElement("div");if(e.appendChild(i),n.container){const e=mi(t,r);if(!e)return;const{bins:s,average:a,min:o,max:l,values:u,precision:c,rangeType:d}=n,h={container:i,bins:s,average:a,min:o,max:l,values:u,precision:c,rangeType:d};[O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(e.simpleFieldType)>-1&&(h.hasTimeData=!0,this.addDateFormatFunctions(h,e)),n.destroy(),this.histogramSlider=new this.HistogramRangeSlider(h),this.createSliderChangeEvents(e)}else n.container=i}),1)},this.onFieldSelect=()=>{this.hasFocus=!0,this.openFieldPickList()},this.onOperatorSelect=e=>{var t,r,n,i;const{props:s,fieldName:a,operator:o,value:l,value2:u}=this,c=e.target.selectedOption.value,d=mi(a,s),h=Vi(s,o),p=Vi(s,c),f=h||p,m=h&&p,v=Ci(s,o),g=Ci(s,c),y=v&&g,O={value:l,value2:u,operator:o};this.value=f&&!m?null:d.statistics&&!E(l)?d.statistics.avg:l,this.value2=g?null!=u?u:Ti(d)?Math.round(null===(t=d.statistics)||void 0===t?void 0:t.max):null===(r=d.statistics)||void 0===r?void 0:r.max:f||!y?null:u,this.operator=c;const I=this.checkDefaultValues(d),b={value:null!==(n=this.value)&&void 0!==n?n:I.value,value2:null!==(i=this.value2)&&void 0!==i?i:g?I.value2:null,operator:this.operator,unit:this.unit||I.unit};this.value=O.value,this.value2=O.value2,this.operator=O.operator,this.emitChangeEvent(b)},this.onValueChangeMaybe=e=>{const{props:t,operator:r,value2:n}=this,i=this.getNewValue(e);E(i)&&Ci(t,r)&&i>=n||this.onValueChange(e,i)},this.onValueChange=(e,t)=>{t=null!=t?t:this.getNewValue(e);const{props:r,fieldName:n,operator:i,value:s,value2:a,intl:o}=this,{layer:l,view:u}=r,c=mi(n,r),d=null==e?void 0:e.target;if(!E(t=e?this.getNewValue(e):t)){const e=gi(r,c,i);t=e.value,d&&(c.simpleFieldType===O.DATE?d.value=ti(t,null==u?void 0:u.timeZone,"preferredTimeZone"in l&&l.preferredTimeZone):c.simpleFieldType===O.TIME_ONLY?d.value=ii(t,o):d.value=t)}if(s!==t){if(E(t)&&Ci(r,i)&&t>=a&&d)if(c.simpleFieldType===O.DATE)if(t=a-1e3,"CALCITE-INPUT-TIME-PICKER"===d.tagName){const e=ni(ti(t,null==u?void 0:u.timeZone,"preferredTimeZone"in l&&l.preferredTimeZone));requestAnimationFrame((()=>d.value=e))}else d.value=ti(t,null==u?void 0:u.timeZone,"preferredTimeZone"in l&&l.preferredTimeZone);else if(c.simpleFieldType===O.DATE_ONLY){const e=new Date(a-864e5);d.value=ai(e),t=new Date(e).getTime()}else c.simpleFieldType===O.TIME_ONLY?(t=a-1e3,requestAnimationFrame((()=>d.value=ii(t,o)))):(t=a-1,d.value=t);("CALCITE-INPUT-DATE-PICKER"===(null==d?void 0:d.tagName)||"CALCITE-INPUT-TIME-PICKER"===(null==d?void 0:d.tagName)||"CALCITE-INPUT"===(null==d?void 0:d.tagName)&&"number"===(null==d?void 0:d.type)||"CALCITE-INPUT-NUMBER"===(null==d?void 0:d.tagName))&&this.adjustHistogramMinMax(t),this.changeValues(t,a)}},this.onValue2ChangeMaybe=e=>{const{props:t,operator:r,value:n}=this,i=this.getNewValue(e);E(i)&&Ci(t,r)&&i<=n||this.onValue2Change(e,i)},this.onValue2Change=(e,t)=>{const{value:r,props:n,fieldName:i,operator:s,intl:a}=this,{layer:o,view:l}=n,u=mi(i,n),c=e.target;if(!E(t=null!=t?t:this.getNewValue(e))){const e=gi(n,u,s);t=e.value2,u.simpleFieldType===O.DATE?c.value=ti(t,null==l?void 0:l.timeZone,"preferredTimeZone"in o&&o.preferredTimeZone):u.simpleFieldType===O.TIME_ONLY?c.value=ii(t,a):c.value=t}if(E(t)&&t<=r)if(u.simpleFieldType===O.DATE)if(t=r+1e3,"CALCITE-INPUT-TIME-PICKER"===c.tagName){const e=ni(ti(t,null==l?void 0:l.timeZone,"preferredTimeZone"in o&&o.preferredTimeZone));requestAnimationFrame((()=>c.value=e))}else c.value=ti(t,null==l?void 0:l.timeZone,"preferredTimeZone"in o&&o.preferredTimeZone);else if(u.simpleFieldType===O.DATE_ONLY){const e=new Date(r+864e5);c.value=ai(e),t=new Date(e).getTime()}else u.simpleFieldType===O.TIME_ONLY?(t=r+1e3,requestAnimationFrame((()=>c.value=ii(t,a)))):(t=r+1,c.value=t);("CALCITE-INPUT-DATE-PICKER"===c.tagName||"CALCITE-INPUT-TIME-PICKER"===(null==c?void 0:c.tagName)||"CALCITE-INPUT"===c.tagName&&"number"===c.type||"CALCITE-INPUT-NUMBER"===(null==c?void 0:c.tagName))&&this.adjustHistogramMinMax(t),this.changeValues(r,t)},this.onUnitSelect=e=>{const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value})},this.onSelectUniqueValue=()=>{this.onSelectUnique(!1)},this.onSelectUniqueValues=()=>{const{props:e,fieldName:t,operator:r}=this,n=hi(mi(t,e)),i=Li(e,r),s=n&&!i;this.onSelectUnique(!s)},this.onDocumentClick=e=>{e.target.closest(`#arcgis-filter-unique-popover_${this.uid}`)||this.removeUniquePopover()},this.onRemoveSelectedValue=e=>{const{values:t,esriLang:r}=this,n=t.indexOf(e);t.splice(n,1),this.emitChangeEvent({values:t.length?r.clone(t):null})},this.afterCreateList=e=>{e&&this.scrollExprIntoView(e)},this.onHistogramBlockToggle=e=>{e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()},this.fieldPickListChanges=e=>{var t,r;e.stopPropagation();const n=null===(r=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===r?void 0:r[0];this.removeFieldsPickList(),n&&this.afterFieldSelect(n)},this.props=void 0,this.uid=void 0,this.fieldName=void 0,this.operator=void 0,this.uniqueValuesSortBy=void 0,this.value=void 0,this.value2=void 0,this.values=void 0,this.unit=void 0,this.histogramOpen=void 0,this.hasFocus=void 0,this.invalidValue=void 0,this.showDelete=!1,this.reRender=!1}arcgisFilterUniqueValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues(mi(t,this.props)),this.reRender=!this.reRender)}arcgisFilterUniqueListChangedHandler(e){var t;const{detail:r}=e;if(r.uid===this.uid){const e=r.selectedValues;if(r.multiple)this.emitChangeEvent({values:e,uniqueValuesSortBy:r.sortBy});else{this.uniqueValuesSortBy=r.sortBy;let n=(null==e?void 0:e.length)?e[0]:void 0;const{fieldName:i,props:s}=this,a=mi(i,s);E(n)&&a.simpleFieldType===O.TIME_ONLY&&(n=si(n)),this.onValueChange(null,n),this.removeUniquePopover(),null===(t=this.uniqueActionNode)||void 0===t||t.setFocus()}}}arcgisFilterUniqueListSortByChanged(e){const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}arcgisFilterUniqueListDoneHandler(e){var t;const{detail:r}=e;r===this.uid&&(this.removeUniquePopover(),null===(t=this.uniqueActionNode)||void 0===t||t.setFocus())}calcitePopoverCloseHandler(){var e;this.uniquePopoverNode&&(this.removeUniquePopover(),null===(e=this.uniqueActionNode)||void 0===e||e.setFocus())}closeFilterPopoversHandler(){this.removeFieldsPickList(),this.removeUniquePopover()}async componentWillLoad(){const e=vi({fields:this.props.fields});this.fieldName=this.fieldName||e.layerField.name,this.operator=this.operator||xi(this.props,e),this.hasFocus=!!this.hasFocus;const[t,r,n,i,a,o]=await(0,s.l)(["esri/core/lang","esri/intl","esri/smartMapping/statistics/summaryStatistics","esri/smartMapping/statistics/histogram","esri/smartMapping/statistics/uniqueValues","esri/widgets/HistogramRangeSlider"]);this.esriLang=t,this.intl=r,this.summaryStatistics=n,this.histogram=i,this.uniqueValues=a,this.HistogramRangeSlider=o,this.onDocumentClickBind=this.onDocumentClick.bind(this)}componentDidLoad(){this.setFocus()}disconnectedCallback(){this.removeFieldsPickList(),this.removeUniquePopover()}render(){var e;const{fieldName:t,props:r}=this,{layer:i}=r,s=mi(t,r);if(!s||!s.simpleFieldType)return(0,n.h)(n.H,null,(0,n.h)("div",null));const o="sourceJSON"in i?null===(e=i.sourceJSON)||void 0===e?void 0:e.editFieldsInfo:void 0;this.isEditorField=t===(null==o?void 0:o.creatorField)||t===(null==o?void 0:o.editorField);const l=(0,a.g)(this.hostElement);return(0,n.h)(n.H,{dir:l},(0,n.h)("div",{class:{[Ji]:!0,[a.C.rtl]:"rtl"===l}},this.renderFieldSelection(),this.renderOperatorSelection(s),this.renderValueInput(s),this.renderTimeZone(s),this.renderHistogram(s)))}renderFieldSelection(){const{hasFocus:e,fieldName:t,showDelete:r,props:i}=this,{fields:s,strings:a}=i,o=mi(t,i);return(0,n.h)("div",{class:zi},(0,n.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",disabled:s.length<=1,iconEnd:"chevron-down",class:""+(e?"autofocus":""),onClick:s.length>1?this.onFieldSelect:null,ref:e=>this.fieldNode=e},(null==o?void 0:o.label)||""),r?(0,n.h)("calcite-action",{class:Gi,label:a.remove,text:"",scale:"s",icon:"trash",onClick:()=>this.arcgisFilterConditionDeleted.emit()}):null)}renderOperatorSelection(e){const{props:t}=this,{operators:r,strings:i}=t;let s=e.simpleFieldType;if(!s)return null;s===O.GUID&&(s=O.STRING),s===O.OID&&(s=O.NUMBER),hi(e)&&(s=O.DOMAIN);let a=r[s];this.isEditorField&&(a=a.filter((e=>!Di(t,e.name)&&!Mi(t,e.name))));const o=a.map((e=>this.renderOperatorOption(e.name)));return(0,n.h)("calcite-select",{width:"full",scale:"m",label:i.accessibility.operator,class:Ki,onCalciteSelectChange:this.onOperatorSelect},o)}renderOperatorOption(e){const{operator:t}=this;return(0,n.h)("calcite-option",{value:e,label:e,selected:e===t})}renderValueInput(e){const{props:t,operator:r,invalidValue:i}=this,s=i?"invalid":void 0;let a=null;return Di(t,r)||Mi(t,r)?a=null:Li(t,r)?a=this.renderUniqueValues(e):Vi(t,r)?a=this.renderInTheLast(e):e.simpleFieldType===O.STRING||e.simpleFieldType===O.GUID||hi(e)?a=this.renderValueInputString(e,{status:s}):e.simpleFieldType===O.NUMBER?a=this.renderValueInputNumber(e,{status:s}):e.simpleFieldType===O.DATE?a=this.renderValueInputDate(e):e.simpleFieldType===O.DATE_ONLY?a=this.renderValueInputDateOnly(e):e.simpleFieldType===O.TIME_ONLY?a=this.renderValueInputTimeOnly(e):e.simpleFieldType===O.OID&&(a=this.renderValueInputOid(e,{status:s})),i?(0,n.h)("calcite-label",null,a,(0,n.h)("calcite-input-message",{icon:!0,status:s},i)):a}renderUniqueButton(e,t,r){const{props:i}=this,{layer:s,strings:a}=i;return e&&"imagery"!==s.type&&"subtype-group"!==s.type?(0,n.h)("calcite-action",{class:rs,disabled:t,loading:!!r,text:a.chooseFromUnique,scale:"s",icon:"chevron-down",onClick:t?null:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}}):null}renderValueInputString(e,t){const{props:r,value:i,operator:s}=this,{strings:a}=r,o=e.uniqueValuesStatus,l=e.uniqueValueInfos,u=[a.operators.stringOperatorIs,a.operators.stringOperatorIsNot].indexOf(s)>-1,c=u&&(o===I.FAILED||o===I.SUCCESS&&!(null==l?void 0:l.length)),d=hi(e),h=d?di(i,e):i,p=o===I.MISSING||o===I.IN_PROGRESS;return o===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),d?E(h)?(0,n.h)("div",{key:"value-input-string"},(0,n.h)("calcite-button",{key:h,appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",iconEnd:p?"spinner":c?void 0:"chevron-down",disabled:c,onClick:c?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}},h?`${h}`:"")):(0,n.h)("div",{key:"value-input-string",class:Qi},(0,n.h)("div",{key:"value-input-string-button",class:`${Xi} ${ts} ${o===I.SUCCESS?"active":"inactive"}`,tabIndex:-1,onClick:o===I.SUCCESS?this.onSelectUniqueValue:void 0}),this.renderUniqueButton(u,c,p)):(0,n.h)("div",{key:"value-input-string",class:Qi},(0,n.h)("calcite-input",Object.assign({type:"text",value:h?`${h}`:"",class:Xi,scale:"m",label:a.accessibility.value,onCalciteInputInput:this.onValueChange},t)),this.renderUniqueButton(u,c,p))}renderValueInputNumber(e,t){var r;const{props:i,value:s,value2:a,operator:o}=this,{strings:l}=i,u=["single","double"].indexOf(e.layerField.type)>-1;if([l.operators.numberOperatorIsBetween,l.operators.numberOperatorIsNotBetween].indexOf(o)>-1)return(0,n.h)("div",null,(0,n.h)("calcite-input",Object.assign({type:"number",value:E(s)?`${s}`:"",scale:"m",step:u?"any":1,label:l.accessibility.fromValue,onCalciteInputInput:e=>this.waitOnUser(e,this.onValueChangeMaybe)},t)),(0,n.h)("div",{class:`${ns} first`}),(0,n.h)("calcite-input",Object.assign({type:"number",value:E(a)?`${a}`:"",scale:"m",step:u?"any":1,class:ns,label:l.accessibility.toValue,onCalciteInputInput:e=>this.waitOnUser(e,this.onValue2ChangeMaybe)},t)));{const i=e.uniqueValuesStatus,a=e.uniqueValueInfos,c=[l.operators.numberOperatorIs,l.operators.numberOperatorIsNot,l.operators.numberOperatorIsAtLeast,l.operators.numberOperatorIsAtMost,l.operators.numberOperatorIsGreaterThan,l.operators.numberOperatorIsLessThan].indexOf(o)>-1,d=(0,n.h)("calcite-input",Object.assign({class:Xi,type:"number",value:E(s)?`${s}`:"",scale:"m",step:u?"any":1,label:l.accessibility.value,onCalciteInputInput:e=>this.waitOnUser(e,this.onValueChange)},t));return i===I.FAILED||i===I.SUCCESS&&!(null==a?void 0:a.length)||!c?(0,n.h)("div",{key:"value-input-number"},d):i===I.MISSING||i===I.IN_PROGRESS?(i===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",{key:"value-input-number",class:Qi},d,this.renderUniqueButton(c,!0,!0))):(0,n.h)("div",{key:"value-input-number",class:Qi},d,this.renderUniqueButton(c,!(null===(r=e.uniqueValueInfos)||void 0===r?void 0:r.length)))}}renderValueInputDate(e){var t;const{props:r,value:i,value2:s,operator:a}=this,{layer:o,view:l,strings:u}=r,c="number"==typeof i?ti(i,null==l?void 0:l.timeZone,"preferredTimeZone"in o&&o.preferredTimeZone):i,d=ni(c);if([u.operators.dateOperatorIsBetween,u.operators.dateOperatorIsNotBetween].indexOf(a)>-1){const e="number"==typeof s?ti(s,null==l?void 0:l.timeZone,"preferredTimeZone"in o&&o.preferredTimeZone):s,t=ni(e);return(0,n.h)("div",null,(0,n.h)("calcite-label",{class:es},u.startDate),(0,n.h)("calcite-input-date-picker",{class:`${cs} first`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange,ref:e=>{e&&(this.dateNode=e)}}),(0,n.h)("calcite-input-time-picker",{class:`${cs} ${Xi}}`,scale:"m",value:d,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValueChange,ref:e=>this.timeNode=e}),(0,n.h)("calcite-label",{class:es},u.endDate),(0,n.h)("calcite-input-date-picker",{class:`${cs} first`,scale:"m",value:e,"data-value":"second",overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValue2Change,ref:e=>{e&&(this.dateNode2=e)}}),(0,n.h)("calcite-input-time-picker",{class:`${cs} ${Xi}`,scale:"m",value:t,"data-value":"second",step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValue2Change,ref:e=>this.timeNode2=e}))}{const r=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[u.operators.dateOperatorIsOn,u.operators.dateOperatorIsNotOn,u.operators.dateOperatorIsAfter,u.operators.dateOperatorIsBefore,u.operators.dateOperatorIsAfterOrEqual,u.operators.dateOperatorIsBeforeOrEqual].indexOf(a)>-1,o=(0,n.h)("div",null,(0,n.h)("calcite-input-date-picker",{class:`${cs} ${Xi} first`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange,ref:e=>{e&&(this.dateNode=e)}}),(0,n.h)("calcite-input-time-picker",{class:`${cs} ${Xi}`,scale:"m",value:d,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValueChange,ref:e=>this.timeNode=e}));return r===I.FAILED||r===I.SUCCESS&&!(null==i?void 0:i.length)||!s?(0,n.h)("div",{key:"value-input-date"},o):r===I.MISSING||r===I.IN_PROGRESS?(r===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",{key:"value-input-date",class:Qi},o,this.renderUniqueButton(s,!0,!0))):(0,n.h)("div",{key:"value-input-date",class:Qi},o,this.renderUniqueButton(s,!(null===(t=e.uniqueValueInfos)||void 0===t?void 0:t.length)))}}renderValueInputDateOnly(e){var t;const{props:r,value:i,value2:s,operator:a}=this,{strings:o}=r,l="number"==typeof i?new Date(i).toISOString():i;if([o.operators.dateOperatorIsBetween,o.operators.dateOperatorIsNotBetween].indexOf(a)>-1){const e="number"==typeof s?new Date(s).toISOString():s;return(0,n.h)("div",null,(0,n.h)("calcite-input-date-picker",{class:`${cs} first`,scale:"m",value:l,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange}),(0,n.h)("calcite-input-date-picker",{class:cs,scale:"m",value:e,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValue2Change}))}{const r=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[o.operators.dateOperatorIsOn,o.operators.dateOperatorIsNotOn,o.operators.dateOperatorIsAfter,o.operators.dateOperatorIsBefore,o.operators.dateOperatorIsAfterOrEqual,o.operators.dateOperatorIsBeforeOrEqual].indexOf(a)>-1,u=(0,n.h)("calcite-input-date-picker",{class:`${cs} ${Xi}`,scale:"m",value:l,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange});return r===I.FAILED||r===I.SUCCESS&&!(null==i?void 0:i.length)||!s?(0,n.h)("div",{key:"value-input-date"},u):r===I.MISSING||r===I.IN_PROGRESS?(r===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",{key:"value-input-date",class:Qi},u,this.renderUniqueButton(s,!0,!0))):(0,n.h)("div",{key:"value-input-date",class:Qi},u,this.renderUniqueButton(s,!(null===(t=e.uniqueValueInfos)||void 0===t?void 0:t.length)))}}renderValueInputTimeOnly(e){var t;const{props:r,value:i,value2:s,operator:a,intl:o}=this,{strings:l}=r,u="number"==typeof i?ii(i,o):i;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].indexOf(a)>-1){const e="number"==typeof s?ii(s,o):s;return(0,n.h)("div",null,(0,n.h)("calcite-input-time-picker",{class:`${cs} first`,scale:"m",value:u,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValueChange}),(0,n.h)("calcite-input-time-picker",{class:cs,scale:"m",value:e,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValue2Change}))}{const r=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore,l.operators.dateOperatorIsAfterOrEqual,l.operators.dateOperatorIsBeforeOrEqual].indexOf(a)>-1,o=(0,n.h)("calcite-input-time-picker",{class:`${cs} ${Xi}`,scale:"m",value:u,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:this.onValueChange});return r===I.FAILED||r===I.SUCCESS&&!(null==i?void 0:i.length)||!s?(0,n.h)("div",{key:"value-input-time"},o):r===I.MISSING||r===I.IN_PROGRESS?(r===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",{key:"value-input-time",class:Qi},o,this.renderUniqueButton(s,!0,!0))):(0,n.h)("div",{key:"value-input-time",class:Qi},o,this.renderUniqueButton(s,!(null===(t=e.uniqueValueInfos)||void 0===t?void 0:t.length)))}}renderValueInputOid(e,t){var r;const{props:i,value:s,value2:a,operator:o}=this,{strings:l}=i;if(e.simpleFieldType===O.OID)if(E(s)&&E(a)){const e=Math.round(s),t=Math.round(a);e===s&&t===a||this.changeValues(e,t)}else if(E(s)){const e=Math.round(s);e!==s&&this.changeValues(e,a)}else if(E(a)){const e=Math.round(a);e!==a&&this.changeValues(s,e)}if([l.operators.numberOperatorIsBetween,l.operators.numberOperatorIsNotBetween].indexOf(o)>-1)return(0,n.h)("div",null,(0,n.h)("calcite-input",Object.assign({type:"number",value:E(s)?`${s}`:"",scale:"m",min:0,step:1,label:l.accessibility.fromValue,onCalciteInputInput:this.onValueChangeMaybe},t)),(0,n.h)("div",{class:`${ns} first`}),(0,n.h)("calcite-input",Object.assign({type:"number",value:E(a)?`${a}`:"",scale:"m",min:0,step:1,class:ns,label:l.accessibility.toValue,onCalciteInputInput:this.onValue2ChangeMaybe},t)));{const i=e.uniqueValuesStatus,a=e.uniqueValueInfos,u=[l.operators.numberOperatorIs,l.operators.numberOperatorIsNot,l.operators.numberOperatorIsAtLeast,l.operators.numberOperatorIsAtMost,l.operators.numberOperatorIsGreaterThan,l.operators.numberOperatorIsLessThan].indexOf(o)>-1,c=(0,n.h)("calcite-input",Object.assign({class:Xi,type:"number",value:E(s)?`${s}`:"",scale:"m",min:0,step:1,label:l.accessibility.value,onCalciteInputInput:this.onValueChange},t));return i===I.FAILED||i===I.SUCCESS&&!(null==a?void 0:a.length)||!u?(0,n.h)("div",{key:"value-input-oid"},c):i===I.MISSING||i===I.IN_PROGRESS?(i===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",{key:"value-input-oid",class:Qi},c,this.renderUniqueButton(u,!0,!0))):(0,n.h)("div",{key:"value-input-oid",class:Qi},c,this.renderUniqueButton(u,!(null===(r=e.uniqueValueInfos)||void 0===r?void 0:r.length)))}}renderUniqueValues(e){const{props:t,values:r,fieldName:i}=this,{strings:s}=t,a=e.uniqueValuesStatus,o=e.uniqueValueInfos;if(a===I.MISSING||a===I.IN_PROGRESS)return a===I.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.h)("div",null,(0,n.h)("calcite-loader",{class:ps,inline:!0,label:""}));if(a===I.FAILED)return(0,n.h)("div",{class:as},(0,n.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:is,disabled:!0,label:s.selectValues},s.selectValues),s.errors.errorUniqueValues);{const t=(0,n.h)("div",{class:as},!(null==r?void 0:r.length)&&(null==o?void 0:o.length)?s.selectOneValue:"");let a;(null==o?void 0:o.length)||(a=(0,n.h)("div",{class:as},s.errors.noUniqueValues));const l=null==r?void 0:r.map((t=>this.renderSelectedUniqueValue(t,e)));return(0,n.h)("div",null,t,(0,n.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:is,disabled:!(null==o?void 0:o.length),onClick:(null==o?void 0:o.length)>0?this.onSelectUniqueValues:null,ref:e=>this.uniqueSelectNode=e,label:s.selectValues},s.selectValues),a,(null==r?void 0:r.length)?(0,n.h)("calcite-list",{key:`unique-values-list-${i}`,class:ss,ref:this.afterCreateList},l):null)}}renderSelectedUniqueValue(e,t){const{intl:r,props:i}=this,{view:s,strings:a}=i,o=(null==s?void 0:s.timeZone)||"system",l=hi(t)?di(e,t):Ni(t)?li(e,o,r):Ei(t)?ui(e,r):wi(t)?ci(e,r):bi(t)?r.formatNumber(e):e;return(0,n.h)("calcite-list-item",{label:`${l}`,value:`${e}`},(0,n.h)("calcite-action",{slot:"actions-end",text:a.remove,icon:"x",onClick:this.onRemoveSelectedValue.bind(this,e)}))}renderInTheLast(e){const{props:t,value:r,unit:i}=this,{strings:s}=t,a=Ei(e);return(0,n.h)("div",{class:os},(0,n.h)("calcite-input-number",{min:1,integer:!0,value:E(r)?`${r}`:"",class:ls,label:s.accessibility.value,onCalciteInputNumberInput:this.onValueChange}),(0,n.h)("calcite-select",{width:"full",scale:"m",label:s.accessibility.units,class:us,onCalciteSelectChange:this.onUnitSelect},!a&&this.renderInTheLastOption(b.MINUTE,i===b.MINUTE),!a&&this.renderInTheLastOption(b.HOUR,i===b.HOUR),this.renderInTheLastOption(b.DAY,i===b.DAY),this.renderInTheLastOption(b.WEEK,i===b.WEEK),this.renderInTheLastOption(b.MONTH,i===b.MONTH),this.renderInTheLastOption(b.YEAR,i===b.YEAR)))}renderInTheLastOption(e,t){const{props:r}=this,{strings:i}=r;return(0,n.h)("calcite-option",{value:e,label:i.units[e],selected:t})}renderTimeZone(e){const{props:t}=this,{inputTimeZoneMessages:r,view:i,strings:s}=t;if(e.simpleFieldType!==O.DATE)return null;const a=i&&"system"!==i.timeZone?"unknown"===i.timeZone?s.timeZoneUnknown:(null==r?void 0:r[i.timeZone])||i.timeZone:s.timeZoneSystem;return(0,n.h)("calcite-label",{class:fs,scale:"s",layout:"inline",alignment:"start"},(0,n.h)("calcite-icon",{icon:"time-zone",scale:"s",class:ms}),a)}renderHistogram(e){const{props:t,histogramOpen:r,operator:i,fieldName:s}=this,{layer:a,strings:o}=t;return"imagery"===a.type||"subtype-group"===a.type?null:e&&e.simpleFieldType?e.statisticsStatus===I.FAILED?null:function(e,t,r){const{strings:n}=r,i=mi(e,r);return!!(i&&i.simpleFieldType&&"failed"!==i.statisticsStatus&&[O.NUMBER,O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(i.simpleFieldType)>-1&&[n.operators.numberOperatorIs,n.operators.dateOperatorIsOn,n.operators.dateOperatorIsNotOn,n.operators.numberOperatorIsNot,n.operators.numberOperatorIsLessThan,n.operators.numberOperatorIsGreaterThan,n.operators.dateOperatorIsBefore,n.operators.dateOperatorIsAfter,n.operators.dateOperatorIsBeforeOrEqual,n.operators.dateOperatorIsAfterOrEqual,n.operators.numberOperatorIsAtMost,n.operators.numberOperatorIsAtLeast,n.operators.numberOperatorIsBetween,n.operators.dateOperatorIsBetween,n.operators.numberOperatorIsNotBetween,n.operators.dateOperatorIsNotBetween].indexOf(t)>-1)}(s,i,t)?((void 0===r||r&&e.histogramStatus===I.MISSING)&&this.onHistogramOpen(),(0,n.h)("calcite-block-section",{open:!1!==r,text:e.histogramStatus===I.FAILED?o.valueRange:o.histogram,onCalciteBlockSectionToggle:this.onHistogramBlockToggle},this.renderHistogramContent(e))):null:null}renderHistogramContent(e){const{histogramOpen:t}=this,r=e.layerField.name;if(!1===t)return null;if(e.statistics&&e.histogramStatus!==I.IN_PROGRESS){return this.prepareSlider(e)?(0,n.h)("div",{key:`histogram-content-${r}-${e.statistics}`,class:`${e.histogram?ds:hs}`,ref:this.afterCreateSliderDiv}):null}return(0,n.h)("div",{key:`histogram-content-${r}-${e.statistics}`,class:e.histogram?ds:hs},(0,n.h)("calcite-loader",{class:ps,inline:!0,label:""}))}setFocus(){setTimeout((()=>{const e=this.hostElement.querySelector(".autofocus");e&&e.setFocus()}),500)}onSelectUnique(e){var t;const{props:r,value:i,values:s,fieldName:l,uid:u,uniqueValuesSortBy:c,esriLang:d}=this,{strings:h,localeIntl:p}=r,f=(0,a.g)(this.hostElement);if(this.uniquePopoverNode)return void this.closeFilterPopoversHandler();this.closeFilterPopoversHandler();const m=mi(l,r);if(!m)return;const v=null===(t=this.fieldNode)||void 0===t?void 0:t.getBoundingClientRect().width,g=v?v+2:204,y=(0,o.q)(this.hostElement,"calcite-panel"),O=null==y?void 0:y.clientHeight,I=O?Math.max(Math.min(O/3,400),240):400,b=document.createElement("calcite-popover");b.id=`arcgis-filter-unique-popover_${u}`,b.placement="rtl"===f?"bottom-start":"bottom-end",b.offsetDistance=0,b.offsetSkidding=0,b.pointerDisabled=!0,b.style=`width: ${g}px;`,b.referenceElement=e?this.uniqueSelectNode:this.uniqueActionNode;const T=document.createElement("arcgis-filter-unique-list");T.uid=u,T.props=r,T.uniqueValues=d.clone(m.uniqueValueInfos),T.selectedValues=e?s:i?[i]:[],T.fieldDomains=m.fieldDomains,T.layerFieldType=m.layerField.type,T.multiple=e,T.sortBy=c,T.partialUniqueValues=m.partialUniqueValues,T.maxHeight=I,T.strings=h,T.locale=p,T.style=`min-width: ${g}px`,b.appendChild(T),document.body.appendChild(b),b.open=!0,(0,n.f)(T),T.setFocus(),b.reposition(),this.uniquePopoverNode=b,setTimeout((()=>{b.open=!0,document.addEventListener("click",this.onDocumentClickBind)}),50)}scrollExprIntoView(e){setTimeout((()=>{e&&(null==(e=(0,o.q)(e,".filter-expression"))||e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}),100)}removeUniquePopover(){var e;document.removeEventListener("click",this.onDocumentClickBind),this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,null===(e=this.uniquePopoverNode)||void 0===e||e.parentElement.removeChild(this.uniquePopoverNode),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){var t;const{props:r,uniqueValues:n}=this,{layer:i,view:s,featureReduction:a}=r,o=mi(e,r);if(o&&"imagery"!==i.type&&"subtype-group"!==i.type&&o.uniqueValuesStatus===I.MISSING&&i){o.uniqueValuesStatus=I.IN_PROGRESS;try{const l=await n({layer:i,view:s,field:e,forBinning:a&&["binning","cluster"].indexOf(null===(t=i.featureReduction)||void 0===t?void 0:t.type)>-1}),u=bi(o),c=l.uniqueValueInfos.filter((e=>!!E(e.value)&&("string"===o.simpleFieldType&&!u||"guid"===o.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===o.simpleFieldType||o.simpleFieldType,"<Null>"!==e.value&&""!==e.value))));c.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),hi(o)&&o.fieldDomains.forEach((e=>{c.find((t=>t.value===e.code))||c.push({value:e.code,count:0})}));const d=2e3===l.uniqueValueInfos.length;r.fields=r.fields.map((t=>t.layerField.name===e?Object.assign(Object.assign({},t),{uniqueValueInfos:c,uniqueValuesStatus:I.SUCCESS,partialUniqueValues:d}):t)),this.arcgisFilterUniqueValuesReturned.emit(o.layerField.name)}catch(t){if(console.error("error-uniqueValues",t),hi(o)){const t=[];o.fieldDomains.forEach((e=>{t.find((t=>t.value===e.code))||t.push({value:e.code,count:void 0})})),r.fields=r.fields.map((r=>r.layerField.name===e?Object.assign(Object.assign({},r),{uniqueValueInfos:t,uniqueValuesStatus:I.SUCCESS,partialUniqueValues:!1}):r))}else r.fields=r.fields.map((t=>t.layerField.name===e?Object.assign(Object.assign({},t),{uniqueValuesStatus:I.FAILED}):t));this.reRender=!this.reRender}}}async onHistogramOpen(){var e,t;const{props:r,fieldName:n,summaryStatistics:i,histogram:s}=this,{layer:a,view:o,featureReduction:l}=r,u=mi(n,r);if(a&&"imagery"!==a.type&&"subtype-group"!==a.type&&u)if(u.statistics)this.checkDefaultValues(u),this.histogramOpen=!0;else if(!u.statistics){r.fields=r.fields.map((e=>e.layerField.name===n?Object.assign(Object.assign({},e),{statisticsStatus:I.IN_PROGRESS}):e));try{const c=await i({layer:a,view:o,field:n,forBinning:l&&["binning","cluster"].indexOf(null===(e=a.featureReduction)||void 0===e?void 0:e.type)>-1});if(!E(c.avg)||!E(c.min)||!E(c.max))return r.fields=r.fields.map((e=>e.layerField.name===n?Object.assign(Object.assign({},e),{statisticsStatus:I.FAILED}):e)),void(this.histogramOpen=!1);c.min===c.max&&(c.min>0?(c.min=c.min-.1*c.min,c.max=c.max+.1*c.max):c.min<0?(c.min=c.min+.1*c.min,c.max=c.max-.1*c.max):(c.min=-1,c.max=1)),r.fields=r.fields.map((e=>e.layerField.name===n?Object.assign(Object.assign({},e),{statistics:c,statisticsStatus:I.SUCCESS}):e)),this.checkDefaultValues(u);try{const e=await s({layer:a,view:o,field:n,numBins:30,minValue:c.min,maxValue:c.max,forBinning:l&&["binning","cluster"].indexOf(null===(t=a.featureReduction)||void 0===t?void 0:t.type)>-1});r.fields=r.fields.map((t=>t.layerField.name===n?Object.assign(Object.assign({},t),{histogram:e,histogramStatus:I.SUCCESS}):t)),this.reRender=!this.reRender}catch(e){console.error("error-histogram",e),r.fields=r.fields.map((e=>e.layerField.name===n?Object.assign(Object.assign({},e),{histogramStatus:I.FAILED}):e)),this.reRender=!this.reRender}}catch(e){console.error("error-summaryStatistics",e),r.fields=r.fields.map((e=>e.layerField.name===n?Object.assign(Object.assign({},e),{statisticsStatus:I.FAILED,histogramStatus:I.FAILED}):e)),this.histogramOpen=!1,this.reRender=!this.reRender}}}onHistogramClose(){this.histogramOpen=!1}async onMinMaxChange(e,t,r){var n;const{props:i,value:s,value2:a,histogram:o}=this,{layer:l,view:u,featureReduction:c}=i,d=mi(r,i);if(d&&"imagery"!==l.type&&"subtype-group"!==l.type){this.value=Math.min(Math.max(s,e),t),E(a)&&(this.value2=Math.min(Math.max(a,e),t)),this.histogramOpen=!0,i.fields=i.fields.map((e=>e.layerField.name===r?Object.assign(Object.assign({},e),{histogramStatus:I.IN_PROGRESS}):e));try{const s=await o({layer:l,view:u,field:d.layerField.name,numBins:30,minValue:e,maxValue:t,forBinning:c&&["binning","cluster"].indexOf(null===(n=l.featureReduction)||void 0===n?void 0:n.type)>-1});i.fields=i.fields.map((e=>e.layerField.name===r?Object.assign(Object.assign({},e),{histogram:s,histogramStatus:I.SUCCESS}):e)),this.reRender=!this.reRender}catch(e){console.error("error-histogram",e),i.fields=i.fields.map((e=>e.layerField.name===r?Object.assign(Object.assign({},e),{histogramStatus:I.FAILED}):e))}}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){var t,r;const{histogramSliderFieldName:n}=this;let{value:i,value2:s,histogramSlider:a}=this;const o=e.statistics;if(e.histogramStatus===I.IN_PROGRESS)return!1;E(i)&&"number"!=typeof i&&(i=void 0),E(s)&&"number"!=typeof s&&(s=void 0),this.checkDefaultValues(e),i=this.value,s=this.value2;const l=[];if(l.push(i),E(s)&&l.push(s),Ti(e)){if(E(l[0])){const e=Math.round(l[0]);e!==l[0]&&this.changeValues(e,s),l[0]=e}if(E(l[1])){const e=Math.round(l[1]);e!==l[1]&&this.changeValues(i,e),l[1]=e}}let u=e.histogram?e.histogram.minValue:o.min,c=e.histogram?e.histogram.maxValue:o.max;if(E(l[0])&&E(l[1])?(u=Math.min(u,l[0]),c=Math.max(c,l[1])):E(l[0])&&(u=Math.min(u,l[0]),c=Math.max(c,l[0])),a&&n!==e.layerField.name&&(a.destroy(),a=void 0),a){const t={bins:null===(r=e.histogram)||void 0===r?void 0:r.bins,average:Math.round(10*o.avg)/10,min:u,max:c,values:void 0===(null==l?void 0:l[0])?void 0:l,rangeType:this.getSliderRangeType()};a.set(t)}else{const r={bins:null===(t=e.histogram)||void 0===t?void 0:t.bins,average:Math.round(10*o.avg)/10,min:u,max:c,values:void 0===(null==l?void 0:l[0])?void 0:l,rangeType:this.getSliderRangeType(),precision:Ti(e)?0:4};[O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(e.simpleFieldType)>-1&&(r.hasTimeData=!0,this.addDateFormatFunctions(r,e)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new this.HistogramRangeSlider(r),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",(r=>{const n=t;this.onMinMaxChange(r.value,n.max,e.layerField.name)})),t.on("max-change",(r=>{const n=t;this.onMinMaxChange(n.min,r.value,e.layerField.name)})),t.watch("values",(()=>{var r,n;const i=t;let s=null===(r=i.values)||void 0===r?void 0:r[0],a=null===(n=i.values)||void 0===n?void 0:n[1];[O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(e.simpleFieldType)>-1&&(s=Math.round(s)),Ti(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})),t.on("segment-drag",(()=>{const r=t;let n=r.values[0],i=r.values[1];Ti(e)&&(i||0===n?(n=Math.floor(n),i=Math.ceil(i)):n=Math.round(n)),this.changeValues(n,i)})))}getSliderRangeType(){const{props:e,operator:t}=this,{strings:r}=e;switch(t){case r.operators.numberOperatorIs:case r.operators.dateOperatorIsOn:return"equal";case r.operators.numberOperatorIsNot:case r.operators.dateOperatorIsNotOn:return"not-equal";case r.operators.numberOperatorIsLessThan:case r.operators.dateOperatorIsBefore:return"less-than";case r.operators.numberOperatorIsGreaterThan:case r.operators.dateOperatorIsAfter:return"greater-than";case r.operators.numberOperatorIsAtMost:case r.operators.dateOperatorIsBeforeOrEqual:return"at-most";case r.operators.numberOperatorIsAtLeast:case r.operators.dateOperatorIsAfterOrEqual:return"at-least";case r.operators.numberOperatorIsBetween:case r.operators.dateOperatorIsBetween:return"between";case r.operators.numberOperatorIsNotBetween:case r.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}getNewValue(e){const{fieldName:t,props:r}=this,{layer:n,view:i}=r,s=null==e?void 0:e.target;let a;if("CALCITE-INPUT-DATE-PICKER"===(null==s?void 0:s.tagName)||"CALCITE-INPUT-TIME-PICKER"===(null==s?void 0:s.tagName)){const e=mi(t,r),o=s.getAttribute("data-value");if("CALCITE-INPUT-DATE-PICKER"===(null==s?void 0:s.tagName)){if(a=s.value,!a)return;a=e.simpleFieldType===O.DATE?ri(`${a} ${"second"===o?this.timeNode2.value:this.timeNode.value}`,n.fieldsIndex.getTimeZone(t),null==i?void 0:i.timeZone,"preferredTimeZone"in n&&n.preferredTimeZone):oi(a)}else{if(a=s.value,!a)return;a=e.simpleFieldType===O.DATE?ri(`${"second"===o?this.dateNode2.value:this.dateNode.value} ${a}`,n.fieldsIndex.getTimeZone(t),null==i?void 0:i.timeZone,"preferredTimeZone"in n&&n.preferredTimeZone):si(a)}}else if("CALCITE-INPUT"===(null==s?void 0:s.tagName)&&"number"===s.type||"CALCITE-INPUT-NUMBER"===(null==s?void 0:s.tagName)){if(a=s.value,!a)return;a=parseFloat(a)}else"CALCITE-INPUT"===(null==s?void 0:s.tagName)&&(a=s.value,(null==a?void 0:a.length)||(a=void 0));return a}addDateFormatFunctions(e,t){const{intl:r,props:n}=this,{view:i}=n,s=(null==i?void 0:i.timeZone)||"system";e.labelFormatFunction=e=>t.simpleFieldType===O.DATE?li(e,s,r,"short-date"):t.simpleFieldType===O.DATE_ONLY?ui(e,r):ci(e,r)}changeValues(e,t){const{props:r,fieldName:n}=this,i=mi(n,r),s=i.simpleFieldType&&[O.NUMBER,O.DATE,O.OID].indexOf(i.simpleFieldType)>-1&&isNaN(e)?null:e,a=i.simpleFieldType&&[O.NUMBER,O.DATE,O.OID].indexOf(i.simpleFieldType)>-1&&isNaN(t)?null:t;this.value===s&&this.value2===a||this.emitChangeEvent({value:null!=s?s:null,value2:null!=a?a:null})}checkDefaultValues(e){var t;const{props:r,operator:n,value:i,value2:s,histogramSlider:a}=this,o=e.statistics,l=gi(r,e,n);if(Vi(r,n)){if(!E(i)){const e=(new Date).getTime(),t=Math.abs(e-(null==o?void 0:o.avg));let r,n;t>2*T.YEAR?(r=Math.round(t/T.YEAR),n=b.YEAR):t>2*T.MONTH?(r=Math.round(t/T.MONTH),n=b.MONTH):t>2*T.WEEK?(r=Math.round(t/T.WEEK),n=b.WEEK):t>2*T.DAY?(r=Math.round(t/T.DAY),n=b.DAY):t>2*T.HOUR?(r=Math.round(t/T.HOUR),n=b.HOUR):(r=Math.round(t/T.MINUTE),n=b.MINUTE),this.emitChangeEvent({value:r,unit:n})}}else if(Ci(r,n))if(E(i))if(E(s))s<i&&(a&&a.values[0]===i?this.changeValues(i,i):this.changeValues(s,s));else{const r=null!==(t=null==o?void 0:o.max)&&void 0!==t?t:i+1,n=Ti(e)?Math.round(r):r;this.changeValues(i,n)}else if(E(s)){const t=Oi(null==o?void 0:o.avg,r,e);this.changeValues(t,s)}else this.changeValues(l.value,l.value2);else E(i)||this.changeValues(l.value,l.value2);return l}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:r}=this,{layer:n,view:i,featureReduction:s,withinModal:l}=e,u=(0,a.g)(this.hostElement);this.closeFilterPopoversHandler();const c=(0,o.q)(this.hostElement,"#filter-panel"),d=c.querySelector("#arcgis-filter-close"),h=null==c?void 0:c.getBoundingClientRect().width;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps=d?{placement:"rtl"===u?"bottom-start":"bottom-end",offsetDistance:20,offsetSkidding:15,pointerDisabled:!0,popoverWidth:h?h+30:280,refElement:d,zIndex:l?900:void 0}:{placement:"auto",offsetDistance:-1*(h?h-5:215),offsetSkidding:0,pointerDisabled:!0,popoverWidth:h?h+30:280,refElement:c,zIndex:l?900:void 0},this.arcgisFieldPickList.fields=this.createPickListFields(),this.arcgisFieldPickList.layer=n,this.arcgisFieldPickList.mapView=i,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=[t],this.arcgisFieldPickList.sortBy=r,this.arcgisFieldPickList.showFieldInfo=!s,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),this.arcgisFieldPickList.addEventListener("arcgisFieldPickListSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),this.disableFilterPanel.emit(!0)}createPickListFields(){const{props:e}=this,{fields:t}=e;return t.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType})))}removeFieldsPickList(){this.disableFilterPanel.emit(!1),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{this.fieldNode.setFocus()}),1))}afterFieldSelect(e){var t;const{props:r,fieldName:n,operator:i,histogramOpen:s}=this,{strings:a}=r,o=mi(n,r),l=mi(e,r);let u=null;const c=function(e,t,r,n){return t.simpleFieldType!==r.simpleFieldType?function(e,t){const{strings:r}=e;return!!(t&&[r.operators.stringOperatorIncludes,r.operators.numberOperatorIncludes].indexOf(t)>-1)}(e,n)?function(e,t){const{strings:r}=e;switch(t.simpleFieldType){case"string":case"domain":default:return r.operators.stringOperatorIncludes;case"number":case"oid":case"guid":return r.operators.numberOperatorIncludes}}(e,r):function(e,t){const{strings:r}=e;return!!(t&&[r.operators.stringOperatorExcludes,r.operators.numberOperatorExcludes].indexOf(t)>-1)}(e,n)?function(e,t){const{strings:r}=e;switch(t.simpleFieldType){case"string":default:return r.operators.stringOperatorExcludes;case"number":case"oid":case"guid":return r.operators.numberOperatorExcludes}}(e,r):xi(e,r):n}(r,o,l,i),d=mi(e,r);d.simpleFieldType===O.STRING&&d.uniqueValuesStatus===I.SUCCESS&&(null===(t=d.uniqueValueInfos)||void 0===t?void 0:t.length)&&[a.operators.stringOperatorIs,a.operators.stringOperatorIsNot].indexOf(c)>-1&&(u=d.uniqueValueInfos[0].value),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:c,value:u,value2:null,values:null,uniqueValuesSortBy:null,histogramOpen:(l.simpleFieldType&&-1===[O.NUMBER,O.DATE,O.DATE_ONLY,O.TIME_ONLY].indexOf(l.simpleFieldType)||l.statisticsStatus===I.FAILED||!1!==s||o.statisticsStatus===I.FAILED)&&null})}emitChangeEvent(e){var t,r;const{uid:n,fieldName:i,operator:s,uniqueValuesSortBy:a,value:o,value2:l,values:u,unit:c,histogramOpen:d,hasFocus:h}=this,p={uid:n,fieldName:e.fieldName||i,operator:e.operator||s,uniqueValuesSortBy:null===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:null===e.value?void 0:null!==(t=e.value)&&void 0!==t?t:o,value2:null===e.value2?void 0:null!==(r=e.value2)&&void 0!==r?r:l,values:null===e.values?void 0:e.values||u,unit:e.unit||c,histogramOpen:null===e.histogramOpen?void 0:e.histogramOpen||d,hasFocus:e.hasFocus||h};this.arcgisFilterConditionChanged.emit(p)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const r=e.target.value,n=parseFloat(r);r?("-"!==r[0]||0!==n&&!isNaN(n))&&t(e):this.typingHndl=setTimeout((()=>{this.typingHndl=void 0,t(e)}),2e3)}get hostElement(){return(0,n.d)(this)}};vs.style=".field-selection.sc-arcgis-filter-condition{display:flex;align-items:normal}.delete-action.sc-arcgis-filter-condition{padding:0 0 0 4px}.arcgis--rtl.sc-arcgis-filter-condition .delete-action.sc-arcgis-filter-condition{padding:0 4px 0 0}.operator-dropdown.sc-arcgis-filter-condition{width:100%;margin:5px 0}.input-plus-unique.sc-arcgis-filter-condition{display:flex;flex-direction:row;width:100%}.input.sc-arcgis-filter-condition{width:100%}.blank-button.sc-arcgis-filter-condition{height:22px;border:var(--calcite-color-border-input) 1px solid}.blank-button.active.sc-arcgis-filter-condition{cursor:pointer}.blank-button.inactive.sc-arcgis-filter-condition:focus{outline:none}.select-unique-button.sc-arcgis-filter-condition{height:32px;border-top:var(--calcite-color-border-input) 1px solid;border-bottom:var(--calcite-color-border-input) 1px solid;border-right:var(--calcite-color-border-input) 1px solid}.arcgis--rtl.sc-arcgis-filter-condition .select-unique-button.sc-arcgis-filter-condition{border-right:none;border-left:var(--calcite-color-border-input) 1px solid}.between-values-input.first.sc-arcgis-filter-condition{margin-bottom:5px}.select-values.sc-arcgis-filter-condition{margin-bottom:4px}.pick-list.sc-arcgis-filter-condition{max-height:200px;overflow-y:auto}.unique-values-content-list-msg.sc-arcgis-filter-condition{font-size:90%;margin-top:5px;margin-bottom:5px}.in-the-last.sc-arcgis-filter-condition{display:flex}.in-the-last-count.sc-arcgis-filter-condition{width:50%}.in-the-last-unit.sc-arcgis-filter-condition{width:50%}.date-picker.sc-arcgis-filter-condition{width:100%}.date-picker.first.sc-arcgis-filter-condition{margin-bottom:5px}.label.sc-arcgis-filter-condition{margin-top:10px}.time-zone.sc-arcgis-filter-condition{margin-top:5px}.time-zone-icon.sc-arcgis-filter-condition{opacity:60%}.histogram-content.sc-arcgis-filter-condition{height:120px;margin-top:5px}.histogram-content-slim.sc-arcgis-filter-condition{height:40px;margin-top:5px}.small-loader.sc-arcgis-filter-condition{margin-left:calc((100% - 16px) / 2);margin-top:10px}html[dir=rtl].sc-arcgis-filter-condition .small-loader.sc-arcgis-filter-condition{margin-left:auto;margin-right:8px}";const gs="expression-block",ys="add-condition-button",Os="content",Is="match-type-text",bs="match-type-text-empty",Ts="match-condition",Ns="match-condition-dropdown",Es=class{constructor(e){(0,n.r)(this,e),this.arcgisFilterExpressionChanged=(0,n.c)(this,"arcgisFilterExpressionChanged",7),this.onAddCondition=()=>{const{props:e,conditions:t}=this,r=vi(e),n=gi(e,r,xi(e,r)),i=Object.assign(Object.assign({fieldName:r.layerField.name,operator:xi(e,r)},n),{hasFocus:!0});t.forEach((e=>e.hasFocus=!1)),this.conditions=[...t,i],e.expressions=e.expressions.map((e=>e.uid===this.uid?Object.assign(Object.assign({},e),{conditions:this.conditions}):Object.assign({},e))),this.fixUIDsForExpression(),this.menuNode.open=!1,this.emitChangeEvent()},this.onRemoveCondition=e=>{const{props:t,conditions:r}=this;r.forEach((e=>e.hasFocus=!1));let n=0;this.conditions=r.filter(((t,r)=>!t||r!==e||(n=r,!1))),this.conditions[Math.max(0,n-1)].hasFocus=!0,t.expressions=t.expressions.map((e=>e.uid===this.uid?Object.assign(Object.assign({},e),{conditions:this.conditions}):Object.assign({},e))),this.fixUIDsForExpression(),this.emitChangeEvent()},this.onMatchSelect=e=>{const t=e.target.selectedOption.value;this.logicalOperatorForConditions=t,this.emitChangeEvent()},this.onCopyExpression=()=>{const{uid:e,conditions:t,logicalOperatorForConditions:r}=this,n={uid:e,conditions:t,logicalOperatorForConditions:r};this.menuNode.open=!1,this.arcgisFilterExpressionChanged.emit({type:"copy",uid:this.uid,expression:n})},this.onRemoveExpression=()=>{this.arcgisFilterExpressionChanged.emit({type:"delete",uid:this.uid})},this.props=void 0,this.uid=void 0,this.conditions=void 0,this.logicalOperatorForConditions=void 0,this.canRemove=!0,this.canDuplicate=!0,this.showAddConditionButton=!1}arcgisFilterConditionChangeHandler(e){const{conditions:t}=this,{detail:r}=e;this.conditions=t.map((e=>e.uid===r.uid?r:e)),this.emitChangeEvent()}async componentWillLoad(){this.conditions=this.conditions||[];const[e]=await(0,s.l)(["esri/core/lang"]);this.esriLang=e}render(){const{props:e,conditions:t}=this,{strings:r}=e,i=(0,a.g)(this.hostElement);return(0,n.h)(n.H,{key:"21325e752dcab9981d3efc33d03f8c4bfed1210d",class:{[a.C.rtl]:"rtl"===i},dir:i},(0,n.h)("calcite-block",{key:"575dbb99111d838ed3517df7dfd1343f156d6f4a",heading:1===t.length?r.condition:r.conditionSet,open:!0,class:gs},this.renderMenu(),this.renderMatchCondition(),this.renderConditions(),this.renderAddConditionButton()))}renderMenu(){const{props:e,canDuplicate:t,canRemove:r,conditions:i}=this,{strings:s}=e;return(0,n.h)("calcite-action-menu",{slot:"control",placement:"bottom-end",overlayPositioning:"fixed",label:s.accessibility.moreOptions,ref:e=>this.menuNode=e},r&&(0,n.h)("calcite-action",{text:1===i.length?s.deleteExpression:s.deleteSet,textEnabled:!0,"data-value":"remove",onClick:this.onRemoveExpression}),t&&(0,n.h)("calcite-action",{text:s.duplicate,textEnabled:!0,"data-value":"copy",onClick:this.onCopyExpression}),(0,n.h)("calcite-action",{text:s.addCondition,textEnabled:!0,"data-value":"add",onClick:this.onAddCondition}))}renderMatchCondition(){const{conditions:e,logicalOperatorForConditions:t,props:r}=this,{strings:i}=r;if(!e||!e.length||1===e.length)return null;const s=t!==y.OR;return(0,n.h)("div",{class:Ts},(0,n.h)("calcite-select",{width:"full",scale:"m",label:i.accessibility.matchType,class:Ns,onCalciteSelectChange:this.onMatchSelect},(0,n.h)("calcite-option",{value:y.AND,label:i.matchAll,selected:s}),(0,n.h)("calcite-option",{value:y.OR,label:i.matchAtLeastOne,selected:!s})))}renderConditions(){const{conditions:e}=this;return(0,n.h)("div",{class:Os},e.map(((e,t)=>this.renderCondition(e,t))))}renderCondition(e,t){const{conditions:r,props:i}=this;return(0,n.h)("div",null,this.renderConditionHeader(t),(0,n.h)("arcgis-filter-condition",Object.assign({props:i,showDelete:r.length>1},e,{onArcgisFilterConditionDeleted:()=>this.onRemoveCondition(t)})))}renderAddConditionButton(){return this.showAddConditionButton&&(0,n.h)("calcite-button",{alignment:"center",appearance:"transparent",class:ys,"icon-start":"plus",scale:"s",onClick:this.onAddCondition},this.props.strings.addCondition)}renderConditionHeader(e){const{props:t,logicalOperatorForConditions:r,conditions:i}=this,{strings:s}=t;if(i.length<2)return null;const a=r!==y.OR;return(0,n.h)("div",null,e>0?(0,n.h)("span",{class:Is},a?s.and:s.or):i.length>1?(0,n.h)("div",{class:bs}):null)}fixUIDsForExpression(){const{props:e}=this;e.expressions=k(e.expressions),this.conditions=e.expressions.filter((e=>e.uid===this.uid))[0].conditions}emitChangeEvent(){const{uid:e,conditions:t,logicalOperatorForConditions:r}=this,n={uid:e,conditions:t,logicalOperatorForConditions:r};this.arcgisFilterExpressionChanged.emit({type:"replace",expression:n})}get hostElement(){return(0,n.d)(this)}};Es.style=".expression-block.sc-arcgis-filter-expression{margin:0 8px;border:1px solid var(--calcite-color-border-3)}.content.sc-arcgis-filter-expression{padding-bottom:6px}.match-type-text.sc-arcgis-filter-expression{display:flex;justify-content:flex-start;margin:6px 8px 0 8px}.arcgis--rtl.sc-arcgis-filter-expression .match-type-text.sc-arcgis-filter-expression{justify-content:flex-end}.match-type-text-empty.sc-arcgis-filter-expression{margin:10px 0 0 0}.match-condition.sc-arcgis-filter-expression{margin:0 6px;border-bottom:1px solid var(--calcite-color-border-3);padding-bottom:18px}.match-condition-dropdown.sc-arcgis-filter-expression{width:100%}.add-condition-button.sc-arcgis-filter-expression{display:flex}";const ws="container",ks="popover-unique-pick-list",Ss="unique-values-content-list-msg",Fs="count",xs="unique-values-done",Cs=class{constructor(e){(0,n.r)(this,e),this.arcgisFilterUniqueListDone=(0,n.c)(this,"arcgisFilterUniqueListDone",7),this.arcgisFilterUniqueListChanged=(0,n.c)(this,"arcgisFilterUniqueListChanged",7),this.arcgisFilterUniqueListSortByChanged=(0,n.c)(this,"arcgisFilterUniqueListSortByChanged",7),this.onSortMenuSelect=e=>{var t;const r=null===(t=e.currentTarget.selectedItems)||void 0===t?void 0:t[0].getAttribute("data-value");this.sortBy=r,this.arcgisFilterUniqueListSortByChanged.emit({uid:this.uid,sortBy:r})},this.done=()=>{this.arcgisFilterUniqueListDone.emit(this.uid)},this.uid=void 0,this.props=void 0,this.uniqueValues=void 0,this.selectedValues=void 0,this.fieldDomains=void 0,this.layerFieldType=void 0,this.sortBy=void 0,this.multiple=void 0,this.partialUniqueValues=void 0,this.maxHeight=void 0,this.strings=void 0,this.locale=void 0}async setFocus(){var e;null===(e=this.pickListNode)||void 0===e||e.setFocus()}async componentWillLoad(){const[e]=await(0,s.l)(["esri/intl"]);this.intl=e,this.intl.setLocale(this.locale)}componentDidLoad(){}disconnectedCallback(){}render(){const{uid:e,uniqueValues:t,selectedValues:r,layerFieldType:i,fieldDomains:s,sortBy:a,multiple:o,partialUniqueValues:l,maxHeight:u,strings:c}=this,d=["small-integer","big-integer","integer","single","double","long"].includes(i),h=["date","date-only","time-only"].includes(i);(e=>{const t=null==s?void 0:s.length;e.sort(((e,r)=>{if(!t&&d)return("string"==typeof e.value?parseFloat(e.value):e.value)-("string"==typeof r.value?parseFloat(r.value):r.value);{const n=t?this.getDecodedValue(e.value):e.value,i=t?this.getDecodedValue(r.value):r.value;return"_"===`${n}`.charAt(0)?1:"_"===`${i}`.charAt(0)?-1:`${n}`.localeCompare(`${i}`)}}))})(t),a&&"count"!==a?"selected"===a&&((e,t)=>{e.sort(((e,r)=>{var n,i;const s=null!==(n=null==t?void 0:t.indexOf(e.value))&&void 0!==n?n:-1,a=null!==(i=null==t?void 0:t.indexOf(r.value))&&void 0!==i?i:-1;return s===a||s>-1&&a>-1?0:s>a?-1:1}))})(t,r):(e=>{e.sort(((e,t)=>e.count<=t.count?1:-1))})(t);const p=t.map((e=>this.renderUniqueValue(e)));let f;return l&&(f=(0,n.h)("div",{class:Ss},c.errors.tooManyUniqueValues)),(0,n.h)(n.H,null,(0,n.h)("div",{class:ws},(0,n.h)("calcite-pick-list",{class:ks,filterEnabled:t.length>10,multiple:o,"filter-placeholder":c.searchValues,onCalciteListChange:async t=>{const r=t.target;let n=[...(await r.getSelectedItems()).keys()];s||"date-only"!==i?s||"time-only"!==i?["date","oid","guid","small-integer","big-integer","integer","long"].indexOf(i)>-1?n=null==n?void 0:n.map((e=>parseInt(e))):["single","double"].indexOf(i)>-1&&(n=null==n?void 0:n.map((e=>parseFloat(e)))):n=null==n?void 0:n.map((e=>si(e))):n=null==n?void 0:n.map((e=>oi(e))),this.selectedValues=n,this.arcgisFilterUniqueListChanged.emit({uid:e,multiple:o,selectedValues:n,sortBy:a})},ref:e=>{this.pickListNode=e,u&&e.setAttribute("style",`max-height: ${u||400}px`)}},t.length>10?this.renderSort(d,h):null,p),f,this.renderDone()))}renderSort(e,t){const{sortBy:r,strings:i}=this;return(0,n.h)("calcite-dropdown",{slot:"menu-actions",placement:"bottom-end",overlayPositioning:"fixed",widthScale:"s",onCalciteDropdownSelect:this.onSortMenuSelect},(0,n.h)("calcite-action",{slot:"trigger",label:i.sortValues,text:""},(0,n.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,n.h)("calcite-dropdown-group",null,(0,n.h)("calcite-dropdown-item",{selected:"count"===r||!E(r),"data-value":"count"},i.sortByCount),(0,n.h)("calcite-dropdown-item",{selected:"name"===r,"data-value":"name"},e||t?i.sortAscending:i.sortAlphabetical),(0,n.h)("calcite-dropdown-item",{selected:"selected"===r,"data-value":"selected"},i.sortSelected)))}renderUniqueValue(e){const{selectedValues:t,fieldDomains:r,layerFieldType:i,intl:s,props:a}=this,{view:o}=a,l=(null==o?void 0:o.timeZone)||"system",u=(null==r?void 0:r.length)?this.getDecodedValue(e.value):i===O.DATE?li(e.value,l,s):i===O.DATE_ONLY?ui(e.value,s):i===O.TIME_ONLY?ci(e.value,s):"number"==typeof e.value?s.formatNumber(e.value):e.value,c=!!t&&(i===O.DATE_ONLY?t.indexOf(oi(e.value))>-1:i===O.TIME_ONLY?t.indexOf(si(e.value))>-1:t.indexOf(e.value)>-1);return(0,n.h)("calcite-pick-list-item",{key:`pick-list-item_${e.value}`,label:`${u}`,value:`${e.value}`,selected:c},E(e.count)?(0,n.h)("div",{class:Fs,slot:"actions-end"},`${e.count}`):null)}renderDone(){const{multiple:e,strings:t}=this;return e?(0,n.h)("div",{class:xs},(0,n.h)("calcite-button",{appearance:"outline-fill",width:"full",onClick:this.done,label:t.done},t.done)):null}getDecodedValue(e){const{fieldDomains:t}=this,r=t;if(r){let t="";for(let n=0;n<r.length;n++){const i=r[n];i.code==e&&(t+=(t.length?" | ":"")+i.name)}return t}return e}get hostElement(){return(0,n.d)(this)}};Cs.style=".sc-arcgis-filter-unique-list-h{width:100%}.container.sc-arcgis-filter-unique-list{min-height:30px}.popover-unique-pick-list.sc-arcgis-filter-unique-list{width:100%;overflow-y:auto}.unique-values-content-list-msg.sc-arcgis-filter-unique-list{font-size:75%;margin:5px}.count.sc-arcgis-filter-unique-list{padding:12px 6px}.unique-values-done.sc-arcgis-filter-unique-list{padding:0.5rem}"},11246:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>h,c:()=>i,d:()=>n,e:()=>s,f:()=>c,g:()=>p,i:()=>a,m:()=>o,t:()=>l,u:()=>d});const n=(e,t)=>{let r,n="idle";const i=(...i)=>new Promise((s=>{switch(n){case"flushed":n="idle",r?(clearTimeout(r),s(e(...i))):s(null);break;case"invoked":clearTimeout(r),n="idle",s(e(...i));break;case"cancelled":clearTimeout(r),n="idle",s(null);break;default:r&&clearTimeout(r),n="pending",r=setTimeout((()=>(n="idle",s(e(...i)))),t)}}));return i.flush=function(...e){return n="flushed",i(...e)},i.invoke=function(...e){return n="invoked",i(...e)},i.cancel=function(...e){return n="cancelled",i(...e)},i.getStatus=function(){return n},i},i=(e,t)=>{let r;return(...n)=>new Promise((i=>{r||(r=setTimeout((()=>{clearTimeout(r),r=void 0,i(e(...n))}),t))}))};function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a(e){return null!=e}async function o(e,t){return await Promise.all([e,l(t)]),e}function l(e){return new Promise((t=>setTimeout(t,e)))}const u=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:r,data:n}=t(e);return[r,n]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,r)=>e&&t.indexOf(r)>-1),!0);function d(e,t){const r=[],n={};return e.forEach((e=>{const i=t(e);null==n[i]&&(n[i]=e,r.push(e))})),r}function h(e){const t={boolean:{},number:{},string:{}},r=[];return e.filter((e=>{let n=typeof e;return n in t?!t[n].hasOwnProperty(e)&&(t[n][e]=!0):!(r.indexOf(e)>=0)&&r.push(e)}))}const p=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((r,n)=>e.slice(t*n,t+t*n)))}}]);