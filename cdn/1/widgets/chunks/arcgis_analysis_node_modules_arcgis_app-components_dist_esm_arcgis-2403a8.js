/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2403a8.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2403a8"],{77813:(e,t,s)=>{s.r(t),s.d(t,{arcgis_smart_mapping_field_pick_list:()=>C,arcgis_smart_mapping_panels_assist:()=>K});var i=s(7263),a=s(77040),n=(s(70506),s(82646)),r=s(1991),l=s(23521),o=s(58233),c=s(75002),d=s(96432),h=s(96533),p=s(78327),m=s(32118),u=s(99680),g=s(90367),y=s(75148),f=s(64164),S=s(93143),v=s(86749);s(99004),s(62159),s(78613),s(11935),s(28926),s(64391);const C=class{constructor(e){(0,i.r)(this,e),this.arcgisSmartMappingFieldPickListClose=(0,i.c)(this,"arcgisSmartMappingFieldPickListClose",7),this.arcgisSmartMappingFieldPickListChange=(0,i.c)(this,"arcgisSmartMappingFieldPickListChange",7),this.arcgisSmartMappingFieldPickListSortByChange=(0,i.c)(this,"arcgisSmartMappingFieldPickListSortByChange",7),this.maxNumberFieldCount=10,this.selectedFields=[],this.fields=void 0,this.fieldToReplace=void 0,this.popoverProps=void 0,this.singleEditMode=!1,this.heading=void 0,this.okBtnText=void 0,this.filterPlaceholderText=void 0,this.lastSortBy=a.L.default,this.filterFields=null,this.isOpen=!1,this.width=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async componentWillLoad(){var e;this.isOpen=!0,this.rendererFieldInfosMap=null===(e=n.s.selectedFields)||void 0===e?void 0:e.reduce(((e,t)=>(e[t.field]=t,e)),{})}componentDidLoad(){var e;this.setUpObservers(),null===(e=this.resizeObserver)||void 0===e||e.observe(this.popoverProps.refElement);this.checkDisabledListItems().forEach((e=>this.listNode.removeChild(e))),requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){var e,t;null===(e=this.mutationObserver)||void 0===e||e.disconnect(),null===(t=this.resizeObserver)||void 0===t||t.unobserve(this.popoverProps.refElement)}render(){const e=this.popoverProps,{strings:t}=n.s;return(0,i.h)(i.H,{key:"6263000198b6577487794c01d4315cd638965937",class:"js-app-flyout"},(0,i.h)("calcite-popover",{key:"75814e3e8e1ec65e0fad6df0ec941a2a0796de5e",dir:n.s.isRTL?"rtl":"ltr",class:"popover",placement:e.placement||"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:e.refElement,offsetDistance:e.offsetDistance||10-(e.popoverWidth||this.width),offsetSkidding:e.offsetSkidding||0,overlayPositioning:e.overlayPositioning,triggerDisabled:e.triggerDisabled,label:this.heading||(this.singleEditMode?t.replaceField:t.fieldPickList.selectFields),ref:e=>this.popoverNode=e},(0,i.h)("calcite-flow",{key:"c98f5b292ed0d381893457fae18844c63de27dc9",ref:e=>this.flowNode=e,style:{width:`${this.width||e.popoverWidth}px`}},(0,i.h)("calcite-flow-item",{key:"39cbeb68084dec69d5ab97a7a05ce0ff336995d7",ref:e=>this.flowItemNode=e,class:"panel",heading:this.heading||(this.singleEditMode?t.replaceField:t.fieldPickList.selectFields),closable:!0,onCalciteFlowItemClose:()=>this.arcgisSmartMappingFieldPickListClose.emit()},!this.singleEditMode&&this.renderAddButton(),this.renderCancelButton(),this.renderList()))))}renderAddButton(){const{strings:e}=n.s;return(0,i.h)("calcite-button",{slot:"footer",appearance:"solid",width:"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields})},this.okBtnText||e.add)}renderCancelButton(){const{strings:e}=n.s;return(0,i.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:this.singleEditMode?"full":"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit()},e.cancel)}renderList(){var e;const{strings:t}=n.s;return(0,i.h)("calcite-list",{selectionMode:this.singleEditMode?"single-persist":"multiple",ref:e=>this.listNode=e,class:"content",filterEnabled:this.fields.length>=10,filterPlaceholder:null!==(e=this.filterPlaceholderText)&&void 0!==e?e:t.fieldPickList.searchFields,onCalciteListFilter:()=>{var e,t;this.filterFields=null===(t=null===(e=this.listNode)||void 0===e?void 0:e.filteredItems)||void 0===t?void 0:t.map((e=>e.value))}},this.renderSortDropdown(),this.renderListItems())}renderListItems(){return this.lastSortBy===a.L.type?this.renderItemsSortedByType():[a.L.display,a.L.field].includes(this.lastSortBy)?[...this.getSortedList()].map((e=>this.renderListItem(e))):[...this.fields].map((e=>this.renderListItem(e)))}renderItemsSortedByType(){const e=[...this.getSortedList()];return e.filter((e=>e.simpleFieldType===n.w.NUMBER)).map((e=>this.renderListItem(e))).concat(e.filter((e=>e.simpleFieldType===n.w.STRING)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.w.DATE)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.w.OID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.w.GUID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.w.UNKNOWN)).map((e=>this.renderListItem(e))))}renderListItem(e){var t;const{layer:s,useFeatureReduction:a,mapView:r,strings:l}=n.s,o="featureReduction"in s&&"binning"===(null===(t=s.featureReduction)||void 0===t?void 0:t.type)&&a;return(0,i.h)("calcite-list-item",{key:e.layerField.name,label:e.label||e.layerField.name,"data-type":e.simpleFieldType,value:e.layerField.name,selected:this.singleEditMode&&e.layerField.name===this.fieldToReplace.field,metadata:{label:e.label,fieldName:e.layerField.name},onCalciteListItemSelect:()=>{this.selectedFields=this.listNode.selectedItems.map((e=>e.value)),this.singleEditMode?this.selectedFields[0]!==this.fieldToReplace.field&&this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields}):(this.checkDisabledListItems(),this.arcgisSmartMappingFieldPickListChange.emit({selectedFields:this.selectedFields}))}},!o&&(0,i.h)("calcite-action",{slot:"actions-end",text:l.fieldPickList.info,scale:"s",icon:"information",onClick:t=>{var i;t.stopPropagation();const a=t.target,l=document.createElement("calcite-flow-item");l.heading=null!==(i=e.label)&&void 0!==i?i:e.layerField.name,l.description=e.layerField.name;const o=document.createElement("arcgis-field-info");o.lang=n.s.fullLocale,o.fieldName=e.layerField.name,o.layer=s,o.view=r,o.classList.add("content"),l.appendChild(o),l.addEventListener("calciteFlowItemBack",(()=>{requestAnimationFrame((()=>a.setFocus())),l.removeChild(o),this.flowNode.removeChild(l)})),this.flowNode.appendChild(l),requestAnimationFrame((()=>l.setFocus()))}}))}renderSortDropdown(){const{strings:e}=n.s;return this.fields.length>10?(0,i.h)("calcite-dropdown",{placement:"bottom-end",overlayPositioning:"fixed",slot:"filter-actions-end",ref:e=>this.dropdownNode=e,onCalciteDropdownOpen:()=>{var e;null===(e=this.mutationObserver)||void 0===e||e.disconnect(),this.mutationObserver.observe(this.popoverNode,{attributes:!0})},onCalciteDropdownClose:()=>{var e;return null===(e=this.mutationObserver)||void 0===e?void 0:e.disconnect()},onCalciteDropdownSelect:()=>{var e;this.lastSortBy=a.L[null===(e=this.dropdownNode.selectedItems[0])||void 0===e?void 0:e.label],this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}},(0,i.h)("calcite-action",{slot:"trigger",text:e.fieldPickList.sort,title:e.fieldPickList.sort},(0,i.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,i.h)("calcite-dropdown-group",null,(0,i.h)("calcite-dropdown-item",{label:a.L.default,selected:this.lastSortBy===a.L.default},e.fieldPickList.default),(0,i.h)("calcite-dropdown-item",{label:a.L.display,selected:this.lastSortBy===a.L.display},e.fieldPickList.displayName),(0,i.h)("calcite-dropdown-item",{label:a.L.type,selected:this.lastSortBy===a.L.type},e.fieldPickList.type),(0,i.h)("calcite-dropdown-item",{label:a.L.field,selected:this.lastSortBy===a.L.field},e.fieldPickList.fieldName))):null}checkDisabledListItems(){if(!this.listNode)return;const e=(0,n.C)();this.singleEditMode?e[this.fieldToReplace.simpleFieldType]--:this.selectedFields.forEach((t=>{const s=(0,n.t)(t);if(s){switch(s.simpleFieldType){case"number":e.number++;break;case"string":e.string++;break;case"date":e.date++}}}));const t=[];if(this.listNode.querySelectorAll("calcite-list-item").forEach((e=>this.enableListItem(e))),n.s.mapImageSublayer&&!n.s.supportsArcade&&e.number+e.string+e.date+e.unknown===1)this.listNode.querySelectorAll('[data-type="string"], [data-type="number"], [data-type="date"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))}));else if(n.s.mapImageSublayer&&e.number+e.string+e.date+e.unknown===1&&1===e.date)this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))}));else if(1===e.string)this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))})),1!==e.number&&1!==e.date&&1!==e.unknown||this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))}));else if(e.number+e.date+e.unknown>1)if(e.expression>0&&(1!==e.expression||3!==this.selectedFields.length||!this.rendererFieldInfosMap[this.selectedFields[2]].expression)||e.date>0&&2===e.number&&!this.singleEditMode||2===e.date||n.s.mapImageSublayer&&e.date>0){const e=this.fieldToReplace.simpleFieldType===n.w.NUMBER?'[data-type="date"], [data-type="string"]':n.w.STRING?'[data-type="date"], [data-type="number"]':'[data-type="string"], [data-type="number"]';this.listNode.querySelectorAll(e).forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))}))}else this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{this.disableListItem(e),t.push(e),this.selectedFields.indexOf(e.value)>-1&&(e.selected=!1)})),(e.number>2||n.s.mapImageSublayer)&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{this.disableListItem(e),t.push(e),this.selectedFields.indexOf(e.value)>-1&&(e.selected=!1)})),1===e.date&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))})),e.number>=this.maxNumberFieldCount&&this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{-1===this.selectedFields.indexOf(e.value)&&(this.disableListItem(e),t.push(e))}));return t}disableListItem(e){e.disabled=!0;const t=e.querySelector("calcite-action");t&&(t.disabled=!0)}enableListItem(e){e.disabled=!1;const t=e.querySelector("calcite-action");t&&(t.disabled=!1)}getSortedList(){const e=[...this.fields];return this.lastSortBy===a.L.field?e.sort(((e,t)=>"_"===e.layerField.name.charAt(0)?1:"_"===t.layerField.name.charAt(0)?-1:e.layerField.name.localeCompare(t.layerField.name))):e.sort(((e,t)=>"_"===e.label.charAt(0)?1:"_"===t.label.charAt(0)?-1:e.label.localeCompare(t.label))),e}setUpObservers(){this.mutationObserver=new MutationObserver((e=>{for(const t of e)"style"===t.attributeName&&"hidden"===this.popoverNode.style.visibility&&(this.dropdownNode.open=!1)})),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.width=1.05*t.contentRect.width}))}get hostElement(){return(0,i.d)(this)}};C.style=".popover{z-index:100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}";const b=["Age (color)","Age (size)","Charts","Charts and Size","Color (age) and Size","Color and Size","Color and Size (age)","Color and Size (univariate)","Compare A to B","Continuous Timeline (color)","Continuous Timeline (size)","Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Counts and Amounts (classed color)","Discrete Time Periods (categories)","Dot Density","Heat Map","Predominant category","Predominant category and Size","Relationship","Relationship and size","Types (unique symbols)","Types and Size","Types and Size (age)"],T=["Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Continuous Timeline (color)","Continuous Timeline (size)","Predominant category and Size"],w={"Counts and Amounts (color)":L,"Counts and Amounts (size)":P,"Counts and Amounts (opacity)":M,"Continuous Timeline (color)":L,"Continuous Timeline (size)":P,"Predominant category and Size":P},z={"Counts and Amounts (color)":R,"Counts and Amounts (size)":O,"Counts and Amounts (opacity)":V,"Continuous Timeline (color)":R,"Continuous Timeline (size)":O,"Predominant category and Size":I},k={"Age (color)":F,"Age (size)":N,Charts:B,"Charts and Size":B,"Color (age) and Size":async function(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:n}=e,r=await F({styleName:"Age (color)",fields:[t[0]],theme:a,layer:s,view:i,colorSchemeTags:n}),l=await O({styleName:"Counts and Amounts (size)",fields:[t[1]],theme:"above",layer:s,view:i});return{colorAgeStyleParams:r,sizeStyleParams:l}},"Color and Size":async function(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:n}=e,r=await x({styleName:"Counts and Amounts (color)",fields:[t[0]],theme:a,layer:s,view:i,colorSchemeTags:n}),l=await O({styleName:"Counts and Amounts (size)",fields:[t[1]],theme:"above",layer:s,view:i});return{colorStyleParams:r,sizeStyleParams:l}},"Color and Size (age)":async function(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:n}=e,r=await x({styleName:"Counts and Amounts (color)",fields:[t[0]],theme:a,layer:s,view:i,colorSchemeTags:n}),l=await N({styleName:"Age (size)",fields:[t[1]],theme:"above",layer:s,view:i});return{colorStyleParams:r,sizeAgeStyleParams:l}},"Color and Size (univariate)":async function(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:r}=e,{modules:l}=n.s;let o,c;null!=o||(o=t[0]),r&&(c=l.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,theme:a||"high-to-low"})[0]);return{layer:s,view:i,field:o,normalizationField:undefined,theme:a,colorOptions:{colorScheme:c}}},"Compare A to B":x,"Continuous Timeline (color)":x,"Continuous Timeline (size)":O,"Counts and Amounts (color)":x,"Counts and Amounts (size)":O,"Counts and Amounts (opacity)":V,"Counts and Amounts (classed color)":x,"Discrete Time Periods (categories)":A,"Dot Density":async function(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,{modules:r}=n.s;let l;a&&(l=r.dotDensitySchemes.getSchemesByTag({includedTags:a,numColors:Math.min(t.length,8)})[0]);return{layer:s,view:i,legendOptions:{unit:"units"},attributes:t.map((e=>{var t;return{field:e,label:null===(t=s.fields.find((t=>t.name===e)))||void 0===t?void 0:t.alias}})).slice(0,8),outlineOptimizationEnabled:!0,dotDensityScheme:l}},"Heat Map":async function(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,{modules:r}=n.s;let l,o;null!=l||(l=t[0]),a&&(o=r.heatmapSchemes.getSchemesByTag({includedTags:a})[0]);return{layer:s,view:i,field:l,heatmapScheme:o}},"Predominant category":I,"Predominant category and Size":I,Relationship:D,"Relationship and size":async function(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,n=await D({styleName:"Relationship",layer:s,view:i,fields:[t[0],t[1]],colorSchemeTags:a}),r=t[2]?await O({styleName:"Counts and Amounts (size)",fields:[t[2]],theme:"above",layer:s,view:i}):null;return{relationshipStyleParams:n,sizeStyleParams:r}},"Types (unique symbols)":A,"Types and Size":async function(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,n=await A({styleName:"Types and Size",layer:s,view:i,fields:[t[0]],colorSchemeTags:a}),r=await O({styleName:"Counts and Amounts (size)",fields:[t[1]],theme:"above",layer:s,view:i});return{typesStyleParams:n,sizeStyleParams:r}},"Types and Size (age)":async function(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,n=await A({styleName:"Types and Size",layer:s,view:i,fields:[t[0]],colorSchemeTags:a}),r=await N({styleName:"Age (size)",fields:[t[1]],theme:"above",layer:s,view:i});return{typesStyleParams:n,sizeAgeStyleParams:r}}};async function E(e,t){const s="update"===e?await async function(e){const t=await async function(e){let{styleName:t}=e;if(!T.includes(t)){const s=T.map((e=>e.toLocaleLowerCase()));if(!s.includes(t.toLocaleLowerCase()))throw new Error(`Unsupported update method: ${t}`);{const i=T[s.indexOf(t.toLocaleLowerCase())];t=i,e.styleName=t}}const s=z[t](e);return s}(e),{styleName:s}=e,{renderer:i}=await w[s](t);return i}(t):await async function(e){const t=await async function(e){let{styleName:t}=e;if(!b.includes(t)){const s=b.map((e=>e.toLocaleLowerCase()));if(!s.includes(t.toLocaleLowerCase()))throw new Error(`Unrecognized style: ${t}`);{const i=b[s.indexOf(t.toLocaleLowerCase())];t=i,e.styleName=t}}const s=k[t](e);return s}(e),{styleName:s,view:i}=e,{renderer:a}=await function(e){const{modules:t}=n.s;switch(e){case"Age (color)":return t.ColorCreator.createAgeRenderer;case"Age (size)":return t.SizeCreator.createAgeRenderer;case"Charts":case"Charts and Size":return t.PieChartCreator.createRenderer;case"Color (age) and Size":return _;case"Color and Size":return q;case"Color and Size (age)":return U;case"Color and Size (univariate)":return t.UnivariateColorSizeCreator.createContinuousRenderer;case"Compare A to B":case"Continuous Timeline (color)":case"Counts and Amounts (color)":return t.ColorCreator.createContinuousRenderer;case"Continuous Timeline (size)":case"Counts and Amounts (size)":return t.SizeCreator.createContinuousRenderer;case"Counts and Amounts (opacity)":return M;case"Counts and Amounts (classed color)":return t.ColorCreator.createClassBreaksRenderer;case"Discrete Time Periods (categories)":case"Types (unique symbols)":return t.TypeCreator.createRenderer;case"Dot Density":return t.DotDensityCreator.createRenderer;case"Heat Map":return t.HeatmapCreator.createRenderer;case"Predominant category":case"Predominant category and Size":return t.PredominanceCreator.createRenderer;case"Relationship":return t.RelationshipCreator.createRenderer;case"Relationship and size":return H;case"Types and Size":return $;case"Types and Size (age)":return j}}(s)(t);"heatmap"===a.type&&(a.referenceScale=i.scale);"pie-chart"===a.type&&(a.size=4);"dot-density"===a.type&&(a.dotSize=2,a.dotShape="circle");return a}(t);return s}async function P(e){const t=(0,n.a)(),s=(0,n.k)(),i=J("size");return{renderer:(await i({fieldInfos:e.field?["color","color-age","type","relationship","predominance"].includes(t)?[...s,{field:e.field,simpleFieldType:(0,n.t)(e.field).simpleFieldType}]:void 0:[...s],includeSizeVariable:e.includeSizeVariable})).renderer}}async function L(e){const t=(0,n.a)(),s=(0,n.k)(),i=J("color");return{renderer:(await i({fieldInfos:["size","size-age"].includes(t)?[{field:e.field,simpleFieldType:(0,n.t)(e.field).simpleFieldType},s[0]]:void 0,colorScheme:e.colorScheme,sizeScheme:e.colorScheme,relationshipScheme:e.colorScheme,predominanceScheme:e.colorScheme,pieChartScheme:e.colorScheme,dotDensityScheme:e.colorScheme,heatmapScheme:e.colorScheme,locationScheme:e.colorScheme,typeScheme:e.colorScheme})).renderer}}async function M(e){const{modules:t}=n.s,s=e.layer.renderer.clone();if("dictionary"===s.type)return{renderer:s};const{visualVariable:i}=await t.OpacityVariableCreator.createVisualVariable(e);return s.visualVariables=(0,n.T)(s,"opacity")||[],s.visualVariables.push(i),s.authoringInfo&&(s.authoringInfo.visualVariables=(0,n.U)(s,"opacity")||[]),{renderer:s}}async function A(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,{modules:r}=n.s;let l,o,c,d;return null!=l||(l=t[0]),null!=o||(o=t[1]),null!=c||(c=t[2]),a&&(d=r.typeSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:a})[0]),{layer:s,view:i,field:l,field2:o,field3:c,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,typeScheme:d}}async function x(e){let{fields:t,layer:s,view:i,theme:a,styleName:r,colorSchemeTags:l}=e;const{modules:o}=n.s;let c,d,h;return null!=c||(c=t[0]),null!=d||(d=t[1]),"Compare A to B"===r&&(null!=d||(d=t[1]),a="above-and-below"),l&&(h=o.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:l,theme:a||"high-to-low"})[0]),{layer:s,view:i,field:c,normalizationField:d,theme:a,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:h}}async function F(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:r}=e,{modules:l}=n.s,o=t[0];let c;return r&&(c=l.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,theme:a||"high-to-low"})[0]),{layer:s,view:i,startTime:o,endTime:new Date,theme:a,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:c}}async function O(e){const{fields:t,layer:s,view:i,theme:a}=e;let r,l;if(null!=r||(r=t[0]),null!=l||(l=t[1]),!r){const e=(0,n.k)();e.length&&(r=e[0].field)}return{layer:s,view:i,field:r,normalizationField:l,theme:a,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function N(e){const{fields:t,layer:s,view:i,theme:a}=e;return{layer:s,view:i,startTime:t[0],endTime:new Date,theme:a,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function I(e){const{fields:t,layer:s,view:i,styleName:a,colorSchemeTags:r}=e,{modules:l}=n.s;let o;return r&&(o=l.predominanceSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,numColors:Math.min(t.length,10)})[0]),{layer:s,view:i,fields:t.map((e=>({name:e}))).slice(0,9),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:a.includes("Size"),predominanceScheme:o}}async function B(e){const{fields:t,layer:s,view:i,styleName:a,colorSchemeTags:r}=e,{modules:l}=n.s;let o;return o=r?l.pieChartSchemes.getSchemesByTag({basemapTheme:await l.colorUtils.getBackgroundColorTheme(i),geometryType:s.geometryType,includedTags:r,numColors:Math.min(t.length,8)})[0]:l.pieChartSchemes.getSchemes({basemapTheme:await l.colorUtils.getBackgroundColorTheme(i),geometryType:s.geometryType,numColors:Math.min(t.length,8)}).primaryScheme,{layer:s,view:i,attributes:t.map((e=>{var t;return{field:e,label:null===(t=s.fields.find((t=>t.name===e)))||void 0===t?void 0:t.alias}})).slice(0,8),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:a.includes("Size"),pieChartScheme:o}}async function D(e){const{fields:t,layer:s,view:i,colorSchemeTags:a}=e,{modules:r}=n.s;let l;const o={field:t[0]},c={field:t[1]};return a&&(l=r.relationshipSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:a})[0]),{layer:s,view:i,field1:o,field2:c,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,relationshipScheme:l}}async function R(e){const{fields:t,layer:s,view:i,theme:a,colorSchemeTags:r}=e;let l,o,c;if(null!=l||(l=t[0]),null!=o||(o=t[1]),!l){const e=(0,n.k)();e.length&&(l=e[0].field)}if(r){c=function(){const{modules:e}=n.s,t=(0,n.a)();switch(t){case"color":case"color-age":case"color-size":case"color-age-size":case"color-size-age":case"compare":return e.colorSchemes.getSchemesByTag;case"type":case"type-size":case"type-size-age":return e.typeSchemes.getSchemesByTag;case"dot-density":return e.dotDensitySchemes.getSchemesByTag;case"heatmap":return e.heatmapSchemes.getSchemesByTag;case"relationship":case"relationship-size":return e.relationshipSchemes.getSchemesByTag;case"predominance":case"predominance-size":return e.predominanceSchemes.getSchemesByTag;case"chart":case"chart-size":return e.pieChartSchemes.getSchemesByTag;default:return console.error("unknown renderer type",t),e.colorSchemes.getSchemesByTag}}()({geometryType:s.geometryType,includedTags:r,theme:a||(0,n.K)("color")})[0]}return{layer:s,view:i,field:l,normalizationField:o,theme:a,colorScheme:c}}async function V(e){const{fields:t,layer:s,view:i}=e;let a,r;if(null!=a||(a=t[0]),null!=r||(r=t[1]),!a){const e=(0,n.k)();e.length&&(a=e[0].field)}return{layer:s,view:i,field:a,normalizationField:r}}async function q(e){const{colorStyleParams:t,sizeStyleParams:s}=e,{modules:i}=n.s,{renderer:a,visualVariable:r}=await i.ColorCreator.createContinuousRenderer(t),{renderer:l}=await i.SizeCreator.createContinuousRenderer(s),o=l.authoringInfo,c=a.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}async function _(e){const{colorAgeStyleParams:t,sizeStyleParams:s}=e,{modules:i}=n.s,{renderer:a,visualVariable:r}=await i.ColorCreator.createAgeRenderer(t),{renderer:l}=await i.SizeCreator.createContinuousRenderer(s),o=l.authoringInfo,c=a.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}async function U(e){const{colorStyleParams:t,sizeAgeStyleParams:s}=e,{modules:i}=n.s,{renderer:a,visualVariable:r}=await i.ColorCreator.createContinuousRenderer(t),{renderer:l}=await i.SizeCreator.createAgeRenderer(s),o=l.authoringInfo,c=a.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}async function $(e){const{typesStyleParams:t,sizeStyleParams:s}=e,{modules:i}=n.s,a=t.layer.geometryType,{renderer:r}=await i.TypeCreator.createRenderer(t),{visualVariables:l,renderer:o}=await i.SizeCreator.createContinuousRenderer(s);if("polygon"===a){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const s=e.clone();s.color=t.symbol.color,t.symbol=s}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}async function j(e){const{typesStyleParams:t,sizeAgeStyleParams:s}=e,{modules:i}=n.s,a=t.layer.geometryType,{renderer:r}=await i.TypeCreator.createRenderer(t),{visualVariables:l,renderer:o}=await i.SizeCreator.createAgeRenderer(s);if("polygon"===a){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const s=e.clone();s.color=t.symbol.color,t.symbol=s}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}async function H(e){const{relationshipStyleParams:t,sizeStyleParams:s}=e,{modules:i}=n.s,a=t.layer.geometryType,{renderer:r}=await i.RelationshipCreator.createRenderer(t);if(!s)return{renderer:r};const{visualVariables:l,renderer:o}=await i.SizeCreator.createContinuousRenderer(s);if("polygon"===a){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const s=e.clone();s.color=t.symbol.color,t.symbol=s}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}function J(e){const{layer:t}=n.s;if(!(0,n.r)(t))return;const s=t.renderer.authoringInfo,i=(0,n.a)();switch(i){case"simple":return c.a;case"color":return"size"===e?h.b:"class-breaks-color"===(null==s?void 0:s.type)?d.e:d.b;case"size":return"color"===e?h.b:"type"===e?v.c:"relationship"===e?p.a:"class-breaks-size"===(null==s?void 0:s.type)?h.k:h.f;case"type":return"size"===e?v.c:f.a;case"color-age":return"size"===e?h.d:d.d;case"size-age":return"color"===e?h.e:"type"===e?v.a:h.h;case"color-size":return"univariate-color-size"===(null==s?void 0:s.type)?g.b:h.g;case"color-age-size":return h.j;case"color-size-age":return h.i;case"type-size":return v.b;case"type-size-age":return v.d;case"dot-density":return p.d;case"heatmap":return m.a;case"relationship":return"size"===e?p.a:S.a;case"relationship-size":return p.b;case"predominance":case"predominance-size":return u.a;case"chart":case"chart-size":return g.d;case"compare":return y.a;default:return void console.error("unknown renderer type:",i)}}const G=({portal:e})=>(null==e?void 0:e.user)?(0,i.h)("arcgis-user-avatar",{class:"avatar-user",user:e.user,portal:e}):e?(0,i.h)("div",{class:"avatar avatar-portal"},(0,i.h)("calcite-icon",{class:"avatar-icon",icon:"user",scale:"s"})):(0,i.h)("div",{class:"avatar avatar-bot"},(0,i.h)("calcite-icon",{class:"avatar-icon",icon:"effects",scale:"s"})),W=({})=>(0,i.h)("div",{class:"message-loader"},(0,i.h)("svg",{version:"1.1",id:"message-loader",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 100 100","enable-background":"new 0 0 0 0"},(0,i.h)("circle",{fill:"#000",stroke:"none",cx:"6",cy:"50",r:"6"},(0,i.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.1"})),(0,i.h)("circle",{fill:"#000",stroke:"none",cx:"26",cy:"50",r:"6"},(0,i.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.2"})),(0,i.h)("circle",{fill:"#000",stroke:"none",cx:"46",cy:"50",r:"6"},(0,i.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.3"})))),K=class{constructor(e){(0,i.r)(this,e),this.smartMappingCompleteClose=(0,i.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsAssistClose=(0,i.c)(this,"arcgisSmartMappingPanelsAssistClose",7),this.arcgisSmartMappingPanelsAssistBackClick=(0,i.c)(this,"arcgisSmartMappingPanelsAssistBackClick",7),this.arcgisSmartMappingPanelsAssistError=(0,i.c)(this,"arcgisSmartMappingPanelsAssistError",7),this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate=(0,i.c)(this,"arcgisSmartMappingPanelsAssistClusterRequiresUpdate",7),this.chat=[],this.tileNodes=[],this.handleDone=()=>{this.arcgisSmartMappingPanelsAssistClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,n.l)(e,t),this.arcgisSmartMappingPanelsAssistClose.emit("cancel")},this.handleGenerate=async()=>{const{textAreaNode:e,chat:t,activeRendererIdx:s}=this,{layer:i,strings:a}=n.s;if(!(0,n.r)(i))return;const r=e.value;if(!r)return;this.usingLastStyleTile()||(t.length=s+1),t.push({text:r,type:"question"}),this.loading=!0,this.scrollTo(),e.value="";const o={text:r},c=await(0,l.a)(o);if(this.loading){if("valid"!==c.status)return t.push(c),this.loading=!1,void this.scrollTo();await async function(e,t){const{text:s}=e,{layer:i,mapView:a}=n.s;if(!(0,n.r)(i))return;if(-1===[200,902].indexOf(t.dataObject.status_code))return t.message=t.dataObject.botMessage,t.status="error",console.log("*** question/response: ",JSON.stringify({question:s,responseObj:t})),t;const{actionResponse:r}=t.dataObject,{action:l}=r,o=r.style_name;let c;r.theme&&(c=r.theme.trim().toLowerCase().replace(/\"/g,"").replace(/theme/g,"").replace(/:/g,"").replace(/;/g,"").replace(/'/g,"").trim().replace(/ /g,"-"),c="none"===c?void 0:c);const d=r.field_names,h=[r.color_scheme];console.log("*** question/response: ",JSON.stringify({question:s,actionResponse:r}));try{const e=await E(l,{layer:i,view:a,fields:d,styleName:o,theme:c,colorSchemeTags:h});return t.renderer=e,t.rendererFields=d,t.message=`${t.message}. Here's a ${o} map.`,t}catch(e){return t.message=`I'm sorry. There must have been a misunderstanding. I see the following error: ${e.message}`,t.status="error",t}}(o,c),t.push(c),c.renderer&&(this.activeRendererIdx=t.length-1,(0,n.u)(c.renderer),n.s.selectedFields=(0,n.k)(),n.s.selectedFields.forEach((e=>{e.expression&&!e.expressionTitle&&(e.expressionTitle=a.expression)}))),this.loading=!1,this.scrollTo()}},this.handleRestart=()=>{this.chat=[],this.loading=!1;const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,n.l)(e,t),(0,i.f)(this.hostElement),setTimeout((()=>this.textAreaNode.setFocus()),500)},this.handleChip=e=>{const{textAreaNode:t}=this,{strings:s}=n.s;switch(e){case 0:t.value="How can I style the data in the layer";break;case 1:t.value=`${s.panels.assist.mainSuggestion1} `;break;case 2:t.value=`${s.panels.assist.mainSuggestion2} `;break;case 3:t.value=`${s.panels.assist.mainSuggestion3} `;break;default:t.value=`${s.panels.assist.mainSuggestion4} `}(0,i.f)(this.hostElement),setTimeout((()=>t.setFocus()),300)},this.handleSecondaryChip=e=>{const{textAreaNode:t}=this,{strings:s}=n.s;switch(e){case 1:t.value=`${s.panels.assist.secondSuggestion1} `;break;case 2:t.value=`${s.panels.assist.secondSuggestion2} `;break;default:t.value=`${s.panels.assist.secondSuggestion3} `}(0,i.f)(this.hostElement),setTimeout((()=>t.setFocus()),300)},this.handleStyleTileClick=e=>{const{chat:t}=this,s=t[e];this.activeRendererIdx=e,(0,n.u)(s.renderer)},this.handleStyleTileCustomize=e=>{const{chat:t,panelsParentNode:s}=this,a=t[e],r=(0,n.ag)(a.renderer),{selectedFields:l}=n.s;switch(r){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,i.f)(this.hostElement),this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,i.f)(this.hostElement),this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate.emit()})),e.addEventListener("onArcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsDotDensityError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"color-size":case"color-age-size":case"color-size-age":if(l.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,i.f)(this.hostElement),this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e)}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,i.f)(this.hostElement),this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e)}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,i.f)(this.hostElement),this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(t=>{s.removeChild(e),this.focusSelectedTile(),this.handleStyleOptionsDone(t.detail,a)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>{this.focusSelectedTile(),this.handleStyleOptionsDone("save",a)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),s.appendChild(e);break}}},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.loading=!1,this.activeRendererIdx=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:t}=n.s,s=(0,n.b)();this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.ah)(this.hostElement)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){}render(){const{layer:e,hideLayerTitle:t,isRTL:s,strings:a}=n.s;return console.log("chat",this.chat),(0,i.h)(i.H,{key:"98fda3488d6e69fdb0f3228bb74cfb89d54e1c4e",class:"calcite-match-height"},(0,i.h)("calcite-flow-item",{key:"fe94986b1d53aa9ab52533d25dcc6b84a5952e8f",heading:a.panels.assist.heading,description:t?void 0:e.title,class:{"flow-item":!0,[o.C.rtl]:s},closable:!1,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsAssistBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderContent(),this.renderDisclaimer()))}renderDoneButton(){const{layer:e,strings:t}=n.s;return e?(0,i.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=n.s;return e?(0,i.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderContent(){const{chat:e,loading:t}=this;return e.length||t?this.renderGeneratedContent():this.renderInitialContent()}renderInitialContent(){const{strings:e}=n.s;return(0,i.h)("div",{class:"content content-initial"},(0,i.h)("calcite-icon",{icon:"effects"}),(0,i.h)("div",{class:"title"},e.panels.assist.title),(0,i.h)("div",{class:"sub-title"},e.panels.assist.subTitle),this.renderInput(),this.renderSuggestions())}renderGeneratedContent(){const{chat:e,loading:t}=this;return(0,i.h)("div",{class:"content content-generated"},(0,i.h)("div",{class:"messages",ref:e=>this.messagesNode=e},e.map(((e,t)=>this.renderChatMessage(e,t))),t&&(0,i.h)(W,null)),(0,i.h)("div",{class:"bottom-input"},this.renderSecondarySuggestions(),this.renderInput()))}renderChatMessage(e,t){return(0,i.h)("div",{class:"message","data-value":t},"question"===e.type?this.rendererQuestion(e):this.renderResponse(e,t))}rendererQuestion(e){const{portal:t}=n.s;return(0,i.h)("div",{class:"chat-question"},(0,i.h)(G,{portal:t}),(0,i.h)("div",{class:"question"},e.text))}renderResponse(e,t){return e.renderer?this.renderStyleTile(e,t):(0,i.h)("div",{class:"chat-response"},(0,i.h)(G,null),(0,i.h)("div",{class:"response"},e.message))}renderStyleTile(e,t){var s;const{activeRendererIdx:a}=this,r=(0,n.ag)(e.renderer),l=null===(s=(0,n.k)(e.renderer))||void 0===s?void 0:s.map((e=>{var t;return(null===(t=(0,n.t)(e.field))||void 0===t?void 0:t.label)||e.field}));return(0,i.h)("div",{class:"chat-response"},(0,i.h)(G,null),(0,i.h)("arcgis-smart-mapping-tile",{key:t,class:"tile",tileType:"assist",type:r,selected:a===t,fields:l,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleStyleTileClick(t),onArcgisSmartMappingTileOptions:()=>this.handleStyleTileCustomize(t)}))}renderInput(){var e;const{chat:t}=this,{strings:s}=n.s;return(0,i.h)(i.F,null,(0,i.h)("calcite-text-area",{disabled:this.loading,class:"text-input",placeholder:s.panels.assist.placeholder,value:"",scale:"s",resize:"vertical",rows:3,onCalciteTextAreaInput:()=>this.generateButtonNode.disabled=!this.textAreaNode.value,onKeyUp:e=>{"Enter"===e.key&&this.textAreaNode.value&&(e.preventDefault(),this.handleGenerate())},ref:e=>this.textAreaNode=e}),(0,i.h)("div",{class:"generate-buttons"},!!t.length&&(0,i.h)(i.F,null,(0,i.h)("calcite-button",{class:"restart-button",slot:"footer",iconStart:"refresh",label:s.panels.assist.restart,onClick:this.handleRestart,appearance:"transparent",width:"auto"},s.panels.assist.restart),(0,i.h)("span",null,"\xa0\xa0")),(0,i.h)("calcite-button",{disabled:this.loading||!(null===(e=this.textAreaNode)||void 0===e?void 0:e.value),class:"generate-button",slot:"footer",iconStart:"effects",label:s.panels.assist.generate,onClick:()=>{this.loading||this.handleGenerate()},appearance:"solid",width:"auto",ref:e=>this.generateButtonNode=e},s.panels.assist.generate)))}renderSuggestions(){const{strings:e}=n.s;return(0,i.h)("div",{class:"suggestions"},(0,i.h)("div",{class:"suggestions-title"},e.panels.assist.suggestedPrompts),(0,i.h)("calcite-chip",{class:"chip",scale:"s",value:"0",appearance:"outline-fill",onClick:()=>this.handleChip(0)},"How can I style the data in the layer"),(0,i.h)("br",null),(0,i.h)("calcite-chip",{class:"chip",scale:"s",value:"1",appearance:"outline-fill",onClick:()=>this.handleChip(1)},`${e.panels.assist.mainSuggestion1}...`),(0,i.h)("br",null),(0,i.h)("calcite-chip",{class:"chip",scale:"s",value:"2",appearance:"outline-fill",onClick:()=>this.handleChip(2)},`${e.panels.assist.mainSuggestion2}...`),(0,i.h)("br",null),(0,i.h)("calcite-chip",{class:"chip",scale:"s",value:"3",appearance:"outline-fill",onClick:()=>this.handleChip(3)},`${e.panels.assist.mainSuggestion3}...`),(0,i.h)("br",null),(0,i.h)("calcite-chip",{class:"chip",scale:"s",value:"4",appearance:"outline-fill",onClick:()=>this.handleChip(4)},`${e.panels.assist.mainSuggestion4}...`))}renderSecondarySuggestions(){const{strings:e}=n.s;return(0,i.h)("div",{class:"secondary-suggestions"},(0,i.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"1",appearance:"solid",onClick:()=>!this.loading&&this.handleSecondaryChip(1)},e.panels.assist.secondSuggestion1),(0,i.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"2",appearance:"solid",onClick:()=>!this.loading&&this.handleSecondaryChip(2)},e.panels.assist.secondSuggestion2))}renderDisclaimer(){return(0,i.h)("div",{class:"disclaimer"},(0,i.h)("div",{class:"disclaimer-icon"},(0,i.h)("calcite-icon",{class:"disclaimer-icon",icon:"information",scale:"s"})),(0,i.h)("div",null,"\xa0\xa0"),(0,i.h)("div",{class:"disclaimer-text"},(0,i.h)("span",null,'"AI generated content may be inaccurate or misleading."')))}handleStyleOptionsDone(e,t){const{layer:s,modules:i}=n.s;"save"===e&&(t.renderer=i.esriLang.clone(s.renderer))}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.tileNodes[0])||void 0===e?void 0:e.setFocus()}))),300)}usingLastStyleTile(){const{chat:e,activeRendererIdx:t}=this;if(e.length>1&&(0,r.i)(t)){let s=e.length;return e.forEach(((e,t)=>{"renderer"in e&&e.renderer&&(s=t)})),t===s}return!0}scrollTo(){const{textAreaNode:e,messagesNode:t}=this;setTimeout((()=>{null==t||t.scrollTo(0,t.scrollHeight)}),300),setTimeout((()=>{null==e||e.setFocus(),null==t||t.scrollTo(0,t.scrollHeight)}),500)}get hostElement(){return(0,i.d)(this)}};K.style=":host{width:100%}.flow-item{height:100%}.content{height:100%;background-color:#ffffff}.content-initial{padding:12px 9px}.content-generated{display:flex;flex-direction:column;justify-content:space-between;overflow-y:hidden}.title{font-weight:bold;font-size:16px}.sub-title{font-size:var(--calcite-font-size--1);padding-bottom:10px}.text-input{padding:10px 0 20px 0;width:100%}.generate-buttons{display:flex;justify-content:right;margin-bottom:20px}.arcgis--rtl .generate-buttons{justify-content:left}.suggestions{background-color:var(--calcite-color-foreground-2);padding:8px;margin:20px 0}.suggestions-title{font-size:var(--calcite-font-size--1);padding-bottom:5px}.chip{max-width:100%;margin-top:5px}.disclaimer{font-size:var(--calcite-font-size--2);background-color:#ffffff;padding:8px;display:flex;justify-content:space-between}.disclaimer-icon{height:100%;vertical-align:middle}.disclaimer-text{line-height:16px}.avatar{border-radius:50%;width:30px;min-width:30px;height:30px;display:flex;justify-content:center}.avatar-user{min-width:30px}.avatar-portal{background-color:var(--calcite-color-foreground-2)}.avatar-bot{background-color:#dcf2f4}.avatar-icon{vertical-align:middle;height:100%}.bottom-input{border-top:1px solid var(--calcite-color-foreground-2);padding:0 9px}.messages{height:100%;overflow-y:auto;overflow-x:hidden;padding:12px 9px}.message-loader{display:flex;height:40px;margin:0 10px}.message{margin-bottom:14px}.chat-question{display:flex;-moz-column-gap:5px;column-gap:5px}.chat-response{display:flex;margin:3px 0;-moz-column-gap:5px;column-gap:5px}.question,.response{background-color:var(--calcite-color-foreground-2);padding:8px 10px;border-radius:8px;font-size:var(--calcite-font-size--2);line-height:19.25px;white-space:pre-wrap}.tile{width:100%}"},23521:(e,t,s)=>{s.d(t,{a:()=>n,s:()=>r});s(77040),s(70506);var i=s(82646);const a="https://ndh-inf-ml-p01.esri.com/dev/mapping";async function n(e){var t;const{text:s}=e,{layer:n,modules:r}=i.s;if(!(0,i.r)(n))return;const l={token:"",map_data:{data:n.fields.map((e=>({fieldName:e.name,alias:e.alias,dataType:e.type})))},messages:s,entry_point:"style"},o={method:"post",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}};console.log("request body: ",l);try{const e=(null===(t=r.urlUtils.urlToObject(document.URL).query)||void 0===t?void 0:t.assistUrl)||a,{data:i}=await r.esriRequest(e,o);if(i.status_code&&200!==i.status_code)return console.log("*** question/response: ",JSON.stringify({question:s,response:i})),Promise.resolve({message:i.botMessage,status:"error",type:"response"});const n=i[0],l=n.botMessage,c="map_style"===n.actionType?"valid":"invalid";return Promise.resolve({message:l,status:c,dataObject:n,type:"response"})}catch(e){return Promise.resolve({message:e.message,status:"error",type:"response"})}}async function r(e){const{text:t}=e,{layer:s,modules:n}=i.s;if(!(0,i.r)(s))return;const r=s.fields.map((e=>({fieldName:e.name,alias:e.alias,dataType:e.type}))),l={method:"post",body:JSON.stringify({token:"",map_data:{data:r},messages:t,entry_point:"style"}),headers:{"Content-Type":"application/json"}};console.log(JSON.stringify(l));try{await n.esriRequest(a,l)}catch(e){}}}}]);