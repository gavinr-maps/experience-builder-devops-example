/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a"],{85640:(i,t,a)=>{a.r(t),a.d(t,{arcgis_item_classification:()=>c});var e=a(7263),s=a(62159),n=a(25887),l=a(31670);a(78613),a(58233),a(28926),a(70506),a(99004),a(46581),a(94788),a(65215),a(11935);const o=["createdUser","createdDate","lastEditedUser","lastEditedDate","banner"],c=class{constructor(i){(0,e.r)(this,i),this.orgClassificationType=null,this.orgItemClassificationValue=null,this.retrieveClassificationSchema=async()=>{var i,t,a;const e=`${l.c.config.restBaseUrl}portals/self/ClassificationSchema`,s=await(0,n.r)(e),{result:o,error:c}=s;o?(this.classificationSchema=o,this.classificationCategoryArr=null===(t=null===(i=o.classificationMetadata)||void 0===i?void 0:i.classificationValueProperties)||void 0===t?void 0:t.map((i=>({value:i.value,label:i.value,textColor:i.textColor,backgroundColor:i.backgroundColor}))),this.setAttributeCategory(null===(a=o.attributeCategories)||void 0===a?void 0:a[0]),this.retrieveItemClassificationValue()):this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==c?void 0:c.message})},this.retrieveItemClassificationValue=async()=>{var i;const t=`${l.c.config.restBaseUrl}content/users/${l.c.user.username}/items/${this.itemId}`,a=await(0,n.a)(t),{result:e,error:s}=a;s?(console.error(s),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==s?void 0:s.message})):(this.itemClassificationValue=e?JSON.parse(e):{},this.orgItemClassificationValue=structuredClone(this.itemClassificationValue),this.classificationType=this.convertClassificationType(this.retrieveClassificationType(e?{value:this.defineClassificationVal().classification}:{value:null===(i=this.classificationSchema)||void 0===i?void 0:i.classificationMetadata.defaultValue})),this.orgClassificationType=this.getClassificationType(this.defineClassificationVal().classification),this.generateSelectionText(),this.generateBannerText(),e&&this.validateClassificationVal(JSON.parse(e)))},this.defineClassificationVal=()=>{var i,t;const a=null===(i=this.classificationSchema)||void 0===i?void 0:i.classificationMetadata.defaultValue;if(this.itemClassificationValue){const i=structuredClone(this.itemClassificationValue);return(null===(t=this.itemClassificationValue)||void 0===t?void 0:t.classification)||(i.classification=a),i}return{classification:a}},this.generateSelectionText=async()=>{var i,t;const a=null===(t=null===(i=this.classificationSchema)||void 0===i?void 0:i.layouts.default)||void 0===t?void 0:t.selectionTextExpression,e=this.defineClassificationVal();(null==a?void 0:a.length)>0?this.currSelectionText=await(0,n.e)(a,JSON.stringify(this.classificationSchema),JSON.stringify(e)):this.currSelectionText=this.generateCustomText("selectionDisplayOrder","selectionDisplayLabel")},this.generateBannerText=async()=>{var i,t,a;if(!(null===(i=this.itemClassificationValue)||void 0===i?void 0:i.classification))return void this.displayClassificationVal("UNCLASSIFIED");const e=null===(a=null===(t=this.classificationSchema)||void 0===t?void 0:t.layouts.default)||void 0===a?void 0:a.bannerExpression;if((null==e?void 0:e.length)>0){const i=await(0,n.e)(e,JSON.stringify(this.classificationSchema),JSON.stringify(this.itemClassificationValue));this.bannerText=i}else this.bannerText=this.generateCustomText("bannerOrder","bannerLabel");this.displayClassificationVal(this.bannerText)},this.hasNonexistingAttribute=i=>!!i.find((i=>!o.includes(i)&&!this.classificationSchema.attributes[i])),this.hasDisabledAttribute=async(i,t)=>{for(const a in i){const e=i[a];if(!o.includes(e))try{if(!await(0,n.i)(e,this.classificationSchema,JSON.stringify(t))){this.doesValidate=!1;break}}catch(i){this.doesValidate=!1;break}}},this.hasUpdatedAttributeValues=async(i,t)=>{for(const a in i){const e=i[a];if(o.includes(e))continue;const s=t[e],l=this.classificationSchema.layouts.default.layoutElements[e].uiElement||"text";if("multi-grouped-select"===l)try{const i=await(0,n.b)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue)),t=Object.values(i).some((i=>s.some((t=>i.some((({value:i})=>i===t))))));this.doesValidate=t}catch(i){return void(this.doesValidate=!1)}else if(l.includes("-select"))try{const i=await(0,n.b)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue)),t="string"==typeof s?i.some((i=>i.value===s)):s.some((t=>i.some((i=>i.value===t))));this.doesValidate=t}catch(i){return void(this.doesValidate=!1)}}},this.validateClassificationVal=async i=>{var t;const a=null===(t=Object.keys(i))||void 0===t?void 0:t.filter((i=>"classification"!==i));0===a.length&&(this.doesValidate=!1),this.hasNonexistingAttribute(a)&&(this.doesValidate=!1),this.doesValidate&&await this.hasDisabledAttribute(a,i),this.doesValidate&&await this.hasUpdatedAttributeValues(a,i)},this.saveItemClassificationValue=async()=>{if(this.validateInputError()){this.isCheckingError=!1;try{this.isCheckingError=!1,this.isSaving=!0;const i=`${l.c.config.restBaseUrl}content/users/${l.c.user.username}/items/${this.itemId}/update`;this.itemClassificationValue.banner=structuredClone(this.bannerText),this.saveEditInfo();(await(0,n.s)(i,this.itemClassificationValue)).success&&(this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"success",alertIndicatorIcon:"check-circle",alertIndicatorInfo:this.i18n.classificationValueSaved}),this.closeClassificationEditModal("save"),this.retrieveClassificationSchema())}catch(i){console.error(i),this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}}else this.isSaving=!1,this.isCheckingError=!0},this.handleDisplayNotificationModal=i=>{this.alertIndicator=i,this.isNotificationModalActive=!0},this.handleCloseNotificationModal=()=>this.isNotificationModalActive=!1,this.itemId=void 0,this.config=void 0,this.isDisplayModal=void 0,this.setIsDisplayModal=void 0,this.displayClassificationVal=void 0,this.api=void 0,this.bannerText="",this.currSelectionText="",this.classificationSchema=null,this.classificationCategoryArr=[],this.classificationType=null,this.itemClassificationValue=null,this.attributeCategory="General",this.doesValidate=!0,this.isSaving=!1,this.isCheckingError=!1,this.isResetting=!1,this.validationErrors=void 0,this.isNotificationModalActive=!1,this.alertIndicator={alertIndicatorActive:!1,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:""},this.attributeValidationErrorList=[],this.isEnableAttribute=[]}async componentWillLoad(){var i,t;const a=await(0,s.g)(this.el);null!==(i=l.c.api)&&void 0!==i||(l.c.api=this.api),null!==(t=l.c.config)&&void 0!==t||(l.c.config=this.config),this.i18n=a[0],this.retrieveClassificationSchema()}getClassificationType(i){return this.classificationCategoryArr.find((t=>t.value===i))}async executeAttributeValidations(){var i;this.validationErrors=[];const t=[];for(const a in this.classificationSchema.attributes){if(!(null===(i=this.classificationSchema.attributes[a])||void 0===i?void 0:i.attributeValidation))continue;const e=this.classificationSchema.attributes[a].attributeValidation,s=await(0,n.e)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue),a);s.length>0&&t.push(s)}this.validationErrors=t}generateCustomText(i,t){var a;const e=null===(a=this.classificationSchema.layouts.default)||void 0===a?void 0:a.layoutElements,s=Object.entries(e).sort((([,t],[,a])=>t[i]||0-a[i]||0)),n=[],l=[];s.forEach((([a,e])=>{var s,o,c,r;const d=this.defineClassificationVal();if((null==d?void 0:d[a])&&e[i]){const i=null!==(s=e.uiElement)&&void 0!==s?s:"",h=null!==(o=e[t])&&void 0!==o?o:"",u=null!==(c=e.labelDelimiter)&&void 0!==c?c:"",f=null!==(r=e.valueDelimiter)&&void 0!==r?r:"";n.push(this.generateSelectionTextPerElement(i,h,u,null==d?void 0:d[a],f)),l.push(e.layoutElementDelimiter)}}));return n.reduce(((i,t,a)=>`${i}${l[a]}${t}`))}generateSelectionTextPerElement(i,t,a,e,s){let n="";if(i.includes("multi")&&e)for(let i=0;i<e.length;i++)n+=e[i],i!==e.length-1&&(n+=s);else n=e;return t+a+n}retrieveClassificationType(i){var t;return null===(t=this.classificationSchema)||void 0===t?void 0:t.classificationMetadata.classificationValueProperties.find((t=>t.value===i.value))}convertClassificationType(i){return i?{value:i.value,label:i.value,textColor:i.textColor,backgroundColor:i.backgroundColor}:null}setClassificationType(i){this.classificationType=i}setItemClassificationValue(i){this.itemClassificationValue=i}handleAttributeElementsChange(){this.generateSelectionText(),this.generateBannerText(),this.checkIsAttrEnabled()}setAttributeCategory(i){this.attributeCategory=i}displayValidationError(){this.doesValidate||this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:this.i18n.itemClassificationValidateError})}closeClassificationEditModal(i){"cancel"===i&&(this.validationErrors=[],this.classificationType=this.orgClassificationType,this.itemClassificationValue=this.orgItemClassificationValue),this.setIsDisplayModal(!1)}async checkIsAttrEnabled(){var i;const t=Object.entries(null===(i=this.classificationSchema)||void 0===i?void 0:i.attributes),a=[];for(let i in t){const e=t[i][0],s=t[i][1],l=null==s?void 0:s.attributeCategory;try{const i=await(0,n.i)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue));a.push({attributeId:e,attributeCategory:l,isAttrEnabled:i}),this.isEnableAttribute=a}catch(i){console.error("error: ",i)}}}validateInputError(){var i,t,a;this.attributeValidationErrorList=[];const e=[],s=Object.entries(null===(i=this.classificationSchema)||void 0===i?void 0:i.attributes);for(let i in s){const n=s[i][0],l=s[i][1],o=!!(null==l?void 0:l.isRequired),c=!!(null===(t=this.itemClassificationValue)||void 0===t?void 0:t[n]),r=null===(a=this.isEnableAttribute)||void 0===a?void 0:a.find((i=>i.attributeId===n)),d=null==r?void 0:r.isAttrEnabled;this.attributeCategory===(null==r?void 0:r.attributeCategory)&&d&&o&&!c&&e.push({attributeId:n,hasValue:c})}return this.attributeValidationErrorList=e,0===e.length}saveEditInfo(){const i=l.c.user.username,t=Date.now();this.itemClassificationValue.lastEditedUser=i,this.itemClassificationValue.lastEditedDate=t;const{createdUser:a,createdDate:e}=this.itemClassificationValue;a||e||(this.itemClassificationValue.createdUser=i,this.itemClassificationValue.createdDate=t)}setIsCheckingError(i){this.isCheckingError=i}resetClassificationValue(){this.setClassificationType(this.convertClassificationType(this.retrieveClassificationType(Object.assign({},this.classificationSchema.classificationMetadata.classificationValueProperties[0])))),this.setItemClassificationValue({classification:this.classificationSchema.classificationMetadata.defaultValue})}renderHeader(){return(0,e.h)("h3",{slot:"header"},this.i18n.itemClassificationEditLabel,(0,e.h)("calcite-icon",{class:"classification-info-tip",scale:"s",icon:"information"}))}renderContent(){return(0,e.h)("div",{slot:"content",class:"portal-item-classification-content"},(0,e.h)("item-classification-info",{i18n:this.i18n,itemClassificationValue:this.itemClassificationValue,classificationSchema:this.classificationSchema,currSelectionText:this.currSelectionText}),(0,e.h)("item-classification-category",{i18n:this.i18n,classificationCategoryArr:this.classificationCategoryArr,classificationType:this.classificationType,setClassificationType:this.setClassificationType.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this)}),!!this.classificationSchema&&!!this.itemClassificationValue&&(0,e.h)("item-classification-content",{i18n:this.i18n,itemClassificationValue:this.defineClassificationVal(),classificationSchema:this.classificationSchema,attributeCategory:this.attributeCategory,setAttributeCategory:this.setAttributeCategory.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this),setIsCheckingError:this.setIsCheckingError.bind(this),onArcgisItemClassificationContentDisplayNotification:i=>this.handleDisplayNotificationModal(i.detail),isSaving:this.isSaving,isCheckingError:this.isCheckingError,attributeValidationErrorList:this.attributeValidationErrorList}))}renderContentBottom(){return(0,e.h)("div",{slot:"content-bottom"},(0,e.h)("div",{class:"itemClassificationError"},this.validationErrors.map(((i,t)=>(0,e.h)("span",{key:t},i)))))}renderFooter(){var i;const{i18n:t}=this;return(0,e.h)(e.F,null,(0,e.h)("calcite-button",{"aria-label":t.reset,scale:"l",slot:"back",width:"full",appearance:"outline",disabled:this.isSaving,onClick:()=>this.resetClassificationValue()},this.isResetting?(0,e.h)("div",{class:"resetIndicator"},(0,e.h)("calcite-loader",{label:"resettingClassification",scale:"m",inline:!0}),(0,e.h)("span",{class:"resetIndicator"},t.resetting)):(0,e.h)("div",null,t.reset)),(0,e.h)("calcite-button",{"aria-label":t.save,scale:"l",slot:"primary",width:"full",disabled:(null===(i=this.validationErrors)||void 0===i?void 0:i.length)>0,onClick:()=>this.saveItemClassificationValue()},this.isSaving?(0,e.h)("div",{class:"saveIndicator"},(0,e.h)("calcite-loader",{label:"savingClassification",scale:"m",inline:!0}),(0,e.h)("span",{class:"savingIndicator"},t.saving)):(0,e.h)("div",null,t.save)),(0,e.h)("calcite-button",{"aria-label":t.cancel,scale:"l",slot:"secondary",width:"full",appearance:"outline",onClick:()=>this.closeClassificationEditModal("cancel"),disabled:this.isSaving},(0,e.h)("div",null,t.cancel)))}renderModal(){var i;return(0,e.h)(e.F,null,this.renderHeader(),this.renderContent(),!!(null===(i=this.validationErrors)||void 0===i?void 0:i.length)&&this.renderContentBottom(),this.renderFooter())}render(){return(0,e.h)(e.F,{key:"002f95e802f6d9bb2794244acb8e438e84826b5c"},(0,e.h)("calcite-modal",{key:"d5fe01fe0d315cc357c94d9a50dbd57f021b96c9",class:"portal-item-classification-viewer",open:this.isDisplayModal,scale:"m",widthScale:"m",outsideCloseDisabled:!0,onCalciteModalClose:()=>this.closeClassificationEditModal("cancel")},this.renderModal()),this.isNotificationModalActive&&(0,e.h)("item-classification-notification",{key:"a2c7649cccbf69b43c6f16ed6f3c0a27a3c196e9",i18n:this.i18n,alertIndicator:this.alertIndicator,onArcgisItemClassificationNotificationClose:()=>{this.handleCloseNotificationModal()}}))}get el(){return(0,e.d)(this)}static get watchers(){return{itemClassificationValue:["handleAttributeElementsChange"],doesValidate:["displayValidationError"]}}};c.style=".portal-item-classification-viewer{--calcite-modal-content-padding:0}.saveIndicator{display:inline-flex;width:100%;align-items:center;justify-content:center}.savingIndicator{margin:0 10px}.classification-info-tip{margin-left:3px;cursor:pointer}.itemClassificationError{color:var(--calcite-color-foreground-1);background-color:var(--calcite-color-status-danger)}.portal-item-classification-content{margin:1rem}"},25887:(i,t,a)=>{a.d(t,{a:()=>l,b:()=>d,e:()=>h,i:()=>r,r:()=>o,s:()=>c});var e=a(31670),s=a(28926),n=a(46581);async function l(i){var t;const a={};try{const e=await(0,n.r)(i);a.result=null===(t=e.item)||void 0===t?void 0:t.classification}catch(i){console.error(i),a.error=i}return a}async function o(i){const t={};try{const a=await(0,n.r)(i);t.result=a}catch(i){console.error(i),t.error=i}return t}function c(i,t){const a={classification:JSON.stringify(t)};return(0,n.r)(i,a,{},"post")}async function r(i,t,a){var e;const s=null===(e=null==t?void 0:t.attributes)||void 0===e?void 0:e[i],n=null==s?void 0:s.isAttributeEnabled;if(!s)return!1;if(!n)return!0;const l={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await u(n)).execute(l)}async function d(i,t,a){var e,s;const n=null===(e=null==t?void 0:t.attributes)||void 0===e?void 0:e[i],l=null==n?void 0:n.valueExpression,o=null==n?void 0:n.validValues,c=null==n?void 0:n.validValuesMap;if(!n)return null;if(null==o?void 0:o.length)return o;if(c&&(null===(s=Object.keys(c))||void 0===s?void 0:s.length))return c;if(!l)return null;const r={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await u(l)).execute(r)}async function h(i,t,a,e=""){const s={schemaJsonString:t,valueJsonString:a,attributeId:e};return(await u(i)).execute(s)}async function u(i){const[t]=await(0,s.l)([3===(null===e.c||void 0===e.c?void 0:e.c.api)?"webpack-bundles/arcade":"esri/arcade"]);return t.createArcadeExecutor(i,{variables:[{name:"schemaJsonString",type:"text"},{name:"valueJsonString",type:"text"},{name:"attributeId",type:"text"}]})}}}]);