/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_functi-4abc46.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_functi-4abc46"],{11246:(e,t,n)=>{n.d(t,{a:()=>c,b:()=>m,c:()=>a,d:()=>r,e:()=>i,f:()=>u,g:()=>p,i:()=>l,m:()=>s,t:()=>o,u:()=>d});const r=(e,t)=>{let n,r="idle";const a=(...a)=>new Promise((i=>{switch(r){case"flushed":r="idle",n?(clearTimeout(n),i(e(...a))):i(null);break;case"invoked":clearTimeout(n),r="idle",i(e(...a));break;case"cancelled":clearTimeout(n),r="idle",i(null);break;default:n&&clearTimeout(n),r="pending",n=setTimeout((()=>(r="idle",i(e(...a)))),t)}}));return a.flush=function(...e){return r="flushed",a(...e)},a.invoke=function(...e){return r="invoked",a(...e)},a.cancel=function(...e){return r="cancelled",a(...e)},a.getStatus=function(){return r},a},a=(e,t)=>{let n;return(...r)=>new Promise((a=>{n||(n=setTimeout((()=>{clearTimeout(n),n=void 0,a(e(...r))}),t))}))};function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l(e){return null!=e}async function s(e,t){return await Promise.all([e,o(t)]),e}function o(e){return new Promise((t=>setTimeout(t,e)))}const c=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:n,data:r}=t(e);return[n,r]}))),u=(e,t)=>e.length===t.length&&e.reduce(((e,n)=>e&&t.indexOf(n)>-1),!0);function d(e,t){const n=[],r={};return e.forEach((e=>{const a=t(e);null==r[a]&&(r[a]=e,n.push(e))})),n}function m(e){const t={boolean:{},number:{},string:{}},n=[];return e.filter((e=>{let r=typeof e;return r in t?!t[r].hasOwnProperty(e)&&(t[r][e]=!0):!(n.indexOf(e)>=0)&&n.push(e)}))}const p=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((n,r)=>e.slice(t*r,t+t*r)))},11935:(e,t,n)=>{n.d(t,{c:()=>o});var r=n(7263);const a=e=>!("isConnected"in e)||e.isConnected,i=((e,t)=>{let n;return(...r)=>{n&&clearTimeout(n),n=setTimeout((()=>{n=0,e(...r)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(a))}),2e3),l=e=>"function"==typeof e?e():e,s=(e,t)=>{const n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],e.length--)},o=(e,t)=>{const n=((e,t=((e,t)=>e!==t))=>{const n=l(e);let r=new Map(Object.entries(null!=n?n:{}));const a={dispose:[],get:[],set:[],reset:[]},i=()=>{var t;r=new Map(Object.entries(null!==(t=l(e))&&void 0!==t?t:{})),a.reset.forEach((e=>e()))},o=e=>(a.get.forEach((t=>t(e))),r.get(e)),c=(e,n)=>{const i=r.get(e);t(n,i,e)&&(r.set(e,n),a.set.forEach((t=>t(e,n,i))))},u="undefined"==typeof Proxy?{}:new Proxy(n,{get:(e,t)=>o(t),ownKeys:e=>Array.from(r.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>r.has(t),set:(e,t,n)=>(c(t,n),!0)}),d=(e,t)=>(a[e].push(t),()=>{s(a[e],t)});return{state:u,get:o,set:c,on:d,onChange:(t,n)=>{const r=d("set",((e,r)=>{e===t&&n(r)})),a=d("reset",(()=>n(l(e)[t])));return()=>{r(),a()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(d("set",t.set)),t.get&&e.push(d("get",t.get)),t.reset&&e.push(d("reset",t.reset)),t.dispose&&e.push(d("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{a.dispose.forEach((e=>e())),i()},reset:i,forceUpdate:e=>{const t=r.get(e);a.set.forEach((n=>n(e,t,t)))}}})(e,t);return n.use((()=>{if("function"!=typeof r.g)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const n=(0,r.g)();n&&((e,t,n)=>{const r=e.get(t);r?r.includes(n)||r.push(n):e.set(t,[n])})(e,t,n)},set:t=>{const n=e.get(t);n&&e.set(t,n.filter(r.f)),i(e)},reset:()=>{e.forEach((e=>e.forEach(r.f))),i(e)}}})()),n}},756:(e,t,n)=>{n.d(t,{a:()=>E,b:()=>b,c:()=>s,d:()=>h,e:()=>g,f:()=>l,g:()=>d,h:()=>f,i:()=>$,p:()=>C,v:()=>y});var r=n(11935),a=n(78613),i=n(7263);const l=(0,r.c)({totalFeatureCount:null,layer:null,mapView:null,originalField:null,numRecords:null,modules:null,strings:null,calculatedValues:null,errors:null,arcadeExecutor:null,filteredFeatureCount:null,currentScript:null,registeredResultId:null,arcadeSupported:null,invalidScript:null,isTable:null,testFeatures:null}).state;function s(e){e.totalFeatureCount=void 0,e.mapView=void 0,e.numRecords=void 0,e.layer=void 0,e.originalField=void 0,e.calculatedValues=void 0,e.errors=void 0,e.arcadeExecutor=void 0,e.filteredFeatureCount=void 0,e.currentScript=void 0,e.registeredResultId=void 0,e.arcadeSupported=void 0,e.invalidScript=void 0,e.isTable=void 0,e.testFeatures=void 0}async function o(e){const{layer:t,modules:n}=l;if(!("queryFeatures"in t))return Promise.resolve(u(t,n));try{const r=await c(e);return r?Promise.resolve(r):Promise.resolve(u(t,n))}catch(e){}}async function c(e){var t,n;const{layer:r,modules:a}=l,i=new a.Query({outFields:["*"],where:e||"1=1",outSpatialReference:r.spatialReference,returnGeometry:!0,returnM:"hasM"in r&&r.hasM,returnZ:"hasZ"in r&&r.hasZ});return(null===(n=null===(t=r.sourceJSON)||void 0===t?void 0:t.advancedQueryCapabilities)||void 0===n?void 0:n.supportsPagination)&&(i.num=1),await r.queryFeatures(i)}function u(e,t){const n={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?n[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?n[e.name]=0:"date-only"===e.type?n[e.name]=null:n[e.name]=""}));const r=new t.Graphic({geometry:void 0,symbol:void 0,attributes:n});return new t.FeatureSet({features:[r],fields:[],geometryType:e.geometryType,spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}async function d(e="1=1"){const{layer:t,modules:n}=l,r=new n.Query({where:e});return await t.queryFeatureCount(r)}const m={double:{min:-Infinity,max:Infinity},integer:{min:-2147483648,max:2147483647},single:{min:-3402823e32,max:3402823e32},"small-integer":{min:-32768,max:32767},"big-integer":{min:-9007199254740991,max:9007199254740991}};function p(e,t,n){return n>=e&&n<=t}function f(e){const{arcadeExecutor:t,calculatedValues:n,layer:r,errors:i,strings:s}=l,o=e.attributes[r.objectIdField];try{let l=t.execute({$feature:e,$datastore:r.url},{spatialReference:r.spatialReference,rawOutput:!0});const s=y(l);return/<\/?[a-z][\s\S]*>/i.test(l)&&(l=(0,a.s)(l)),n[o]=l,s.isFieldValid?i[o]=null:i[o]=s.errorMessage,l}catch(e){n[o]=null,i[o]=s.calculationErrorGeneral,console.error(e)}}async function g(e){const{arcadeExecutor:t,calculatedValues:n,layer:r,errors:i,strings:s}=l,o=e.attributes[r.objectIdField];try{let l=await t.executeAsync({$feature:e,$datastore:r.url},{spatialReference:r.spatialReference,rawOutput:!0});const s=y(l);return/<\/?[a-z][\s\S]*>/i.test(l)&&(l=(0,a.s)(l)),n[o]=l,s.isFieldValid?i[o]=null:i[o]=s.errorMessage,l}catch(e){console.error(e),n[o]=null,i[o]=s.calculationErrorGeneral,console.error(e)}}function y(e){const{strings:t,originalField:n}=l;if(null===e&&!isNaN(e))return n.nullable?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:t.nullNotAllowed};if(function(e){if(null===e)return!1;if(e instanceof Date||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass))return!1;return"function"==typeof e||"object"==typeof e}(e))return{isFieldValid:!1,errorMessage:t.cannotInsertObject.replace("${fieldType}",`${n.type||t.commonUndefined}`)};switch(n.type){case"string":return function(e){const{originalField:t,strings:n}=l;return(F(e)||w(e))&&e.toString().length<=t.length||"string"==typeof e&&e.length<=t.length?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:n.stringLengthError.replace("${maxStringLength}",`${t.length}`)}}(e);case"double":case"integer":case"single":case"small-integer":case"big-integer":return function(e){const{originalField:t,strings:n}=l,r=m[t.type];return w(e)?p(r.min,r.max,e)?function(e){var t;const{originalField:n}=l;return"range"!==(null===(t=n.domain)||void 0===t?void 0:t.type)||p(n.domain.minValue,n.domain.maxValue,e)}(e)?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:n.domainOutOfRange.replace("${min}",`${t.domain.minValue}`).replace("${max}",`${t.domain.maxValue}`)}:{isFieldValid:!1,errorMessage:n.outOfRange.replace("${fieldType}",t.type).replace("${min}",`${r.min}`).replace("${max}",`${r.max}`)}:{isFieldValid:!1,errorMessage:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}(e);case"date":case"timestamp-offset":return F(e);case"date-only":case"time-only":return function(e){const{originalField:t,strings:n}=l;let r=!1;"date-only"===t.type?r="esri.core.sql.dateonly"===e.declaredRootClass?e.isValid:/[1-9][0-9][0-9]{2}-([0][1-9]|[1][0-2])-([1-2][0-9]|[0][1-9]|[3][0-1])/gm.test(e):"time-only"===t.type&&(r="esri.core.sql.timeonly"===e.declaredRootClass||/^(([0-1][0-9])|([2][0-3])):([0-5][0-9])(:[0-5][0-9](?:[.]\d{1,3})?)?$/gm.test(e));return{isFieldValid:r,errorMessage:r?null:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}(e);default:return{isFieldValid:!1,errorMessage:t.unexpectedValue}}}function h(){const{layer:e}=l;return{id:"field-calculation",definitions:{$feature:e,$datastore:e}}}async function b(e){const{layer:t}=l;return{profileVariableInstances:{$feature:await v(e),$layer:t,$datastore:t.url},spatialReference:t.spatialReference}}async function v(e){var t;const{layer:n}=l;let r=null;if("fields"in n){const n=await async function(e){const{isTable:t,layer:n,mapView:r}=l;if(!("fields"in n))return Promise.reject("getOneFeature: wrong layer type");if(t)return o(e);{const t=await r.whenLayerView(n),a="hasM"in n&&n.hasM,i="hasZ"in n&&n.hasZ,l=t.availableFields.length===n.fields.length&&!a&&!i;if("createQuery"in n&&l){const r=n.createQuery();r.start=0,r.num=5,r.outFields=["*"],r.returnGeometry=!0,r.outSpatialReference=n.spatialReference;const a=await t.queryFeatures(r);return a.features&&a.features.length?Promise.resolve(a):await o(e)}return await o(e)}}(e);(null===(t=null==n?void 0:n.features)||void 0===t?void 0:t.length)&&(r=n.features[0].clone())}return r}function F(e){const{originalField:t,strings:n}=l;return"esri.arcade.arcadedate"===e.declaredRootClass?{isFieldValid:e.isValid}:{isFieldValid:!1,errorMessage:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}function w(e){const{originalField:t}=l;return(!["integer","small-integer"].includes(t.type)||e===parseInt(e,10))&&("number"==typeof e&&!isNaN(e)&&e!==1/0&&e!==-1/0)}function E(e){const{originalField:t}=l;return null===e?t.nullable:void 0!==e}function T(e,t){const{modules:n}=l;return null!=e?V(e,t,Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):null}function $(e,t=l.originalField){if(null===e)return e;const{domain:n}=t,r=["date-only","time-only","timestamp-offset"];if(t.domain){const a=function(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const n=t.codedValues.filter((t=>t.hasOwnProperty("code")&&t.code===e));return n&&n.length?n[0].name:e}return null}(e,t.domain);return"date"===t.type&&"range"===n.type?T(a,t):x(t)&&"range"===n.type?O(e,t):r.includes(t.type)&&"range"===n.type?V(a,t):a}return"date"===t.type||r.includes(t.type)?T(e,t):x(t)?O(e,t):e}function V(e,t,n){const{modules:r}=l;switch(t.type){case"date":return"esri.arcade.arcadedate"===e.declaredRootClass?r.intl.formatDate(e.toJSDate(),Object.assign(Object.assign({},r.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):r.intl.formatDate(e,n);case"date-only":return"esri.core.sql.dateonly"===e.declaredRootClass?r.intl.formatDateOnly(e.toStorageFormat(),n):r.intl.formatDateOnly(e,n);case"time-only":return"esri.core.sql.timeonly"===e.declaredRootClass?r.intl.formatTimeOnly(e.toStorageString(),n):r.intl.formatTimeOnly(e,n);case"timestamp-offset":return"esri.arcade.arcadedate"===e.declaredRootClass?r.intl.formatTimestamp(e.toISOString(),Object.assign(Object.assign({},r.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):r.intl.formatTimestamp(e,n);default:return null}}function O(e,t){const{modules:n}=l;return["single","double","long"].includes(t.type)?n.intl.formatNumber(parseFloat(e),n.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:2})):["integer","small-integer","big-integer"].includes(t.type)?n.intl.formatNumber(parseFloat(e),n.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:0})):void 0}function x(e){return["integer","small-integer","big-integer","single","double"].includes(e.type)}async function C(e){const{arcadeExecutor:t,calculatedValues:n,invalidScript:r,errors:a,layer:s,testFeatures:o}=l,u=(e.attributes||e.graphic.attributes)[s.objectIdField];if(!o[u]){const e=await c(`${s.objectIdField} = ${u}`);o[u]=e.features[0]}return!t||E(n[u])||a[u]||(t.isAsync?await g(o[u]):await f(o[u])),r?function(){const{strings:e}=l,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.a)("././assets/arcgis-field-calculate-icons/alert-48.svg")}></img>\n  <calcite-label>${e.popupError}</calcite-label>`,t}():E(n[u])||a[u]?function(e){const{arcadeExecutor:t,calculatedValues:n,errors:r,layer:a,originalField:i,strings:s}=l,o={};for(const t in e)o[t.toLowerCase()]=e[t];const c=document.createElement("div"),u=e[a.objectIdField];if(r[u]){const e=document.createElement("calcite-label");e.layout="inline";const t=document.createElement("calcite-icon");t.classList.add("popup-error-icon"),t.icon="exclamation-mark-triangle",e.append(t),e.append(r[u]),c.append(e)}const d=E(n[u])&&!r[u]?$(n[u]):n[u],m=document.createElement("calcite-table");m.caption=d;const p=document.createElement("calcite-table-row"),f=document.createElement("calcite-table-header");f.heading=i.alias,p.appendChild(f),m.appendChild(p);const g=document.createElement("calcite-table-row"),y=document.createElement("calcite-table-cell");y.innerHTML=d,g.appendChild(y),m.appendChild(g),c.appendChild(m),c.appendChild(document.createElement("br"));let h=[];if(null==t||t.fieldsUsed.forEach((e=>{const t=document.createElement("calcite-table-row"),n=document.createElement("calcite-table-cell");n.innerHTML=e;const r=document.createElement("calcite-table-cell");r.innerHTML=$(o[e],a.fields.find((t=>t.name.toLowerCase()===e))),t.append(n,r),h.push(t)})),h.length){const e=document.createElement("calcite-label");e.innerHTML=s.fieldsInCalculation;const t=document.createElement("calcite-table");t.bordered=!0,t.append(...h),e.append(t),c.append(e)}return c}(o[u].attributes):function(){const{strings:e}=l,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.a)("././assets/arcgis-field-calculate-icons/edit-48.svg")}></img>\n  <calcite-label>${e.popupPreview}</calcite-label>`,t}()}}}]);