/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-f48dbe.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-f48dbe"],{59296:(e,r,t)=>{t.d(r,{a:()=>n,b:()=>y,c:()=>p,d:()=>d,e:()=>m,f:()=>h,g:()=>v,h:()=>D,i:()=>u,j:()=>s,k:()=>f,l:()=>U,m:()=>b,n:()=>I,o:()=>L,p:()=>S,q:()=>w,r:()=>T,s:()=>P,t:()=>c,u:()=>E,v:()=>l,w:()=>o});var a=t(2174);const i=e=>{var r,t,a;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(t=null!==(r=null==e?void 0:e.roleId)&&void 0!==r?r:null==e?void 0:e.id)&&void 0!==t?t:null===(a=null==e?void 0:e.sourceJSON)||void 0===a?void 0:a.id};function n(e){return e&&!e.orgId}function l(e,r){return(0,a.u)(e,r)||"update"===e.itemControl||(0,a.c)([e],r)&&p(r)}function o(e,r){const t=(0,a.c)([e],r),i=(0,a.u)(e,r)||p(r)&&t,n=m(r)&&g(r);return!!(i||t&&n)}const s=e=>{var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:manageLicenses"))};function u(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function c(e){return["Developer Subscription"].includes(null==e?void 0:e.type)}const d=e=>{var r;return null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.includes("Developer")};function p(e){return"org_admin"===i(e)||"account_admin"===i(e)}function y(e){return["org_admin","account_admin"].includes(i(e))&&!(null==e?void 0:e.roleId)}function m(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function v(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:updateItemCategorySchema"))}function h(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:updateGroups"))}function f(e){var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:assignToGroups"))}const g=e=>{var r;return!!(null===(r=null==e?void 0:e.privileges)||void 0===r?void 0:r.includes("portal:admin:deleteItems"))};function b(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function I(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function w(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function S(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function T(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function L(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function D(e,r,t,a){const i=a&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(a.type),n=((null==r?void 0:r.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!r||!p(r)&&!n||!(null==t?void 0:t.isPortal)&&!i)}function E(e){return!!e&&(!m(e)||m(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const P=({items:e,user:r,portal:t})=>{const i=e[0],n=i.owner;if(t.isPortal&&n!==r.username&&n.includes("esri_")&&!["esri_livingatlas"].includes(n))return!1;const o=(0,a.u)(i,r),s=m(r),u=G(r),c=l(i,r)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(r)&&!s&&(function(e,r){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(r)||b(e)||I(e)||!!r.canSharePublic&&w(e)}(r,t)||G(r));return o||c||(0,a.c)(e,r)&&u};function G(e){return L(e)||S(e)||T(e)}function U(e){const r=["portal:user:createItem","portal:user:viewOrgItems","premium:publisher:createNotebooks","portal:publisher:createDataPipelines","features:user:edit","features:user:fullEdit","portal:admin:viewItems","portal:admin:updateItems","portal:admin:deleteItems"];return e.some((e=>r.includes(e)))}},96008:(e,r,t)=>{t.d(r,{a:()=>M,b:()=>h,c:()=>f,d:()=>V,e:()=>m,s:()=>$,u:()=>v});var a=t(50852),i=t(46581),n=t(2174),l=t(94788),o=t(31141),s=t(11246),u=t(59296),c=t(49038),d=t(49412),p=t(17300),y=t(68616);const m=async(e,r,t,s,u=!1)=>{const{portal:c,user:d}=s,p=`${(0,l.g)(c)}content/users/${d.username}/shareItems`;let y=[];const m=r?function(e){switch(e){case"public":return{org:!1,everyone:!0};case"org":return{org:!0,everyone:!1};case"private":case"shared":return{org:!1,everyone:!1};default:return{}}}(r):{};if(e.every((e=>(0,n.i)(e,d))))try{y=(await(0,o.r)(p,c,{body:Object.assign({items:e.map((e=>e.id)).join(","),groups:(null==t?void 0:t.length)?t.join(","):void 0,confirmItemControl:!0},m),usePost:!0})).results}catch(e){return console.error(e),{error:{code:"unhandledError"}}}else y=(await Promise.all(e.map((({id:e})=>async function(e,r,t,n,l=!1){try{const s=`${(0,a.g)(e,n)}/share`,u=Object.assign({groups:(null==t?void 0:t.length)?t.join(","):null,confirmItemControl:!0},r);let c;return c=l?await(0,o.r)(s,n,{body:u,usePost:!0}):await(0,i.r)(s,u,{},"post"),{result:c}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}(e,m,t,c,u))))).map((e=>e.result));return{result:y}},v=async(e,r,t)=>{const{portal:a,user:i}=t,n=`${(0,l.g)(a)}content/users/${i.username}/unshareItems`;try{return{result:(await(0,o.r)(n,a,{body:{items:e.join(","),groups:(null==r?void 0:r.length)?r.join(","):null},usePost:!0})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};function h(e){const{typeKeywords:r,type:t,url:a}=e,i=r&&g.some((e=>r.includes(e))),n="Image Service"===t&&(null==a?void 0:a.includes("://iservices"))&&a.includes("arcgis.com"),l="Geoprocessing Service"===t&&(null==r?void 0:r.includes("Notebook Web Tool")),o=b.includes(t);return i||n||o||l}function f(e){var r;const t=null===(r=e.typeKeywords)||void 0===r?void 0:r.includes("Hosted Service");return["Vector Tile Service","Map Service","Scene Service","Feature Service"].includes(e.type)&&t}const g=["Location Tracking Service","Location Tracking View","IoTFeed","IoTFeatureLayer","IoTMapImageLayer","IoTStreamLayer","Administrative Report","EditExtensionIndoorsSpaces","ArcgisWorkflowJobLocation"],b=["Knowledge Graph","Pro Project","Data Store","Workflow"],I=async(e,r)=>{const t=e.id;let a,i={items:[],layers:[]};switch(e.type){case"Group Layer":({result:i,error:a}=await w(t,r));break;case"Web Map":case"Web Scene":({result:i,error:a}=await S(t,r));break;case"Web Mapping Application":({result:i,error:a}=await T(t,r));break;case"Web Experience":case"Web Experience Template":({result:i,error:a}=await D(t,e.typeKeywords,r));break;case"Big Data File Share":({result:i,error:a}=await E(e,r));break;case"Data Store":({result:i,error:a}=await P(e,r))}return{result:i,error:a}},w=async(e,r)=>{try{const t=await(0,p.g)(e,r);return{result:{items:[],layers:[Object.assign({},t)]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},S=async(e,r)=>{var t,a;try{const i=await(0,p.g)(e,r),{operationalLayers:n,baseMap:l,tables:o,ground:s}=i;return{result:{items:[],layers:[...null!=n?n:[],...null!==(t=null==l?void 0:l.baseMapLayers)&&void 0!==t?t:[],...null!==(a=null==s?void 0:s.layers)&&void 0!==a?a:[],...null!=o?o:[]]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},T=async(e,r)=>{var t;try{const t=await(0,p.g)(e,r);if(!t)return{result:{items:[],layers:[]}};const a=L(t),i=(await Promise.all(a.map((e=>(0,p.a)(e,r))))).map((({result:e})=>e)).filter((e=>e)),n=await Promise.all(i.map((e=>I(e,r)))),{items:l,layers:o}=G(n.map((({result:e})=>e)).flat().filter((e=>e)));return{result:{items:[...i,...l],layers:o}}}catch(e){return(0,d.i)(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")?{result:{items:[],layers:[]}}:(console.error(e),{error:{code:"unhandledError"}})}},L=e=>{var r,t,a,i,n,l,o,s,u,c;return[...(null===(r=null==e?void 0:e.map)||void 0===r?void 0:r.itemId)?[e.map.itemId]:[],...null!==(i=null===(a=null===(t=e.values)||void 0===t?void 0:t.itemCollection)||void 0===a?void 0:a.map((e=>e.id)))&&void 0!==i?i:[],...null!==(o=null===(l=null===(n=e.values)||void 0===n?void 0:n.webmap)||void 0===l?void 0:l.split(","))&&void 0!==o?o:[],...null!==(c=null===(u=null===(s=e.values)||void 0===s?void 0:s.webscene)||void 0===u?void 0:u.split(","))&&void 0!==c?c:[]]},D=async(e,r,t)=>{const i=`${(0,a.g)(e,t)}/resources/config/config.json`,n=(0,p.b)(e,t),l=[];r.includes("status: Draft")?l.push(i):r.includes("status: Changed")?l.push(i,n):l.push(n);try{const e=[],r=[],a=[];return await Promise.all(l.map((async i=>{const n=await(0,o.r)(i,t);if(!(null==n?void 0:n.dataSources)&&!(null==n?void 0:n.utilities))return;const l=(await Promise.all(function(e){const r=e.dataSources||{},t=e.utilities||{};return[...Object.values(r),...Object.values(t)].map((e=>e.itemId)).filter((e=>e))}(n).map((e=>(0,p.a)(e,t))))).map((({result:e})=>e)).filter((e=>e)),s=await Promise.all(l.map((e=>I(e,t)))),{items:u,layers:c}=G(s.flatMap((({result:e})=>e)).filter((e=>e)));a.push(...c),e.push(...u),r.push(...l)}))),{result:{items:[...r,...e],layers:a}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const E=async(e,r)=>{try{const{relatedItems:t}=await(0,c.g)(e.id,r,{relationshipType:"BDFSDataStore2BDFSCatalogService",direction:"reverse"}),a=t[0].typeKeywords;if(a.includes("bigDataFileShare")&&a.includes("dataStore")){const{result:e}=await P(t[0],r),{items:a}=e,i=await(0,p.c)(t[0].id,r);return{result:{items:[...a,i],layers:[]}}}return{result:{items:await Promise.all(t.map((e=>(0,p.c)(e.id,r)))),layers:[]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},P=async(e,r)=>{try{const{relatedItems:t}=await(0,c.g)(e.id,r,{relationshipType:"CloudDataStore2BDFSDataStore",direction:"reverse"});return{result:{items:await Promise.all(t.map((e=>(0,p.c)(e.id,r)))),layers:[]}}}catch(e){return console.error("error:",e),{error:{code:"unhandledError"}}}},G=e=>({items:e.flatMap((e=>e.items)),layers:e.flatMap((e=>e.layers))});async function U(e,r,t=!1){try{const{result:a}=await(0,p.d)(e,r);return{result:[...a.admin,...a.member,...a.other].filter((e=>t||!e.isFav)).map((e=>e.id))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const k=e=>!("layerType"in e)&&e.url&&e.popupInfo,j={needsGroupUpdate:!1,needsShareLevelUpdate:!1,canEditShareLevel:!0,premium:!1,bdfsDatastore:!1},A=async(e,r)=>{var t;const a=e.filter((e=>{return!!(null==e?void 0:e.url)&&(r={layerType:e.layerType},["table","ArcGISFeatureLayer","ArcGISTiledMapServiceLayer","VectorTileLayer","GroupLayer","ArcGISImageServiceLayer","ArcGISTiledImageServiceLayer","SubtypeGroupLayer","ArcGISStreamLayer"].includes(r.layerType));var r})),i=await O(a.map((e=>e.url)),r),{result:n}=await(0,c.a)(i,r);return null!==(t=n.map((e=>e.item)))&&void 0!==t?t:[]},O=async(e,r)=>{const t=e.filter((e=>!!e&&!!(0,l.p)(e))),a=e.filter((e=>!e||!(0,l.p)(e)));return[...await(0,c.f)(r,t),...a]},C=async(e,r)=>{const t=[],a=e=>{if(k(e))t.push({id:e.id,url:e.url,layerType:"table",getType:"normal"});else{if("GroupLayer"===e.layerType)return e.itemId&&t.push({id:e.id,itemId:e.itemId,layerType:"GroupLayer",getType:"normal"}),void e.layers.forEach((e=>{if(k(e)||"GroupLayer"===e.layerType)return void a(e);const r=e.url;if(!r)return void a(e);const t=(0,l.p)(r);a(Object.assign(Object.assign({},e),{url:null!=(null==t?void 0:t.index)?t.baseServerUrl:e.url}))}));if((e=>"VectorTileLayer"===e.layerType&&"styleUrl"in e)(e))t.push({id:e.id,url:e.styleUrl,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if((e=>"ArcGISTiledMapServiceLayer"===e.layerType)(e)){const r=(e=>"ArcGISTiledMapServiceLayer"===e.layerType&&"layers"in e&&!1===e.layers[0].disablePopup)(e);if(r){const r=e.layers[0];t.push({id:r.id,url:r.layerUrl,getType:"normal",layerType:e.layerType,itemId:r.layerItemId})}t.push({id:e.id,getType:r?"normal":"tile-layer-with-no-popup",itemId:e.itemId,layerType:e.layerType,url:e.url})}else(e.itemId||e.url)&&t.push({id:e.id,url:e.url,itemId:e.itemId,layerType:e.layerType,getType:"normal"})}};e.forEach(a);const n=(0,s.a)(t,(e=>e.itemId?{key:e.itemId,data:{searchType:"item-id",layerType:e.layerType}}:{key:e.url,data:{searchType:"url",layerType:e.layerType}})),o=Object.keys(n).filter((e=>"item-id"===n[e].searchType));try{const e=(await Promise.all(o.map((e=>(0,p.c)(e,r))))).filter((e=>!!e)),a=t.filter((({getType:e,itemId:r})=>"tile-layer-with-no-popup"===e&&!!r)),l=(await Promise.all(a.map((e=>(async(e,r)=>{try{const t=e.itemId,a=await(0,i.f)((()=>(0,p.g)(t,r)),"itemData",t),{layerItemId:n}=null==a?void 0:a.layers[0];return n?{result:await(0,p.c)(n,r)}:{error:{code:"unhandledError"}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,r))))).map((({result:e})=>e)),u=e.filter((e=>!(0,y.i)(e.typeKeywords,e.type))),c=await A(u.map((e=>{const{url:r,id:t}=e,a=n[t];return a?{layerType:a.layerType,url:r}:null})),r),d=(0,s.a)(c,(e=>({key:e.url,data:e}))),m=Object.keys(n).map((e=>{const r=n[e];return r&&"url"===r.searchType?{layerType:r.layerType,url:e}:null})).filter((e=>e)),v=await A(m,r),h=[];return e.filter((e=>e)).forEach((e=>{const r=e.url;h.push({sourceItem:e});const t=d[r];t&&e.id!==t.id&&h.push({sourceItem:t})})),[...l,...v].forEach((e=>{e&&h.push({layer:null,sourceItem:e})})),{result:h}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},_={private:0,shared:1,org:2,public:3},M=async(e,r,t,a={clearDataCacheOnDone:!0})=>{if("private"===e.access)return{result:{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:[]}};const{result:n,error:l}=await F(e,r,t);if(l)return{error:l};const o={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:K(e)?[{sourceItem:e,detail:{bdfsDatastore:!1,canEditShareLevel:!0,needsGroupUpdate:!1,needsShareLevelUpdate:!1,premium:!1}}]:[]};return await Promise.all(null==n?void 0:n.map((async t=>{const a=await N({mainItem:e,sharingDetailResult:t,portal:r});a&&o[a].push(t)}))),a.clearDataCacheOnDone&&V.forEach((e=>(0,i.c)(e))),{result:o}},F=async(e,r,t)=>{let a,i=[],l=[...t||[]];if(!(null==l?void 0:l.length)){const{error:t,result:n}=await I(e,r);a=t,l=n.layers,i=n.items}if(a)return{error:a};if(l.length<=0&&i.length<=0)return{error:{code:"dataNotAvailable"}};try{if("Big Data File Share"!==e.type&&"Data Store"!==e.type){const{result:e,error:t}=await C(l,r);if(t)return{error:t};i.push(...e.map((({sourceItem:e})=>e)))}const{result:t,error:a}=await U(e.id,r);if(a)return{error:a};const o=(0,s.u)(i,(e=>e.id)),u=await Promise.all(o.map((async a=>{const i=await async function({mainItemAccess:e,mainItemSharingGroups:r,portal:t,sourceItem:a}){const{access:i,itemControl:l}=a,o=Object.assign({},j),s="public"===e;if(h(a)&&s)return Object.assign(Object.assign({},o),{needsShareLevelUpdate:!0,canEditShareLevel:!1});"public"!==i?(o.canEditShareLevel=B(l),o.needsGroupUpdate=await x({sourceItem:a,isMainItemSharingToPublic:s,mainItemSharingGroups:r,portal:t}),o.needsShareLevelUpdate=W({mainItemAccess:e,sourceItemAccess:i})):o.premium=function(e){return(0,n.a)(e)||(0,n.b)(e)}(a);return o}({sourceItem:a,mainItemAccess:e.access,mainItemSharingGroups:t,portal:r});return{sourceItem:a,detail:i}})));return{result:u}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const B=e=>"admin"===e,K=e=>e.typeKeywords.includes("DeveloperBasemap"),x=async({sourceItem:e,isMainItemSharingToPublic:r,portal:t,mainItemSharingGroups:a})=>{if(r)return!1;const{result:i}=await U(e.id,t);return!function(e,r){if(null==e?void 0:e.length){return e.filter((e=>!(r||[]).includes(e))).length<=0}return!0}(a,i)},W=({mainItemAccess:e,sourceItemAccess:r})=>!("private"===r&&"shared"===e)&&_[e]>_[r];async function $(e,r,t,a,i=!0){const{user:n}=a,l=i?await Promise.all(r.map((async e=>{const{result:r}=await U(e.id,a);return r}))):[],o=l.flat(1);return m(e,t,o,{portal:a,user:n},!0)}const N=async({mainItem:e,sharingDetailResult:r,portal:t})=>{var a;const{sourceItem:i,detail:n}=r,{canEditShareLevel:l,needsGroupUpdate:o,needsShareLevelUpdate:s,premium:c}=n;if(n.bdfsDatastore)return"needBDFSDatastoreUpdate";if(!o&&!s&&!c)return null;if(!l&&!c)return"notEditableLayers";switch(e.access){case"public":if(c)return"premiumLayers";if("public"!==i.access){if((0,u.i)(t.subscriptionInfo||(null===(a=t.sourceJSON)||void 0===a?void 0:a.subscriptionInfo))&&f(i))return"notEditableLayers";if(await(0,p.i)(i,t)){return i.typeKeywords.includes("Public Data Collection")?"needEditableLayers":"needDataCollectionLayers"}}return"needsShareLevelUpdateLayers";case"org":case"shared":case"private":return c?null:"needsShareLevelUpdateLayers";default:J(e.access)}},V=["itemData","itemMetadata"],J=e=>{throw new Error(`Unexpected share level ${e}`)}}}]);