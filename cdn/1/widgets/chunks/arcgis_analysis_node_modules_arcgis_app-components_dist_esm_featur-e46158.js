/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_featur-e46158.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_featur-e46158"],{67575:(e,t,r)=>{r.d(t,{a:()=>i,i:()=>n});const i={FeatureServer:"Feature Service",GeocodeServer:"Geocoding Service",GeoDataServer:"Geodata Service",GeometryServer:"Geometry Service",GeoenrichmentServer:"Geoenrichment Service",GPServer:"Geoprocessing Service",GlobeServer:"Globe Service",ImageServer:"Image Service",MapServer:"Map Service",NAServer:"Network Analysis Service",ElevationServer:"Image Service",VectorTileServer:"Vector Tile Service",SceneServer:"Scene Service",StreamServer:"Stream Service",WMServer:"Workflow Manager Service",TiledImageServer:"Image Service",VideoServer:"Video Service"},n=e=>!!Object.values(i).includes(e)},29259:(e,t,r)=>{r.d(t,{U:()=>i,a:()=>s,b:()=>n,g:()=>a});const i="/Categories",n=(e,t,r=!0)=>{const i=null!=e?e:"";return`${i}${i.endsWith("/")?"":"/"}${r?t.title.toLocaleLowerCase():t.title}`};function a(e){var t;let r=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return r&&"/"!==r.charAt(0)&&(r=`/${r}`),r||i}const s=(e,t)=>`${e.replace(/\/([^\/]+)$/,`/${t}`)}`},43780:(e,t,r)=>{r.d(t,{a:()=>v,b:()=>d,c:()=>p,d:()=>y,f:()=>u,g:()=>c,u:()=>m});var i=r(46581),n=r(29259),a=r(31670),s=r(59673),o=r(59296),l=r(94788);const c=async({portal:e,user:t,group:r,useCache:i=!1})=>{var n;try{const a=await(r?d(r.id,e,i):u(e,t,i));return{result:null!==(n=null==a?void 0:a.categorySchema)&&void 0!==n?n:null}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};async function u(e,t,r=!0){if(null!=e||(e=a.c.portal),null!=t||(t=a.c.user),!(null==e?void 0:e.id)||t&&(0,o.a)(t))return null;const n=()=>(0,i.r)(`${(0,l.g)(e)}portals/${e.id}/categorySchema`);return r?(0,i.f)(n,"categorySchema",e.id):n()}async function d(e,t,r=!0){if(null!=t||(t=null===a.c||void 0===a.c?void 0:a.c.portal),!e||!t)return null;const n=()=>(0,i.r)(`${(0,s.a)(t,{id:e})}categorySchema`);return r?(0,i.f)(n,"categorySchema",e):n()}async function p(e,t,r=!0){if(null!=e||(e=a.c.portal),null!=t||(t=a.c.user),!(null==e?void 0:e.id)||t&&(0,o.a)(t))return null;const n=()=>(0,i.r)(`${(0,l.g)(e)}portals/${e.id}/memberCategorySchema`);return r?(0,i.f)(n,"memberCategorySchema",e.id):n()}async function v(e,t,r=!0){const n=()=>async function(e,t){var r;const n=(0,l.g)(e),a=(0,l.d)(e),o=await(0,i.r)(`${n}portals/self?culture=${a}`),c=await(0,i.r)(`${n}community/groups?q=${o.contentCategorySetsGroupQuery}`),u=null===(r=null==c?void 0:c.results)||void 0===r?void 0:r[0],d=(await(0,i.r)((0,s.g)(e,u),{q:`typekeywords: ${t}`})).results[0];return(0,i.r)(`${n}content/items/${d.id}/data`)}(e,t);return r?(0,i.f)(n,"categorySchema",t):n()}async function m({categories:e,itemIds:t,portal:r}){try{const n=`${(0,l.g)(r)}/content/updateItems`,a=JSON.stringify(t.map((t=>({[t]:{categories:Array.isArray(e)?e:e[t]}}))));return{result:await(0,i.r)(n,{items:a},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const y=async({path:e,portal:t,group:r,updateInfo:i})=>{try{const a=(await f({category:e,portal:t,group:r,num:1})).total;if(0===a)return console.warn(`No items found with category ${e} when updating schema`),{};const s=100,o=Math.ceil(a/s),l=[];for(let a=0;a<o;a++)l.push(f({category:e,portal:t,group:r,start:a*s,num:s}).then((({results:t})=>{const r={};return t.forEach((t=>{const a="change-title"===i.type?t.categories.map((t=>{const r=(0,n.a)(e,i.newTitle);return t===e?r:t.replace(`${e}/`,`${r}/`)})):t.categories.filter((t=>!t.startsWith(e)));r[t.id]=a})),r})));const c=await Promise.all(l);return await Promise.all(c.map((e=>m({categories:e,itemIds:Object.keys(e),portal:t})))),{}}catch(t){return console.error(`Error ${i.type} items schema from path ${e}:`,t),{error:{code:"unhandledError"}}}},f=({category:e,num:t=100,start:r=0,portal:n,group:a})=>{const o={start:r,num:t,categories:JSON.stringify([e])},c=a?(0,s.g)(n,a):`${(0,l.g)(n)}search`;return(0,i.r)(c,Object.assign(Object.assign({},o),{q:a?void 0:`orgid: ${n.id}`}))}},49412:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>n,i:()=>s});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","serviceNameInvalid","titleInvalid","titleRequired","titleInUseService","summaryInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType"],n=e=>i.includes(null==e?void 0:e.code),a=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),s=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},39274:(e,t,r)=>{r.d(t,{A:()=>nt,B:()=>Ge,M:()=>j,a:()=>Ke,b:()=>E,c:()=>lt,d:()=>Fe,e:()=>$e,f:()=>U,g:()=>Re,h:()=>Ee,i:()=>ze,j:()=>Ne,k:()=>ke,l:()=>Oe,m:()=>M,n:()=>tt,o:()=>We,p:()=>Z,q:()=>ct,r:()=>L,s:()=>k,t:()=>Le,u:()=>at,v:()=>rt,w:()=>it,x:()=>Pe,y:()=>Me,z:()=>C});var i=r(31670),n=r(11246),a=r(94788),s=r(51325),o=r(71700),l=r(49712),c=r(50852),u=r(8045),d=r(66488),p=r(46581),v=r(28926),m=r(67575),y=r(15437),f=r(73596),g=r(49412),h=r(86537),w=r(46227),b=r(65215),S=r(91253),x=r(11935),O=r(7652),I=r(43780);function T(e){const{customParameters:t}=o.a,r=e.includes("?")?"&":"?",i=(null==t?void 0:t.map((({parameter:e,value:t})=>`${e||""}${e||t?"=":""}${t||""}`)).join("&"))||"";return i?`${e}${r}${i}`:e}function L(e,{value:t,parameter:r}){const i=`${r}=${t}`,n=e.replace("&"===e[e.indexOf(i)-1]?`&${i}`:i,"");return"?"===n[n.length-1]?n.replace("?",""):n}const P=async e=>{const t=k.subscribers[e];try{await(null==t?void 0:t.unsubscribe())}catch(e){console.error(`Fail to call unsubscribe for ${t.name}: ${e}`)}},$=(0,x.c)({subscribers:{},unsubscribeAll:async()=>{await Promise.all(Object.keys(k.subscribers).map(P)),$.reset()},addSubscriber:(e,t)=>{const r=`${e}---${(0,w.g)()}`;return k.subscribers[r]={name:e,unsubscribe:t},r},unsubscribe:P,removeSubscriber:async e=>{delete k.subscribers[e]},isSubscriberValid:e=>!!k.subscribers[e]}),k=$.state,j=78643200;function M(e){if(!e)return null;let t=!0,r={},i={};return e.forEach((({append:e,parameter:n,value:a})=>{"layer"===e?(t=!1,i[n]=a):r[n]=a})),t?{customParameters:r}:{customParameters:r,customLayerParameters:i}}async function E(e,t,r){if("Desktop Application"===e.type)return $e();const i=await(0,c.b)(e);return"Application"!==e.type&&"API Key"!==e.type||await C(e.developerCredentialsType,i.id,t,r),i}async function C(e,t,r,i){const n=`${r}oauth2/registerApp`;let a={itemId:t,appType:"multiple",redirect_uris:JSON.stringify(["urn:ietf:wg:oauth:2.0:oob"])};i&&(a="apiToken"===e?Object.assign(Object.assign({},a),{httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges)}):"apikey"===i.appType?{itemId:t,appType:"apikey",redirect_uris:JSON.stringify(i.redirect_uris),httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges)}:{itemId:t,appType:i.appType,httpReferrers:JSON.stringify(i.httpReferrers),redirect_uris:JSON.stringify(i.redirect_uris),url:i.url,privileges:JSON.stringify(i.privileges)});try{return{result:await(0,p.r)(n,a,{},"post")}}catch(e){return console.error("error:",e),{error:{code:"unhandledError"}}}}async function U(e){try{return{result:await(0,p.r)(e,{},{addTokenManually:!1}),error:null}}catch(e){return console.error("error:",e),{result:null,error:{code:"appExtensionError"}}}}const R="hiddenMapDiv",F=()=>{const e=document.getElementById(R);e&&e.parentNode.removeChild(e)},N=(e=200,t=130)=>{let r=document.getElementById(R);r||(r=document.createElement("div"),r.id=R,r.style.position="absolute",r.style.left="-1000px",r.style.top="-1000px",r.style.width=`${e}px`,r.style.height=`${t}px`,document.body.appendChild(r));const i=document.createElement("div"),n="hiddenMap";return i.id=n,i.style.width=`${e}px`,i.style.height=`${t}px`,r.appendChild(i),n};async function A(e,t){const[r,i,n,a]=await(0,v.l)(["esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/tasks/PrintTask","esri/config"]),s=new r;s.layout="MAP_ONLY",s.format="png32",s.preserveScale=!1,s.showAttribution=!1,s.showLabels=!1,s.exportOptions={width:600,height:400,dpi:96};const o=new n(t.self.helperServices.printTask.url,{}),l=new i;return l.map=e,l.template=s,a.defaults.io.timeout=12e4,new Promise(((t,r)=>{o.execute(l,(r=>{a.defaults.io.timeout=6e4,function(e){var t;e.destroy(),null===(t=document.getElementById("hiddenMapDiv"))||void 0===t||t.removeChild(document.getElementById("hiddenMap"))}(e),t(r.url)}),(e=>{a.defaults.io.timeout=6e4,r(e)}))}))}async function D(e,t,r){var n;const a=i.c.api,[s]=await(0,v.l)([3===a?"esri/tasks/Geoprocessor":"esri/rest/geoprocessor"]),{portal:o}=i.c;(null!==(n=e.baseMap.baseMapLayers)&&void 0!==n?n:[]).forEach((e=>{delete e.resourceInfo})),e.mapOptions={showAttribution:!1,extent:{xmin:t[0][0],ymin:t[0][1],xmax:t[1][0],ymax:t[1][1],spatialReference:{wkid:4326}},spatialReference:r},e.exportOptions={dpi:96,outputSize:[600,400]},e.layoutOptions={};const l={Web_Map_as_JSON:JSON.stringify(e),Format:"PNG32",Layout_Template:"MAP_ONLY"};if(3===a){const e=new s(o.helperServices.printTask.url);return new Promise(((t,r)=>{e.execute(l).then((e=>{if(e){let i=!1;for(let r=0;r<e.length;r++)if("Output_File"===e[r].paramName){t(e[r].value.url),i=!0;break}i||r()}}))}))}const{results:c}=await s.execute(o.helperServices.printTask.url,l),u=c.find((e=>"data-file"===e.dataType&&e)).value.url;if(!u)throw new Error("Failed to create thumbnail");return u}async function W(e,t){return await async function(e,t){const{config:r}=i.c,s={item:{extent:t},itemData:e};try{const[e]=await(0,v.l)(["esri/arcgis/utils"]);e.arcgisUrl=`${(0,a.g)()}content/items`;const t=N(),o=await e.createMap(s,t,{mapOptions:{nav:!1},bingMapsKey:r.self.bingKey,geometryServiceURL:i.c.portal.helperServices.geometry.url}),l=function(e){return new Promise((t=>{e._heatmapManager?e._heatmapManager.on("recalculateHeatmap",t):t()}))},c=e=>{const t=[0];return new Promise((r=>{const i=setInterval(((e,t)=>{var n;(null===(n=e.graphics)||void 0===n?void 0:n.length)||t[0]>10?(clearInterval(i),r()):t[0]=t[0]+1}),500,e,t)}))},u=e=>new Promise((t=>{"esri.layers.VectorTileLayer"===e.declaredClass&&setTimeout(t,5e3),e.on("update-start",(()=>{d(e).then(t)}))})),d=function(e){return new Promise((t=>{if(!e.updating)return t();"esri.layers.VectorTileLayer"===e.declaredClass&&setTimeout(t,1e4),e.on("update-end",t)}))},{map:p}=o,m=[];return p.graphicsLayerIds.forEach((e=>{var t;const r=p.getLayer(e);"heatmap"===(null===(t=r.renderer)||void 0===t?void 0:t.type)?m.push(l(r)):"esri.layers.WFSLayer"===r.declaredClass?m.push(c(r)):r.updating&&m.push(d(r))})),p.layerIds.forEach((e=>{const t=o.map.getLayer(e);t.updating?m.push(d(t)):"esri.layers.VectorTileLayer"===t.declaredClass&&m.push(u(t))})),m.length?(await Promise.all(m),await(0,n.t)(1e3),await A(o.map,r)):await A(o.map,r)}catch(e){throw new Error(`Map creation failed: ${JSON.stringify(e)}`)}}(e,t)}async function G(e){var t;const[r]=await(0,v.l)([4===i.c.api?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{config:n,portal:a}=i.c,s={};s.baseMap=n.defaultBasemap||a.defaultBasemap,s.baseMap.title="basemap",s.operationalLayers=[];let o=e.url;o||"KML"!==e.type||(o=n.restBaseUrl+"content/items/"+e.id+"/data");const l=new URL(n.restBaseUrl).hostname;if(o.indexOf(l)>-1){const e=null===(t=null==n?void 0:n.userInfo)||void 0===t?void 0:t.token;e&&(o+="?token="+e)}s.operationalLayers.push({url:o,id:"KML_"+Math.random(),opacity:1,title:e.title,visibility:!0,type:"KML"});let c=[];if("string"==typeof e.extent){const t=e.extent.split(",");c=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]]}else c=e.extent&&e.extent.length>0?e.extent:[[-180,-90],[180,90]];return D(s,c,new r({wkid:4326}))}const J={xmax:2e7,xmin:-2e7,ymax:2e7,ymin:-2e7,spatialReference:{wkid:102100}};function _(e,t){const r={102113:[-20037508.342788905,20037508.342788905],102100:[-20037508.342788905,20037508.342788905],3785:[-20037508.342788905,20037508.342788905],3857:[-20037508.342788905,20037508.342788905],4326:[-180,180]}[e];if(r&&t.xmin>t.xmax){const e=r[1]-t.xmin,i=t.xmax-r[0];e>i?t.xmax=r[1]+i:t.xmin=r[0]-e}}function K(e,t){var r,i;const n="ImageServer"!==t?null==e?void 0:e.spatialReference:null===(r=null==e?void 0:e.extent)||void 0===r?void 0:r.spatialReference;return n?n.wkid?n.wkid:n.wkt&&-1!==(null===(i=n.wkt)||void 0===i?void 0:i.search(/^PROJCS/i))?/^PROJCS\["[A-Za-z0-9_]*/i.exec(n.wkt)[0].split("[")[1]:null:null}async function V(e){var t,r;const[a]=await(0,v.l)([4===i.c.api?"esri/geometry/SpatialReference":"esri/SpatialReference"]),s=(null===(t=null==e?void 0:e.spatialReference)||void 0===t?void 0:t.wkid)||(null===(r=null==e?void 0:e.spatialReference)||void 0===r?void 0:r.wkt),o=new a({wkid:4326}),l=await async function(e,t){const r=[102113,102100,3857];if((null==e?void 0:e.wkt)==(null==t?void 0:t.wkt)&&((null==e?void 0:e.wkid)==(null==t?void 0:t.wkid)||(0,n.i)(e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.wkid))||(0,n.i)(null==t?void 0:t.latestWkid)&&(null==e?void 0:e.wkid)==(null==t?void 0:t.latestWkid)||(0,n.i)(null==e?void 0:e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.latestWkid))return!0;if((null==e?void 0:e.wkid)&&(null==t?void 0:t.wkid)&&r.includes(null==e?void 0:e.wkid)&&r.includes(null==t?void 0:t.wkid))return!0;return!1}(o,null==e?void 0:e.spatialReference);return s&&!l?await B(e,o):e}async function q(e,t){const{portal:r}=i.c,[n,a]=await(0,v.l)(4===i.c.api?["esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]:["esri/geometry/webMercatorUtils","esri/tasks/GeometryService"]),s=[102113,102100,3857],o=e.spatialReference.wkid;if(o===t.wkid)return[e];let l;return 4326===o&&s.indexOf(t.wkid)>-1?(e.ymin=Math.max(e.ymin,-89.99),e.ymax=Math.min(e.ymax,89.99),l=n.geographicToWebMercator(e),_(t.wkid,l),l.spatialReference.wkid=t.wkid,[l]):s.indexOf(o)>-1&&4326===t.wkid?(l=n.webMercatorToGeographic(e),_(t.wkid,l),[l]):new Promise((async(n,s)=>{const o=4===i.c.api?a:new a(r.helperServices.geometry.url),l=e=>{const t=null==e?void 0:e[0];if("extent"!==(null==t?void 0:t.type)||isNaN(e[0].xmin)||isNaN(e[0].ymin)||isNaN(e[0].xmax)||isNaN(e[0].ymax)){if("point"!==(null==t?void 0:t.type)||isNaN(e[0].x)||isNaN(e[0].y))throw new Error;n(e)}else n(e)};if(4===i.c.api)try{const[i]=await(0,v.l)(["esri/rest/support/ProjectParameters"]),n=new i({geometries:[e],outSpatialReference:t});l(await o.project(r.helperServices.geometry.url,n))}catch(e){throw new Error(e)}else o.project([e],t,l,(e=>{s(e)}))}))}async function B(e,t){var r;const[i]=await(0,v.l)(["esri/geometry/Extent"]),n=new i(J),a=e.clone?e.clone():new i(Object.assign({},e)),s=await q(a,t);return"extent"===(null===(r=null==s?void 0:s[0])||void 0===r?void 0:r.type)?s[0]:n}async function z(e,t){const{api:r}=i.c,[n]=await(0,v.l)([4===r?"esri/geometry/SpatialReference":"esri/SpatialReference"]),[a,s]=await(0,v.l)(["esri/layers/FeatureLayer","esri/layers/StreamLayer"]);if(!e||!(e instanceof a)||e instanceof s)return t;if(3===r){try{await e.addPlugin("esri/plugins/FeatureLayerStatistics");const r=await e.statisticsPlugin.getSuggestedScaleRange(),{minScale:i,center:a,relaxedMinScale:s}=r;if(a){let e=await Q(a,1280,i);if(r.relaxedMinScale>0){let t=H(e,200),r=800;for(;t>s&&(e=Q(a,r,i),t=H(e,200),r-=200,!(r<=0)););}const o=await q(e,new n({wkid:4326}));t=[[o[0].xmin,o[0].ymin],[o[0].xmax,o[0].ymax]]}}catch(e){console.warn(e)}return t}return t}async function H(e,t){const[r,i]=await(0,v.l)(["esri/config","esri/WKIDUnitConversion"]),n=e.spatialReference,a=null==n?void 0:n.wkid,s=null==n?void 0:n.wkt;let o=null;if(a)o=i.values[i[a]];else if(-1!==(null==s?void 0:s.search(/^PROJCS/i))){const e=/UNIT\[([^\]]+)\]\]$/i.exec(s);(null==e?void 0:e[1])&&(o=parseFloat(e[1].split(",")[1]))}return e.getWidth()/t*(o||20015077/180)*39.37*r.defaults.screenDPI}async function Q(e,t,r){const[i]=await(0,v.l)(["esri/geometry/Extent"]);return async function(e,t,r){const[i,n]=await(0,v.l)(["esri/config","esri/WKIDUnitConversion"]),a=39.37,s=20015077/180,o=n;let l,c,u=e.spatialReference;u&&(l=u.wkid,c=u.wkt);let d=null;if(l)d=o.values[o[l]];else if(c&&-1!==c.search(/^PROJCS/i)){const e=/UNIT\[([^\]]+)\]\]$/i.exec(c);(null==e?void 0:e[1])&&(d=parseFloat(e[1].split(",")[1]))}const p=e.expand(r*t/((d||s)*a*i.defaults.screenDPI)/e.getWidth());return p}(new i(e.x-1,e.y-.5,e.x+1,e.y+.5,e.spatialReference),t,r)}function X(e,t=4){if(!e)return X(J);if("string"==typeof e)return e;if(Array.isArray(e)){if(Array.isArray(e[0])&&Array.isArray(e[1])){let t,r;return 2===e[0].length&&(t=e[0],r=e[1]),4!==e[0].length&&6!==e[0].length||(t=[e[0][0],e[0][1]],r=[e[0][2],e[0][3]],6===e[0].length&&(r=[e[0][3],e[0][4]])),`${t.join(",")},${r.join(",")}`}return e.join(",")}return`${e.xmin.toFixed(t)},${e.ymin.toFixed(t)},${e.xmax.toFixed(t)},${e.ymax.toFixed(t)}`}async function Y(e,t,r){const[i,n]=await(0,v.l)(["esri/config","esri/layers/KMLLayer"]);if(3===r?i.defaults.kmlService=t.kmlService:i.kmlServiceUrl=t.kmlService,4===r){const t=new n({url:e});await t.load();return X(t.fullExtent)}const a=new n(e);return new Promise(((e,t)=>{a.on("load",(async()=>{const t=await async function(e){const[t]=await(0,v.l)(["esri/graphicsUtils"]),r=e.getLayers();let i;return r.forEach((e=>{var r;if((null===(r=e.graphics)||void 0===r?void 0:r.length)>0){const r=t.graphicsExtent(e.graphics);i=i?i.union(r):r}})),i}(a);e(t?X(t):void 0)})),a.on("error",t)}))}const Z=async(e,t,r,i,n)=>{try{const a=t.isPortal?r:`https://${t.portalHostname}/sharing/rest`,s=t.portalHostname?`${a}/content/items/${e}/data`:`${(0,c.g)(e)}/data`,o=await Y(s,i,n);return{result:await(0,c.u)(e,{url:s,extent:o})}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};var ee;async function te(e){if(4===i.c.api)return"imagery-tile"==e.type;const[t]=await(0,v.l)(["esri/layers/RasterXLayer"]);return e instanceof t}async function re(e){if(4===i.c.api)return"imagery"===e.type;const[t,r]=await(0,v.l)(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"]);return e instanceof t||e instanceof r}!function(e){e.Single="single",e.Multi="multi",e.Children="children",e.MultiChildren="multi-children",e.Ancestors="ancestors"}(ee||(ee={}));const ie={type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},ne={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:1.5},ae={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};async function se(e){const[t,r]=await(0,v.l)(["esri/renderers/SimpleRenderer",4===i.c.api?"esri/geometry/support/jsonUtils":"esri/symbols/jsonUtils"]);switch(e){case"esriGeometryPoint":return new t(r.fromJson(ie)).toJson();case"esriGeometryPolyline":return new t(r.fromJson(ne)).toJson();case"esriGeometryPolygon":return new t(r.fromJson(ae)).toJson()}}async function oe(e){const{fields:t,selectedLayer:r}=e;if(null==t?void 0:t.length){const i=t.filter((e=>"esriFieldTypeGeometry"!==e.type));if(null==i?void 0:i.length)return async function(e,t){var r,i;const n=e.displayField,a=e.name+((null==n?void 0:n.length)?`: {${n}}`:"");let s=e.fields,o=!1,l=!1,c=!1;const u=await re(t),d=await te(t);if(u||d){const e={rasterAttributeTableFieldPrefix:"Raster."};s=null===(r=t.getCustomRasterFields)||void 0===r?void 0:r.call(t,e),c=["F32","F64"].indexOf(t.pixelType)<0,(null==t?void 0:t.capabilities)&&(o=(null==t?void 0:t.capabilities.toLowerCase().indexOf("catalog"))>-1||(null===(i=t.fields)||void 0===i?void 0:i.length)>0,l=o&&("esriImageServiceDataTypeVector-UV"===t.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===t.serviceDataType))}const p={esriFieldTypeDouble:1,esriFieldTypeSingle:1},v={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},m={esriFieldTypeDate:1};let y=",";e.editFieldsInfo&&(e.editFieldsInfo.creatorField&&(y+=`${e.editFieldsInfo.creatorField},`),e.editFieldsInfo.creationDateField&&(y+=`${e.editFieldsInfo.creationDateField},`),e.editFieldsInfo.editorField&&(y+=`${e.editFieldsInfo.editorField},`),e.editFieldsInfo.editDateField&&(y+=`${e.editFieldsInfo.editDateField},`),y=y.toLowerCase());const f={title:a,fieldInfos:s.map((r=>{let i="esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type&&"esriFieldTypeGeometry"!==r.type,n=null,a=r.editable&&"esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type;if(i){let a=r.name.toLowerCase(),s=`${y}stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,`;o&&(s=`${s}raster.itempixelvalue,`,l&&(s=`${s}raster.magnitude,raster.direction,`)),(s.indexOf(`,${a},`)>-1||a.indexOf("shape")>-1||a.indexOf("perimeter")>-1||a.indexOf("objectid")>-1||a.indexOf("raster.servicepixelvalue.")>-1||a.indexOf("_i")==a.length-2)&&(i=!1),r.type in v?n={places:0,digitSeparator:!0}:r.type in p?n={places:c&&(a.indexOf("raster.servicepixelvalue")>-1||a.indexOf("raster.itempixelvalue")>-1)?0:2,digitSeparator:!0}:r.type in m&&(e.currentVersion>=10||(null==t?void 0:t.version)>=10)&&(n={dateFormat:"longMonthDayYear"})}return a=a?-1===y.indexOf(`,${r.name.toLowerCase()},`):a,{fieldName:r.name,label:r.alias,isEditable:a,tooltip:"",visible:i,format:n,stringFieldOption:"textbox"}})),description:null,showAttachments:!0,mediaInfos:[],layerOptions:void 0};return re(t)?(f.layerOptions={},f.layerOptions.showNoDataRecords=!0,f.layerOptions.returnTopmostRaster=!0):te(t)&&(f.layerOptions={},f.layerOptions.showNoDataRecords=!0),f}({name:(null==r?void 0:r.title)||"",fields:t},e)}}async function le(e,t){if(3===i.c.api){const r={opacity:1,visibility:!0,layerType:"WebTiledLayer",type:"WebTiledLayer"},n={baseMap:{title:"basemap",baseMapLayers:[],operationalLayers:[]}};if(e.id){const t=await async function(e){const{config:t}=i.c,r=`${t.restBaseUrl}content/items/${e}/data`;try{const e=await(0,p.r)(r,null,{disableIdentityLookup:!0});return e&&((null==e?void 0:e.wfsInfo)||e.wmtsInfo)?e:(null==e?void 0:e.layers)?e.layers:{}}catch(e){return e}}(e.id);n.baseMap.baseMapLayers.push(Object.assign(Object.assign({},t),r))}else n.baseMap.baseMapLayers.push(r);return W(n,t||e.extent)}{const[t,r,n,a]=await(0,v.l)(["esri/layers/WMTSLayer","esri/Map","esri/views/MapView","esri/core/reactiveUtils"]),s=new t({portalItem:{id:e.id,portal:i.c.portal}}),o=new r({layers:[s]}),l=new n({container:N(),map:o});await a.whenOnce((()=>!l.updating)),await l.goTo(s.fullExtent);return(await l.takeScreenshot({width:l.width,height:l.height,format:"png"})).dataUrl}}const ce=e=>{var t;const r=i.c.portal;return e.thumbnailURL&&(e.thumbnailURL=function(e){var t;return(null===(t=null==e?void 0:e.staticImagesUrl)||void 0===t?void 0:t.replace("http:","https:"))||""}(r)+e.thumbnailURL),r.isPortal&&0!==(null===(t=e.thumbnailURL)||void 0===t?void 0:t.indexOf("http"))&&(e.thumbnailURL=window.location.protocol+"//"+window.location.host+e.thumbnailURL),e},ue=(e,t)=>{const[r,i]=e.split("?");return`${r}${(null==i?void 0:i.split("&").reduce(((e,r)=>{const[i]=r.split("=");return-1===t.indexOf(i.toLowerCase())?`${e}${e?"&":"?"}${r}`:e}),""))||""}`},de=async e=>{var t;const[r]=await(0,v.l)(["esri/layers/WMSLayer"]),{customParameters:n}=e,a=M(n),s=ue(e.url,["service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);try{if(4===i.c.api){const i=new r({url:s,customParameters:Object.assign({},null==a?void 0:a.customParameters)||{},customLayerParameters:Object.assign({},null==a?void 0:a.customLayerParameters)||{}});try{const t=await i.load();return e.type="WMS",{result:Object.assign(Object.assign({},e),{type:"WMS",serviceInfo:t})}}catch(e){return{error:{code:e.message?"unhandledError":"serviceNotExist",message:null!==(t=e.message)&&void 0!==t?t:e.message}}}}await he(s);const n=new r(s,{customParameters:Object.assign({},null==a?void 0:a.customParameters)||{},customLayerParameters:Object.assign({},null==a?void 0:a.customLayerParameters)||{}}),o=await new Promise(((t,r)=>{n.on("load",(()=>{e.type="WMS",t(Object.assign(Object.assign({},e),{type:"WMS",serviceInfo:n}))})),n.on("error",(e=>{var t;const{error:i}=e,n=!(null==i?void 0:i.message)||404===(null==i?void 0:i.status);r({code:n?"serviceNotExist":"unhandledError",message:null!==(t=i.message)&&void 0!==t?t:e.message})}))}));return{result:o}}catch(e){return console.error(e),{error:e}}},pe=async e=>{const t=4===i.c.api?await e.load():e,{layerInfos:r,title:n,allSublayers:a}=t;return{title:n,layers:function(e){return e.map((e=>{var t;const r=null!==(t=e.legendURL)&&void 0!==t?t:e.legendEnabled?e.legendUrl:void 0;return{name:e.name,visible:!1,title:e.title.replace(/ /g,String.fromCharCode(160)),extent:e.extent,legendUrl:r||void 0,queryable:e.queryable,subLayers:e.subLayers||[]}}))}(4===i.c.api?a.items:r)}};function ve(e=[],t){return delete t.id,t.subLayers&&t.subLayers.length?t.subLayers.reduce(ve,e):[...e,t]}const me=async(e,t)=>{let r=e.thumbnailURL;try{r=(await t.fetchImage(e.extent,800,532)).src}catch(e){console.error(e)}return Object.assign(Object.assign({},e),{thumbnailURL:r,extent:X(e.extent)})},ye=async(e,t)=>new Promise((r=>{const i=t=>{r(Object.assign(Object.assign({},e),{thumbnailURL:t||e.thumbnailURL,extent:X(e.extent)}))};t.getImageUrl(e.extent,800,532,i,i)})),fe=(e,t)=>JSON.stringify({title:e.title||"",url:e.url,version:e.version,layers:t,copyright:e.copyright||"",maxHeight:e.imageMaxHeight,maxWidth:e.imageMaxWidth,spatialReferences:e.spatialReferences,format:e.imageFormat.includes("png")?null:e.imageFormat,featureInfoUrl:e.featureInfoUrl,featureInfoFormat:e.featureInfoFormat,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}}),ge=(e,t)=>JSON.stringify({title:e.title||"",url:e.url,mapUrl:e.getMapURL,version:e.version,layers:t,copyright:e.copyright||"",maxHeight:e.maxHeight,maxWidth:e.maxWidth,spatialReferences:e.spatialReferences,format:"png"!==e.getImageFormat()?e.getImageFormat():null,featureInfoUrl:e.getFeatureInfoURL,featureInfoFormat:e.featureInfoFormat,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}});async function he(e){var t,r,i;try{const n=await fetch(e);if("cors"===n.type&&200===n.status){const n=new URL(e).hostname,[a]=await(0,v.l)(["esri/config"]);null===(i=null===(r=null===(t=null==a?void 0:a.defaults)||void 0===t?void 0:t.io)||void 0===r?void 0:r.corsEnabledServers)||void 0===i||i.push(n)}}catch(e){}}const we=async(e,t)=>{const[r]=await(0,v.l)(["esri/layers/WFSLayer"]),{customParameters:n}=o.a,{url:a}=e,s=ue(a,["version","service","request","layer","typename"]),l=M(n),c=await(async e=>{const{query:t}=await(0,y.c)(e);return(null==t?void 0:t.version)||"2.0.0"})(a),u=t||{version:c,url:s,customParameters:(null==l?void 0:l.customParameters)||{}};try{if(4===i.c.api){if("2.0.0"!==c)return{error:{code:"unsupportedWFSVersion"}};delete u.version,delete u.url;const[t]=await(0,v.l)(["esri/layers/ogc/wfsUtils"]),i=await t.getCapabilities(s,u),n=i.featureTypes;if(n&&n.length){const a=await t.getWFSLayerInfo(i,void 0,void 0,u),o=r.fromWFSLayerInfo(a);return o.layers=n,o.url=s,o.isComplex="esriGeometryComplex"===o.geometryType,{result:Object.assign(Object.assign({},e),{type:"WFS",serviceInfo:o})}}return{error:{code:"emptyFeatureLayer"}}}const t=new r(u);await he(s);return{result:await new Promise(((r,i)=>{t.initialize(u,(n=>{n&&n.length?(t.layers=n,t.url=s,t.isComplex="esriGeometryComplex"===t.geometryType,r(Object.assign(Object.assign({},e),{type:"WFS",serviceInfo:t}))):i({code:"emptyFeatureLayer"})})),t.on("error",(async()=>{if("2.0.0"===t.toJson().version){const{result:t,error:n}=await we(e,{version:"1.1.0",url:a});n&&i(n),r(t)}else if("1.1.0"===t.toJson().version){const{result:t,error:n}=await we(e,{version:"1.0.0",url:a});n&&i(n),r(t)}else i({code:"serviceNotExist"})}))}))}}catch(e){return console.error(e),{error:e}}},be=async e=>{var t;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const{serviceInfo:r}=e,n=X((null===(t=r.selectedLayer)||void 0===t?void 0:t.fullExtent)||[[],[]]),a=n.split(",").map(Number);if(!r.geometryType||"none"===r.geometryType)return Promise.reject(new Error("missingGeometry"));const s={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},l=await async function(e){const{layerNamespace:t,getFeatureUrl:r,spatialReferences:n,fields:a}=e,{maxFeatures:s,geometryType:l}=o.a;let c,u,d,p;if(3===i.c.api){const t=e.toJson();c=t.url,u=t.mode,d=t.version,p=t.name}else{const t=e;c=t.url,d="2.0.0",p=t.name}const v=l||e.geometryType||"esriGeometryComplex";return{url:c,mode:u,wfsInfo:{version:d,name:p,wfsNamespace:t,featureUrl:r,supportedSpatialReferences:n,customParameters:e.customParameters||{},maxFeatures:s||e.maxFeatures||3e3},layerDefinition:{geometryType:v,drawingInfo:{renderer:await se(v)},spatialReference:{wkid:4326},fields:a},popupInfo:await oe(e)}}(r),c=Object.assign(Object.assign({},ce(s)),{text:JSON.stringify(l),extent:n}),u=await Ue(c),d=Object.assign(Object.assign(Object.assign({},c),u),{extent:[[a[0],a[1]],[a[2],a[3]]]});try{const e=await async function(e){const{config:t}=i.c,r={baseMap:t.defaultBasemap||t.self.defaultBasemap,operationalLayers:[]},{baseMapLayers:n}=r.baseMap;let a=!1;return n.forEach((e=>{e.isReference||a||(!t.allSSL&&"https:"!=location.protocol||!(0,y.a)(e.url)&&!(0,y.b)(e.url)||(e.url=e.url.replace("http:","https:")),e.visibility=!1,a=!0,r.baseMap.baseMapLayers=[e])})),r.operationalLayers.push({type:"WFS",layerType:"WFS",opacity:1,visibility:!0,id:"wfs_xxx",wfsInfo:{maxFeatures:100}}),D(r,e)}(d.extent);return Object.assign(Object.assign({},d),{thumbnailUrl:e})}catch(e){return d}};async function Se(e,t){const[r]=await(0,v.l)(["esri/layers/WMTSLayer"]),{customParameters:n,url:a}=e,s=M(n),o=Object.assign(Object.assign({},t),{customLayerParameters:(null==s?void 0:s.customLayerParameters)||{},customParameters:(null==s?void 0:s.customParameters)||{}})||await Object.assign(Object.assign({},async function(e){var t,r;const i=await(0,y.c)(e),n=(null===(t=i.query)||void 0===t?void 0:t.service)||"",a=(null===(r=i.query)||void 0===r?void 0:r.request)||"";return"wmts"===n.toLowerCase()&&"getcapabilities"===a.toLowerCase()||e.toLowerCase().indexOf("/1.0.0/wmtscapabilities.xml")>-1?{serviceMode:"KVP"}:{}}(a)),{customLayerParameters:(null==s?void 0:s.customLayerParameters)||{},customParameters:(null==s?void 0:s.customParameters)||{}}),l=ue(a,["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]),c=l.replace(/\/1.0.0\/wmtscapabilities.xml/i,"");try{if(4===i.c.api){const t=new r(c,o),i=t;await i.load();const n=i.sublayers.toArray();return n&&n.length?(t.layers=n,{result:Object.assign(Object.assign({},e),{type:"WMTS",serviceInfo:t})}):{error:{code:"serviceNotExist"}}}await he(l);const t=new r(c,o);let n;return{result:await new Promise(((r,i)=>{t.on("load",(({layer:a})=>{n=a.layers,n&&n.length?(t.layers=n,r(Object.assign(Object.assign({},e),{type:"WMTS",serviceInfo:t}))):i(new Error("serviceNotExist"))})),t.on("error",(t=>{var n;o.serviceMode?("The WMTS capabilities XML is not valid"===(null===(n=t.error)||void 0===n?void 0:n.message)&&i({code:"invalidWMTS"}),i({code:"serviceNotExist"})):Se(e,{serviceMode:"KVP"}).then((({result:e,error:t})=>{t&&i(t),r(e)}),i)}))}))}}catch(e){return console.error(e),{error:e}}}async function xe(e){if(!e)return Promise.reject("serviceNotExist");const{serviceInfo:t,selectedLayer:r,selectedTileInfo:n}=e;if(!r)return Promise.reject(new Error("layerNotSelected"));if(!n)return Promise.reject(new Error("missingGeometry"));t.selectedTileInfo=n;const{wmtsConfig:a,fullExtent:s}=await async function(e){var t;const r=4===i.c.api;try{const[n]=await(0,v.l)([r?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{selectedLayer:a,selectedTileInfo:s,copyright:o}=e,l=(null==s?void 0:s.fullExtent.spatialReference)||new n({wkid:4326}),c=await q(null==a?void 0:a[r?"fullExtent":"gcsExtent"],l).then((e=>{var t;return"extent"===(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type)?4===i.c.api?e[0]:e[0].toJson():null}));let u,d="";if(r)d=a.imageFormat;else{const e=a.formats;d=e.includes("image/png")?"image/png":e[0]}e.resourceUrls=a.resourceUrls,u=r?e.getUrlTemplate(a.id,s.id,d,a.styleId):e.getTileUrlTemplate({identifier:a.identifier,tileMatrixSet:s.tileMatrixSet,format:d});const p={templateUrl:u,copyright:function(e){return"none"!==(null==e?void 0:e.toLowerCase())?(null==e?void 0:e.length)>180?`${e.substring(0,180)}..`:"":e}(o),fullExtent:c||e.selectedTileInfo.fullExtent,tileInfo:function(e){const{tileInfo:t}=e;return 96!==(null==t?void 0:t.dpi)&&(t.lods.forEach((e=>{e.scale=96*e.scale/t.dpi})),t.dpi=96),r?t:t.toJson()}(s),wmtsInfo:{url:null!==(t=e.wmtsUrl)&&void 0!==t?t:e.url,layerIdentifier:a.identifier,tileMatrixSet:s.tileMatrixSet,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}}};return Promise.resolve({wmtsConfig:p,fullExtent:c})}catch(e){throw console.error(e),e}}(t).catch((e=>{throw console.error("Error getting WMTS config",e),e})),o=t.selectedLayer[4===i.c.api?"fullExtent":"gcsExtent"],l=s?o:{xmin:-180,ymin:-90,xmax:180,ymax:90},u={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},d=Object.assign(Object.assign({},ce(u)),{url:a.wmtsInfo.url,text:JSON.stringify(a),extent:`${l.xmin},${l.ymin},${l.xmax},${l.ymax}`}),p=await Ue(d),m=Object.assign(Object.assign(Object.assign({},d),p),{extent:[[l.xmin,l.ymin],[l.xmax,l.ymax]]});try{const e=await le(m),t=4===i.c.api?{type:"base64",data:e}:{type:"url",url:e},r=await(0,c.e)(p.id,t);return Object.assign(Object.assign({},m),r)}catch(e){return console.error("Error when adding WMTS URL:",e),m}}function Oe(e){var t,r;if(!e)return;const{title:i,description:n}=e;s.i.title=null!==(t=null!=i?i:s.i.title)&&void 0!==t?t:"",s.i.snippet=null!==(r=null!=n?n:s.i.snippet)&&void 0!==r?r:"",o.a.selectedLayer=e}async function Ie(e,t={},r=!0){const{links:n}=e,a=Te(n,"data","application/json")||Te(n,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==a)throw new Error("Missing collections url");return 3===i.c.api?(0,p.r)(T(a.href),{},Object.assign(Object.assign({},t),{addTokenManually:!1}),"auto",{v3Request:{headers:{accept:"application/json"}},excludeJson:r}):(0,p.r)(T(a.href),{},Object.assign(Object.assign({},t),{addTokenManually:!1,headers:{accept:"application/json"}}),"auto",{excludeJson:r})}function Te(e,t,r){return e.find((e=>e.rel===t&&e.type===r))||e.find((e=>e.rel===t&&!e.type))}const Le=(e,t)=>{const{newItemMode:r,typeKeywords:n,tags:a,extent:l,selectedServiceInfoLayersNames:u,addFeatureLayerType:d,layerData:p}=o.a,v=s.i.title;switch((null==v?void 0:v.length)>250&&(s.i.title=v.substring(0,250)),r){case"application":return E(e,t);case"file":return $e();case"url":return Ee(e,i.c.config,i.c.api);case"featureLayer":return lt({serviceInfo:e.serviceInfo,typeKeywords:n,tags:a,extent:l,selectedServiceInfoLayersNames:u,addFeatureLayerType:d,layerData:p});default:return(0,c.b)(Object.assign({},e))}},Pe=async()=>{try{const e=o.c,t=await Le(e,"");o.a.id=t.id;const r=await Re(o.a.id,{success:t.success});if("failed"===r.status)throw r.statusMessage;return{}}catch(e){console.error(e);const t=(null==e?void 0:e.statusMessage)||e||"";switch(!0){case t.includes("Invalid File Geodatabase"):return{error:{code:"invalidFileGeodatabase"}};case t.includes("Invalid Shapefile"):return{error:{code:"invalidShapefile"}};case t.includes("The request size is greater than the max allowed of 1024MB"):return{error:{code:"exceedsFileSize"}};default:return{error:{code:"unhandledError"}}}}},$e=async e=>{const t=o.a.file,r=o.a.dataUrl;return!t&&r?ke(e):(null==t?void 0:t.size)>j||"Esri Classifier Definition"===o.a.type?Me():async function(){const e=(0,c.k)(i.c.user,s.i.folder),t=(0,c.i)(s.i,o.a);try{return await(0,p.a)(e,t,{},"post")}catch(e){throw(null==e?void 0:e.message)||e}}()},ke=async e=>{var t;const r=(0,c.k)(i.c.user,s.i.folder),{fileName:n,dataUrl:a,extension:l}=o.a,u=(0,c.h)(s.i,o.a),d=!!o.a.overwrite,v=(null==a?void 0:a.includes("/query?"))&&(null==n?void 0:n.includes("query"))&&(null==l?void 0:l.includes("json"))?{filename:(0,w.g)(),dataUrl:a}:{},m=Object.assign(Object.assign(Object.assign({},u),{async:!0,filename:null!==(t=null==e?void 0:e.filename)&&void 0!==t?t:n,title:null==e?void 0:e.title,overwrite:d}),v);return(0,p.r)(r,m,{},"post")};async function je(e,t,r=0){const{user:n,portal:a}=i.c,{existingItem:s}=o.a;try{const{partData:o,formData:l}=e,c=`?streamdata=true&size=${o.size}&partNum=${o.partNum}&f=json`,u=`${s?(0,O.g)(await(0,O.h)(s.owner,a),a):n.userContentUrl}/items/${t}/addPart${c}`;return{response:await(0,p.a)(u,l,{"X-Esri-Authorization":`Bearer ${(0,b.g)(i.c.portal)}`},"post"),attempts:r,partSize:o.size}}catch(i){if(!o.a.id)throw"cancelled";if(++r>5)throw new Error("Upload failed - too many attempts");return je(e,t,r)}}const Me=async e=>{var t,r,n,a;let l,d,v,m,y=!0;if(e){const{updateUrl:t,updateFormData:r,updateSourceDataId:i}=e;l=t,d=r,v=i,m=o.a.existingItem.owner}const f=()=>{if(o.a.id){y=!1;const e=o.a.id;return o.a.id=null,(0,c.l)(e,m)}},g=k.addSubscriber("addFileMultiPart",f),h=i.c.config;l=e?l:(0,c.k)(i.c.user,s.i.folder);const{fileName:w,file:x}=o.a;let O,I=null!==(t=h.multiPartBatchSize)&&void 0!==t?t:3,T=0;try{if(e)await(0,p.a)(l,d,{enctype:"multipart/form/data"},"post"),O=v;else{const e=await(0,p.r)(l,{multipart:!0,fileName:w,async:!0},{},"post");O=null!==(r=e.id)&&void 0!==r?r:e.itemId,o.a.id=O}o.a.uploadProgress=0,S.w.uploadProgress=0;let t=0;const n=function*(e){const t=o.a.file,{name:r,size:n}=t;let a=e?o.a.fileName:r,s=26214400,l=Math.ceil(n/s),c=0;for(l>1e4&&(s=Math.ceil(n/1e4),l=Math.ceil(n/s));c<l;){const e=new FormData,r=c*s,n=t.slice(r,r+s);c++;const o={partNum:c,size:n.size};e.append("partNum",String(o.partNum)),e.append("streamdata","true"),e.append("f","json"),e.append("token",(0,b.g)(i.c.portal)),e.append("file",n,a),yield{partData:o,formData:e}}return null}(!!e);await(0,u.s)((()=>{const{value:e,done:t}=n.next();return t?null:je(e,O)}),{getBatchSize:()=>I,onPromiseCompleted:e=>{const{attempts:r,partSize:i}=e;r>0?(I=Math.max(1,Math.ceil(I/2)),T=0):(T++,T>=I&&(I=Math.min(I+1,10),T=0)),t+=i;const n=Math.floor(t/x.size*100);o.a.uploadProgress=n,S.w.uploadProgress=n},onPromiseThrow(){y=!1},shouldContinue:()=>y&&k.isSubscriberValid(g)}),k.removeSubscriber(g);const{type:a,extension:s,enablePublishing:m,properties:f,existingItem:h,tileLayerPublishType:L}=o.a,P=[];return"3dTiles"===L&&P.push(o.a.tilesLayer3dTilesLayerType),await(0,c.j)(O,{file:x,type:a,extension:s,enablePublishing:m,properties:f,existingItem:h,typeKeywords:P},!!e)}catch(e){throw await f(),console.error(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:e),null!==(a=null==e?void 0:e.message)&&void 0!==a?a:e}},Ee=(e,t,r)=>{if(e.agsType)return Ke(e);switch(e.type){case"KML":return async function(e,t,r){try{const[i,n]=await Promise.all([Y(e.url,t,r),G(e)]);return await Ue(Object.assign(Object.assign({},e),{extent:i,thumbnailURL:n}))}catch(e){throw e}}(e,t,r);case"WMS":return(async e=>{const t=4===i.c.api,[r]=await(0,v.l)([t?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{layers:n}=o.a;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const a=ce(e),{serviceInfo:s}=a,l=[];let c;const u=n.reduce(ve,[]).map((e=>{c=c?e.extent?c.union(e.extent):c:e.extent,l.push(e.name);const t={name:e.name,title:e.title,legendUrl:void 0,queryable:e.queryable};return e.legendUrl&&(t.legendUrl=e.legendUrl),t}));t||s.setVisibleLayers(l),c=c||s.fullExtent;const d=!s.spatialReferences.some((e=>e===c.spatialReference.wkid)),p={type:e.type,url:s.url,description:s.description||"",accessInformation:s.copyright||"",text:t?fe(s,u):ge(s,u),extent:c};d&&B(c,new r({wkid:s.spatialReferences[0]})).then((e=>p.extent=e));const m=t?await me(p,s):await ye(p,s);return Ue(m)})(e);case"WFS":return be(e);case"WMTS":return xe(e);case"OGCFeatureServer":return async function(e){const{serviceInfo:t,customParameters:r}=e;return t?(r.length>0&&(e.text=JSON.stringify({customParameters:M(r).customParameters})),Ue(e)):Promise.reject(new Error("serviceNotExist"))}(e);default:return Ue(e)}},Ce=e=>{var t;const{type:r,agsType:i}=e;return[...(null===(t=h.a[null!=i?i:r])||void 0===t?void 0:t.typeKeywords)||[],...e.typeKeywords||[]]},Ue=async e=>{const{customParameters:t,agsType:r}=e,{type:i}=(0,f.g)(e.type),n=Object.assign(Object.assign({},e),{typeKeywords:Ce(e),type:i});if((null==t?void 0:t.length)>=1&&r){const{customParameters:e}=M(t);n.text=JSON.stringify({customParameters:e})}return(0,c.b)(n)};async function Re(e,t={},r){var n;try{const n=i.c.user,a=null!=r?r:`${n.userContentUrl}/items/${e}/status`,s=(null==t?void 0:t.jobId)?{jobId:t.jobId}:{};return await(0,p.p)(a,{requestParams:s})}catch(r){if(!(null===(n=r.statusMessage)||void 0===n?void 0:n.includes("Item status doesn't exist"))||!t.success)throw console.error(r),r;return{itemId:e,status:"status-not-found",lastUpdatedTime:0,submissionTime:0,recordCount:0}}}async function Fe(e,t){const r=s.i.folder,{user:n}=i.c;return async function(e,t,r,n){const{config:a}=i.c,s=r.id&&"/"!==r.id&&r.id!==e?`/${r.id}`:"",o=`${a.restBaseUrl}content/users/${e}${s}/items/${t}/addResources`;return(0,p.r)(o,n,{},"post")}(n.username,t,r,{fileName:"cloudProvider.json",text:JSON.stringify(e),access:"private"})}async function Ne(e){const{addResponseId:t,publishResponse:r,categories:i,portal:n}=e;try{const e=[t,null==r?void 0:r.id].filter((e=>e));i&&await(0,I.u)({portal:n,itemIds:e,categories:i}),await Re(r.id,{jobId:r.jobId});const a=r.serviceUrl,s=`${a.replace("rest/services","rest/admin/services")}/rebuildCache`,o=await(0,p.r)(s,{layers:0},{},"post");return await(0,c.u)(null==r?void 0:r.id,{properties:JSON.stringify({cacheJobId:o.jobId,cacheJobUrl:o.jobUrl}),id:null==r?void 0:r.id}),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}async function Ae(e){const{url:t,thumbnailURL:r,serviceInfo:n,extent:a}=e;if(r)return r;if(!["Map Service","Feature Service","Image Service"].includes(e.type))return null;if(["Map Service","Image Service"].includes(e.type)||-1!==t.indexOf("MapServer")){const e=X(a);return a?function(e){var t;let r,{visibleLayers:i,serviceUrl:n,serviceInfo:a,size:s,extent:o,bboxSR:l,imageSR:c,format:u}=e;if(!a)return"";let d=n.indexOf("/MapServer")>-1;if(!i&&d){let e;r=n.indexOf("/MapServer");const t=n.indexOf("?");t>-1?(e=n.substring(r+11,t),n=n.substring(0,r+10)+n.substring(t),i=e):(e=n.substring(r+11),n=n.substring(0,r+10),i=e)}!d&&a&&(d=a.capabilities?a.capabilities.toLowerCase().indexOf("map")>-1:a.supportedImageFormatTypes);let p=n;if(r=p.indexOf("?"),-1===r)if(d)p+="/export?";else{if(void 0!==a.currentVersion&&a.currentVersion>=10.1)return p+="/info/thumbnail",p;p+="/exportImage?"}else if(d)p=`${p.substring(0,r)}/export${p.substring(r,p.length)}&`;else{if(void 0!==a.currentVersion&&a.currentVersion>=10.1)return p=`${p.substring(0,r)}/info/thumbnail${p.substring(r,p.length)}`,p;p=`${p.substring(0,r)}/exportImage${p.substring(r,p.length)}&`}p+=`size=${s}&bbox=${o}`,(null==l?void 0:l.length)>0&&(p+=`&bboxSR=${l}`);(null==c?void 0:c.length)>0&&(p+=`&imageSR=${c}`);d&&(null===(t=null==a?void 0:a.supportedImageFormatTypes)||void 0===t?void 0:t.indexOf("PNG32"))>-1?p+=`&format=png32&f=${u}`:p+=d?`&format=png24&f=${u}`:`&format=jpgpng&f=${u}`;d?(null==i?void 0:i.length)>0&&(p+=`&layers=show:${i}`):p+="&interpolation=RSP_NearestNeighbor&bandIds=null";return p}({serviceUrl:t,extent:e,size:"800,532",format:"image",serviceInfo:n}):null}const{result:s,error:o}=await async function(e){var t;const{config:r,portal:n,api:a}=i.c;if(4===a)return{result:await De(e.id,n)};const[s,o]=await(0,v.l)(["esri/layers/FeatureLayer","esri/geometry/Extent"]),{serviceInfo:l,username:c,password:u,isSecured:d}=e,p={baseMap:r.defaultBasemap||r.self.defaultBasemap,operationalLayers:[]};p.baseMap.title="basemap";const m=p.baseMap.baseMapLayers.length;for(let e=0;e<m;e++){let t=p.baseMap.baseMapLayers[e];if(!t.isReference){!r.allSSL&&"https:"!=location.protocol||!(0,y.a)(t.url)&&!(0,y.b)(t.url)||(t.url=t.url.replace("http:","https:")),t.visibility=!1,p.baseMap.baseMapLayers=[t];break}}if(!l)return{result:""};const f=l.layers||[],g=e.url,h=await(0,y.c)(g),w=d.secured?await Qe(h.path,{username:c,password:u}):null;f.reverse().forEach((async t=>{const r={url:`${g}/${t.id}${w?`?token=${w}`:""}`,id:`${e.id||Math.random()}_${t.id}`,opacity:1,title:`${e.title||"title"}_${t.id}`,visibility:!0,layerDefinition:void 0};let i=!1;f.forEach((e=>{e.id!==t.id||i||(i=!0,r.layerDefinition=e.layerDefinition)})),(!f.length||f.length&&i)&&p.operationalLayers.push(r)}));let b=[[-180,-90],[180,90]];if("string"==typeof e.extent){const t=e.extent.split(",");b=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]]}else(null===(t=e.extent)||void 0===t?void 0:t.length)>0&&(b=e.extent);if(1===p.operationalLayers.length){let e=new s(p.operationalLayers[0].url);return new Promise((t=>{e.on("load",(async r=>{(null==r?void 0:r.layer)&&(e=r.layer);const i=await z(e,b);try{const e=await W(p,i);t({result:e})}catch(e){t({error:{code:"unhandledError",message:e}})}}))}))}{const t=e.extent,r=H(new o(t[0][0],t[0][1],t[1][0],t[1][1]),200),i=[],n=[],a=[];p.operationalLayers.forEach((e=>{const t=new s(e.url),o=new Promise((a=>{t.on("load",(t=>{i.push(e),n.push(t),t.minScale<=r&&t.maxScale>r?a(!0):a(!1)})),t.on("error",(()=>{a(!1)}))}));a.push(o)}));const l=await Promise.all(a);p.operationalLayers=i;const c=l.filter((e=>e)).length>0;try{if(!c&&n.length>0){const e=await z(n[0],t);return{result:await W(p,e)}}return{result:await W(p,t)}}catch(e){return{error:{code:"unhandledError",message:e}}}}}(e);return o?(console.error("Error generating thumbnail",o),""):s}async function De(e,t){var r,i,a;const[s,o,l,c,u,d,p,m]=await(0,v.l)(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/Basemap","esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/smartMapping/heuristics/scaleRange"]);try{const v=N(800,532),y=t.defaultBasemap.id.includes("basemap"),f=new l({portalItem:{id:e,portal:t}}),g=new s({basemap:y?"topo-vector":new c({portalItem:{id:t.defaultBasemap.id,portal:t}})}),h=new o({map:g,container:v});await g.watch("loaded");let w=0,b=0;y||({minScale:w,maxScale:b}=await m({layer:f,view:h}));const S=await f.queryExtent();h.goTo(S.extent),f.minScale=w,f.maxScale=b,h.map.add(f),h.scale=b,await(0,n.t)(2e3);const x=null!==(a=null===(i=null===(r=t.helperServices)||void 0===r?void 0:r.printTask)||void 0===i?void 0:i.url)&&void 0!==a?a:"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",O=new p({view:h,template:new d({format:"png32",exportOptions:{dpi:96,width:800,height:532},layout:"map-only",showLabels:!1,attributionVisible:!1})}),I=await u.execute(x,O);return F(),I.url}catch(e){return F(),null}}function We(e){const t=(0,y.d)(e),r=(0,a.p)(e),i=t.replace(a.v,"").match(a.h);let n=null==r?void 0:r.serverType,s=null==r?void 0:r.index;const o={mapserver:"MapServer",geocodeserver:"GeocodeServer",gpserver:"GPServer",geometryserver:"GeometryServer",geoenrichmentserver:"GeoenrichmentServer",imageserver:"ImageServer",naserver:"NAServer",featureserver:"FeatureServer",geodataserver:"GeoDataServer",globeserver:"GlobeServer",wmserver:"WMServer",sceneserver:"SceneServer",vectortileserver:"VectorTileServer",streamserver:"StreamServer",videoserver:"VideoServer"};return n&&o[n.toLowerCase()]&&(n=o[n.toLowerCase()]),("ags"===n||!n&&i)&&(n="MapServer"),"MapServer"===n&&null!==s?"FeatureServer":n}async function Ge(e){var t;const{config:r}=i.c,{checkAuth:n,storeAuth:s,username:o,password:l}=e;var c;e.title=(c=e.url,(0,a.p)((0,y.d)(c)).serverName);const u=We(e.url);if(!u||"SceneServer"===u&&!r.sceneViewerEnabled)return{error:{code:"unknownAGSType"}};let d=null===(t=h.a[u])||void 0===t?void 0:t.type;d||console.warn(`Unknown AGS Type ${u}`),e.type=d,e.agsType=u;try{if(!i.c.user)return{result:await _e(e)};const t=await Be({username:o,password:l},e.url,(0,a.g)(i.c.portal),n),r=null==t?void 0:t.allowStoredAuth;if(!1===r&&(e.allowStoredAuth=!1),t.secured){e.isSecured=Object.assign({},t),e.allowStoredAuth=!1;const o=await async function(e,t,r){var n,s;if(499===(null==t?void 0:t.httpStatusCode)){const[t]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{url:o,password:l,username:c}=e;let u=null===(n=(await t._getTokenSvcUrl(o)).authInfo)||void 0===n?void 0:n.tokenServicesUrl;if(u){"/"!==u[u.length-1]&&(u+="/");try{const e=await Be({password:l,username:c},null!=u?u:"",(0,a.g)(),r);return(null==e?void 0:e.secured)&&401===(null==e?void 0:e.httpStatusCode)}catch(e){return(null===(s=null==e?void 0:e.message)||void 0===s?void 0:s.indexOf("Http StatusCode: -1"))>-1&&-1}}}return!1}({username:e.username,password:e.password,url:e.url},t,n);if(o||401===t.httpStatusCode){if(-1===o){const r=Object.assign(Object.assign({},e),{isSecured:null,checkUrlError:!0,storeAuth:!1});return{result:await _e(r,{useProxy:t.useProxy})}}{const r=Object.assign(Object.assign({},e),{isSecured:{httpStatusCode:401,isFederatedWithWebTierAuth:o}});return{result:await _e(r,{useProxy:t.useProxy})}}}return e.isSecured=Object.assign(Object.assign({},t),{isFederatedWithWebTierAuth:o}),!1!==r&&(e.allowStoredAuth=!0),t.isOverride&&("GeoenrichmentServer"!==u||e.storeAuth?e.storeAuth=!0:e.createAsServiceProxy=!0),n&&!s?{result:await _e(e,{useProxy:t.useProxy})}:{result:e}}return{result:await _e(e,{useProxy:t.useProxy})}}catch(t){if((0,g.b)(t)){const e=t.code;if("flowAborted"===e||"unauthorized"===e||"invalidSpatialRef"===e)return{error:t}}try{const r=Object.assign(Object.assign({},e),{isSecured:e.isSecured||null,checkUrlError:t,storeAuth:!1});return{result:await _e(r)}}catch(e){return(0,g.b)(e)?{error:e}:{error:{code:"unhandledError",message:JSON.stringify(e)}}}}}let Je=3;async function _e(e,t,r=0){var a,l,c,u,d,f,h,w,b,S,x,O,I,T,L,P,$,k;const{url:j=e.url,useProxy:M=!1}=null!=t?t:{},[E]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{username:C,password:U,checkAuth:R,agsType:F}=e,{tags:N=[]}=s.i||{},A=[499,498],D=(0,y.d)(j);if(!e.isSecured||401!==(null===(a=e.isSecured)||void 0===a?void 0:a.httpStatusCode)&&R||(null===(l=e.checkUrlError)||void 0===l?void 0:l.message)&&e.isSecured&&(0,m.i)(e.type))try{const t=await He({username:C,password:U},D,{isSecure:e.isSecured,isVideoService:"Video Service"===e.type,checkAuth:R,useProxy:M});"Image Service"===e.type&&t.tileInfo&&("LERC"===t.tileInfo.format||"elevation"===(null===(c=t.cacheType)||void 0===c?void 0:c.toLowerCase())?e.agsType="ElevationServer":"raster"===(null===(u=t.cacheType)||void 0===u?void 0:u.toLowerCase())&&(e.agsType="TiledImageServer",ze(j,t)&&"TiledImageServer"!==o.a.hybridImageServiceSetting&&(e.agsType="ImageServer")));const r=t.credential||E.findCredential(j),i=t.documentInfo,a=((null==i?void 0:i.Keywords)||"").split(","),s=null!==(d=null==i?void 0:i.Title)&&void 0!==d?d:t.name;return e.tags=(0,n.b)([...a,...N]).filter((e=>e)),(null==s?void 0:s.length)>0&&(e.title=s),e.description=null!==(h=null!==(f=null==i?void 0:i.Comments)&&void 0!==f?f:t.description)&&void 0!==h?h:"",e.snippet=null!==(b=null!==(w=null==i?void 0:i.Subject)&&void 0!==w?w:t.serviceDescription)&&void 0!==b?b:"",e=Object.assign(Object.assign({},e),{thumbnailToken:(null==r?void 0:r.token)||null,extent:e.extent||t.fullExtent||t.extent,serviceInfo:Object.assign(Object.assign({},t),{isSecure:!!R,userInfo:{username:C,password:U}})}),Object.assign({},e)}catch(i){if((null===(S=null==i?void 0:i.message)||void 0===S?void 0:S.toLowerCase().includes("aborted"))||"Error: json"===(null==i?void 0:i.message))throw{code:"flowAborted",message:JSON.stringify(i.message.message)};if(A.includes(null!==(x=null==i?void 0:i.code)&&void 0!==x?x:null===(O=null==i?void 0:i.details)||void 0===O?void 0:O.httpStatus))return!1!==e.allowStoredAuth&&(e.allowStoredAuth=!e.checkUrlError),Object.assign(Object.assign({},e),{isSecured:{secured:!0},serviceInfo:{isSecure:!0},allowStoredAuth:!1!==e.allowStoredAuth&&o.a.allowStoredAuth});if(403===(null==i?void 0:i.code))throw e.serviceInfo={isSecure:!0},e.isSecured={secured:!0},{code:"forbiddenCredential",message:JSON.stringify(i)};if(i&&(null===(I=e.checkUrlError)||void 0===I?void 0:I.message)){if(null===(P=null===(L=null===(T=e.checkUrlError)||void 0===T?void 0:T.message)||void 0===L?void 0:L.includes)||void 0===P?void 0:P.call(L,"was not found"))throw{code:"serviceNotExist",message:JSON.stringify(e.checkUrlError.message)};throw{code:"unhandledError",message:JSON.stringify(e.checkUrlError.message)}}if(F&&"FeatureServer"!==F||"string"==typeof i&&i.includes("not found"))throw{code:"serviceNotExist",message:JSON.stringify(i)};if((0,g.a)(i)&&"The input spatial reference must be either a geographic or projected coordinate system"===i.details[0])throw{code:"invalidSpatialRef",message:JSON.stringify(i)};if(r<Je)return await(0,n.t)(1e3*r),_e(e,t,r+1)}else if((null===($=e.isSecured)||void 0===$?void 0:$.isFederatedWithWebTierAuth)||401===(null===(k=e.isSecured)||void 0===k?void 0:k.httpStatusCode))try{const{title:t}=e,r=await(0,p.r)(e.url,{},{addTokenManually:!1}),i=(r.documentInfo.Keywords||"").split(","),a=[...(0,n.b)([...i,...N])];return e=Object.assign(Object.assign({},e),{extent:r.fullExtent||r.extent,serviceInfo:r}),Object.assign(Object.assign({},e),{title:t,tags:a})}catch(e){if(401===e.status)throw{code:"unauthorized"};throw{code:"serviceNotExist",message:JSON.stringify(e)}}}async function Ke(e){const{serviceInfo:t,username:r,password:n,isSecured:a,storeAuth:s,type:o}=e,{user:l,portal:c,config:u}=i.c,d=o,v={username:r,password:n},{thumbnailURL:m}=(0,f.g)(d),g=Object.assign(Object.assign({},e),{thumbnailURL:m||e.thumbnailURL});if((null==t?void 0:t.isSecure)&&!t.userInfo||(null==a?void 0:a.isOverride)&&!v||401!==(null==a?void 0:a.httpStatusCode)&&!v||s&&!v)throw new Error("invalidCredentials");if(a&&s){if(!(!c.isPortal||c.isPortal&&(0,y.e)()))throw new Error;if(g.serviceUsername=r,g.servicePassword=n,401===a.httpStatusCode){const e=await Le(g,null==u?void 0:u.restBaseUrl).then((({id:e})=>(0,p.r)(`${l.userContentUrl}/items/${e}`,{},{},"post")));return Ve(Object.assign(Object.assign({},g),{id:e.item.id,url:e.item.url,sourceUrl:e.item.sourceUrl}),!0)}if((null==t?void 0:t.isSecure)&&!(null==t?void 0:t.userInfo))throw new Error("invalidCredentials")}return Ve(g)}async function Ve(e,t=!1){var r,n,a,s,l;const{url:u,serviceInfo:d,type:v,storeAuth:m,hybridImageServiceSetting:y,id:g}=e;let w;if(!d&&!m)throw new Error("serviceNotExist");if(m&&!d){Je=15;const t=await _e(e);return Je=3,Object.assign(Object.assign({},t),{success:!0,id:g,folder:null===(r=e.folder)||void 0===r?void 0:r.title})}const b=Object.assign(Object.assign({},e),{description:(null==d?void 0:d.description)||(null===(n=null==d?void 0:d.documentInfo)||void 0===n?void 0:n.Comments)||"",accessInformation:(null==d?void 0:d.copyrightText)||(null===(a=null==d?void 0:d.documentInfo)||void 0===a?void 0:a.Credits)||"",spatialReference:K(e.serviceInfo,e.agsType)});if("map service"===(null==v?void 0:v.toLowerCase())&&b.typeKeywords.push((null==d?void 0:d.singleFusedMapCache)?"Tiled":"Dynamic"),("Image Service"===v&&"TiledImageServer"===y||function(e,t){var r,i;return(null===(r=e.toLowerCase())||void 0===r?void 0:r.includes("/imageserver"))&&(null===(i=null==t?void 0:t.capabilities)||void 0===i?void 0:i.toLowerCase().includes("tilesonly"))}(u,d))&&(b.typeKeywords=h.a.TiledImageServer.typeKeywords),"Table"===(null==d?void 0:d.type)&&(b.typeKeywords=[...b.typeKeywords,"Table","Singlelayer"]),v in{StreamServer:1,ImageServer:1,WorkspaceServer:1}?b.typeKeywords.push("Singlelayer"):((null==d?void 0:d.layers)||(null==d?void 0:d.tables))&&(d.layers&&(null===(s=null==d?void 0:d.layers)||void 0===s?void 0:s.length)||!(null==d?void 0:d.tables.length)?(w=[...d.layers||[],...d.tables||[]],b.typeKeywords.push(w.length>1?"Multilayer":"Singlelayer")):(-1===b.typeKeywords.findIndex((e=>"Table"===e))&&b.typeKeywords.push("Table"),b.typeKeywords.push(d.tables.length>1?"Multilayer":"Singlelayer"))),"sceneserver"===(null==v?void 0:v.toLowerCase())){const{layers:e}=d,t=(null===(l=null==e?void 0:e[0])||void 0===l?void 0:l.layerType)||(null==d?void 0:d.layerType);t&&b.typeKeywords.push(t)}try{const{extent:e}=await async function(e){const{extent:t}=e;return e.extent=X(await V(t)),e}(Object.assign({},b)),r=b,n=(0,f.g)(r.type);if(r.type=n.type,r.typeKeywords=[...r.typeKeywords||[],...n.typeKeywords||[]],!m){const t=X(r.extent).split(","),i=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];r.extent=i;const n=await Ae(r);r.thumbnailURL=n,r.thumbnailURL&&r.thumbnailToken&&(r.thumbnailURL+=`${r.thumbnailURL.indexOf("?")>-1?"&":"?"}${r.thumbnailToken}`),r.extent=X("Feature Service"===r.type||"Image Service"===r.type?e:r.extent)}return m?async function(e){const{user:t}=i.c,{exportTilesAllowed:r}=o.a,n=await Ue(e),a=`${t.userContentUrl}/items/${n.id}`,{item:s}=await(0,p.r)(a,{},{},"post"),l=r?e.url:s.url,u=await _e(Object.assign(Object.assign({},e),{type:o.a.type}),l),{typeKeywords:d,thumbnailToken:v,spatialReference:m,extent:y,description:f}=u;e.id=n.id,e.typeKeywords=d,e.thumbnailToken=v,e.spatialReference=m,e.extent=y,e.description=f;try{const t=X(u.extent).split(","),r=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];e.extent=r;const i=await Ae(e);s.thumbnailURL=i,s.thumbnailURL&&s.thumbnailToken&&(s.thumbnailURL+=`${s.thumbnailURL.indexOf("?")>-1?"&":"?"}${s.thumbnailToken}`)}catch(e){console.error(e)}return await(0,c.u)(n.id,{thumbnailURL:s.thumbnailURL}),n}(r):t?(0,c.u)(r.id,Object.assign(Object.assign({},r),{url:r.sourceUrl})):Ue(r)}catch(t){if(m)throw t;return Ue(e)}}const qe=["geocode.arcgis.com","geocodedev.arcgis.com","geocodeqa.arcgis.com","route.arcgis.com","routedev.arcgis.com","routeqa.arcgis.com","geoenrich.arcgis.com","geoenrichqa.arcgis.com","geoenrichddev.arcgis.com"];async function Be(e,t,r,i,n=!1){const a=t.split("?")[0],s=`${r}portals/checkurl`,l=qe.some((e=>-1!==t.indexOf(e)));if(l)return{secured:!0,isOverride:!0};{const c=!l&&t.indexOf("/VectorTileServer")>-1,u=`${s}?url=${encodeURIComponent(`${T(`${a}?f=json`)}`)}`;try{n&&await(0,p.r)(a,{},{disableIdentityLookup:!0,addTokenManually:!1});const s=await(0,p.r)(u,{},{addTokenManually:!1}),{httpStatusCode:l}=s;if(s.secured)403===l?s.secured=!1:401===l&&(s.allowStoredAuth=!1);else if(c){const n=await He({username:e.username,password:e.password},t,{isVideoService:!1,checkAuth:i});if(o.a.exportTilesAllowed=null==n?void 0:n.exportTilesAllowed,null==n?void 0:n.exportTilesAllowed)return Be(e,`${t}/exportTiles`,r,i)}return Object.assign(Object.assign({},s),{isOverride:!1})}catch(a){const{message:s,code:o}=a;return"Error checking resource"===s?n?{secured:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:s,isOverride:!1,allowStoredAuth:!1}:Be(e,t,r,i,!0):"Service Proxy URL"===s?{secured:!0,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:s,isOverride:!1,allowStoredAuth:!1,useProxy:!0}:{allowStoredAuth:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:s,isOverride:!1}}}}function ze(e,t){var r;return e.toLowerCase().indexOf("/imageserver")>-1&&"Raster"===(null==t?void 0:t.cacheType)&&-1===(null===(r=null==t?void 0:t.capabilities)||void 0===r?void 0:r.toLowerCase().indexOf("tilesonly"))}async function He(e,t,r){var n;const a=i.c.config,[s]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{forceAddToken:o,isSecure:l,checkAuth:c}=r,{username:u,password:d}=e,p="auto",m=(0,y.a)(t),f=t.indexOf(".esri.com/server/rest/services")>-1;const g=m||f,h=qe.some((e=>-1!==t.indexOf(e))),w={useProxy:null!==(n=null==r?void 0:r.useProxy)&&void 0!==n&&n,timeout:!1===a.isMultiTenant?6e4:5e3,addSSL:g,addTokenManually:l&&g&&!!a.isMultiTenant||o||!1,disableIdentityLookup:null};if(c){if(t=t.split("?")[0],h)return await Xe(t,{username:u,password:d}),et(t,w,p);{(null==l?void 0:l.secured)&&u&&d&&(w.customToken=await Qe(t,{username:u,password:d}));const e=await et(t,w,p);return e.credential=s.findCredential(t),e.credential&&s.registerToken({server:t,token:e.credential.token,userId:e.credential.userId,expires:e.credential.expires,ssl:e.credential.ssl}),e}}return w.disableIdentityLookup=!0,await et(t,w,p)}const Qe=async(e,{username:t,password:r})=>{const{token:i}=await(0,p.f)((()=>Xe(e,{username:t,password:r})),"securedAGSToken",`${e}---${t}`,{getExpireAfterFromResult:e=>e.expireAfter});return i};async function Xe(e,t){const r=3===i.c.api,[n,a]=await(0,v.l)([r?"esri/IdentityManager":"esri/identity/IdentityManager",r?"esri/Credential":"esri/identity/Credential"]);if(t.username&&t.password){const r=await async function(e){const t=3===i.c.api,[r,n]=await(0,v.l)([t?"esri/IdentityManager":"esri/identity/IdentityManager",t?"esri/ServerInfo":"esri/identity/ServerInfo"]);let a=await r.findServerInfo(e);if(!a){a=new n,a.server=await r._getOrigin(e);const{authInfo:i,tokenServiceUrl:s,currentVersion:o}=await(t?Ze:Ye)(e,r);a.tokenServiceUrl=(null==i?void 0:i.tokenServicesUrl)||(null==i?void 0:i.tokenServiceUrl)||s,a.currentVersion=o,a.hasServer=!0,r.registerServers([a])}return a}(e);if(n._checkProtocol(e,r,(e=>console.error(e))))try{const i=await n.generateToken(r,t),s=i.expires?Number(i.expires):null,o=!!i.ssl,l=new a({userId:t.username,server:r.server,token:i.token,expires:s,ssl:o,validity:r.shortLivedTokenValidity,resources:[e],scope:"server"});return-1===n.credentials.indexOf(l)&&n.credentials.push(l),{token:l.token,expireAfter:s}}catch(e){throw e.code=403,e}return null}}const Ye=async(e,t)=>{const r=await t._getTokenSvcUrl(e);return await r.promise},Ze=async(e,t)=>t._getTokenSvcUrl(e);async function et(e,t,r="post"){try{return await(0,p.r)(T(e),{},Object.assign({},t),r)}catch(e){throw e}}async function tt(e){var t,r;let i={};if((0,m.i)(e.type))i=await Ge(e);else switch(e.type){case"OGCFeatureServer":i=await async function(e){var t,r,i,n;const{url:a}=e,s={addTokenManually:!1,headers:{accept:"application/json"}};try{const o=async(e,t)=>{var r,i,n;try{return await e()}catch(e){const a=null!==(n=null===(i=null===(r=null==e?void 0:e.message)||void 0===r?void 0:r.toLowerCase)||void 0===i?void 0:i.call(r))&&void 0!==n?n:"";if(a.includes("unexpected token")||a.includes("expected expression"))return t();throw{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}},l=await o((()=>(0,p.r)(a,{},s,"auto",{excludeJson:!0})),(()=>(0,p.r)(a,{},s))),c=await o((()=>Ie(l)),(()=>Ie(l,{},!1)));return{result:Object.assign(Object.assign({},e),{extent:X(null===(n=null===(i=null===(r=null===(t=c.collections)||void 0===t?void 0:t[0])||void 0===r?void 0:r.extent)||void 0===i?void 0:i.spatial)||void 0===n?void 0:n.bbox),type:"OGCFeatureServer",serviceInfo:c,layers:c.collections}),error:null}}catch(e){return console.error("get OGC feature layer:",e),{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}}(e);break;case"WMS":const{result:n,error:a}=await de(e);if(a)i.error=a;else{const e=await pe(n.serviceInfo);i.result=Object.assign(Object.assign({},n),e)}break;case"WFS":i=await we(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(t=i.result.serviceInfo.title)&&void 0!==t?t:"",i.result.isComplex="esriGeometryComplex"===i.result.serviceInfo.isComplex);break;case"WMTS":i=await Se(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(r=i.result.serviceInfo.title)&&void 0!==r?r:"");break;default:i={result:Object.assign({},e)}}return i}async function rt(e,t){var r,i;const n=Object.assign({},e),{config:a,user:s,asyncAddToDefinition:o=!0}=t,l={layers:null!==(r=n.layers)&&void 0!==r?r:[],tables:null!==(i=n.tables)&&void 0!==i?i:[]},u=JSON.stringify(l);delete n.layers,delete n.tables,delete n.initialExtent,delete n.fullExtent,delete n._ssl;const d={createParameters:JSON.stringify(n),targetType:"featureService"},v=`${a.restBaseUrl}content/users/${s.username}/createService`,m=await(0,p.r)(v,d,{},"post");try{return await it(u,m.encodedServiceURL,o),{createServiceResponse:m,addToDefinitionResponse:l}}catch(e){throw await(0,c.d)(m.itemId,{permanentDelete:!0},s),console.error(e),e}}async function it(e,t,r=!0){if(e){const i=`${t.replace("rest/services","rest/admin/services")}/addToDefinition`;try{const t=await(0,p.r)(i,{addToDefinition:e,async:r},{},"post");return r?await(0,p.p)(t.statusURL):t}catch(i){throw r&&await it(e,t,!1),i}}return null}function nt(e,t){const r=`${(0,a.g)(t)}content/items/${e.id}/data`;return(0,p.r)(r)}async function at(e){var t,r;const i=null===(t=(await(0,d.q)({q:'title: "Esri Layer Templates" AND owner: "esri_en"',num:1})).results)||void 0===t?void 0:t[0];if(!i)return null;const n=null===(r=(await(0,p.r)(`${(0,a.g)(e)}/search`,{q:`title:"Points" group:"${i.id}" AND type:"Layer Template" -type:"Attachment"`,num:1})).results)||void 0===r?void 0:r[0];return n?nt(n,e):null}var st=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r};const ot={currentVersion:10.51,hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!1,maxRecordCount:2e3,supportedQueryFormats:"JSON",supportsVCSProjection:!1,capabilities:"Query,Editing,Create,Update,Delete,Sync",description:"",copyrightText:"",allowGeometryUpdates:!0,units:"esriMeters",supportsAppend:!0,syncEnabled:!1,supportsApplyEditsWithGlobalIds:!1,editorTrackingInfo:{allowAnonymousToDelete:!0,allowAnonymousToQuery:!0,allowAnonymousToUpdate:!0,allowOthersToDelete:!1,allowOthersToQuery:!0,allowOthersToUpdate:!0,enableEditorTracking:!1,enableOwnershipAccessControl:!1},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},_ssl:!0},lt=async e=>{var t,r,n;const{tags:a,serviceInfo:l,typeKeywords:d,extent:p,selectedServiceInfoLayersNames:v,addFeatureLayerType:m,layerData:y}=e,{portal:f}=i.c,g=f.isPortal;if(!l)throw new Error("No service info found.");try{let e=ot;try{e=null!==(t=await at(f))&&void 0!==t?t:ot,e.capabilities="Query,Editing,Create,Update,Delete",e.hasStaticData=!1}catch(e){console.warn(`Could not fetch template ${JSON.stringify(e)}`)}const h=l;let w=null!==(r=h.layers)&&void 0!==r?r:[],b=null!==(n=h.tables)&&void 0!==n?n:[];if("build"!==m&&v){const e=e=>v[e.name];w=w.filter(e),b=b.filter(e)}const{layers:S,tables:x}=dt(w,b),{layers:O,tables:I}=pt(S,x),T=Object.assign(Object.assign(Object.assign({},e),l),{name:h.name||s.i.title,layers:O,tables:I}),{cleanedCreateParameters:L,relationshipParameters:P}=ut(T);["serviceDescription","hasStaticData","maxRecordCount","supportedQueryFormats","capabilities","description","copyrightText","spatialReference","initialExtent","fullExtent","_ssl","allowGeometryUpdates","units","xssPreventionInfo"].forEach((e=>{const t=h[e];null!=t&&(L[e]=t)})),L.name=(0,u.a)(L.name),"template"===m&&(L.syncEnabled=!0,L.capabilities="Query,Editing,Create,Update,Delete,Sync");const{createServiceResponse:$}=await rt(L,{asyncAddToDefinition:!g,config:i.c.config,user:i.c.user}),{itemId:k,success:j}=$,{typeKeywords:M}=(await(0,c.a)(k)).result,E=[...d,...M];l.captureGPS&&E.push("gpsMetadataEnabled");try{const e=f.defaultExtent||l.fullExtent||l.extent||p,t=e.spatialReference.wkid||e.spatialReference.wkt||"4326",r=X((e=>{const t=(e,t,r)=>e>=t&&e<=r;return t(e.ymax,-90,90)&&t(e.ymin,-90,90)&&t(e.xmax,-180,180)&&t(e.xmin,-180,180)&&e.ymax>e.ymin&&e.xmax>e.xmin})(e)?e:await V(e)),i=`https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/export?size=800,532&format=png24&bboxSR=${t}&bbox=${X(e)}&f=image`,n=s.i.folder;return await Promise.all([(0,c.u)(k,Object.assign({title:s.i.title,typeKeywords:E.join(","),tags:(null!=a?a:s.i.tags).join(","),extent:r,snippet:s.i.snippet,description:o.a.description},y?{text:JSON.stringify({layers:y.layers,tables:y.tables})}:{})),P.layers||P.tables?it(JSON.stringify(P),$.encodedServiceURL,!g):void 0,!(0,c.n)(n)&&(0,c.m)(k,n.id)]),(0,c.u)(k,{thumbnailURL:i}).catch(console.error),{success:j,id:k,folder:s.i.folder.id}}catch(e){throw(0,c.d)(k,{permanentDelete:!0}),console.error(e),e}}catch(e){throw console.error(e),e}},ct=async(e,t,r,i)=>{var n;const{username:s,password:l,checkAuth:c}=o.a;try{const t=e=>He({username:s,password:l},e,{forceAddToken:r,isSecure:i,isVideoService:!1,checkAuth:c}),n=(0,a.p)(e);if(!n)return console.warn("invalid service info"),null;const{baseServerUrl:o,index:u}=n,d=await t(o),p=await Promise.all((d.layers||[]).filter((e=>null===u||e.id===u)).map((e=>t(`${o}/${e.id}`))));return{serviceInfo:d,layers:p,tables:await Promise.all((d.tables||[]).filter((e=>null===u||e.id===u)).map((e=>t(`${o}/${e.id}`))))}}catch(r){if(console.error(r),"token required"===(null===(n=r.message)||void 0===n?void 0:n.toLowerCase()))try{const{secured:r}=await Be({username:s,password:l},e,t,c);return await ct(e,t,r)}catch(e){throw e}throw r}},ut=e=>{const t={},r=e=>t[e.id]=!0;e.layers.forEach(r),e.tables.forEach(r);const i=e=>t[e.relatedTableId],n=e=>({relationships:e.relationships.filter(i),id:e.id}),a=e=>{var t;return(null===(t=e.relationships)||void 0===t?void 0:t.length)>0},s={layers:e.layers.map(n).filter(a),tables:e.tables.map(n).filter(a)};0===s.layers.length&&delete s.layers,0===s.tables.length&&delete s.tables;const o=e.layers.map((e=>st(e,["relationships"]))),l=e.tables.map((e=>st(e,["relationships"])));return{relationshipParameters:s,cleanedCreateParameters:Object.assign(Object.assign({},e),{layers:o,tables:l})}},dt=(e,t)=>{const r=e=>Object.assign(Object.assign({},e),{indexes:(0,n.u)(e.indexes,(e=>e.name))});return{layers:e.map(r),tables:t.map(r)}},pt=(e,t)=>{let r=(0,l.c)(e,t);const i={};return r=r.map(((e,t)=>{i[e.id]=t;return Object.assign(Object.assign({},e),{id:t})})),r.forEach((e=>{var t;e.relationships=(null!==(t=e.relationships)&&void 0!==t?t:[]).map((e=>{const t=e.relatedTableId,r=i[t];return Object.assign(Object.assign({},e),{relatedTableId:r})}))})),r.reduce(((e,t)=>("Table"===t.type?e.tables.push(t):e.layers.push(t),e)),{layers:[],tables:[]})}},73596:(e,t,r)=>{r.d(t,{a:()=>a,f:()=>c,g:()=>l,s:()=>s,v:()=>o});var i=r(86537),n=r(46227);function a(e,t){const r=/(?:\.([^.]+))?$/;let i=null==e?void 0:e.replace(/^.*(\\|\/|:)/,""),a=i&&r.exec(i)[1]?r.exec(i)[1].toLowerCase():"",s="";if(i.indexOf(".rft.")>-1){const[e,t]=i.split(".rft.");a=`rft.${t}`,s=e}return i&&!s&&(s=-1===i.lastIndexOf(".")?i:i.substring(0,i.lastIndexOf("."))),s=s.replace(/\.|-/g,"_"),t&&(s=function(e){return`${e}_${(0,n.g)()}`}(s),i=`${s}.${a}`),{title:s,fileName:i,extension:a}}function s(e,t){return a(e.name,!!t)}function o(e,t){let r=e;const i=e.lastIndexOf("\\");return i>-1&&(r=r.substring(i+1,r.length)),r.replace(/\ /g,"_")===t.replace(/\ /g,"_")}function l(e){return i.a[e]?i.a[e]:i.a[Object.keys(i.a).find((t=>i.a[t].type===e))]}function c(e){if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,t))} ${["B","KB","MB","GB","TB"][t]}`}},59673:(e,t,r)=>{r.d(t,{a:()=>n,g:()=>a});var i=r(94788);const n=(e,t)=>(0,i.a)(`${(0,i.g)(e)}community/groups/${t.id}`),a=(e,t)=>`${((e,t)=>(0,i.a)(`${(0,i.g)(e)}content/groups/${t.id}`))(e,t)}search`},66488:(e,t,r)=>{r.d(t,{a:()=>p,b:()=>u,c:()=>o,d:()=>l,e:()=>v,f:()=>a,g:()=>d,h:()=>s,i:()=>m,q:()=>c});var i=r(46581),n=r(94788);function a(e){var t;return"ArcGISEnterpriseOnKubernetes"===(e.portalDeploymentType||(null===(t=e.sourceJSON)||void 0===t?void 0:t.portalDeploymentType))}function s(e){var t,r;return e.isPortal?"modern"===(null===(r=e.portalProperties)||void 0===r?void 0:r.homePage)||function(e){var t;return e.isPortal&&"modernOnly"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)}(e):"modern"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)||function(e){const t=new Date("June 30, 2020").getTime();return!e.isPortal&&e.created>=t}(e)}async function o(e){try{return{result:await(0,i.f)((()=>(0,i.r)(`${(0,n.g)(e)}portals/self/resources/home.page.json`)),"homePageConfig",e.id)}}catch(e){return{result:void 0}}}async function l(e){return(0,i.f)((()=>(0,i.r)(`${(0,n.g)(e)}portals/self/userDefaultSettings`)),"memberDefaults",e.id)}async function c(e={},t){return(0,i.r)(`${(0,n.g)(t)}/community/groups`,e)}const u=async(e,t)=>{var r;if(!e)return[];const a=`${(0,n.a)(null!==(r=t.restUrl)&&void 0!==r?r:t.portalUrl)}portals/self/servers`,s=await(0,i.f)((()=>(0,i.r)(a)),"selfServers",t.id);return null==s?void 0:s.servers},d=e=>p((0,n.c)(e)),p=e=>{var t;const r=`${(0,n.a)(null!==(t=(0,n.b)(e))&&void 0!==t?t:e)}info`;return(0,i.f)((()=>(0,i.r)(r,{},{addTokenManually:!1})),"portalInfo",r)};async function v(e,t){return!e.isPortal||await m(e,t)}async function m(e,t){if(!t||!e)return!1;if(!e.isPortal)return!0;const{result:r,error:n}=await(0,i.f)((()=>y(e,t)),"isPortalBackedBySDS",e.id);return!n&&r}const y=async(e,t)=>{if(e.isBackedBySDS)return{result:!0};if(!e.isPortal)return{result:!0};try{return{result:!!await f(t,e)}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)},result:!1}}},f=async(e,t)=>{var r;return(null!==(r=await u(e,t))&&void 0!==r?r:[]).filter((e=>e.isHosted))[0]}},59296:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>v,c:()=>p,d:()=>d,e:()=>m,f:()=>f,g:()=>y,h:()=>T,i:()=>c,j:()=>l,k:()=>g,l:()=>k,m:()=>w,n:()=>b,o:()=>I,p:()=>x,q:()=>S,r:()=>O,s:()=>P,t:()=>u,u:()=>L,v:()=>s,w:()=>o});var i=r(2174);const n=e=>{var t,r,i;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(r=null!==(t=null==e?void 0:e.roleId)&&void 0!==t?t:null==e?void 0:e.id)&&void 0!==r?r:null===(i=null==e?void 0:e.sourceJSON)||void 0===i?void 0:i.id};function a(e){return e&&!e.orgId}function s(e,t){return(0,i.u)(e,t)||"update"===e.itemControl||(0,i.c)([e],t)&&p(t)}function o(e,t){const r=(0,i.c)([e],t),n=(0,i.u)(e,t)||p(t)&&r,a=m(t)&&h(t);return!!(n||r&&a)}const l=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:manageLicenses"))};function c(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function u(e){return["Developer Subscription"].includes(null==e?void 0:e.type)}const d=e=>{var t;return null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.includes("Developer")};function p(e){return"org_admin"===n(e)||"account_admin"===n(e)}function v(e){return["org_admin","account_admin"].includes(n(e))&&!(null==e?void 0:e.roleId)}function m(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function y(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateItemCategorySchema"))}function f(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateGroups"))}function g(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:assignToGroups"))}const h=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:deleteItems"))};function w(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function b(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function S(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function x(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function O(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function I(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function T(e,t,r,i){const n=i&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(i.type),a=((null==t?void 0:t.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!t||!p(t)&&!a||!(null==r?void 0:r.isPortal)&&!n)}function L(e){return!!e&&(!m(e)||m(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const P=({items:e,user:t,portal:r})=>{const n=e[0],a=n.owner;if(r.isPortal&&a!==t.username&&a.includes("esri_")&&!["esri_livingatlas"].includes(a))return!1;const o=(0,i.u)(n,t),l=m(t),c=$(t),u=s(n,t)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(t)&&!l&&(function(e,t){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(t)||w(e)||b(e)||!!t.canSharePublic&&S(e)}(t,r)||$(t));return o||u||(0,i.c)(e,t)&&c};function $(e){return I(e)||x(e)||O(e)}function k(e){const t=["portal:user:createItem","portal:user:viewOrgItems","premium:publisher:createNotebooks","portal:publisher:createDataPipelines","features:user:edit","features:user:fullEdit","portal:admin:viewItems","portal:admin:updateItems","portal:admin:deleteItems"];return e.some((e=>t.includes(e)))}},81457:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>c,c:()=>d,d:()=>a,e:()=>n,g:()=>o,r:()=>l,s:()=>s});var i=r(11246);function n(e,t,r,i){!function(e,t,r){r=r||{};let i=null==r?void 0:r.expires;if("number"==typeof i){const e=new Date,t=24*i*60*60*1e3;e.setTime(Date.now()+t),i=r.expires=e}"string"!=typeof i&&(null==i?void 0:i.toUTCString)&&(r.expires=i.toUTCString());let n,a=`${e}=${encodeURIComponent(t)}`;for(n in r){a+=`; ${n}`;const e=r[n];!0!==e&&(a+=`=${e}`)}document.cookie=a}(e,i?JSON.stringify(t):t,r)}function a(e,t){const r=function(e){const t=document.cookie,r=new RegExp(`(?:^|; )${(0,i.e)(e)}=([^;]*)`),n=t.match(r);return n?decodeURIComponent(n[1]):void 0}(e);return r&&t?JSON.parse(r):r}function s(e,t,r){window.localStorage.setItem(e,r?JSON.stringify(t):t)}function o(e,t){const r=window.localStorage.getItem(e);return r&&t?JSON.parse(r):r}function l(e){window.localStorage.removeItem(e)}function c(e,t,r){window.sessionStorage.setItem(e,r?JSON.stringify(t):t)}function u(e,t){const r=window.sessionStorage.getItem(e);return r&&t?JSON.parse(r):r}function d(e){window.sessionStorage.removeItem(e)}},91253:(e,t,r)=>{r.d(t,{w:()=>i});const i=(0,r(11935).c)({portal:null,user:null,i18n:null,scale:"m",api:4,nextText:null,uploadProgress:0}).state},15437:(e,t,r)=>{r.d(t,{a:()=>m,b:()=>v,c:()=>u,d:()=>f,e:()=>y,f:()=>g,g:()=>h,h:()=>l,i:()=>w,r:()=>c,s:()=>p,u:()=>d});var i=r(94788),n=r(31670),a=r(28926),s=r(81457),o=r(67575);function l(e){return"/"===(null==e?void 0:e.slice(-1))?e.slice(0,e.length-1):e}function c(e){return e.startsWith("/")||e.startsWith("\\")?e.slice(1):e}async function u(e){var t;const r=null!==(t=null===n.c||void 0===n.c?void 0:n.c.api)&&void 0!==t?t:4,[i]=await(0,a.l)([4===r?"esri/core/urlUtils":"esri/urlUtils"]);let s=i.urlToObject(e);s.query=s.query||{};for(let e in s.query||{})s.query.hasOwnProperty(e)&&(Array.isArray(s.query[e])||(s.query[e]=s.query[e].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,"")));return s}function d(e){return(null==e?void 0:e.replace(/^.*\//,"").replace(/.[^.]*$/,""))||""}function p(e){return["WFS","GeoJson","CSV","GeoRSS","KML","OGCFeatureServer","WMS","WMTS"].includes(e)}function v(e){const{config:t,portal:r}=n.c;let i=!1;if(!e)return!1;if((t.httpsDomains||[]).forEach((t=>{(e.indexOf(`.${t}/`)>-1||e.indexOf(`/${t}/`)>-1)&&(i=!0)})),!i){let t=r.portalHostname;t.indexOf("/")>-1&&(t=t.substring(0,t.indexOf("/"))),e.indexOf(t)>-1&&(i=!0)}return i}function m(e){if(!e)return!1;const{config:t,portal:r}=n.c,a=(0,i.g)(r),s=new URL(a).hostname,o=!1===t.isMultiTenant,l=-1!==e.indexOf(".arcgis.com/"),c=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features")||-1!==e.indexOf("//locationservices"),u=r.supportsHostedServices&&-1!==e.indexOf(s)&&!o;return l&&c||!l&&u}function y(){var e;if(-1===window.location.protocol.toLowerCase().indexOf("https")){const t=(0,s.d)("esri_auth",!0);return"web"!==(null===(e=null==t?void 0:t.auth_tier)||void 0===e?void 0:e.toLowerCase())}return!0}function f(e){let t=e.toLowerCase();-1==t.indexOf("http://")&&-1==t.indexOf("https://")&&(t=(e="https://"+e).toLowerCase());let r=t.indexOf("//");r=t.indexOf("/",r+2),-1==r?t=(e+="/arcgis/rest/services").toLowerCase():r==t.length-1&&(t=(e+="arcgis/rest/services").toLowerCase());let i=t.indexOf("/arcgis",r);i==t.length-7?t=(e+="/rest/services").toLowerCase():i==t.length-8&&(t=(e+="rest/services").toLowerCase()),i=t.indexOf("/server",r),t.endsWith("/server")?t=(e+="/rest/services").toLowerCase():t.endsWith("/server/")&&(t=(e+="rest/services").toLowerCase());const n=t.indexOf("/rest/services",r),a=t.indexOf("/services",r),s=t.indexOf("/rest",r);return-1==n&&a>-1?t=(e=`${e.substring(0,a)}/rest/services${e.substring(a+9)}`).toLowerCase():-1==n&&s>-1&&(t=(e=`${e.substring(0,s)}/rest/services${e.substring(s+5)}`).toLowerCase()),t.indexOf("/rest/services"),e}const g=(e,t=!1)=>(e=l(e),/(http|https|ftp):\/\/?/.exec(e)||(e=`https://${e}`),!t&&"https:"!==location.protocol||!m(e)&&!v(e)||(e=e.replace("http:/","https:/")),e=e.indexOf("/dynamicLayer?")>-1?e.substring(0,e.indexOf("/dynamicLayer?")):e),h=(e,t=!1)=>{var r,n,a;if(!e)return{error:{code:"invalidUrl"}};if(w(e,t))return{error:{code:"httpWarning"}};const s=decodeURIComponent(e),l=s.replace(i.v,"").match(/((\.|\/)*(kml|kmz))/gi),c=s.replace(i.v,"").match(/((\/|\=)(wmts|wms|wfs))/gi),u=s.replace(i.v,"").match(/((\/|\=)(OGC|OGCFeatureServer))/gi),d=s.replace(i.v,"").match(/((\.|\/)*(rss))/gi),p=null===(r=s.replace(i.v,"").match(i.r))||void 0===r?void 0:r[1],v=s.replace(i.v,"").match(i.h),m=s.replace(i.v,"").match(/((\.|\/)*(csv))/gi),y=s.replace(i.v,"").match(/(\.|\/)((\$?{(z|level)})\/*(\$?{(x|col)})\/*(\$?{(y|row)}))/gi);let f=null;if(s.match(i.f))f="GeoJson";else if(!u||c||p)if(p&&!c)f=o.a[p];else if(v)f="Map Service";else if(c){const e="/"===(null==c?void 0:c[0].charAt(0))?"/":"=";f=null===(a=null===(n=null==c?void 0:c[0])||void 0===n?void 0:n.split(e)[1])||void 0===a?void 0:a.toUpperCase()}else l?f="KML":d?f="GeoRSS":m?f="CSV":y?f="Tile Layer":s.endsWith("KnowledgeGraphServer")&&(f="Knowledge Graph");else f="OGCFeatureServer";return{result:f}},w=(e,t)=>!t&&e.includes("http://")}}]);