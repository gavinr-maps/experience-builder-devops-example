/*! For license information please see node_modules_arcgis_map-components_dist_esm_arcgis-version-management_entry_js.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["node_modules_arcgis_map-components_dist_esm_arcgis-version-management_entry_js"],{461:(e,i,s)=>{s.r(i),s.d(i,{arcgis_version_management:()=>a});var t=s(4336),n=s(8960),o=s(2676);const a=class{constructor(e){(0,t.r)(this,e),this.manager=(0,o.u)(this),this._watchHandles=[],this.label=void 0,this.position="top-right",this.view=void 0,this.messages=this.manager.readonly((0,o.c)({blocking:!0})),this.state=void 0}positionWatcher(e){void 0!==e&&this.viewModel&&this.view.ui.move(this.el,e)}async componentDidLoad(){const{watch:e}=await(0,n.i)();this._watchHandles.push(e((()=>this.viewModel.state),(e=>{this.state=e})))}async componentWillLoad(){await this._checkForView(),this.viewModel=await(0,n.a5)({view:this.view}),this.label=this.label?this.label:this.messages.label}disconnectedCallback(){this._watchHandles.forEach((e=>{e.remove()})),this._watchHandles=[]}render(){const{messages:e,label:i,viewModel:s,viewModel:{state:n,loadError:o}}=this,a=Array.from(this.viewModel.serviceNameLookup,(([e,i])=>({url:e,name:i})));return(0,t.h)(t.H,null,(0,t.h)("calcite-flow",{ref:e=>{this.flowElement=e},class:"flow-main"},(0,t.h)("calcite-flow-item",{heading:i},(0,t.h)("calcite-panel",{class:"panel-services",loading:"loading"===n},a.map((n=>(0,t.h)("arcgis-version-management-service-item",{flowElement:this.flowElement,heading:i,serviceUrl:n.url,strings:e,viewModel:s,onVersionItemActionClickedEventWithServiceUrl:e=>{this.flowElement&&this._handleVersionItemActionClick(e,this.flowElement)},onVersionListActionClickedEvent:e=>{this.flowElement&&this._handleVersionListActionClick(e,this.flowElement)}}))),"disabled"===n?(0,t.h)("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer"},(0,t.h)("div",{slot:"message"},this._getLoadError(o))):void 0))))}async _checkForView(){const e=this.el.closest("arcgis-map");e?.view&&(await e.view.map.load(),this.view=e.view,this.view.ui.add(this.el,this.position))}_createVersionPropertiesFlow(e,i){const{flowElement:s,viewModel:t}=this;if(!s)return null;const n=document.createElement("arcgis-version-management-version-properties");return n.flowElement=s,n.serviceUrl=e,n.strings=this.messages,n.versionInfo=i,n.viewModel=t,n.addEventListener("versionPropertiesSaveClickedEvent",(async e=>{const{serviceUrl:i,versionInfo:n}=e.detail,o=n.versionIdentifier.name,a=o.split(".").length>1?o.split(".")[1]:o,r=o.split(".").length>1?o.split(".")[0]:t.userLookup.get(i);if(""===n.versionIdentifier.guid?await t.createVersion({access:n.access,description:n.description,featureServerUrl:i,ownerName:r,versionName:a}):await t.alterVersion({access:n.access,description:n.description,featureServerUrl:i,ownerName:r,versionIdentifier:{name:"",guid:n.versionIdentifier.guid},versionName:a}),"ready"===t.state){const e=s.getElementsByTagName("arcgis-version-management-version-list")[0];e.versionInfos=[];const n=await t.getVersionInfos(i,!0);e.versionInfos=n,await s.back()}})),n}_getLoadError(e){const{messages:i}=this;switch(e){case"no-feature-services":return i.loadErrors.noFeatureServices;case"no-layers-property":return i.loadErrors.noLayersProperty;default:return e}}async _handleVersionItemActionClick(e,i){const{actionType:s,serviceUrl:t,versionInfo:n}=e.detail;switch(s){case"changeVersion":await this._switchToVersion(t,n.versionIdentifier.name,n.versionIdentifier.guid);break;case"editVersion":{const e=this._createVersionPropertiesFlow(t,n);e&&i.append(e);break}}}async _handleVersionListActionClick(e,i){const{actionType:s,serviceUrl:t}=e.detail;switch(s){case"newVersion":{const e=this._createVersionPropertiesFlow(t,void 0);e&&i.append(e);break}case"refreshVersions":if(this.flowElement){const e=this.flowElement.getElementsByTagName("arcgis-version-management-version-list")[0];e.versionInfos=[];const i=await this.viewModel.getVersionInfos(t,!0);e.versionInfos=i}}}async _switchToVersion(e,i,s){await this.viewModel.changeVersion(e,i,s)}static get assetsDirs(){return["assets"]}get el(){return(0,t.g)(this)}static get watchers(){return{position:["positionWatcher"]}}};a.style=".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}"}}]);